# Comparing `tmp/dask-2024.5.0.tar.gz` & `tmp/dask-2024.5.1.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dask-2024.5.0.tar", last modified: Fri May  3 21:18:47 2024, max compression
+gzip compressed data, was "dask-2024.5.1.tar", last modified: Fri May 17 20:11:37 2024, max compression
```

## Comparing `dask-2024.5.0.tar` & `dask-2024.5.1.tar`

### file list

```diff
@@ -1,505 +1,506 @@
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.401527 dask-2024.5.0/
--rw-r--r--   0 james      (501) staff       (20)     1531 2023-07-17 19:15:27.000000 dask-2024.5.0/LICENSE.txt
--rw-r--r--   0 james      (501) staff       (20)      325 2023-07-17 19:15:27.000000 dask-2024.5.0/MANIFEST.in
--rw-r--r--   0 james      (501) staff       (20)     3780 2024-05-03 21:18:47.401223 dask-2024.5.0/PKG-INFO
--rw-r--r--   0 james      (501) staff       (20)     1291 2023-07-17 19:15:27.000000 dask-2024.5.0/README.rst
--rw-r--r--   0 james      (501) staff       (20)     1598 2024-01-23 19:42:07.000000 dask-2024.5.0/conftest.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.279046 dask-2024.5.0/dask/
--rw-r--r--   0 james      (501) staff       (20)      485 2023-08-21 21:39:12.000000 dask-2024.5.0/dask/__init__.py
--rw-r--r--   0 james      (501) staff       (20)      133 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/__main__.py
--rw-r--r--   0 james      (501) staff       (20)      720 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/_compatibility.py
--rw-r--r--   0 james      (501) staff       (20)      500 2024-05-03 21:18:47.401707 dask-2024.5.0/dask/_version.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.286044 dask-2024.5.0/dask/array/
--rw-r--r--   0 james      (501) staff       (20)     1543 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/array/NUMPY_LICENSE.txt
--rw-r--r--   0 james      (501) staff       (20)     5413 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    12600 2023-12-20 15:38:57.000000 dask-2024.5.0/dask/array/backends.py
--rw-r--r--   0 james      (501) staff       (20)     9983 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/blockwise.py
--rw-r--r--   0 james      (501) staff       (20)    12304 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/chunk.py
--rw-r--r--   0 james      (501) staff       (20)     5066 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/chunk_types.py
--rw-r--r--   0 james      (501) staff       (20)   191296 2024-04-19 20:50:02.000000 dask-2024.5.0/dask/array/core.py
--rw-r--r--   0 james      (501) staff       (20)    40514 2023-10-25 14:44:16.000000 dask-2024.5.0/dask/array/creation.py
--rw-r--r--   0 james      (501) staff       (20)     2114 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/cupy_entry_point.py
--rw-r--r--   0 james      (501) staff       (20)      526 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/dispatch.py
--rw-r--r--   0 james      (501) staff       (20)     9146 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/einsumfuncs.py
--rw-r--r--   0 james      (501) staff       (20)     7677 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/array/fft.py
--rw-r--r--   0 james      (501) staff       (20)    32656 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/gufunc.py
--rw-r--r--   0 james      (501) staff       (20)     1996 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/image.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.286413 dask-2024.5.0/dask/array/lib/
--rw-r--r--   0 james      (501) staff       (20)       77 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/lib/__init__.py
--rw-r--r--   0 james      (501) staff       (20)      101 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/lib/stride_tricks.py
--rw-r--r--   0 james      (501) staff       (20)    53218 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/array/linalg.py
--rw-r--r--   0 james      (501) staff       (20)     6363 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/ma.py
--rw-r--r--   0 james      (501) staff       (20)     6078 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/array/numpy_compat.py
--rw-r--r--   0 james      (501) staff       (20)    12838 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/optimization.py
--rw-r--r--   0 james      (501) staff       (20)    28479 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/overlap.py
--rw-r--r--   0 james      (501) staff       (20)    10925 2024-04-19 20:50:02.000000 dask-2024.5.0/dask/array/percentile.py
--rw-r--r--   0 james      (501) staff       (20)    40605 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/random.py
--rw-r--r--   0 james      (501) staff       (20)    28323 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/rechunk.py
--rw-r--r--   0 james      (501) staff       (20)    58469 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/reductions.py
--rw-r--r--   0 james      (501) staff       (20)    10766 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/reshape.py
--rw-r--r--   0 james      (501) staff       (20)    81576 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/routines.py
--rw-r--r--   0 james      (501) staff       (20)    72865 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/slicing.py
--rw-r--r--   0 james      (501) staff       (20)    16184 2023-08-21 21:39:12.000000 dask-2024.5.0/dask/array/stats.py
--rw-r--r--   0 james      (501) staff       (20)     8048 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/svg.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.293218 dask-2024.5.0/dask/array/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/array/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)   163015 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/array/tests/test_array_core.py
--rw-r--r--   0 james      (501) staff       (20)     6689 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_array_function.py
--rw-r--r--   0 james      (501) staff       (20)     3159 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_array_utils.py
--rw-r--r--   0 james      (501) staff       (20)    23222 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_atop.py
--rw-r--r--   0 james      (501) staff       (20)     3304 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_chunk.py
--rw-r--r--   0 james      (501) staff       (20)    31190 2023-10-25 14:44:16.000000 dask-2024.5.0/dask/array/tests/test_creation.py
--rw-r--r--   0 james      (501) staff       (20)    19888 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_cupy_core.py
--rw-r--r--   0 james      (501) staff       (20)     6496 2023-10-25 14:44:16.000000 dask-2024.5.0/dask/array/tests/test_cupy_creation.py
--rw-r--r--   0 james      (501) staff       (20)      594 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_cupy_gufunc.py
--rw-r--r--   0 james      (501) staff       (20)    13412 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_cupy_linalg.py
--rw-r--r--   0 james      (501) staff       (20)     4303 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_cupy_overlap.py
--rw-r--r--   0 james      (501) staff       (20)     2730 2024-03-13 20:06:30.000000 dask-2024.5.0/dask/array/tests/test_cupy_percentile.py
--rw-r--r--   0 james      (501) staff       (20)     9219 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_cupy_random.py
--rw-r--r--   0 james      (501) staff       (20)     2224 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_cupy_reductions.py
--rw-r--r--   0 james      (501) staff       (20)     7436 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/tests/test_cupy_routines.py
--rw-r--r--   0 james      (501) staff       (20)     4877 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_cupy_slicing.py
--rw-r--r--   0 james      (501) staff       (20)     2982 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_cupy_sparse.py
--rw-r--r--   0 james      (501) staff       (20)     8866 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/tests/test_dispatch.py
--rw-r--r--   0 james      (501) staff       (20)     8821 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/array/tests/test_fft.py
--rw-r--r--   0 james      (501) staff       (20)    21013 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_gufunc.py
--rw-r--r--   0 james      (501) staff       (20)     1482 2023-09-28 22:08:27.000000 dask-2024.5.0/dask/array/tests/test_image.py
--rw-r--r--   0 james      (501) staff       (20)    37415 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/array/tests/test_linalg.py
--rw-r--r--   0 james      (501) staff       (20)    15714 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/array/tests/test_masked.py
--rw-r--r--   0 james      (501) staff       (20)     1087 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_numpy_compat.py
--rw-r--r--   0 james      (501) staff       (20)    17446 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_optimization.py
--rw-r--r--   0 james      (501) staff       (20)    26718 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_overlap.py
--rw-r--r--   0 james      (501) staff       (20)     3443 2023-11-07 18:15:20.000000 dask-2024.5.0/dask/array/tests/test_percentiles.py
--rw-r--r--   0 james      (501) staff       (20)    15352 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/array/tests/test_random.py
--rw-r--r--   0 james      (501) staff       (20)    36568 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/array/tests/test_rechunk.py
--rw-r--r--   0 james      (501) staff       (20)    33283 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/array/tests/test_reductions.py
--rw-r--r--   0 james      (501) staff       (20)     7289 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_reshape.py
--rw-r--r--   0 james      (501) staff       (20)    84472 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/array/tests/test_routines.py
--rw-r--r--   0 james      (501) staff       (20)    32264 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/array/tests/test_slicing.py
--rw-r--r--   0 james      (501) staff       (20)     6592 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_sparse.py
--rw-r--r--   0 james      (501) staff       (20)     5489 2023-09-28 22:08:27.000000 dask-2024.5.0/dask/array/tests/test_stats.py
--rw-r--r--   0 james      (501) staff       (20)     2740 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_svg.py
--rw-r--r--   0 james      (501) staff       (20)      525 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_testing.py
--rw-r--r--   0 james      (501) staff       (20)    17390 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_ufunc.py
--rw-r--r--   0 james      (501) staff       (20)     2706 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_wrap.py
--rw-r--r--   0 james      (501) staff       (20)     1317 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tests/test_xarray.py
--rw-r--r--   0 james      (501) staff       (20)     4737 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/tiledb_io.py
--rw-r--r--   0 james      (501) staff       (20)    10030 2024-03-13 20:06:30.000000 dask-2024.5.0/dask/array/ufunc.py
--rw-r--r--   0 james      (501) staff       (20)    19112 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/array/utils.py
--rw-r--r--   0 james      (501) staff       (20)     6906 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/array/wrap.py
--rw-r--r--   0 james      (501) staff       (20)     5122 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/backends.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.294615 dask-2024.5.0/dask/bag/
--rw-r--r--   0 james      (501) staff       (20)      903 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     9111 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/avro.py
--rw-r--r--   0 james      (501) staff       (20)      763 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/chunk.py
--rw-r--r--   0 james      (501) staff       (20)    86045 2024-04-19 20:50:02.000000 dask-2024.5.0/dask/bag/core.py
--rw-r--r--   0 james      (501) staff       (20)     5464 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/random.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.295543 dask-2024.5.0/dask/bag/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/bag/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     3808 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/tests/test_avro.py
--rw-r--r--   0 james      (501) staff       (20)    52816 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/bag/tests/test_bag.py
--rw-r--r--   0 james      (501) staff       (20)     6528 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/tests/test_random.py
--rw-r--r--   0 james      (501) staff       (20)     5049 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/tests/test_text.py
--rw-r--r--   0 james      (501) staff       (20)     6765 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/text.py
--rw-r--r--   0 james      (501) staff       (20)      241 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bag/utils.py
--rw-r--r--   0 james      (501) staff       (20)    54892 2024-04-01 19:10:34.000000 dask-2024.5.0/dask/base.py
--rw-r--r--   0 james      (501) staff       (20)    53276 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/blockwise.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.296017 dask-2024.5.0/dask/bytes/
--rw-r--r--   0 james      (501) staff       (20)       75 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bytes/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     6933 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bytes/core.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.297041 dask-2024.5.0/dask/bytes/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/bytes/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     5158 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bytes/tests/test_bytes_utils.py
--rw-r--r--   0 james      (501) staff       (20)      530 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bytes/tests/test_compression.py
--rw-r--r--   0 james      (501) staff       (20)     6815 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/bytes/tests/test_http.py
--rw-r--r--   0 james      (501) staff       (20)    11476 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bytes/tests/test_local.py
--rw-r--r--   0 james      (501) staff       (20)    19556 2024-01-29 17:27:45.000000 dask-2024.5.0/dask/bytes/tests/test_s3.py
--rw-r--r--   0 james      (501) staff       (20)      500 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/bytes/utils.py
--rw-r--r--   0 james      (501) staff       (20)     2001 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/cache.py
--rw-r--r--   0 james      (501) staff       (20)     4067 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/callbacks.py
--rw-r--r--   0 james      (501) staff       (20)     5773 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/cli.py
--rw-r--r--   0 james      (501) staff       (20)      523 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/compatibility.py
--rw-r--r--   0 james      (501) staff       (20)    24786 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/config.py
--rw-r--r--   0 james      (501) staff       (20)      959 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/conftest.py
--rw-r--r--   0 james      (501) staff       (20)     1756 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/context.py
--rw-r--r--   0 james      (501) staff       (20)    15772 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/core.py
--rw-r--r--   0 james      (501) staff       (20)     8149 2024-04-19 20:50:02.000000 dask-2024.5.0/dask/dask-schema.yaml
--rw-r--r--   0 james      (501) staff       (20)     1992 2024-04-19 20:50:02.000000 dask-2024.5.0/dask/dask.yaml
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.301624 dask-2024.5.0/dask/dataframe/
--rw-r--r--   0 james      (501) staff       (20)     5465 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/dataframe/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     7642 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/_compat.py
--rw-r--r--   0 james      (501) staff       (20)     2171 2023-08-21 21:39:12.000000 dask-2024.5.0/dask/dataframe/_dtypes.py
--rw-r--r--   0 james      (501) staff       (20)     3974 2024-02-06 16:03:46.000000 dask-2024.5.0/dask/dataframe/_pyarrow.py
--rw-r--r--   0 james      (501) staff       (20)     2743 2023-11-10 20:46:15.000000 dask-2024.5.0/dask/dataframe/_pyarrow_compat.py
--rw-r--r--   0 james      (501) staff       (20)      393 2024-01-25 18:24:19.000000 dask-2024.5.0/dask/dataframe/_testing.py
--rw-r--r--   0 james      (501) staff       (20)    13540 2024-04-19 20:50:02.000000 dask-2024.5.0/dask/dataframe/accessor.py
--rw-r--r--   0 james      (501) staff       (20)    25943 2024-04-19 20:50:02.000000 dask-2024.5.0/dask/dataframe/backends.py
--rw-r--r--   0 james      (501) staff       (20)     9507 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/categorical.py
--rw-r--r--   0 james      (501) staff       (20)   314038 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/core.py
--rw-r--r--   0 james      (501) staff       (20)     4577 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/dispatch.py
--rw-r--r--   0 james      (501) staff       (20)      552 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/extensions.py
--rw-r--r--   0 james      (501) staff       (20)   117451 2024-04-01 19:10:34.000000 dask-2024.5.0/dask/dataframe/groupby.py
--rw-r--r--   0 james      (501) staff       (20)     2463 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/hyperloglog.py
--rw-r--r--   0 james      (501) staff       (20)    13412 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/indexing.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.303144 dask-2024.5.0/dask/dataframe/io/
--rw-r--r--   0 james      (501) staff       (20)      706 2023-09-25 17:06:23.000000 dask-2024.5.0/dask/dataframe/io/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    34437 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/csv.py
--rw-r--r--   0 james      (501) staff       (20)    18830 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/demo.py
--rw-r--r--   0 james      (501) staff       (20)    18384 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/dataframe/io/hdf.py
--rw-r--r--   0 james      (501) staff       (20)    38600 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/io.py
--rw-r--r--   0 james      (501) staff       (20)    11163 2023-08-21 21:39:12.000000 dask-2024.5.0/dask/dataframe/io/json.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.303909 dask-2024.5.0/dask/dataframe/io/orc/
--rw-r--r--   0 james      (501) staff       (20)       92 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/io/orc/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     4487 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/io/orc/arrow.py
--rw-r--r--   0 james      (501) staff       (20)     7183 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/dataframe/io/orc/core.py
--rw-r--r--   0 james      (501) staff       (20)      510 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/io/orc/utils.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.304981 dask-2024.5.0/dask/dataframe/io/parquet/
--rw-r--r--   0 james      (501) staff       (20)      166 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/io/parquet/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    72803 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/parquet/arrow.py
--rw-r--r--   0 james      (501) staff       (20)    67054 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/parquet/core.py
--rw-r--r--   0 james      (501) staff       (20)    52314 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/parquet/fastparquet.py
--rw-r--r--   0 james      (501) staff       (20)    32900 2023-10-27 21:32:35.000000 dask-2024.5.0/dask/dataframe/io/parquet/utils.py
--rw-r--r--   0 james      (501) staff       (20)    21270 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/sql.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.306724 dask-2024.5.0/dask/dataframe/io/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/dataframe/io/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    61918 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/tests/test_csv.py
--rw-r--r--   0 james      (501) staff       (20)    11436 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/io/tests/test_demo.py
--rw-r--r--   0 james      (501) staff       (20)    27324 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/dataframe/io/tests/test_hdf.py
--rw-r--r--   0 james      (501) staff       (20)    35669 2024-04-29 18:30:10.000000 dask-2024.5.0/dask/dataframe/io/tests/test_io.py
--rw-r--r--   0 james      (501) staff       (20)     8812 2023-09-21 15:09:09.000000 dask-2024.5.0/dask/dataframe/io/tests/test_json.py
--rw-r--r--   0 james      (501) staff       (20)     5322 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/dataframe/io/tests/test_orc.py
--rw-r--r--   0 james      (501) staff       (20)   166072 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/dataframe/io/tests/test_parquet.py
--rw-r--r--   0 james      (501) staff       (20)    17746 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/dataframe/io/tests/test_sql.py
--rw-r--r--   0 james      (501) staff       (20)     8041 2023-08-21 21:39:12.000000 dask-2024.5.0/dask/dataframe/io/utils.py
--rw-r--r--   0 james      (501) staff       (20)    14713 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/dataframe/methods.py
--rw-r--r--   0 james      (501) staff       (20)    55455 2024-02-09 22:36:17.000000 dask-2024.5.0/dask/dataframe/multi.py
--rw-r--r--   0 james      (501) staff       (20)     1600 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/numeric.py
--rw-r--r--   0 james      (501) staff       (20)     8780 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/optimize.py
--rw-r--r--   0 james      (501) staff       (20)    20819 2023-10-25 14:44:16.000000 dask-2024.5.0/dask/dataframe/partitionquantiles.py
--rw-r--r--   0 james      (501) staff       (20)    11868 2023-10-27 21:32:31.000000 dask-2024.5.0/dask/dataframe/reshape.py
--rw-r--r--   0 james      (501) staff       (20)    22170 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/rolling.py
--rw-r--r--   0 james      (501) staff       (20)    40190 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/shuffle.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.311629 dask-2024.5.0/dask/dataframe/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/dataframe/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    11131 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/tests/test_accessors.py
--rw-r--r--   0 james      (501) staff       (20)    71041 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/dataframe/tests/test_arithmetics_reduction.py
--rw-r--r--   0 james      (501) staff       (20)      942 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/tests/test_boolean.py
--rw-r--r--   0 james      (501) staff       (20)    18249 2024-04-25 02:58:16.000000 dask-2024.5.0/dask/dataframe/tests/test_categorical.py
--rw-r--r--   0 james      (501) staff       (20)   208743 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/dataframe/tests/test_dataframe.py
--rw-r--r--   0 james      (501) staff       (20)     1457 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/tests/test_extensions.py
--rw-r--r--   0 james      (501) staff       (20)    14847 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/dataframe/tests/test_format.py
--rw-r--r--   0 james      (501) staff       (20)   127454 2024-04-04 15:04:44.000000 dask-2024.5.0/dask/dataframe/tests/test_groupby.py
--rw-r--r--   0 james      (501) staff       (20)     2702 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dataframe/tests/test_hashing.py
--rw-r--r--   0 james      (501) staff       (20)     2897 2024-01-30 19:27:46.000000 dask-2024.5.0/dask/dataframe/tests/test_hyperloglog.py
--rw-r--r--   0 james      (501) staff       (20)    23962 2024-02-06 16:03:46.000000 dask-2024.5.0/dask/dataframe/tests/test_indexing.py
--rw-r--r--   0 james      (501) staff       (20)     7990 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/dataframe/tests/test_merge_column_and_index.py
--rw-r--r--   0 james      (501) staff       (20)      463 2023-08-21 21:39:12.000000 dask-2024.5.0/dask/dataframe/tests/test_methods.py
--rw-r--r--   0 james      (501) staff       (20)    96495 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/dataframe/tests/test_multi.py
--rw-r--r--   0 james      (501) staff       (20)     2624 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/tests/test_numeric.py
--rw-r--r--   0 james      (501) staff       (20)     1188 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/dataframe/tests/test_optimize_dataframe.py
--rw-r--r--   0 james      (501) staff       (20)     6662 2023-09-25 17:06:24.000000 dask-2024.5.0/dask/dataframe/tests/test_pyarrow.py
--rw-r--r--   0 james      (501) staff       (20)     5059 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/tests/test_pyarrow_compat.py
--rw-r--r--   0 james      (501) staff       (20)    11551 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/dataframe/tests/test_reshape.py
--rw-r--r--   0 james      (501) staff       (20)    18504 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/tests/test_rolling.py
--rw-r--r--   0 james      (501) staff       (20)    63402 2024-04-19 20:50:02.000000 dask-2024.5.0/dask/dataframe/tests/test_shuffle.py
--rw-r--r--   0 james      (501) staff       (20)    16922 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/dataframe/tests/test_ufunc.py
--rw-r--r--   0 james      (501) staff       (20)    22240 2024-04-01 19:10:34.000000 dask-2024.5.0/dask/dataframe/tests/test_utils_dataframe.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.311961 dask-2024.5.0/dask/dataframe/tseries/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/dataframe/tseries/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     7675 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/dataframe/tseries/resample.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.312316 dask-2024.5.0/dask/dataframe/tseries/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/dataframe/tseries/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)     7028 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/dataframe/tseries/tests/test_resample.py
--rw-r--r--   0 james      (501) staff       (20)    27545 2024-04-25 02:58:16.000000 dask-2024.5.0/dask/dataframe/utils.py
--rw-r--r--   0 james      (501) staff       (20)     5331 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/datasets.py
--rw-r--r--   0 james      (501) staff       (20)    24814 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/delayed.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.313149 dask-2024.5.0/dask/diagnostics/
--rw-r--r--   0 james      (501) staff       (20)      258 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/diagnostics/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    12136 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/diagnostics/profile.py
--rw-r--r--   0 james      (501) staff       (20)    16332 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/diagnostics/profile_visualize.py
--rw-r--r--   0 james      (501) staff       (20)     5001 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/diagnostics/progress.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.313701 dask-2024.5.0/dask/diagnostics/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/diagnostics/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)    12045 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/diagnostics/tests/test_profiler.py
--rw-r--r--   0 james      (501) staff       (20)     3421 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/diagnostics/tests/test_progress.py
--rw-r--r--   0 james      (501) staff       (20)      715 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/distributed.py
--rw-r--r--   0 james      (501) staff       (20)    16587 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/dot.py
--rw-r--r--   0 james      (501) staff       (20)    19622 2023-10-25 14:44:16.000000 dask-2024.5.0/dask/graph_manipulation.py
--rw-r--r--   0 james      (501) staff       (20)     2492 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/hashing.py
--rw-r--r--   0 james      (501) staff       (20)    35516 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/highlevelgraph.py
--rw-r--r--   0 james      (501) staff       (20)    46004 2023-09-13 17:55:33.000000 dask-2024.5.0/dask/layers.py
--rw-r--r--   0 james      (501) staff       (20)    18896 2023-09-13 17:55:33.000000 dask-2024.5.0/dask/local.py
--rw-r--r--   0 james      (501) staff       (20)      487 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/ml.py
--rw-r--r--   0 james      (501) staff       (20)     8474 2023-09-13 17:55:33.000000 dask-2024.5.0/dask/multiprocessing.py
--rw-r--r--   0 james      (501) staff       (20)    36224 2024-02-09 15:39:56.000000 dask-2024.5.0/dask/optimization.py
--rw-r--r--   0 james      (501) staff       (20)    32839 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/order.py
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/py.typed
--rw-r--r--   0 james      (501) staff       (20)    12597 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/rewrite.py
--rw-r--r--   0 james      (501) staff       (20)     7621 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/sizeof.py
--rw-r--r--   0 james      (501) staff       (20)     2089 2023-08-21 21:39:12.000000 dask-2024.5.0/dask/system.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.323078 dask-2024.5.0/dask/tests/
--rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.0/dask/tests/__init__.py
--rw-r--r--   0 james      (501) staff       (20)      824 2024-01-23 19:42:07.000000 dask-2024.5.0/dask/tests/test_backends.py
--rw-r--r--   0 james      (501) staff       (20)    33246 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_base.py
--rw-r--r--   0 james      (501) staff       (20)     1646 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_cache.py
--rw-r--r--   0 james      (501) staff       (20)     2570 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_callbacks.py
--rw-r--r--   0 james      (501) staff       (20)     1224 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/tests/test_ci.py
--rw-r--r--   0 james      (501) staff       (20)     7488 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/tests/test_cli.py
--rw-r--r--   0 james      (501) staff       (20)      379 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_compatibility.py
--rw-r--r--   0 james      (501) staff       (20)    20268 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/tests/test_config.py
--rw-r--r--   0 james      (501) staff       (20)     1170 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_context.py
--rw-r--r--   0 james      (501) staff       (20)     8203 2024-01-23 19:42:03.000000 dask-2024.5.0/dask/tests/test_core.py
--rw-r--r--   0 james      (501) staff       (20)     1112 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_datasets.py
--rw-r--r--   0 james      (501) staff       (20)    23062 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_delayed.py
--rw-r--r--   0 james      (501) staff       (20)    33845 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_distributed.py
--rw-r--r--   0 james      (501) staff       (20)      719 2024-03-13 20:06:30.000000 dask-2024.5.0/dask/tests/test_docs.py
--rw-r--r--   0 james      (501) staff       (20)    12271 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_dot.py
--rw-r--r--   0 james      (501) staff       (20)    15338 2024-01-29 17:27:45.000000 dask-2024.5.0/dask/tests/test_graph_manipulation.py
--rw-r--r--   0 james      (501) staff       (20)     1095 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_hashing.py
--rw-r--r--   0 james      (501) staff       (20)     9396 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_highgraph.py
--rw-r--r--   0 james      (501) staff       (20)     9172 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_layers.py
--rw-r--r--   0 james      (501) staff       (20)     5055 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_local.py
--rw-r--r--   0 james      (501) staff       (20)      419 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_ml.py
--rw-r--r--   0 james      (501) staff       (20)     8457 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_multiprocessing.py
--rw-r--r--   0 james      (501) staff       (20)    47821 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/tests/test_optimization.py
--rw-r--r--   0 james      (501) staff       (20)    69857 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_order.py
--rw-r--r--   0 james      (501) staff       (20)     4684 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_rewrite.py
--rw-r--r--   0 james      (501) staff       (20)     7526 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/tests/test_sizeof.py
--rw-r--r--   0 james      (501) staff       (20)     7258 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_spark_compat.py
--rw-r--r--   0 james      (501) staff       (20)     2571 2023-08-21 21:39:12.000000 dask-2024.5.0/dask/tests/test_system.py
--rw-r--r--   0 james      (501) staff       (20)     4749 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_threaded.py
--rw-r--r--   0 james      (501) staff       (20)    39981 2024-03-13 20:06:30.000000 dask-2024.5.0/dask/tests/test_tokenize.py
--rw-r--r--   0 james      (501) staff       (20)     4591 2023-09-15 13:43:23.000000 dask-2024.5.0/dask/tests/test_traceback.py
--rw-r--r--   0 james      (501) staff       (20)     5767 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_typing.py
--rw-r--r--   0 james      (501) staff       (20)    23675 2024-05-03 20:22:03.000000 dask-2024.5.0/dask/tests/test_utils.py
--rw-r--r--   0 james      (501) staff       (20)     1598 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/test_utils_test.py
--rw-r--r--   0 james      (501) staff       (20)      211 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/tests/warning_aliases.py
--rw-r--r--   0 james      (501) staff       (20)     3001 2023-09-13 17:55:33.000000 dask-2024.5.0/dask/threaded.py
--rw-r--r--   0 james      (501) staff       (20)    15497 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/typing.py
--rw-r--r--   0 james      (501) staff       (20)    63637 2024-03-13 20:06:34.000000 dask-2024.5.0/dask/utils.py
--rw-r--r--   0 james      (501) staff       (20)     4825 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/utils_test.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.323436 dask-2024.5.0/dask/widgets/
--rw-r--r--   0 james      (501) staff       (20)      792 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/__init__.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.324523 dask-2024.5.0/dask/widgets/templates/
--rw-r--r--   0 james      (501) staff       (20)     1295 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/templates/array.html.j2
--rw-r--r--   0 james      (501) staff       (20)      124 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/templates/dataframe.html.j2
--rw-r--r--   0 james      (501) staff       (20)     2579 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/templates/highlevelgraph.html.j2
--rw-r--r--   0 james      (501) staff       (20)     1981 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/templates/highlevelgraph_layer.html.j2
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.324760 dask-2024.5.0/dask/widgets/tests/
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.325389 dask-2024.5.0/dask/widgets/tests/templates/
--rw-r--r--   0 james      (501) staff       (20)       38 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/tests/templates/bytes.html.j2
--rw-r--r--   0 james      (501) staff       (20)       39 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/tests/templates/custom_filter.html.j2
--rw-r--r--   0 james      (501) staff       (20)       30 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/tests/templates/example.html.j2
--rw-r--r--   0 james      (501) staff       (20)     1401 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/tests/test_widgets.py
--rw-r--r--   0 james      (501) staff       (20)     1120 2023-07-17 19:15:27.000000 dask-2024.5.0/dask/widgets/widgets.py
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.399658 dask-2024.5.0/dask.egg-info/
--rw-r--r--   0 james      (501) staff       (20)     3780 2024-05-03 21:18:47.000000 dask-2024.5.0/dask.egg-info/PKG-INFO
--rw-r--r--   0 james      (501) staff       (20)    14520 2024-05-03 21:18:47.000000 dask-2024.5.0/dask.egg-info/SOURCES.txt
--rw-r--r--   0 james      (501) staff       (20)        1 2024-05-03 21:18:47.000000 dask-2024.5.0/dask.egg-info/dependency_links.txt
--rw-r--r--   0 james      (501) staff       (20)      124 2024-05-03 21:18:47.000000 dask-2024.5.0/dask.egg-info/entry_points.txt
--rw-r--r--   0 james      (501) staff       (20)        1 2024-05-03 21:18:46.000000 dask-2024.5.0/dask.egg-info/not-zip-safe
--rw-r--r--   0 james      (501) staff       (20)      532 2024-05-03 21:18:47.000000 dask-2024.5.0/dask.egg-info/requires.txt
--rw-r--r--   0 james      (501) staff       (20)        5 2024-05-03 21:18:47.000000 dask-2024.5.0/dask.egg-info/top_level.txt
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.325804 dask-2024.5.0/docs/
--rw-r--r--   0 james      (501) staff       (20)     5741 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/Makefile
--rw-r--r--   0 james      (501) staff       (20)     5186 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/make.bat
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.354448 dask-2024.5.0/docs/source/
--rw-r--r--   0 james      (501) staff       (20)    17900 2024-01-23 19:42:03.000000 dask-2024.5.0/docs/source/10-minutes-to-dask.rst
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.357034 dask-2024.5.0/docs/source/_static/
--rw-r--r--   0 james      (501) staff       (20)    10187 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_static/config_converter.js
--rw-r--r--   0 james      (501) staff       (20)    11021 2023-07-17 19:15:13.000000 dask-2024.5.0/docs/source/_static/dask-simple.png
--rw-r--r--   0 james      (501) staff       (20)     2375 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_static/main-page.css
--rw-r--r--   0 james      (501) staff       (20)    15598 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_static/profile.html
--rw-r--r--   0 james      (501) staff       (20)    65304 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_static/stacked_profile.html
--rw-r--r--   0 james      (501) staff       (20)      523 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_static/style.css
--rw-r--r--   0 james      (501) staff       (20)      365 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_static/theme_overrides.css
--rw-r--r--   0 james      (501) staff       (20)   292662 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_static/transpose_cyto.html
--rw-r--r--   0 james      (501) staff       (20)    49423 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_static/yaml.min.js
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.357618 dask-2024.5.0/docs/source/_templates/
--rw-r--r--   0 james      (501) staff       (20)      180 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/_templates/layout.html
--rw-r--r--   0 james      (501) staff       (20)     4349 2023-12-13 17:43:46.000000 dask-2024.5.0/docs/source/adaptive.rst
--rw-r--r--   0 james      (501) staff       (20)     3109 2023-08-21 21:39:12.000000 dask-2024.5.0/docs/source/api.rst
--rw-r--r--   0 james      (501) staff       (20)     7189 2023-08-21 21:39:12.000000 dask-2024.5.0/docs/source/array-api.rst
--rw-r--r--   0 james      (501) staff       (20)     2943 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-assignment.rst
--rw-r--r--   0 james      (501) staff       (20)     4740 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-best-practices.rst
--rw-r--r--   0 james      (501) staff       (20)    13262 2023-08-21 21:39:12.000000 dask-2024.5.0/docs/source/array-chunks.rst
--rw-r--r--   0 james      (501) staff       (20)    18437 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-creation.rst
--rw-r--r--   0 james      (501) staff       (20)     5885 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-design.rst
--rw-r--r--   0 james      (501) staff       (20)     2857 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-gufunc.rst
--rw-r--r--   0 james      (501) staff       (20)    21469 2023-08-21 21:39:12.000000 dask-2024.5.0/docs/source/array-numpy-compatibility.rst
--rw-r--r--   0 james      (501) staff       (20)     6069 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-overlap.rst
--rw-r--r--   0 james      (501) staff       (20)     3924 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-random.rst
--rw-r--r--   0 james      (501) staff       (20)     4137 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-slicing.rst
--rw-r--r--   0 james      (501) staff       (20)     3291 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-sparse.rst
--rw-r--r--   0 james      (501) staff       (20)     2018 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-stack.rst
--rw-r--r--   0 james      (501) staff       (20)     1140 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/array-stats.rst
--rw-r--r--   0 james      (501) staff       (20)     4154 2023-08-21 21:39:12.000000 dask-2024.5.0/docs/source/array.rst
--rw-r--r--   0 james      (501) staff       (20)     1574 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/bag-api.rst
--rw-r--r--   0 james      (501) staff       (20)     4557 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/bag-creation.rst
--rw-r--r--   0 james      (501) staff       (20)     4068 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/bag.rst
--rw-r--r--   0 james      (501) staff       (20)    14042 2024-01-23 19:42:03.000000 dask-2024.5.0/docs/source/best-practices.rst
--rw-r--r--   0 james      (501) staff       (20)     5553 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/caching.rst
--rw-r--r--   0 james      (501) staff       (20)   373330 2024-05-03 21:04:52.000000 dask-2024.5.0/docs/source/changelog.rst
--rw-r--r--   0 james      (501) staff       (20)      211 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/cheatsheet.rst
--rw-r--r--   0 james      (501) staff       (20)     4047 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/cli.rst
--rw-r--r--   0 james      (501) staff       (20)    15912 2024-05-03 20:22:03.000000 dask-2024.5.0/docs/source/conf.py
--rw-r--r--   0 james      (501) staff       (20)    16945 2024-03-13 20:06:30.000000 dask-2024.5.0/docs/source/configuration.rst
--rw-r--r--   0 james      (501) staff       (20)    18998 2024-03-13 20:06:30.000000 dask-2024.5.0/docs/source/custom-collections.rst
--rw-r--r--   0 james      (501) staff       (20)     3604 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/custom-graphs.rst
--rw-r--r--   0 james      (501) staff       (20)     4209 2023-12-13 17:43:46.000000 dask-2024.5.0/docs/source/customize-initialization.rst
--rw-r--r--   0 james      (501) staff       (20)      932 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/dashboard-progress-script.py
--rw-r--r--   0 james      (501) staff       (20)    15045 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/dashboard.rst
--rw-r--r--   0 james      (501) staff       (20)   203552 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/daskcheatsheet.pdf
--rw-r--r--   0 james      (501) staff       (20)    10990 2024-05-03 20:22:03.000000 dask-2024.5.0/docs/source/dataframe-api.rst
--rw-r--r--   0 james      (501) staff       (20)     9530 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/dataframe-best-practices.rst
--rw-r--r--   0 james      (501) staff       (20)     3951 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/dataframe-categoricals.rst
--rw-r--r--   0 james      (501) staff       (20)     5977 2023-12-15 20:02:17.000000 dask-2024.5.0/docs/source/dataframe-create.rst
--rw-r--r--   0 james      (501) staff       (20)     5711 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/dataframe-design.rst
--rw-r--r--   0 james      (501) staff       (20)     6239 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/dataframe-extend.rst
--rw-r--r--   0 james      (501) staff       (20)      423 2024-03-13 20:06:34.000000 dask-2024.5.0/docs/source/dataframe-extra.rst
--rw-r--r--   0 james      (501) staff       (20)     8060 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/dataframe-groupby.rst
--rw-r--r--   0 james      (501) staff       (20)     9351 2024-01-23 19:42:03.000000 dask-2024.5.0/docs/source/dataframe-hive.rst
--rw-r--r--   0 james      (501) staff       (20)     6115 2023-10-25 14:44:16.000000 dask-2024.5.0/docs/source/dataframe-indexing.rst
--rw-r--r--   0 james      (501) staff       (20)     3360 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/dataframe-joins.rst
--rw-r--r--   0 james      (501) staff       (20)    13645 2024-03-13 20:06:34.000000 dask-2024.5.0/docs/source/dataframe-legacy-api.rst
--rw-r--r--   0 james      (501) staff       (20)     3683 2024-05-03 20:22:03.000000 dask-2024.5.0/docs/source/dataframe-optimizer.rst
--rw-r--r--   0 james      (501) staff       (20)    10547 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/dataframe-parquet.rst
--rw-r--r--   0 james      (501) staff       (20)    12415 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/dataframe-sql.rst
--rw-r--r--   0 james      (501) staff       (20)     6647 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/dataframe.rst
--rw-r--r--   0 james      (501) staff       (20)      363 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/debugging-performance.rst
--rw-r--r--   0 james      (501) staff       (20)     1696 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/delayed-api.rst
--rw-r--r--   0 james      (501) staff       (20)    17616 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/delayed-best-practices.rst
--rw-r--r--   0 james      (501) staff       (20)     1497 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/delayed-collections.rst
--rw-r--r--   0 james      (501) staff       (20)     6357 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/delayed.rst
--rw-r--r--   0 james      (501) staff       (20)     3620 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/deploying-cli.rst
--rw-r--r--   0 james      (501) staff       (20)     4797 2024-01-26 23:05:40.000000 dask-2024.5.0/docs/source/deploying-cloud.rst
--rw-r--r--   0 james      (501) staff       (20)     2868 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/deploying-docker.rst
--rw-r--r--   0 james      (501) staff       (20)      246 2023-12-13 17:43:46.000000 dask-2024.5.0/docs/source/deploying-extra.rst
--rw-r--r--   0 james      (501) staff       (20)     9939 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/deploying-hpc.rst
--rw-r--r--   0 james      (501) staff       (20)     4001 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/deploying-kubernetes.rst
--rw-r--r--   0 james      (501) staff       (20)     5823 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/deploying-python-advanced.rst
--rw-r--r--   0 james      (501) staff       (20)     2839 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/deploying-python.rst
--rw-r--r--   0 james      (501) staff       (20)     1619 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/deploying-ssh.rst
--rw-r--r--   0 james      (501) staff       (20)     8213 2024-02-09 15:39:56.000000 dask-2024.5.0/docs/source/deploying.rst
--rw-r--r--   0 james      (501) staff       (20)    10868 2023-12-14 20:19:54.000000 dask-2024.5.0/docs/source/deployment-considerations.rst
--rw-r--r--   0 james      (501) staff       (20)    13137 2024-03-13 20:06:30.000000 dask-2024.5.0/docs/source/develop.rst
--rw-r--r--   0 james      (501) staff       (20)     4442 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/diagnostics-distributed.rst
--rw-r--r--   0 james      (501) staff       (20)    10407 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/diagnostics-local.rst
--rw-r--r--   0 james      (501) staff       (20)     4548 2024-04-01 19:10:34.000000 dask-2024.5.0/docs/source/ecosystem.rst
--rw-r--r--   0 james      (501) staff       (20)    18500 2023-12-13 17:43:46.000000 dask-2024.5.0/docs/source/faq.rst
--rw-r--r--   0 james      (501) staff       (20)    25633 2024-02-01 17:01:41.000000 dask-2024.5.0/docs/source/futures.rst
--rw-r--r--   0 james      (501) staff       (20)     5820 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/gpu.rst
--rw-r--r--   0 james      (501) staff       (20)     2541 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/graph_manipulation.rst
--rw-r--r--   0 james      (501) staff       (20)     5433 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/graphs.rst
--rw-r--r--   0 james      (501) staff       (20)     5399 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/graphviz.rst
--rw-r--r--   0 james      (501) staff       (20)     6946 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/high-level-graphs.rst
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.359025 dask-2024.5.0/docs/source/how-to/
--rw-r--r--   0 james      (501) staff       (20)    15531 2024-04-01 19:10:34.000000 dask-2024.5.0/docs/source/how-to/connect-to-remote-data.rst
--rw-r--r--   0 james      (501) staff       (20)    11477 2023-08-21 21:39:12.000000 dask-2024.5.0/docs/source/how-to/debug.rst
--rw-r--r--   0 james      (501) staff       (20)     1722 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/how-to/extend-sizeof.rst
--rw-r--r--   0 james      (501) staff       (20)      433 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/how-to/index.rst
--rw-r--r--   0 james      (501) staff       (20)     6682 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/how-to/selecting-the-collection-backend.rst
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.398006 dask-2024.5.0/docs/source/images/
--rw-r--r--   0 james      (501) staff       (20)    99565 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/10_minutes_array_graph.png
--rw-r--r--   0 james      (501) staff       (20)    22442 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/10_minutes_bag_graph.png
--rw-r--r--   0 james      (501) staff       (20)    56229 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/10_minutes_dataframe_graph.png
--rw-r--r--   0 james      (501) staff       (20)     4059 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/HHMI_Janelia_Color.png
--rw-r--r--   0 james      (501) staff       (20)    18406 2023-07-17 19:15:13.000000 dask-2024.5.0/docs/source/images/array.svg
--rw-r--r--   0 james      (501) staff       (20)  1620104 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/async-embarrassing.gif
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.398192 dask-2024.5.0/docs/source/images/changelog/
--rw-r--r--   0 james      (501) staff       (20)    19604 2023-12-01 15:52:50.000000 dask-2024.5.0/docs/source/images/changelog/2023110-rechunking-disk-perf.png
--rw-r--r--   0 james      (501) staff       (20)   540389 2024-01-26 23:05:40.000000 dask-2024.5.0/docs/source/images/cloud-provider-logos.svg
--rw-r--r--   0 james      (501) staff       (20)    10752 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/concurrent-futures-threaded.webp
--rw-r--r--   0 james      (501) staff       (20)   135129 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/crosstalk.svg
--rw-r--r--   0 james      (501) staff       (20)  2367087 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_jupyterlab.png
--rw-r--r--   0 james      (501) staff       (20)    37971 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_link.png
--rw-r--r--   0 james      (501) staff       (20)    68712 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_memory.png
--rw-r--r--   0 james      (501) staff       (20)   281018 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_memory_new.gif
--rw-r--r--   0 james      (501) staff       (20)    25435 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_progress.png
--rw-r--r--   0 james      (501) staff       (20)   276928 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_status.png
--rw-r--r--   0 james      (501) staff       (20)    12009 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_task_processing.png
--rw-r--r--   0 james      (501) staff       (20)    58238 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_task_stream_unhealthy.png
--rw-r--r--   0 james      (501) staff       (20)   103654 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dashboard_taskstream_healthy.png
--rw-r--r--   0 james      (501) staff       (20)   112822 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask-adaptive.svg
--rw-r--r--   0 james      (501) staff       (20)    14645 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask-array.svg
--rw-r--r--   0 james      (501) staff       (20)   222084 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask-cluster-manager.svg
--rw-r--r--   0 james      (501) staff       (20)    18782 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask-dataframe.svg
--rw-r--r--   0 james      (501) staff       (20)   381903 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask-overview-distributed-callout.svg
--rw-r--r--   0 james      (501) staff       (20)   357643 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask-overview-schedulers.svg
--rw-r--r--   0 james      (501) staff       (20)    97471 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask-overview.svg
--rw-r--r--   0 james      (501) staff       (20)     3022 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_horizontal.svg
--rw-r--r--   0 james      (501) staff       (20)     3651 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_horizontal_black.svg
--rw-r--r--   0 james      (501) staff       (20)     3767 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_horizontal_on_blue.svg
--rw-r--r--   0 james      (501) staff       (20)     3738 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_horizontal_on_pink.svg
--rw-r--r--   0 james      (501) staff       (20)     3738 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_horizontal_white.svg
--rw-r--r--   0 james      (501) staff       (20)     1607 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_icon.svg
--rw-r--r--   0 james      (501) staff       (20)     1571 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_icon_black.svg
--rw-r--r--   0 james      (501) staff       (20)     1607 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_icon_on_pink.svg
--rw-r--r--   0 james      (501) staff       (20)     1609 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/dask_icon_white.svg
--rw-r--r--   0 james      (501) staff       (20)    13382 2024-04-19 20:50:02.000000 dask-2024.5.0/docs/source/images/dataframe-optimize-explain.png
--rw-r--r--   0 james      (501) staff       (20)    20216 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/delayed-inc-double-add.svg
--rw-r--r--   0 james      (501) staff       (20)   104628 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/distributed-overview.svg
--rw-r--r--   0 james      (501) staff       (20)    18297 2023-07-17 19:15:13.000000 dask-2024.5.0/docs/source/images/frame-shuffle.svg
--rw-r--r--   0 james      (501) staff       (20)    22979 2023-07-17 19:15:13.000000 dask-2024.5.0/docs/source/images/frame-sort.svg
--rw-r--r--   0 james      (501) staff       (20)    12181 2023-07-17 19:15:13.000000 dask-2024.5.0/docs/source/images/frame.svg
--rw-r--r--   0 james      (501) staff       (20)   391443 2023-12-13 17:43:46.000000 dask-2024.5.0/docs/source/images/futures-graph.png
--rw-r--r--   0 james      (501) staff       (20)    41828 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/gputester-msg.png
--rw-r--r--   0 james      (501) staff       (20)   210392 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/growth_of_languages.png
--rw-r--r--   0 james      (501) staff       (20)   167834 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/growth_of_libraries.png
--rw-r--r--   0 james      (501) staff       (20)     4097 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/inc-add.svg
--rw-r--r--   0 james      (501) staff       (20)   123010 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/map-reduce-task-scheduling.svg
--rw-r--r--   0 james      (501) staff       (20)   482302 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/map_blocks_drop_axis.png
--rw-r--r--   0 james      (501) staff       (20)   113067 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/merge_chunks.png
--rw-r--r--   0 james      (501) staff       (20)    63244 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/merge_chunks_false.png
--rw-r--r--   0 james      (501) staff       (20)    13024 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/optimize_dask1.svg
--rw-r--r--   0 james      (501) staff       (20)     8803 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/optimize_dask2.svg
--rw-r--r--   0 james      (501) staff       (20)     5198 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/optimize_dask3.svg
--rw-r--r--   0 james      (501) staff       (20)     4104 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/optimize_dask4.svg
--rw-r--r--   0 james      (501) staff       (20)     2738 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/optimize_dask5.svg
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.399011 dask-2024.5.0/docs/source/images/optimizer/
--rw-r--r--   0 james      (501) staff       (20)    24523 2024-05-03 20:22:03.000000 dask-2024.5.0/docs/source/images/optimizer/automatic-repartitioning.svg
--rw-r--r--   0 james      (501) staff       (20)   104078 2024-05-03 20:22:03.000000 dask-2024.5.0/docs/source/images/optimizer/avoiding-shuffles.svg
--rw-r--r--   0 james      (501) staff       (20)   292827 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/order-failure.png
--rw-r--r--   0 james      (501) staff       (20)   239828 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/order-success.png
--rw-r--r--   0 james      (501) staff       (20)    40833 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/overlap.svg
--rw-r--r--   0 james      (501) staff       (20)    18785 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/overlapping-blocks.svg
--rw-r--r--   0 james      (501) staff       (20)     4537 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/overlapping-neighbors.svg
--rw-r--r--   0 james      (501) staff       (20)    20533 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/pipeline.svg
--rw-r--r--   0 james      (501) staff       (20)    31576 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/reshape.png
--rw-r--r--   0 james      (501) staff       (20)    31410 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/reshape_problem.png
--rw-r--r--   0 james      (501) staff       (20)    33288 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/reshape_rechunked.png
--rw-r--r--   0 james      (501) staff       (20)    50209 2023-07-17 19:15:13.000000 dask-2024.5.0/docs/source/images/scaling-edges.png
--rw-r--r--   0 james      (501) staff       (20)    68476 2023-07-17 19:15:13.000000 dask-2024.5.0/docs/source/images/scaling-nodes.png
--rw-r--r--   0 james      (501) staff       (20)    21294 2023-07-17 19:15:13.000000 dask-2024.5.0/docs/source/images/simple-dask.png
--rw-r--r--   0 james      (501) staff       (20)    27572 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/transpose-hlg-hovertooltip.png
--rw-r--r--   0 james      (501) staff       (20)    84492 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/transpose-hlg-html-repr.png
--rw-r--r--   0 james      (501) staff       (20)    39365 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/transpose.svg
--rw-r--r--   0 james      (501) staff       (20)    22446 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/transpose_opt.svg
--rw-r--r--   0 james      (501) staff       (20)   115022 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/trivial.svg
--rw-r--r--   0 james      (501) staff       (20)     2451 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/images/unoverlapping-neighbors.svg
--rw-r--r--   0 james      (501) staff       (20)    12486 2024-02-09 15:39:56.000000 dask-2024.5.0/docs/source/index.rst
--rw-r--r--   0 james      (501) staff       (20)    15500 2024-03-13 20:06:34.000000 dask-2024.5.0/docs/source/install.rst
--rw-r--r--   0 james      (501) staff       (20)      341 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/internals.rst
--rw-r--r--   0 james      (501) staff       (20)      868 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/logos.rst
--rw-r--r--   0 james      (501) staff       (20)     3573 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/maintainers.rst
--rw-r--r--   0 james      (501) staff       (20)    12200 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/optimize.rst
--rw-r--r--   0 james      (501) staff       (20)     7119 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/order.rst
--rw-r--r--   0 james      (501) staff       (20)     4810 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/phases-of-computation.rst
--rw-r--r--   0 james      (501) staff       (20)      857 2023-12-07 19:39:17.000000 dask-2024.5.0/docs/source/presentations.rst
--rw-r--r--   0 james      (501) staff       (20)      868 2023-12-13 17:43:46.000000 dask-2024.5.0/docs/source/prometheus.rst
--rw-r--r--   0 james      (501) staff       (20)     6010 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/scheduler-overview.rst
--rw-r--r--   0 james      (501) staff       (20)     4493 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/scheduling-policy.rst
--rw-r--r--   0 james      (501) staff       (20)    11015 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/scheduling.rst
-drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-03 21:18:47.399399 dask-2024.5.0/docs/source/scripts/
--rw-r--r--   0 james      (501) staff       (20)     3294 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/scripts/scheduling.py
--rw-r--r--   0 james      (501) staff       (20)     6104 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/shared.rst
--rw-r--r--   0 james      (501) staff       (20)     4562 2023-12-13 17:43:46.000000 dask-2024.5.0/docs/source/software-environments.rst
--rw-r--r--   0 james      (501) staff       (20)     9342 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/spark.rst
--rw-r--r--   0 james      (501) staff       (20)     3967 2023-09-13 17:55:33.000000 dask-2024.5.0/docs/source/spec.rst
--rw-r--r--   0 james      (501) staff       (20)     4754 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/support.rst
--rw-r--r--   0 james      (501) staff       (20)     1831 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/understanding-performance.rst
--rw-r--r--   0 james      (501) staff       (20)    12205 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/user-interfaces.rst
--rw-r--r--   0 james      (501) staff       (20)    11744 2023-07-17 19:15:27.000000 dask-2024.5.0/docs/source/why.rst
--rw-r--r--   0 james      (501) staff       (20)     7059 2024-05-03 21:03:22.000000 dask-2024.5.0/pyproject.toml
--rw-r--r--   0 james      (501) staff       (20)       38 2024-05-03 21:18:47.401592 dask-2024.5.0/setup.cfg
--rwxr-xr-x   0 james      (501) staff       (20)      194 2023-07-17 19:15:27.000000 dask-2024.5.0/setup.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.385942 dask-2024.5.1/
+-rw-r--r--   0 james      (501) staff       (20)     1531 2023-07-17 19:15:27.000000 dask-2024.5.1/LICENSE.txt
+-rw-r--r--   0 james      (501) staff       (20)      325 2023-07-17 19:15:27.000000 dask-2024.5.1/MANIFEST.in
+-rw-r--r--   0 james      (501) staff       (20)     3780 2024-05-17 20:11:37.385666 dask-2024.5.1/PKG-INFO
+-rw-r--r--   0 james      (501) staff       (20)     1291 2023-07-17 19:15:27.000000 dask-2024.5.1/README.rst
+-rw-r--r--   0 james      (501) staff       (20)     1598 2024-01-23 19:42:07.000000 dask-2024.5.1/conftest.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.237964 dask-2024.5.1/dask/
+-rw-r--r--   0 james      (501) staff       (20)      485 2023-08-21 21:39:12.000000 dask-2024.5.1/dask/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)      133 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/__main__.py
+-rw-r--r--   0 james      (501) staff       (20)      720 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/_compatibility.py
+-rw-r--r--   0 james      (501) staff       (20)      500 2024-05-17 20:11:37.386114 dask-2024.5.1/dask/_version.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.260389 dask-2024.5.1/dask/array/
+-rw-r--r--   0 james      (501) staff       (20)     1543 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/array/NUMPY_LICENSE.txt
+-rw-r--r--   0 james      (501) staff       (20)     5413 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    12600 2023-12-20 15:38:57.000000 dask-2024.5.1/dask/array/backends.py
+-rw-r--r--   0 james      (501) staff       (20)     9983 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/blockwise.py
+-rw-r--r--   0 james      (501) staff       (20)    12304 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/chunk.py
+-rw-r--r--   0 james      (501) staff       (20)     5066 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/chunk_types.py
+-rw-r--r--   0 james      (501) staff       (20)   191411 2024-05-14 20:42:42.000000 dask-2024.5.1/dask/array/core.py
+-rw-r--r--   0 james      (501) staff       (20)    40586 2024-05-08 15:19:27.000000 dask-2024.5.1/dask/array/creation.py
+-rw-r--r--   0 james      (501) staff       (20)     2114 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/cupy_entry_point.py
+-rw-r--r--   0 james      (501) staff       (20)      526 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/dispatch.py
+-rw-r--r--   0 james      (501) staff       (20)     9146 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/einsumfuncs.py
+-rw-r--r--   0 james      (501) staff       (20)     7677 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/array/fft.py
+-rw-r--r--   0 james      (501) staff       (20)    32656 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/gufunc.py
+-rw-r--r--   0 james      (501) staff       (20)     1996 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/image.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.261094 dask-2024.5.1/dask/array/lib/
+-rw-r--r--   0 james      (501) staff       (20)       77 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/lib/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)      101 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/lib/stride_tricks.py
+-rw-r--r--   0 james      (501) staff       (20)    53218 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/array/linalg.py
+-rw-r--r--   0 james      (501) staff       (20)     6363 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/ma.py
+-rw-r--r--   0 james      (501) staff       (20)     6078 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/array/numpy_compat.py
+-rw-r--r--   0 james      (501) staff       (20)    12838 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/optimization.py
+-rw-r--r--   0 james      (501) staff       (20)    28475 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/array/overlap.py
+-rw-r--r--   0 james      (501) staff       (20)    10925 2024-04-19 20:50:02.000000 dask-2024.5.1/dask/array/percentile.py
+-rw-r--r--   0 james      (501) staff       (20)    40605 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/random.py
+-rw-r--r--   0 james      (501) staff       (20)    28323 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/rechunk.py
+-rw-r--r--   0 james      (501) staff       (20)    58469 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/reductions.py
+-rw-r--r--   0 james      (501) staff       (20)    10766 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/reshape.py
+-rw-r--r--   0 james      (501) staff       (20)    81768 2024-05-08 15:19:27.000000 dask-2024.5.1/dask/array/routines.py
+-rw-r--r--   0 james      (501) staff       (20)    73048 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/array/slicing.py
+-rw-r--r--   0 james      (501) staff       (20)    16184 2023-08-21 21:39:12.000000 dask-2024.5.1/dask/array/stats.py
+-rw-r--r--   0 james      (501) staff       (20)     8048 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/svg.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.273317 dask-2024.5.1/dask/array/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/array/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)   163024 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/array/tests/test_array_core.py
+-rw-r--r--   0 james      (501) staff       (20)     6858 2024-05-17 19:47:46.000000 dask-2024.5.1/dask/array/tests/test_array_function.py
+-rw-r--r--   0 james      (501) staff       (20)     3159 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_array_utils.py
+-rw-r--r--   0 james      (501) staff       (20)    23222 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_atop.py
+-rw-r--r--   0 james      (501) staff       (20)     3304 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_chunk.py
+-rw-r--r--   0 james      (501) staff       (20)    31191 2024-05-08 15:19:27.000000 dask-2024.5.1/dask/array/tests/test_creation.py
+-rw-r--r--   0 james      (501) staff       (20)    19888 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_cupy_core.py
+-rw-r--r--   0 james      (501) staff       (20)     6496 2023-10-25 14:44:16.000000 dask-2024.5.1/dask/array/tests/test_cupy_creation.py
+-rw-r--r--   0 james      (501) staff       (20)      594 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_cupy_gufunc.py
+-rw-r--r--   0 james      (501) staff       (20)    13412 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_cupy_linalg.py
+-rw-r--r--   0 james      (501) staff       (20)     4303 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_cupy_overlap.py
+-rw-r--r--   0 james      (501) staff       (20)     2730 2024-03-13 20:06:30.000000 dask-2024.5.1/dask/array/tests/test_cupy_percentile.py
+-rw-r--r--   0 james      (501) staff       (20)     9219 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_cupy_random.py
+-rw-r--r--   0 james      (501) staff       (20)     2224 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_cupy_reductions.py
+-rw-r--r--   0 james      (501) staff       (20)     7436 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/tests/test_cupy_routines.py
+-rw-r--r--   0 james      (501) staff       (20)     4877 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_cupy_slicing.py
+-rw-r--r--   0 james      (501) staff       (20)     2982 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_cupy_sparse.py
+-rw-r--r--   0 james      (501) staff       (20)     8866 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/tests/test_dispatch.py
+-rw-r--r--   0 james      (501) staff       (20)     8821 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/array/tests/test_fft.py
+-rw-r--r--   0 james      (501) staff       (20)    21013 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_gufunc.py
+-rw-r--r--   0 james      (501) staff       (20)     1482 2023-09-28 22:08:27.000000 dask-2024.5.1/dask/array/tests/test_image.py
+-rw-r--r--   0 james      (501) staff       (20)    37415 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/array/tests/test_linalg.py
+-rw-r--r--   0 james      (501) staff       (20)    15714 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/array/tests/test_masked.py
+-rw-r--r--   0 james      (501) staff       (20)     1087 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_numpy_compat.py
+-rw-r--r--   0 james      (501) staff       (20)    17446 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_optimization.py
+-rw-r--r--   0 james      (501) staff       (20)    26718 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_overlap.py
+-rw-r--r--   0 james      (501) staff       (20)     3443 2023-11-07 18:15:20.000000 dask-2024.5.1/dask/array/tests/test_percentiles.py
+-rw-r--r--   0 james      (501) staff       (20)    15352 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/array/tests/test_random.py
+-rw-r--r--   0 james      (501) staff       (20)    36568 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/array/tests/test_rechunk.py
+-rw-r--r--   0 james      (501) staff       (20)    33283 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/array/tests/test_reductions.py
+-rw-r--r--   0 james      (501) staff       (20)     7289 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_reshape.py
+-rw-r--r--   0 james      (501) staff       (20)    84472 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/array/tests/test_routines.py
+-rw-r--r--   0 james      (501) staff       (20)    32264 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/array/tests/test_slicing.py
+-rw-r--r--   0 james      (501) staff       (20)     6592 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_sparse.py
+-rw-r--r--   0 james      (501) staff       (20)     5489 2023-09-28 22:08:27.000000 dask-2024.5.1/dask/array/tests/test_stats.py
+-rw-r--r--   0 james      (501) staff       (20)     2740 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_svg.py
+-rw-r--r--   0 james      (501) staff       (20)      525 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_testing.py
+-rw-r--r--   0 james      (501) staff       (20)    17390 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_ufunc.py
+-rw-r--r--   0 james      (501) staff       (20)     2706 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_wrap.py
+-rw-r--r--   0 james      (501) staff       (20)     1317 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tests/test_xarray.py
+-rw-r--r--   0 james      (501) staff       (20)     4737 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/tiledb_io.py
+-rw-r--r--   0 james      (501) staff       (20)    10030 2024-03-13 20:06:30.000000 dask-2024.5.1/dask/array/ufunc.py
+-rw-r--r--   0 james      (501) staff       (20)    19112 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/array/utils.py
+-rw-r--r--   0 james      (501) staff       (20)     6906 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/array/wrap.py
+-rw-r--r--   0 james      (501) staff       (20)     5122 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/backends.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.274938 dask-2024.5.1/dask/bag/
+-rw-r--r--   0 james      (501) staff       (20)      903 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     9111 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/avro.py
+-rw-r--r--   0 james      (501) staff       (20)      763 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/chunk.py
+-rw-r--r--   0 james      (501) staff       (20)    86045 2024-04-19 20:50:02.000000 dask-2024.5.1/dask/bag/core.py
+-rw-r--r--   0 james      (501) staff       (20)     5464 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/random.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.276091 dask-2024.5.1/dask/bag/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/bag/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     3808 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/tests/test_avro.py
+-rw-r--r--   0 james      (501) staff       (20)    52816 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/bag/tests/test_bag.py
+-rw-r--r--   0 james      (501) staff       (20)     6528 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/tests/test_random.py
+-rw-r--r--   0 james      (501) staff       (20)     5049 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/tests/test_text.py
+-rw-r--r--   0 james      (501) staff       (20)     6765 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/text.py
+-rw-r--r--   0 james      (501) staff       (20)      241 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bag/utils.py
+-rw-r--r--   0 james      (501) staff       (20)    54892 2024-04-01 19:10:34.000000 dask-2024.5.1/dask/base.py
+-rw-r--r--   0 james      (501) staff       (20)    53276 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/blockwise.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.276567 dask-2024.5.1/dask/bytes/
+-rw-r--r--   0 james      (501) staff       (20)       75 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bytes/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     6933 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bytes/core.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.277705 dask-2024.5.1/dask/bytes/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/bytes/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     5158 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bytes/tests/test_bytes_utils.py
+-rw-r--r--   0 james      (501) staff       (20)      530 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bytes/tests/test_compression.py
+-rw-r--r--   0 james      (501) staff       (20)     6815 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/bytes/tests/test_http.py
+-rw-r--r--   0 james      (501) staff       (20)    11464 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/bytes/tests/test_local.py
+-rw-r--r--   0 james      (501) staff       (20)    19703 2024-05-14 20:42:42.000000 dask-2024.5.1/dask/bytes/tests/test_s3.py
+-rw-r--r--   0 james      (501) staff       (20)      500 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/bytes/utils.py
+-rw-r--r--   0 james      (501) staff       (20)     1985 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/cache.py
+-rw-r--r--   0 james      (501) staff       (20)     4067 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/callbacks.py
+-rw-r--r--   0 james      (501) staff       (20)     5773 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/cli.py
+-rw-r--r--   0 james      (501) staff       (20)      523 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/compatibility.py
+-rw-r--r--   0 james      (501) staff       (20)    24786 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/config.py
+-rw-r--r--   0 james      (501) staff       (20)      959 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/conftest.py
+-rw-r--r--   0 james      (501) staff       (20)     1756 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/context.py
+-rw-r--r--   0 james      (501) staff       (20)    15772 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/core.py
+-rw-r--r--   0 james      (501) staff       (20)     8149 2024-04-19 20:50:02.000000 dask-2024.5.1/dask/dask-schema.yaml
+-rw-r--r--   0 james      (501) staff       (20)     1992 2024-04-19 20:50:02.000000 dask-2024.5.1/dask/dask.yaml
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.285843 dask-2024.5.1/dask/dataframe/
+-rw-r--r--   0 james      (501) staff       (20)     5465 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/dataframe/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     7642 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/_compat.py
+-rw-r--r--   0 james      (501) staff       (20)     2171 2023-08-21 21:39:12.000000 dask-2024.5.1/dask/dataframe/_dtypes.py
+-rw-r--r--   0 james      (501) staff       (20)     3974 2024-02-06 16:03:46.000000 dask-2024.5.1/dask/dataframe/_pyarrow.py
+-rw-r--r--   0 james      (501) staff       (20)     2743 2023-11-10 20:46:15.000000 dask-2024.5.1/dask/dataframe/_pyarrow_compat.py
+-rw-r--r--   0 james      (501) staff       (20)      393 2024-01-25 18:24:19.000000 dask-2024.5.1/dask/dataframe/_testing.py
+-rw-r--r--   0 james      (501) staff       (20)    13540 2024-04-19 20:50:02.000000 dask-2024.5.1/dask/dataframe/accessor.py
+-rw-r--r--   0 james      (501) staff       (20)    25943 2024-04-19 20:50:02.000000 dask-2024.5.1/dask/dataframe/backends.py
+-rw-r--r--   0 james      (501) staff       (20)     9507 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/categorical.py
+-rw-r--r--   0 james      (501) staff       (20)   314038 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/core.py
+-rw-r--r--   0 james      (501) staff       (20)     4577 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/dispatch.py
+-rw-r--r--   0 james      (501) staff       (20)      552 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/extensions.py
+-rw-r--r--   0 james      (501) staff       (20)   117451 2024-04-01 19:10:34.000000 dask-2024.5.1/dask/dataframe/groupby.py
+-rw-r--r--   0 james      (501) staff       (20)     2463 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/hyperloglog.py
+-rw-r--r--   0 james      (501) staff       (20)    13412 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/indexing.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.288256 dask-2024.5.1/dask/dataframe/io/
+-rw-r--r--   0 james      (501) staff       (20)      706 2023-09-25 17:06:23.000000 dask-2024.5.1/dask/dataframe/io/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    34437 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/io/csv.py
+-rw-r--r--   0 james      (501) staff       (20)    18830 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/io/demo.py
+-rw-r--r--   0 james      (501) staff       (20)    18384 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/dataframe/io/hdf.py
+-rw-r--r--   0 james      (501) staff       (20)    38600 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/io/io.py
+-rw-r--r--   0 james      (501) staff       (20)    11115 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/dataframe/io/json.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.289082 dask-2024.5.1/dask/dataframe/io/orc/
+-rw-r--r--   0 james      (501) staff       (20)       92 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/io/orc/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     4487 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/io/orc/arrow.py
+-rw-r--r--   0 james      (501) staff       (20)     7183 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/dataframe/io/orc/core.py
+-rw-r--r--   0 james      (501) staff       (20)      510 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/io/orc/utils.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.290456 dask-2024.5.1/dask/dataframe/io/parquet/
+-rw-r--r--   0 james      (501) staff       (20)      166 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/io/parquet/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    72803 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/io/parquet/arrow.py
+-rw-r--r--   0 james      (501) staff       (20)    67054 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/io/parquet/core.py
+-rw-r--r--   0 james      (501) staff       (20)    52314 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/io/parquet/fastparquet.py
+-rw-r--r--   0 james      (501) staff       (20)    32900 2023-10-27 21:32:35.000000 dask-2024.5.1/dask/dataframe/io/parquet/utils.py
+-rw-r--r--   0 james      (501) staff       (20)    21270 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/io/sql.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.295648 dask-2024.5.1/dask/dataframe/io/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/dataframe/io/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    61862 2024-05-17 19:47:39.000000 dask-2024.5.1/dask/dataframe/io/tests/test_csv.py
+-rw-r--r--   0 james      (501) staff       (20)    11436 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/io/tests/test_demo.py
+-rw-r--r--   0 james      (501) staff       (20)    27324 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/dataframe/io/tests/test_hdf.py
+-rw-r--r--   0 james      (501) staff       (20)    35669 2024-04-29 18:30:10.000000 dask-2024.5.1/dask/dataframe/io/tests/test_io.py
+-rw-r--r--   0 james      (501) staff       (20)     8812 2023-09-21 15:09:09.000000 dask-2024.5.1/dask/dataframe/io/tests/test_json.py
+-rw-r--r--   0 james      (501) staff       (20)     5322 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/dataframe/io/tests/test_orc.py
+-rw-r--r--   0 james      (501) staff       (20)   165729 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/dataframe/io/tests/test_parquet.py
+-rw-r--r--   0 james      (501) staff       (20)    17743 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/dataframe/io/tests/test_sql.py
+-rw-r--r--   0 james      (501) staff       (20)     8041 2023-08-21 21:39:12.000000 dask-2024.5.1/dask/dataframe/io/utils.py
+-rw-r--r--   0 james      (501) staff       (20)    14713 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/dataframe/methods.py
+-rw-r--r--   0 james      (501) staff       (20)    55455 2024-02-09 22:36:17.000000 dask-2024.5.1/dask/dataframe/multi.py
+-rw-r--r--   0 james      (501) staff       (20)     1600 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/numeric.py
+-rw-r--r--   0 james      (501) staff       (20)     8780 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/optimize.py
+-rw-r--r--   0 james      (501) staff       (20)    21162 2024-05-07 16:00:29.000000 dask-2024.5.1/dask/dataframe/partitionquantiles.py
+-rw-r--r--   0 james      (501) staff       (20)    11868 2023-10-27 21:32:31.000000 dask-2024.5.1/dask/dataframe/reshape.py
+-rw-r--r--   0 james      (501) staff       (20)    22170 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/rolling.py
+-rw-r--r--   0 james      (501) staff       (20)    40190 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/shuffle.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.303911 dask-2024.5.1/dask/dataframe/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/dataframe/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    11131 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/tests/test_accessors.py
+-rw-r--r--   0 james      (501) staff       (20)    71041 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/dataframe/tests/test_arithmetics_reduction.py
+-rw-r--r--   0 james      (501) staff       (20)      942 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/tests/test_boolean.py
+-rw-r--r--   0 james      (501) staff       (20)    18249 2024-04-25 02:58:16.000000 dask-2024.5.1/dask/dataframe/tests/test_categorical.py
+-rw-r--r--   0 james      (501) staff       (20)   208743 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/dataframe/tests/test_dataframe.py
+-rw-r--r--   0 james      (501) staff       (20)     1457 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/tests/test_extensions.py
+-rw-r--r--   0 james      (501) staff       (20)    14847 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/dataframe/tests/test_format.py
+-rw-r--r--   0 james      (501) staff       (20)   127578 2024-05-14 20:42:42.000000 dask-2024.5.1/dask/dataframe/tests/test_groupby.py
+-rw-r--r--   0 james      (501) staff       (20)     2702 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dataframe/tests/test_hashing.py
+-rw-r--r--   0 james      (501) staff       (20)     2897 2024-01-30 19:27:46.000000 dask-2024.5.1/dask/dataframe/tests/test_hyperloglog.py
+-rw-r--r--   0 james      (501) staff       (20)    23962 2024-05-17 19:38:56.000000 dask-2024.5.1/dask/dataframe/tests/test_indexing.py
+-rw-r--r--   0 james      (501) staff       (20)     7990 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/dataframe/tests/test_merge_column_and_index.py
+-rw-r--r--   0 james      (501) staff       (20)      463 2023-08-21 21:39:12.000000 dask-2024.5.1/dask/dataframe/tests/test_methods.py
+-rw-r--r--   0 james      (501) staff       (20)    96692 2024-05-14 20:42:42.000000 dask-2024.5.1/dask/dataframe/tests/test_multi.py
+-rw-r--r--   0 james      (501) staff       (20)     2624 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/tests/test_numeric.py
+-rw-r--r--   0 james      (501) staff       (20)     1188 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/dataframe/tests/test_optimize_dataframe.py
+-rw-r--r--   0 james      (501) staff       (20)     6662 2023-09-25 17:06:24.000000 dask-2024.5.1/dask/dataframe/tests/test_pyarrow.py
+-rw-r--r--   0 james      (501) staff       (20)     5059 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/tests/test_pyarrow_compat.py
+-rw-r--r--   0 james      (501) staff       (20)    11551 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/dataframe/tests/test_reshape.py
+-rw-r--r--   0 james      (501) staff       (20)    18504 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/tests/test_rolling.py
+-rw-r--r--   0 james      (501) staff       (20)    63402 2024-04-19 20:50:02.000000 dask-2024.5.1/dask/dataframe/tests/test_shuffle.py
+-rw-r--r--   0 james      (501) staff       (20)    16922 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/dataframe/tests/test_ufunc.py
+-rw-r--r--   0 james      (501) staff       (20)    22240 2024-04-01 19:10:34.000000 dask-2024.5.1/dask/dataframe/tests/test_utils_dataframe.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.304410 dask-2024.5.1/dask/dataframe/tseries/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/dataframe/tseries/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     7675 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/dataframe/tseries/resample.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.304763 dask-2024.5.1/dask/dataframe/tseries/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/dataframe/tseries/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)     7028 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/dataframe/tseries/tests/test_resample.py
+-rw-r--r--   0 james      (501) staff       (20)    27545 2024-04-25 02:58:16.000000 dask-2024.5.1/dask/dataframe/utils.py
+-rw-r--r--   0 james      (501) staff       (20)     5331 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/datasets.py
+-rw-r--r--   0 james      (501) staff       (20)    24814 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/delayed.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.305687 dask-2024.5.1/dask/diagnostics/
+-rw-r--r--   0 james      (501) staff       (20)      258 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/diagnostics/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    12136 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/diagnostics/profile.py
+-rw-r--r--   0 james      (501) staff       (20)    16332 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/diagnostics/profile_visualize.py
+-rw-r--r--   0 james      (501) staff       (20)     5001 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/diagnostics/progress.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.306141 dask-2024.5.1/dask/diagnostics/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/diagnostics/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)    12045 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/diagnostics/tests/test_profiler.py
+-rw-r--r--   0 james      (501) staff       (20)     3421 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/diagnostics/tests/test_progress.py
+-rw-r--r--   0 james      (501) staff       (20)      715 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/distributed.py
+-rw-r--r--   0 james      (501) staff       (20)    16587 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/dot.py
+-rw-r--r--   0 james      (501) staff       (20)    19622 2023-10-25 14:44:16.000000 dask-2024.5.1/dask/graph_manipulation.py
+-rw-r--r--   0 james      (501) staff       (20)     2492 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/hashing.py
+-rw-r--r--   0 james      (501) staff       (20)    35516 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/highlevelgraph.py
+-rw-r--r--   0 james      (501) staff       (20)    46004 2023-09-13 17:55:33.000000 dask-2024.5.1/dask/layers.py
+-rw-r--r--   0 james      (501) staff       (20)    18896 2023-09-13 17:55:33.000000 dask-2024.5.1/dask/local.py
+-rw-r--r--   0 james      (501) staff       (20)      487 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/ml.py
+-rw-r--r--   0 james      (501) staff       (20)     8474 2023-09-13 17:55:33.000000 dask-2024.5.1/dask/multiprocessing.py
+-rw-r--r--   0 james      (501) staff       (20)    36224 2024-02-09 15:39:56.000000 dask-2024.5.1/dask/optimization.py
+-rw-r--r--   0 james      (501) staff       (20)    32839 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/order.py
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/py.typed
+-rw-r--r--   0 james      (501) staff       (20)    12597 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/rewrite.py
+-rw-r--r--   0 james      (501) staff       (20)     7621 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/sizeof.py
+-rw-r--r--   0 james      (501) staff       (20)     2089 2023-08-21 21:39:12.000000 dask-2024.5.1/dask/system.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.316124 dask-2024.5.1/dask/tests/
+-rw-r--r--   0 james      (501) staff       (20)        0 2023-07-17 19:15:13.000000 dask-2024.5.1/dask/tests/__init__.py
+-rw-r--r--   0 james      (501) staff       (20)      824 2024-01-23 19:42:07.000000 dask-2024.5.1/dask/tests/test_backends.py
+-rw-r--r--   0 james      (501) staff       (20)    33246 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_base.py
+-rw-r--r--   0 james      (501) staff       (20)     1646 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_cache.py
+-rw-r--r--   0 james      (501) staff       (20)     2570 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_callbacks.py
+-rw-r--r--   0 james      (501) staff       (20)     1224 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/tests/test_ci.py
+-rw-r--r--   0 james      (501) staff       (20)     7488 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/tests/test_cli.py
+-rw-r--r--   0 james      (501) staff       (20)      379 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_compatibility.py
+-rw-r--r--   0 james      (501) staff       (20)    20268 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/tests/test_config.py
+-rw-r--r--   0 james      (501) staff       (20)     1170 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_context.py
+-rw-r--r--   0 james      (501) staff       (20)     8203 2024-01-23 19:42:03.000000 dask-2024.5.1/dask/tests/test_core.py
+-rw-r--r--   0 james      (501) staff       (20)     1112 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_datasets.py
+-rw-r--r--   0 james      (501) staff       (20)    23062 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_delayed.py
+-rw-r--r--   0 james      (501) staff       (20)    34962 2024-05-14 20:42:42.000000 dask-2024.5.1/dask/tests/test_distributed.py
+-rw-r--r--   0 james      (501) staff       (20)      719 2024-03-13 20:06:30.000000 dask-2024.5.1/dask/tests/test_docs.py
+-rw-r--r--   0 james      (501) staff       (20)    12271 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_dot.py
+-rw-r--r--   0 james      (501) staff       (20)    15338 2024-01-29 17:27:45.000000 dask-2024.5.1/dask/tests/test_graph_manipulation.py
+-rw-r--r--   0 james      (501) staff       (20)     1095 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_hashing.py
+-rw-r--r--   0 james      (501) staff       (20)     9396 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_highgraph.py
+-rw-r--r--   0 james      (501) staff       (20)     9172 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_layers.py
+-rw-r--r--   0 james      (501) staff       (20)     5055 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_local.py
+-rw-r--r--   0 james      (501) staff       (20)      419 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_ml.py
+-rw-r--r--   0 james      (501) staff       (20)     8457 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_multiprocessing.py
+-rw-r--r--   0 james      (501) staff       (20)    47821 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/tests/test_optimization.py
+-rw-r--r--   0 james      (501) staff       (20)    69857 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_order.py
+-rw-r--r--   0 james      (501) staff       (20)     4684 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_rewrite.py
+-rw-r--r--   0 james      (501) staff       (20)     7526 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/tests/test_sizeof.py
+-rw-r--r--   0 james      (501) staff       (20)     7258 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_spark_compat.py
+-rw-r--r--   0 james      (501) staff       (20)     2571 2023-08-21 21:39:12.000000 dask-2024.5.1/dask/tests/test_system.py
+-rw-r--r--   0 james      (501) staff       (20)     4749 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_threaded.py
+-rw-r--r--   0 james      (501) staff       (20)    39981 2024-05-08 15:40:38.000000 dask-2024.5.1/dask/tests/test_tokenize.py
+-rw-r--r--   0 james      (501) staff       (20)     4591 2023-09-15 13:43:23.000000 dask-2024.5.1/dask/tests/test_traceback.py
+-rw-r--r--   0 james      (501) staff       (20)     5767 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_typing.py
+-rw-r--r--   0 james      (501) staff       (20)    23675 2024-05-03 20:22:03.000000 dask-2024.5.1/dask/tests/test_utils.py
+-rw-r--r--   0 james      (501) staff       (20)     1598 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/test_utils_test.py
+-rw-r--r--   0 james      (501) staff       (20)      211 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/tests/warning_aliases.py
+-rw-r--r--   0 james      (501) staff       (20)     3001 2023-09-13 17:55:33.000000 dask-2024.5.1/dask/threaded.py
+-rw-r--r--   0 james      (501) staff       (20)    15497 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/typing.py
+-rw-r--r--   0 james      (501) staff       (20)    63637 2024-03-13 20:06:34.000000 dask-2024.5.1/dask/utils.py
+-rw-r--r--   0 james      (501) staff       (20)     4825 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/utils_test.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.316568 dask-2024.5.1/dask/widgets/
+-rw-r--r--   0 james      (501) staff       (20)      792 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/__init__.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.317397 dask-2024.5.1/dask/widgets/templates/
+-rw-r--r--   0 james      (501) staff       (20)     1295 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/templates/array.html.j2
+-rw-r--r--   0 james      (501) staff       (20)      124 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/templates/dataframe.html.j2
+-rw-r--r--   0 james      (501) staff       (20)     2579 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/templates/highlevelgraph.html.j2
+-rw-r--r--   0 james      (501) staff       (20)     1981 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/templates/highlevelgraph_layer.html.j2
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.317552 dask-2024.5.1/dask/widgets/tests/
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.318000 dask-2024.5.1/dask/widgets/tests/templates/
+-rw-r--r--   0 james      (501) staff       (20)       38 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/tests/templates/bytes.html.j2
+-rw-r--r--   0 james      (501) staff       (20)       39 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/tests/templates/custom_filter.html.j2
+-rw-r--r--   0 james      (501) staff       (20)       30 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/tests/templates/example.html.j2
+-rw-r--r--   0 james      (501) staff       (20)     1401 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/tests/test_widgets.py
+-rw-r--r--   0 james      (501) staff       (20)     1120 2023-07-17 19:15:27.000000 dask-2024.5.1/dask/widgets/widgets.py
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.384222 dask-2024.5.1/dask.egg-info/
+-rw-r--r--   0 james      (501) staff       (20)     3780 2024-05-17 20:11:37.000000 dask-2024.5.1/dask.egg-info/PKG-INFO
+-rw-r--r--   0 james      (501) staff       (20)    14539 2024-05-17 20:11:37.000000 dask-2024.5.1/dask.egg-info/SOURCES.txt
+-rw-r--r--   0 james      (501) staff       (20)        1 2024-05-17 20:11:37.000000 dask-2024.5.1/dask.egg-info/dependency_links.txt
+-rw-r--r--   0 james      (501) staff       (20)      124 2024-05-17 20:11:37.000000 dask-2024.5.1/dask.egg-info/entry_points.txt
+-rw-r--r--   0 james      (501) staff       (20)        1 2024-05-17 20:11:36.000000 dask-2024.5.1/dask.egg-info/not-zip-safe
+-rw-r--r--   0 james      (501) staff       (20)      532 2024-05-17 20:11:37.000000 dask-2024.5.1/dask.egg-info/requires.txt
+-rw-r--r--   0 james      (501) staff       (20)        5 2024-05-17 20:11:37.000000 dask-2024.5.1/dask.egg-info/top_level.txt
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.318309 dask-2024.5.1/docs/
+-rw-r--r--   0 james      (501) staff       (20)     5741 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/Makefile
+-rw-r--r--   0 james      (501) staff       (20)     5186 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/make.bat
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.341173 dask-2024.5.1/docs/source/
+-rw-r--r--   0 james      (501) staff       (20)    17900 2024-01-23 19:42:03.000000 dask-2024.5.1/docs/source/10-minutes-to-dask.rst
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.343382 dask-2024.5.1/docs/source/_static/
+-rw-r--r--   0 james      (501) staff       (20)    10187 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_static/config_converter.js
+-rw-r--r--   0 james      (501) staff       (20)    11021 2023-07-17 19:15:13.000000 dask-2024.5.1/docs/source/_static/dask-simple.png
+-rw-r--r--   0 james      (501) staff       (20)     2375 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_static/main-page.css
+-rw-r--r--   0 james      (501) staff       (20)    15598 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_static/profile.html
+-rw-r--r--   0 james      (501) staff       (20)    65304 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_static/stacked_profile.html
+-rw-r--r--   0 james      (501) staff       (20)      523 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_static/style.css
+-rw-r--r--   0 james      (501) staff       (20)      365 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_static/theme_overrides.css
+-rw-r--r--   0 james      (501) staff       (20)   292662 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_static/transpose_cyto.html
+-rw-r--r--   0 james      (501) staff       (20)    49423 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_static/yaml.min.js
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.343886 dask-2024.5.1/docs/source/_templates/
+-rw-r--r--   0 james      (501) staff       (20)      180 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/_templates/layout.html
+-rw-r--r--   0 james      (501) staff       (20)     4349 2023-12-13 17:43:46.000000 dask-2024.5.1/docs/source/adaptive.rst
+-rw-r--r--   0 james      (501) staff       (20)     3109 2023-08-21 21:39:12.000000 dask-2024.5.1/docs/source/api.rst
+-rw-r--r--   0 james      (501) staff       (20)     7189 2023-08-21 21:39:12.000000 dask-2024.5.1/docs/source/array-api.rst
+-rw-r--r--   0 james      (501) staff       (20)     2943 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-assignment.rst
+-rw-r--r--   0 james      (501) staff       (20)     4740 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-best-practices.rst
+-rw-r--r--   0 james      (501) staff       (20)    13262 2023-08-21 21:39:12.000000 dask-2024.5.1/docs/source/array-chunks.rst
+-rw-r--r--   0 james      (501) staff       (20)    18437 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-creation.rst
+-rw-r--r--   0 james      (501) staff       (20)     5885 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-design.rst
+-rw-r--r--   0 james      (501) staff       (20)     2857 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-gufunc.rst
+-rw-r--r--   0 james      (501) staff       (20)    21469 2023-08-21 21:39:12.000000 dask-2024.5.1/docs/source/array-numpy-compatibility.rst
+-rw-r--r--   0 james      (501) staff       (20)     6069 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-overlap.rst
+-rw-r--r--   0 james      (501) staff       (20)     3924 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-random.rst
+-rw-r--r--   0 james      (501) staff       (20)     4137 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-slicing.rst
+-rw-r--r--   0 james      (501) staff       (20)     3291 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-sparse.rst
+-rw-r--r--   0 james      (501) staff       (20)     2018 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-stack.rst
+-rw-r--r--   0 james      (501) staff       (20)     1140 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/array-stats.rst
+-rw-r--r--   0 james      (501) staff       (20)     4154 2023-08-21 21:39:12.000000 dask-2024.5.1/docs/source/array.rst
+-rw-r--r--   0 james      (501) staff       (20)     1574 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/bag-api.rst
+-rw-r--r--   0 james      (501) staff       (20)     4557 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/bag-creation.rst
+-rw-r--r--   0 james      (501) staff       (20)     4068 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/bag.rst
+-rw-r--r--   0 james      (501) staff       (20)    14042 2024-01-23 19:42:03.000000 dask-2024.5.1/docs/source/best-practices.rst
+-rw-r--r--   0 james      (501) staff       (20)     5553 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/caching.rst
+-rw-r--r--   0 james      (501) staff       (20)   375351 2024-05-17 20:09:51.000000 dask-2024.5.1/docs/source/changelog.rst
+-rw-r--r--   0 james      (501) staff       (20)      211 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/cheatsheet.rst
+-rw-r--r--   0 james      (501) staff       (20)     4047 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/cli.rst
+-rw-r--r--   0 james      (501) staff       (20)    15912 2024-05-17 17:50:41.000000 dask-2024.5.1/docs/source/conf.py
+-rw-r--r--   0 james      (501) staff       (20)    16945 2024-03-13 20:06:30.000000 dask-2024.5.1/docs/source/configuration.rst
+-rw-r--r--   0 james      (501) staff       (20)    18998 2024-03-13 20:06:30.000000 dask-2024.5.1/docs/source/custom-collections.rst
+-rw-r--r--   0 james      (501) staff       (20)     3604 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/custom-graphs.rst
+-rw-r--r--   0 james      (501) staff       (20)     4209 2023-12-13 17:43:46.000000 dask-2024.5.1/docs/source/customize-initialization.rst
+-rw-r--r--   0 james      (501) staff       (20)      932 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/dashboard-progress-script.py
+-rw-r--r--   0 james      (501) staff       (20)    15045 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/dashboard.rst
+-rw-r--r--   0 james      (501) staff       (20)   203552 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/daskcheatsheet.pdf
+-rw-r--r--   0 james      (501) staff       (20)    11002 2024-05-07 16:00:29.000000 dask-2024.5.1/docs/source/dataframe-api.rst
+-rw-r--r--   0 james      (501) staff       (20)     9530 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/dataframe-best-practices.rst
+-rw-r--r--   0 james      (501) staff       (20)     3951 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/dataframe-categoricals.rst
+-rw-r--r--   0 james      (501) staff       (20)     5977 2023-12-15 20:02:17.000000 dask-2024.5.1/docs/source/dataframe-create.rst
+-rw-r--r--   0 james      (501) staff       (20)     5711 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/dataframe-design.rst
+-rw-r--r--   0 james      (501) staff       (20)     6239 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/dataframe-extend.rst
+-rw-r--r--   0 james      (501) staff       (20)      423 2024-03-13 20:06:34.000000 dask-2024.5.1/docs/source/dataframe-extra.rst
+-rw-r--r--   0 james      (501) staff       (20)     8060 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/dataframe-groupby.rst
+-rw-r--r--   0 james      (501) staff       (20)     9351 2024-01-23 19:42:03.000000 dask-2024.5.1/docs/source/dataframe-hive.rst
+-rw-r--r--   0 james      (501) staff       (20)     6115 2023-10-25 14:44:16.000000 dask-2024.5.1/docs/source/dataframe-indexing.rst
+-rw-r--r--   0 james      (501) staff       (20)     3360 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/dataframe-joins.rst
+-rw-r--r--   0 james      (501) staff       (20)    13645 2024-03-13 20:06:34.000000 dask-2024.5.1/docs/source/dataframe-legacy-api.rst
+-rw-r--r--   0 james      (501) staff       (20)     3683 2024-05-03 20:22:03.000000 dask-2024.5.1/docs/source/dataframe-optimizer.rst
+-rw-r--r--   0 james      (501) staff       (20)    10547 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/dataframe-parquet.rst
+-rw-r--r--   0 james      (501) staff       (20)    12415 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/dataframe-sql.rst
+-rw-r--r--   0 james      (501) staff       (20)     6647 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/dataframe.rst
+-rw-r--r--   0 james      (501) staff       (20)      363 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/debugging-performance.rst
+-rw-r--r--   0 james      (501) staff       (20)     1696 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/delayed-api.rst
+-rw-r--r--   0 james      (501) staff       (20)    17616 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/delayed-best-practices.rst
+-rw-r--r--   0 james      (501) staff       (20)     1497 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/delayed-collections.rst
+-rw-r--r--   0 james      (501) staff       (20)     6357 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/delayed.rst
+-rw-r--r--   0 james      (501) staff       (20)     3620 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/deploying-cli.rst
+-rw-r--r--   0 james      (501) staff       (20)     4797 2024-01-26 23:05:40.000000 dask-2024.5.1/docs/source/deploying-cloud.rst
+-rw-r--r--   0 james      (501) staff       (20)     2868 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/deploying-docker.rst
+-rw-r--r--   0 james      (501) staff       (20)      246 2023-12-13 17:43:46.000000 dask-2024.5.1/docs/source/deploying-extra.rst
+-rw-r--r--   0 james      (501) staff       (20)     9939 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/deploying-hpc.rst
+-rw-r--r--   0 james      (501) staff       (20)     4001 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/deploying-kubernetes.rst
+-rw-r--r--   0 james      (501) staff       (20)     5823 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/deploying-python-advanced.rst
+-rw-r--r--   0 james      (501) staff       (20)     2839 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/deploying-python.rst
+-rw-r--r--   0 james      (501) staff       (20)     1619 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/deploying-ssh.rst
+-rw-r--r--   0 james      (501) staff       (20)     8213 2024-02-09 15:39:56.000000 dask-2024.5.1/docs/source/deploying.rst
+-rw-r--r--   0 james      (501) staff       (20)    10868 2023-12-14 20:19:54.000000 dask-2024.5.1/docs/source/deployment-considerations.rst
+-rw-r--r--   0 james      (501) staff       (20)    13137 2024-03-13 20:06:30.000000 dask-2024.5.1/docs/source/develop.rst
+-rw-r--r--   0 james      (501) staff       (20)     4442 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/diagnostics-distributed.rst
+-rw-r--r--   0 james      (501) staff       (20)    10407 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/diagnostics-local.rst
+-rw-r--r--   0 james      (501) staff       (20)     4548 2024-04-01 19:10:34.000000 dask-2024.5.1/docs/source/ecosystem.rst
+-rw-r--r--   0 james      (501) staff       (20)    18500 2023-12-13 17:43:46.000000 dask-2024.5.1/docs/source/faq.rst
+-rw-r--r--   0 james      (501) staff       (20)    25633 2024-02-01 17:01:41.000000 dask-2024.5.1/docs/source/futures.rst
+-rw-r--r--   0 james      (501) staff       (20)     5820 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/gpu.rst
+-rw-r--r--   0 james      (501) staff       (20)     2541 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/graph_manipulation.rst
+-rw-r--r--   0 james      (501) staff       (20)     5433 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/graphs.rst
+-rw-r--r--   0 james      (501) staff       (20)     5399 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/graphviz.rst
+-rw-r--r--   0 james      (501) staff       (20)     6946 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/high-level-graphs.rst
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.345091 dask-2024.5.1/docs/source/how-to/
+-rw-r--r--   0 james      (501) staff       (20)    15531 2024-04-01 19:10:34.000000 dask-2024.5.1/docs/source/how-to/connect-to-remote-data.rst
+-rw-r--r--   0 james      (501) staff       (20)    11477 2023-08-21 21:39:12.000000 dask-2024.5.1/docs/source/how-to/debug.rst
+-rw-r--r--   0 james      (501) staff       (20)     1722 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/how-to/extend-sizeof.rst
+-rw-r--r--   0 james      (501) staff       (20)      433 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/how-to/index.rst
+-rw-r--r--   0 james      (501) staff       (20)     6682 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/how-to/selecting-the-collection-backend.rst
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.382438 dask-2024.5.1/docs/source/images/
+-rw-r--r--   0 james      (501) staff       (20)    99565 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/10_minutes_array_graph.png
+-rw-r--r--   0 james      (501) staff       (20)    22442 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/10_minutes_bag_graph.png
+-rw-r--r--   0 james      (501) staff       (20)    56229 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/10_minutes_dataframe_graph.png
+-rw-r--r--   0 james      (501) staff       (20)     4059 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/HHMI_Janelia_Color.png
+-rw-r--r--   0 james      (501) staff       (20)    18406 2023-07-17 19:15:13.000000 dask-2024.5.1/docs/source/images/array.svg
+-rw-r--r--   0 james      (501) staff       (20)  1620104 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/async-embarrassing.gif
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.382614 dask-2024.5.1/docs/source/images/changelog/
+-rw-r--r--   0 james      (501) staff       (20)    19604 2023-12-01 15:52:50.000000 dask-2024.5.1/docs/source/images/changelog/2023110-rechunking-disk-perf.png
+-rw-r--r--   0 james      (501) staff       (20)   540389 2024-01-26 23:05:40.000000 dask-2024.5.1/docs/source/images/cloud-provider-logos.svg
+-rw-r--r--   0 james      (501) staff       (20)    10752 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/concurrent-futures-threaded.webp
+-rw-r--r--   0 james      (501) staff       (20)   135129 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/crosstalk.svg
+-rw-r--r--   0 james      (501) staff       (20)  2367087 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_jupyterlab.png
+-rw-r--r--   0 james      (501) staff       (20)    37971 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_link.png
+-rw-r--r--   0 james      (501) staff       (20)    68712 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_memory.png
+-rw-r--r--   0 james      (501) staff       (20)   281018 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_memory_new.gif
+-rw-r--r--   0 james      (501) staff       (20)    25435 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_progress.png
+-rw-r--r--   0 james      (501) staff       (20)   276928 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_status.png
+-rw-r--r--   0 james      (501) staff       (20)    12009 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_task_processing.png
+-rw-r--r--   0 james      (501) staff       (20)    58238 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_task_stream_unhealthy.png
+-rw-r--r--   0 james      (501) staff       (20)   103654 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dashboard_taskstream_healthy.png
+-rw-r--r--   0 james      (501) staff       (20)   112822 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask-adaptive.svg
+-rw-r--r--   0 james      (501) staff       (20)    14645 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask-array.svg
+-rw-r--r--   0 james      (501) staff       (20)   222084 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask-cluster-manager.svg
+-rw-r--r--   0 james      (501) staff       (20)    18782 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask-dataframe.svg
+-rw-r--r--   0 james      (501) staff       (20)   381903 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask-overview-distributed-callout.svg
+-rw-r--r--   0 james      (501) staff       (20)   357643 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask-overview-schedulers.svg
+-rw-r--r--   0 james      (501) staff       (20)    97471 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask-overview.svg
+-rw-r--r--   0 james      (501) staff       (20)     3022 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_horizontal.svg
+-rw-r--r--   0 james      (501) staff       (20)     3651 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_horizontal_black.svg
+-rw-r--r--   0 james      (501) staff       (20)     3767 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_horizontal_on_blue.svg
+-rw-r--r--   0 james      (501) staff       (20)     3738 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_horizontal_on_pink.svg
+-rw-r--r--   0 james      (501) staff       (20)     3738 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_horizontal_white.svg
+-rw-r--r--   0 james      (501) staff       (20)     1607 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_icon.svg
+-rw-r--r--   0 james      (501) staff       (20)     1571 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_icon_black.svg
+-rw-r--r--   0 james      (501) staff       (20)     1607 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_icon_on_pink.svg
+-rw-r--r--   0 james      (501) staff       (20)     1609 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/dask_icon_white.svg
+-rw-r--r--   0 james      (501) staff       (20)    13382 2024-04-19 20:50:02.000000 dask-2024.5.1/docs/source/images/dataframe-optimize-explain.png
+-rw-r--r--   0 james      (501) staff       (20)    20216 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/delayed-inc-double-add.svg
+-rw-r--r--   0 james      (501) staff       (20)   104628 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/distributed-overview.svg
+-rw-r--r--   0 james      (501) staff       (20)    18297 2023-07-17 19:15:13.000000 dask-2024.5.1/docs/source/images/frame-shuffle.svg
+-rw-r--r--   0 james      (501) staff       (20)    22979 2023-07-17 19:15:13.000000 dask-2024.5.1/docs/source/images/frame-sort.svg
+-rw-r--r--   0 james      (501) staff       (20)    12181 2023-07-17 19:15:13.000000 dask-2024.5.1/docs/source/images/frame.svg
+-rw-r--r--   0 james      (501) staff       (20)   391443 2023-12-13 17:43:46.000000 dask-2024.5.1/docs/source/images/futures-graph.png
+-rw-r--r--   0 james      (501) staff       (20)    41828 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/gputester-msg.png
+-rw-r--r--   0 james      (501) staff       (20)   210392 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/growth_of_languages.png
+-rw-r--r--   0 james      (501) staff       (20)   167834 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/growth_of_libraries.png
+-rw-r--r--   0 james      (501) staff       (20)     4097 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/inc-add.svg
+-rw-r--r--   0 james      (501) staff       (20)   123010 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/map-reduce-task-scheduling.svg
+-rw-r--r--   0 james      (501) staff       (20)   482302 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/map_blocks_drop_axis.png
+-rw-r--r--   0 james      (501) staff       (20)   113067 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/merge_chunks.png
+-rw-r--r--   0 james      (501) staff       (20)    63244 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/merge_chunks_false.png
+-rw-r--r--   0 james      (501) staff       (20)    13024 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/optimize_dask1.svg
+-rw-r--r--   0 james      (501) staff       (20)     8803 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/optimize_dask2.svg
+-rw-r--r--   0 james      (501) staff       (20)     5198 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/optimize_dask3.svg
+-rw-r--r--   0 james      (501) staff       (20)     4104 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/optimize_dask4.svg
+-rw-r--r--   0 james      (501) staff       (20)     2738 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/optimize_dask5.svg
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.383552 dask-2024.5.1/docs/source/images/optimizer/
+-rw-r--r--   0 james      (501) staff       (20)    24523 2024-05-03 20:22:03.000000 dask-2024.5.1/docs/source/images/optimizer/automatic-repartitioning.svg
+-rw-r--r--   0 james      (501) staff       (20)   104078 2024-05-03 20:22:03.000000 dask-2024.5.1/docs/source/images/optimizer/avoiding-shuffles.svg
+-rw-r--r--   0 james      (501) staff       (20)   292827 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/order-failure.png
+-rw-r--r--   0 james      (501) staff       (20)   239828 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/order-success.png
+-rw-r--r--   0 james      (501) staff       (20)    40833 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/overlap.svg
+-rw-r--r--   0 james      (501) staff       (20)    18785 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/overlapping-blocks.svg
+-rw-r--r--   0 james      (501) staff       (20)     4537 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/overlapping-neighbors.svg
+-rw-r--r--   0 james      (501) staff       (20)    20533 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/pipeline.svg
+-rw-r--r--   0 james      (501) staff       (20)    31576 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/reshape.png
+-rw-r--r--   0 james      (501) staff       (20)    31410 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/reshape_problem.png
+-rw-r--r--   0 james      (501) staff       (20)    33288 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/reshape_rechunked.png
+-rw-r--r--   0 james      (501) staff       (20)    50209 2023-07-17 19:15:13.000000 dask-2024.5.1/docs/source/images/scaling-edges.png
+-rw-r--r--   0 james      (501) staff       (20)    68476 2023-07-17 19:15:13.000000 dask-2024.5.1/docs/source/images/scaling-nodes.png
+-rw-r--r--   0 james      (501) staff       (20)    21294 2023-07-17 19:15:13.000000 dask-2024.5.1/docs/source/images/simple-dask.png
+-rw-r--r--   0 james      (501) staff       (20)    27572 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/transpose-hlg-hovertooltip.png
+-rw-r--r--   0 james      (501) staff       (20)    84492 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/transpose-hlg-html-repr.png
+-rw-r--r--   0 james      (501) staff       (20)    39365 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/transpose.svg
+-rw-r--r--   0 james      (501) staff       (20)    22446 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/transpose_opt.svg
+-rw-r--r--   0 james      (501) staff       (20)   115022 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/trivial.svg
+-rw-r--r--   0 james      (501) staff       (20)     2451 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/images/unoverlapping-neighbors.svg
+-rw-r--r--   0 james      (501) staff       (20)    12496 2024-05-14 20:42:42.000000 dask-2024.5.1/docs/source/index.rst
+-rw-r--r--   0 james      (501) staff       (20)    15500 2024-03-13 20:06:34.000000 dask-2024.5.1/docs/source/install.rst
+-rw-r--r--   0 james      (501) staff       (20)      341 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/internals.rst
+-rw-r--r--   0 james      (501) staff       (20)      868 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/logos.rst
+-rw-r--r--   0 james      (501) staff       (20)     3573 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/maintainers.rst
+-rw-r--r--   0 james      (501) staff       (20)     6874 2024-05-17 19:47:46.000000 dask-2024.5.1/docs/source/ml.rst
+-rw-r--r--   0 james      (501) staff       (20)    12200 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/optimize.rst
+-rw-r--r--   0 james      (501) staff       (20)     7119 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/order.rst
+-rw-r--r--   0 james      (501) staff       (20)     4810 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/phases-of-computation.rst
+-rw-r--r--   0 james      (501) staff       (20)      857 2023-12-07 19:39:17.000000 dask-2024.5.1/docs/source/presentations.rst
+-rw-r--r--   0 james      (501) staff       (20)      868 2023-12-13 17:43:46.000000 dask-2024.5.1/docs/source/prometheus.rst
+-rw-r--r--   0 james      (501) staff       (20)     6010 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/scheduler-overview.rst
+-rw-r--r--   0 james      (501) staff       (20)     4493 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/scheduling-policy.rst
+-rw-r--r--   0 james      (501) staff       (20)    11015 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/scheduling.rst
+drwxr-xr-x   0 james      (501) staff       (20)        0 2024-05-17 20:11:37.384011 dask-2024.5.1/docs/source/scripts/
+-rw-r--r--   0 james      (501) staff       (20)     3294 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/scripts/scheduling.py
+-rw-r--r--   0 james      (501) staff       (20)     6104 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/shared.rst
+-rw-r--r--   0 james      (501) staff       (20)     4562 2023-12-13 17:43:46.000000 dask-2024.5.1/docs/source/software-environments.rst
+-rw-r--r--   0 james      (501) staff       (20)     9342 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/spark.rst
+-rw-r--r--   0 james      (501) staff       (20)     3967 2023-09-13 17:55:33.000000 dask-2024.5.1/docs/source/spec.rst
+-rw-r--r--   0 james      (501) staff       (20)     4754 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/support.rst
+-rw-r--r--   0 james      (501) staff       (20)     1831 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/understanding-performance.rst
+-rw-r--r--   0 james      (501) staff       (20)    12205 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/user-interfaces.rst
+-rw-r--r--   0 james      (501) staff       (20)    11744 2023-07-17 19:15:27.000000 dask-2024.5.1/docs/source/why.rst
+-rw-r--r--   0 james      (501) staff       (20)     7059 2024-05-17 19:57:00.000000 dask-2024.5.1/pyproject.toml
+-rw-r--r--   0 james      (501) staff       (20)       38 2024-05-17 20:11:37.385994 dask-2024.5.1/setup.cfg
+-rwxr-xr-x   0 james      (501) staff       (20)      194 2023-07-17 19:15:27.000000 dask-2024.5.1/setup.py
```

### Comparing `dask-2024.5.0/LICENSE.txt` & `dask-2024.5.1/LICENSE.txt`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/PKG-INFO` & `dask-2024.5.1/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: dask
-Version: 2024.5.0
+Version: 2024.5.1
 Summary: Parallel PyData with Task Scheduling
 Maintainer-email: Matthew Rocklin <mrocklin@gmail.com>
 License: BSD-3-Clause
 Project-URL: Homepage, https://github.com/dask/dask/
 Keywords: task-scheduling parallel numpy pandas pydata
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
@@ -36,15 +36,15 @@
 Requires-Dist: numpy>=1.21; extra == "array"
 Provides-Extra: bag
 Provides-Extra: dataframe
 Requires-Dist: dask[array]; extra == "dataframe"
 Requires-Dist: pandas>=1.3; extra == "dataframe"
 Requires-Dist: dask-expr<1.2,>=1.1; extra == "dataframe"
 Provides-Extra: distributed
-Requires-Dist: distributed==2024.5.0; extra == "distributed"
+Requires-Dist: distributed==2024.5.1; extra == "distributed"
 Provides-Extra: diagnostics
 Requires-Dist: bokeh>=2.4.2; extra == "diagnostics"
 Requires-Dist: jinja2>=2.10.3; extra == "diagnostics"
 Provides-Extra: delayed
 Provides-Extra: complete
 Requires-Dist: dask[array,dataframe,diagnostics,distributed]; extra == "complete"
 Requires-Dist: pyarrow>=7.0; extra == "complete"
```

### Comparing `dask-2024.5.0/README.rst` & `dask-2024.5.1/README.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/conftest.py` & `dask-2024.5.1/conftest.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/_compatibility.py` & `dask-2024.5.1/dask/_compatibility.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/NUMPY_LICENSE.txt` & `dask-2024.5.1/dask/array/NUMPY_LICENSE.txt`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/__init__.py` & `dask-2024.5.1/dask/array/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/backends.py` & `dask-2024.5.1/dask/array/backends.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/blockwise.py` & `dask-2024.5.1/dask/array/blockwise.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/chunk.py` & `dask-2024.5.1/dask/array/chunk.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/chunk_types.py` & `dask-2024.5.1/dask/array/chunk_types.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/core.py` & `dask-2024.5.1/dask/array/core.py`

 * *Files 0% similar despite different names*

```diff
@@ -8,11949 +8,11957 @@
 00000070: 2072 650a 696d 706f 7274 2073 7973 0a69   re.import sys.i
 00000080: 6d70 6f72 7420 7472 6163 6562 6163 6b0a  mport traceback.
 00000090: 696d 706f 7274 2075 7569 640a 696d 706f  import uuid.impo
 000000a0: 7274 2077 6172 6e69 6e67 730a 6672 6f6d  rt warnings.from
 000000b0: 2062 6973 6563 7420 696d 706f 7274 2062   bisect import b
 000000c0: 6973 6563 740a 6672 6f6d 2063 6f6c 6c65  isect.from colle
 000000d0: 6374 696f 6e73 2e61 6263 2069 6d70 6f72  ctions.abc impor
-000000e0: 7420 280a 2020 2020 436f 6c6c 6563 7469  t (.    Collecti
-000000f0: 6f6e 2c0a 2020 2020 4974 6572 6162 6c65  on,.    Iterable
-00000100: 2c0a 2020 2020 4974 6572 6174 6f72 2c0a  ,.    Iterator,.
-00000110: 2020 2020 4d61 7070 696e 672c 0a20 2020      Mapping,.   
-00000120: 204d 7574 6162 6c65 4d61 7070 696e 672c   MutableMapping,
-00000130: 0a20 2020 2053 6571 7565 6e63 652c 0a29  .    Sequence,.)
-00000140: 0a66 726f 6d20 6675 6e63 746f 6f6c 7320  .from functools 
-00000150: 696d 706f 7274 2070 6172 7469 616c 2c20  import partial, 
-00000160: 7265 6475 6365 2c20 7772 6170 730a 6672  reduce, wraps.fr
-00000170: 6f6d 2069 7465 7274 6f6f 6c73 2069 6d70  om itertools imp
-00000180: 6f72 7420 7072 6f64 7563 742c 207a 6970  ort product, zip
-00000190: 5f6c 6f6e 6765 7374 0a66 726f 6d20 6e75  _longest.from nu
-000001a0: 6d62 6572 7320 696d 706f 7274 2049 6e74  mbers import Int
-000001b0: 6567 7261 6c2c 204e 756d 6265 720a 6672  egral, Number.fr
-000001c0: 6f6d 206f 7065 7261 746f 7220 696d 706f  om operator impo
-000001d0: 7274 2061 6464 2c20 6d75 6c0a 6672 6f6d  rt add, mul.from
-000001e0: 2074 6872 6561 6469 6e67 2069 6d70 6f72   threading impor
-000001f0: 7420 4c6f 636b 0a66 726f 6d20 7479 7069  t Lock.from typi
-00000200: 6e67 2069 6d70 6f72 7420 416e 792c 2054  ng import Any, T
-00000210: 7970 6556 6172 2c20 556e 696f 6e2c 2063  ypeVar, Union, c
-00000220: 6173 740a 0a69 6d70 6f72 7420 6e75 6d70  ast..import nump
-00000230: 7920 6173 206e 700a 6672 6f6d 206e 756d  y as np.from num
-00000240: 7079 2e74 7970 696e 6720 696d 706f 7274  py.typing import
-00000250: 2041 7272 6179 4c69 6b65 0a66 726f 6d20   ArrayLike.from 
-00000260: 746c 7a20 696d 706f 7274 2061 6363 756d  tlz import accum
-00000270: 756c 6174 652c 2063 6f6e 6361 742c 2066  ulate, concat, f
-00000280: 6972 7374 2c20 6672 6571 7565 6e63 6965  irst, frequencie
-00000290: 732c 2067 726f 7570 6279 2c20 7061 7274  s, groupby, part
-000002a0: 6974 696f 6e0a 6672 6f6d 2074 6c7a 2e63  ition.from tlz.c
-000002b0: 7572 7269 6564 2069 6d70 6f72 7420 706c  urried import pl
-000002c0: 7563 6b0a 0a66 726f 6d20 6461 736b 2069  uck..from dask i
-000002d0: 6d70 6f72 7420 636f 6d70 7574 652c 2063  mport compute, c
-000002e0: 6f6e 6669 672c 2063 6f72 650a 6672 6f6d  onfig, core.from
-000002f0: 2064 6173 6b2e 6172 7261 7920 696d 706f   dask.array impo
-00000300: 7274 2063 6875 6e6b 0a66 726f 6d20 6461  rt chunk.from da
-00000310: 736b 2e61 7272 6179 2e63 6875 6e6b 2069  sk.array.chunk i
-00000320: 6d70 6f72 7420 6765 7469 7465 6d0a 6672  mport getitem.fr
-00000330: 6f6d 2064 6173 6b2e 6172 7261 792e 6368  om dask.array.ch
-00000340: 756e 6b5f 7479 7065 7320 696d 706f 7274  unk_types import
-00000350: 2069 735f 7661 6c69 645f 6172 7261 795f   is_valid_array_
-00000360: 6368 756e 6b2c 2069 735f 7661 6c69 645f  chunk, is_valid_
-00000370: 6368 756e 6b5f 7479 7065 0a0a 2320 4b65  chunk_type..# Ke
-00000380: 6570 2065 696e 7375 6d5f 6c6f 6f6b 7570  ep einsum_lookup
-00000390: 2061 6e64 2074 656e 736f 7264 6f74 5f6c   and tensordot_l
-000003a0: 6f6f 6b75 7020 6865 7265 2066 6f72 2062  ookup here for b
-000003b0: 6163 6b77 6172 6473 2063 6f6d 7061 7469  ackwards compati
-000003c0: 6269 6c69 7479 0a66 726f 6d20 6461 736b  bility.from dask
-000003d0: 2e61 7272 6179 2e64 6973 7061 7463 6820  .array.dispatch 
-000003e0: 696d 706f 7274 2028 2020 2320 6e6f 7161  import (  # noqa
-000003f0: 3a20 4634 3031 0a20 2020 2063 6f6e 6361  : F401.    conca
-00000400: 7465 6e61 7465 5f6c 6f6f 6b75 702c 0a20  tenate_lookup,. 
-00000410: 2020 2065 696e 7375 6d5f 6c6f 6f6b 7570     einsum_lookup
-00000420: 2c0a 2020 2020 7465 6e73 6f72 646f 745f  ,.    tensordot_
-00000430: 6c6f 6f6b 7570 2c0a 290a 6672 6f6d 2064  lookup,.).from d
-00000440: 6173 6b2e 6172 7261 792e 6e75 6d70 795f  ask.array.numpy_
-00000450: 636f 6d70 6174 2069 6d70 6f72 7420 5f52  compat import _R
-00000460: 6563 7572 7365 720a 6672 6f6d 2064 6173  ecurser.from das
-00000470: 6b2e 6172 7261 792e 736c 6963 696e 6720  k.array.slicing 
-00000480: 696d 706f 7274 2072 6570 6c61 6365 5f65  import replace_e
-00000490: 6c6c 6970 7369 732c 2073 6574 6974 656d  llipsis, setitem
-000004a0: 5f61 7272 6179 2c20 736c 6963 655f 6172  _array, slice_ar
-000004b0: 7261 790a 6672 6f6d 2064 6173 6b2e 6261  ray.from dask.ba
-000004c0: 7365 2069 6d70 6f72 7420 280a 2020 2020  se import (.    
-000004d0: 4461 736b 4d65 7468 6f64 734d 6978 696e  DaskMethodsMixin
-000004e0: 2c0a 2020 2020 636f 6d70 7574 655f 6173  ,.    compute_as
-000004f0: 5f69 665f 636f 6c6c 6563 7469 6f6e 2c0a  _if_collection,.
-00000500: 2020 2020 646f 6e74 5f6f 7074 696d 697a      dont_optimiz
-00000510: 652c 0a20 2020 2069 735f 6461 736b 5f63  e,.    is_dask_c
-00000520: 6f6c 6c65 6374 696f 6e2c 0a20 2020 206e  ollection,.    n
-00000530: 616d 6564 5f73 6368 6564 756c 6572 732c  amed_schedulers,
-00000540: 0a20 2020 2070 6572 7369 7374 2c0a 2020  .    persist,.  
-00000550: 2020 746f 6b65 6e69 7a65 2c0a 290a 6672    tokenize,.).fr
-00000560: 6f6d 2064 6173 6b2e 626c 6f63 6b77 6973  om dask.blockwis
-00000570: 6520 696d 706f 7274 2062 6c6f 636b 7769  e import blockwi
-00000580: 7365 2061 7320 636f 7265 5f62 6c6f 636b  se as core_block
-00000590: 7769 7365 0a66 726f 6d20 6461 736b 2e62  wise.from dask.b
-000005a0: 6c6f 636b 7769 7365 2069 6d70 6f72 7420  lockwise import 
-000005b0: 6272 6f61 6463 6173 745f 6469 6d65 6e73  broadcast_dimens
-000005c0: 696f 6e73 0a66 726f 6d20 6461 736b 2e63  ions.from dask.c
-000005d0: 6f6e 7465 7874 2069 6d70 6f72 7420 676c  ontext import gl
-000005e0: 6f62 616c 6d65 7468 6f64 0a66 726f 6d20  obalmethod.from 
-000005f0: 6461 736b 2e63 6f72 6520 696d 706f 7274  dask.core import
-00000600: 2071 756f 7465 0a66 726f 6d20 6461 736b   quote.from dask
-00000610: 2e64 656c 6179 6564 2069 6d70 6f72 7420  .delayed import 
-00000620: 4465 6c61 7965 642c 2064 656c 6179 6564  Delayed, delayed
-00000630: 0a66 726f 6d20 6461 736b 2e68 6967 686c  .from dask.highl
-00000640: 6576 656c 6772 6170 6820 696d 706f 7274  evelgraph import
-00000650: 2048 6967 684c 6576 656c 4772 6170 682c   HighLevelGraph,
-00000660: 204d 6174 6572 6961 6c69 7a65 644c 6179   MaterializedLay
-00000670: 6572 0a66 726f 6d20 6461 736b 2e6c 6179  er.from dask.lay
-00000680: 6572 7320 696d 706f 7274 2041 7272 6179  ers import Array
-00000690: 536c 6963 6544 6570 2c20 7265 7368 6170  SliceDep, reshap
-000006a0: 656c 6973 740a 6672 6f6d 2064 6173 6b2e  elist.from dask.
-000006b0: 7369 7a65 6f66 2069 6d70 6f72 7420 7369  sizeof import si
-000006c0: 7a65 6f66 0a66 726f 6d20 6461 736b 2e74  zeof.from dask.t
-000006d0: 7970 696e 6720 696d 706f 7274 2047 7261  yping import Gra
-000006e0: 7068 2c20 4b65 792c 204e 6573 7465 644b  ph, Key, NestedK
-000006f0: 6579 730a 6672 6f6d 2064 6173 6b2e 7574  eys.from dask.ut
-00000700: 696c 7320 696d 706f 7274 2028 0a20 2020  ils import (.   
-00000710: 2049 6e64 6578 4361 6c6c 6162 6c65 2c0a   IndexCallable,.
-00000720: 2020 2020 5365 7269 616c 697a 6162 6c65      Serializable
-00000730: 4c6f 636b 2c0a 2020 2020 6361 6368 6564  Lock,.    cached
-00000740: 5f63 756d 7375 6d2c 0a20 2020 2063 6163  _cumsum,.    cac
-00000750: 6865 645f 7072 6f70 6572 7479 2c0a 2020  hed_property,.  
-00000760: 2020 636f 6e63 7265 7465 2c0a 2020 2020    concrete,.    
-00000770: 6465 7269 7665 645f 6672 6f6d 2c0a 2020  derived_from,.  
-00000780: 2020 666f 726d 6174 5f62 7974 6573 2c0a    format_bytes,.
-00000790: 2020 2020 6675 6e63 6e61 6d65 2c0a 2020      funcname,.  
-000007a0: 2020 6861 735f 6b65 7977 6f72 642c 0a20    has_keyword,. 
-000007b0: 2020 2069 735f 6172 7261 796c 696b 652c     is_arraylike,
-000007c0: 0a20 2020 2069 735f 6461 7461 6672 616d  .    is_datafram
-000007d0: 655f 6c69 6b65 2c0a 2020 2020 6973 5f69  e_like,.    is_i
-000007e0: 6e64 6578 5f6c 696b 652c 0a20 2020 2069  ndex_like,.    i
-000007f0: 735f 696e 7465 6765 722c 0a20 2020 2069  s_integer,.    i
-00000800: 735f 7365 7269 6573 5f6c 696b 652c 0a20  s_series_like,. 
-00000810: 2020 206d 6179 6265 5f70 6c75 7261 6c69     maybe_plurali
-00000820: 7a65 2c0a 2020 2020 6e64 6565 706d 6170  ze,.    ndeepmap
-00000830: 2c0a 2020 2020 6e64 696d 6c69 7374 2c0a  ,.    ndimlist,.
-00000840: 2020 2020 7061 7273 655f 6279 7465 732c      parse_bytes,
-00000850: 0a20 2020 2074 7970 656e 616d 652c 0a29  .    typename,.)
-00000860: 0a66 726f 6d20 6461 736b 2e77 6964 6765  .from dask.widge
-00000870: 7473 2069 6d70 6f72 7420 6765 745f 7465  ts import get_te
-00000880: 6d70 6c61 7465 0a0a 545f 496e 744f 724e  mplate..T_IntOrN
-00000890: 614e 203d 2055 6e69 6f6e 5b69 6e74 2c20  aN = Union[int, 
-000008a0: 666c 6f61 745d 2020 2320 5368 6f75 6c64  float]  # Should
-000008b0: 2062 6520 556e 696f 6e5b 696e 742c 204c   be Union[int, L
-000008c0: 6974 6572 616c 5b6e 702e 6e61 6e5d 5d0a  iteral[np.nan]].
-000008d0: 0a44 4546 4155 4c54 5f47 4554 203d 206e  .DEFAULT_GET = n
-000008e0: 616d 6564 5f73 6368 6564 756c 6572 732e  amed_schedulers.
-000008f0: 6765 7428 2274 6872 6561 6473 222c 206e  get("threads", n
-00000900: 616d 6564 5f73 6368 6564 756c 6572 735b  amed_schedulers[
-00000910: 2273 796e 6322 5d29 0a0a 756e 6b6e 6f77  "sync"])..unknow
-00000920: 6e5f 6368 756e 6b5f 6d65 7373 6167 6520  n_chunk_message 
-00000930: 3d20 280a 2020 2020 225c 6e5c 6e22 0a20  = (.    "\n\n". 
-00000940: 2020 2022 4120 706f 7373 6962 6c65 2073     "A possible s
-00000950: 6f6c 7574 696f 6e3a 2022 0a20 2020 2022  olution: ".    "
-00000960: 6874 7470 733a 2f2f 646f 6373 2e64 6173  https://docs.das
-00000970: 6b2e 6f72 672f 656e 2f6c 6174 6573 742f  k.org/en/latest/
-00000980: 6172 7261 792d 6368 756e 6b73 2e68 746d  array-chunks.htm
-00000990: 6c23 756e 6b6e 6f77 6e2d 6368 756e 6b73  l#unknown-chunks
-000009a0: 5c6e 220a 2020 2020 2253 756d 6d61 7279  \n".    "Summary
-000009b0: 3a20 746f 2063 6f6d 7075 7465 2063 6875  : to compute chu
-000009c0: 6e6b 7320 7369 7a65 732c 2075 7365 5c6e  nks sizes, use\n
-000009d0: 5c6e 220a 2020 2020 2220 2020 782e 636f  \n".    "   x.co
-000009e0: 6d70 7574 655f 6368 756e 6b5f 7369 7a65  mpute_chunk_size
-000009f0: 7328 2920 2023 2066 6f72 2044 6173 6b20  s()  # for Dask 
-00000a00: 4172 7261 7920 6078 605c 6e22 0a20 2020  Array `x`\n".   
-00000a10: 2022 2020 2064 6466 2e74 6f5f 6461 736b   "   ddf.to_dask
-00000a20: 5f61 7272 6179 286c 656e 6774 6873 3d54  _array(lengths=T
-00000a30: 7275 6529 2020 2320 666f 7220 4461 736b  rue)  # for Dask
-00000a40: 2044 6174 6146 7261 6d65 2060 6464 6660   DataFrame `ddf`
-00000a50: 220a 290a 0a0a 636c 6173 7320 5065 7266  ".)...class Perf
-00000a60: 6f72 6d61 6e63 6557 6172 6e69 6e67 2857  ormanceWarning(W
-00000a70: 6172 6e69 6e67 293a 0a20 2020 2022 2222  arning):.    """
-00000a80: 4120 7761 726e 696e 6720 6769 7665 6e20  A warning given 
-00000a90: 7768 656e 2062 6164 2063 6875 6e6b 696e  when bad chunkin
-00000aa0: 6720 6d61 7920 6361 7573 6520 706f 6f72  g may cause poor
-00000ab0: 2070 6572 666f 726d 616e 6365 2222 220a   performance""".
-00000ac0: 0a0a 6465 6620 6765 7474 6572 2861 2c20  ..def getter(a, 
-00000ad0: 622c 2061 7361 7272 6179 3d54 7275 652c  b, asarray=True,
-00000ae0: 206c 6f63 6b3d 4e6f 6e65 293a 0a20 2020   lock=None):.   
-00000af0: 2069 6620 6973 696e 7374 616e 6365 2862   if isinstance(b
-00000b00: 2c20 7475 706c 6529 2061 6e64 2061 6e79  , tuple) and any
-00000b10: 2878 2069 7320 4e6f 6e65 2066 6f72 2078  (x is None for x
-00000b20: 2069 6e20 6229 3a0a 2020 2020 2020 2020   in b):.        
-00000b30: 6232 203d 2074 7570 6c65 2878 2066 6f72  b2 = tuple(x for
-00000b40: 2078 2069 6e20 6220 6966 2078 2069 7320   x in b if x is 
-00000b50: 6e6f 7420 4e6f 6e65 290a 2020 2020 2020  not None).      
-00000b60: 2020 6233 203d 2074 7570 6c65 280a 2020    b3 = tuple(.  
-00000b70: 2020 2020 2020 2020 2020 4e6f 6e65 2069            None i
-00000b80: 6620 7820 6973 204e 6f6e 6520 656c 7365  f x is None else
-00000b90: 2073 6c69 6365 284e 6f6e 652c 204e 6f6e   slice(None, Non
-00000ba0: 6529 0a20 2020 2020 2020 2020 2020 2066  e).            f
-00000bb0: 6f72 2078 2069 6e20 620a 2020 2020 2020  or x in b.      
-00000bc0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-00000bd0: 6e73 7461 6e63 6528 782c 2049 6e74 6567  nstance(x, Integ
-00000be0: 7261 6c29 0a20 2020 2020 2020 2029 0a20  ral).        ). 
-00000bf0: 2020 2020 2020 2072 6574 7572 6e20 6765         return ge
-00000c00: 7474 6572 2861 2c20 6232 2c20 6173 6172  tter(a, b2, asar
-00000c10: 7261 793d 6173 6172 7261 792c 206c 6f63  ray=asarray, loc
-00000c20: 6b3d 6c6f 636b 295b 6233 5d0a 0a20 2020  k=lock)[b3]..   
-00000c30: 2069 6620 6c6f 636b 3a0a 2020 2020 2020   if lock:.      
-00000c40: 2020 6c6f 636b 2e61 6371 7569 7265 2829    lock.acquire()
-00000c50: 0a20 2020 2074 7279 3a0a 2020 2020 2020  .    try:.      
-00000c60: 2020 6320 3d20 615b 625d 0a20 2020 2020    c = a[b].     
-00000c70: 2020 2023 2042 656c 6f77 2077 6520 7370     # Below we sp
-00000c80: 6563 6961 6c2d 6361 7365 2060 6e70 2e6d  ecial-case `np.m
-00000c90: 6174 7269 7860 2074 6f20 666f 7263 6520  atrix` to force 
-00000ca0: 6120 636f 6e76 6572 7369 6f6e 2074 6f0a  a conversion to.
-00000cb0: 2020 2020 2020 2020 2320 606e 702e 6e64          # `np.nd
-00000cc0: 6172 7261 7960 2061 6e64 2070 7265 7365  array` and prese
-00000cd0: 7276 6520 6f72 6967 696e 616c 2044 6173  rve original Das
-00000ce0: 6b20 6265 6861 7669 6f72 2066 6f72 2060  k behavior for `
-00000cf0: 6765 7474 6572 602c 0a20 2020 2020 2020  getter`,.       
-00000d00: 2023 2061 7320 666f 7220 616c 6c20 7075   # as for all pu
-00000d10: 7270 6f73 6573 2060 6e70 2e6d 6174 7269  rposes `np.matri
-00000d20: 7860 2069 7320 6172 7261 792d 6c69 6b65  x` is array-like
-00000d30: 2061 6e64 2074 6875 730a 2020 2020 2020   and thus.      
-00000d40: 2020 2320 6069 735f 6172 7261 796c 696b    # `is_arraylik
-00000d50: 6560 2065 7661 6c75 6174 6573 2074 6f20  e` evaluates to 
-00000d60: 6054 7275 6560 2069 6e20 7468 6174 2063  `True` in that c
-00000d70: 6173 652e 0a20 2020 2020 2020 2069 6620  ase..        if 
-00000d80: 6173 6172 7261 7920 616e 6420 286e 6f74  asarray and (not
-00000d90: 2069 735f 6172 7261 796c 696b 6528 6329   is_arraylike(c)
-00000da0: 206f 7220 6973 696e 7374 616e 6365 2863   or isinstance(c
-00000db0: 2c20 6e70 2e6d 6174 7269 7829 293a 0a20  , np.matrix)):. 
-00000dc0: 2020 2020 2020 2020 2020 2063 203d 206e             c = n
-00000dd0: 702e 6173 6172 7261 7928 6329 0a20 2020  p.asarray(c).   
-00000de0: 2066 696e 616c 6c79 3a0a 2020 2020 2020   finally:.      
-00000df0: 2020 6966 206c 6f63 6b3a 0a20 2020 2020    if lock:.     
-00000e00: 2020 2020 2020 206c 6f63 6b2e 7265 6c65         lock.rele
-00000e10: 6173 6528 290a 2020 2020 7265 7475 726e  ase().    return
-00000e20: 2063 0a0a 0a64 6566 2067 6574 7465 725f   c...def getter_
-00000e30: 6e6f 6661 6e63 7928 612c 2062 2c20 6173  nofancy(a, b, as
-00000e40: 6172 7261 793d 5472 7565 2c20 6c6f 636b  array=True, lock
-00000e50: 3d4e 6f6e 6529 3a0a 2020 2020 2222 2241  =None):.    """A
-00000e60: 2073 696d 706c 6520 7772 6170 7065 7220   simple wrapper 
-00000e70: 6172 6f75 6e64 2060 6067 6574 7465 7260  around ``getter`
-00000e80: 602e 0a0a 2020 2020 5573 6564 2074 6f20  `...    Used to 
-00000e90: 696e 6469 6361 7465 2074 6f20 7468 6520  indicate to the 
-00000ea0: 6f70 7469 6d69 7a61 7469 6f6e 2070 6173  optimization pas
-00000eb0: 7365 7320 7468 6174 2074 6865 2062 6163  ses that the bac
-00000ec0: 6b65 6e64 2064 6f65 736e 2774 0a20 2020  kend doesn't.   
-00000ed0: 2073 7570 706f 7274 2066 616e 6379 2069   support fancy i
-00000ee0: 6e64 6578 696e 672e 0a20 2020 2022 2222  ndexing..    """
-00000ef0: 0a20 2020 2072 6574 7572 6e20 6765 7474  .    return gett
-00000f00: 6572 2861 2c20 622c 2061 7361 7272 6179  er(a, b, asarray
-00000f10: 3d61 7361 7272 6179 2c20 6c6f 636b 3d6c  =asarray, lock=l
-00000f20: 6f63 6b29 0a0a 0a64 6566 2067 6574 7465  ock)...def gette
-00000f30: 725f 696e 6c69 6e65 2861 2c20 622c 2061  r_inline(a, b, a
-00000f40: 7361 7272 6179 3d54 7275 652c 206c 6f63  sarray=True, loc
-00000f50: 6b3d 4e6f 6e65 293a 0a20 2020 2022 2222  k=None):.    """
-00000f60: 4120 6765 7474 6572 2066 756e 6374 696f  A getter functio
-00000f70: 6e20 7468 6174 206f 7074 696d 697a 6174  n that optimizat
-00000f80: 696f 6e73 2066 6565 6c20 636f 6d66 6f72  ions feel comfor
-00000f90: 7461 626c 6520 696e 6c69 6e69 6e67 0a0a  table inlining..
-00000fa0: 2020 2020 536c 6963 696e 6720 6f70 6572      Slicing oper
-00000fb0: 6174 696f 6e73 2077 6974 6820 7468 6973  ations with this
-00000fc0: 2066 756e 6374 696f 6e20 6d61 7920 6265   function may be
-00000fd0: 2069 6e6c 696e 6564 2069 6e74 6f20 6120   inlined into a 
-00000fe0: 6772 6170 682c 2073 7563 6820 6173 0a20  graph, such as. 
-00000ff0: 2020 2069 6e20 7468 6520 666f 6c6c 6f77     in the follow
-00001000: 696e 6720 7265 7772 6974 650a 0a20 2020  ing rewrite..   
-00001010: 202a 2a42 6566 6f72 652a 2a0a 0a20 2020   **Before**..   
-00001020: 203e 3e3e 2061 203d 2078 5b3a 3130 5d20   >>> a = x[:10] 
-00001030: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
-00001040: 500a 2020 2020 3e3e 3e20 6220 3d20 6120  P.    >>> b = a 
-00001050: 2b20 3120 2023 2064 6f63 7465 7374 3a20  + 1  # doctest: 
-00001060: 2b53 4b49 500a 2020 2020 3e3e 3e20 6320  +SKIP.    >>> c 
-00001070: 3d20 6120 2a20 3220 2023 2064 6f63 7465  = a * 2  # docte
-00001080: 7374 3a20 2b53 4b49 500a 0a20 2020 202a  st: +SKIP..    *
-00001090: 2a41 6674 6572 2a2a 0a0a 2020 2020 3e3e  *After**..    >>
-000010a0: 3e20 6220 3d20 785b 3a31 305d 202b 2031  > b = x[:10] + 1
-000010b0: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
-000010c0: 4950 0a20 2020 203e 3e3e 2063 203d 2078  IP.    >>> c = x
-000010d0: 5b3a 3130 5d20 2a20 3220 2023 2064 6f63  [:10] * 2  # doc
-000010e0: 7465 7374 3a20 2b53 4b49 500a 0a20 2020  test: +SKIP..   
-000010f0: 2054 6869 7320 696e 6c69 6e69 6e67 2063   This inlining c
-00001100: 616e 2062 6520 7265 6c65 7661 6e74 2074  an be relevant t
-00001110: 6f20 6f70 6572 6174 696f 6e73 2077 6865  o operations whe
-00001120: 6e20 7275 6e6e 696e 6720 6f66 6620 6f66  n running off of
-00001130: 2064 6973 6b2e 0a20 2020 2022 2222 0a20   disk..    """. 
-00001140: 2020 2072 6574 7572 6e20 6765 7474 6572     return getter
-00001150: 2861 2c20 622c 2061 7361 7272 6179 3d61  (a, b, asarray=a
-00001160: 7361 7272 6179 2c20 6c6f 636b 3d6c 6f63  sarray, lock=loc
-00001170: 6b29 0a0a 0a66 726f 6d20 6461 736b 2e61  k)...from dask.a
-00001180: 7272 6179 2e6f 7074 696d 697a 6174 696f  rray.optimizatio
-00001190: 6e20 696d 706f 7274 2066 7573 655f 736c  n import fuse_sl
-000011a0: 6963 652c 206f 7074 696d 697a 650a 0a23  ice, optimize..#
-000011b0: 205f 5f61 7272 6179 5f66 756e 6374 696f   __array_functio
-000011c0: 6e5f 5f20 6469 6374 2066 6f72 206d 6170  n__ dict for map
-000011d0: 7069 6e67 2061 6c69 6173 6573 2061 6e64  ping aliases and
-000011e0: 206d 6973 6d61 7463 6869 6e67 206e 616d   mismatching nam
-000011f0: 6573 0a5f 4841 4e44 4c45 445f 4655 4e43  es._HANDLED_FUNC
-00001200: 5449 4f4e 5320 3d20 7b7d 0a0a 0a64 6566  TIONS = {}...def
-00001210: 2069 6d70 6c65 6d65 6e74 7328 2a6e 756d   implements(*num
-00001220: 7079 5f66 756e 6374 696f 6e73 293a 0a20  py_functions):. 
-00001230: 2020 2022 2222 5265 6769 7374 6572 2061     """Register a
-00001240: 6e20 5f5f 6172 7261 795f 6675 6e63 7469  n __array_functi
-00001250: 6f6e 5f5f 2069 6d70 6c65 6d65 6e74 6174  on__ implementat
-00001260: 696f 6e20 666f 7220 6461 736b 2e61 7272  ion for dask.arr
-00001270: 6179 2e41 7272 6179 0a0a 2020 2020 5265  ay.Array..    Re
-00001280: 6769 7374 6572 2074 6861 7420 6120 6675  gister that a fu
-00001290: 6e63 7469 6f6e 2069 6d70 6c65 6d65 6e74  nction implement
-000012a0: 7320 7468 6520 4150 4920 6f66 2061 204e  s the API of a N
-000012b0: 756d 5079 2066 756e 6374 696f 6e20 286f  umPy function (o
-000012c0: 7220 7365 7665 7261 6c0a 2020 2020 4e75  r several.    Nu
-000012d0: 6d50 7920 6675 6e63 7469 6f6e 7320 696e  mPy functions in
-000012e0: 2063 6173 6520 6f66 2061 6c69 6173 6573   case of aliases
-000012f0: 2920 7768 6963 6820 6973 2068 616e 646c  ) which is handl
-00001300: 6564 2077 6974 680a 2020 2020 6060 5f5f  ed with.    ``__
-00001310: 6172 7261 795f 6675 6e63 7469 6f6e 5f5f  array_function__
-00001320: 6060 2e0a 0a20 2020 2050 6172 616d 6574  ``...    Paramet
-00001330: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-00001340: 2d2d 0a20 2020 205c 5c2a 6e75 6d70 795f  --.    \\*numpy_
-00001350: 6675 6e63 7469 6f6e 7320 3a20 6361 6c6c  functions : call
-00001360: 6162 6c65 730a 2020 2020 2020 2020 4f6e  ables.        On
-00001370: 6520 6f72 206d 6f72 6520 4e75 6d50 7920  e or more NumPy 
-00001380: 6675 6e63 7469 6f6e 7320 7468 6174 2061  functions that a
-00001390: 7265 2068 616e 646c 6564 2062 7920 6060  re handled by ``
-000013a0: 5f5f 6172 7261 795f 6675 6e63 7469 6f6e  __array_function
-000013b0: 5f5f 6060 0a20 2020 2020 2020 2061 6e64  __``.        and
-000013c0: 2077 696c 6c20 6265 206d 6170 7065 6420   will be mapped 
-000013d0: 6279 2060 696d 706c 656d 656e 7473 6020  by `implements` 
-000013e0: 746f 2061 2060 6461 736b 2e61 7272 6179  to a `dask.array
-000013f0: 6020 6675 6e63 7469 6f6e 2e0a 2020 2020  ` function..    
-00001400: 2222 220a 0a20 2020 2064 6566 2064 6563  """..    def dec
-00001410: 6f72 6174 6f72 2864 6173 6b5f 6675 6e63  orator(dask_func
-00001420: 293a 0a20 2020 2020 2020 2066 6f72 206e  ):.        for n
-00001430: 756d 7079 5f66 756e 6374 696f 6e20 696e  umpy_function in
-00001440: 206e 756d 7079 5f66 756e 6374 696f 6e73   numpy_functions
-00001450: 3a0a 2020 2020 2020 2020 2020 2020 5f48  :.            _H
-00001460: 414e 444c 4544 5f46 554e 4354 494f 4e53  ANDLED_FUNCTIONS
-00001470: 5b6e 756d 7079 5f66 756e 6374 696f 6e5d  [numpy_function]
-00001480: 203d 2064 6173 6b5f 6675 6e63 0a0a 2020   = dask_func..  
-00001490: 2020 2020 2020 7265 7475 726e 2064 6173        return das
-000014a0: 6b5f 6675 6e63 0a0a 2020 2020 7265 7475  k_func..    retu
-000014b0: 726e 2064 6563 6f72 6174 6f72 0a0a 0a64  rn decorator...d
-000014c0: 6566 205f 7368 6f75 6c64 5f64 656c 6567  ef _should_deleg
-000014d0: 6174 6528 7365 6c66 2c20 6f74 6865 7229  ate(self, other)
-000014e0: 202d 3e20 626f 6f6c 3a0a 2020 2020 2222   -> bool:.    ""
-000014f0: 2243 6865 636b 2077 6865 7468 6572 2044  "Check whether D
-00001500: 6173 6b20 7368 6f75 6c64 2064 656c 6567  ask should deleg
-00001510: 6174 6520 746f 2074 6865 206f 7468 6572  ate to the other
-00001520: 2e0a 2020 2020 5468 6973 2069 6d70 6c65  ..    This imple
-00001530: 6d65 6e74 6174 696f 6e20 666f 6c6c 6f77  mentation follow
-00001540: 7320 4e45 502d 3133 3a0a 2020 2020 6874  s NEP-13:.    ht
-00001550: 7470 733a 2f2f 6e75 6d70 792e 6f72 672f  tps://numpy.org/
-00001560: 6e65 7073 2f6e 6570 2d30 3031 332d 7566  neps/nep-0013-uf
-00001570: 756e 632d 6f76 6572 7269 6465 732e 6874  unc-overrides.ht
-00001580: 6d6c 2362 6568 6176 696f 722d 696e 2d63  ml#behavior-in-c
-00001590: 6f6d 6269 6e61 7469 6f6e 2d77 6974 682d  ombination-with-
-000015a0: 7079 7468 6f6e 2d73 2d62 696e 6172 792d  python-s-binary-
-000015b0: 6f70 6572 6174 696f 6e73 0a20 2020 2022  operations.    "
-000015c0: 2222 0a20 2020 2069 6620 6861 7361 7474  "".    if hasatt
-000015d0: 7228 6f74 6865 722c 2022 5f5f 6172 7261  r(other, "__arra
-000015e0: 795f 7566 756e 635f 5f22 2920 616e 6420  y_ufunc__") and 
-000015f0: 6f74 6865 722e 5f5f 6172 7261 795f 7566  other.__array_uf
-00001600: 756e 635f 5f20 6973 204e 6f6e 653a 0a20  unc__ is None:. 
-00001610: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00001620: 7565 0a20 2020 2065 6c69 6620 280a 2020  ue.    elif (.  
-00001630: 2020 2020 2020 6861 7361 7474 7228 6f74        hasattr(ot
-00001640: 6865 722c 2022 5f5f 6172 7261 795f 7566  her, "__array_uf
-00001650: 756e 635f 5f22 290a 2020 2020 2020 2020  unc__").        
-00001660: 616e 6420 6e6f 7420 6973 5f76 616c 6964  and not is_valid
-00001670: 5f61 7272 6179 5f63 6875 6e6b 286f 7468  _array_chunk(oth
-00001680: 6572 290a 2020 2020 2020 2020 2320 646f  er).        # do
-00001690: 6e27 7420 6465 6c65 6761 7465 2074 6f20  n't delegate to 
-000016a0: 6f75 7220 6f77 6e20 7061 7265 6e74 2063  our own parent c
-000016b0: 6c61 7373 6573 0a20 2020 2020 2020 2061  lasses.        a
-000016c0: 6e64 206e 6f74 2069 7369 6e73 7461 6e63  nd not isinstanc
-000016d0: 6528 7365 6c66 2c20 7479 7065 286f 7468  e(self, type(oth
-000016e0: 6572 2929 0a20 2020 2020 2020 2061 6e64  er)).        and
-000016f0: 2074 7970 6528 7365 6c66 2920 6973 206e   type(self) is n
-00001700: 6f74 2074 7970 6528 6f74 6865 7229 0a20  ot type(other). 
-00001710: 2020 2029 3a0a 2020 2020 2020 2020 7265     ):.        re
-00001720: 7475 726e 2054 7275 650a 2020 2020 7265  turn True.    re
-00001730: 7475 726e 2046 616c 7365 0a0a 0a64 6566  turn False...def
-00001740: 2063 6865 636b 5f69 665f 6861 6e64 6c65   check_if_handle
-00001750: 645f 6769 7665 6e5f 6f74 6865 7228 6629  d_given_other(f)
-00001760: 3a0a 2020 2020 2222 2243 6865 636b 2069  :.    """Check i
-00001770: 6620 6d65 7468 6f64 2069 7320 6861 6e64  f method is hand
-00001780: 6c65 6420 6279 2044 6173 6b20 6769 7665  led by Dask give
-00001790: 6e20 7479 7065 206f 6620 6f74 6865 720a  n type of other.
-000017a0: 0a20 2020 2045 6e73 7572 6573 2070 726f  .    Ensures pro
-000017b0: 7065 7220 6465 6665 7272 616c 2074 6f20  per deferral to 
-000017c0: 7570 6361 7374 2074 7970 6573 2069 6e20  upcast types in 
-000017d0: 6475 6e64 6572 206f 7065 7261 7469 6f6e  dunder operation
-000017e0: 7320 7769 7468 6f75 740a 2020 2020 6173  s without.    as
-000017f0: 7375 6d69 6e67 2075 6e6b 6e6f 776e 2074  suming unknown t
-00001800: 7970 6573 2061 7265 2061 7574 6f6d 6174  ypes are automat
-00001810: 6963 616c 6c79 2064 6f77 6e63 6173 7420  ically downcast 
-00001820: 7479 7065 732e 0a20 2020 2022 2222 0a0a  types..    """..
-00001830: 2020 2020 4077 7261 7073 2866 290a 2020      @wraps(f).  
-00001840: 2020 6465 6620 7772 6170 7065 7228 7365    def wrapper(se
-00001850: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-00001860: 2020 2020 6966 205f 7368 6f75 6c64 5f64      if _should_d
-00001870: 656c 6567 6174 6528 7365 6c66 2c20 6f74  elegate(self, ot
-00001880: 6865 7229 3a0a 2020 2020 2020 2020 2020  her):.          
-00001890: 2020 7265 7475 726e 204e 6f74 496d 706c    return NotImpl
-000018a0: 656d 656e 7465 640a 2020 2020 2020 2020  emented.        
-000018b0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000018c0: 2020 7265 7475 726e 2066 2873 656c 662c    return f(self,
-000018d0: 206f 7468 6572 290a 0a20 2020 2072 6574   other)..    ret
-000018e0: 7572 6e20 7772 6170 7065 720a 0a0a 6465  urn wrapper...de
-000018f0: 6620 736c 6963 6573 5f66 726f 6d5f 6368  f slices_from_ch
-00001900: 756e 6b73 2863 6875 6e6b 7329 3a0a 2020  unks(chunks):.  
-00001910: 2020 2222 2254 7261 6e73 6c61 7465 2063    """Translate c
-00001920: 6875 6e6b 7320 7475 706c 6520 746f 2061  hunks tuple to a
-00001930: 2073 6574 206f 6620 736c 6963 6573 2069   set of slices i
-00001940: 6e20 7072 6f64 7563 7420 6f72 6465 720a  n product order.
-00001950: 0a20 2020 203e 3e3e 2073 6c69 6365 735f  .    >>> slices_
-00001960: 6672 6f6d 5f63 6875 6e6b 7328 2828 322c  from_chunks(((2,
-00001970: 2032 292c 2028 332c 2033 2c20 3329 2929   2), (3, 3, 3)))
-00001980: 2020 2320 646f 6374 6573 743a 202b 4e4f    # doctest: +NO
-00001990: 524d 414c 495a 455f 5748 4954 4553 5041  RMALIZE_WHITESPA
-000019a0: 4345 0a20 2020 2020 5b28 736c 6963 6528  CE.     [(slice(
-000019b0: 302c 2032 2c20 4e6f 6e65 292c 2073 6c69  0, 2, None), sli
-000019c0: 6365 2830 2c20 332c 204e 6f6e 6529 292c  ce(0, 3, None)),
-000019d0: 0a20 2020 2020 2028 736c 6963 6528 302c  .      (slice(0,
-000019e0: 2032 2c20 4e6f 6e65 292c 2073 6c69 6365   2, None), slice
-000019f0: 2833 2c20 362c 204e 6f6e 6529 292c 0a20  (3, 6, None)),. 
-00001a00: 2020 2020 2028 736c 6963 6528 302c 2032       (slice(0, 2
-00001a10: 2c20 4e6f 6e65 292c 2073 6c69 6365 2836  , None), slice(6
-00001a20: 2c20 392c 204e 6f6e 6529 292c 0a20 2020  , 9, None)),.   
-00001a30: 2020 2028 736c 6963 6528 322c 2034 2c20     (slice(2, 4, 
-00001a40: 4e6f 6e65 292c 2073 6c69 6365 2830 2c20  None), slice(0, 
-00001a50: 332c 204e 6f6e 6529 292c 0a20 2020 2020  3, None)),.     
-00001a60: 2028 736c 6963 6528 322c 2034 2c20 4e6f   (slice(2, 4, No
-00001a70: 6e65 292c 2073 6c69 6365 2833 2c20 362c  ne), slice(3, 6,
-00001a80: 204e 6f6e 6529 292c 0a20 2020 2020 2028   None)),.      (
-00001a90: 736c 6963 6528 322c 2034 2c20 4e6f 6e65  slice(2, 4, None
-00001aa0: 292c 2073 6c69 6365 2836 2c20 392c 204e  ), slice(6, 9, N
-00001ab0: 6f6e 6529 295d 0a20 2020 2022 2222 0a20  one))].    """. 
-00001ac0: 2020 2063 756d 6469 6d73 203d 205b 6361     cumdims = [ca
-00001ad0: 6368 6564 5f63 756d 7375 6d28 6264 732c  ched_cumsum(bds,
-00001ae0: 2069 6e69 7469 616c 5f7a 6572 6f3d 5472   initial_zero=Tr
-00001af0: 7565 2920 666f 7220 6264 7320 696e 2063  ue) for bds in c
-00001b00: 6875 6e6b 735d 0a20 2020 2073 6c69 6365  hunks].    slice
-00001b10: 7320 3d20 5b0a 2020 2020 2020 2020 5b73  s = [.        [s
-00001b20: 6c69 6365 2873 2c20 7320 2b20 6469 6d29  lice(s, s + dim)
-00001b30: 2066 6f72 2073 2c20 6469 6d20 696e 207a   for s, dim in z
-00001b40: 6970 2873 7461 7274 732c 2073 6861 7065  ip(starts, shape
-00001b50: 7329 5d0a 2020 2020 2020 2020 666f 7220  s)].        for 
-00001b60: 7374 6172 7473 2c20 7368 6170 6573 2069  starts, shapes i
-00001b70: 6e20 7a69 7028 6375 6d64 696d 732c 2063  n zip(cumdims, c
-00001b80: 6875 6e6b 7329 0a20 2020 205d 0a20 2020  hunks).    ].   
-00001b90: 2072 6574 7572 6e20 6c69 7374 2870 726f   return list(pro
-00001ba0: 6475 6374 282a 736c 6963 6573 2929 0a0a  duct(*slices))..
-00001bb0: 0a64 6566 2067 7261 7068 5f66 726f 6d5f  .def graph_from_
-00001bc0: 6172 7261 796c 696b 6528 0a20 2020 2061  arraylike(.    a
-00001bd0: 7272 2c20 2023 2041 6e79 2061 7272 6179  rr,  # Any array
-00001be0: 2d6c 696b 6520 7768 6963 6820 7375 7070  -like which supp
-00001bf0: 6f72 7473 2073 6c69 6369 6e67 0a20 2020  orts slicing.   
-00001c00: 2063 6875 6e6b 732c 0a20 2020 2073 6861   chunks,.    sha
-00001c10: 7065 2c0a 2020 2020 6e61 6d65 2c0a 2020  pe,.    name,.  
-00001c20: 2020 6765 7469 7465 6d3d 6765 7474 6572    getitem=getter
-00001c30: 2c0a 2020 2020 6c6f 636b 3d46 616c 7365  ,.    lock=False
-00001c40: 2c0a 2020 2020 6173 6172 7261 793d 5472  ,.    asarray=Tr
-00001c50: 7565 2c0a 2020 2020 6474 7970 653d 4e6f  ue,.    dtype=No
-00001c60: 6e65 2c0a 2020 2020 696e 6c69 6e65 5f61  ne,.    inline_a
-00001c70: 7272 6179 3d46 616c 7365 2c0a 2920 2d3e  rray=False,.) ->
-00001c80: 2048 6967 684c 6576 656c 4772 6170 683a   HighLevelGraph:
-00001c90: 0a20 2020 2022 2222 0a20 2020 2048 6967  .    """.    Hig
-00001ca0: 684c 6576 656c 4772 6170 6820 666f 7220  hLevelGraph for 
-00001cb0: 736c 6963 696e 6720 6368 756e 6b73 2066  slicing chunks f
-00001cc0: 726f 6d20 616e 2061 7272 6179 2d6c 696b  rom an array-lik
-00001cd0: 6520 6163 636f 7264 696e 6720 746f 2061  e according to a
-00001ce0: 2063 6875 6e6b 2070 6174 7465 726e 2e0a   chunk pattern..
-00001cf0: 0a20 2020 2049 6620 6060 696e 6c69 6e65  .    If ``inline
-00001d00: 5f61 7272 6179 6060 2069 7320 5472 7565  _array`` is True
-00001d10: 2c20 7468 6973 206d 616b 6520 6120 426c  , this make a Bl
-00001d20: 6f63 6b77 6973 6520 6c61 7965 7220 6f66  ockwise layer of
-00001d30: 2073 6c69 6369 6e67 2074 6173 6b73 2077   slicing tasks w
-00001d40: 6865 7265 2074 6865 0a20 2020 2061 7272  here the.    arr
-00001d50: 6179 2d6c 696b 6520 6973 2065 6d62 6564  ay-like is embed
-00001d60: 6465 6420 696e 746f 2065 7665 7279 2074  ded into every t
-00001d70: 6173 6b2e 2c0a 0a20 2020 2049 6620 6060  ask.,..    If ``
-00001d80: 696e 6c69 6e65 5f61 7272 6179 6060 2069  inline_array`` i
-00001d90: 7320 4661 6c73 652c 2074 6869 7320 696e  s False, this in
-00001da0: 7365 7274 7320 7468 6520 6172 7261 792d  serts the array-
-00001db0: 6c69 6b65 2061 7320 6120 7374 616e 6461  like as a standa
-00001dc0: 6c6f 6e65 2076 616c 7565 2069 6e0a 2020  lone value in.  
-00001dd0: 2020 6120 4d61 7465 7269 616c 697a 6564    a Materialized
-00001de0: 4c61 7965 722c 2074 6865 6e20 6765 6e65  Layer, then gene
-00001df0: 7261 7465 7320 6120 426c 6f63 6b77 6973  rates a Blockwis
-00001e00: 6520 6c61 7965 7220 6f66 2073 6c69 6369  e layer of slici
-00001e10: 6e67 2074 6173 6b73 2074 6861 7420 7265  ng tasks that re
-00001e20: 6665 720a 2020 2020 746f 2069 742e 0a0a  fer.    to it...
-00001e30: 2020 2020 3e3e 3e20 6469 6374 2867 7261      >>> dict(gra
-00001e40: 7068 5f66 726f 6d5f 6172 7261 796c 696b  ph_from_arraylik
-00001e50: 6528 6172 722c 2063 6875 6e6b 733d 2832  e(arr, chunks=(2
-00001e60: 2c20 3329 2c20 7368 6170 653d 2834 2c20  , 3), shape=(4, 
-00001e70: 3629 2c20 6e61 6d65 3d22 5822 2c20 696e  6), name="X", in
-00001e80: 6c69 6e65 5f61 7272 6179 3d54 7275 6529  line_array=True)
-00001e90: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-00001ea0: 4b49 500a 2020 2020 7b28 6172 722c 2030  KIP.    {(arr, 0
-00001eb0: 2c20 3029 3a20 2867 6574 7465 722c 2061  , 0): (getter, a
-00001ec0: 7272 2c20 2873 6c69 6365 2830 2c20 3229  rr, (slice(0, 2)
-00001ed0: 2c20 736c 6963 6528 302c 2033 2929 292c  , slice(0, 3))),
-00001ee0: 0a20 2020 2020 2861 7272 2c20 312c 2030  .     (arr, 1, 0
-00001ef0: 293a 2028 6765 7474 6572 2c20 6172 722c  ): (getter, arr,
-00001f00: 2028 736c 6963 6528 322c 2034 292c 2073   (slice(2, 4), s
-00001f10: 6c69 6365 2830 2c20 3329 2929 2c0a 2020  lice(0, 3))),.  
-00001f20: 2020 2028 6172 722c 2031 2c20 3129 3a20     (arr, 1, 1): 
-00001f30: 2867 6574 7465 722c 2061 7272 2c20 2873  (getter, arr, (s
-00001f40: 6c69 6365 2832 2c20 3429 2c20 736c 6963  lice(2, 4), slic
-00001f50: 6528 332c 2036 2929 292c 0a20 2020 2020  e(3, 6))),.     
-00001f60: 2861 7272 2c20 302c 2031 293a 2028 6765  (arr, 0, 1): (ge
-00001f70: 7474 6572 2c20 6172 722c 2028 736c 6963  tter, arr, (slic
-00001f80: 6528 302c 2032 292c 2073 6c69 6365 2833  e(0, 2), slice(3
-00001f90: 2c20 3629 2929 7d0a 0a20 2020 203e 3e3e  , 6)))}..    >>>
-00001fa0: 2064 6963 7428 2020 2320 646f 6374 6573   dict(  # doctes
-00001fb0: 743a 202b 534b 4950 0a20 2020 2020 2020  t: +SKIP.       
-00001fc0: 2020 2020 2067 7261 7068 5f66 726f 6d5f       graph_from_
-00001fd0: 6172 7261 796c 696b 6528 6172 722c 2063  arraylike(arr, c
-00001fe0: 6875 6e6b 733d 2828 322c 2032 292c 2028  hunks=((2, 2), (
-00001ff0: 332c 2033 2929 2c20 7368 6170 653d 2834  3, 3)), shape=(4
-00002000: 2c36 292c 206e 616d 653d 2258 222c 2069  ,6), name="X", i
-00002010: 6e6c 696e 655f 6172 7261 793d 4661 6c73  nline_array=Fals
-00002020: 6529 0a20 2020 2020 2020 2029 0a20 2020  e).        ).   
-00002030: 207b 226f 7269 6769 6e61 6c2d 5822 3a20   {"original-X": 
-00002040: 6172 722c 0a20 2020 2020 2827 5827 2c20  arr,.     ('X', 
-00002050: 302c 2030 293a 2028 6765 7474 6572 2c20  0, 0): (getter, 
-00002060: 276f 7269 6769 6e61 6c2d 5827 2c20 2873  'original-X', (s
-00002070: 6c69 6365 2830 2c20 3229 2c20 736c 6963  lice(0, 2), slic
-00002080: 6528 302c 2033 2929 292c 0a20 2020 2020  e(0, 3))),.     
-00002090: 2827 5827 2c20 312c 2030 293a 2028 6765  ('X', 1, 0): (ge
-000020a0: 7474 6572 2c20 276f 7269 6769 6e61 6c2d  tter, 'original-
-000020b0: 5827 2c20 2873 6c69 6365 2832 2c20 3429  X', (slice(2, 4)
-000020c0: 2c20 736c 6963 6528 302c 2033 2929 292c  , slice(0, 3))),
-000020d0: 0a20 2020 2020 2827 5827 2c20 312c 2031  .     ('X', 1, 1
-000020e0: 293a 2028 6765 7474 6572 2c20 276f 7269  ): (getter, 'ori
-000020f0: 6769 6e61 6c2d 5827 2c20 2873 6c69 6365  ginal-X', (slice
-00002100: 2832 2c20 3429 2c20 736c 6963 6528 332c  (2, 4), slice(3,
-00002110: 2036 2929 292c 0a20 2020 2020 2827 5827   6))),.     ('X'
-00002120: 2c20 302c 2031 293a 2028 6765 7474 6572  , 0, 1): (getter
-00002130: 2c20 276f 7269 6769 6e61 6c2d 5827 2c20  , 'original-X', 
-00002140: 2873 6c69 6365 2830 2c20 3229 2c20 736c  (slice(0, 2), sl
-00002150: 6963 6528 332c 2036 2929 297d 0a20 2020  ice(3, 6)))}.   
-00002160: 2022 2222 0a20 2020 2063 6875 6e6b 7320   """.    chunks 
-00002170: 3d20 6e6f 726d 616c 697a 655f 6368 756e  = normalize_chun
-00002180: 6b73 2863 6875 6e6b 732c 2073 6861 7065  ks(chunks, shape
-00002190: 2c20 6474 7970 653d 6474 7970 6529 0a20  , dtype=dtype). 
-000021a0: 2020 206f 7574 5f69 6e64 203d 2074 7570     out_ind = tup
-000021b0: 6c65 2872 616e 6765 286c 656e 2873 6861  le(range(len(sha
-000021c0: 7065 2929 290a 0a20 2020 2069 6620 280a  pe)))..    if (.
-000021d0: 2020 2020 2020 2020 6861 735f 6b65 7977          has_keyw
-000021e0: 6f72 6428 6765 7469 7465 6d2c 2022 6173  ord(getitem, "as
-000021f0: 6172 7261 7922 290a 2020 2020 2020 2020  array").        
-00002200: 616e 6420 6861 735f 6b65 7977 6f72 6428  and has_keyword(
-00002210: 6765 7469 7465 6d2c 2022 6c6f 636b 2229  getitem, "lock")
-00002220: 0a20 2020 2020 2020 2061 6e64 2028 6e6f  .        and (no
-00002230: 7420 6173 6172 7261 7920 6f72 206c 6f63  t asarray or loc
-00002240: 6b29 0a20 2020 2029 3a0a 2020 2020 2020  k).    ):.      
-00002250: 2020 6b77 6172 6773 203d 207b 2261 7361    kwargs = {"asa
-00002260: 7272 6179 223a 2061 7361 7272 6179 2c20  rray": asarray, 
-00002270: 226c 6f63 6b22 3a20 6c6f 636b 7d0a 2020  "lock": lock}.  
-00002280: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00002290: 2320 436f 6d6d 6f6e 2063 6173 652c 2064  # Common case, d
-000022a0: 726f 7020 6578 7472 6120 7061 7261 6d65  rop extra parame
-000022b0: 7465 7273 0a20 2020 2020 2020 206b 7761  ters.        kwa
-000022c0: 7267 7320 3d20 7b7d 0a0a 2020 2020 6966  rgs = {}..    if
-000022d0: 2069 6e6c 696e 655f 6172 7261 793a 0a20   inline_array:. 
-000022e0: 2020 2020 2020 206c 6179 6572 203d 2063         layer = c
-000022f0: 6f72 655f 626c 6f63 6b77 6973 6528 0a20  ore_blockwise(. 
-00002300: 2020 2020 2020 2020 2020 2067 6574 6974             getit
-00002310: 656d 2c0a 2020 2020 2020 2020 2020 2020  em,.            
-00002320: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-00002330: 2020 6f75 745f 696e 642c 0a20 2020 2020    out_ind,.     
-00002340: 2020 2020 2020 2061 7272 2c0a 2020 2020         arr,.    
-00002350: 2020 2020 2020 2020 4e6f 6e65 2c0a 2020          None,.  
-00002360: 2020 2020 2020 2020 2020 4172 7261 7953            ArrayS
-00002370: 6c69 6365 4465 7028 6368 756e 6b73 292c  liceDep(chunks),
-00002380: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00002390: 5f69 6e64 2c0a 2020 2020 2020 2020 2020  _ind,.          
-000023a0: 2020 6e75 6d62 6c6f 636b 733d 7b7d 2c0a    numblocks={},.
-000023b0: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-000023c0: 6172 6773 2c0a 2020 2020 2020 2020 290a  args,.        ).
-000023d0: 2020 2020 2020 2020 7265 7475 726e 2048          return H
-000023e0: 6967 684c 6576 656c 4772 6170 682e 6672  ighLevelGraph.fr
-000023f0: 6f6d 5f63 6f6c 6c65 6374 696f 6e73 286e  om_collections(n
-00002400: 616d 652c 206c 6179 6572 290a 2020 2020  ame, layer).    
-00002410: 656c 7365 3a0a 2020 2020 2020 2020 6f72  else:.        or
-00002420: 6967 696e 616c 5f6e 616d 6520 3d20 226f  iginal_name = "o
-00002430: 7269 6769 6e61 6c2d 2220 2b20 6e61 6d65  riginal-" + name
-00002440: 0a0a 2020 2020 2020 2020 6c61 7965 7273  ..        layers
-00002450: 203d 207b 7d0a 2020 2020 2020 2020 6c61   = {}.        la
-00002460: 7965 7273 5b6f 7269 6769 6e61 6c5f 6e61  yers[original_na
-00002470: 6d65 5d20 3d20 4d61 7465 7269 616c 697a  me] = Materializ
-00002480: 6564 4c61 7965 7228 7b6f 7269 6769 6e61  edLayer({origina
-00002490: 6c5f 6e61 6d65 3a20 6172 727d 290a 2020  l_name: arr}).  
-000024a0: 2020 2020 2020 6c61 7965 7273 5b6e 616d        layers[nam
-000024b0: 655d 203d 2063 6f72 655f 626c 6f63 6b77  e] = core_blockw
-000024c0: 6973 6528 0a20 2020 2020 2020 2020 2020  ise(.           
-000024d0: 2067 6574 6974 656d 2c0a 2020 2020 2020   getitem,.      
-000024e0: 2020 2020 2020 6e61 6d65 2c0a 2020 2020        name,.    
-000024f0: 2020 2020 2020 2020 6f75 745f 696e 642c          out_ind,
-00002500: 0a20 2020 2020 2020 2020 2020 206f 7269  .            ori
-00002510: 6769 6e61 6c5f 6e61 6d65 2c0a 2020 2020  ginal_name,.    
-00002520: 2020 2020 2020 2020 4e6f 6e65 2c0a 2020          None,.  
-00002530: 2020 2020 2020 2020 2020 4172 7261 7953            ArrayS
-00002540: 6c69 6365 4465 7028 6368 756e 6b73 292c  liceDep(chunks),
-00002550: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-00002560: 5f69 6e64 2c0a 2020 2020 2020 2020 2020  _ind,.          
-00002570: 2020 6e75 6d62 6c6f 636b 733d 7b7d 2c0a    numblocks={},.
-00002580: 2020 2020 2020 2020 2020 2020 2a2a 6b77              **kw
-00002590: 6172 6773 2c0a 2020 2020 2020 2020 290a  args,.        ).
-000025a0: 0a20 2020 2020 2020 2064 6570 7320 3d20  .        deps = 
-000025b0: 7b0a 2020 2020 2020 2020 2020 2020 6f72  {.            or
-000025c0: 6967 696e 616c 5f6e 616d 653a 2073 6574  iginal_name: set
-000025d0: 2829 2c0a 2020 2020 2020 2020 2020 2020  (),.            
-000025e0: 6e61 6d65 3a20 7b6f 7269 6769 6e61 6c5f  name: {original_
-000025f0: 6e61 6d65 7d2c 0a20 2020 2020 2020 207d  name},.        }
-00002600: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00002610: 4869 6768 4c65 7665 6c47 7261 7068 286c  HighLevelGraph(l
-00002620: 6179 6572 732c 2064 6570 7329 0a0a 0a64  ayers, deps)...d
-00002630: 6566 2064 6f74 6d61 6e79 2841 2c20 422c  ef dotmany(A, B,
-00002640: 206c 6566 7466 756e 633d 4e6f 6e65 2c20   leftfunc=None, 
-00002650: 7269 6768 7466 756e 633d 4e6f 6e65 2c20  rightfunc=None, 
-00002660: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-00002670: 2222 446f 7420 7072 6f64 7563 7420 6f66  ""Dot product of
-00002680: 206d 616e 7920 616c 6967 6e65 6420 6368   many aligned ch
-00002690: 756e 6b73 0a0a 2020 2020 3e3e 3e20 7820  unks..    >>> x 
-000026a0: 3d20 6e70 2e61 7272 6179 285b 5b31 2c20  = np.array([[1, 
-000026b0: 325d 2c20 5b31 2c20 325d 5d29 0a20 2020  2], [1, 2]]).   
-000026c0: 203e 3e3e 2079 203d 206e 702e 6172 7261   >>> y = np.arra
-000026d0: 7928 5b5b 3130 2c20 3230 5d2c 205b 3130  y([[10, 20], [10
-000026e0: 2c20 3230 5d5d 290a 2020 2020 3e3e 3e20  , 20]]).    >>> 
-000026f0: 646f 746d 616e 7928 5b78 2c20 782c 2078  dotmany([x, x, x
-00002700: 5d2c 205b 792c 2079 2c20 795d 290a 2020  ], [y, y, y]).  
-00002710: 2020 6172 7261 7928 5b5b 2039 302c 2031    array([[ 90, 1
-00002720: 3830 5d2c 0a20 2020 2020 2020 2020 2020  80],.           
-00002730: 5b20 3930 2c20 3138 305d 5d29 0a0a 2020  [ 90, 180]])..  
-00002740: 2020 4f70 7469 6f6e 616c 6c79 2070 6173    Optionally pas
-00002750: 7320 696e 2066 756e 6374 696f 6e73 2074  s in functions t
-00002760: 6f20 6170 706c 7920 746f 2074 6865 206c  o apply to the l
-00002770: 6566 7420 616e 6420 7269 6768 7420 6368  eft and right ch
-00002780: 756e 6b73 0a0a 2020 2020 3e3e 3e20 646f  unks..    >>> do
-00002790: 746d 616e 7928 5b78 2c20 782c 2078 5d2c  tmany([x, x, x],
-000027a0: 205b 792c 2079 2c20 795d 2c20 7269 6768   [y, y, y], righ
-000027b0: 7466 756e 633d 6e70 2e74 7261 6e73 706f  tfunc=np.transpo
-000027c0: 7365 290a 2020 2020 6172 7261 7928 5b5b  se).    array([[
-000027d0: 3135 302c 2031 3530 5d2c 0a20 2020 2020  150, 150],.     
-000027e0: 2020 2020 2020 5b31 3530 2c20 3135 305d        [150, 150]
-000027f0: 5d29 0a20 2020 2022 2222 0a20 2020 2069  ]).    """.    i
-00002800: 6620 6c65 6674 6675 6e63 3a0a 2020 2020  f leftfunc:.    
-00002810: 2020 2020 4120 3d20 6d61 7028 6c65 6674      A = map(left
-00002820: 6675 6e63 2c20 4129 0a20 2020 2069 6620  func, A).    if 
-00002830: 7269 6768 7466 756e 633a 0a20 2020 2020  rightfunc:.     
-00002840: 2020 2042 203d 206d 6170 2872 6967 6874     B = map(right
-00002850: 6675 6e63 2c20 4229 0a20 2020 2072 6574  func, B).    ret
-00002860: 7572 6e20 7375 6d28 6d61 7028 7061 7274  urn sum(map(part
-00002870: 6961 6c28 6e70 2e64 6f74 2c20 2a2a 6b77  ial(np.dot, **kw
-00002880: 6172 6773 292c 2041 2c20 4229 290a 0a0a  args), A, B))...
-00002890: 6465 6620 5f63 6f6e 6361 7465 6e61 7465  def _concatenate
-000028a0: 3228 6172 7261 7973 2c20 6178 6573 3d4e  2(arrays, axes=N
-000028b0: 6f6e 6529 3a0a 2020 2020 2222 2252 6563  one):.    """Rec
-000028c0: 7572 7369 7665 6c79 2063 6f6e 6361 7465  ursively concate
-000028d0: 6e61 7465 206e 6573 7465 6420 6c69 7374  nate nested list
-000028e0: 7320 6f66 2061 7272 6179 7320 616c 6f6e  s of arrays alon
-000028f0: 6720 6178 6573 0a0a 2020 2020 4561 6368  g axes..    Each
-00002900: 2065 6e74 7279 2069 6e20 6178 6573 2063   entry in axes c
-00002910: 6f72 7265 7370 6f6e 6473 2074 6f20 6561  orresponds to ea
-00002920: 6368 206c 6576 656c 206f 6620 7468 6520  ch level of the 
-00002930: 6e65 7374 6564 206c 6973 742e 2020 5468  nested list.  Th
-00002940: 650a 2020 2020 6c65 6e67 7468 206f 6620  e.    length of 
-00002950: 6178 6573 2073 686f 756c 6420 636f 7272  axes should corr
-00002960: 6573 706f 6e64 2074 6f20 7468 6520 6c65  espond to the le
-00002970: 7665 6c20 6f66 206e 6573 7469 6e67 206f  vel of nesting o
-00002980: 6620 6172 7261 7973 2e0a 2020 2020 4966  f arrays..    If
-00002990: 2061 7865 7320 6973 2061 6e20 656d 7074   axes is an empt
-000029a0: 7920 6c69 7374 206f 7220 7475 706c 652c  y list or tuple,
-000029b0: 2072 6574 7572 6e20 6172 7261 7973 2c20   return arrays, 
-000029c0: 6f72 2061 7272 6179 735b 305d 2069 660a  or arrays[0] if.
-000029d0: 2020 2020 6172 7261 7973 2069 7320 6120      arrays is a 
-000029e0: 6c69 7374 2e0a 0a20 2020 203e 3e3e 2078  list...    >>> x
-000029f0: 203d 206e 702e 6172 7261 7928 5b5b 312c   = np.array([[1,
-00002a00: 2032 5d2c 205b 332c 2034 5d5d 290a 2020   2], [3, 4]]).  
-00002a10: 2020 3e3e 3e20 5f63 6f6e 6361 7465 6e61    >>> _concatena
-00002a20: 7465 3228 5b78 2c20 785d 2c20 6178 6573  te2([x, x], axes
-00002a30: 3d5b 305d 290a 2020 2020 6172 7261 7928  =[0]).    array(
-00002a40: 5b5b 312c 2032 5d2c 0a20 2020 2020 2020  [[1, 2],.       
-00002a50: 2020 2020 5b33 2c20 345d 2c0a 2020 2020      [3, 4],.    
-00002a60: 2020 2020 2020 205b 312c 2032 5d2c 0a20         [1, 2],. 
-00002a70: 2020 2020 2020 2020 2020 5b33 2c20 345d            [3, 4]
-00002a80: 5d29 0a0a 2020 2020 3e3e 3e20 5f63 6f6e  ])..    >>> _con
-00002a90: 6361 7465 6e61 7465 3228 5b78 2c20 785d  catenate2([x, x]
-00002aa0: 2c20 6178 6573 3d5b 315d 290a 2020 2020  , axes=[1]).    
-00002ab0: 6172 7261 7928 5b5b 312c 2032 2c20 312c  array([[1, 2, 1,
-00002ac0: 2032 5d2c 0a20 2020 2020 2020 2020 2020   2],.           
-00002ad0: 5b33 2c20 342c 2033 2c20 345d 5d29 0a0a  [3, 4, 3, 4]])..
-00002ae0: 2020 2020 3e3e 3e20 5f63 6f6e 6361 7465      >>> _concate
-00002af0: 6e61 7465 3228 5b5b 782c 2078 5d2c 205b  nate2([[x, x], [
-00002b00: 782c 2078 5d5d 2c20 6178 6573 3d5b 302c  x, x]], axes=[0,
-00002b10: 2031 5d29 0a20 2020 2061 7272 6179 285b   1]).    array([
-00002b20: 5b31 2c20 322c 2031 2c20 325d 2c0a 2020  [1, 2, 1, 2],.  
-00002b30: 2020 2020 2020 2020 205b 332c 2034 2c20           [3, 4, 
-00002b40: 332c 2034 5d2c 0a20 2020 2020 2020 2020  3, 4],.         
-00002b50: 2020 5b31 2c20 322c 2031 2c20 325d 2c0a    [1, 2, 1, 2],.
-00002b60: 2020 2020 2020 2020 2020 205b 332c 2034             [3, 4
-00002b70: 2c20 332c 2034 5d5d 290a 0a20 2020 2053  , 3, 4]])..    S
-00002b80: 7570 706f 7274 7320 4974 6572 6174 6f72  upports Iterator
-00002b90: 730a 2020 2020 3e3e 3e20 5f63 6f6e 6361  s.    >>> _conca
-00002ba0: 7465 6e61 7465 3228 6974 6572 285b 782c  tenate2(iter([x,
-00002bb0: 2078 5d29 2c20 6178 6573 3d5b 315d 290a   x]), axes=[1]).
-00002bc0: 2020 2020 6172 7261 7928 5b5b 312c 2032      array([[1, 2
-00002bd0: 2c20 312c 2032 5d2c 0a20 2020 2020 2020  , 1, 2],.       
-00002be0: 2020 2020 5b33 2c20 342c 2033 2c20 345d      [3, 4, 3, 4]
-00002bf0: 5d29 0a0a 2020 2020 5370 6563 6961 6c20  ])..    Special 
-00002c00: 4361 7365 0a20 2020 203e 3e3e 205f 636f  Case.    >>> _co
-00002c10: 6e63 6174 656e 6174 6532 285b 782c 2078  ncatenate2([x, x
-00002c20: 5d2c 2061 7865 733d 2829 290a 2020 2020  ], axes=()).    
-00002c30: 6172 7261 7928 5b5b 312c 2032 5d2c 0a20  array([[1, 2],. 
-00002c40: 2020 2020 2020 2020 2020 5b33 2c20 345d            [3, 4]
-00002c50: 5d29 0a20 2020 2022 2222 0a20 2020 2069  ]).    """.    i
-00002c60: 6620 6178 6573 2069 7320 4e6f 6e65 3a0a  f axes is None:.
-00002c70: 2020 2020 2020 2020 6178 6573 203d 205b          axes = [
-00002c80: 5d0a 0a20 2020 2069 6620 6178 6573 203d  ]..    if axes =
-00002c90: 3d20 2829 3a0a 2020 2020 2020 2020 6966  = ():.        if
-00002ca0: 2069 7369 6e73 7461 6e63 6528 6172 7261   isinstance(arra
-00002cb0: 7973 2c20 6c69 7374 293a 0a20 2020 2020  ys, list):.     
-00002cc0: 2020 2020 2020 2072 6574 7572 6e20 6172         return ar
-00002cd0: 7261 7973 5b30 5d0a 2020 2020 2020 2020  rays[0].        
-00002ce0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00002cf0: 2020 7265 7475 726e 2061 7272 6179 730a    return arrays.
-00002d00: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-00002d10: 6365 2861 7272 6179 732c 2049 7465 7261  ce(arrays, Itera
-00002d20: 746f 7229 3a0a 2020 2020 2020 2020 6172  tor):.        ar
-00002d30: 7261 7973 203d 206c 6973 7428 6172 7261  rays = list(arra
-00002d40: 7973 290a 2020 2020 6966 206e 6f74 2069  ys).    if not i
-00002d50: 7369 6e73 7461 6e63 6528 6172 7261 7973  sinstance(arrays
-00002d60: 2c20 286c 6973 742c 2074 7570 6c65 2929  , (list, tuple))
-00002d70: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-00002d80: 2061 7272 6179 730a 2020 2020 6966 206c   arrays.    if l
-00002d90: 656e 2861 7865 7329 203e 2031 3a0a 2020  en(axes) > 1:.  
-00002da0: 2020 2020 2020 6172 7261 7973 203d 205b        arrays = [
-00002db0: 5f63 6f6e 6361 7465 6e61 7465 3228 612c  _concatenate2(a,
-00002dc0: 2061 7865 733d 6178 6573 5b31 3a5d 2920   axes=axes[1:]) 
-00002dd0: 666f 7220 6120 696e 2061 7272 6179 735d  for a in arrays]
-00002de0: 0a20 2020 2063 6f6e 6361 7465 6e61 7465  .    concatenate
-00002df0: 203d 2063 6f6e 6361 7465 6e61 7465 5f6c   = concatenate_l
-00002e00: 6f6f 6b75 702e 6469 7370 6174 6368 280a  ookup.dispatch(.
-00002e10: 2020 2020 2020 2020 7479 7065 286d 6178          type(max
-00002e20: 2861 7272 6179 732c 206b 6579 3d6c 616d  (arrays, key=lam
-00002e30: 6264 6120 783a 2067 6574 6174 7472 2878  bda x: getattr(x
-00002e40: 2c20 225f 5f61 7272 6179 5f70 7269 6f72  , "__array_prior
-00002e50: 6974 795f 5f22 2c20 3029 2929 0a20 2020  ity__", 0))).   
-00002e60: 2029 0a20 2020 2069 6620 6973 696e 7374   ).    if isinst
-00002e70: 616e 6365 2861 7272 6179 735b 305d 2c20  ance(arrays[0], 
-00002e80: 6469 6374 293a 0a20 2020 2020 2020 2023  dict):.        #
-00002e90: 2048 616e 646c 6520 636f 6e63 6174 656e   Handle concaten
-00002ea0: 6174 696f 6e20 6f66 2060 6469 6374 6073  ation of `dict`s
-00002eb0: 2c20 7573 6564 2061 7320 6120 7265 706c  , used as a repl
-00002ec0: 6163 656d 656e 7420 666f 7220 7374 7275  acement for stru
-00002ed0: 6374 7572 6564 0a20 2020 2020 2020 2023  ctured.        #
-00002ee0: 2061 7272 6179 7320 7768 656e 2074 6861   arrays when tha
-00002ef0: 7427 7320 6e6f 7420 7375 7070 6f72 7465  t's not supporte
-00002f00: 6420 6279 2074 6865 2061 7272 6179 206c  d by the array l
-00002f10: 6962 7261 7279 2028 652e 672e 2c20 4375  ibrary (e.g., Cu
-00002f20: 5079 292e 0a20 2020 2020 2020 206b 6579  Py)..        key
-00002f30: 7320 3d20 6c69 7374 2861 7272 6179 735b  s = list(arrays[
-00002f40: 305d 2e6b 6579 7328 2929 0a20 2020 2020  0].keys()).     
-00002f50: 2020 2061 7373 6572 7420 616c 6c28 6c69     assert all(li
-00002f60: 7374 2861 2e6b 6579 7328 2929 203d 3d20  st(a.keys()) == 
-00002f70: 6b65 7973 2066 6f72 2061 2069 6e20 6172  keys for a in ar
-00002f80: 7261 7973 290a 2020 2020 2020 2020 7265  rays).        re
-00002f90: 7420 3d20 6469 6374 2829 0a20 2020 2020  t = dict().     
-00002fa0: 2020 2066 6f72 206b 2069 6e20 6b65 7973     for k in keys
-00002fb0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00002fc0: 745b 6b5d 203d 2063 6f6e 6361 7465 6e61  t[k] = concatena
-00002fd0: 7465 286c 6973 7428 615b 6b5d 2066 6f72  te(list(a[k] for
-00002fe0: 2061 2069 6e20 6172 7261 7973 292c 2061   a in arrays), a
-00002ff0: 7869 733d 6178 6573 5b30 5d29 0a20 2020  xis=axes[0]).   
-00003000: 2020 2020 2072 6574 7572 6e20 7265 740a       return ret.
-00003010: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00003020: 2020 7265 7475 726e 2063 6f6e 6361 7465    return concate
-00003030: 6e61 7465 2861 7272 6179 732c 2061 7869  nate(arrays, axi
-00003040: 733d 6178 6573 5b30 5d29 0a0a 0a64 6566  s=axes[0])...def
-00003050: 2061 7070 6c79 5f69 6e66 6572 5f64 7479   apply_infer_dty
-00003060: 7065 2866 756e 632c 2061 7267 732c 206b  pe(func, args, k
-00003070: 7761 7267 732c 2066 756e 636e 616d 652c  wargs, funcname,
-00003080: 2073 7567 6765 7374 5f64 7479 7065 3d22   suggest_dtype="
-00003090: 6474 7970 6522 2c20 6e6f 7574 3d4e 6f6e  dtype", nout=Non
-000030a0: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
-000030b0: 5472 6965 7320 746f 2069 6e66 6572 206f  Tries to infer o
-000030c0: 7574 7075 7420 6474 7970 6520 6f66 2060  utput dtype of `
-000030d0: 6066 756e 6360 6020 666f 7220 6120 736d  `func`` for a sm
-000030e0: 616c 6c20 7365 7420 6f66 2069 6e70 7574  all set of input
-000030f0: 2061 7267 756d 656e 7473 2e0a 0a20 2020   arguments...   
-00003100: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00003110: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2066  ----------.    f
-00003120: 756e 633a 2043 616c 6c61 626c 650a 2020  unc: Callable.  
-00003130: 2020 2020 2020 4675 6e63 7469 6f6e 2066        Function f
-00003140: 6f72 2077 6869 6368 206f 7574 7075 7420  or which output 
-00003150: 6474 7970 6520 6973 2074 6f20 6265 2064  dtype is to be d
-00003160: 6574 6572 6d69 6e65 640a 0a20 2020 2061  etermined..    a
-00003170: 7267 733a 204c 6973 7420 6f66 2061 7272  rgs: List of arr
-00003180: 6179 206c 696b 650a 2020 2020 2020 2020  ay like.        
-00003190: 4172 6775 6d65 6e74 7320 746f 2074 6865  Arguments to the
-000031a0: 2066 756e 6374 696f 6e2c 2077 6869 6368   function, which
-000031b0: 2077 6f75 6c64 2075 7375 616c 6c79 2062   would usually b
-000031c0: 6520 7573 6564 2e20 4f6e 6c79 2061 7474  e used. Only att
-000031d0: 7269 6275 7465 730a 2020 2020 2020 2020  ributes.        
-000031e0: 6060 6e64 696d 6060 2061 6e64 2060 6064  ``ndim`` and ``d
-000031f0: 7479 7065 6060 2061 7265 2075 7365 642e  type`` are used.
-00003200: 0a0a 2020 2020 6b77 6172 6773 3a20 6469  ..    kwargs: di
-00003210: 6374 0a20 2020 2020 2020 2041 6464 6974  ct.        Addit
-00003220: 696f 6e61 6c20 6060 6b77 6172 6773 6060  ional ``kwargs``
-00003230: 2074 6f20 7468 6520 6060 6675 6e63 6060   to the ``func``
-00003240: 0a0a 2020 2020 6675 6e63 6e61 6d65 3a20  ..    funcname: 
-00003250: 5374 7269 6e67 0a20 2020 2020 2020 204e  String.        N
-00003260: 616d 6520 6f66 2063 616c 6c69 6e67 2066  ame of calling f
-00003270: 756e 6374 696f 6e20 746f 2069 6d70 726f  unction to impro
-00003280: 7665 2070 6f74 656e 7469 616c 2065 7272  ve potential err
-00003290: 6f72 206d 6573 7361 6765 730a 0a20 2020  or messages..   
-000032a0: 2073 7567 6765 7374 5f64 7479 7065 3a20   suggest_dtype: 
-000032b0: 4e6f 6e65 2f46 616c 7365 206f 7220 5374  None/False or St
-000032c0: 7269 6e67 0a20 2020 2020 2020 2049 6620  ring.        If 
-000032d0: 6e6f 7420 6060 4e6f 6e65 6060 2061 6464  not ``None`` add
-000032e0: 7320 7375 6767 6573 7469 6f6e 2074 6f20  s suggestion to 
-000032f0: 706f 7465 6e74 6961 6c20 6572 726f 7220  potential error 
-00003300: 6d65 7373 6167 6520 746f 2073 7065 6369  message to speci
-00003310: 6679 2061 2064 7479 7065 0a20 2020 2020  fy a dtype.     
-00003320: 2020 2076 6961 2074 6865 2073 7065 6369     via the speci
-00003330: 6669 6564 206b 7761 7267 2e20 4465 6661  fied kwarg. Defa
-00003340: 756c 7473 2074 6f20 6060 2764 7479 7065  ults to ``'dtype
-00003350: 2760 602e 0a0a 2020 2020 6e6f 7574 3a20  '``...    nout: 
-00003360: 4e6f 6e65 206f 7220 496e 740a 2020 2020  None or Int.    
-00003370: 2020 2020 6060 4e6f 6e65 6060 2069 6620      ``None`` if 
-00003380: 6675 6e63 7469 6f6e 2072 6574 7572 6e73  function returns
-00003390: 2073 696e 676c 6520 6f75 7470 7574 2c20   single output, 
-000033a0: 696e 7465 6765 7220 6966 206d 616e 792e  integer if many.
-000033b0: 0a20 2020 2020 2020 2044 6566 6175 6c74  .        Default
-000033c0: 7320 746f 2060 604e 6f6e 6560 602e 0a0a  s to ``None``...
-000033d0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000033e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 3a20 6474  -------.    : dt
-000033f0: 7970 6520 6f72 204c 6973 7420 6f66 2064  ype or List of d
-00003400: 7479 7065 0a20 2020 2020 2020 204f 6e65  type.        One
-00003410: 206f 7220 6d61 6e79 2064 7479 7065 7320   or many dtypes 
-00003420: 2864 6570 656e 6469 6e67 206f 6e20 6060  (depending on ``
-00003430: 6e6f 7574 6060 290a 2020 2020 2222 220a  nout``).    """.
-00003440: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
-00003450: 7261 792e 7574 696c 7320 696d 706f 7274  ray.utils import
-00003460: 206d 6574 615f 6672 6f6d 5f61 7272 6179   meta_from_array
-00003470: 0a0a 2020 2020 2320 6d61 6b65 2073 7572  ..    # make sur
-00003480: 6520 7468 6174 2065 7665 7279 2061 7267  e that every arg
-00003490: 2069 7320 616e 2065 7661 6c75 6174 6564   is an evaluated
-000034a0: 2061 7272 6179 0a20 2020 2061 7267 7320   array.    args 
-000034b0: 3d20 5b0a 2020 2020 2020 2020 6e70 2e6f  = [.        np.o
-000034c0: 6e65 735f 6c69 6b65 286d 6574 615f 6672  nes_like(meta_fr
-000034d0: 6f6d 5f61 7272 6179 2878 292c 2073 6861  om_array(x), sha
-000034e0: 7065 3d28 2831 2c29 202a 2078 2e6e 6469  pe=((1,) * x.ndi
-000034f0: 6d29 2c20 6474 7970 653d 782e 6474 7970  m), dtype=x.dtyp
-00003500: 6529 0a20 2020 2020 2020 2069 6620 6973  e).        if is
-00003510: 5f61 7272 6179 6c69 6b65 2878 290a 2020  _arraylike(x).  
-00003520: 2020 2020 2020 656c 7365 2078 0a20 2020        else x.   
-00003530: 2020 2020 2066 6f72 2078 2069 6e20 6172       for x in ar
-00003540: 6773 0a20 2020 205d 0a20 2020 2074 7279  gs.    ].    try
-00003550: 3a0a 2020 2020 2020 2020 7769 7468 206e  :.        with n
-00003560: 702e 6572 7273 7461 7465 2861 6c6c 3d22  p.errstate(all="
-00003570: 6967 6e6f 7265 2229 3a0a 2020 2020 2020  ignore"):.      
-00003580: 2020 2020 2020 6f20 3d20 6675 6e63 282a        o = func(*
-00003590: 6172 6773 2c20 2a2a 6b77 6172 6773 290a  args, **kwargs).
-000035a0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-000035b0: 7469 6f6e 2061 7320 653a 0a20 2020 2020  tion as e:.     
-000035c0: 2020 2065 7863 5f74 7970 652c 2065 7863     exc_type, exc
-000035d0: 5f76 616c 7565 2c20 6578 635f 7472 6163  _value, exc_trac
-000035e0: 6562 6163 6b20 3d20 7379 732e 6578 635f  eback = sys.exc_
-000035f0: 696e 666f 2829 0a20 2020 2020 2020 2074  info().        t
-00003600: 6220 3d20 2222 2e6a 6f69 6e28 7472 6163  b = "".join(trac
-00003610: 6562 6163 6b2e 666f 726d 6174 5f74 6228  eback.format_tb(
-00003620: 6578 635f 7472 6163 6562 6163 6b29 290a  exc_traceback)).
-00003630: 2020 2020 2020 2020 7375 6767 6573 7420          suggest 
-00003640: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00003650: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00003660: 2020 2250 6c65 6173 6520 7370 6563 6966    "Please specif
-00003670: 7920 7468 6520 6474 7970 6520 6578 706c  y the dtype expl
-00003680: 6963 6974 6c79 2075 7369 6e67 2074 6865  icitly using the
-00003690: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
-000036a0: 2020 2022 607b 6474 7970 657d 6020 6b77     "`{dtype}` kw
-000036b0: 6172 672e 5c6e 5c6e 222e 666f 726d 6174  arg.\n\n".format
-000036c0: 2864 7479 7065 3d73 7567 6765 7374 5f64  (dtype=suggest_d
-000036d0: 7479 7065 290a 2020 2020 2020 2020 2020  type).          
-000036e0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-000036f0: 6966 2073 7567 6765 7374 5f64 7479 7065  if suggest_dtype
-00003700: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00003710: 6520 2222 0a20 2020 2020 2020 2029 0a20  e "".        ). 
-00003720: 2020 2020 2020 206d 7367 203d 2028 0a20         msg = (. 
-00003730: 2020 2020 2020 2020 2020 2066 2260 6474             f"`dt
-00003740: 7970 6560 2069 6e66 6572 656e 6365 2066  ype` inference f
-00003750: 6169 6c65 6420 696e 2060 7b66 756e 636e  ailed in `{funcn
-00003760: 616d 657d 602e 5c6e 5c6e 220a 2020 2020  ame}`.\n\n".    
-00003770: 2020 2020 2020 2020 6622 7b73 7567 6765          f"{sugge
-00003780: 7374 7d22 0a20 2020 2020 2020 2020 2020  st}".           
-00003790: 2022 4f72 6967 696e 616c 2065 7272 6f72   "Original error
-000037a0: 2069 7320 6265 6c6f 773a 5c6e 220a 2020   is below:\n".  
-000037b0: 2020 2020 2020 2020 2020 222d 2d2d 2d2d            "-----
-000037c0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
-000037d0: 2d2d 2d5c 6e22 0a20 2020 2020 2020 2020  ---\n".         
-000037e0: 2020 2066 227b 6521 727d 5c6e 5c6e 220a     f"{e!r}\n\n".
-000037f0: 2020 2020 2020 2020 2020 2020 2254 7261              "Tra
-00003800: 6365 6261 636b 3a5c 6e22 0a20 2020 2020  ceback:\n".     
-00003810: 2020 2020 2020 2022 2d2d 2d2d 2d2d 2d2d         "--------
-00003820: 2d5c 6e22 0a20 2020 2020 2020 2020 2020  -\n".           
-00003830: 2066 227b 7462 7d22 0a20 2020 2020 2020   f"{tb}".       
-00003840: 2029 0a20 2020 2065 6c73 653a 0a20 2020   ).    else:.   
-00003850: 2020 2020 206d 7367 203d 204e 6f6e 650a       msg = None.
-00003860: 2020 2020 6966 206d 7367 2069 7320 6e6f      if msg is no
-00003870: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00003880: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00003890: 286d 7367 290a 2020 2020 7265 7475 726e  (msg).    return
-000038a0: 2067 6574 6174 7472 286f 2c20 2264 7479   getattr(o, "dty
-000038b0: 7065 222c 2074 7970 6528 6f29 2920 6966  pe", type(o)) if
-000038c0: 206e 6f75 7420 6973 204e 6f6e 6520 656c   nout is None el
-000038d0: 7365 2074 7570 6c65 2865 2e64 7479 7065  se tuple(e.dtype
-000038e0: 2066 6f72 2065 2069 6e20 6f29 0a0a 0a64   for e in o)...d
-000038f0: 6566 206e 6f72 6d61 6c69 7a65 5f61 7267  ef normalize_arg
-00003900: 2878 293a 0a20 2020 2022 2222 4e6f 726d  (x):.    """Norm
-00003910: 616c 697a 6520 7573 6572 2070 726f 7669  alize user provi
-00003920: 6465 6420 6172 6775 6d65 6e74 7320 746f  ded arguments to
-00003930: 2062 6c6f 636b 7769 7365 206f 7220 6d61   blockwise or ma
-00003940: 705f 626c 6f63 6b73 0a0a 2020 2020 5765  p_blocks..    We
-00003950: 2064 6f20 6120 6665 7720 7468 696e 6773   do a few things
-00003960: 3a0a 0a20 2020 2031 2e20 2049 6620 7468  :..    1.  If th
-00003970: 6579 2061 7265 2073 7472 696e 6720 6c69  ey are string li
-00003980: 7465 7261 6c73 2074 6861 7420 6d69 6768  terals that migh
-00003990: 7420 636f 6c6c 6964 6520 7769 7468 2062  t collide with b
-000039a0: 6c6f 636b 7769 7365 5f74 6f6b 656e 2074  lockwise_token t
-000039b0: 6865 6e20 7765 0a20 2020 2020 2020 2071  hen we.        q
-000039c0: 756f 7465 2074 6865 6d0a 2020 2020 322e  uote them.    2.
-000039d0: 2020 4946 2074 6865 7920 6172 6520 6c61    IF they are la
-000039e0: 7267 6520 2861 7320 6465 6669 6e65 6420  rge (as defined 
-000039f0: 6279 2073 697a 656f 6629 2074 6865 6e20  by sizeof) then 
-00003a00: 7765 2070 7574 2074 6865 6d20 696e 746f  we put them into
-00003a10: 2074 6865 0a20 2020 2020 2020 2067 7261   the.        gra
-00003a20: 7068 206f 6e20 7468 6569 7220 6f77 6e20  ph on their own 
-00003a30: 6279 2075 7369 6e67 2064 6173 6b2e 6465  by using dask.de
-00003a40: 6c61 7965 640a 2020 2020 2222 220a 2020  layed.    """.  
-00003a50: 2020 6966 2069 735f 6461 736b 5f63 6f6c    if is_dask_col
-00003a60: 6c65 6374 696f 6e28 7829 3a0a 2020 2020  lection(x):.    
-00003a70: 2020 2020 7265 7475 726e 2078 0a20 2020      return x.   
-00003a80: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00003a90: 2878 2c20 7374 7229 2061 6e64 2072 652e  (x, str) and re.
-00003aa0: 6d61 7463 6828 7222 5f5c 642b 222c 2078  match(r"_\d+", x
-00003ab0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00003ac0: 6e20 6465 6c61 7965 6428 7829 0a20 2020  n delayed(x).   
-00003ad0: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00003ae0: 2878 2c20 6c69 7374 2920 616e 6420 6c65  (x, list) and le
-00003af0: 6e28 7829 203e 3d20 3130 3a0a 2020 2020  n(x) >= 10:.    
-00003b00: 2020 2020 7265 7475 726e 2064 656c 6179      return delay
-00003b10: 6564 2878 290a 2020 2020 656c 6966 2073  ed(x).    elif s
-00003b20: 697a 656f 6628 7829 203e 2031 6536 3a0a  izeof(x) > 1e6:.
-00003b30: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-00003b40: 656c 6179 6564 2878 290a 2020 2020 656c  elayed(x).    el
-00003b50: 7365 3a0a 2020 2020 2020 2020 7265 7475  se:.        retu
-00003b60: 726e 2078 0a0a 0a64 6566 205f 7061 7373  rn x...def _pass
-00003b70: 5f65 7874 7261 5f6b 7761 7267 7328 6675  _extra_kwargs(fu
-00003b80: 6e63 2c20 6b65 7973 2c20 2a61 7267 732c  nc, keys, *args,
-00003b90: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00003ba0: 2222 2248 656c 7065 7220 666f 7220 3a66  """Helper for :f
-00003bb0: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
-00003bc0: 6d61 705f 626c 6f63 6b73 6020 746f 2070  map_blocks` to p
-00003bd0: 6173 7320 6062 6c6f 636b 5f69 6e66 6f60  ass `block_info`
-00003be0: 206f 7220 6062 6c6f 636b 5f69 6460 2e0a   or `block_id`..
-00003bf0: 0a20 2020 2046 6f72 2065 6163 6820 656c  .    For each el
-00003c00: 656d 656e 7420 6f66 2060 6b65 7973 602c  ement of `keys`,
-00003c10: 2061 2063 6f72 7265 7370 6f6e 6469 6e67   a corresponding
-00003c20: 2065 6c65 6d65 6e74 206f 6620 6172 6773   element of args
-00003c30: 2069 7320 6368 616e 6765 640a 2020 2020   is changed.    
-00003c40: 746f 2061 206b 6579 776f 7264 2061 7267  to a keyword arg
-00003c50: 756d 656e 7420 7769 7468 2074 6861 7420  ument with that 
-00003c60: 6b65 792c 2062 6566 6f72 6520 616c 6c20  key, before all 
-00003c70: 6172 6775 6d65 6e74 7320 7265 2070 6173  arguments re pas
-00003c80: 7365 6420 6f6e 0a20 2020 2074 6f20 6066  sed on.    to `f
-00003c90: 756e 6360 2e0a 2020 2020 2222 220a 2020  unc`..    """.  
-00003ca0: 2020 6b77 6172 6773 2e75 7064 6174 6528    kwargs.update(
-00003cb0: 7a69 7028 6b65 7973 2c20 6172 6773 2929  zip(keys, args))
-00003cc0: 0a20 2020 2072 6574 7572 6e20 6675 6e63  .    return func
-00003cd0: 282a 6172 6773 5b6c 656e 286b 6579 7329  (*args[len(keys)
-00003ce0: 203a 5d2c 202a 2a6b 7761 7267 7329 0a0a   :], **kwargs)..
-00003cf0: 0a64 6566 206d 6170 5f62 6c6f 636b 7328  .def map_blocks(
-00003d00: 0a20 2020 2066 756e 632c 0a20 2020 202a  .    func,.    *
-00003d10: 6172 6773 2c0a 2020 2020 6e61 6d65 3d4e  args,.    name=N
-00003d20: 6f6e 652c 0a20 2020 2074 6f6b 656e 3d4e  one,.    token=N
-00003d30: 6f6e 652c 0a20 2020 2064 7479 7065 3d4e  one,.    dtype=N
-00003d40: 6f6e 652c 0a20 2020 2063 6875 6e6b 733d  one,.    chunks=
-00003d50: 4e6f 6e65 2c0a 2020 2020 6472 6f70 5f61  None,.    drop_a
-00003d60: 7869 733d 4e6f 6e65 2c0a 2020 2020 6e65  xis=None,.    ne
-00003d70: 775f 6178 6973 3d4e 6f6e 652c 0a20 2020  w_axis=None,.   
-00003d80: 2065 6e66 6f72 6365 5f6e 6469 6d3d 4661   enforce_ndim=Fa
-00003d90: 6c73 652c 0a20 2020 206d 6574 613d 4e6f  lse,.    meta=No
-00003da0: 6e65 2c0a 2020 2020 2a2a 6b77 6172 6773  ne,.    **kwargs
-00003db0: 2c0a 293a 0a20 2020 2022 2222 4d61 7020  ,.):.    """Map 
-00003dc0: 6120 6675 6e63 7469 6f6e 2061 6372 6f73  a function acros
-00003dd0: 7320 616c 6c20 626c 6f63 6b73 206f 6620  s all blocks of 
-00003de0: 6120 6461 736b 2061 7272 6179 2e0a 0a20  a dask array... 
-00003df0: 2020 204e 6f74 6520 7468 6174 2060 606d     Note that ``m
-00003e00: 6170 5f62 6c6f 636b 7360 6020 7769 6c6c  ap_blocks`` will
-00003e10: 2061 7474 656d 7074 2074 6f20 6175 746f   attempt to auto
-00003e20: 6d61 7469 6361 6c6c 7920 6465 7465 726d  matically determ
-00003e30: 696e 6520 7468 6520 6f75 7470 7574 0a20  ine the output. 
-00003e40: 2020 2061 7272 6179 2074 7970 6520 6279     array type by
-00003e50: 2063 616c 6c69 6e67 2060 6066 756e 6360   calling ``func`
-00003e60: 6020 6f6e 2030 2d64 2076 6572 7369 6f6e  ` on 0-d version
-00003e70: 7320 6f66 2074 6865 2069 6e70 7574 732e  s of the inputs.
-00003e80: 2050 6c65 6173 6520 7265 6665 7220 746f   Please refer to
-00003e90: 0a20 2020 2074 6865 2060 606d 6574 6160  .    the ``meta`
-00003ea0: 6020 6b65 7977 6f72 6420 6172 6775 6d65  ` keyword argume
-00003eb0: 6e74 2062 656c 6f77 2069 6620 796f 7520  nt below if you 
-00003ec0: 6578 7065 6374 2074 6861 7420 7468 6520  expect that the 
-00003ed0: 6675 6e63 7469 6f6e 2077 696c 6c20 6e6f  function will no
-00003ee0: 740a 2020 2020 7375 6363 6565 6420 7768  t.    succeed wh
-00003ef0: 656e 206f 7065 7261 7469 6e67 206f 6e20  en operating on 
-00003f00: 302d 6420 6172 7261 7973 2e0a 0a20 2020  0-d arrays...   
-00003f10: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00003f20: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2066  ----------.    f
-00003f30: 756e 6320 3a20 6361 6c6c 6162 6c65 0a20  unc : callable. 
-00003f40: 2020 2020 2020 2046 756e 6374 696f 6e20         Function 
-00003f50: 746f 2061 7070 6c79 2074 6f20 6576 6572  to apply to ever
-00003f60: 7920 626c 6f63 6b20 696e 2074 6865 2061  y block in the a
-00003f70: 7272 6179 2e0a 2020 2020 2020 2020 4966  rray..        If
-00003f80: 2060 6066 756e 6360 6020 6163 6365 7074   ``func`` accept
-00003f90: 7320 6060 626c 6f63 6b5f 696e 666f 3d60  s ``block_info=`
-00003fa0: 6020 6f72 2060 6062 6c6f 636b 5f69 643d  ` or ``block_id=
-00003fb0: 6060 0a20 2020 2020 2020 2061 7320 6b65  ``.        as ke
-00003fc0: 7977 6f72 6420 6172 6775 6d65 6e74 732c  yword arguments,
-00003fd0: 2074 6865 7365 2077 696c 6c20 6265 2070   these will be p
-00003fe0: 6173 7365 6420 6469 6374 696f 6e61 7269  assed dictionari
-00003ff0: 6573 0a20 2020 2020 2020 2063 6f6e 7461  es.        conta
-00004000: 696e 696e 6720 696e 666f 726d 6174 696f  ining informatio
-00004010: 6e20 6162 6f75 7420 696e 7075 7420 616e  n about input an
-00004020: 6420 6f75 7470 7574 2063 6875 6e6b 732f  d output chunks/
-00004030: 6172 7261 7973 0a20 2020 2020 2020 2064  arrays.        d
-00004040: 7572 696e 6720 636f 6d70 7574 6174 696f  uring computatio
-00004050: 6e2e 2053 6565 2065 7861 6d70 6c65 7320  n. See examples 
-00004060: 666f 7220 6465 7461 696c 732e 0a20 2020  for details..   
-00004070: 2061 7267 7320 3a20 6461 736b 2061 7272   args : dask arr
-00004080: 6179 7320 6f72 206f 7468 6572 206f 626a  ays or other obj
-00004090: 6563 7473 0a20 2020 2064 7479 7065 203a  ects.    dtype :
-000040a0: 206e 702e 6474 7970 652c 206f 7074 696f   np.dtype, optio
-000040b0: 6e61 6c0a 2020 2020 2020 2020 5468 6520  nal.        The 
-000040c0: 6060 6474 7970 6560 6020 6f66 2074 6865  ``dtype`` of the
-000040d0: 206f 7574 7075 7420 6172 7261 792e 2049   output array. I
-000040e0: 7420 6973 2072 6563 6f6d 6d65 6e64 6564  t is recommended
-000040f0: 2074 6f20 7072 6f76 6964 6520 7468 6973   to provide this
-00004100: 2e0a 2020 2020 2020 2020 4966 206e 6f74  ..        If not
-00004110: 2070 726f 7669 6465 642c 2077 696c 6c20   provided, will 
-00004120: 6265 2069 6e66 6572 7265 6420 6279 2061  be inferred by a
-00004130: 7070 6c79 696e 6720 7468 6520 6675 6e63  pplying the func
-00004140: 7469 6f6e 2074 6f20 6120 736d 616c 6c0a  tion to a small.
-00004150: 2020 2020 2020 2020 7365 7420 6f66 2066          set of f
-00004160: 616b 6520 6461 7461 2e0a 2020 2020 6368  ake data..    ch
-00004170: 756e 6b73 203a 2074 7570 6c65 2c20 6f70  unks : tuple, op
-00004180: 7469 6f6e 616c 0a20 2020 2020 2020 2043  tional.        C
-00004190: 6875 6e6b 2073 6861 7065 206f 6620 7265  hunk shape of re
-000041a0: 7375 6c74 696e 6720 626c 6f63 6b73 2069  sulting blocks i
-000041b0: 6620 7468 6520 6675 6e63 7469 6f6e 2064  f the function d
-000041c0: 6f65 7320 6e6f 7420 7072 6573 6572 7665  oes not preserve
-000041d0: 0a20 2020 2020 2020 2073 6861 7065 2e20  .        shape. 
-000041e0: 4966 206e 6f74 2070 726f 7669 6465 642c  If not provided,
-000041f0: 2074 6865 2072 6573 756c 7469 6e67 2061   the resulting a
-00004200: 7272 6179 2069 7320 6173 7375 6d65 6420  rray is assumed 
-00004210: 746f 2068 6176 6520 7468 6520 7361 6d65  to have the same
-00004220: 0a20 2020 2020 2020 2062 6c6f 636b 2073  .        block s
-00004230: 7472 7563 7475 7265 2061 7320 7468 6520  tructure as the 
-00004240: 6669 7273 7420 696e 7075 7420 6172 7261  first input arra
-00004250: 792e 0a20 2020 2064 726f 705f 6178 6973  y..    drop_axis
-00004260: 203a 206e 756d 6265 7220 6f72 2069 7465   : number or ite
-00004270: 7261 626c 652c 206f 7074 696f 6e61 6c0a  rable, optional.
-00004280: 2020 2020 2020 2020 4469 6d65 6e73 696f          Dimensio
-00004290: 6e73 206c 6f73 7420 6279 2074 6865 2066  ns lost by the f
-000042a0: 756e 6374 696f 6e2e 0a20 2020 206e 6577  unction..    new
-000042b0: 5f61 7869 7320 3a20 6e75 6d62 6572 206f  _axis : number o
-000042c0: 7220 6974 6572 6162 6c65 2c20 6f70 7469  r iterable, opti
-000042d0: 6f6e 616c 0a20 2020 2020 2020 204e 6577  onal.        New
-000042e0: 2064 696d 656e 7369 6f6e 7320 6372 6561   dimensions crea
-000042f0: 7465 6420 6279 2074 6865 2066 756e 6374  ted by the funct
-00004300: 696f 6e2e 204e 6f74 6520 7468 6174 2074  ion. Note that t
-00004310: 6865 7365 2061 7265 2061 7070 6c69 6564  hese are applied
-00004320: 0a20 2020 2020 2020 2061 6674 6572 2060  .        after `
-00004330: 6064 726f 705f 6178 6973 6060 2028 6966  `drop_axis`` (if
-00004340: 2070 7265 7365 6e74 292e 0a20 2020 2065   present)..    e
-00004350: 6e66 6f72 6365 5f6e 6469 6d20 3a20 626f  nforce_ndim : bo
-00004360: 6f6c 2c20 6465 6661 756c 7420 4661 6c73  ol, default Fals
-00004370: 650a 2020 2020 2020 2020 5768 6574 6865  e.        Whethe
-00004380: 7220 746f 2065 6e66 6f72 6365 2061 7420  r to enforce at 
-00004390: 7275 6e74 696d 6520 7468 6174 2074 6865  runtime that the
-000043a0: 2064 696d 656e 7369 6f6e 616c 6974 7920   dimensionality 
-000043b0: 6f66 2074 6865 2061 7272 6179 0a20 2020  of the array.   
-000043c0: 2020 2020 2070 726f 6475 6365 6420 6279       produced by
-000043d0: 2060 6066 756e 6360 6020 6163 7475 616c   ``func`` actual
-000043e0: 6c79 206d 6174 6368 6573 2074 6861 7420  ly matches that 
-000043f0: 6f66 2074 6865 2061 7272 6179 2072 6574  of the array ret
-00004400: 7572 6e65 6420 6279 0a20 2020 2020 2020  urned by.       
-00004410: 2060 606d 6170 5f62 6c6f 636b 7360 602e   ``map_blocks``.
-00004420: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-00004430: 2c20 7468 6973 2077 696c 6c20 7261 6973  , this will rais
-00004440: 6520 616e 2065 7272 6f72 2077 6865 6e20  e an error when 
-00004450: 7468 6572 6520 6973 2061 206d 6973 6d61  there is a misma
-00004460: 7463 682e 0a20 2020 2074 6f6b 656e 203a  tch..    token :
-00004470: 2073 7472 696e 672c 206f 7074 696f 6e61   string, optiona
-00004480: 6c0a 2020 2020 2020 2020 5468 6520 6b65  l.        The ke
-00004490: 7920 7072 6566 6978 2074 6f20 7573 6520  y prefix to use 
-000044a0: 666f 7220 7468 6520 6f75 7470 7574 2061  for the output a
-000044b0: 7272 6179 2e20 4966 206e 6f74 2070 726f  rray. If not pro
-000044c0: 7669 6465 642c 2077 696c 6c20 6265 0a20  vided, will be. 
-000044d0: 2020 2020 2020 2064 6574 6572 6d69 6e65         determine
-000044e0: 6420 6672 6f6d 2074 6865 2066 756e 6374  d from the funct
-000044f0: 696f 6e20 6e61 6d65 2e0a 2020 2020 6e61  ion name..    na
-00004500: 6d65 203a 2073 7472 696e 672c 206f 7074  me : string, opt
-00004510: 696f 6e61 6c0a 2020 2020 2020 2020 5468  ional.        Th
-00004520: 6520 6b65 7920 6e61 6d65 2074 6f20 7573  e key name to us
-00004530: 6520 666f 7220 7468 6520 6f75 7470 7574  e for the output
-00004540: 2061 7272 6179 2e20 4e6f 7465 2074 6861   array. Note tha
-00004550: 7420 7468 6973 2066 756c 6c79 0a20 2020  t this fully.   
-00004560: 2020 2020 2073 7065 6369 6669 6573 2074       specifies t
-00004570: 6865 206f 7574 7075 7420 6b65 7920 6e61  he output key na
-00004580: 6d65 2c20 616e 6420 6d75 7374 2062 6520  me, and must be 
-00004590: 756e 6971 7565 2e20 4966 206e 6f74 2070  unique. If not p
-000045a0: 726f 7669 6465 642c 0a20 2020 2020 2020  rovided,.       
-000045b0: 2077 696c 6c20 6265 2064 6574 6572 6d69   will be determi
-000045c0: 6e65 6420 6279 2061 2068 6173 6820 6f66  ned by a hash of
-000045d0: 2074 6865 2061 7267 756d 656e 7473 2e0a   the arguments..
-000045e0: 2020 2020 6d65 7461 203a 2061 7272 6179      meta : array
-000045f0: 2d6c 696b 652c 206f 7074 696f 6e61 6c0a  -like, optional.
-00004600: 2020 2020 2020 2020 5468 6520 6060 6d65          The ``me
-00004610: 7461 6060 206f 6620 7468 6520 6f75 7470  ta`` of the outp
-00004620: 7574 2061 7272 6179 2c20 7768 656e 2073  ut array, when s
-00004630: 7065 6369 6669 6564 2069 7320 6578 7065  pecified is expe
-00004640: 6374 6564 2074 6f20 6265 2061 6e0a 2020  cted to be an.  
-00004650: 2020 2020 2020 6172 7261 7920 6f66 2074        array of t
-00004660: 6865 2073 616d 6520 7479 7065 2061 6e64  he same type and
-00004670: 2064 7479 7065 206f 6620 7468 6174 2072   dtype of that r
-00004680: 6574 7572 6e65 6420 7768 656e 2063 616c  eturned when cal
-00004690: 6c69 6e67 2060 602e 636f 6d70 7574 6528  ling ``.compute(
-000046a0: 2960 600a 2020 2020 2020 2020 6f6e 2074  )``.        on t
-000046b0: 6865 2061 7272 6179 2072 6574 7572 6e65  he array returne
-000046c0: 6420 6279 2074 6869 7320 6675 6e63 7469  d by this functi
-000046d0: 6f6e 2e20 5768 656e 206e 6f74 2070 726f  on. When not pro
-000046e0: 7669 6465 642c 2060 606d 6574 6160 6020  vided, ``meta`` 
-000046f0: 7769 6c6c 2062 650a 2020 2020 2020 2020  will be.        
-00004700: 696e 6665 7272 6564 2062 7920 6170 706c  inferred by appl
-00004710: 7969 6e67 2074 6865 2066 756e 6374 696f  ying the functio
-00004720: 6e20 746f 2061 2073 6d61 6c6c 2073 6574  n to a small set
-00004730: 206f 6620 6661 6b65 2064 6174 612c 2075   of fake data, u
-00004740: 7375 616c 6c79 2061 0a20 2020 2020 2020  sually a.       
-00004750: 2030 2d64 2061 7272 6179 2e20 4974 2773   0-d array. It's
-00004760: 2069 6d70 6f72 7461 6e74 2074 6f20 656e   important to en
-00004770: 7375 7265 2074 6861 7420 6060 6675 6e63  sure that ``func
-00004780: 6060 2063 616e 2073 7563 6365 7373 6675  `` can successfu
-00004790: 6c6c 7920 636f 6d70 6c65 7465 0a20 2020  lly complete.   
-000047a0: 2020 2020 2063 6f6d 7075 7461 7469 6f6e       computation
-000047b0: 2077 6974 686f 7574 2072 6169 7369 6e67   without raising
-000047c0: 2065 7863 6570 7469 6f6e 7320 7768 656e   exceptions when
-000047d0: 2030 2d64 2069 7320 7061 7373 6564 2074   0-d is passed t
-000047e0: 6f20 6974 2c20 7072 6f76 6964 696e 670a  o it, providing.
-000047f0: 2020 2020 2020 2020 6060 6d65 7461 6060          ``meta``
-00004800: 2077 696c 6c20 6265 2072 6571 7569 7265   will be require
-00004810: 6420 6f74 6865 7277 6973 652e 2049 6620  d otherwise. If 
-00004820: 7468 6520 6f75 7470 7574 2074 7970 6520  the output type 
-00004830: 6973 206b 6e6f 776e 2062 6566 6f72 6568  is known beforeh
-00004840: 616e 640a 2020 2020 2020 2020 2865 2e67  and.        (e.g
-00004850: 2e2c 2060 606e 702e 6e64 6172 7261 7960  ., ``np.ndarray`
-00004860: 602c 2060 6063 7570 792e 6e64 6172 7261  `, ``cupy.ndarra
-00004870: 7960 6029 2c20 616e 2065 6d70 7479 2061  y``), an empty a
-00004880: 7272 6179 206f 6620 7375 6368 2074 7970  rray of such typ
-00004890: 6520 6474 7970 650a 2020 2020 2020 2020  e dtype.        
-000048a0: 6361 6e20 6265 2070 6173 7365 642c 2066  can be passed, f
-000048b0: 6f72 2065 7861 6d70 6c65 3a20 6060 6d65  or example: ``me
-000048c0: 7461 3d6e 702e 6172 7261 7928 2829 2c20  ta=np.array((), 
-000048d0: 6474 7970 653d 6e70 2e69 6e74 3332 2960  dtype=np.int32)`
-000048e0: 602e 0a20 2020 202a 2a6b 7761 7267 7320  `..    **kwargs 
-000048f0: 3a0a 2020 2020 2020 2020 4f74 6865 7220  :.        Other 
-00004900: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-00004910: 7320 746f 2070 6173 7320 746f 2066 756e  s to pass to fun
-00004920: 6374 696f 6e2e 2056 616c 7565 7320 6d75  ction. Values mu
-00004930: 7374 2062 6520 636f 6e73 7461 6e74 730a  st be constants.
-00004940: 2020 2020 2020 2020 286e 6f74 2064 6173          (not das
-00004950: 6b2e 6172 7261 7973 290a 0a20 2020 2053  k.arrays)..    S
-00004960: 6565 2041 6c73 6f0a 2020 2020 2d2d 2d2d  ee Also.    ----
-00004970: 2d2d 2d2d 0a20 2020 2064 6173 6b2e 6172  ----.    dask.ar
-00004980: 7261 792e 6d61 705f 6f76 6572 6c61 7020  ray.map_overlap 
-00004990: 3a20 4765 6e65 7261 6c69 7a65 6420 6f70  : Generalized op
-000049a0: 6572 6174 696f 6e20 7769 7468 206f 7665  eration with ove
-000049b0: 726c 6170 2062 6574 7765 656e 206e 6569  rlap between nei
-000049c0: 6768 626f 7273 2e0a 2020 2020 6461 736b  ghbors..    dask
-000049d0: 2e61 7272 6179 2e62 6c6f 636b 7769 7365  .array.blockwise
-000049e0: 203a 2047 656e 6572 616c 697a 6564 206f   : Generalized o
-000049f0: 7065 7261 7469 6f6e 2077 6974 6820 636f  peration with co
-00004a00: 6e74 726f 6c20 6f76 6572 2062 6c6f 636b  ntrol over block
-00004a10: 2061 6c69 676e 6d65 6e74 2e0a 0a20 2020   alignment...   
-00004a20: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
-00004a30: 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e 2069  ------.    >>> i
-00004a40: 6d70 6f72 7420 6461 736b 2e61 7272 6179  mport dask.array
-00004a50: 2061 7320 6461 0a20 2020 203e 3e3e 2078   as da.    >>> x
-00004a60: 203d 2064 612e 6172 616e 6765 2836 2c20   = da.arange(6, 
-00004a70: 6368 756e 6b73 3d33 290a 0a20 2020 203e  chunks=3)..    >
-00004a80: 3e3e 2078 2e6d 6170 5f62 6c6f 636b 7328  >> x.map_blocks(
-00004a90: 6c61 6d62 6461 2078 3a20 7820 2a20 3229  lambda x: x * 2)
-00004aa0: 2e63 6f6d 7075 7465 2829 0a20 2020 2061  .compute().    a
-00004ab0: 7272 6179 285b 2030 2c20 2032 2c20 2034  rray([ 0,  2,  4
-00004ac0: 2c20 2036 2c20 2038 2c20 3130 5d29 0a0a  ,  6,  8, 10])..
-00004ad0: 2020 2020 5468 6520 6060 6461 2e6d 6170      The ``da.map
-00004ae0: 5f62 6c6f 636b 7360 6020 6675 6e63 7469  _blocks`` functi
-00004af0: 6f6e 2063 616e 2061 6c73 6f20 6163 6365  on can also acce
-00004b00: 7074 206d 756c 7469 706c 6520 6172 7261  pt multiple arra
-00004b10: 7973 2e0a 0a20 2020 203e 3e3e 2064 203d  ys...    >>> d =
-00004b20: 2064 612e 6172 616e 6765 2835 2c20 6368   da.arange(5, ch
-00004b30: 756e 6b73 3d32 290a 2020 2020 3e3e 3e20  unks=2).    >>> 
-00004b40: 6520 3d20 6461 2e61 7261 6e67 6528 352c  e = da.arange(5,
-00004b50: 2063 6875 6e6b 733d 3229 0a0a 2020 2020   chunks=2)..    
-00004b60: 3e3e 3e20 6620 3d20 6461 2e6d 6170 5f62  >>> f = da.map_b
-00004b70: 6c6f 636b 7328 6c61 6d62 6461 2061 2c20  locks(lambda a, 
-00004b80: 623a 2061 202b 2062 2a2a 322c 2064 2c20  b: a + b**2, d, 
-00004b90: 6529 0a20 2020 203e 3e3e 2066 2e63 6f6d  e).    >>> f.com
-00004ba0: 7075 7465 2829 0a20 2020 2061 7272 6179  pute().    array
-00004bb0: 285b 2030 2c20 2032 2c20 2036 2c20 3132  ([ 0,  2,  6, 12
-00004bc0: 2c20 3230 5d29 0a0a 2020 2020 4966 2074  , 20])..    If t
-00004bd0: 6865 2066 756e 6374 696f 6e20 6368 616e  he function chan
-00004be0: 6765 7320 7368 6170 6520 6f66 2074 6865  ges shape of the
-00004bf0: 2062 6c6f 636b 7320 7468 656e 2079 6f75   blocks then you
-00004c00: 206d 7573 7420 7072 6f76 6964 6520 6368   must provide ch
-00004c10: 756e 6b73 0a20 2020 2065 7870 6c69 6369  unks.    explici
-00004c20: 746c 792e 0a0a 2020 2020 3e3e 3e20 7920  tly...    >>> y 
-00004c30: 3d20 782e 6d61 705f 626c 6f63 6b73 286c  = x.map_blocks(l
-00004c40: 616d 6264 6120 783a 2078 5b3a 3a32 5d2c  ambda x: x[::2],
-00004c50: 2063 6875 6e6b 733d 2828 322c 2032 292c   chunks=((2, 2),
-00004c60: 2929 0a0a 2020 2020 596f 7520 6861 7665  ))..    You have
-00004c70: 2061 2062 6974 206f 6620 6672 6565 646f   a bit of freedo
-00004c80: 6d20 696e 2073 7065 6369 6679 696e 6720  m in specifying 
-00004c90: 6368 756e 6b73 2e20 2049 6620 616c 6c20  chunks.  If all 
-00004ca0: 6f66 2074 6865 206f 7574 7075 7420 6368  of the output ch
-00004cb0: 756e 6b0a 2020 2020 7369 7a65 7320 6172  unk.    sizes ar
-00004cc0: 6520 7468 6520 7361 6d65 2c20 796f 7520  e the same, you 
-00004cd0: 6361 6e20 7072 6f76 6964 6520 6a75 7374  can provide just
-00004ce0: 2074 6861 7420 6368 756e 6b20 7369 7a65   that chunk size
-00004cf0: 2061 7320 6120 7369 6e67 6c65 2074 7570   as a single tup
-00004d00: 6c65 2e0a 0a20 2020 203e 3e3e 2061 203d  le...    >>> a =
-00004d10: 2064 612e 6172 616e 6765 2831 382c 2063   da.arange(18, c
-00004d20: 6875 6e6b 733d 2836 2c29 290a 2020 2020  hunks=(6,)).    
-00004d30: 3e3e 3e20 6220 3d20 612e 6d61 705f 626c  >>> b = a.map_bl
-00004d40: 6f63 6b73 286c 616d 6264 6120 783a 2078  ocks(lambda x: x
-00004d50: 5b3a 335d 2c20 6368 756e 6b73 3d28 332c  [:3], chunks=(3,
-00004d60: 2929 0a0a 2020 2020 4966 2074 6865 2066  ))..    If the f
-00004d70: 756e 6374 696f 6e20 6368 616e 6765 7320  unction changes 
-00004d80: 7468 6520 6469 6d65 6e73 696f 6e20 6f66  the dimension of
-00004d90: 2074 6865 2062 6c6f 636b 7320 796f 7520   the blocks you 
-00004da0: 6d75 7374 2073 7065 6369 6679 2074 6865  must specify the
-00004db0: 0a20 2020 2063 7265 6174 6564 206f 7220  .    created or 
-00004dc0: 6465 7374 726f 7965 6420 6469 6d65 6e73  destroyed dimens
-00004dd0: 696f 6e73 2e0a 0a20 2020 203e 3e3e 2062  ions...    >>> b
-00004de0: 203d 2061 2e6d 6170 5f62 6c6f 636b 7328   = a.map_blocks(
-00004df0: 6c61 6d62 6461 2078 3a20 785b 4e6f 6e65  lambda x: x[None
-00004e00: 2c20 3a2c 204e 6f6e 655d 2c20 6368 756e  , :, None], chun
-00004e10: 6b73 3d28 312c 2036 2c20 3129 2c0a 2020  ks=(1, 6, 1),.  
-00004e20: 2020 2e2e 2e20 2020 2020 2020 2020 2020    ...           
-00004e30: 2020 2020 2020 206e 6577 5f61 7869 733d         new_axis=
-00004e40: 5b30 2c20 325d 290a 0a20 2020 2049 6620  [0, 2])..    If 
-00004e50: 6060 6368 756e 6b73 6060 2069 7320 7370  ``chunks`` is sp
-00004e60: 6563 6966 6965 6420 6275 7420 6060 6e65  ecified but ``ne
-00004e70: 775f 6178 6973 6060 2069 7320 6e6f 742c  w_axis`` is not,
-00004e80: 2074 6865 6e20 6974 2069 7320 696e 6665   then it is infe
-00004e90: 7272 6564 2074 6f0a 2020 2020 6164 6420  rred to.    add 
-00004ea0: 7468 6520 6e65 6365 7373 6172 7920 6e75  the necessary nu
-00004eb0: 6d62 6572 206f 6620 6178 6573 206f 6e20  mber of axes on 
-00004ec0: 7468 6520 6c65 6674 2e0a 0a20 2020 204e  the left...    N
-00004ed0: 6f74 6520 7468 6174 2060 606d 6170 5f62  ote that ``map_b
-00004ee0: 6c6f 636b 7328 2960 6020 7769 6c6c 2063  locks()`` will c
-00004ef0: 6f6e 6361 7465 6e61 7465 2063 6875 6e6b  oncatenate chunk
-00004f00: 7320 616c 6f6e 6720 6178 6573 2073 7065  s along axes spe
-00004f10: 6369 6669 6564 2062 790a 2020 2020 7468  cified by.    th
-00004f20: 6520 6b65 7977 6f72 6420 7061 7261 6d65  e keyword parame
-00004f30: 7465 7220 6060 6472 6f70 5f61 7869 7360  ter ``drop_axis`
-00004f40: 6020 7072 696f 7220 746f 2061 7070 6c79  ` prior to apply
-00004f50: 696e 6720 7468 6520 6675 6e63 7469 6f6e  ing the function
-00004f60: 2e0a 2020 2020 5468 6973 2069 7320 696c  ..    This is il
-00004f70: 6c75 7374 7261 7465 6420 696e 2074 6865  lustrated in the
-00004f80: 2066 6967 7572 6520 6265 6c6f 773a 0a0a   figure below:..
-00004f90: 2020 2020 2e2e 2069 6d61 6765 3a3a 202f      .. image:: /
-00004fa0: 696d 6167 6573 2f6d 6170 5f62 6c6f 636b  images/map_block
-00004fb0: 735f 6472 6f70 5f61 7869 732e 706e 670a  s_drop_axis.png.
-00004fc0: 0a20 2020 2044 7565 2074 6f20 6d65 6d6f  .    Due to memo
-00004fd0: 7279 2d73 697a 652d 636f 6e73 7472 6169  ry-size-constrai
-00004fe0: 6e74 732c 2069 7420 6973 206f 6674 656e  nts, it is often
-00004ff0: 206e 6f74 2061 6476 6973 6162 6c65 2074   not advisable t
-00005000: 6f20 7573 6520 6060 6472 6f70 5f61 7869  o use ``drop_axi
-00005010: 7360 600a 2020 2020 6f6e 2061 6e20 6178  s``.    on an ax
-00005020: 6973 2074 6861 7420 6973 2063 6875 6e6b  is that is chunk
-00005030: 6564 2e20 2049 6e20 7468 6174 2063 6173  ed.  In that cas
-00005040: 652c 2069 7420 6973 2062 6574 7465 7220  e, it is better 
-00005050: 6e6f 7420 746f 2075 7365 0a20 2020 2060  not to use.    `
-00005060: 606d 6170 5f62 6c6f 636b 7360 6020 6275  `map_blocks`` bu
-00005070: 7420 7261 7468 6572 0a20 2020 2060 6064  t rather.    ``d
-00005080: 6173 6b2e 6172 7261 792e 7265 6475 6374  ask.array.reduct
-00005090: 696f 6e28 2e2e 2e2c 2061 7869 733d 6472  ion(..., axis=dr
-000050a0: 6f70 7065 645f 6178 6573 2c20 636f 6e63  opped_axes, conc
-000050b0: 6174 656e 6174 653d 4661 6c73 6529 6060  atenate=False)``
-000050c0: 2077 6869 6368 0a20 2020 206d 6169 6e74   which.    maint
-000050d0: 6169 6e73 2061 206c 6561 6e65 7220 6d65  ains a leaner me
-000050e0: 6d6f 7279 2066 6f6f 7470 7269 6e74 2077  mory footprint w
-000050f0: 6869 6c65 2069 7420 6472 6f70 7320 616e  hile it drops an
-00005100: 7920 6178 6973 2e0a 0a20 2020 204d 6170  y axis...    Map
-00005110: 5f62 6c6f 636b 7320 616c 6967 6e73 2062  _blocks aligns b
-00005120: 6c6f 636b 7320 6279 2062 6c6f 636b 2070  locks by block p
-00005130: 6f73 6974 696f 6e73 2077 6974 686f 7574  ositions without
-00005140: 2072 6567 6172 6420 746f 2073 6861 7065   regard to shape
-00005150: 2e20 496e 2074 6865 0a20 2020 2066 6f6c  . In the.    fol
-00005160: 6c6f 7769 6e67 2065 7861 6d70 6c65 2077  lowing example w
-00005170: 6520 6861 7665 2074 776f 2061 7272 6179  e have two array
-00005180: 7320 7769 7468 2074 6865 2073 616d 6520  s with the same 
-00005190: 6e75 6d62 6572 206f 6620 626c 6f63 6b73  number of blocks
-000051a0: 2062 7574 0a20 2020 2077 6974 6820 6469   but.    with di
-000051b0: 6666 6572 656e 7420 7368 6170 6520 616e  fferent shape an
-000051c0: 6420 6368 756e 6b20 7369 7a65 732e 0a0a  d chunk sizes...
-000051d0: 2020 2020 3e3e 3e20 7820 3d20 6461 2e61      >>> x = da.a
-000051e0: 7261 6e67 6528 3130 3030 2c20 6368 756e  range(1000, chun
-000051f0: 6b73 3d28 3130 302c 2929 0a20 2020 203e  ks=(100,)).    >
-00005200: 3e3e 2079 203d 2064 612e 6172 616e 6765  >> y = da.arange
-00005210: 2831 3030 2c20 6368 756e 6b73 3d28 3130  (100, chunks=(10
-00005220: 2c29 290a 0a20 2020 2054 6865 2072 656c  ,))..    The rel
-00005230: 6576 616e 7420 6174 7472 6962 7574 6520  evant attribute 
-00005240: 746f 206d 6174 6368 2069 7320 6e75 6d62  to match is numb
-00005250: 6c6f 636b 732e 0a0a 2020 2020 3e3e 3e20  locks...    >>> 
-00005260: 782e 6e75 6d62 6c6f 636b 730a 2020 2020  x.numblocks.    
-00005270: 2831 302c 290a 2020 2020 3e3e 3e20 792e  (10,).    >>> y.
-00005280: 6e75 6d62 6c6f 636b 730a 2020 2020 2831  numblocks.    (1
-00005290: 302c 290a 0a20 2020 2049 6620 7468 6573  0,)..    If thes
-000052a0: 6520 6d61 7463 6820 2875 7020 746f 2062  e match (up to b
-000052b0: 726f 6164 6361 7374 696e 6720 7275 6c65  roadcasting rule
-000052c0: 7329 2074 6865 6e20 7765 2063 616e 206d  s) then we can m
-000052d0: 6170 2061 7262 6974 7261 7279 0a20 2020  ap arbitrary.   
-000052e0: 2066 756e 6374 696f 6e73 2061 6372 6f73   functions acros
-000052f0: 7320 626c 6f63 6b73 0a0a 2020 2020 3e3e  s blocks..    >>
-00005300: 3e20 6465 6620 6675 6e63 2861 2c20 6229  > def func(a, b)
-00005310: 3a0a 2020 2020 2e2e 2e20 2020 2020 7265  :.    ...     re
-00005320: 7475 726e 206e 702e 6172 7261 7928 5b61  turn np.array([a
-00005330: 2e6d 6178 2829 2c20 622e 6d61 7828 295d  .max(), b.max()]
-00005340: 290a 0a20 2020 203e 3e3e 2064 612e 6d61  )..    >>> da.ma
-00005350: 705f 626c 6f63 6b73 2866 756e 632c 2078  p_blocks(func, x
-00005360: 2c20 792c 2063 6875 6e6b 733d 2832 2c29  , y, chunks=(2,)
-00005370: 2c20 6474 7970 653d 2769 3827 290a 2020  , dtype='i8').  
-00005380: 2020 6461 736b 2e61 7272 6179 3c66 756e    dask.array<fun
-00005390: 632c 2073 6861 7065 3d28 3230 2c29 2c20  c, shape=(20,), 
-000053a0: 6474 7970 653d 696e 7436 342c 2063 6875  dtype=int64, chu
-000053b0: 6e6b 7369 7a65 3d28 322c 292c 2063 6875  nksize=(2,), chu
-000053c0: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
-000053d0: 7272 6179 3e0a 0a20 2020 203e 3e3e 205f  rray>..    >>> _
-000053e0: 2e63 6f6d 7075 7465 2829 0a20 2020 2061  .compute().    a
-000053f0: 7272 6179 285b 2039 392c 2020 2039 2c20  rray([ 99,   9, 
-00005400: 3139 392c 2020 3139 2c20 3239 392c 2020  199,  19, 299,  
-00005410: 3239 2c20 3339 392c 2020 3339 2c20 3439  29, 399,  39, 49
-00005420: 392c 2020 3439 2c20 3539 392c 2020 3539  9,  49, 599,  59
-00005430: 2c20 3639 392c 0a20 2020 2020 2020 2020  , 699,.         
-00005440: 2020 2036 392c 2037 3939 2c20 2037 392c     69, 799,  79,
-00005450: 2038 3939 2c20 2038 392c 2039 3939 2c20   899,  89, 999, 
-00005460: 2039 395d 290a 0a20 2020 2059 6f75 7220   99])..    Your 
-00005470: 626c 6f63 6b20 6675 6e63 7469 6f6e 2063  block function c
-00005480: 616e 2067 6574 2069 6e66 6f72 6d61 7469  an get informati
-00005490: 6f6e 2061 626f 7574 2077 6865 7265 2069  on about where i
-000054a0: 7420 6973 2069 6e20 7468 6520 6172 7261  t is in the arra
-000054b0: 7920 6279 0a20 2020 2061 6363 6570 7469  y by.    accepti
-000054c0: 6e67 2061 2073 7065 6369 616c 2060 6062  ng a special ``b
-000054d0: 6c6f 636b 5f69 6e66 6f60 6020 6f72 2060  lock_info`` or `
-000054e0: 6062 6c6f 636b 5f69 6460 6020 6b65 7977  `block_id`` keyw
-000054f0: 6f72 6420 6172 6775 6d65 6e74 2e0a 2020  ord argument..  
-00005500: 2020 4475 7269 6e67 2063 6f6d 7075 7461    During computa
-00005510: 7469 6f6e 2c20 7468 6579 2077 696c 6c20  tion, they will 
-00005520: 636f 6e74 6169 6e20 696e 666f 726d 6174  contain informat
-00005530: 696f 6e20 6162 6f75 7420 6561 6368 206f  ion about each o
-00005540: 6620 7468 6520 696e 7075 740a 2020 2020  f the input.    
-00005550: 616e 6420 6f75 7470 7574 2063 6875 6e6b  and output chunk
-00005560: 7320 2861 6e64 2064 6173 6b20 6172 7261  s (and dask arra
-00005570: 7973 2920 7265 6c65 7661 6e74 2074 6f20  ys) relevant to 
-00005580: 6561 6368 2063 616c 6c20 6f66 2060 6066  each call of ``f
-00005590: 756e 6360 602e 0a0a 2020 2020 3e3e 3e20  unc``...    >>> 
-000055a0: 6465 6620 6675 6e63 2862 6c6f 636b 5f69  def func(block_i
-000055b0: 6e66 6f3d 4e6f 6e65 293a 0a20 2020 202e  nfo=None):.    .
-000055c0: 2e2e 2020 2020 2070 6173 730a 0a20 2020  ..     pass..   
-000055d0: 2054 6869 7320 7769 6c6c 2072 6563 6569   This will recei
-000055e0: 7665 2074 6865 2066 6f6c 6c6f 7769 6e67  ve the following
-000055f0: 2069 6e66 6f72 6d61 7469 6f6e 3a0a 0a20   information:.. 
-00005600: 2020 203e 3e3e 2062 6c6f 636b 5f69 6e66     >>> block_inf
-00005610: 6f20 2023 2064 6f63 7465 7374 3a20 2b53  o  # doctest: +S
-00005620: 4b49 500a 2020 2020 7b30 3a20 7b27 7368  KIP.    {0: {'sh
-00005630: 6170 6527 3a20 2831 3030 302c 292c 0a20  ape': (1000,),. 
-00005640: 2020 2020 2020 2020 276e 756d 2d63 6875          'num-chu
-00005650: 6e6b 7327 3a20 2831 302c 292c 0a20 2020  nks': (10,),.   
-00005660: 2020 2020 2020 2763 6875 6e6b 2d6c 6f63        'chunk-loc
-00005670: 6174 696f 6e27 3a20 2834 2c29 2c0a 2020  ation': (4,),.  
-00005680: 2020 2020 2020 2027 6172 7261 792d 6c6f         'array-lo
-00005690: 6361 7469 6f6e 273a 205b 2834 3030 2c20  cation': [(400, 
-000056a0: 3530 3029 5d7d 2c0a 2020 2020 204e 6f6e  500)]},.     Non
-000056b0: 653a 207b 2773 6861 7065 273a 2028 3130  e: {'shape': (10
-000056c0: 3030 2c29 2c0a 2020 2020 2020 2020 2020  00,),.          
-000056d0: 2020 276e 756d 2d63 6875 6e6b 7327 3a20    'num-chunks': 
-000056e0: 2831 302c 292c 0a20 2020 2020 2020 2020  (10,),.         
-000056f0: 2020 2027 6368 756e 6b2d 6c6f 6361 7469     'chunk-locati
-00005700: 6f6e 273a 2028 342c 292c 0a20 2020 2020  on': (4,),.     
-00005710: 2020 2020 2020 2027 6172 7261 792d 6c6f         'array-lo
-00005720: 6361 7469 6f6e 273a 205b 2834 3030 2c20  cation': [(400, 
-00005730: 3530 3029 5d2c 0a20 2020 2020 2020 2020  500)],.         
-00005740: 2020 2027 6368 756e 6b2d 7368 6170 6527     'chunk-shape'
-00005750: 3a20 2831 3030 2c29 2c0a 2020 2020 2020  : (100,),.      
-00005760: 2020 2020 2020 2764 7479 7065 273a 2064        'dtype': d
-00005770: 7479 7065 2827 666c 6f61 7436 3427 297d  type('float64')}
-00005780: 7d0a 0a20 2020 2054 6865 206b 6579 7320  }..    The keys 
-00005790: 746f 2074 6865 2060 6062 6c6f 636b 5f69  to the ``block_i
-000057a0: 6e66 6f60 6020 6469 6374 696f 6e61 7279  nfo`` dictionary
-000057b0: 2069 6e64 6963 6174 6520 7768 6963 6820   indicate which 
-000057c0: 6973 2074 6865 2069 6e70 7574 2061 6e64  is the input and
-000057d0: 0a20 2020 206f 7574 7075 7420 4461 736b  .    output Dask
-000057e0: 2061 7272 6179 3a0a 0a20 2020 202d 202a   array:..    - *
-000057f0: 2a49 6e70 7574 2044 6173 6b20 6172 7261  *Input Dask arra
-00005800: 7928 7329 3a2a 2a20 6060 626c 6f63 6b5f  y(s):** ``block_
-00005810: 696e 666f 5b30 5d60 6020 7265 6665 7273  info[0]`` refers
-00005820: 2074 6f20 7468 6520 6669 7273 7420 696e   to the first in
-00005830: 7075 7420 4461 736b 2061 7272 6179 2e0a  put Dask array..
-00005840: 2020 2020 2020 5468 6520 6469 6374 696f        The dictio
-00005850: 6e61 7279 206b 6579 2069 7320 6060 3060  nary key is ``0`
-00005860: 6020 6265 6361 7573 6520 7468 6174 2069  ` because that i
-00005870: 7320 7468 6520 6172 6775 6d65 6e74 2069  s the argument i
-00005880: 6e64 6578 2063 6f72 7265 7370 6f6e 6469  ndex correspondi
-00005890: 6e67 0a20 2020 2020 2074 6f20 7468 6520  ng.      to the 
-000058a0: 6669 7273 7420 696e 7075 7420 4461 736b  first input Dask
-000058b0: 2061 7272 6179 2e0a 2020 2020 2020 496e   array..      In
-000058c0: 2063 6173 6573 2077 6865 7265 206d 756c   cases where mul
-000058d0: 7469 706c 6520 4461 736b 2061 7272 6179  tiple Dask array
-000058e0: 7320 6861 7665 2062 6565 6e20 7061 7373  s have been pass
-000058f0: 6564 2061 7320 696e 7075 7420 746f 2074  ed as input to t
-00005900: 6865 2066 756e 6374 696f 6e2c 0a20 2020  he function,.   
-00005910: 2020 2079 6f75 2063 616e 2061 6363 6573     you can acces
-00005920: 7320 7468 656d 2077 6974 6820 7468 6520  s them with the 
-00005930: 6e75 6d62 6572 2063 6f72 7265 7370 6f6e  number correspon
-00005940: 6469 6e67 2074 6f20 7468 6520 696e 7075  ding to the inpu
-00005950: 7420 6172 6775 6d65 6e74 2c0a 2020 2020  t argument,.    
-00005960: 2020 6567 3a20 6060 626c 6f63 6b5f 696e    eg: ``block_in
-00005970: 666f 5b31 5d60 602c 2060 6062 6c6f 636b  fo[1]``, ``block
-00005980: 5f69 6e66 6f5b 325d 6060 2c20 6574 632e  _info[2]``, etc.
-00005990: 0a20 2020 2020 2028 4e6f 7465 2074 6861  .      (Note tha
-000059a0: 7420 6966 2079 6f75 2070 6173 7320 6d75  t if you pass mu
-000059b0: 6c74 6970 6c65 2044 6173 6b20 6172 7261  ltiple Dask arra
-000059c0: 7973 2061 7320 696e 7075 7420 746f 206d  ys as input to m
-000059d0: 6170 5f62 6c6f 636b 732c 0a20 2020 2020  ap_blocks,.     
-000059e0: 2074 6865 2061 7272 6179 7320 6d75 7374   the arrays must
-000059f0: 206d 6174 6368 2065 6163 6820 6f74 6865   match each othe
-00005a00: 7220 6279 2068 6176 696e 6720 6d61 7463  r by having matc
-00005a10: 6869 6e67 206e 756d 6265 7273 206f 6620  hing numbers of 
-00005a20: 6368 756e 6b73 2c0a 2020 2020 2020 616c  chunks,.      al
-00005a30: 6f6e 6720 636f 7272 6573 706f 6e64 696e  ong correspondin
-00005a40: 6720 6469 6d65 6e73 696f 6e73 2075 7020  g dimensions up 
-00005a50: 746f 2062 726f 6164 6361 7374 696e 6720  to broadcasting 
-00005a60: 7275 6c65 732e 290a 2020 2020 2d20 2a2a  rules.).    - **
-00005a70: 4f75 7470 7574 2044 6173 6b20 6172 7261  Output Dask arra
-00005a80: 793a 2a2a 2060 6062 6c6f 636b 5f69 6e66  y:** ``block_inf
-00005a90: 6f5b 4e6f 6e65 5d60 6020 7265 6665 7273  o[None]`` refers
-00005aa0: 2074 6f20 7468 6520 6f75 7470 7574 2044   to the output D
-00005ab0: 6173 6b20 6172 7261 792c 0a20 2020 2020  ask array,.     
-00005ac0: 2061 6e64 2063 6f6e 7461 696e 7320 696e   and contains in
-00005ad0: 666f 726d 6174 696f 6e20 6162 6f75 7420  formation about 
-00005ae0: 7468 6520 6f75 7470 7574 2063 6875 6e6b  the output chunk
-00005af0: 732e 0a20 2020 2020 2054 6865 206f 7574  s..      The out
-00005b00: 7075 7420 6368 756e 6b20 7368 6170 6520  put chunk shape 
-00005b10: 616e 6420 6474 7970 6520 6d61 7920 6d61  and dtype may ma
-00005b20: 7920 6265 2064 6966 6665 7265 6e74 2074  y be different t
-00005b30: 6861 6e20 7468 6520 696e 7075 7420 6368  han the input ch
-00005b40: 756e 6b73 2e0a 0a20 2020 2046 6f72 2065  unks...    For e
-00005b50: 6163 6820 6461 736b 2061 7272 6179 2c20  ach dask array, 
-00005b60: 6060 626c 6f63 6b5f 696e 666f 6060 2064  ``block_info`` d
-00005b70: 6573 6372 6962 6573 3a0a 0a20 2020 202d  escribes:..    -
-00005b80: 2060 6073 6861 7065 6060 3a20 7468 6520   ``shape``: the 
-00005b90: 7368 6170 6520 6f66 2074 6865 2066 756c  shape of the ful
-00005ba0: 6c20 4461 736b 2061 7272 6179 2c0a 2020  l Dask array,.  
-00005bb0: 2020 2d20 6060 6e75 6d2d 6368 756e 6b73    - ``num-chunks
-00005bc0: 6060 3a20 7468 6520 6e75 6d62 6572 206f  ``: the number o
-00005bd0: 6620 6368 756e 6b73 206f 6620 7468 6520  f chunks of the 
-00005be0: 6675 6c6c 2061 7272 6179 2069 6e20 6561  full array in ea
-00005bf0: 6368 2064 696d 656e 7369 6f6e 2c0a 2020  ch dimension,.  
-00005c00: 2020 2d20 6060 6368 756e 6b2d 6c6f 6361    - ``chunk-loca
-00005c10: 7469 6f6e 6060 3a20 7468 6520 6368 756e  tion``: the chun
-00005c20: 6b20 6c6f 6361 7469 6f6e 2028 666f 7220  k location (for 
-00005c30: 6578 616d 706c 6520 7468 6520 666f 7572  example the four
-00005c40: 7468 2063 6875 6e6b 206f 7665 720a 2020  th chunk over.  
-00005c50: 2020 2020 696e 2074 6865 2066 6972 7374      in the first
-00005c60: 2064 696d 656e 7369 6f6e 292c 2061 6e64   dimension), and
-00005c70: 0a20 2020 202d 2060 6061 7272 6179 2d6c  .    - ``array-l
-00005c80: 6f63 6174 696f 6e60 603a 2074 6865 2061  ocation``: the a
-00005c90: 7272 6179 206c 6f63 6174 696f 6e20 7769  rray location wi
-00005ca0: 7468 696e 2074 6865 2066 756c 6c20 4461  thin the full Da
-00005cb0: 736b 2061 7272 6179 0a20 2020 2020 2028  sk array.      (
-00005cc0: 666f 7220 6578 616d 706c 6520 7468 6520  for example the 
-00005cd0: 736c 6963 6520 636f 7272 6573 706f 6e64  slice correspond
-00005ce0: 696e 6720 746f 2060 6034 303a 3530 6060  ing to ``40:50``
-00005cf0: 292e 0a0a 2020 2020 496e 2061 6464 6974  )...    In addit
-00005d00: 696f 6e20 746f 2074 6865 7365 2c20 7468  ion to these, th
-00005d10: 6572 6520 6172 6520 7477 6f20 6578 7472  ere are two extr
-00005d20: 6120 7061 7261 6d65 7465 7273 2064 6573  a parameters des
-00005d30: 6372 6962 6564 2062 790a 2020 2020 6060  cribed by.    ``
-00005d40: 626c 6f63 6b5f 696e 666f 6060 2066 6f72  block_info`` for
-00005d50: 2074 6865 206f 7574 7075 7420 6172 7261   the output arra
-00005d60: 7920 2869 6e20 6060 626c 6f63 6b5f 696e  y (in ``block_in
-00005d70: 666f 5b4e 6f6e 655d 6060 293a 0a0a 2020  fo[None]``):..  
-00005d80: 2020 2d20 6060 6368 756e 6b2d 7368 6170    - ``chunk-shap
-00005d90: 6560 603a 2074 6865 206f 7574 7075 7420  e``: the output 
-00005da0: 6368 756e 6b20 7368 6170 652c 2061 6e64  chunk shape, and
-00005db0: 0a20 2020 202d 2060 6064 7479 7065 6060  .    - ``dtype``
-00005dc0: 3a20 7468 6520 6f75 7470 7574 2064 7479  : the output dty
-00005dd0: 7065 2e0a 0a20 2020 2054 6865 7365 2066  pe...    These f
-00005de0: 6561 7475 7265 7320 6361 6e20 6265 2063  eatures can be c
-00005df0: 6f6d 6269 6e65 6420 746f 2073 796e 7468  ombined to synth
-00005e00: 6573 697a 6520 616e 2061 7272 6179 2066  esize an array f
-00005e10: 726f 6d20 7363 7261 7463 682c 2066 6f72  rom scratch, for
-00005e20: 0a20 2020 2065 7861 6d70 6c65 3a0a 0a20  .    example:.. 
-00005e30: 2020 203e 3e3e 2064 6566 2066 756e 6328     >>> def func(
-00005e40: 626c 6f63 6b5f 696e 666f 3d4e 6f6e 6529  block_info=None)
-00005e50: 3a0a 2020 2020 2e2e 2e20 2020 2020 6c6f  :.    ...     lo
-00005e60: 6320 3d20 626c 6f63 6b5f 696e 666f 5b4e  c = block_info[N
-00005e70: 6f6e 655d 5b27 6172 7261 792d 6c6f 6361  one]['array-loca
-00005e80: 7469 6f6e 275d 5b30 5d0a 2020 2020 2e2e  tion'][0].    ..
-00005e90: 2e20 2020 2020 7265 7475 726e 206e 702e  .     return np.
-00005ea0: 6172 616e 6765 286c 6f63 5b30 5d2c 206c  arange(loc[0], l
-00005eb0: 6f63 5b31 5d29 0a0a 2020 2020 3e3e 3e20  oc[1])..    >>> 
-00005ec0: 6461 2e6d 6170 5f62 6c6f 636b 7328 6675  da.map_blocks(fu
-00005ed0: 6e63 2c20 6368 756e 6b73 3d28 2834 2c20  nc, chunks=((4, 
-00005ee0: 3429 2c29 2c20 6474 7970 653d 6e70 2e66  4),), dtype=np.f
-00005ef0: 6c6f 6174 3634 290a 2020 2020 6461 736b  loat64).    dask
-00005f00: 2e61 7272 6179 3c66 756e 632c 2073 6861  .array<func, sha
-00005f10: 7065 3d28 382c 292c 2064 7479 7065 3d66  pe=(8,), dtype=f
-00005f20: 6c6f 6174 3634 2c20 6368 756e 6b73 697a  loat64, chunksiz
-00005f30: 653d 2834 2c29 2c20 6368 756e 6b74 7970  e=(4,), chunktyp
-00005f40: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
-00005f50: 0a0a 2020 2020 3e3e 3e20 5f2e 636f 6d70  ..    >>> _.comp
-00005f60: 7574 6528 290a 2020 2020 6172 7261 7928  ute().    array(
-00005f70: 5b30 2c20 312c 2032 2c20 332c 2034 2c20  [0, 1, 2, 3, 4, 
-00005f80: 352c 2036 2c20 375d 290a 0a20 2020 2060  5, 6, 7])..    `
-00005f90: 6062 6c6f 636b 5f69 6460 6020 6973 2073  `block_id`` is s
-00005fa0: 696d 696c 6172 2074 6f20 6060 626c 6f63  imilar to ``bloc
-00005fb0: 6b5f 696e 666f 6060 2062 7574 2063 6f6e  k_info`` but con
-00005fc0: 7461 696e 7320 6f6e 6c79 2074 6865 2060  tains only the `
-00005fd0: 6063 6875 6e6b 5f6c 6f63 6174 696f 6e60  `chunk_location`
-00005fe0: 603a 0a0a 2020 2020 3e3e 3e20 6465 6620  `:..    >>> def 
-00005ff0: 6675 6e63 2862 6c6f 636b 5f69 643d 4e6f  func(block_id=No
-00006000: 6e65 293a 0a20 2020 202e 2e2e 2020 2020  ne):.    ...    
-00006010: 2070 6173 730a 0a20 2020 2054 6869 7320   pass..    This 
-00006020: 7769 6c6c 2072 6563 6569 7665 2074 6865  will receive the
-00006030: 2066 6f6c 6c6f 7769 6e67 2069 6e66 6f72   following infor
-00006040: 6d61 7469 6f6e 3a0a 0a20 2020 203e 3e3e  mation:..    >>>
-00006050: 2062 6c6f 636b 5f69 6420 2023 2064 6f63   block_id  # doc
-00006060: 7465 7374 3a20 2b53 4b49 500a 2020 2020  test: +SKIP.    
-00006070: 2834 2c20 3329 0a0a 2020 2020 596f 7520  (4, 3)..    You 
-00006080: 6d61 7920 7370 6563 6966 7920 7468 6520  may specify the 
-00006090: 6b65 7920 6e61 6d65 2070 7265 6669 7820  key name prefix 
-000060a0: 6f66 2074 6865 2072 6573 756c 7469 6e67  of the resulting
-000060b0: 2074 6173 6b20 696e 2074 6865 2067 7261   task in the gra
-000060c0: 7068 2077 6974 680a 2020 2020 7468 6520  ph with.    the 
-000060d0: 6f70 7469 6f6e 616c 2060 6074 6f6b 656e  optional ``token
-000060e0: 6060 206b 6579 776f 7264 2061 7267 756d  `` keyword argum
-000060f0: 656e 742e 0a0a 2020 2020 3e3e 3e20 782e  ent...    >>> x.
-00006100: 6d61 705f 626c 6f63 6b73 286c 616d 6264  map_blocks(lambd
-00006110: 6120 783a 2078 202b 2031 2c20 6e61 6d65  a x: x + 1, name
-00006120: 3d27 696e 6372 656d 656e 7427 290a 2020  ='increment').  
-00006130: 2020 6461 736b 2e61 7272 6179 3c69 6e63    dask.array<inc
-00006140: 7265 6d65 6e74 2c20 7368 6170 653d 2831  rement, shape=(1
-00006150: 3030 302c 292c 2064 7479 7065 3d69 6e74  000,), dtype=int
-00006160: 3634 2c20 6368 756e 6b73 697a 653d 2831  64, chunksize=(1
-00006170: 3030 2c29 2c20 6368 756e 6b74 7970 653d  00,), chunktype=
-00006180: 6e75 6d70 792e 6e64 6172 7261 793e 0a0a  numpy.ndarray>..
-00006190: 2020 2020 466f 7220 6675 6e63 7469 6f6e      For function
-000061a0: 7320 7468 6174 206d 6179 206e 6f74 2068  s that may not h
-000061b0: 616e 646c 6520 302d 6420 6172 7261 7973  andle 0-d arrays
-000061c0: 2c20 6974 2773 2061 6c73 6f20 706f 7373  , it's also poss
-000061d0: 6962 6c65 2074 6f20 7370 6563 6966 790a  ible to specify.
-000061e0: 2020 2020 6060 6d65 7461 6060 2077 6974      ``meta`` wit
-000061f0: 6820 616e 2065 6d70 7479 2061 7272 6179  h an empty array
-00006200: 206d 6174 6368 696e 6720 7468 6520 7479   matching the ty
-00006210: 7065 206f 6620 7468 6520 6578 7065 6374  pe of the expect
-00006220: 6564 2072 6573 756c 742e 2049 6e0a 2020  ed result. In.  
-00006230: 2020 7468 6520 6578 616d 706c 6520 6265    the example be
-00006240: 6c6f 772c 2060 6066 756e 6360 6020 7769  low, ``func`` wi
-00006250: 6c6c 2072 6573 756c 7420 696e 2061 6e20  ll result in an 
-00006260: 6060 496e 6465 7845 7272 6f72 6060 2077  ``IndexError`` w
-00006270: 6865 6e20 636f 6d70 7574 696e 670a 2020  hen computing.  
-00006280: 2020 6060 6d65 7461 6060 3a0a 0a20 2020    ``meta``:..   
-00006290: 203e 3e3e 2072 6e67 203d 2064 612e 7261   >>> rng = da.ra
-000062a0: 6e64 6f6d 2e64 6566 6175 6c74 5f72 6e67  ndom.default_rng
-000062b0: 2829 0a20 2020 203e 3e3e 2064 612e 6d61  ().    >>> da.ma
-000062c0: 705f 626c 6f63 6b73 286c 616d 6264 6120  p_blocks(lambda 
-000062d0: 783a 2078 5b32 5d2c 2072 6e67 2e72 616e  x: x[2], rng.ran
-000062e0: 646f 6d28 3529 2c20 6d65 7461 3d6e 702e  dom(5), meta=np.
-000062f0: 6172 7261 7928 2829 2929 0a20 2020 2064  array(())).    d
-00006300: 6173 6b2e 6172 7261 793c 6c61 6d62 6461  ask.array<lambda
-00006310: 2c20 7368 6170 653d 2835 2c29 2c20 6474  , shape=(5,), dt
-00006320: 7970 653d 666c 6f61 7436 342c 2063 6875  ype=float64, chu
-00006330: 6e6b 7369 7a65 3d28 352c 292c 2063 6875  nksize=(5,), chu
-00006340: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
-00006350: 7272 6179 3e0a 0a20 2020 2053 696d 696c  rray>..    Simil
-00006360: 6172 6c79 2c20 6974 2773 2070 6f73 7369  arly, it's possi
-00006370: 626c 6520 746f 2073 7065 6369 6679 2061  ble to specify a
-00006380: 206e 6f6e 2d4e 756d 5079 2061 7272 6179   non-NumPy array
-00006390: 2074 6f20 6060 6d65 7461 6060 2c20 616e   to ``meta``, an
-000063a0: 6420 7072 6f76 6964 650a 2020 2020 6120  d provide.    a 
-000063b0: 6060 6474 7970 6560 603a 0a0a 2020 2020  ``dtype``:..    
-000063c0: 3e3e 3e20 696d 706f 7274 2063 7570 7920  >>> import cupy 
-000063d0: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
-000063e0: 500a 2020 2020 3e3e 3e20 726e 6720 3d20  P.    >>> rng = 
-000063f0: 6461 2e72 616e 646f 6d2e 6465 6661 756c  da.random.defaul
-00006400: 745f 726e 6728 6375 7079 2e72 616e 646f  t_rng(cupy.rando
-00006410: 6d2e 6465 6661 756c 745f 726e 6728 2929  m.default_rng())
-00006420: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
-00006430: 4950 0a20 2020 203e 3e3e 2064 7420 3d20  IP.    >>> dt = 
-00006440: 6e70 2e66 6c6f 6174 3332 0a20 2020 203e  np.float32.    >
-00006450: 3e3e 2064 612e 6d61 705f 626c 6f63 6b73  >> da.map_blocks
-00006460: 286c 616d 6264 6120 783a 2078 5b32 5d2c  (lambda x: x[2],
-00006470: 2072 6e67 2e72 616e 646f 6d28 352c 2064   rng.random(5, d
-00006480: 7479 7065 3d64 7429 2c20 6d65 7461 3d63  type=dt), meta=c
-00006490: 7570 792e 6172 7261 7928 2829 2c20 6474  upy.array((), dt
-000064a0: 7970 653d 6474 2929 2020 2320 646f 6374  ype=dt))  # doct
-000064b0: 6573 743a 202b 534b 4950 0a20 2020 2064  est: +SKIP.    d
-000064c0: 6173 6b2e 6172 7261 793c 6c61 6d62 6461  ask.array<lambda
-000064d0: 2c20 7368 6170 653d 2835 2c29 2c20 6474  , shape=(5,), dt
-000064e0: 7970 653d 666c 6f61 7433 322c 2063 6875  ype=float32, chu
-000064f0: 6e6b 7369 7a65 3d28 352c 292c 2063 6875  nksize=(5,), chu
-00006500: 6e6b 7479 7065 3d63 7570 792e 6e64 6172  nktype=cupy.ndar
-00006510: 7261 793e 0a20 2020 2022 2222 0a20 2020  ray>.    """.   
-00006520: 2069 6620 6472 6f70 5f61 7869 7320 6973   if drop_axis is
-00006530: 204e 6f6e 653a 0a20 2020 2020 2020 2064   None:.        d
-00006540: 726f 705f 6178 6973 203d 205b 5d0a 0a20  rop_axis = [].. 
-00006550: 2020 2069 6620 6e6f 7420 6361 6c6c 6162     if not callab
-00006560: 6c65 2866 756e 6329 3a0a 2020 2020 2020  le(func):.      
-00006570: 2020 6d73 6720 3d20 280a 2020 2020 2020    msg = (.      
-00006580: 2020 2020 2020 2246 6972 7374 2061 7267        "First arg
-00006590: 756d 656e 7420 6d75 7374 2062 6520 6361  ument must be ca
-000065a0: 6c6c 6162 6c65 2066 756e 6374 696f 6e2c  llable function,
-000065b0: 206e 6f74 2025 735c 6e22 0a20 2020 2020   not %s\n".     
-000065c0: 2020 2020 2020 2022 5573 6167 653a 2020         "Usage:  
-000065d0: 2064 612e 6d61 705f 626c 6f63 6b73 2866   da.map_blocks(f
-000065e0: 756e 6374 696f 6e2c 2078 295c 6e22 0a20  unction, x)\n". 
-000065f0: 2020 2020 2020 2020 2020 2022 2020 206f             "   o
-00006600: 723a 2020 2064 612e 6d61 705f 626c 6f63  r:   da.map_bloc
-00006610: 6b73 2866 756e 6374 696f 6e2c 2078 2c20  ks(function, x, 
-00006620: 792c 207a 2922 0a20 2020 2020 2020 2029  y, z)".        )
-00006630: 0a20 2020 2020 2020 2072 6169 7365 2054  .        raise T
-00006640: 7970 6545 7272 6f72 286d 7367 2025 2074  ypeError(msg % t
-00006650: 7970 6528 6675 6e63 292e 5f5f 6e61 6d65  ype(func).__name
-00006660: 5f5f 290a 2020 2020 6966 2074 6f6b 656e  __).    if token
-00006670: 3a0a 2020 2020 2020 2020 7761 726e 696e  :.        warnin
-00006680: 6773 2e77 6172 6e28 0a20 2020 2020 2020  gs.warn(.       
-00006690: 2020 2020 2022 5468 6520 6074 6f6b 656e       "The `token
-000066a0: 3d60 206b 6579 776f 7264 2074 6f20 606d  =` keyword to `m
-000066b0: 6170 5f62 6c6f 636b 7360 2068 6173 2062  ap_blocks` has b
-000066c0: 6565 6e20 6d6f 7665 6420 746f 2060 6e61  een moved to `na
-000066d0: 6d65 3d60 2e20 220a 2020 2020 2020 2020  me=`. ".        
-000066e0: 2020 2020 2250 6c65 6173 6520 7573 6520      "Please use 
-000066f0: 606e 616d 653d 6020 696e 7374 6561 6420  `name=` instead 
-00006700: 6173 2074 6865 2060 746f 6b65 6e3d 6020  as the `token=` 
-00006710: 6b65 7977 6f72 6420 7769 6c6c 2062 6520  keyword will be 
-00006720: 7265 6d6f 7665 6420 220a 2020 2020 2020  removed ".      
-00006730: 2020 2020 2020 2269 6e20 6120 6675 7475        "in a futu
-00006740: 7265 2072 656c 6561 7365 2e22 2c0a 2020  re release.",.  
-00006750: 2020 2020 2020 2020 2020 6361 7465 676f            catego
-00006760: 7279 3d46 7574 7572 6557 6172 6e69 6e67  ry=FutureWarning
-00006770: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-00006780: 2020 2020 6e61 6d65 203d 2074 6f6b 656e      name = token
-00006790: 0a0a 2020 2020 6e61 6d65 203d 2066 227b  ..    name = f"{
-000067a0: 6e61 6d65 206f 7220 6675 6e63 6e61 6d65  name or funcname
-000067b0: 2866 756e 6329 7d2d 7b74 6f6b 656e 697a  (func)}-{tokeniz
-000067c0: 6528 6675 6e63 2c20 6474 7970 652c 2063  e(func, dtype, c
-000067d0: 6875 6e6b 732c 2064 726f 705f 6178 6973  hunks, drop_axis
-000067e0: 2c20 6e65 775f 6178 6973 2c20 2a61 7267  , new_axis, *arg
-000067f0: 732c 202a 2a6b 7761 7267 7329 7d22 0a20  s, **kwargs)}". 
-00006800: 2020 206e 6577 5f61 7865 7320 3d20 7b7d     new_axes = {}
-00006810: 0a0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
-00006820: 6e63 6528 6472 6f70 5f61 7869 732c 204e  nce(drop_axis, N
-00006830: 756d 6265 7229 3a0a 2020 2020 2020 2020  umber):.        
-00006840: 6472 6f70 5f61 7869 7320 3d20 5b64 726f  drop_axis = [dro
-00006850: 705f 6178 6973 5d0a 2020 2020 6966 2069  p_axis].    if i
-00006860: 7369 6e73 7461 6e63 6528 6e65 775f 6178  sinstance(new_ax
-00006870: 6973 2c20 4e75 6d62 6572 293a 0a20 2020  is, Number):.   
-00006880: 2020 2020 206e 6577 5f61 7869 7320 3d20       new_axis = 
-00006890: 5b6e 6577 5f61 7869 735d 2020 2320 544f  [new_axis]  # TO
-000068a0: 444f 3a20 6861 6e64 6c65 206e 6577 5f61  DO: handle new_a
-000068b0: 7869 730a 0a20 2020 2061 7272 7320 3d20  xis..    arrs = 
-000068c0: 5b61 2066 6f72 2061 2069 6e20 6172 6773  [a for a in args
-000068d0: 2069 6620 6973 696e 7374 616e 6365 2861   if isinstance(a
-000068e0: 2c20 4172 7261 7929 5d0a 0a20 2020 2061  , Array)]..    a
-000068f0: 7267 7061 6972 7320 3d20 5b0a 2020 2020  rgpairs = [.    
-00006900: 2020 2020 2861 2c20 7475 706c 6528 7261      (a, tuple(ra
-00006910: 6e67 6528 612e 6e64 696d 2929 5b3a 3a2d  nge(a.ndim))[::-
-00006920: 315d 2920 6966 2069 7369 6e73 7461 6e63  1]) if isinstanc
-00006930: 6528 612c 2041 7272 6179 2920 656c 7365  e(a, Array) else
-00006940: 2028 612c 204e 6f6e 6529 0a20 2020 2020   (a, None).     
-00006950: 2020 2066 6f72 2061 2069 6e20 6172 6773     for a in args
-00006960: 0a20 2020 205d 0a20 2020 2069 6620 6172  .    ].    if ar
-00006970: 7273 3a0a 2020 2020 2020 2020 6f75 745f  rs:.        out_
-00006980: 696e 6420 3d20 7475 706c 6528 7261 6e67  ind = tuple(rang
-00006990: 6528 6d61 7828 612e 6e64 696d 2066 6f72  e(max(a.ndim for
-000069a0: 2061 2069 6e20 6172 7273 2929 295b 3a3a   a in arrs)))[::
-000069b0: 2d31 5d0a 2020 2020 656c 7365 3a0a 2020  -1].    else:.  
-000069c0: 2020 2020 2020 6f75 745f 696e 6420 3d20        out_ind = 
-000069d0: 2829 0a0a 2020 2020 6f72 6967 696e 616c  ()..    original
-000069e0: 5f6b 7761 7267 7320 3d20 6b77 6172 6773  _kwargs = kwargs
-000069f0: 0a0a 2020 2020 6966 2064 7479 7065 2069  ..    if dtype i
-00006a00: 7320 4e6f 6e65 2061 6e64 206d 6574 6120  s None and meta 
-00006a10: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00006a20: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00006a30: 2020 6d65 7461 203d 2063 6f6d 7075 7465    meta = compute
-00006a40: 5f6d 6574 6128 6675 6e63 2c20 6474 7970  _meta(func, dtyp
-00006a50: 652c 202a 6172 6773 2c20 2a2a 6b77 6172  e, *args, **kwar
-00006a60: 6773 290a 2020 2020 2020 2020 6578 6365  gs).        exce
-00006a70: 7074 2045 7863 6570 7469 6f6e 3a0a 2020  pt Exception:.  
-00006a80: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
-00006a90: 2020 2020 2020 2020 6474 7970 6520 3d20          dtype = 
-00006aa0: 6170 706c 795f 696e 6665 725f 6474 7970  apply_infer_dtyp
-00006ab0: 6528 6675 6e63 2c20 6172 6773 2c20 6f72  e(func, args, or
-00006ac0: 6967 696e 616c 5f6b 7761 7267 732c 2022  iginal_kwargs, "
-00006ad0: 6d61 705f 626c 6f63 6b73 2229 0a0a 2020  map_blocks")..  
-00006ae0: 2020 6966 2064 726f 705f 6178 6973 3a0a    if drop_axis:.
-00006af0: 2020 2020 2020 2020 6e64 696d 5f6f 7574          ndim_out
-00006b00: 203d 206c 656e 286f 7574 5f69 6e64 290a   = len(out_ind).
-00006b10: 2020 2020 2020 2020 6966 2061 6e79 2869          if any(i
-00006b20: 203c 202d 6e64 696d 5f6f 7574 206f 7220   < -ndim_out or 
-00006b30: 6920 3e3d 206e 6469 6d5f 6f75 7420 666f  i >= ndim_out fo
-00006b40: 7220 6920 696e 2064 726f 705f 6178 6973  r i in drop_axis
-00006b50: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00006b60: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00006b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006b80: 2066 2264 726f 705f 6178 6973 206f 7574   f"drop_axis out
-00006b90: 206f 6620 7261 6e67 6520 2864 726f 705f   of range (drop_
-00006ba0: 6178 6973 3d7b 6472 6f70 5f61 7869 737d  axis={drop_axis}
-00006bb0: 2c20 220a 2020 2020 2020 2020 2020 2020  , ".            
-00006bc0: 2020 2020 6622 6275 7420 6f75 7470 7574      f"but output
-00006bd0: 2069 7320 7b6e 6469 6d5f 6f75 747d 6429   is {ndim_out}d)
-00006be0: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
-00006bf0: 0a20 2020 2020 2020 2064 726f 705f 6178  .        drop_ax
-00006c00: 6973 203d 205b 6920 2520 6e64 696d 5f6f  is = [i % ndim_o
-00006c10: 7574 2066 6f72 2069 2069 6e20 6472 6f70  ut for i in drop
-00006c20: 5f61 7869 735d 0a20 2020 2020 2020 206f  _axis].        o
-00006c30: 7574 5f69 6e64 203d 2074 7570 6c65 2878  ut_ind = tuple(x
-00006c40: 2066 6f72 2069 2c20 7820 696e 2065 6e75   for i, x in enu
-00006c50: 6d65 7261 7465 286f 7574 5f69 6e64 2920  merate(out_ind) 
-00006c60: 6966 2069 206e 6f74 2069 6e20 6472 6f70  if i not in drop
-00006c70: 5f61 7869 7329 0a20 2020 2069 6620 6e65  _axis).    if ne
-00006c80: 775f 6178 6973 2069 7320 4e6f 6e65 2061  w_axis is None a
-00006c90: 6e64 2063 6875 6e6b 7320 6973 206e 6f74  nd chunks is not
-00006ca0: 204e 6f6e 6520 616e 6420 6c65 6e28 6f75   None and len(ou
-00006cb0: 745f 696e 6429 203c 206c 656e 2863 6875  t_ind) < len(chu
-00006cc0: 6e6b 7329 3a0a 2020 2020 2020 2020 6e65  nks):.        ne
-00006cd0: 775f 6178 6973 203d 2072 616e 6765 286c  w_axis = range(l
-00006ce0: 656e 2863 6875 6e6b 7329 202d 206c 656e  en(chunks) - len
-00006cf0: 286f 7574 5f69 6e64 2929 0a20 2020 2069  (out_ind)).    i
-00006d00: 6620 6e65 775f 6178 6973 3a0a 2020 2020  f new_axis:.    
-00006d10: 2020 2020 2320 6e65 775f 6178 6973 203d      # new_axis =
-00006d20: 205b 7820 2b20 6c65 6e28 6472 6f70 5f61   [x + len(drop_a
-00006d30: 7869 7329 2066 6f72 2078 2069 6e20 6e65  xis) for x in ne
-00006d40: 775f 6178 6973 5d0a 2020 2020 2020 2020  w_axis].        
-00006d50: 6f75 745f 696e 6420 3d20 6c69 7374 286f  out_ind = list(o
-00006d60: 7574 5f69 6e64 290a 2020 2020 2020 2020  ut_ind).        
-00006d70: 666f 7220 6178 2069 6e20 736f 7274 6564  for ax in sorted
-00006d80: 286e 6577 5f61 7869 7329 3a0a 2020 2020  (new_axis):.    
-00006d90: 2020 2020 2020 2020 6e20 3d20 6c65 6e28          n = len(
-00006da0: 6f75 745f 696e 6429 202b 206c 656e 2864  out_ind) + len(d
-00006db0: 726f 705f 6178 6973 290a 2020 2020 2020  rop_axis).      
-00006dc0: 2020 2020 2020 6f75 745f 696e 642e 696e        out_ind.in
-00006dd0: 7365 7274 2861 782c 206e 290a 2020 2020  sert(ax, n).    
-00006de0: 2020 2020 2020 2020 6966 2063 6875 6e6b          if chunk
-00006df0: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
-00006e00: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00006e10: 6577 5f61 7865 735b 6e5d 203d 2063 6875  ew_axes[n] = chu
-00006e20: 6e6b 735b 6178 5d0a 2020 2020 2020 2020  nks[ax].        
-00006e30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00006e40: 2020 2020 2020 2020 2020 6e65 775f 6178            new_ax
-00006e50: 6573 5b6e 5d20 3d20 310a 2020 2020 2020  es[n] = 1.      
-00006e60: 2020 6f75 745f 696e 6420 3d20 7475 706c    out_ind = tupl
-00006e70: 6528 6f75 745f 696e 6429 0a20 2020 2020  e(out_ind).     
-00006e80: 2020 2069 6620 6d61 7828 6e65 775f 6178     if max(new_ax
-00006e90: 6973 2920 3e20 6d61 7828 6f75 745f 696e  is) > max(out_in
-00006ea0: 6429 3a0a 2020 2020 2020 2020 2020 2020  d):.            
-00006eb0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00006ec0: 2822 4e65 775f 6178 6973 2076 616c 7565  ("New_axis value
-00006ed0: 7320 646f 206e 6f74 2066 696c 6c20 696e  s do not fill in
-00006ee0: 2061 6c6c 2064 696d 656e 7369 6f6e 7322   all dimensions"
-00006ef0: 290a 0a20 2020 2069 6620 6368 756e 6b73  )..    if chunks
-00006f00: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-00006f10: 2020 2020 2020 6966 206c 656e 2863 6875        if len(chu
-00006f20: 6e6b 7329 2021 3d20 6c65 6e28 6f75 745f  nks) != len(out_
-00006f30: 696e 6429 3a0a 2020 2020 2020 2020 2020  ind):.          
-00006f40: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00006f50: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00006f60: 2020 2020 6622 5072 6f76 6964 6564 2063      f"Provided c
-00006f70: 6875 6e6b 7320 6861 7665 207b 6c65 6e28  hunks have {len(
-00006f80: 6368 756e 6b73 297d 2064 696d 733b 2065  chunks)} dims; e
-00006f90: 7870 6563 7465 6420 7b6c 656e 286f 7574  xpected {len(out
-00006fa0: 5f69 6e64 297d 2064 696d 7322 0a20 2020  _ind)} dims".   
-00006fb0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00006fc0: 2020 2061 646a 7573 745f 6368 756e 6b73     adjust_chunks
-00006fd0: 203d 2064 6963 7428 7a69 7028 6f75 745f   = dict(zip(out_
-00006fe0: 696e 642c 2063 6875 6e6b 7329 290a 2020  ind, chunks)).  
-00006ff0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00007000: 6164 6a75 7374 5f63 6875 6e6b 7320 3d20  adjust_chunks = 
-00007010: 4e6f 6e65 0a0a 2020 2020 6966 2065 6e66  None..    if enf
-00007020: 6f72 6365 5f6e 6469 6d3a 0a20 2020 2020  orce_ndim:.     
-00007030: 2020 206f 7574 203d 2062 6c6f 636b 7769     out = blockwi
-00007040: 7365 280a 2020 2020 2020 2020 2020 2020  se(.            
-00007050: 6170 706c 795f 616e 645f 656e 666f 7263  apply_and_enforc
-00007060: 652c 0a20 2020 2020 2020 2020 2020 206f  e,.            o
-00007070: 7574 5f69 6e64 2c0a 2020 2020 2020 2020  ut_ind,.        
-00007080: 2020 2020 2a63 6f6e 6361 7428 6172 6770      *concat(argp
-00007090: 6169 7273 292c 0a20 2020 2020 2020 2020  airs),.         
-000070a0: 2020 2065 7870 6563 7465 645f 6e64 696d     expected_ndim
-000070b0: 3d6c 656e 286f 7574 5f69 6e64 292c 0a20  =len(out_ind),. 
-000070c0: 2020 2020 2020 2020 2020 205f 6675 6e63             _func
-000070d0: 3d66 756e 632c 0a20 2020 2020 2020 2020  =func,.         
-000070e0: 2020 206e 616d 653d 6e61 6d65 2c0a 2020     name=name,.  
-000070f0: 2020 2020 2020 2020 2020 6e65 775f 6178            new_ax
-00007100: 6573 3d6e 6577 5f61 7865 732c 0a20 2020  es=new_axes,.   
-00007110: 2020 2020 2020 2020 2064 7479 7065 3d64           dtype=d
-00007120: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
-00007130: 2020 636f 6e63 6174 656e 6174 653d 5472    concatenate=Tr
-00007140: 7565 2c0a 2020 2020 2020 2020 2020 2020  ue,.            
-00007150: 616c 6967 6e5f 6172 7261 7973 3d46 616c  align_arrays=Fal
-00007160: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-00007170: 6164 6a75 7374 5f63 6875 6e6b 733d 6164  adjust_chunks=ad
-00007180: 6a75 7374 5f63 6875 6e6b 732c 0a20 2020  just_chunks,.   
-00007190: 2020 2020 2020 2020 206d 6574 613d 6d65           meta=me
-000071a0: 7461 2c0a 2020 2020 2020 2020 2020 2020  ta,.            
-000071b0: 2a2a 6b77 6172 6773 2c0a 2020 2020 2020  **kwargs,.      
-000071c0: 2020 290a 2020 2020 656c 7365 3a0a 2020    ).    else:.  
-000071d0: 2020 2020 2020 6f75 7420 3d20 626c 6f63        out = bloc
-000071e0: 6b77 6973 6528 0a20 2020 2020 2020 2020  kwise(.         
-000071f0: 2020 2066 756e 632c 0a20 2020 2020 2020     func,.       
-00007200: 2020 2020 206f 7574 5f69 6e64 2c0a 2020       out_ind,.  
-00007210: 2020 2020 2020 2020 2020 2a63 6f6e 6361            *conca
-00007220: 7428 6172 6770 6169 7273 292c 0a20 2020  t(argpairs),.   
-00007230: 2020 2020 2020 2020 206e 616d 653d 6e61           name=na
-00007240: 6d65 2c0a 2020 2020 2020 2020 2020 2020  me,.            
-00007250: 6e65 775f 6178 6573 3d6e 6577 5f61 7865  new_axes=new_axe
-00007260: 732c 0a20 2020 2020 2020 2020 2020 2064  s,.            d
-00007270: 7479 7065 3d64 7479 7065 2c0a 2020 2020  type=dtype,.    
-00007280: 2020 2020 2020 2020 636f 6e63 6174 656e          concaten
-00007290: 6174 653d 5472 7565 2c0a 2020 2020 2020  ate=True,.      
-000072a0: 2020 2020 2020 616c 6967 6e5f 6172 7261        align_arra
-000072b0: 7973 3d46 616c 7365 2c0a 2020 2020 2020  ys=False,.      
-000072c0: 2020 2020 2020 6164 6a75 7374 5f63 6875        adjust_chu
-000072d0: 6e6b 733d 6164 6a75 7374 5f63 6875 6e6b  nks=adjust_chunk
-000072e0: 732c 0a20 2020 2020 2020 2020 2020 206d  s,.            m
-000072f0: 6574 613d 6d65 7461 2c0a 2020 2020 2020  eta=meta,.      
-00007300: 2020 2020 2020 2a2a 6b77 6172 6773 2c0a        **kwargs,.
-00007310: 2020 2020 2020 2020 290a 0a20 2020 2065          )..    e
-00007320: 7874 7261 5f61 7267 7061 6972 7320 3d20  xtra_argpairs = 
-00007330: 5b5d 0a20 2020 2065 7874 7261 5f6e 616d  [].    extra_nam
-00007340: 6573 203d 205b 5d0a 2020 2020 2320 4966  es = [].    # If
-00007350: 2066 756e 6320 6861 7320 626c 6f63 6b5f   func has block_
-00007360: 6964 2061 7320 616e 2061 7267 756d 656e  id as an argumen
-00007370: 742c 2063 6f6e 7374 7275 6374 2061 6e20  t, construct an 
-00007380: 6172 7261 7920 6f66 2062 6c6f 636b 2049  array of block I
-00007390: 4473 2061 6e64 0a20 2020 2023 2070 7265  Ds and.    # pre
-000073a0: 7061 7265 2074 6f20 696e 6a65 6374 2069  pare to inject i
-000073b0: 742e 0a20 2020 2069 6620 6861 735f 6b65  t..    if has_ke
-000073c0: 7977 6f72 6428 6675 6e63 2c20 2262 6c6f  yword(func, "blo
-000073d0: 636b 5f69 6422 293a 0a20 2020 2020 2020  ck_id"):.       
-000073e0: 2062 6c6f 636b 5f69 645f 6e61 6d65 203d   block_id_name =
-000073f0: 2022 626c 6f63 6b2d 6964 2d22 202b 206f   "block-id-" + o
-00007400: 7574 2e6e 616d 650a 2020 2020 2020 2020  ut.name.        
-00007410: 626c 6f63 6b5f 6964 5f64 736b 203d 207b  block_id_dsk = {
-00007420: 0a20 2020 2020 2020 2020 2020 2028 626c  .            (bl
-00007430: 6f63 6b5f 6964 5f6e 616d 652c 2920 2b20  ock_id_name,) + 
-00007440: 626c 6f63 6b5f 6964 3a20 626c 6f63 6b5f  block_id: block_
-00007450: 6964 0a20 2020 2020 2020 2020 2020 2066  id.            f
-00007460: 6f72 2062 6c6f 636b 5f69 6420 696e 2070  or block_id in p
-00007470: 726f 6475 6374 282a 2872 616e 6765 286c  roduct(*(range(l
-00007480: 656e 2863 2929 2066 6f72 2063 2069 6e20  en(c)) for c in 
-00007490: 6f75 742e 6368 756e 6b73 2929 0a20 2020  out.chunks)).   
-000074a0: 2020 2020 207d 0a20 2020 2020 2020 2062       }.        b
-000074b0: 6c6f 636b 5f69 645f 6172 7261 7920 3d20  lock_id_array = 
-000074c0: 4172 7261 7928 0a20 2020 2020 2020 2020  Array(.         
-000074d0: 2020 2062 6c6f 636b 5f69 645f 6473 6b2c     block_id_dsk,
-000074e0: 0a20 2020 2020 2020 2020 2020 2062 6c6f  .            blo
-000074f0: 636b 5f69 645f 6e61 6d65 2c0a 2020 2020  ck_id_name,.    
-00007500: 2020 2020 2020 2020 6368 756e 6b73 3d74          chunks=t
-00007510: 7570 6c65 2828 312c 2920 2a20 6c65 6e28  uple((1,) * len(
-00007520: 6329 2066 6f72 2063 2069 6e20 6f75 742e  c) for c in out.
-00007530: 6368 756e 6b73 292c 0a20 2020 2020 2020  chunks),.       
-00007540: 2020 2020 2064 7479 7065 3d6e 702e 6f62       dtype=np.ob
-00007550: 6a65 6374 5f2c 0a20 2020 2020 2020 2029  ject_,.        )
-00007560: 0a20 2020 2020 2020 2065 7874 7261 5f61  .        extra_a
-00007570: 7267 7061 6972 732e 6170 7065 6e64 2828  rgpairs.append((
-00007580: 626c 6f63 6b5f 6964 5f61 7272 6179 2c20  block_id_array, 
-00007590: 6f75 745f 696e 6429 290a 2020 2020 2020  out_ind)).      
-000075a0: 2020 6578 7472 615f 6e61 6d65 732e 6170    extra_names.ap
-000075b0: 7065 6e64 2822 626c 6f63 6b5f 6964 2229  pend("block_id")
-000075c0: 0a0a 2020 2020 2320 4966 2066 756e 6320  ..    # If func 
-000075d0: 6861 7320 626c 6f63 6b5f 696e 666f 2061  has block_info a
-000075e0: 7320 616e 2061 7267 756d 656e 742c 2063  s an argument, c
-000075f0: 6f6e 7374 7275 6374 2061 6e20 6172 7261  onstruct an arra
-00007600: 7920 6f66 2062 6c6f 636b 2069 6e66 6f0a  y of block info.
-00007610: 2020 2020 2320 6f62 6a65 6374 7320 616e      # objects an
-00007620: 6420 7072 6570 6172 6520 746f 2069 6e6a  d prepare to inj
-00007630: 6563 7420 6974 2e0a 2020 2020 6966 2068  ect it..    if h
-00007640: 6173 5f6b 6579 776f 7264 2866 756e 632c  as_keyword(func,
-00007650: 2022 626c 6f63 6b5f 696e 666f 2229 3a0a   "block_info"):.
-00007660: 2020 2020 2020 2020 7374 6172 7473 203d          starts =
-00007670: 207b 7d0a 2020 2020 2020 2020 6e75 6d5f   {}.        num_
-00007680: 6368 756e 6b73 203d 207b 7d0a 2020 2020  chunks = {}.    
-00007690: 2020 2020 7368 6170 6573 203d 207b 7d0a      shapes = {}.
-000076a0: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
-000076b0: 2861 7267 2c20 696e 5f69 6e64 2920 696e  (arg, in_ind) in
-000076c0: 2065 6e75 6d65 7261 7465 2861 7267 7061   enumerate(argpa
-000076d0: 6972 7329 3a0a 2020 2020 2020 2020 2020  irs):.          
-000076e0: 2020 6966 2069 6e5f 696e 6420 6973 206e    if in_ind is n
-000076f0: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00007700: 2020 2020 2020 2020 2073 6861 7065 735b           shapes[
-00007710: 695d 203d 2061 7267 2e73 6861 7065 0a20  i] = arg.shape. 
-00007720: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00007730: 6620 6472 6f70 5f61 7869 733a 0a20 2020  f drop_axis:.   
-00007740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007750: 2023 2057 6520 636f 6e63 6174 656e 6174   # We concatenat
-00007760: 6520 616c 6f6e 6720 6472 6f70 7065 6420  e along dropped 
-00007770: 6178 6573 2c20 736f 2077 6520 6e65 6564  axes, so we need
-00007780: 2074 6f20 7472 6561 7420 7468 656d 0a20   to treat them. 
-00007790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077a0: 2020 2023 2061 7320 6966 2074 6865 7265     # as if there
-000077b0: 2069 7320 6f6e 6c79 2061 2073 696e 676c   is only a singl
-000077c0: 6520 6368 756e 6b2e 0a20 2020 2020 2020  e chunk..       
-000077d0: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-000077e0: 7274 735b 695d 203d 205b 0a20 2020 2020  rts[i] = [.     
+000000e0: 7420 436f 6c6c 6563 7469 6f6e 2c20 4974  t Collection, It
+000000f0: 6572 6162 6c65 2c20 4974 6572 6174 6f72  erable, Iterator
+00000100: 2c20 4d61 7070 696e 672c 2053 6571 7565  , Mapping, Seque
+00000110: 6e63 650a 6672 6f6d 2066 756e 6374 6f6f  nce.from functoo
+00000120: 6c73 2069 6d70 6f72 7420 7061 7274 6961  ls import partia
+00000130: 6c2c 2072 6564 7563 652c 2077 7261 7073  l, reduce, wraps
+00000140: 0a66 726f 6d20 6974 6572 746f 6f6c 7320  .from itertools 
+00000150: 696d 706f 7274 2070 726f 6475 6374 2c20  import product, 
+00000160: 7a69 705f 6c6f 6e67 6573 740a 6672 6f6d  zip_longest.from
+00000170: 206e 756d 6265 7273 2069 6d70 6f72 7420   numbers import 
+00000180: 496e 7465 6772 616c 2c20 4e75 6d62 6572  Integral, Number
+00000190: 0a66 726f 6d20 6f70 6572 6174 6f72 2069  .from operator i
+000001a0: 6d70 6f72 7420 6164 642c 206d 756c 0a66  mport add, mul.f
+000001b0: 726f 6d20 7468 7265 6164 696e 6720 696d  rom threading im
+000001c0: 706f 7274 204c 6f63 6b0a 6672 6f6d 2074  port Lock.from t
+000001d0: 7970 696e 6720 696d 706f 7274 2041 6e79  yping import Any
+000001e0: 2c20 5479 7065 5661 722c 2055 6e69 6f6e  , TypeVar, Union
+000001f0: 2c20 6361 7374 0a0a 696d 706f 7274 206e  , cast..import n
+00000200: 756d 7079 2061 7320 6e70 0a66 726f 6d20  umpy as np.from 
+00000210: 6e75 6d70 792e 7479 7069 6e67 2069 6d70  numpy.typing imp
+00000220: 6f72 7420 4172 7261 794c 696b 650a 6672  ort ArrayLike.fr
+00000230: 6f6d 2074 6c7a 2069 6d70 6f72 7420 6163  om tlz import ac
+00000240: 6375 6d75 6c61 7465 2c20 636f 6e63 6174  cumulate, concat
+00000250: 2c20 6669 7273 742c 2066 7265 7175 656e  , first, frequen
+00000260: 6369 6573 2c20 6772 6f75 7062 792c 2070  cies, groupby, p
+00000270: 6172 7469 7469 6f6e 0a66 726f 6d20 746c  artition.from tl
+00000280: 7a2e 6375 7272 6965 6420 696d 706f 7274  z.curried import
+00000290: 2070 6c75 636b 0a0a 6672 6f6d 2064 6173   pluck..from das
+000002a0: 6b20 696d 706f 7274 2063 6f6d 7075 7465  k import compute
+000002b0: 2c20 636f 6e66 6967 2c20 636f 7265 0a66  , config, core.f
+000002c0: 726f 6d20 6461 736b 2e61 7272 6179 2069  rom dask.array i
+000002d0: 6d70 6f72 7420 6368 756e 6b0a 6672 6f6d  mport chunk.from
+000002e0: 2064 6173 6b2e 6172 7261 792e 6368 756e   dask.array.chun
+000002f0: 6b20 696d 706f 7274 2067 6574 6974 656d  k import getitem
+00000300: 0a66 726f 6d20 6461 736b 2e61 7272 6179  .from dask.array
+00000310: 2e63 6875 6e6b 5f74 7970 6573 2069 6d70  .chunk_types imp
+00000320: 6f72 7420 6973 5f76 616c 6964 5f61 7272  ort is_valid_arr
+00000330: 6179 5f63 6875 6e6b 2c20 6973 5f76 616c  ay_chunk, is_val
+00000340: 6964 5f63 6875 6e6b 5f74 7970 650a 0a23  id_chunk_type..#
+00000350: 204b 6565 7020 6569 6e73 756d 5f6c 6f6f   Keep einsum_loo
+00000360: 6b75 7020 616e 6420 7465 6e73 6f72 646f  kup and tensordo
+00000370: 745f 6c6f 6f6b 7570 2068 6572 6520 666f  t_lookup here fo
+00000380: 7220 6261 636b 7761 7264 7320 636f 6d70  r backwards comp
+00000390: 6174 6962 696c 6974 790a 6672 6f6d 2064  atibility.from d
+000003a0: 6173 6b2e 6172 7261 792e 6469 7370 6174  ask.array.dispat
+000003b0: 6368 2069 6d70 6f72 7420 2820 2023 206e  ch import (  # n
+000003c0: 6f71 613a 2046 3430 310a 2020 2020 636f  oqa: F401.    co
+000003d0: 6e63 6174 656e 6174 655f 6c6f 6f6b 7570  ncatenate_lookup
+000003e0: 2c0a 2020 2020 6569 6e73 756d 5f6c 6f6f  ,.    einsum_loo
+000003f0: 6b75 702c 0a20 2020 2074 656e 736f 7264  kup,.    tensord
+00000400: 6f74 5f6c 6f6f 6b75 702c 0a29 0a66 726f  ot_lookup,.).fro
+00000410: 6d20 6461 736b 2e61 7272 6179 2e6e 756d  m dask.array.num
+00000420: 7079 5f63 6f6d 7061 7420 696d 706f 7274  py_compat import
+00000430: 204e 554d 5059 5f47 455f 3230 302c 205f   NUMPY_GE_200, _
+00000440: 5265 6375 7273 6572 0a66 726f 6d20 6461  Recurser.from da
+00000450: 736b 2e61 7272 6179 2e73 6c69 6369 6e67  sk.array.slicing
+00000460: 2069 6d70 6f72 7420 7265 706c 6163 655f   import replace_
+00000470: 656c 6c69 7073 6973 2c20 7365 7469 7465  ellipsis, setite
+00000480: 6d5f 6172 7261 792c 2073 6c69 6365 5f61  m_array, slice_a
+00000490: 7272 6179 0a66 726f 6d20 6461 736b 2e62  rray.from dask.b
+000004a0: 6173 6520 696d 706f 7274 2028 0a20 2020  ase import (.   
+000004b0: 2044 6173 6b4d 6574 686f 6473 4d69 7869   DaskMethodsMixi
+000004c0: 6e2c 0a20 2020 2063 6f6d 7075 7465 5f61  n,.    compute_a
+000004d0: 735f 6966 5f63 6f6c 6c65 6374 696f 6e2c  s_if_collection,
+000004e0: 0a20 2020 2064 6f6e 745f 6f70 7469 6d69  .    dont_optimi
+000004f0: 7a65 2c0a 2020 2020 6973 5f64 6173 6b5f  ze,.    is_dask_
+00000500: 636f 6c6c 6563 7469 6f6e 2c0a 2020 2020  collection,.    
+00000510: 6e61 6d65 645f 7363 6865 6475 6c65 7273  named_schedulers
+00000520: 2c0a 2020 2020 7065 7273 6973 742c 0a20  ,.    persist,. 
+00000530: 2020 2074 6f6b 656e 697a 652c 0a29 0a66     tokenize,.).f
+00000540: 726f 6d20 6461 736b 2e62 6c6f 636b 7769  rom dask.blockwi
+00000550: 7365 2069 6d70 6f72 7420 626c 6f63 6b77  se import blockw
+00000560: 6973 6520 6173 2063 6f72 655f 626c 6f63  ise as core_bloc
+00000570: 6b77 6973 650a 6672 6f6d 2064 6173 6b2e  kwise.from dask.
+00000580: 626c 6f63 6b77 6973 6520 696d 706f 7274  blockwise import
+00000590: 2062 726f 6164 6361 7374 5f64 696d 656e   broadcast_dimen
+000005a0: 7369 6f6e 730a 6672 6f6d 2064 6173 6b2e  sions.from dask.
+000005b0: 636f 6e74 6578 7420 696d 706f 7274 2067  context import g
+000005c0: 6c6f 6261 6c6d 6574 686f 640a 6672 6f6d  lobalmethod.from
+000005d0: 2064 6173 6b2e 636f 7265 2069 6d70 6f72   dask.core impor
+000005e0: 7420 7175 6f74 650a 6672 6f6d 2064 6173  t quote.from das
+000005f0: 6b2e 6465 6c61 7965 6420 696d 706f 7274  k.delayed import
+00000600: 2044 656c 6179 6564 2c20 6465 6c61 7965   Delayed, delaye
+00000610: 640a 6672 6f6d 2064 6173 6b2e 6869 6768  d.from dask.high
+00000620: 6c65 7665 6c67 7261 7068 2069 6d70 6f72  levelgraph impor
+00000630: 7420 4869 6768 4c65 7665 6c47 7261 7068  t HighLevelGraph
+00000640: 2c20 4d61 7465 7269 616c 697a 6564 4c61  , MaterializedLa
+00000650: 7965 720a 6672 6f6d 2064 6173 6b2e 6c61  yer.from dask.la
+00000660: 7965 7273 2069 6d70 6f72 7420 4172 7261  yers import Arra
+00000670: 7953 6c69 6365 4465 702c 2072 6573 6861  ySliceDep, resha
+00000680: 7065 6c69 7374 0a66 726f 6d20 6461 736b  pelist.from dask
+00000690: 2e73 697a 656f 6620 696d 706f 7274 2073  .sizeof import s
+000006a0: 697a 656f 660a 6672 6f6d 2064 6173 6b2e  izeof.from dask.
+000006b0: 7479 7069 6e67 2069 6d70 6f72 7420 4772  typing import Gr
+000006c0: 6170 682c 204b 6579 2c20 4e65 7374 6564  aph, Key, Nested
+000006d0: 4b65 7973 0a66 726f 6d20 6461 736b 2e75  Keys.from dask.u
+000006e0: 7469 6c73 2069 6d70 6f72 7420 280a 2020  tils import (.  
+000006f0: 2020 496e 6465 7843 616c 6c61 626c 652c    IndexCallable,
+00000700: 0a20 2020 2053 6572 6961 6c69 7a61 626c  .    Serializabl
+00000710: 654c 6f63 6b2c 0a20 2020 2063 6163 6865  eLock,.    cache
+00000720: 645f 6375 6d73 756d 2c0a 2020 2020 6361  d_cumsum,.    ca
+00000730: 6368 6564 5f70 726f 7065 7274 792c 0a20  ched_property,. 
+00000740: 2020 2063 6f6e 6372 6574 652c 0a20 2020     concrete,.   
+00000750: 2064 6572 6976 6564 5f66 726f 6d2c 0a20   derived_from,. 
+00000760: 2020 2066 6f72 6d61 745f 6279 7465 732c     format_bytes,
+00000770: 0a20 2020 2066 756e 636e 616d 652c 0a20  .    funcname,. 
+00000780: 2020 2068 6173 5f6b 6579 776f 7264 2c0a     has_keyword,.
+00000790: 2020 2020 6973 5f61 7272 6179 6c69 6b65      is_arraylike
+000007a0: 2c0a 2020 2020 6973 5f64 6174 6166 7261  ,.    is_datafra
+000007b0: 6d65 5f6c 696b 652c 0a20 2020 2069 735f  me_like,.    is_
+000007c0: 696e 6465 785f 6c69 6b65 2c0a 2020 2020  index_like,.    
+000007d0: 6973 5f69 6e74 6567 6572 2c0a 2020 2020  is_integer,.    
+000007e0: 6973 5f73 6572 6965 735f 6c69 6b65 2c0a  is_series_like,.
+000007f0: 2020 2020 6d61 7962 655f 706c 7572 616c      maybe_plural
+00000800: 697a 652c 0a20 2020 206e 6465 6570 6d61  ize,.    ndeepma
+00000810: 702c 0a20 2020 206e 6469 6d6c 6973 742c  p,.    ndimlist,
+00000820: 0a20 2020 2070 6172 7365 5f62 7974 6573  .    parse_bytes
+00000830: 2c0a 2020 2020 7479 7065 6e61 6d65 2c0a  ,.    typename,.
+00000840: 290a 6672 6f6d 2064 6173 6b2e 7769 6467  ).from dask.widg
+00000850: 6574 7320 696d 706f 7274 2067 6574 5f74  ets import get_t
+00000860: 656d 706c 6174 650a 0a54 5f49 6e74 4f72  emplate..T_IntOr
+00000870: 4e61 4e20 3d20 556e 696f 6e5b 696e 742c  NaN = Union[int,
+00000880: 2066 6c6f 6174 5d20 2023 2053 686f 756c   float]  # Shoul
+00000890: 6420 6265 2055 6e69 6f6e 5b69 6e74 2c20  d be Union[int, 
+000008a0: 4c69 7465 7261 6c5b 6e70 2e6e 616e 5d5d  Literal[np.nan]]
+000008b0: 0a0a 4445 4641 554c 545f 4745 5420 3d20  ..DEFAULT_GET = 
+000008c0: 6e61 6d65 645f 7363 6865 6475 6c65 7273  named_schedulers
+000008d0: 2e67 6574 2822 7468 7265 6164 7322 2c20  .get("threads", 
+000008e0: 6e61 6d65 645f 7363 6865 6475 6c65 7273  named_schedulers
+000008f0: 5b22 7379 6e63 225d 290a 0a75 6e6b 6e6f  ["sync"])..unkno
+00000900: 776e 5f63 6875 6e6b 5f6d 6573 7361 6765  wn_chunk_message
+00000910: 203d 2028 0a20 2020 2022 5c6e 5c6e 220a   = (.    "\n\n".
+00000920: 2020 2020 2241 2070 6f73 7369 626c 6520      "A possible 
+00000930: 736f 6c75 7469 6f6e 3a20 220a 2020 2020  solution: ".    
+00000940: 2268 7474 7073 3a2f 2f64 6f63 732e 6461  "https://docs.da
+00000950: 736b 2e6f 7267 2f65 6e2f 6c61 7465 7374  sk.org/en/latest
+00000960: 2f61 7272 6179 2d63 6875 6e6b 732e 6874  /array-chunks.ht
+00000970: 6d6c 2375 6e6b 6e6f 776e 2d63 6875 6e6b  ml#unknown-chunk
+00000980: 735c 6e22 0a20 2020 2022 5375 6d6d 6172  s\n".    "Summar
+00000990: 793a 2074 6f20 636f 6d70 7574 6520 6368  y: to compute ch
+000009a0: 756e 6b73 2073 697a 6573 2c20 7573 655c  unks sizes, use\
+000009b0: 6e5c 6e22 0a20 2020 2022 2020 2078 2e63  n\n".    "   x.c
+000009c0: 6f6d 7075 7465 5f63 6875 6e6b 5f73 697a  ompute_chunk_siz
+000009d0: 6573 2829 2020 2320 666f 7220 4461 736b  es()  # for Dask
+000009e0: 2041 7272 6179 2060 7860 5c6e 220a 2020   Array `x`\n".  
+000009f0: 2020 2220 2020 6464 662e 746f 5f64 6173    "   ddf.to_das
+00000a00: 6b5f 6172 7261 7928 6c65 6e67 7468 733d  k_array(lengths=
+00000a10: 5472 7565 2920 2023 2066 6f72 2044 6173  True)  # for Das
+00000a20: 6b20 4461 7461 4672 616d 6520 6064 6466  k DataFrame `ddf
+00000a30: 6022 0a29 0a0a 0a63 6c61 7373 2050 6572  `".)...class Per
+00000a40: 666f 726d 616e 6365 5761 726e 696e 6728  formanceWarning(
+00000a50: 5761 726e 696e 6729 3a0a 2020 2020 2222  Warning):.    ""
+00000a60: 2241 2077 6172 6e69 6e67 2067 6976 656e  "A warning given
+00000a70: 2077 6865 6e20 6261 6420 6368 756e 6b69   when bad chunki
+00000a80: 6e67 206d 6179 2063 6175 7365 2070 6f6f  ng may cause poo
+00000a90: 7220 7065 7266 6f72 6d61 6e63 6522 2222  r performance"""
+00000aa0: 0a0a 0a64 6566 2067 6574 7465 7228 612c  ...def getter(a,
+00000ab0: 2062 2c20 6173 6172 7261 793d 5472 7565   b, asarray=True
+00000ac0: 2c20 6c6f 636b 3d4e 6f6e 6529 3a0a 2020  , lock=None):.  
+00000ad0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00000ae0: 622c 2074 7570 6c65 2920 616e 6420 616e  b, tuple) and an
+00000af0: 7928 7820 6973 204e 6f6e 6520 666f 7220  y(x is None for 
+00000b00: 7820 696e 2062 293a 0a20 2020 2020 2020  x in b):.       
+00000b10: 2062 3220 3d20 7475 706c 6528 7820 666f   b2 = tuple(x fo
+00000b20: 7220 7820 696e 2062 2069 6620 7820 6973  r x in b if x is
+00000b30: 206e 6f74 204e 6f6e 6529 0a20 2020 2020   not None).     
+00000b40: 2020 2062 3320 3d20 7475 706c 6528 0a20     b3 = tuple(. 
+00000b50: 2020 2020 2020 2020 2020 204e 6f6e 6520             None 
+00000b60: 6966 2078 2069 7320 4e6f 6e65 2065 6c73  if x is None els
+00000b70: 6520 736c 6963 6528 4e6f 6e65 2c20 4e6f  e slice(None, No
+00000b80: 6e65 290a 2020 2020 2020 2020 2020 2020  ne).            
+00000b90: 666f 7220 7820 696e 2062 0a20 2020 2020  for x in b.     
+00000ba0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+00000bb0: 696e 7374 616e 6365 2878 2c20 496e 7465  instance(x, Inte
+00000bc0: 6772 616c 290a 2020 2020 2020 2020 290a  gral).        ).
+00000bd0: 2020 2020 2020 2020 7265 7475 726e 2067          return g
+00000be0: 6574 7465 7228 612c 2062 322c 2061 7361  etter(a, b2, asa
+00000bf0: 7272 6179 3d61 7361 7272 6179 2c20 6c6f  rray=asarray, lo
+00000c00: 636b 3d6c 6f63 6b29 5b62 335d 0a0a 2020  ck=lock)[b3]..  
+00000c10: 2020 6966 206c 6f63 6b3a 0a20 2020 2020    if lock:.     
+00000c20: 2020 206c 6f63 6b2e 6163 7175 6972 6528     lock.acquire(
+00000c30: 290a 2020 2020 7472 793a 0a20 2020 2020  ).    try:.     
+00000c40: 2020 2063 203d 2061 5b62 5d0a 2020 2020     c = a[b].    
+00000c50: 2020 2020 2320 4265 6c6f 7720 7765 2073      # Below we s
+00000c60: 7065 6369 616c 2d63 6173 6520 606e 702e  pecial-case `np.
+00000c70: 6d61 7472 6978 6020 746f 2066 6f72 6365  matrix` to force
+00000c80: 2061 2063 6f6e 7665 7273 696f 6e20 746f   a conversion to
+00000c90: 0a20 2020 2020 2020 2023 2060 6e70 2e6e  .        # `np.n
+00000ca0: 6461 7272 6179 6020 616e 6420 7072 6573  darray` and pres
+00000cb0: 6572 7665 206f 7269 6769 6e61 6c20 4461  erve original Da
+00000cc0: 736b 2062 6568 6176 696f 7220 666f 7220  sk behavior for 
+00000cd0: 6067 6574 7465 7260 2c0a 2020 2020 2020  `getter`,.      
+00000ce0: 2020 2320 6173 2066 6f72 2061 6c6c 2070    # as for all p
+00000cf0: 7572 706f 7365 7320 606e 702e 6d61 7472  urposes `np.matr
+00000d00: 6978 6020 6973 2061 7272 6179 2d6c 696b  ix` is array-lik
+00000d10: 6520 616e 6420 7468 7573 0a20 2020 2020  e and thus.     
+00000d20: 2020 2023 2060 6973 5f61 7272 6179 6c69     # `is_arrayli
+00000d30: 6b65 6020 6576 616c 7561 7465 7320 746f  ke` evaluates to
+00000d40: 2060 5472 7565 6020 696e 2074 6861 7420   `True` in that 
+00000d50: 6361 7365 2e0a 2020 2020 2020 2020 6966  case..        if
+00000d60: 2061 7361 7272 6179 2061 6e64 2028 6e6f   asarray and (no
+00000d70: 7420 6973 5f61 7272 6179 6c69 6b65 2863  t is_arraylike(c
+00000d80: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
+00000d90: 632c 206e 702e 6d61 7472 6978 2929 3a0a  c, np.matrix)):.
+00000da0: 2020 2020 2020 2020 2020 2020 6320 3d20              c = 
+00000db0: 6e70 2e61 7361 7272 6179 2863 290a 2020  np.asarray(c).  
+00000dc0: 2020 6669 6e61 6c6c 793a 0a20 2020 2020    finally:.     
+00000dd0: 2020 2069 6620 6c6f 636b 3a0a 2020 2020     if lock:.    
+00000de0: 2020 2020 2020 2020 6c6f 636b 2e72 656c          lock.rel
+00000df0: 6561 7365 2829 0a20 2020 2072 6574 7572  ease().    retur
+00000e00: 6e20 630a 0a0a 6465 6620 6765 7474 6572  n c...def getter
+00000e10: 5f6e 6f66 616e 6379 2861 2c20 622c 2061  _nofancy(a, b, a
+00000e20: 7361 7272 6179 3d54 7275 652c 206c 6f63  sarray=True, loc
+00000e30: 6b3d 4e6f 6e65 293a 0a20 2020 2022 2222  k=None):.    """
+00000e40: 4120 7369 6d70 6c65 2077 7261 7070 6572  A simple wrapper
+00000e50: 2061 726f 756e 6420 6060 6765 7474 6572   around ``getter
+00000e60: 6060 2e0a 0a20 2020 2055 7365 6420 746f  ``...    Used to
+00000e70: 2069 6e64 6963 6174 6520 746f 2074 6865   indicate to the
+00000e80: 206f 7074 696d 697a 6174 696f 6e20 7061   optimization pa
+00000e90: 7373 6573 2074 6861 7420 7468 6520 6261  sses that the ba
+00000ea0: 636b 656e 6420 646f 6573 6e27 740a 2020  ckend doesn't.  
+00000eb0: 2020 7375 7070 6f72 7420 6661 6e63 7920    support fancy 
+00000ec0: 696e 6465 7869 6e67 2e0a 2020 2020 2222  indexing..    ""
+00000ed0: 220a 2020 2020 7265 7475 726e 2067 6574  ".    return get
+00000ee0: 7465 7228 612c 2062 2c20 6173 6172 7261  ter(a, b, asarra
+00000ef0: 793d 6173 6172 7261 792c 206c 6f63 6b3d  y=asarray, lock=
+00000f00: 6c6f 636b 290a 0a0a 6465 6620 6765 7474  lock)...def gett
+00000f10: 6572 5f69 6e6c 696e 6528 612c 2062 2c20  er_inline(a, b, 
+00000f20: 6173 6172 7261 793d 5472 7565 2c20 6c6f  asarray=True, lo
+00000f30: 636b 3d4e 6f6e 6529 3a0a 2020 2020 2222  ck=None):.    ""
+00000f40: 2241 2067 6574 7465 7220 6675 6e63 7469  "A getter functi
+00000f50: 6f6e 2074 6861 7420 6f70 7469 6d69 7a61  on that optimiza
+00000f60: 7469 6f6e 7320 6665 656c 2063 6f6d 666f  tions feel comfo
+00000f70: 7274 6162 6c65 2069 6e6c 696e 696e 670a  rtable inlining.
+00000f80: 0a20 2020 2053 6c69 6369 6e67 206f 7065  .    Slicing ope
+00000f90: 7261 7469 6f6e 7320 7769 7468 2074 6869  rations with thi
+00000fa0: 7320 6675 6e63 7469 6f6e 206d 6179 2062  s function may b
+00000fb0: 6520 696e 6c69 6e65 6420 696e 746f 2061  e inlined into a
+00000fc0: 2067 7261 7068 2c20 7375 6368 2061 730a   graph, such as.
+00000fd0: 2020 2020 696e 2074 6865 2066 6f6c 6c6f      in the follo
+00000fe0: 7769 6e67 2072 6577 7269 7465 0a0a 2020  wing rewrite..  
+00000ff0: 2020 2a2a 4265 666f 7265 2a2a 0a0a 2020    **Before**..  
+00001000: 2020 3e3e 3e20 6120 3d20 785b 3a31 305d    >>> a = x[:10]
+00001010: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+00001020: 4950 0a20 2020 203e 3e3e 2062 203d 2061  IP.    >>> b = a
+00001030: 202b 2031 2020 2320 646f 6374 6573 743a   + 1  # doctest:
+00001040: 202b 534b 4950 0a20 2020 203e 3e3e 2063   +SKIP.    >>> c
+00001050: 203d 2061 202a 2032 2020 2320 646f 6374   = a * 2  # doct
+00001060: 6573 743a 202b 534b 4950 0a0a 2020 2020  est: +SKIP..    
+00001070: 2a2a 4166 7465 722a 2a0a 0a20 2020 203e  **After**..    >
+00001080: 3e3e 2062 203d 2078 5b3a 3130 5d20 2b20  >> b = x[:10] + 
+00001090: 3120 2023 2064 6f63 7465 7374 3a20 2b53  1  # doctest: +S
+000010a0: 4b49 500a 2020 2020 3e3e 3e20 6320 3d20  KIP.    >>> c = 
+000010b0: 785b 3a31 305d 202a 2032 2020 2320 646f  x[:10] * 2  # do
+000010c0: 6374 6573 743a 202b 534b 4950 0a0a 2020  ctest: +SKIP..  
+000010d0: 2020 5468 6973 2069 6e6c 696e 696e 6720    This inlining 
+000010e0: 6361 6e20 6265 2072 656c 6576 616e 7420  can be relevant 
+000010f0: 746f 206f 7065 7261 7469 6f6e 7320 7768  to operations wh
+00001100: 656e 2072 756e 6e69 6e67 206f 6666 206f  en running off o
+00001110: 6620 6469 736b 2e0a 2020 2020 2222 220a  f disk..    """.
+00001120: 2020 2020 7265 7475 726e 2067 6574 7465      return gette
+00001130: 7228 612c 2062 2c20 6173 6172 7261 793d  r(a, b, asarray=
+00001140: 6173 6172 7261 792c 206c 6f63 6b3d 6c6f  asarray, lock=lo
+00001150: 636b 290a 0a0a 6672 6f6d 2064 6173 6b2e  ck)...from dask.
+00001160: 6172 7261 792e 6f70 7469 6d69 7a61 7469  array.optimizati
+00001170: 6f6e 2069 6d70 6f72 7420 6675 7365 5f73  on import fuse_s
+00001180: 6c69 6365 2c20 6f70 7469 6d69 7a65 0a0a  lice, optimize..
+00001190: 2320 5f5f 6172 7261 795f 6675 6e63 7469  # __array_functi
+000011a0: 6f6e 5f5f 2064 6963 7420 666f 7220 6d61  on__ dict for ma
+000011b0: 7070 696e 6720 616c 6961 7365 7320 616e  pping aliases an
+000011c0: 6420 6d69 736d 6174 6368 696e 6720 6e61  d mismatching na
+000011d0: 6d65 730a 5f48 414e 444c 4544 5f46 554e  mes._HANDLED_FUN
+000011e0: 4354 494f 4e53 203d 207b 7d0a 0a0a 6465  CTIONS = {}...de
+000011f0: 6620 696d 706c 656d 656e 7473 282a 6e75  f implements(*nu
+00001200: 6d70 795f 6675 6e63 7469 6f6e 7329 3a0a  mpy_functions):.
+00001210: 2020 2020 2222 2252 6567 6973 7465 7220      """Register 
+00001220: 616e 205f 5f61 7272 6179 5f66 756e 6374  an __array_funct
+00001230: 696f 6e5f 5f20 696d 706c 656d 656e 7461  ion__ implementa
+00001240: 7469 6f6e 2066 6f72 2064 6173 6b2e 6172  tion for dask.ar
+00001250: 7261 792e 4172 7261 790a 0a20 2020 2052  ray.Array..    R
+00001260: 6567 6973 7465 7220 7468 6174 2061 2066  egister that a f
+00001270: 756e 6374 696f 6e20 696d 706c 656d 656e  unction implemen
+00001280: 7473 2074 6865 2041 5049 206f 6620 6120  ts the API of a 
+00001290: 4e75 6d50 7920 6675 6e63 7469 6f6e 2028  NumPy function (
+000012a0: 6f72 2073 6576 6572 616c 0a20 2020 204e  or several.    N
+000012b0: 756d 5079 2066 756e 6374 696f 6e73 2069  umPy functions i
+000012c0: 6e20 6361 7365 206f 6620 616c 6961 7365  n case of aliase
+000012d0: 7329 2077 6869 6368 2069 7320 6861 6e64  s) which is hand
+000012e0: 6c65 6420 7769 7468 0a20 2020 2060 605f  led with.    ``_
+000012f0: 5f61 7272 6179 5f66 756e 6374 696f 6e5f  _array_function_
+00001300: 5f60 602e 0a0a 2020 2020 5061 7261 6d65  _``...    Parame
+00001310: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
+00001320: 2d2d 2d0a 2020 2020 5c5c 2a6e 756d 7079  ---.    \\*numpy
+00001330: 5f66 756e 6374 696f 6e73 203a 2063 616c  _functions : cal
+00001340: 6c61 626c 6573 0a20 2020 2020 2020 204f  lables.        O
+00001350: 6e65 206f 7220 6d6f 7265 204e 756d 5079  ne or more NumPy
+00001360: 2066 756e 6374 696f 6e73 2074 6861 7420   functions that 
+00001370: 6172 6520 6861 6e64 6c65 6420 6279 2060  are handled by `
+00001380: 605f 5f61 7272 6179 5f66 756e 6374 696f  `__array_functio
+00001390: 6e5f 5f60 600a 2020 2020 2020 2020 616e  n__``.        an
+000013a0: 6420 7769 6c6c 2062 6520 6d61 7070 6564  d will be mapped
+000013b0: 2062 7920 6069 6d70 6c65 6d65 6e74 7360   by `implements`
+000013c0: 2074 6f20 6120 6064 6173 6b2e 6172 7261   to a `dask.arra
+000013d0: 7960 2066 756e 6374 696f 6e2e 0a20 2020  y` function..   
+000013e0: 2022 2222 0a0a 2020 2020 6465 6620 6465   """..    def de
+000013f0: 636f 7261 746f 7228 6461 736b 5f66 756e  corator(dask_fun
+00001400: 6329 3a0a 2020 2020 2020 2020 666f 7220  c):.        for 
+00001410: 6e75 6d70 795f 6675 6e63 7469 6f6e 2069  numpy_function i
+00001420: 6e20 6e75 6d70 795f 6675 6e63 7469 6f6e  n numpy_function
+00001430: 733a 0a20 2020 2020 2020 2020 2020 205f  s:.            _
+00001440: 4841 4e44 4c45 445f 4655 4e43 5449 4f4e  HANDLED_FUNCTION
+00001450: 535b 6e75 6d70 795f 6675 6e63 7469 6f6e  S[numpy_function
+00001460: 5d20 3d20 6461 736b 5f66 756e 630a 0a20  ] = dask_func.. 
+00001470: 2020 2020 2020 2072 6574 7572 6e20 6461         return da
+00001480: 736b 5f66 756e 630a 0a20 2020 2072 6574  sk_func..    ret
+00001490: 7572 6e20 6465 636f 7261 746f 720a 0a0a  urn decorator...
+000014a0: 6465 6620 5f73 686f 756c 645f 6465 6c65  def _should_dele
+000014b0: 6761 7465 2873 656c 662c 206f 7468 6572  gate(self, other
+000014c0: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2022  ) -> bool:.    "
+000014d0: 2222 4368 6563 6b20 7768 6574 6865 7220  ""Check whether 
+000014e0: 4461 736b 2073 686f 756c 6420 6465 6c65  Dask should dele
+000014f0: 6761 7465 2074 6f20 7468 6520 6f74 6865  gate to the othe
+00001500: 722e 0a20 2020 2054 6869 7320 696d 706c  r..    This impl
+00001510: 656d 656e 7461 7469 6f6e 2066 6f6c 6c6f  ementation follo
+00001520: 7773 204e 4550 2d31 333a 0a20 2020 2068  ws NEP-13:.    h
+00001530: 7474 7073 3a2f 2f6e 756d 7079 2e6f 7267  ttps://numpy.org
+00001540: 2f6e 6570 732f 6e65 702d 3030 3133 2d75  /neps/nep-0013-u
+00001550: 6675 6e63 2d6f 7665 7272 6964 6573 2e68  func-overrides.h
+00001560: 746d 6c23 6265 6861 7669 6f72 2d69 6e2d  tml#behavior-in-
+00001570: 636f 6d62 696e 6174 696f 6e2d 7769 7468  combination-with
+00001580: 2d70 7974 686f 6e2d 732d 6269 6e61 7279  -python-s-binary
+00001590: 2d6f 7065 7261 7469 6f6e 730a 2020 2020  -operations.    
+000015a0: 2222 220a 2020 2020 6966 2068 6173 6174  """.    if hasat
+000015b0: 7472 286f 7468 6572 2c20 225f 5f61 7272  tr(other, "__arr
+000015c0: 6179 5f75 6675 6e63 5f5f 2229 2061 6e64  ay_ufunc__") and
+000015d0: 206f 7468 6572 2e5f 5f61 7272 6179 5f75   other.__array_u
+000015e0: 6675 6e63 5f5f 2069 7320 4e6f 6e65 3a0a  func__ is None:.
+000015f0: 2020 2020 2020 2020 7265 7475 726e 2054          return T
+00001600: 7275 650a 2020 2020 656c 6966 2028 0a20  rue.    elif (. 
+00001610: 2020 2020 2020 2068 6173 6174 7472 286f         hasattr(o
+00001620: 7468 6572 2c20 225f 5f61 7272 6179 5f75  ther, "__array_u
+00001630: 6675 6e63 5f5f 2229 0a20 2020 2020 2020  func__").       
+00001640: 2061 6e64 206e 6f74 2069 735f 7661 6c69   and not is_vali
+00001650: 645f 6172 7261 795f 6368 756e 6b28 6f74  d_array_chunk(ot
+00001660: 6865 7229 0a20 2020 2020 2020 2023 2064  her).        # d
+00001670: 6f6e 2774 2064 656c 6567 6174 6520 746f  on't delegate to
+00001680: 206f 7572 206f 776e 2070 6172 656e 7420   our own parent 
+00001690: 636c 6173 7365 730a 2020 2020 2020 2020  classes.        
+000016a0: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
+000016b0: 6365 2873 656c 662c 2074 7970 6528 6f74  ce(self, type(ot
+000016c0: 6865 7229 290a 2020 2020 2020 2020 616e  her)).        an
+000016d0: 6420 7479 7065 2873 656c 6629 2069 7320  d type(self) is 
+000016e0: 6e6f 7420 7479 7065 286f 7468 6572 290a  not type(other).
+000016f0: 2020 2020 293a 0a20 2020 2020 2020 2072      ):.        r
+00001700: 6574 7572 6e20 5472 7565 0a20 2020 2072  eturn True.    r
+00001710: 6574 7572 6e20 4661 6c73 650a 0a0a 6465  eturn False...de
+00001720: 6620 6368 6563 6b5f 6966 5f68 616e 646c  f check_if_handl
+00001730: 6564 5f67 6976 656e 5f6f 7468 6572 2866  ed_given_other(f
+00001740: 293a 0a20 2020 2022 2222 4368 6563 6b20  ):.    """Check 
+00001750: 6966 206d 6574 686f 6420 6973 2068 616e  if method is han
+00001760: 646c 6564 2062 7920 4461 736b 2067 6976  dled by Dask giv
+00001770: 656e 2074 7970 6520 6f66 206f 7468 6572  en type of other
+00001780: 0a0a 2020 2020 456e 7375 7265 7320 7072  ..    Ensures pr
+00001790: 6f70 6572 2064 6566 6572 7261 6c20 746f  oper deferral to
+000017a0: 2075 7063 6173 7420 7479 7065 7320 696e   upcast types in
+000017b0: 2064 756e 6465 7220 6f70 6572 6174 696f   dunder operatio
+000017c0: 6e73 2077 6974 686f 7574 0a20 2020 2061  ns without.    a
+000017d0: 7373 756d 696e 6720 756e 6b6e 6f77 6e20  ssuming unknown 
+000017e0: 7479 7065 7320 6172 6520 6175 746f 6d61  types are automa
+000017f0: 7469 6361 6c6c 7920 646f 776e 6361 7374  tically downcast
+00001800: 2074 7970 6573 2e0a 2020 2020 2222 220a   types..    """.
+00001810: 0a20 2020 2040 7772 6170 7328 6629 0a20  .    @wraps(f). 
+00001820: 2020 2064 6566 2077 7261 7070 6572 2873     def wrapper(s
+00001830: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+00001840: 2020 2020 2069 6620 5f73 686f 756c 645f       if _should_
+00001850: 6465 6c65 6761 7465 2873 656c 662c 206f  delegate(self, o
+00001860: 7468 6572 293a 0a20 2020 2020 2020 2020  ther):.         
+00001870: 2020 2072 6574 7572 6e20 4e6f 7449 6d70     return NotImp
+00001880: 6c65 6d65 6e74 6564 0a20 2020 2020 2020  lemented.       
+00001890: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000018a0: 2020 2072 6574 7572 6e20 6628 7365 6c66     return f(self
+000018b0: 2c20 6f74 6865 7229 0a0a 2020 2020 7265  , other)..    re
+000018c0: 7475 726e 2077 7261 7070 6572 0a0a 0a64  turn wrapper...d
+000018d0: 6566 2073 6c69 6365 735f 6672 6f6d 5f63  ef slices_from_c
+000018e0: 6875 6e6b 7328 6368 756e 6b73 293a 0a20  hunks(chunks):. 
+000018f0: 2020 2022 2222 5472 616e 736c 6174 6520     """Translate 
+00001900: 6368 756e 6b73 2074 7570 6c65 2074 6f20  chunks tuple to 
+00001910: 6120 7365 7420 6f66 2073 6c69 6365 7320  a set of slices 
+00001920: 696e 2070 726f 6475 6374 206f 7264 6572  in product order
+00001930: 0a0a 2020 2020 3e3e 3e20 736c 6963 6573  ..    >>> slices
+00001940: 5f66 726f 6d5f 6368 756e 6b73 2828 2832  _from_chunks(((2
+00001950: 2c20 3229 2c20 2833 2c20 332c 2033 2929  , 2), (3, 3, 3))
+00001960: 2920 2023 2064 6f63 7465 7374 3a20 2b4e  )  # doctest: +N
+00001970: 4f52 4d41 4c49 5a45 5f57 4849 5445 5350  ORMALIZE_WHITESP
+00001980: 4143 450a 2020 2020 205b 2873 6c69 6365  ACE.     [(slice
+00001990: 2830 2c20 322c 204e 6f6e 6529 2c20 736c  (0, 2, None), sl
+000019a0: 6963 6528 302c 2033 2c20 4e6f 6e65 2929  ice(0, 3, None))
+000019b0: 2c0a 2020 2020 2020 2873 6c69 6365 2830  ,.      (slice(0
+000019c0: 2c20 322c 204e 6f6e 6529 2c20 736c 6963  , 2, None), slic
+000019d0: 6528 332c 2036 2c20 4e6f 6e65 2929 2c0a  e(3, 6, None)),.
+000019e0: 2020 2020 2020 2873 6c69 6365 2830 2c20        (slice(0, 
+000019f0: 322c 204e 6f6e 6529 2c20 736c 6963 6528  2, None), slice(
+00001a00: 362c 2039 2c20 4e6f 6e65 2929 2c0a 2020  6, 9, None)),.  
+00001a10: 2020 2020 2873 6c69 6365 2832 2c20 342c      (slice(2, 4,
+00001a20: 204e 6f6e 6529 2c20 736c 6963 6528 302c   None), slice(0,
+00001a30: 2033 2c20 4e6f 6e65 2929 2c0a 2020 2020   3, None)),.    
+00001a40: 2020 2873 6c69 6365 2832 2c20 342c 204e    (slice(2, 4, N
+00001a50: 6f6e 6529 2c20 736c 6963 6528 332c 2036  one), slice(3, 6
+00001a60: 2c20 4e6f 6e65 2929 2c0a 2020 2020 2020  , None)),.      
+00001a70: 2873 6c69 6365 2832 2c20 342c 204e 6f6e  (slice(2, 4, Non
+00001a80: 6529 2c20 736c 6963 6528 362c 2039 2c20  e), slice(6, 9, 
+00001a90: 4e6f 6e65 2929 5d0a 2020 2020 2222 220a  None))].    """.
+00001aa0: 2020 2020 6375 6d64 696d 7320 3d20 5b63      cumdims = [c
+00001ab0: 6163 6865 645f 6375 6d73 756d 2862 6473  ached_cumsum(bds
+00001ac0: 2c20 696e 6974 6961 6c5f 7a65 726f 3d54  , initial_zero=T
+00001ad0: 7275 6529 2066 6f72 2062 6473 2069 6e20  rue) for bds in 
+00001ae0: 6368 756e 6b73 5d0a 2020 2020 736c 6963  chunks].    slic
+00001af0: 6573 203d 205b 0a20 2020 2020 2020 205b  es = [.        [
+00001b00: 736c 6963 6528 732c 2073 202b 2064 696d  slice(s, s + dim
+00001b10: 2920 666f 7220 732c 2064 696d 2069 6e20  ) for s, dim in 
+00001b20: 7a69 7028 7374 6172 7473 2c20 7368 6170  zip(starts, shap
+00001b30: 6573 295d 0a20 2020 2020 2020 2066 6f72  es)].        for
+00001b40: 2073 7461 7274 732c 2073 6861 7065 7320   starts, shapes 
+00001b50: 696e 207a 6970 2863 756d 6469 6d73 2c20  in zip(cumdims, 
+00001b60: 6368 756e 6b73 290a 2020 2020 5d0a 2020  chunks).    ].  
+00001b70: 2020 7265 7475 726e 206c 6973 7428 7072    return list(pr
+00001b80: 6f64 7563 7428 2a73 6c69 6365 7329 290a  oduct(*slices)).
+00001b90: 0a0a 6465 6620 6772 6170 685f 6672 6f6d  ..def graph_from
+00001ba0: 5f61 7272 6179 6c69 6b65 280a 2020 2020  _arraylike(.    
+00001bb0: 6172 722c 2020 2320 416e 7920 6172 7261  arr,  # Any arra
+00001bc0: 792d 6c69 6b65 2077 6869 6368 2073 7570  y-like which sup
+00001bd0: 706f 7274 7320 736c 6963 696e 670a 2020  ports slicing.  
+00001be0: 2020 6368 756e 6b73 2c0a 2020 2020 7368    chunks,.    sh
+00001bf0: 6170 652c 0a20 2020 206e 616d 652c 0a20  ape,.    name,. 
+00001c00: 2020 2067 6574 6974 656d 3d67 6574 7465     getitem=gette
+00001c10: 722c 0a20 2020 206c 6f63 6b3d 4661 6c73  r,.    lock=Fals
+00001c20: 652c 0a20 2020 2061 7361 7272 6179 3d54  e,.    asarray=T
+00001c30: 7275 652c 0a20 2020 2064 7479 7065 3d4e  rue,.    dtype=N
+00001c40: 6f6e 652c 0a20 2020 2069 6e6c 696e 655f  one,.    inline_
+00001c50: 6172 7261 793d 4661 6c73 652c 0a29 202d  array=False,.) -
+00001c60: 3e20 4869 6768 4c65 7665 6c47 7261 7068  > HighLevelGraph
+00001c70: 3a0a 2020 2020 2222 220a 2020 2020 4869  :.    """.    Hi
+00001c80: 6768 4c65 7665 6c47 7261 7068 2066 6f72  ghLevelGraph for
+00001c90: 2073 6c69 6369 6e67 2063 6875 6e6b 7320   slicing chunks 
+00001ca0: 6672 6f6d 2061 6e20 6172 7261 792d 6c69  from an array-li
+00001cb0: 6b65 2061 6363 6f72 6469 6e67 2074 6f20  ke according to 
+00001cc0: 6120 6368 756e 6b20 7061 7474 6572 6e2e  a chunk pattern.
+00001cd0: 0a0a 2020 2020 4966 2060 6069 6e6c 696e  ..    If ``inlin
+00001ce0: 655f 6172 7261 7960 6020 6973 2054 7275  e_array`` is Tru
+00001cf0: 652c 2074 6869 7320 6d61 6b65 2061 2042  e, this make a B
+00001d00: 6c6f 636b 7769 7365 206c 6179 6572 206f  lockwise layer o
+00001d10: 6620 736c 6963 696e 6720 7461 736b 7320  f slicing tasks 
+00001d20: 7768 6572 6520 7468 650a 2020 2020 6172  where the.    ar
+00001d30: 7261 792d 6c69 6b65 2069 7320 656d 6265  ray-like is embe
+00001d40: 6464 6564 2069 6e74 6f20 6576 6572 7920  dded into every 
+00001d50: 7461 736b 2e2c 0a0a 2020 2020 4966 2060  task.,..    If `
+00001d60: 6069 6e6c 696e 655f 6172 7261 7960 6020  `inline_array`` 
+00001d70: 6973 2046 616c 7365 2c20 7468 6973 2069  is False, this i
+00001d80: 6e73 6572 7473 2074 6865 2061 7272 6179  nserts the array
+00001d90: 2d6c 696b 6520 6173 2061 2073 7461 6e64  -like as a stand
+00001da0: 616c 6f6e 6520 7661 6c75 6520 696e 0a20  alone value in. 
+00001db0: 2020 2061 204d 6174 6572 6961 6c69 7a65     a Materialize
+00001dc0: 644c 6179 6572 2c20 7468 656e 2067 656e  dLayer, then gen
+00001dd0: 6572 6174 6573 2061 2042 6c6f 636b 7769  erates a Blockwi
+00001de0: 7365 206c 6179 6572 206f 6620 736c 6963  se layer of slic
+00001df0: 696e 6720 7461 736b 7320 7468 6174 2072  ing tasks that r
+00001e00: 6566 6572 0a20 2020 2074 6f20 6974 2e0a  efer.    to it..
+00001e10: 0a20 2020 203e 3e3e 2064 6963 7428 6772  .    >>> dict(gr
+00001e20: 6170 685f 6672 6f6d 5f61 7272 6179 6c69  aph_from_arrayli
+00001e30: 6b65 2861 7272 2c20 6368 756e 6b73 3d28  ke(arr, chunks=(
+00001e40: 322c 2033 292c 2073 6861 7065 3d28 342c  2, 3), shape=(4,
+00001e50: 2036 292c 206e 616d 653d 2258 222c 2069   6), name="X", i
+00001e60: 6e6c 696e 655f 6172 7261 793d 5472 7565  nline_array=True
+00001e70: 2929 2020 2320 646f 6374 6573 743a 202b  ))  # doctest: +
+00001e80: 534b 4950 0a20 2020 207b 2861 7272 2c20  SKIP.    {(arr, 
+00001e90: 302c 2030 293a 2028 6765 7474 6572 2c20  0, 0): (getter, 
+00001ea0: 6172 722c 2028 736c 6963 6528 302c 2032  arr, (slice(0, 2
+00001eb0: 292c 2073 6c69 6365 2830 2c20 3329 2929  ), slice(0, 3)))
+00001ec0: 2c0a 2020 2020 2028 6172 722c 2031 2c20  ,.     (arr, 1, 
+00001ed0: 3029 3a20 2867 6574 7465 722c 2061 7272  0): (getter, arr
+00001ee0: 2c20 2873 6c69 6365 2832 2c20 3429 2c20  , (slice(2, 4), 
+00001ef0: 736c 6963 6528 302c 2033 2929 292c 0a20  slice(0, 3))),. 
+00001f00: 2020 2020 2861 7272 2c20 312c 2031 293a      (arr, 1, 1):
+00001f10: 2028 6765 7474 6572 2c20 6172 722c 2028   (getter, arr, (
+00001f20: 736c 6963 6528 322c 2034 292c 2073 6c69  slice(2, 4), sli
+00001f30: 6365 2833 2c20 3629 2929 2c0a 2020 2020  ce(3, 6))),.    
+00001f40: 2028 6172 722c 2030 2c20 3129 3a20 2867   (arr, 0, 1): (g
+00001f50: 6574 7465 722c 2061 7272 2c20 2873 6c69  etter, arr, (sli
+00001f60: 6365 2830 2c20 3229 2c20 736c 6963 6528  ce(0, 2), slice(
+00001f70: 332c 2036 2929 297d 0a0a 2020 2020 3e3e  3, 6)))}..    >>
+00001f80: 3e20 6469 6374 2820 2023 2064 6f63 7465  > dict(  # docte
+00001f90: 7374 3a20 2b53 4b49 500a 2020 2020 2020  st: +SKIP.      
+00001fa0: 2020 2020 2020 6772 6170 685f 6672 6f6d        graph_from
+00001fb0: 5f61 7272 6179 6c69 6b65 2861 7272 2c20  _arraylike(arr, 
+00001fc0: 6368 756e 6b73 3d28 2832 2c20 3229 2c20  chunks=((2, 2), 
+00001fd0: 2833 2c20 3329 292c 2073 6861 7065 3d28  (3, 3)), shape=(
+00001fe0: 342c 3629 2c20 6e61 6d65 3d22 5822 2c20  4,6), name="X", 
+00001ff0: 696e 6c69 6e65 5f61 7272 6179 3d46 616c  inline_array=Fal
+00002000: 7365 290a 2020 2020 2020 2020 290a 2020  se).        ).  
+00002010: 2020 7b22 6f72 6967 696e 616c 2d58 223a    {"original-X":
+00002020: 2061 7272 2c0a 2020 2020 2028 2758 272c   arr,.     ('X',
+00002030: 2030 2c20 3029 3a20 2867 6574 7465 722c   0, 0): (getter,
+00002040: 2027 6f72 6967 696e 616c 2d58 272c 2028   'original-X', (
+00002050: 736c 6963 6528 302c 2032 292c 2073 6c69  slice(0, 2), sli
+00002060: 6365 2830 2c20 3329 2929 2c0a 2020 2020  ce(0, 3))),.    
+00002070: 2028 2758 272c 2031 2c20 3029 3a20 2867   ('X', 1, 0): (g
+00002080: 6574 7465 722c 2027 6f72 6967 696e 616c  etter, 'original
+00002090: 2d58 272c 2028 736c 6963 6528 322c 2034  -X', (slice(2, 4
+000020a0: 292c 2073 6c69 6365 2830 2c20 3329 2929  ), slice(0, 3)))
+000020b0: 2c0a 2020 2020 2028 2758 272c 2031 2c20  ,.     ('X', 1, 
+000020c0: 3129 3a20 2867 6574 7465 722c 2027 6f72  1): (getter, 'or
+000020d0: 6967 696e 616c 2d58 272c 2028 736c 6963  iginal-X', (slic
+000020e0: 6528 322c 2034 292c 2073 6c69 6365 2833  e(2, 4), slice(3
+000020f0: 2c20 3629 2929 2c0a 2020 2020 2028 2758  , 6))),.     ('X
+00002100: 272c 2030 2c20 3129 3a20 2867 6574 7465  ', 0, 1): (gette
+00002110: 722c 2027 6f72 6967 696e 616c 2d58 272c  r, 'original-X',
+00002120: 2028 736c 6963 6528 302c 2032 292c 2073   (slice(0, 2), s
+00002130: 6c69 6365 2833 2c20 3629 2929 7d0a 2020  lice(3, 6)))}.  
+00002140: 2020 2222 220a 2020 2020 6368 756e 6b73    """.    chunks
+00002150: 203d 206e 6f72 6d61 6c69 7a65 5f63 6875   = normalize_chu
+00002160: 6e6b 7328 6368 756e 6b73 2c20 7368 6170  nks(chunks, shap
+00002170: 652c 2064 7479 7065 3d64 7479 7065 290a  e, dtype=dtype).
+00002180: 2020 2020 6f75 745f 696e 6420 3d20 7475      out_ind = tu
+00002190: 706c 6528 7261 6e67 6528 6c65 6e28 7368  ple(range(len(sh
+000021a0: 6170 6529 2929 0a0a 2020 2020 6966 2028  ape)))..    if (
+000021b0: 0a20 2020 2020 2020 2068 6173 5f6b 6579  .        has_key
+000021c0: 776f 7264 2867 6574 6974 656d 2c20 2261  word(getitem, "a
+000021d0: 7361 7272 6179 2229 0a20 2020 2020 2020  sarray").       
+000021e0: 2061 6e64 2068 6173 5f6b 6579 776f 7264   and has_keyword
+000021f0: 2867 6574 6974 656d 2c20 226c 6f63 6b22  (getitem, "lock"
+00002200: 290a 2020 2020 2020 2020 616e 6420 286e  ).        and (n
+00002210: 6f74 2061 7361 7272 6179 206f 7220 6c6f  ot asarray or lo
+00002220: 636b 290a 2020 2020 293a 0a20 2020 2020  ck).    ):.     
+00002230: 2020 206b 7761 7267 7320 3d20 7b22 6173     kwargs = {"as
+00002240: 6172 7261 7922 3a20 6173 6172 7261 792c  array": asarray,
+00002250: 2022 6c6f 636b 223a 206c 6f63 6b7d 0a20   "lock": lock}. 
+00002260: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00002270: 2023 2043 6f6d 6d6f 6e20 6361 7365 2c20   # Common case, 
+00002280: 6472 6f70 2065 7874 7261 2070 6172 616d  drop extra param
+00002290: 6574 6572 730a 2020 2020 2020 2020 6b77  eters.        kw
+000022a0: 6172 6773 203d 207b 7d0a 0a20 2020 2069  args = {}..    i
+000022b0: 6620 696e 6c69 6e65 5f61 7272 6179 3a0a  f inline_array:.
+000022c0: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
+000022d0: 636f 7265 5f62 6c6f 636b 7769 7365 280a  core_blockwise(.
+000022e0: 2020 2020 2020 2020 2020 2020 6765 7469              geti
+000022f0: 7465 6d2c 0a20 2020 2020 2020 2020 2020  tem,.           
+00002300: 206e 616d 652c 0a20 2020 2020 2020 2020   name,.         
+00002310: 2020 206f 7574 5f69 6e64 2c0a 2020 2020     out_ind,.    
+00002320: 2020 2020 2020 2020 6172 722c 0a20 2020          arr,.   
+00002330: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
+00002340: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+00002350: 536c 6963 6544 6570 2863 6875 6e6b 7329  SliceDep(chunks)
+00002360: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00002370: 745f 696e 642c 0a20 2020 2020 2020 2020  t_ind,.         
+00002380: 2020 206e 756d 626c 6f63 6b73 3d7b 7d2c     numblocks={},
+00002390: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
+000023a0: 7761 7267 732c 0a20 2020 2020 2020 2029  wargs,.        )
+000023b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000023c0: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
+000023d0: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
+000023e0: 6e61 6d65 2c20 6c61 7965 7229 0a20 2020  name, layer).   
+000023f0: 2065 6c73 653a 0a20 2020 2020 2020 206f   else:.        o
+00002400: 7269 6769 6e61 6c5f 6e61 6d65 203d 2022  riginal_name = "
+00002410: 6f72 6967 696e 616c 2d22 202b 206e 616d  original-" + nam
+00002420: 650a 0a20 2020 2020 2020 206c 6179 6572  e..        layer
+00002430: 7320 3d20 7b7d 0a20 2020 2020 2020 206c  s = {}.        l
+00002440: 6179 6572 735b 6f72 6967 696e 616c 5f6e  ayers[original_n
+00002450: 616d 655d 203d 204d 6174 6572 6961 6c69  ame] = Materiali
+00002460: 7a65 644c 6179 6572 287b 6f72 6967 696e  zedLayer({origin
+00002470: 616c 5f6e 616d 653a 2061 7272 7d29 0a20  al_name: arr}). 
+00002480: 2020 2020 2020 206c 6179 6572 735b 6e61         layers[na
+00002490: 6d65 5d20 3d20 636f 7265 5f62 6c6f 636b  me] = core_block
+000024a0: 7769 7365 280a 2020 2020 2020 2020 2020  wise(.          
+000024b0: 2020 6765 7469 7465 6d2c 0a20 2020 2020    getitem,.     
+000024c0: 2020 2020 2020 206e 616d 652c 0a20 2020         name,.   
+000024d0: 2020 2020 2020 2020 206f 7574 5f69 6e64           out_ind
+000024e0: 2c0a 2020 2020 2020 2020 2020 2020 6f72  ,.            or
+000024f0: 6967 696e 616c 5f6e 616d 652c 0a20 2020  iginal_name,.   
+00002500: 2020 2020 2020 2020 204e 6f6e 652c 0a20           None,. 
+00002510: 2020 2020 2020 2020 2020 2041 7272 6179             Array
+00002520: 536c 6963 6544 6570 2863 6875 6e6b 7329  SliceDep(chunks)
+00002530: 2c0a 2020 2020 2020 2020 2020 2020 6f75  ,.            ou
+00002540: 745f 696e 642c 0a20 2020 2020 2020 2020  t_ind,.         
+00002550: 2020 206e 756d 626c 6f63 6b73 3d7b 7d2c     numblocks={},
+00002560: 0a20 2020 2020 2020 2020 2020 202a 2a6b  .            **k
+00002570: 7761 7267 732c 0a20 2020 2020 2020 2029  wargs,.        )
+00002580: 0a0a 2020 2020 2020 2020 6465 7073 203d  ..        deps =
+00002590: 207b 0a20 2020 2020 2020 2020 2020 206f   {.            o
+000025a0: 7269 6769 6e61 6c5f 6e61 6d65 3a20 7365  riginal_name: se
+000025b0: 7428 292c 0a20 2020 2020 2020 2020 2020  t(),.           
+000025c0: 206e 616d 653a 207b 6f72 6967 696e 616c   name: {original
+000025d0: 5f6e 616d 657d 2c0a 2020 2020 2020 2020  _name},.        
+000025e0: 7d0a 2020 2020 2020 2020 7265 7475 726e  }.        return
+000025f0: 2048 6967 684c 6576 656c 4772 6170 6828   HighLevelGraph(
+00002600: 6c61 7965 7273 2c20 6465 7073 290a 0a0a  layers, deps)...
+00002610: 6465 6620 646f 746d 616e 7928 412c 2042  def dotmany(A, B
+00002620: 2c20 6c65 6674 6675 6e63 3d4e 6f6e 652c  , leftfunc=None,
+00002630: 2072 6967 6874 6675 6e63 3d4e 6f6e 652c   rightfunc=None,
+00002640: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+00002650: 2222 2244 6f74 2070 726f 6475 6374 206f  """Dot product o
+00002660: 6620 6d61 6e79 2061 6c69 676e 6564 2063  f many aligned c
+00002670: 6875 6e6b 730a 0a20 2020 203e 3e3e 2078  hunks..    >>> x
+00002680: 203d 206e 702e 6172 7261 7928 5b5b 312c   = np.array([[1,
+00002690: 2032 5d2c 205b 312c 2032 5d5d 290a 2020   2], [1, 2]]).  
+000026a0: 2020 3e3e 3e20 7920 3d20 6e70 2e61 7272    >>> y = np.arr
+000026b0: 6179 285b 5b31 302c 2032 305d 2c20 5b31  ay([[10, 20], [1
+000026c0: 302c 2032 305d 5d29 0a20 2020 203e 3e3e  0, 20]]).    >>>
+000026d0: 2064 6f74 6d61 6e79 285b 782c 2078 2c20   dotmany([x, x, 
+000026e0: 785d 2c20 5b79 2c20 792c 2079 5d29 0a20  x], [y, y, y]). 
+000026f0: 2020 2061 7272 6179 285b 5b20 3930 2c20     array([[ 90, 
+00002700: 3138 305d 2c0a 2020 2020 2020 2020 2020  180],.          
+00002710: 205b 2039 302c 2031 3830 5d5d 290a 0a20   [ 90, 180]]).. 
+00002720: 2020 204f 7074 696f 6e61 6c6c 7920 7061     Optionally pa
+00002730: 7373 2069 6e20 6675 6e63 7469 6f6e 7320  ss in functions 
+00002740: 746f 2061 7070 6c79 2074 6f20 7468 6520  to apply to the 
+00002750: 6c65 6674 2061 6e64 2072 6967 6874 2063  left and right c
+00002760: 6875 6e6b 730a 0a20 2020 203e 3e3e 2064  hunks..    >>> d
+00002770: 6f74 6d61 6e79 285b 782c 2078 2c20 785d  otmany([x, x, x]
+00002780: 2c20 5b79 2c20 792c 2079 5d2c 2072 6967  , [y, y, y], rig
+00002790: 6874 6675 6e63 3d6e 702e 7472 616e 7370  htfunc=np.transp
+000027a0: 6f73 6529 0a20 2020 2061 7272 6179 285b  ose).    array([
+000027b0: 5b31 3530 2c20 3135 305d 2c0a 2020 2020  [150, 150],.    
+000027c0: 2020 2020 2020 205b 3135 302c 2031 3530         [150, 150
+000027d0: 5d5d 290a 2020 2020 2222 220a 2020 2020  ]]).    """.    
+000027e0: 6966 206c 6566 7466 756e 633a 0a20 2020  if leftfunc:.   
+000027f0: 2020 2020 2041 203d 206d 6170 286c 6566       A = map(lef
+00002800: 7466 756e 632c 2041 290a 2020 2020 6966  tfunc, A).    if
+00002810: 2072 6967 6874 6675 6e63 3a0a 2020 2020   rightfunc:.    
+00002820: 2020 2020 4220 3d20 6d61 7028 7269 6768      B = map(righ
+00002830: 7466 756e 632c 2042 290a 2020 2020 7265  tfunc, B).    re
+00002840: 7475 726e 2073 756d 286d 6170 2870 6172  turn sum(map(par
+00002850: 7469 616c 286e 702e 646f 742c 202a 2a6b  tial(np.dot, **k
+00002860: 7761 7267 7329 2c20 412c 2042 2929 0a0a  wargs), A, B))..
+00002870: 0a64 6566 205f 636f 6e63 6174 656e 6174  .def _concatenat
+00002880: 6532 2861 7272 6179 732c 2061 7865 733d  e2(arrays, axes=
+00002890: 4e6f 6e65 293a 0a20 2020 2022 2222 5265  None):.    """Re
+000028a0: 6375 7273 6976 656c 7920 636f 6e63 6174  cursively concat
+000028b0: 656e 6174 6520 6e65 7374 6564 206c 6973  enate nested lis
+000028c0: 7473 206f 6620 6172 7261 7973 2061 6c6f  ts of arrays alo
+000028d0: 6e67 2061 7865 730a 0a20 2020 2045 6163  ng axes..    Eac
+000028e0: 6820 656e 7472 7920 696e 2061 7865 7320  h entry in axes 
+000028f0: 636f 7272 6573 706f 6e64 7320 746f 2065  corresponds to e
+00002900: 6163 6820 6c65 7665 6c20 6f66 2074 6865  ach level of the
+00002910: 206e 6573 7465 6420 6c69 7374 2e20 2054   nested list.  T
+00002920: 6865 0a20 2020 206c 656e 6774 6820 6f66  he.    length of
+00002930: 2061 7865 7320 7368 6f75 6c64 2063 6f72   axes should cor
+00002940: 7265 7370 6f6e 6420 746f 2074 6865 206c  respond to the l
+00002950: 6576 656c 206f 6620 6e65 7374 696e 6720  evel of nesting 
+00002960: 6f66 2061 7272 6179 732e 0a20 2020 2049  of arrays..    I
+00002970: 6620 6178 6573 2069 7320 616e 2065 6d70  f axes is an emp
+00002980: 7479 206c 6973 7420 6f72 2074 7570 6c65  ty list or tuple
+00002990: 2c20 7265 7475 726e 2061 7272 6179 732c  , return arrays,
+000029a0: 206f 7220 6172 7261 7973 5b30 5d20 6966   or arrays[0] if
+000029b0: 0a20 2020 2061 7272 6179 7320 6973 2061  .    arrays is a
+000029c0: 206c 6973 742e 0a0a 2020 2020 3e3e 3e20   list...    >>> 
+000029d0: 7820 3d20 6e70 2e61 7272 6179 285b 5b31  x = np.array([[1
+000029e0: 2c20 325d 2c20 5b33 2c20 345d 5d29 0a20  , 2], [3, 4]]). 
+000029f0: 2020 203e 3e3e 205f 636f 6e63 6174 656e     >>> _concaten
+00002a00: 6174 6532 285b 782c 2078 5d2c 2061 7865  ate2([x, x], axe
+00002a10: 733d 5b30 5d29 0a20 2020 2061 7272 6179  s=[0]).    array
+00002a20: 285b 5b31 2c20 325d 2c0a 2020 2020 2020  ([[1, 2],.      
+00002a30: 2020 2020 205b 332c 2034 5d2c 0a20 2020       [3, 4],.   
+00002a40: 2020 2020 2020 2020 5b31 2c20 325d 2c0a          [1, 2],.
+00002a50: 2020 2020 2020 2020 2020 205b 332c 2034             [3, 4
+00002a60: 5d5d 290a 0a20 2020 203e 3e3e 205f 636f  ]])..    >>> _co
+00002a70: 6e63 6174 656e 6174 6532 285b 782c 2078  ncatenate2([x, x
+00002a80: 5d2c 2061 7865 733d 5b31 5d29 0a20 2020  ], axes=[1]).   
+00002a90: 2061 7272 6179 285b 5b31 2c20 322c 2031   array([[1, 2, 1
+00002aa0: 2c20 325d 2c0a 2020 2020 2020 2020 2020  , 2],.          
+00002ab0: 205b 332c 2034 2c20 332c 2034 5d5d 290a   [3, 4, 3, 4]]).
+00002ac0: 0a20 2020 203e 3e3e 205f 636f 6e63 6174  .    >>> _concat
+00002ad0: 656e 6174 6532 285b 5b78 2c20 785d 2c20  enate2([[x, x], 
+00002ae0: 5b78 2c20 785d 5d2c 2061 7865 733d 5b30  [x, x]], axes=[0
+00002af0: 2c20 315d 290a 2020 2020 6172 7261 7928  , 1]).    array(
+00002b00: 5b5b 312c 2032 2c20 312c 2032 5d2c 0a20  [[1, 2, 1, 2],. 
+00002b10: 2020 2020 2020 2020 2020 5b33 2c20 342c            [3, 4,
+00002b20: 2033 2c20 345d 2c0a 2020 2020 2020 2020   3, 4],.        
+00002b30: 2020 205b 312c 2032 2c20 312c 2032 5d2c     [1, 2, 1, 2],
+00002b40: 0a20 2020 2020 2020 2020 2020 5b33 2c20  .           [3, 
+00002b50: 342c 2033 2c20 345d 5d29 0a0a 2020 2020  4, 3, 4]])..    
+00002b60: 5375 7070 6f72 7473 2049 7465 7261 746f  Supports Iterato
+00002b70: 7273 0a20 2020 203e 3e3e 205f 636f 6e63  rs.    >>> _conc
+00002b80: 6174 656e 6174 6532 2869 7465 7228 5b78  atenate2(iter([x
+00002b90: 2c20 785d 292c 2061 7865 733d 5b31 5d29  , x]), axes=[1])
+00002ba0: 0a20 2020 2061 7272 6179 285b 5b31 2c20  .    array([[1, 
+00002bb0: 322c 2031 2c20 325d 2c0a 2020 2020 2020  2, 1, 2],.      
+00002bc0: 2020 2020 205b 332c 2034 2c20 332c 2034       [3, 4, 3, 4
+00002bd0: 5d5d 290a 0a20 2020 2053 7065 6369 616c  ]])..    Special
+00002be0: 2043 6173 650a 2020 2020 3e3e 3e20 5f63   Case.    >>> _c
+00002bf0: 6f6e 6361 7465 6e61 7465 3228 5b78 2c20  oncatenate2([x, 
+00002c00: 785d 2c20 6178 6573 3d28 2929 0a20 2020  x], axes=()).   
+00002c10: 2061 7272 6179 285b 5b31 2c20 325d 2c0a   array([[1, 2],.
+00002c20: 2020 2020 2020 2020 2020 205b 332c 2034             [3, 4
+00002c30: 5d5d 290a 2020 2020 2222 220a 2020 2020  ]]).    """.    
+00002c40: 6966 2061 7865 7320 6973 204e 6f6e 653a  if axes is None:
+00002c50: 0a20 2020 2020 2020 2061 7865 7320 3d20  .        axes = 
+00002c60: 5b5d 0a0a 2020 2020 6966 2061 7865 7320  []..    if axes 
+00002c70: 3d3d 2028 293a 0a20 2020 2020 2020 2069  == ():.        i
+00002c80: 6620 6973 696e 7374 616e 6365 2861 7272  f isinstance(arr
+00002c90: 6179 732c 206c 6973 7429 3a0a 2020 2020  ays, list):.    
+00002ca0: 2020 2020 2020 2020 7265 7475 726e 2061          return a
+00002cb0: 7272 6179 735b 305d 0a20 2020 2020 2020  rrays[0].       
+00002cc0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00002cd0: 2020 2072 6574 7572 6e20 6172 7261 7973     return arrays
+00002ce0: 0a0a 2020 2020 6966 2069 7369 6e73 7461  ..    if isinsta
+00002cf0: 6e63 6528 6172 7261 7973 2c20 4974 6572  nce(arrays, Iter
+00002d00: 6174 6f72 293a 0a20 2020 2020 2020 2061  ator):.        a
+00002d10: 7272 6179 7320 3d20 6c69 7374 2861 7272  rrays = list(arr
+00002d20: 6179 7329 0a20 2020 2069 6620 6e6f 7420  ays).    if not 
+00002d30: 6973 696e 7374 616e 6365 2861 7272 6179  isinstance(array
+00002d40: 732c 2028 6c69 7374 2c20 7475 706c 6529  s, (list, tuple)
+00002d50: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+00002d60: 6e20 6172 7261 7973 0a20 2020 2069 6620  n arrays.    if 
+00002d70: 6c65 6e28 6178 6573 2920 3e20 313a 0a20  len(axes) > 1:. 
+00002d80: 2020 2020 2020 2061 7272 6179 7320 3d20         arrays = 
+00002d90: 5b5f 636f 6e63 6174 656e 6174 6532 2861  [_concatenate2(a
+00002da0: 2c20 6178 6573 3d61 7865 735b 313a 5d29  , axes=axes[1:])
+00002db0: 2066 6f72 2061 2069 6e20 6172 7261 7973   for a in arrays
+00002dc0: 5d0a 2020 2020 636f 6e63 6174 656e 6174  ].    concatenat
+00002dd0: 6520 3d20 636f 6e63 6174 656e 6174 655f  e = concatenate_
+00002de0: 6c6f 6f6b 7570 2e64 6973 7061 7463 6828  lookup.dispatch(
+00002df0: 0a20 2020 2020 2020 2074 7970 6528 6d61  .        type(ma
+00002e00: 7828 6172 7261 7973 2c20 6b65 793d 6c61  x(arrays, key=la
+00002e10: 6d62 6461 2078 3a20 6765 7461 7474 7228  mbda x: getattr(
+00002e20: 782c 2022 5f5f 6172 7261 795f 7072 696f  x, "__array_prio
+00002e30: 7269 7479 5f5f 222c 2030 2929 290a 2020  rity__", 0))).  
+00002e40: 2020 290a 2020 2020 6966 2069 7369 6e73    ).    if isins
+00002e50: 7461 6e63 6528 6172 7261 7973 5b30 5d2c  tance(arrays[0],
+00002e60: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+00002e70: 2320 4861 6e64 6c65 2063 6f6e 6361 7465  # Handle concate
+00002e80: 6e61 7469 6f6e 206f 6620 6064 6963 7460  nation of `dict`
+00002e90: 732c 2075 7365 6420 6173 2061 2072 6570  s, used as a rep
+00002ea0: 6c61 6365 6d65 6e74 2066 6f72 2073 7472  lacement for str
+00002eb0: 7563 7475 7265 640a 2020 2020 2020 2020  uctured.        
+00002ec0: 2320 6172 7261 7973 2077 6865 6e20 7468  # arrays when th
+00002ed0: 6174 2773 206e 6f74 2073 7570 706f 7274  at's not support
+00002ee0: 6564 2062 7920 7468 6520 6172 7261 7920  ed by the array 
+00002ef0: 6c69 6272 6172 7920 2865 2e67 2e2c 2043  library (e.g., C
+00002f00: 7550 7929 2e0a 2020 2020 2020 2020 6b65  uPy)..        ke
+00002f10: 7973 203d 206c 6973 7428 6172 7261 7973  ys = list(arrays
+00002f20: 5b30 5d2e 6b65 7973 2829 290a 2020 2020  [0].keys()).    
+00002f30: 2020 2020 6173 7365 7274 2061 6c6c 286c      assert all(l
+00002f40: 6973 7428 612e 6b65 7973 2829 2920 3d3d  ist(a.keys()) ==
+00002f50: 206b 6579 7320 666f 7220 6120 696e 2061   keys for a in a
+00002f60: 7272 6179 7329 0a20 2020 2020 2020 2072  rrays).        r
+00002f70: 6574 203d 2064 6963 7428 290a 2020 2020  et = dict().    
+00002f80: 2020 2020 666f 7220 6b20 696e 206b 6579      for k in key
+00002f90: 733a 0a20 2020 2020 2020 2020 2020 2072  s:.            r
+00002fa0: 6574 5b6b 5d20 3d20 636f 6e63 6174 656e  et[k] = concaten
+00002fb0: 6174 6528 6c69 7374 2861 5b6b 5d20 666f  ate(list(a[k] fo
+00002fc0: 7220 6120 696e 2061 7272 6179 7329 2c20  r a in arrays), 
+00002fd0: 6178 6973 3d61 7865 735b 305d 290a 2020  axis=axes[0]).  
+00002fe0: 2020 2020 2020 7265 7475 726e 2072 6574        return ret
+00002ff0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00003000: 2020 2072 6574 7572 6e20 636f 6e63 6174     return concat
+00003010: 656e 6174 6528 6172 7261 7973 2c20 6178  enate(arrays, ax
+00003020: 6973 3d61 7865 735b 305d 290a 0a0a 6465  is=axes[0])...de
+00003030: 6620 6170 706c 795f 696e 6665 725f 6474  f apply_infer_dt
+00003040: 7970 6528 6675 6e63 2c20 6172 6773 2c20  ype(func, args, 
+00003050: 6b77 6172 6773 2c20 6675 6e63 6e61 6d65  kwargs, funcname
+00003060: 2c20 7375 6767 6573 745f 6474 7970 653d  , suggest_dtype=
+00003070: 2264 7479 7065 222c 206e 6f75 743d 4e6f  "dtype", nout=No
+00003080: 6e65 293a 0a20 2020 2022 2222 0a20 2020  ne):.    """.   
+00003090: 2054 7269 6573 2074 6f20 696e 6665 7220   Tries to infer 
+000030a0: 6f75 7470 7574 2064 7479 7065 206f 6620  output dtype of 
+000030b0: 6060 6675 6e63 6060 2066 6f72 2061 2073  ``func`` for a s
+000030c0: 6d61 6c6c 2073 6574 206f 6620 696e 7075  mall set of inpu
+000030d0: 7420 6172 6775 6d65 6e74 732e 0a0a 2020  t arguments...  
+000030e0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+000030f0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00003100: 6675 6e63 3a20 4361 6c6c 6162 6c65 0a20  func: Callable. 
+00003110: 2020 2020 2020 2046 756e 6374 696f 6e20         Function 
+00003120: 666f 7220 7768 6963 6820 6f75 7470 7574  for which output
+00003130: 2064 7479 7065 2069 7320 746f 2062 6520   dtype is to be 
+00003140: 6465 7465 726d 696e 6564 0a0a 2020 2020  determined..    
+00003150: 6172 6773 3a20 4c69 7374 206f 6620 6172  args: List of ar
+00003160: 7261 7920 6c69 6b65 0a20 2020 2020 2020  ray like.       
+00003170: 2041 7267 756d 656e 7473 2074 6f20 7468   Arguments to th
+00003180: 6520 6675 6e63 7469 6f6e 2c20 7768 6963  e function, whic
+00003190: 6820 776f 756c 6420 7573 7561 6c6c 7920  h would usually 
+000031a0: 6265 2075 7365 642e 204f 6e6c 7920 6174  be used. Only at
+000031b0: 7472 6962 7574 6573 0a20 2020 2020 2020  tributes.       
+000031c0: 2060 606e 6469 6d60 6020 616e 6420 6060   ``ndim`` and ``
+000031d0: 6474 7970 6560 6020 6172 6520 7573 6564  dtype`` are used
+000031e0: 2e0a 0a20 2020 206b 7761 7267 733a 2064  ...    kwargs: d
+000031f0: 6963 740a 2020 2020 2020 2020 4164 6469  ict.        Addi
+00003200: 7469 6f6e 616c 2060 606b 7761 7267 7360  tional ``kwargs`
+00003210: 6020 746f 2074 6865 2060 6066 756e 6360  ` to the ``func`
+00003220: 600a 0a20 2020 2066 756e 636e 616d 653a  `..    funcname:
+00003230: 2053 7472 696e 670a 2020 2020 2020 2020   String.        
+00003240: 4e61 6d65 206f 6620 6361 6c6c 696e 6720  Name of calling 
+00003250: 6675 6e63 7469 6f6e 2074 6f20 696d 7072  function to impr
+00003260: 6f76 6520 706f 7465 6e74 6961 6c20 6572  ove potential er
+00003270: 726f 7220 6d65 7373 6167 6573 0a0a 2020  ror messages..  
+00003280: 2020 7375 6767 6573 745f 6474 7970 653a    suggest_dtype:
+00003290: 204e 6f6e 652f 4661 6c73 6520 6f72 2053   None/False or S
+000032a0: 7472 696e 670a 2020 2020 2020 2020 4966  tring.        If
+000032b0: 206e 6f74 2060 604e 6f6e 6560 6020 6164   not ``None`` ad
+000032c0: 6473 2073 7567 6765 7374 696f 6e20 746f  ds suggestion to
+000032d0: 2070 6f74 656e 7469 616c 2065 7272 6f72   potential error
+000032e0: 206d 6573 7361 6765 2074 6f20 7370 6563   message to spec
+000032f0: 6966 7920 6120 6474 7970 650a 2020 2020  ify a dtype.    
+00003300: 2020 2020 7669 6120 7468 6520 7370 6563      via the spec
+00003310: 6966 6965 6420 6b77 6172 672e 2044 6566  ified kwarg. Def
+00003320: 6175 6c74 7320 746f 2060 6027 6474 7970  aults to ``'dtyp
+00003330: 6527 6060 2e0a 0a20 2020 206e 6f75 743a  e'``...    nout:
+00003340: 204e 6f6e 6520 6f72 2049 6e74 0a20 2020   None or Int.   
+00003350: 2020 2020 2060 604e 6f6e 6560 6020 6966       ``None`` if
+00003360: 2066 756e 6374 696f 6e20 7265 7475 726e   function return
+00003370: 7320 7369 6e67 6c65 206f 7574 7075 742c  s single output,
+00003380: 2069 6e74 6567 6572 2069 6620 6d61 6e79   integer if many
+00003390: 2e0a 2020 2020 2020 2020 4465 6661 756c  ..        Defaul
+000033a0: 7473 2074 6f20 6060 4e6f 6e65 6060 2e0a  ts to ``None``..
+000033b0: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+000033c0: 202d 2d2d 2d2d 2d2d 0a20 2020 203a 2064   -------.    : d
+000033d0: 7479 7065 206f 7220 4c69 7374 206f 6620  type or List of 
+000033e0: 6474 7970 650a 2020 2020 2020 2020 4f6e  dtype.        On
+000033f0: 6520 6f72 206d 616e 7920 6474 7970 6573  e or many dtypes
+00003400: 2028 6465 7065 6e64 696e 6720 6f6e 2060   (depending on `
+00003410: 606e 6f75 7460 6029 0a20 2020 2022 2222  `nout``).    """
+00003420: 0a20 2020 2066 726f 6d20 6461 736b 2e61  .    from dask.a
+00003430: 7272 6179 2e75 7469 6c73 2069 6d70 6f72  rray.utils impor
+00003440: 7420 6d65 7461 5f66 726f 6d5f 6172 7261  t meta_from_arra
+00003450: 790a 0a20 2020 2023 206d 616b 6520 7375  y..    # make su
+00003460: 7265 2074 6861 7420 6576 6572 7920 6172  re that every ar
+00003470: 6720 6973 2061 6e20 6576 616c 7561 7465  g is an evaluate
+00003480: 6420 6172 7261 790a 2020 2020 6172 6773  d array.    args
+00003490: 203d 205b 0a20 2020 2020 2020 206e 702e   = [.        np.
+000034a0: 6f6e 6573 5f6c 696b 6528 6d65 7461 5f66  ones_like(meta_f
+000034b0: 726f 6d5f 6172 7261 7928 7829 2c20 7368  rom_array(x), sh
+000034c0: 6170 653d 2828 312c 2920 2a20 782e 6e64  ape=((1,) * x.nd
+000034d0: 696d 292c 2064 7479 7065 3d78 2e64 7479  im), dtype=x.dty
+000034e0: 7065 290a 2020 2020 2020 2020 6966 2069  pe).        if i
+000034f0: 735f 6172 7261 796c 696b 6528 7829 0a20  s_arraylike(x). 
+00003500: 2020 2020 2020 2065 6c73 6520 780a 2020         else x.  
+00003510: 2020 2020 2020 666f 7220 7820 696e 2061        for x in a
+00003520: 7267 730a 2020 2020 5d0a 2020 2020 7472  rgs.    ].    tr
+00003530: 793a 0a20 2020 2020 2020 2077 6974 6820  y:.        with 
+00003540: 6e70 2e65 7272 7374 6174 6528 616c 6c3d  np.errstate(all=
+00003550: 2269 676e 6f72 6522 293a 0a20 2020 2020  "ignore"):.     
+00003560: 2020 2020 2020 206f 203d 2066 756e 6328         o = func(
+00003570: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+00003580: 0a20 2020 2065 7863 6570 7420 4578 6365  .    except Exce
+00003590: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
+000035a0: 2020 2020 6578 635f 7479 7065 2c20 6578      exc_type, ex
+000035b0: 635f 7661 6c75 652c 2065 7863 5f74 7261  c_value, exc_tra
+000035c0: 6365 6261 636b 203d 2073 7973 2e65 7863  ceback = sys.exc
+000035d0: 5f69 6e66 6f28 290a 2020 2020 2020 2020  _info().        
+000035e0: 7462 203d 2022 222e 6a6f 696e 2874 7261  tb = "".join(tra
+000035f0: 6365 6261 636b 2e66 6f72 6d61 745f 7462  ceback.format_tb
+00003600: 2865 7863 5f74 7261 6365 6261 636b 2929  (exc_traceback))
+00003610: 0a20 2020 2020 2020 2073 7567 6765 7374  .        suggest
+00003620: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00003630: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00003640: 2020 2022 506c 6561 7365 2073 7065 6369     "Please speci
+00003650: 6679 2074 6865 2064 7479 7065 2065 7870  fy the dtype exp
+00003660: 6c69 6369 746c 7920 7573 696e 6720 7468  licitly using th
+00003670: 6520 220a 2020 2020 2020 2020 2020 2020  e ".            
+00003680: 2020 2020 2260 7b64 7479 7065 7d60 206b      "`{dtype}` k
+00003690: 7761 7267 2e5c 6e5c 6e22 2e66 6f72 6d61  warg.\n\n".forma
+000036a0: 7428 6474 7970 653d 7375 6767 6573 745f  t(dtype=suggest_
+000036b0: 6474 7970 6529 0a20 2020 2020 2020 2020  dtype).         
+000036c0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000036d0: 2069 6620 7375 6767 6573 745f 6474 7970   if suggest_dtyp
+000036e0: 650a 2020 2020 2020 2020 2020 2020 656c  e.            el
+000036f0: 7365 2022 220a 2020 2020 2020 2020 290a  se "".        ).
+00003700: 2020 2020 2020 2020 6d73 6720 3d20 280a          msg = (.
+00003710: 2020 2020 2020 2020 2020 2020 6622 6064              f"`d
+00003720: 7479 7065 6020 696e 6665 7265 6e63 6520  type` inference 
+00003730: 6661 696c 6564 2069 6e20 607b 6675 6e63  failed in `{func
+00003740: 6e61 6d65 7d60 2e5c 6e5c 6e22 0a20 2020  name}`.\n\n".   
+00003750: 2020 2020 2020 2020 2066 227b 7375 6767           f"{sugg
+00003760: 6573 747d 220a 2020 2020 2020 2020 2020  est}".          
+00003770: 2020 224f 7269 6769 6e61 6c20 6572 726f    "Original erro
+00003780: 7220 6973 2062 656c 6f77 3a5c 6e22 0a20  r is below:\n". 
+00003790: 2020 2020 2020 2020 2020 2022 2d2d 2d2d             "----
+000037a0: 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d 2d2d  ----------------
+000037b0: 2d2d 2d2d 5c6e 220a 2020 2020 2020 2020  ----\n".        
+000037c0: 2020 2020 6622 7b65 2172 7d5c 6e5c 6e22      f"{e!r}\n\n"
+000037d0: 0a20 2020 2020 2020 2020 2020 2022 5472  .            "Tr
+000037e0: 6163 6562 6163 6b3a 5c6e 220a 2020 2020  aceback:\n".    
+000037f0: 2020 2020 2020 2020 222d 2d2d 2d2d 2d2d          "-------
+00003800: 2d2d 5c6e 220a 2020 2020 2020 2020 2020  --\n".          
+00003810: 2020 6622 7b74 627d 220a 2020 2020 2020    f"{tb}".      
+00003820: 2020 290a 2020 2020 656c 7365 3a0a 2020    ).    else:.  
+00003830: 2020 2020 2020 6d73 6720 3d20 4e6f 6e65        msg = None
+00003840: 0a20 2020 2069 6620 6d73 6720 6973 206e  .    if msg is n
+00003850: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+00003860: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00003870: 7228 6d73 6729 0a20 2020 2072 6574 7572  r(msg).    retur
+00003880: 6e20 6765 7461 7474 7228 6f2c 2022 6474  n getattr(o, "dt
+00003890: 7970 6522 2c20 7479 7065 286f 2929 2069  ype", type(o)) i
+000038a0: 6620 6e6f 7574 2069 7320 4e6f 6e65 2065  f nout is None e
+000038b0: 6c73 6520 7475 706c 6528 652e 6474 7970  lse tuple(e.dtyp
+000038c0: 6520 666f 7220 6520 696e 206f 290a 0a0a  e for e in o)...
+000038d0: 6465 6620 6e6f 726d 616c 697a 655f 6172  def normalize_ar
+000038e0: 6728 7829 3a0a 2020 2020 2222 224e 6f72  g(x):.    """Nor
+000038f0: 6d61 6c69 7a65 2075 7365 7220 7072 6f76  malize user prov
+00003900: 6964 6564 2061 7267 756d 656e 7473 2074  ided arguments t
+00003910: 6f20 626c 6f63 6b77 6973 6520 6f72 206d  o blockwise or m
+00003920: 6170 5f62 6c6f 636b 730a 0a20 2020 2057  ap_blocks..    W
+00003930: 6520 646f 2061 2066 6577 2074 6869 6e67  e do a few thing
+00003940: 733a 0a0a 2020 2020 312e 2020 4966 2074  s:..    1.  If t
+00003950: 6865 7920 6172 6520 7374 7269 6e67 206c  hey are string l
+00003960: 6974 6572 616c 7320 7468 6174 206d 6967  iterals that mig
+00003970: 6874 2063 6f6c 6c69 6465 2077 6974 6820  ht collide with 
+00003980: 626c 6f63 6b77 6973 655f 746f 6b65 6e20  blockwise_token 
+00003990: 7468 656e 2077 650a 2020 2020 2020 2020  then we.        
+000039a0: 7175 6f74 6520 7468 656d 0a20 2020 2032  quote them.    2
+000039b0: 2e20 2049 4620 7468 6579 2061 7265 206c  .  IF they are l
+000039c0: 6172 6765 2028 6173 2064 6566 696e 6564  arge (as defined
+000039d0: 2062 7920 7369 7a65 6f66 2920 7468 656e   by sizeof) then
+000039e0: 2077 6520 7075 7420 7468 656d 2069 6e74   we put them int
+000039f0: 6f20 7468 650a 2020 2020 2020 2020 6772  o the.        gr
+00003a00: 6170 6820 6f6e 2074 6865 6972 206f 776e  aph on their own
+00003a10: 2062 7920 7573 696e 6720 6461 736b 2e64   by using dask.d
+00003a20: 656c 6179 6564 0a20 2020 2022 2222 0a20  elayed.    """. 
+00003a30: 2020 2069 6620 6973 5f64 6173 6b5f 636f     if is_dask_co
+00003a40: 6c6c 6563 7469 6f6e 2878 293a 0a20 2020  llection(x):.   
+00003a50: 2020 2020 2072 6574 7572 6e20 780a 2020       return x.  
+00003a60: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00003a70: 6528 782c 2073 7472 2920 616e 6420 7265  e(x, str) and re
+00003a80: 2e6d 6174 6368 2872 225f 5c64 2b22 2c20  .match(r"_\d+", 
+00003a90: 7829 3a0a 2020 2020 2020 2020 7265 7475  x):.        retu
+00003aa0: 726e 2064 656c 6179 6564 2878 290a 2020  rn delayed(x).  
+00003ab0: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+00003ac0: 6528 782c 206c 6973 7429 2061 6e64 206c  e(x, list) and l
+00003ad0: 656e 2878 2920 3e3d 2031 303a 0a20 2020  en(x) >= 10:.   
+00003ae0: 2020 2020 2072 6574 7572 6e20 6465 6c61       return dela
+00003af0: 7965 6428 7829 0a20 2020 2065 6c69 6620  yed(x).    elif 
+00003b00: 7369 7a65 6f66 2878 2920 3e20 3165 363a  sizeof(x) > 1e6:
+00003b10: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00003b20: 6465 6c61 7965 6428 7829 0a20 2020 2065  delayed(x).    e
+00003b30: 6c73 653a 0a20 2020 2020 2020 2072 6574  lse:.        ret
+00003b40: 7572 6e20 780a 0a0a 6465 6620 5f70 6173  urn x...def _pas
+00003b50: 735f 6578 7472 615f 6b77 6172 6773 2866  s_extra_kwargs(f
+00003b60: 756e 632c 206b 6579 732c 202a 6172 6773  unc, keys, *args
+00003b70: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00003b80: 2022 2222 4865 6c70 6572 2066 6f72 203a   """Helper for :
+00003b90: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+00003ba0: 2e6d 6170 5f62 6c6f 636b 7360 2074 6f20  .map_blocks` to 
+00003bb0: 7061 7373 2060 626c 6f63 6b5f 696e 666f  pass `block_info
+00003bc0: 6020 6f72 2060 626c 6f63 6b5f 6964 602e  ` or `block_id`.
+00003bd0: 0a0a 2020 2020 466f 7220 6561 6368 2065  ..    For each e
+00003be0: 6c65 6d65 6e74 206f 6620 606b 6579 7360  lement of `keys`
+00003bf0: 2c20 6120 636f 7272 6573 706f 6e64 696e  , a correspondin
+00003c00: 6720 656c 656d 656e 7420 6f66 2061 7267  g element of arg
+00003c10: 7320 6973 2063 6861 6e67 6564 0a20 2020  s is changed.   
+00003c20: 2074 6f20 6120 6b65 7977 6f72 6420 6172   to a keyword ar
+00003c30: 6775 6d65 6e74 2077 6974 6820 7468 6174  gument with that
+00003c40: 206b 6579 2c20 6265 666f 7265 2061 6c6c   key, before all
+00003c50: 2061 7267 756d 656e 7473 2072 6520 7061   arguments re pa
+00003c60: 7373 6564 206f 6e0a 2020 2020 746f 2060  ssed on.    to `
+00003c70: 6675 6e63 602e 0a20 2020 2022 2222 0a20  func`..    """. 
+00003c80: 2020 206b 7761 7267 732e 7570 6461 7465     kwargs.update
+00003c90: 287a 6970 286b 6579 732c 2061 7267 7329  (zip(keys, args)
+00003ca0: 290a 2020 2020 7265 7475 726e 2066 756e  ).    return fun
+00003cb0: 6328 2a61 7267 735b 6c65 6e28 6b65 7973  c(*args[len(keys
+00003cc0: 2920 3a5d 2c20 2a2a 6b77 6172 6773 290a  ) :], **kwargs).
+00003cd0: 0a0a 6465 6620 6d61 705f 626c 6f63 6b73  ..def map_blocks
+00003ce0: 280a 2020 2020 6675 6e63 2c0a 2020 2020  (.    func,.    
+00003cf0: 2a61 7267 732c 0a20 2020 206e 616d 653d  *args,.    name=
+00003d00: 4e6f 6e65 2c0a 2020 2020 746f 6b65 6e3d  None,.    token=
+00003d10: 4e6f 6e65 2c0a 2020 2020 6474 7970 653d  None,.    dtype=
+00003d20: 4e6f 6e65 2c0a 2020 2020 6368 756e 6b73  None,.    chunks
+00003d30: 3d4e 6f6e 652c 0a20 2020 2064 726f 705f  =None,.    drop_
+00003d40: 6178 6973 3d4e 6f6e 652c 0a20 2020 206e  axis=None,.    n
+00003d50: 6577 5f61 7869 733d 4e6f 6e65 2c0a 2020  ew_axis=None,.  
+00003d60: 2020 656e 666f 7263 655f 6e64 696d 3d46    enforce_ndim=F
+00003d70: 616c 7365 2c0a 2020 2020 6d65 7461 3d4e  alse,.    meta=N
+00003d80: 6f6e 652c 0a20 2020 202a 2a6b 7761 7267  one,.    **kwarg
+00003d90: 732c 0a29 3a0a 2020 2020 2222 224d 6170  s,.):.    """Map
+00003da0: 2061 2066 756e 6374 696f 6e20 6163 726f   a function acro
+00003db0: 7373 2061 6c6c 2062 6c6f 636b 7320 6f66  ss all blocks of
+00003dc0: 2061 2064 6173 6b20 6172 7261 792e 0a0a   a dask array...
+00003dd0: 2020 2020 4e6f 7465 2074 6861 7420 6060      Note that ``
+00003de0: 6d61 705f 626c 6f63 6b73 6060 2077 696c  map_blocks`` wil
+00003df0: 6c20 6174 7465 6d70 7420 746f 2061 7574  l attempt to aut
+00003e00: 6f6d 6174 6963 616c 6c79 2064 6574 6572  omatically deter
+00003e10: 6d69 6e65 2074 6865 206f 7574 7075 740a  mine the output.
+00003e20: 2020 2020 6172 7261 7920 7479 7065 2062      array type b
+00003e30: 7920 6361 6c6c 696e 6720 6060 6675 6e63  y calling ``func
+00003e40: 6060 206f 6e20 302d 6420 7665 7273 696f  `` on 0-d versio
+00003e50: 6e73 206f 6620 7468 6520 696e 7075 7473  ns of the inputs
+00003e60: 2e20 506c 6561 7365 2072 6566 6572 2074  . Please refer t
+00003e70: 6f0a 2020 2020 7468 6520 6060 6d65 7461  o.    the ``meta
+00003e80: 6060 206b 6579 776f 7264 2061 7267 756d  `` keyword argum
+00003e90: 656e 7420 6265 6c6f 7720 6966 2079 6f75  ent below if you
+00003ea0: 2065 7870 6563 7420 7468 6174 2074 6865   expect that the
+00003eb0: 2066 756e 6374 696f 6e20 7769 6c6c 206e   function will n
+00003ec0: 6f74 0a20 2020 2073 7563 6365 6564 2077  ot.    succeed w
+00003ed0: 6865 6e20 6f70 6572 6174 696e 6720 6f6e  hen operating on
+00003ee0: 2030 2d64 2061 7272 6179 732e 0a0a 2020   0-d arrays...  
+00003ef0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00003f00: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00003f10: 6675 6e63 203a 2063 616c 6c61 626c 650a  func : callable.
+00003f20: 2020 2020 2020 2020 4675 6e63 7469 6f6e          Function
+00003f30: 2074 6f20 6170 706c 7920 746f 2065 7665   to apply to eve
+00003f40: 7279 2062 6c6f 636b 2069 6e20 7468 6520  ry block in the 
+00003f50: 6172 7261 792e 0a20 2020 2020 2020 2049  array..        I
+00003f60: 6620 6060 6675 6e63 6060 2061 6363 6570  f ``func`` accep
+00003f70: 7473 2060 6062 6c6f 636b 5f69 6e66 6f3d  ts ``block_info=
+00003f80: 6060 206f 7220 6060 626c 6f63 6b5f 6964  `` or ``block_id
+00003f90: 3d60 600a 2020 2020 2020 2020 6173 206b  =``.        as k
+00003fa0: 6579 776f 7264 2061 7267 756d 656e 7473  eyword arguments
+00003fb0: 2c20 7468 6573 6520 7769 6c6c 2062 6520  , these will be 
+00003fc0: 7061 7373 6564 2064 6963 7469 6f6e 6172  passed dictionar
+00003fd0: 6965 730a 2020 2020 2020 2020 636f 6e74  ies.        cont
+00003fe0: 6169 6e69 6e67 2069 6e66 6f72 6d61 7469  aining informati
+00003ff0: 6f6e 2061 626f 7574 2069 6e70 7574 2061  on about input a
+00004000: 6e64 206f 7574 7075 7420 6368 756e 6b73  nd output chunks
+00004010: 2f61 7272 6179 730a 2020 2020 2020 2020  /arrays.        
+00004020: 6475 7269 6e67 2063 6f6d 7075 7461 7469  during computati
+00004030: 6f6e 2e20 5365 6520 6578 616d 706c 6573  on. See examples
+00004040: 2066 6f72 2064 6574 6169 6c73 2e0a 2020   for details..  
+00004050: 2020 6172 6773 203a 2064 6173 6b20 6172    args : dask ar
+00004060: 7261 7973 206f 7220 6f74 6865 7220 6f62  rays or other ob
+00004070: 6a65 6374 730a 2020 2020 6474 7970 6520  jects.    dtype 
+00004080: 3a20 6e70 2e64 7479 7065 2c20 6f70 7469  : np.dtype, opti
+00004090: 6f6e 616c 0a20 2020 2020 2020 2054 6865  onal.        The
+000040a0: 2060 6064 7479 7065 6060 206f 6620 7468   ``dtype`` of th
+000040b0: 6520 6f75 7470 7574 2061 7272 6179 2e20  e output array. 
+000040c0: 4974 2069 7320 7265 636f 6d6d 656e 6465  It is recommende
+000040d0: 6420 746f 2070 726f 7669 6465 2074 6869  d to provide thi
+000040e0: 732e 0a20 2020 2020 2020 2049 6620 6e6f  s..        If no
+000040f0: 7420 7072 6f76 6964 6564 2c20 7769 6c6c  t provided, will
+00004100: 2062 6520 696e 6665 7272 6564 2062 7920   be inferred by 
+00004110: 6170 706c 7969 6e67 2074 6865 2066 756e  applying the fun
+00004120: 6374 696f 6e20 746f 2061 2073 6d61 6c6c  ction to a small
+00004130: 0a20 2020 2020 2020 2073 6574 206f 6620  .        set of 
+00004140: 6661 6b65 2064 6174 612e 0a20 2020 2063  fake data..    c
+00004150: 6875 6e6b 7320 3a20 7475 706c 652c 206f  hunks : tuple, o
+00004160: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00004170: 4368 756e 6b20 7368 6170 6520 6f66 2072  Chunk shape of r
+00004180: 6573 756c 7469 6e67 2062 6c6f 636b 7320  esulting blocks 
+00004190: 6966 2074 6865 2066 756e 6374 696f 6e20  if the function 
+000041a0: 646f 6573 206e 6f74 2070 7265 7365 7276  does not preserv
+000041b0: 650a 2020 2020 2020 2020 7368 6170 652e  e.        shape.
+000041c0: 2049 6620 6e6f 7420 7072 6f76 6964 6564   If not provided
+000041d0: 2c20 7468 6520 7265 7375 6c74 696e 6720  , the resulting 
+000041e0: 6172 7261 7920 6973 2061 7373 756d 6564  array is assumed
+000041f0: 2074 6f20 6861 7665 2074 6865 2073 616d   to have the sam
+00004200: 650a 2020 2020 2020 2020 626c 6f63 6b20  e.        block 
+00004210: 7374 7275 6374 7572 6520 6173 2074 6865  structure as the
+00004220: 2066 6972 7374 2069 6e70 7574 2061 7272   first input arr
+00004230: 6179 2e0a 2020 2020 6472 6f70 5f61 7869  ay..    drop_axi
+00004240: 7320 3a20 6e75 6d62 6572 206f 7220 6974  s : number or it
+00004250: 6572 6162 6c65 2c20 6f70 7469 6f6e 616c  erable, optional
+00004260: 0a20 2020 2020 2020 2044 696d 656e 7369  .        Dimensi
+00004270: 6f6e 7320 6c6f 7374 2062 7920 7468 6520  ons lost by the 
+00004280: 6675 6e63 7469 6f6e 2e0a 2020 2020 6e65  function..    ne
+00004290: 775f 6178 6973 203a 206e 756d 6265 7220  w_axis : number 
+000042a0: 6f72 2069 7465 7261 626c 652c 206f 7074  or iterable, opt
+000042b0: 696f 6e61 6c0a 2020 2020 2020 2020 4e65  ional.        Ne
+000042c0: 7720 6469 6d65 6e73 696f 6e73 2063 7265  w dimensions cre
+000042d0: 6174 6564 2062 7920 7468 6520 6675 6e63  ated by the func
+000042e0: 7469 6f6e 2e20 4e6f 7465 2074 6861 7420  tion. Note that 
+000042f0: 7468 6573 6520 6172 6520 6170 706c 6965  these are applie
+00004300: 640a 2020 2020 2020 2020 6166 7465 7220  d.        after 
+00004310: 6060 6472 6f70 5f61 7869 7360 6020 2869  ``drop_axis`` (i
+00004320: 6620 7072 6573 656e 7429 2e0a 2020 2020  f present)..    
+00004330: 656e 666f 7263 655f 6e64 696d 203a 2062  enforce_ndim : b
+00004340: 6f6f 6c2c 2064 6566 6175 6c74 2046 616c  ool, default Fal
+00004350: 7365 0a20 2020 2020 2020 2057 6865 7468  se.        Wheth
+00004360: 6572 2074 6f20 656e 666f 7263 6520 6174  er to enforce at
+00004370: 2072 756e 7469 6d65 2074 6861 7420 7468   runtime that th
+00004380: 6520 6469 6d65 6e73 696f 6e61 6c69 7479  e dimensionality
+00004390: 206f 6620 7468 6520 6172 7261 790a 2020   of the array.  
+000043a0: 2020 2020 2020 7072 6f64 7563 6564 2062        produced b
+000043b0: 7920 6060 6675 6e63 6060 2061 6374 7561  y ``func`` actua
+000043c0: 6c6c 7920 6d61 7463 6865 7320 7468 6174  lly matches that
+000043d0: 206f 6620 7468 6520 6172 7261 7920 7265   of the array re
+000043e0: 7475 726e 6564 2062 790a 2020 2020 2020  turned by.      
+000043f0: 2020 6060 6d61 705f 626c 6f63 6b73 6060    ``map_blocks``
+00004400: 2e0a 2020 2020 2020 2020 4966 2054 7275  ..        If Tru
+00004410: 652c 2074 6869 7320 7769 6c6c 2072 6169  e, this will rai
+00004420: 7365 2061 6e20 6572 726f 7220 7768 656e  se an error when
+00004430: 2074 6865 7265 2069 7320 6120 6d69 736d   there is a mism
+00004440: 6174 6368 2e0a 2020 2020 746f 6b65 6e20  atch..    token 
+00004450: 3a20 7374 7269 6e67 2c20 6f70 7469 6f6e  : string, option
+00004460: 616c 0a20 2020 2020 2020 2054 6865 206b  al.        The k
+00004470: 6579 2070 7265 6669 7820 746f 2075 7365  ey prefix to use
+00004480: 2066 6f72 2074 6865 206f 7574 7075 7420   for the output 
+00004490: 6172 7261 792e 2049 6620 6e6f 7420 7072  array. If not pr
+000044a0: 6f76 6964 6564 2c20 7769 6c6c 2062 650a  ovided, will be.
+000044b0: 2020 2020 2020 2020 6465 7465 726d 696e          determin
+000044c0: 6564 2066 726f 6d20 7468 6520 6675 6e63  ed from the func
+000044d0: 7469 6f6e 206e 616d 652e 0a20 2020 206e  tion name..    n
+000044e0: 616d 6520 3a20 7374 7269 6e67 2c20 6f70  ame : string, op
+000044f0: 7469 6f6e 616c 0a20 2020 2020 2020 2054  tional.        T
+00004500: 6865 206b 6579 206e 616d 6520 746f 2075  he key name to u
+00004510: 7365 2066 6f72 2074 6865 206f 7574 7075  se for the outpu
+00004520: 7420 6172 7261 792e 204e 6f74 6520 7468  t array. Note th
+00004530: 6174 2074 6869 7320 6675 6c6c 790a 2020  at this fully.  
+00004540: 2020 2020 2020 7370 6563 6966 6965 7320        specifies 
+00004550: 7468 6520 6f75 7470 7574 206b 6579 206e  the output key n
+00004560: 616d 652c 2061 6e64 206d 7573 7420 6265  ame, and must be
+00004570: 2075 6e69 7175 652e 2049 6620 6e6f 7420   unique. If not 
+00004580: 7072 6f76 6964 6564 2c0a 2020 2020 2020  provided,.      
+00004590: 2020 7769 6c6c 2062 6520 6465 7465 726d    will be determ
+000045a0: 696e 6564 2062 7920 6120 6861 7368 206f  ined by a hash o
+000045b0: 6620 7468 6520 6172 6775 6d65 6e74 732e  f the arguments.
+000045c0: 0a20 2020 206d 6574 6120 3a20 6172 7261  .    meta : arra
+000045d0: 792d 6c69 6b65 2c20 6f70 7469 6f6e 616c  y-like, optional
+000045e0: 0a20 2020 2020 2020 2054 6865 2060 606d  .        The ``m
+000045f0: 6574 6160 6020 6f66 2074 6865 206f 7574  eta`` of the out
+00004600: 7075 7420 6172 7261 792c 2077 6865 6e20  put array, when 
+00004610: 7370 6563 6966 6965 6420 6973 2065 7870  specified is exp
+00004620: 6563 7465 6420 746f 2062 6520 616e 0a20  ected to be an. 
+00004630: 2020 2020 2020 2061 7272 6179 206f 6620         array of 
+00004640: 7468 6520 7361 6d65 2074 7970 6520 616e  the same type an
+00004650: 6420 6474 7970 6520 6f66 2074 6861 7420  d dtype of that 
+00004660: 7265 7475 726e 6564 2077 6865 6e20 6361  returned when ca
+00004670: 6c6c 696e 6720 6060 2e63 6f6d 7075 7465  lling ``.compute
+00004680: 2829 6060 0a20 2020 2020 2020 206f 6e20  ()``.        on 
+00004690: 7468 6520 6172 7261 7920 7265 7475 726e  the array return
+000046a0: 6564 2062 7920 7468 6973 2066 756e 6374  ed by this funct
+000046b0: 696f 6e2e 2057 6865 6e20 6e6f 7420 7072  ion. When not pr
+000046c0: 6f76 6964 6564 2c20 6060 6d65 7461 6060  ovided, ``meta``
+000046d0: 2077 696c 6c20 6265 0a20 2020 2020 2020   will be.       
+000046e0: 2069 6e66 6572 7265 6420 6279 2061 7070   inferred by app
+000046f0: 6c79 696e 6720 7468 6520 6675 6e63 7469  lying the functi
+00004700: 6f6e 2074 6f20 6120 736d 616c 6c20 7365  on to a small se
+00004710: 7420 6f66 2066 616b 6520 6461 7461 2c20  t of fake data, 
+00004720: 7573 7561 6c6c 7920 610a 2020 2020 2020  usually a.      
+00004730: 2020 302d 6420 6172 7261 792e 2049 7427    0-d array. It'
+00004740: 7320 696d 706f 7274 616e 7420 746f 2065  s important to e
+00004750: 6e73 7572 6520 7468 6174 2060 6066 756e  nsure that ``fun
+00004760: 6360 6020 6361 6e20 7375 6363 6573 7366  c`` can successf
+00004770: 756c 6c79 2063 6f6d 706c 6574 650a 2020  ully complete.  
+00004780: 2020 2020 2020 636f 6d70 7574 6174 696f        computatio
+00004790: 6e20 7769 7468 6f75 7420 7261 6973 696e  n without raisin
+000047a0: 6720 6578 6365 7074 696f 6e73 2077 6865  g exceptions whe
+000047b0: 6e20 302d 6420 6973 2070 6173 7365 6420  n 0-d is passed 
+000047c0: 746f 2069 742c 2070 726f 7669 6469 6e67  to it, providing
+000047d0: 0a20 2020 2020 2020 2060 606d 6574 6160  .        ``meta`
+000047e0: 6020 7769 6c6c 2062 6520 7265 7175 6972  ` will be requir
+000047f0: 6564 206f 7468 6572 7769 7365 2e20 4966  ed otherwise. If
+00004800: 2074 6865 206f 7574 7075 7420 7479 7065   the output type
+00004810: 2069 7320 6b6e 6f77 6e20 6265 666f 7265   is known before
+00004820: 6861 6e64 0a20 2020 2020 2020 2028 652e  hand.        (e.
+00004830: 672e 2c20 6060 6e70 2e6e 6461 7272 6179  g., ``np.ndarray
+00004840: 6060 2c20 6060 6375 7079 2e6e 6461 7272  ``, ``cupy.ndarr
+00004850: 6179 6060 292c 2061 6e20 656d 7074 7920  ay``), an empty 
+00004860: 6172 7261 7920 6f66 2073 7563 6820 7479  array of such ty
+00004870: 7065 2064 7479 7065 0a20 2020 2020 2020  pe dtype.       
+00004880: 2063 616e 2062 6520 7061 7373 6564 2c20   can be passed, 
+00004890: 666f 7220 6578 616d 706c 653a 2060 606d  for example: ``m
+000048a0: 6574 613d 6e70 2e61 7272 6179 2828 292c  eta=np.array((),
+000048b0: 2064 7479 7065 3d6e 702e 696e 7433 3229   dtype=np.int32)
+000048c0: 6060 2e0a 2020 2020 2a2a 6b77 6172 6773  ``..    **kwargs
+000048d0: 203a 0a20 2020 2020 2020 204f 7468 6572   :.        Other
+000048e0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+000048f0: 7473 2074 6f20 7061 7373 2074 6f20 6675  ts to pass to fu
+00004900: 6e63 7469 6f6e 2e20 5661 6c75 6573 206d  nction. Values m
+00004910: 7573 7420 6265 2063 6f6e 7374 616e 7473  ust be constants
+00004920: 0a20 2020 2020 2020 2028 6e6f 7420 6461  .        (not da
+00004930: 736b 2e61 7272 6179 7329 0a0a 2020 2020  sk.arrays)..    
+00004940: 5365 6520 416c 736f 0a20 2020 202d 2d2d  See Also.    ---
+00004950: 2d2d 2d2d 2d0a 2020 2020 6461 736b 2e61  -----.    dask.a
+00004960: 7272 6179 2e6d 6170 5f6f 7665 726c 6170  rray.map_overlap
+00004970: 203a 2047 656e 6572 616c 697a 6564 206f   : Generalized o
+00004980: 7065 7261 7469 6f6e 2077 6974 6820 6f76  peration with ov
+00004990: 6572 6c61 7020 6265 7477 6565 6e20 6e65  erlap between ne
+000049a0: 6967 6862 6f72 732e 0a20 2020 2064 6173  ighbors..    das
+000049b0: 6b2e 6172 7261 792e 626c 6f63 6b77 6973  k.array.blockwis
+000049c0: 6520 3a20 4765 6e65 7261 6c69 7a65 6420  e : Generalized 
+000049d0: 6f70 6572 6174 696f 6e20 7769 7468 2063  operation with c
+000049e0: 6f6e 7472 6f6c 206f 7665 7220 626c 6f63  ontrol over bloc
+000049f0: 6b20 616c 6967 6e6d 656e 742e 0a0a 2020  k alignment...  
+00004a00: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+00004a10: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
+00004a20: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
+00004a30: 7920 6173 2064 610a 2020 2020 3e3e 3e20  y as da.    >>> 
+00004a40: 7820 3d20 6461 2e61 7261 6e67 6528 362c  x = da.arange(6,
+00004a50: 2063 6875 6e6b 733d 3329 0a0a 2020 2020   chunks=3)..    
+00004a60: 3e3e 3e20 782e 6d61 705f 626c 6f63 6b73  >>> x.map_blocks
+00004a70: 286c 616d 6264 6120 783a 2078 202a 2032  (lambda x: x * 2
+00004a80: 292e 636f 6d70 7574 6528 290a 2020 2020  ).compute().    
+00004a90: 6172 7261 7928 5b20 302c 2020 322c 2020  array([ 0,  2,  
+00004aa0: 342c 2020 362c 2020 382c 2031 305d 290a  4,  6,  8, 10]).
+00004ab0: 0a20 2020 2054 6865 2060 6064 612e 6d61  .    The ``da.ma
+00004ac0: 705f 626c 6f63 6b73 6060 2066 756e 6374  p_blocks`` funct
+00004ad0: 696f 6e20 6361 6e20 616c 736f 2061 6363  ion can also acc
+00004ae0: 6570 7420 6d75 6c74 6970 6c65 2061 7272  ept multiple arr
+00004af0: 6179 732e 0a0a 2020 2020 3e3e 3e20 6420  ays...    >>> d 
+00004b00: 3d20 6461 2e61 7261 6e67 6528 352c 2063  = da.arange(5, c
+00004b10: 6875 6e6b 733d 3229 0a20 2020 203e 3e3e  hunks=2).    >>>
+00004b20: 2065 203d 2064 612e 6172 616e 6765 2835   e = da.arange(5
+00004b30: 2c20 6368 756e 6b73 3d32 290a 0a20 2020  , chunks=2)..   
+00004b40: 203e 3e3e 2066 203d 2064 612e 6d61 705f   >>> f = da.map_
+00004b50: 626c 6f63 6b73 286c 616d 6264 6120 612c  blocks(lambda a,
+00004b60: 2062 3a20 6120 2b20 622a 2a32 2c20 642c   b: a + b**2, d,
+00004b70: 2065 290a 2020 2020 3e3e 3e20 662e 636f   e).    >>> f.co
+00004b80: 6d70 7574 6528 290a 2020 2020 6172 7261  mpute().    arra
+00004b90: 7928 5b20 302c 2020 322c 2020 362c 2031  y([ 0,  2,  6, 1
+00004ba0: 322c 2032 305d 290a 0a20 2020 2049 6620  2, 20])..    If 
+00004bb0: 7468 6520 6675 6e63 7469 6f6e 2063 6861  the function cha
+00004bc0: 6e67 6573 2073 6861 7065 206f 6620 7468  nges shape of th
+00004bd0: 6520 626c 6f63 6b73 2074 6865 6e20 796f  e blocks then yo
+00004be0: 7520 6d75 7374 2070 726f 7669 6465 2063  u must provide c
+00004bf0: 6875 6e6b 730a 2020 2020 6578 706c 6963  hunks.    explic
+00004c00: 6974 6c79 2e0a 0a20 2020 203e 3e3e 2079  itly...    >>> y
+00004c10: 203d 2078 2e6d 6170 5f62 6c6f 636b 7328   = x.map_blocks(
+00004c20: 6c61 6d62 6461 2078 3a20 785b 3a3a 325d  lambda x: x[::2]
+00004c30: 2c20 6368 756e 6b73 3d28 2832 2c20 3229  , chunks=((2, 2)
+00004c40: 2c29 290a 0a20 2020 2059 6f75 2068 6176  ,))..    You hav
+00004c50: 6520 6120 6269 7420 6f66 2066 7265 6564  e a bit of freed
+00004c60: 6f6d 2069 6e20 7370 6563 6966 7969 6e67  om in specifying
+00004c70: 2063 6875 6e6b 732e 2020 4966 2061 6c6c   chunks.  If all
+00004c80: 206f 6620 7468 6520 6f75 7470 7574 2063   of the output c
+00004c90: 6875 6e6b 0a20 2020 2073 697a 6573 2061  hunk.    sizes a
+00004ca0: 7265 2074 6865 2073 616d 652c 2079 6f75  re the same, you
+00004cb0: 2063 616e 2070 726f 7669 6465 206a 7573   can provide jus
+00004cc0: 7420 7468 6174 2063 6875 6e6b 2073 697a  t that chunk siz
+00004cd0: 6520 6173 2061 2073 696e 676c 6520 7475  e as a single tu
+00004ce0: 706c 652e 0a0a 2020 2020 3e3e 3e20 6120  ple...    >>> a 
+00004cf0: 3d20 6461 2e61 7261 6e67 6528 3138 2c20  = da.arange(18, 
+00004d00: 6368 756e 6b73 3d28 362c 2929 0a20 2020  chunks=(6,)).   
+00004d10: 203e 3e3e 2062 203d 2061 2e6d 6170 5f62   >>> b = a.map_b
+00004d20: 6c6f 636b 7328 6c61 6d62 6461 2078 3a20  locks(lambda x: 
+00004d30: 785b 3a33 5d2c 2063 6875 6e6b 733d 2833  x[:3], chunks=(3
+00004d40: 2c29 290a 0a20 2020 2049 6620 7468 6520  ,))..    If the 
+00004d50: 6675 6e63 7469 6f6e 2063 6861 6e67 6573  function changes
+00004d60: 2074 6865 2064 696d 656e 7369 6f6e 206f   the dimension o
+00004d70: 6620 7468 6520 626c 6f63 6b73 2079 6f75  f the blocks you
+00004d80: 206d 7573 7420 7370 6563 6966 7920 7468   must specify th
+00004d90: 650a 2020 2020 6372 6561 7465 6420 6f72  e.    created or
+00004da0: 2064 6573 7472 6f79 6564 2064 696d 656e   destroyed dimen
+00004db0: 7369 6f6e 732e 0a0a 2020 2020 3e3e 3e20  sions...    >>> 
+00004dc0: 6220 3d20 612e 6d61 705f 626c 6f63 6b73  b = a.map_blocks
+00004dd0: 286c 616d 6264 6120 783a 2078 5b4e 6f6e  (lambda x: x[Non
+00004de0: 652c 203a 2c20 4e6f 6e65 5d2c 2063 6875  e, :, None], chu
+00004df0: 6e6b 733d 2831 2c20 362c 2031 292c 0a20  nks=(1, 6, 1),. 
+00004e00: 2020 202e 2e2e 2020 2020 2020 2020 2020     ...          
+00004e10: 2020 2020 2020 2020 6e65 775f 6178 6973          new_axis
+00004e20: 3d5b 302c 2032 5d29 0a0a 2020 2020 4966  =[0, 2])..    If
+00004e30: 2060 6063 6875 6e6b 7360 6020 6973 2073   ``chunks`` is s
+00004e40: 7065 6369 6669 6564 2062 7574 2060 606e  pecified but ``n
+00004e50: 6577 5f61 7869 7360 6020 6973 206e 6f74  ew_axis`` is not
+00004e60: 2c20 7468 656e 2069 7420 6973 2069 6e66  , then it is inf
+00004e70: 6572 7265 6420 746f 0a20 2020 2061 6464  erred to.    add
+00004e80: 2074 6865 206e 6563 6573 7361 7279 206e   the necessary n
+00004e90: 756d 6265 7220 6f66 2061 7865 7320 6f6e  umber of axes on
+00004ea0: 2074 6865 206c 6566 742e 0a0a 2020 2020   the left...    
+00004eb0: 4e6f 7465 2074 6861 7420 6060 6d61 705f  Note that ``map_
+00004ec0: 626c 6f63 6b73 2829 6060 2077 696c 6c20  blocks()`` will 
+00004ed0: 636f 6e63 6174 656e 6174 6520 6368 756e  concatenate chun
+00004ee0: 6b73 2061 6c6f 6e67 2061 7865 7320 7370  ks along axes sp
+00004ef0: 6563 6966 6965 6420 6279 0a20 2020 2074  ecified by.    t
+00004f00: 6865 206b 6579 776f 7264 2070 6172 616d  he keyword param
+00004f10: 6574 6572 2060 6064 726f 705f 6178 6973  eter ``drop_axis
+00004f20: 6060 2070 7269 6f72 2074 6f20 6170 706c  `` prior to appl
+00004f30: 7969 6e67 2074 6865 2066 756e 6374 696f  ying the functio
+00004f40: 6e2e 0a20 2020 2054 6869 7320 6973 2069  n..    This is i
+00004f50: 6c6c 7573 7472 6174 6564 2069 6e20 7468  llustrated in th
+00004f60: 6520 6669 6775 7265 2062 656c 6f77 3a0a  e figure below:.
+00004f70: 0a20 2020 202e 2e20 696d 6167 653a 3a20  .    .. image:: 
+00004f80: 2f69 6d61 6765 732f 6d61 705f 626c 6f63  /images/map_bloc
+00004f90: 6b73 5f64 726f 705f 6178 6973 2e70 6e67  ks_drop_axis.png
+00004fa0: 0a0a 2020 2020 4475 6520 746f 206d 656d  ..    Due to mem
+00004fb0: 6f72 792d 7369 7a65 2d63 6f6e 7374 7261  ory-size-constra
+00004fc0: 696e 7473 2c20 6974 2069 7320 6f66 7465  ints, it is ofte
+00004fd0: 6e20 6e6f 7420 6164 7669 7361 626c 6520  n not advisable 
+00004fe0: 746f 2075 7365 2060 6064 726f 705f 6178  to use ``drop_ax
+00004ff0: 6973 6060 0a20 2020 206f 6e20 616e 2061  is``.    on an a
+00005000: 7869 7320 7468 6174 2069 7320 6368 756e  xis that is chun
+00005010: 6b65 642e 2020 496e 2074 6861 7420 6361  ked.  In that ca
+00005020: 7365 2c20 6974 2069 7320 6265 7474 6572  se, it is better
+00005030: 206e 6f74 2074 6f20 7573 650a 2020 2020   not to use.    
+00005040: 6060 6d61 705f 626c 6f63 6b73 6060 2062  ``map_blocks`` b
+00005050: 7574 2072 6174 6865 720a 2020 2020 6060  ut rather.    ``
+00005060: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
+00005070: 7469 6f6e 282e 2e2e 2c20 6178 6973 3d64  tion(..., axis=d
+00005080: 726f 7070 6564 5f61 7865 732c 2063 6f6e  ropped_axes, con
+00005090: 6361 7465 6e61 7465 3d46 616c 7365 2960  catenate=False)`
+000050a0: 6020 7768 6963 680a 2020 2020 6d61 696e  ` which.    main
+000050b0: 7461 696e 7320 6120 6c65 616e 6572 206d  tains a leaner m
+000050c0: 656d 6f72 7920 666f 6f74 7072 696e 7420  emory footprint 
+000050d0: 7768 696c 6520 6974 2064 726f 7073 2061  while it drops a
+000050e0: 6e79 2061 7869 732e 0a0a 2020 2020 4d61  ny axis...    Ma
+000050f0: 705f 626c 6f63 6b73 2061 6c69 676e 7320  p_blocks aligns 
+00005100: 626c 6f63 6b73 2062 7920 626c 6f63 6b20  blocks by block 
+00005110: 706f 7369 7469 6f6e 7320 7769 7468 6f75  positions withou
+00005120: 7420 7265 6761 7264 2074 6f20 7368 6170  t regard to shap
+00005130: 652e 2049 6e20 7468 650a 2020 2020 666f  e. In the.    fo
+00005140: 6c6c 6f77 696e 6720 6578 616d 706c 6520  llowing example 
+00005150: 7765 2068 6176 6520 7477 6f20 6172 7261  we have two arra
+00005160: 7973 2077 6974 6820 7468 6520 7361 6d65  ys with the same
+00005170: 206e 756d 6265 7220 6f66 2062 6c6f 636b   number of block
+00005180: 7320 6275 740a 2020 2020 7769 7468 2064  s but.    with d
+00005190: 6966 6665 7265 6e74 2073 6861 7065 2061  ifferent shape a
+000051a0: 6e64 2063 6875 6e6b 2073 697a 6573 2e0a  nd chunk sizes..
+000051b0: 0a20 2020 203e 3e3e 2078 203d 2064 612e  .    >>> x = da.
+000051c0: 6172 616e 6765 2831 3030 302c 2063 6875  arange(1000, chu
+000051d0: 6e6b 733d 2831 3030 2c29 290a 2020 2020  nks=(100,)).    
+000051e0: 3e3e 3e20 7920 3d20 6461 2e61 7261 6e67  >>> y = da.arang
+000051f0: 6528 3130 302c 2063 6875 6e6b 733d 2831  e(100, chunks=(1
+00005200: 302c 2929 0a0a 2020 2020 5468 6520 7265  0,))..    The re
+00005210: 6c65 7661 6e74 2061 7474 7269 6275 7465  levant attribute
+00005220: 2074 6f20 6d61 7463 6820 6973 206e 756d   to match is num
+00005230: 626c 6f63 6b73 2e0a 0a20 2020 203e 3e3e  blocks...    >>>
+00005240: 2078 2e6e 756d 626c 6f63 6b73 0a20 2020   x.numblocks.   
+00005250: 2028 3130 2c29 0a20 2020 203e 3e3e 2079   (10,).    >>> y
+00005260: 2e6e 756d 626c 6f63 6b73 0a20 2020 2028  .numblocks.    (
+00005270: 3130 2c29 0a0a 2020 2020 4966 2074 6865  10,)..    If the
+00005280: 7365 206d 6174 6368 2028 7570 2074 6f20  se match (up to 
+00005290: 6272 6f61 6463 6173 7469 6e67 2072 756c  broadcasting rul
+000052a0: 6573 2920 7468 656e 2077 6520 6361 6e20  es) then we can 
+000052b0: 6d61 7020 6172 6269 7472 6172 790a 2020  map arbitrary.  
+000052c0: 2020 6675 6e63 7469 6f6e 7320 6163 726f    functions acro
+000052d0: 7373 2062 6c6f 636b 730a 0a20 2020 203e  ss blocks..    >
+000052e0: 3e3e 2064 6566 2066 756e 6328 612c 2062  >> def func(a, b
+000052f0: 293a 0a20 2020 202e 2e2e 2020 2020 2072  ):.    ...     r
+00005300: 6574 7572 6e20 6e70 2e61 7272 6179 285b  eturn np.array([
+00005310: 612e 6d61 7828 292c 2062 2e6d 6178 2829  a.max(), b.max()
+00005320: 5d29 0a0a 2020 2020 3e3e 3e20 6461 2e6d  ])..    >>> da.m
+00005330: 6170 5f62 6c6f 636b 7328 6675 6e63 2c20  ap_blocks(func, 
+00005340: 782c 2079 2c20 6368 756e 6b73 3d28 322c  x, y, chunks=(2,
+00005350: 292c 2064 7479 7065 3d27 6938 2729 0a20  ), dtype='i8'). 
+00005360: 2020 2064 6173 6b2e 6172 7261 793c 6675     dask.array<fu
+00005370: 6e63 2c20 7368 6170 653d 2832 302c 292c  nc, shape=(20,),
+00005380: 2064 7479 7065 3d69 6e74 3634 2c20 6368   dtype=int64, ch
+00005390: 756e 6b73 697a 653d 2832 2c29 2c20 6368  unksize=(2,), ch
+000053a0: 756e 6b74 7970 653d 6e75 6d70 792e 6e64  unktype=numpy.nd
+000053b0: 6172 7261 793e 0a0a 2020 2020 3e3e 3e20  array>..    >>> 
+000053c0: 5f2e 636f 6d70 7574 6528 290a 2020 2020  _.compute().    
+000053d0: 6172 7261 7928 5b20 3939 2c20 2020 392c  array([ 99,   9,
+000053e0: 2031 3939 2c20 2031 392c 2032 3939 2c20   199,  19, 299, 
+000053f0: 2032 392c 2033 3939 2c20 2033 392c 2034   29, 399,  39, 4
+00005400: 3939 2c20 2034 392c 2035 3939 2c20 2035  99,  49, 599,  5
+00005410: 392c 2036 3939 2c0a 2020 2020 2020 2020  9, 699,.        
+00005420: 2020 2020 3639 2c20 3739 392c 2020 3739      69, 799,  79
+00005430: 2c20 3839 392c 2020 3839 2c20 3939 392c  , 899,  89, 999,
+00005440: 2020 3939 5d29 0a0a 2020 2020 596f 7572    99])..    Your
+00005450: 2062 6c6f 636b 2066 756e 6374 696f 6e20   block function 
+00005460: 6361 6e20 6765 7420 696e 666f 726d 6174  can get informat
+00005470: 696f 6e20 6162 6f75 7420 7768 6572 6520  ion about where 
+00005480: 6974 2069 7320 696e 2074 6865 2061 7272  it is in the arr
+00005490: 6179 2062 790a 2020 2020 6163 6365 7074  ay by.    accept
+000054a0: 696e 6720 6120 7370 6563 6961 6c20 6060  ing a special ``
+000054b0: 626c 6f63 6b5f 696e 666f 6060 206f 7220  block_info`` or 
+000054c0: 6060 626c 6f63 6b5f 6964 6060 206b 6579  ``block_id`` key
+000054d0: 776f 7264 2061 7267 756d 656e 742e 0a20  word argument.. 
+000054e0: 2020 2044 7572 696e 6720 636f 6d70 7574     During comput
+000054f0: 6174 696f 6e2c 2074 6865 7920 7769 6c6c  ation, they will
+00005500: 2063 6f6e 7461 696e 2069 6e66 6f72 6d61   contain informa
+00005510: 7469 6f6e 2061 626f 7574 2065 6163 6820  tion about each 
+00005520: 6f66 2074 6865 2069 6e70 7574 0a20 2020  of the input.   
+00005530: 2061 6e64 206f 7574 7075 7420 6368 756e   and output chun
+00005540: 6b73 2028 616e 6420 6461 736b 2061 7272  ks (and dask arr
+00005550: 6179 7329 2072 656c 6576 616e 7420 746f  ays) relevant to
+00005560: 2065 6163 6820 6361 6c6c 206f 6620 6060   each call of ``
+00005570: 6675 6e63 6060 2e0a 0a20 2020 203e 3e3e  func``...    >>>
+00005580: 2064 6566 2066 756e 6328 626c 6f63 6b5f   def func(block_
+00005590: 696e 666f 3d4e 6f6e 6529 3a0a 2020 2020  info=None):.    
+000055a0: 2e2e 2e20 2020 2020 7061 7373 0a0a 2020  ...     pass..  
+000055b0: 2020 5468 6973 2077 696c 6c20 7265 6365    This will rece
+000055c0: 6976 6520 7468 6520 666f 6c6c 6f77 696e  ive the followin
+000055d0: 6720 696e 666f 726d 6174 696f 6e3a 0a0a  g information:..
+000055e0: 2020 2020 3e3e 3e20 626c 6f63 6b5f 696e      >>> block_in
+000055f0: 666f 2020 2320 646f 6374 6573 743a 202b  fo  # doctest: +
+00005600: 534b 4950 0a20 2020 207b 303a 207b 2773  SKIP.    {0: {'s
+00005610: 6861 7065 273a 2028 3130 3030 2c29 2c0a  hape': (1000,),.
+00005620: 2020 2020 2020 2020 2027 6e75 6d2d 6368           'num-ch
+00005630: 756e 6b73 273a 2028 3130 2c29 2c0a 2020  unks': (10,),.  
+00005640: 2020 2020 2020 2027 6368 756e 6b2d 6c6f         'chunk-lo
+00005650: 6361 7469 6f6e 273a 2028 342c 292c 0a20  cation': (4,),. 
+00005660: 2020 2020 2020 2020 2761 7272 6179 2d6c          'array-l
+00005670: 6f63 6174 696f 6e27 3a20 5b28 3430 302c  ocation': [(400,
+00005680: 2035 3030 295d 7d2c 0a20 2020 2020 4e6f   500)]},.     No
+00005690: 6e65 3a20 7b27 7368 6170 6527 3a20 2831  ne: {'shape': (1
+000056a0: 3030 302c 292c 0a20 2020 2020 2020 2020  000,),.         
+000056b0: 2020 2027 6e75 6d2d 6368 756e 6b73 273a     'num-chunks':
+000056c0: 2028 3130 2c29 2c0a 2020 2020 2020 2020   (10,),.        
+000056d0: 2020 2020 2763 6875 6e6b 2d6c 6f63 6174      'chunk-locat
+000056e0: 696f 6e27 3a20 2834 2c29 2c0a 2020 2020  ion': (4,),.    
+000056f0: 2020 2020 2020 2020 2761 7272 6179 2d6c          'array-l
+00005700: 6f63 6174 696f 6e27 3a20 5b28 3430 302c  ocation': [(400,
+00005710: 2035 3030 295d 2c0a 2020 2020 2020 2020   500)],.        
+00005720: 2020 2020 2763 6875 6e6b 2d73 6861 7065      'chunk-shape
+00005730: 273a 2028 3130 302c 292c 0a20 2020 2020  ': (100,),.     
+00005740: 2020 2020 2020 2027 6474 7970 6527 3a20         'dtype': 
+00005750: 6474 7970 6528 2766 6c6f 6174 3634 2729  dtype('float64')
+00005760: 7d7d 0a0a 2020 2020 5468 6520 6b65 7973  }}..    The keys
+00005770: 2074 6f20 7468 6520 6060 626c 6f63 6b5f   to the ``block_
+00005780: 696e 666f 6060 2064 6963 7469 6f6e 6172  info`` dictionar
+00005790: 7920 696e 6469 6361 7465 2077 6869 6368  y indicate which
+000057a0: 2069 7320 7468 6520 696e 7075 7420 616e   is the input an
+000057b0: 640a 2020 2020 6f75 7470 7574 2044 6173  d.    output Das
+000057c0: 6b20 6172 7261 793a 0a0a 2020 2020 2d20  k array:..    - 
+000057d0: 2a2a 496e 7075 7420 4461 736b 2061 7272  **Input Dask arr
+000057e0: 6179 2873 293a 2a2a 2060 6062 6c6f 636b  ay(s):** ``block
+000057f0: 5f69 6e66 6f5b 305d 6060 2072 6566 6572  _info[0]`` refer
+00005800: 7320 746f 2074 6865 2066 6972 7374 2069  s to the first i
+00005810: 6e70 7574 2044 6173 6b20 6172 7261 792e  nput Dask array.
+00005820: 0a20 2020 2020 2054 6865 2064 6963 7469  .      The dicti
+00005830: 6f6e 6172 7920 6b65 7920 6973 2060 6030  onary key is ``0
+00005840: 6060 2062 6563 6175 7365 2074 6861 7420  `` because that 
+00005850: 6973 2074 6865 2061 7267 756d 656e 7420  is the argument 
+00005860: 696e 6465 7820 636f 7272 6573 706f 6e64  index correspond
+00005870: 696e 670a 2020 2020 2020 746f 2074 6865  ing.      to the
+00005880: 2066 6972 7374 2069 6e70 7574 2044 6173   first input Das
+00005890: 6b20 6172 7261 792e 0a20 2020 2020 2049  k array..      I
+000058a0: 6e20 6361 7365 7320 7768 6572 6520 6d75  n cases where mu
+000058b0: 6c74 6970 6c65 2044 6173 6b20 6172 7261  ltiple Dask arra
+000058c0: 7973 2068 6176 6520 6265 656e 2070 6173  ys have been pas
+000058d0: 7365 6420 6173 2069 6e70 7574 2074 6f20  sed as input to 
+000058e0: 7468 6520 6675 6e63 7469 6f6e 2c0a 2020  the function,.  
+000058f0: 2020 2020 796f 7520 6361 6e20 6163 6365      you can acce
+00005900: 7373 2074 6865 6d20 7769 7468 2074 6865  ss them with the
+00005910: 206e 756d 6265 7220 636f 7272 6573 706f   number correspo
+00005920: 6e64 696e 6720 746f 2074 6865 2069 6e70  nding to the inp
+00005930: 7574 2061 7267 756d 656e 742c 0a20 2020  ut argument,.   
+00005940: 2020 2065 673a 2060 6062 6c6f 636b 5f69     eg: ``block_i
+00005950: 6e66 6f5b 315d 6060 2c20 6060 626c 6f63  nfo[1]``, ``bloc
+00005960: 6b5f 696e 666f 5b32 5d60 602c 2065 7463  k_info[2]``, etc
+00005970: 2e0a 2020 2020 2020 284e 6f74 6520 7468  ..      (Note th
+00005980: 6174 2069 6620 796f 7520 7061 7373 206d  at if you pass m
+00005990: 756c 7469 706c 6520 4461 736b 2061 7272  ultiple Dask arr
+000059a0: 6179 7320 6173 2069 6e70 7574 2074 6f20  ays as input to 
+000059b0: 6d61 705f 626c 6f63 6b73 2c0a 2020 2020  map_blocks,.    
+000059c0: 2020 7468 6520 6172 7261 7973 206d 7573    the arrays mus
+000059d0: 7420 6d61 7463 6820 6561 6368 206f 7468  t match each oth
+000059e0: 6572 2062 7920 6861 7669 6e67 206d 6174  er by having mat
+000059f0: 6368 696e 6720 6e75 6d62 6572 7320 6f66  ching numbers of
+00005a00: 2063 6875 6e6b 732c 0a20 2020 2020 2061   chunks,.      a
+00005a10: 6c6f 6e67 2063 6f72 7265 7370 6f6e 6469  long correspondi
+00005a20: 6e67 2064 696d 656e 7369 6f6e 7320 7570  ng dimensions up
+00005a30: 2074 6f20 6272 6f61 6463 6173 7469 6e67   to broadcasting
+00005a40: 2072 756c 6573 2e29 0a20 2020 202d 202a   rules.).    - *
+00005a50: 2a4f 7574 7075 7420 4461 736b 2061 7272  *Output Dask arr
+00005a60: 6179 3a2a 2a20 6060 626c 6f63 6b5f 696e  ay:** ``block_in
+00005a70: 666f 5b4e 6f6e 655d 6060 2072 6566 6572  fo[None]`` refer
+00005a80: 7320 746f 2074 6865 206f 7574 7075 7420  s to the output 
+00005a90: 4461 736b 2061 7272 6179 2c0a 2020 2020  Dask array,.    
+00005aa0: 2020 616e 6420 636f 6e74 6169 6e73 2069    and contains i
+00005ab0: 6e66 6f72 6d61 7469 6f6e 2061 626f 7574  nformation about
+00005ac0: 2074 6865 206f 7574 7075 7420 6368 756e   the output chun
+00005ad0: 6b73 2e0a 2020 2020 2020 5468 6520 6f75  ks..      The ou
+00005ae0: 7470 7574 2063 6875 6e6b 2073 6861 7065  tput chunk shape
+00005af0: 2061 6e64 2064 7479 7065 206d 6179 206d   and dtype may m
+00005b00: 6179 2062 6520 6469 6666 6572 656e 7420  ay be different 
+00005b10: 7468 616e 2074 6865 2069 6e70 7574 2063  than the input c
+00005b20: 6875 6e6b 732e 0a0a 2020 2020 466f 7220  hunks...    For 
+00005b30: 6561 6368 2064 6173 6b20 6172 7261 792c  each dask array,
+00005b40: 2060 6062 6c6f 636b 5f69 6e66 6f60 6020   ``block_info`` 
+00005b50: 6465 7363 7269 6265 733a 0a0a 2020 2020  describes:..    
+00005b60: 2d20 6060 7368 6170 6560 603a 2074 6865  - ``shape``: the
+00005b70: 2073 6861 7065 206f 6620 7468 6520 6675   shape of the fu
+00005b80: 6c6c 2044 6173 6b20 6172 7261 792c 0a20  ll Dask array,. 
+00005b90: 2020 202d 2060 606e 756d 2d63 6875 6e6b     - ``num-chunk
+00005ba0: 7360 603a 2074 6865 206e 756d 6265 7220  s``: the number 
+00005bb0: 6f66 2063 6875 6e6b 7320 6f66 2074 6865  of chunks of the
+00005bc0: 2066 756c 6c20 6172 7261 7920 696e 2065   full array in e
+00005bd0: 6163 6820 6469 6d65 6e73 696f 6e2c 0a20  ach dimension,. 
+00005be0: 2020 202d 2060 6063 6875 6e6b 2d6c 6f63     - ``chunk-loc
+00005bf0: 6174 696f 6e60 603a 2074 6865 2063 6875  ation``: the chu
+00005c00: 6e6b 206c 6f63 6174 696f 6e20 2866 6f72  nk location (for
+00005c10: 2065 7861 6d70 6c65 2074 6865 2066 6f75   example the fou
+00005c20: 7274 6820 6368 756e 6b20 6f76 6572 0a20  rth chunk over. 
+00005c30: 2020 2020 2069 6e20 7468 6520 6669 7273       in the firs
+00005c40: 7420 6469 6d65 6e73 696f 6e29 2c20 616e  t dimension), an
+00005c50: 640a 2020 2020 2d20 6060 6172 7261 792d  d.    - ``array-
+00005c60: 6c6f 6361 7469 6f6e 6060 3a20 7468 6520  location``: the 
+00005c70: 6172 7261 7920 6c6f 6361 7469 6f6e 2077  array location w
+00005c80: 6974 6869 6e20 7468 6520 6675 6c6c 2044  ithin the full D
+00005c90: 6173 6b20 6172 7261 790a 2020 2020 2020  ask array.      
+00005ca0: 2866 6f72 2065 7861 6d70 6c65 2074 6865  (for example the
+00005cb0: 2073 6c69 6365 2063 6f72 7265 7370 6f6e   slice correspon
+00005cc0: 6469 6e67 2074 6f20 6060 3430 3a35 3060  ding to ``40:50`
+00005cd0: 6029 2e0a 0a20 2020 2049 6e20 6164 6469  `)...    In addi
+00005ce0: 7469 6f6e 2074 6f20 7468 6573 652c 2074  tion to these, t
+00005cf0: 6865 7265 2061 7265 2074 776f 2065 7874  here are two ext
+00005d00: 7261 2070 6172 616d 6574 6572 7320 6465  ra parameters de
+00005d10: 7363 7269 6265 6420 6279 0a20 2020 2060  scribed by.    `
+00005d20: 6062 6c6f 636b 5f69 6e66 6f60 6020 666f  `block_info`` fo
+00005d30: 7220 7468 6520 6f75 7470 7574 2061 7272  r the output arr
+00005d40: 6179 2028 696e 2060 6062 6c6f 636b 5f69  ay (in ``block_i
+00005d50: 6e66 6f5b 4e6f 6e65 5d60 6029 3a0a 0a20  nfo[None]``):.. 
+00005d60: 2020 202d 2060 6063 6875 6e6b 2d73 6861     - ``chunk-sha
+00005d70: 7065 6060 3a20 7468 6520 6f75 7470 7574  pe``: the output
+00005d80: 2063 6875 6e6b 2073 6861 7065 2c20 616e   chunk shape, an
+00005d90: 640a 2020 2020 2d20 6060 6474 7970 6560  d.    - ``dtype`
+00005da0: 603a 2074 6865 206f 7574 7075 7420 6474  `: the output dt
+00005db0: 7970 652e 0a0a 2020 2020 5468 6573 6520  ype...    These 
+00005dc0: 6665 6174 7572 6573 2063 616e 2062 6520  features can be 
+00005dd0: 636f 6d62 696e 6564 2074 6f20 7379 6e74  combined to synt
+00005de0: 6865 7369 7a65 2061 6e20 6172 7261 7920  hesize an array 
+00005df0: 6672 6f6d 2073 6372 6174 6368 2c20 666f  from scratch, fo
+00005e00: 720a 2020 2020 6578 616d 706c 653a 0a0a  r.    example:..
+00005e10: 2020 2020 3e3e 3e20 6465 6620 6675 6e63      >>> def func
+00005e20: 2862 6c6f 636b 5f69 6e66 6f3d 4e6f 6e65  (block_info=None
+00005e30: 293a 0a20 2020 202e 2e2e 2020 2020 206c  ):.    ...     l
+00005e40: 6f63 203d 2062 6c6f 636b 5f69 6e66 6f5b  oc = block_info[
+00005e50: 4e6f 6e65 5d5b 2761 7272 6179 2d6c 6f63  None]['array-loc
+00005e60: 6174 696f 6e27 5d5b 305d 0a20 2020 202e  ation'][0].    .
+00005e70: 2e2e 2020 2020 2072 6574 7572 6e20 6e70  ..     return np
+00005e80: 2e61 7261 6e67 6528 6c6f 635b 305d 2c20  .arange(loc[0], 
+00005e90: 6c6f 635b 315d 290a 0a20 2020 203e 3e3e  loc[1])..    >>>
+00005ea0: 2064 612e 6d61 705f 626c 6f63 6b73 2866   da.map_blocks(f
+00005eb0: 756e 632c 2063 6875 6e6b 733d 2828 342c  unc, chunks=((4,
+00005ec0: 2034 292c 292c 2064 7479 7065 3d6e 702e   4),), dtype=np.
+00005ed0: 666c 6f61 7436 3429 0a20 2020 2064 6173  float64).    das
+00005ee0: 6b2e 6172 7261 793c 6675 6e63 2c20 7368  k.array<func, sh
+00005ef0: 6170 653d 2838 2c29 2c20 6474 7970 653d  ape=(8,), dtype=
+00005f00: 666c 6f61 7436 342c 2063 6875 6e6b 7369  float64, chunksi
+00005f10: 7a65 3d28 342c 292c 2063 6875 6e6b 7479  ze=(4,), chunkty
+00005f20: 7065 3d6e 756d 7079 2e6e 6461 7272 6179  pe=numpy.ndarray
+00005f30: 3e0a 0a20 2020 203e 3e3e 205f 2e63 6f6d  >..    >>> _.com
+00005f40: 7075 7465 2829 0a20 2020 2061 7272 6179  pute().    array
+00005f50: 285b 302c 2031 2c20 322c 2033 2c20 342c  ([0, 1, 2, 3, 4,
+00005f60: 2035 2c20 362c 2037 5d29 0a0a 2020 2020   5, 6, 7])..    
+00005f70: 6060 626c 6f63 6b5f 6964 6060 2069 7320  ``block_id`` is 
+00005f80: 7369 6d69 6c61 7220 746f 2060 6062 6c6f  similar to ``blo
+00005f90: 636b 5f69 6e66 6f60 6020 6275 7420 636f  ck_info`` but co
+00005fa0: 6e74 6169 6e73 206f 6e6c 7920 7468 6520  ntains only the 
+00005fb0: 6060 6368 756e 6b5f 6c6f 6361 7469 6f6e  ``chunk_location
+00005fc0: 6060 3a0a 0a20 2020 203e 3e3e 2064 6566  ``:..    >>> def
+00005fd0: 2066 756e 6328 626c 6f63 6b5f 6964 3d4e   func(block_id=N
+00005fe0: 6f6e 6529 3a0a 2020 2020 2e2e 2e20 2020  one):.    ...   
+00005ff0: 2020 7061 7373 0a0a 2020 2020 5468 6973    pass..    This
+00006000: 2077 696c 6c20 7265 6365 6976 6520 7468   will receive th
+00006010: 6520 666f 6c6c 6f77 696e 6720 696e 666f  e following info
+00006020: 726d 6174 696f 6e3a 0a0a 2020 2020 3e3e  rmation:..    >>
+00006030: 3e20 626c 6f63 6b5f 6964 2020 2320 646f  > block_id  # do
+00006040: 6374 6573 743a 202b 534b 4950 0a20 2020  ctest: +SKIP.   
+00006050: 2028 342c 2033 290a 0a20 2020 2059 6f75   (4, 3)..    You
+00006060: 206d 6179 2073 7065 6369 6679 2074 6865   may specify the
+00006070: 206b 6579 206e 616d 6520 7072 6566 6978   key name prefix
+00006080: 206f 6620 7468 6520 7265 7375 6c74 696e   of the resultin
+00006090: 6720 7461 736b 2069 6e20 7468 6520 6772  g task in the gr
+000060a0: 6170 6820 7769 7468 0a20 2020 2074 6865  aph with.    the
+000060b0: 206f 7074 696f 6e61 6c20 6060 746f 6b65   optional ``toke
+000060c0: 6e60 6020 6b65 7977 6f72 6420 6172 6775  n`` keyword argu
+000060d0: 6d65 6e74 2e0a 0a20 2020 203e 3e3e 2078  ment...    >>> x
+000060e0: 2e6d 6170 5f62 6c6f 636b 7328 6c61 6d62  .map_blocks(lamb
+000060f0: 6461 2078 3a20 7820 2b20 312c 206e 616d  da x: x + 1, nam
+00006100: 653d 2769 6e63 7265 6d65 6e74 2729 0a20  e='increment'). 
+00006110: 2020 2064 6173 6b2e 6172 7261 793c 696e     dask.array<in
+00006120: 6372 656d 656e 742c 2073 6861 7065 3d28  crement, shape=(
+00006130: 3130 3030 2c29 2c20 6474 7970 653d 696e  1000,), dtype=in
+00006140: 7436 342c 2063 6875 6e6b 7369 7a65 3d28  t64, chunksize=(
+00006150: 3130 302c 292c 2063 6875 6e6b 7479 7065  100,), chunktype
+00006160: 3d6e 756d 7079 2e6e 6461 7272 6179 3e0a  =numpy.ndarray>.
+00006170: 0a20 2020 2046 6f72 2066 756e 6374 696f  .    For functio
+00006180: 6e73 2074 6861 7420 6d61 7920 6e6f 7420  ns that may not 
+00006190: 6861 6e64 6c65 2030 2d64 2061 7272 6179  handle 0-d array
+000061a0: 732c 2069 7427 7320 616c 736f 2070 6f73  s, it's also pos
+000061b0: 7369 626c 6520 746f 2073 7065 6369 6679  sible to specify
+000061c0: 0a20 2020 2060 606d 6574 6160 6020 7769  .    ``meta`` wi
+000061d0: 7468 2061 6e20 656d 7074 7920 6172 7261  th an empty arra
+000061e0: 7920 6d61 7463 6869 6e67 2074 6865 2074  y matching the t
+000061f0: 7970 6520 6f66 2074 6865 2065 7870 6563  ype of the expec
+00006200: 7465 6420 7265 7375 6c74 2e20 496e 0a20  ted result. In. 
+00006210: 2020 2074 6865 2065 7861 6d70 6c65 2062     the example b
+00006220: 656c 6f77 2c20 6060 6675 6e63 6060 2077  elow, ``func`` w
+00006230: 696c 6c20 7265 7375 6c74 2069 6e20 616e  ill result in an
+00006240: 2060 6049 6e64 6578 4572 726f 7260 6020   ``IndexError`` 
+00006250: 7768 656e 2063 6f6d 7075 7469 6e67 0a20  when computing. 
+00006260: 2020 2060 606d 6574 6160 603a 0a0a 2020     ``meta``:..  
+00006270: 2020 3e3e 3e20 726e 6720 3d20 6461 2e72    >>> rng = da.r
+00006280: 616e 646f 6d2e 6465 6661 756c 745f 726e  andom.default_rn
+00006290: 6728 290a 2020 2020 3e3e 3e20 6461 2e6d  g().    >>> da.m
+000062a0: 6170 5f62 6c6f 636b 7328 6c61 6d62 6461  ap_blocks(lambda
+000062b0: 2078 3a20 785b 325d 2c20 726e 672e 7261   x: x[2], rng.ra
+000062c0: 6e64 6f6d 2835 292c 206d 6574 613d 6e70  ndom(5), meta=np
+000062d0: 2e61 7272 6179 2828 2929 290a 2020 2020  .array(())).    
+000062e0: 6461 736b 2e61 7272 6179 3c6c 616d 6264  dask.array<lambd
+000062f0: 612c 2073 6861 7065 3d28 352c 292c 2064  a, shape=(5,), d
+00006300: 7479 7065 3d66 6c6f 6174 3634 2c20 6368  type=float64, ch
+00006310: 756e 6b73 697a 653d 2835 2c29 2c20 6368  unksize=(5,), ch
+00006320: 756e 6b74 7970 653d 6e75 6d70 792e 6e64  unktype=numpy.nd
+00006330: 6172 7261 793e 0a0a 2020 2020 5369 6d69  array>..    Simi
+00006340: 6c61 726c 792c 2069 7427 7320 706f 7373  larly, it's poss
+00006350: 6962 6c65 2074 6f20 7370 6563 6966 7920  ible to specify 
+00006360: 6120 6e6f 6e2d 4e75 6d50 7920 6172 7261  a non-NumPy arra
+00006370: 7920 746f 2060 606d 6574 6160 602c 2061  y to ``meta``, a
+00006380: 6e64 2070 726f 7669 6465 0a20 2020 2061  nd provide.    a
+00006390: 2060 6064 7479 7065 6060 3a0a 0a20 2020   ``dtype``:..   
+000063a0: 203e 3e3e 2069 6d70 6f72 7420 6375 7079   >>> import cupy
+000063b0: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+000063c0: 4950 0a20 2020 203e 3e3e 2072 6e67 203d  IP.    >>> rng =
+000063d0: 2064 612e 7261 6e64 6f6d 2e64 6566 6175   da.random.defau
+000063e0: 6c74 5f72 6e67 2863 7570 792e 7261 6e64  lt_rng(cupy.rand
+000063f0: 6f6d 2e64 6566 6175 6c74 5f72 6e67 2829  om.default_rng()
+00006400: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
+00006410: 4b49 500a 2020 2020 3e3e 3e20 6474 203d  KIP.    >>> dt =
+00006420: 206e 702e 666c 6f61 7433 320a 2020 2020   np.float32.    
+00006430: 3e3e 3e20 6461 2e6d 6170 5f62 6c6f 636b  >>> da.map_block
+00006440: 7328 6c61 6d62 6461 2078 3a20 785b 325d  s(lambda x: x[2]
+00006450: 2c20 726e 672e 7261 6e64 6f6d 2835 2c20  , rng.random(5, 
+00006460: 6474 7970 653d 6474 292c 206d 6574 613d  dtype=dt), meta=
+00006470: 6375 7079 2e61 7272 6179 2828 292c 2064  cupy.array((), d
+00006480: 7479 7065 3d64 7429 2920 2023 2064 6f63  type=dt))  # doc
+00006490: 7465 7374 3a20 2b53 4b49 500a 2020 2020  test: +SKIP.    
+000064a0: 6461 736b 2e61 7272 6179 3c6c 616d 6264  dask.array<lambd
+000064b0: 612c 2073 6861 7065 3d28 352c 292c 2064  a, shape=(5,), d
+000064c0: 7479 7065 3d66 6c6f 6174 3332 2c20 6368  type=float32, ch
+000064d0: 756e 6b73 697a 653d 2835 2c29 2c20 6368  unksize=(5,), ch
+000064e0: 756e 6b74 7970 653d 6375 7079 2e6e 6461  unktype=cupy.nda
+000064f0: 7272 6179 3e0a 2020 2020 2222 220a 2020  rray>.    """.  
+00006500: 2020 6966 2064 726f 705f 6178 6973 2069    if drop_axis i
+00006510: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00006520: 6472 6f70 5f61 7869 7320 3d20 5b5d 0a0a  drop_axis = []..
+00006530: 2020 2020 6966 206e 6f74 2063 616c 6c61      if not calla
+00006540: 626c 6528 6675 6e63 293a 0a20 2020 2020  ble(func):.     
+00006550: 2020 206d 7367 203d 2028 0a20 2020 2020     msg = (.     
+00006560: 2020 2020 2020 2022 4669 7273 7420 6172         "First ar
+00006570: 6775 6d65 6e74 206d 7573 7420 6265 2063  gument must be c
+00006580: 616c 6c61 626c 6520 6675 6e63 7469 6f6e  allable function
+00006590: 2c20 6e6f 7420 2573 5c6e 220a 2020 2020  , not %s\n".    
+000065a0: 2020 2020 2020 2020 2255 7361 6765 3a20          "Usage: 
+000065b0: 2020 6461 2e6d 6170 5f62 6c6f 636b 7328    da.map_blocks(
+000065c0: 6675 6e63 7469 6f6e 2c20 7829 5c6e 220a  function, x)\n".
+000065d0: 2020 2020 2020 2020 2020 2020 2220 2020              "   
+000065e0: 6f72 3a20 2020 6461 2e6d 6170 5f62 6c6f  or:   da.map_blo
+000065f0: 636b 7328 6675 6e63 7469 6f6e 2c20 782c  cks(function, x,
+00006600: 2079 2c20 7a29 220a 2020 2020 2020 2020   y, z)".        
+00006610: 290a 2020 2020 2020 2020 7261 6973 6520  ).        raise 
+00006620: 5479 7065 4572 726f 7228 6d73 6720 2520  TypeError(msg % 
+00006630: 7479 7065 2866 756e 6329 2e5f 5f6e 616d  type(func).__nam
+00006640: 655f 5f29 0a20 2020 2069 6620 746f 6b65  e__).    if toke
+00006650: 6e3a 0a20 2020 2020 2020 2077 6172 6e69  n:.        warni
+00006660: 6e67 732e 7761 726e 280a 2020 2020 2020  ngs.warn(.      
+00006670: 2020 2020 2020 2254 6865 2060 746f 6b65        "The `toke
+00006680: 6e3d 6020 6b65 7977 6f72 6420 746f 2060  n=` keyword to `
+00006690: 6d61 705f 626c 6f63 6b73 6020 6861 7320  map_blocks` has 
+000066a0: 6265 656e 206d 6f76 6564 2074 6f20 606e  been moved to `n
+000066b0: 616d 653d 602e 2022 0a20 2020 2020 2020  ame=`. ".       
+000066c0: 2020 2020 2022 506c 6561 7365 2075 7365       "Please use
+000066d0: 2060 6e61 6d65 3d60 2069 6e73 7465 6164   `name=` instead
+000066e0: 2061 7320 7468 6520 6074 6f6b 656e 3d60   as the `token=`
+000066f0: 206b 6579 776f 7264 2077 696c 6c20 6265   keyword will be
+00006700: 2072 656d 6f76 6564 2022 0a20 2020 2020   removed ".     
+00006710: 2020 2020 2020 2022 696e 2061 2066 7574         "in a fut
+00006720: 7572 6520 7265 6c65 6173 652e 222c 0a20  ure release.",. 
+00006730: 2020 2020 2020 2020 2020 2063 6174 6567             categ
+00006740: 6f72 793d 4675 7475 7265 5761 726e 696e  ory=FutureWarnin
+00006750: 672c 0a20 2020 2020 2020 2029 0a20 2020  g,.        ).   
+00006760: 2020 2020 206e 616d 6520 3d20 746f 6b65       name = toke
+00006770: 6e0a 0a20 2020 206e 616d 6520 3d20 6622  n..    name = f"
+00006780: 7b6e 616d 6520 6f72 2066 756e 636e 616d  {name or funcnam
+00006790: 6528 6675 6e63 297d 2d7b 746f 6b65 6e69  e(func)}-{tokeni
+000067a0: 7a65 2866 756e 632c 2064 7479 7065 2c20  ze(func, dtype, 
+000067b0: 6368 756e 6b73 2c20 6472 6f70 5f61 7869  chunks, drop_axi
+000067c0: 732c 206e 6577 5f61 7869 732c 202a 6172  s, new_axis, *ar
+000067d0: 6773 2c20 2a2a 6b77 6172 6773 297d 220a  gs, **kwargs)}".
+000067e0: 2020 2020 6e65 775f 6178 6573 203d 207b      new_axes = {
+000067f0: 7d0a 0a20 2020 2069 6620 6973 696e 7374  }..    if isinst
+00006800: 616e 6365 2864 726f 705f 6178 6973 2c20  ance(drop_axis, 
+00006810: 4e75 6d62 6572 293a 0a20 2020 2020 2020  Number):.       
+00006820: 2064 726f 705f 6178 6973 203d 205b 6472   drop_axis = [dr
+00006830: 6f70 5f61 7869 735d 0a20 2020 2069 6620  op_axis].    if 
+00006840: 6973 696e 7374 616e 6365 286e 6577 5f61  isinstance(new_a
+00006850: 7869 732c 204e 756d 6265 7229 3a0a 2020  xis, Number):.  
+00006860: 2020 2020 2020 6e65 775f 6178 6973 203d        new_axis =
+00006870: 205b 6e65 775f 6178 6973 5d20 2023 2054   [new_axis]  # T
+00006880: 4f44 4f3a 2068 616e 646c 6520 6e65 775f  ODO: handle new_
+00006890: 6178 6973 0a0a 2020 2020 6172 7273 203d  axis..    arrs =
+000068a0: 205b 6120 666f 7220 6120 696e 2061 7267   [a for a in arg
+000068b0: 7320 6966 2069 7369 6e73 7461 6e63 6528  s if isinstance(
+000068c0: 612c 2041 7272 6179 295d 0a0a 2020 2020  a, Array)]..    
+000068d0: 6172 6770 6169 7273 203d 205b 0a20 2020  argpairs = [.   
+000068e0: 2020 2020 2028 612c 2074 7570 6c65 2872       (a, tuple(r
+000068f0: 616e 6765 2861 2e6e 6469 6d29 295b 3a3a  ange(a.ndim))[::
+00006900: 2d31 5d29 2069 6620 6973 696e 7374 616e  -1]) if isinstan
+00006910: 6365 2861 2c20 4172 7261 7929 2065 6c73  ce(a, Array) els
+00006920: 6520 2861 2c20 4e6f 6e65 290a 2020 2020  e (a, None).    
+00006930: 2020 2020 666f 7220 6120 696e 2061 7267      for a in arg
+00006940: 730a 2020 2020 5d0a 2020 2020 6966 2061  s.    ].    if a
+00006950: 7272 733a 0a20 2020 2020 2020 206f 7574  rrs:.        out
+00006960: 5f69 6e64 203d 2074 7570 6c65 2872 616e  _ind = tuple(ran
+00006970: 6765 286d 6178 2861 2e6e 6469 6d20 666f  ge(max(a.ndim fo
+00006980: 7220 6120 696e 2061 7272 7329 2929 5b3a  r a in arrs)))[:
+00006990: 3a2d 315d 0a20 2020 2065 6c73 653a 0a20  :-1].    else:. 
+000069a0: 2020 2020 2020 206f 7574 5f69 6e64 203d         out_ind =
+000069b0: 2028 290a 0a20 2020 206f 7269 6769 6e61   ()..    origina
+000069c0: 6c5f 6b77 6172 6773 203d 206b 7761 7267  l_kwargs = kwarg
+000069d0: 730a 0a20 2020 2069 6620 6474 7970 6520  s..    if dtype 
+000069e0: 6973 204e 6f6e 6520 616e 6420 6d65 7461  is None and meta
+000069f0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00006a00: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+00006a10: 2020 206d 6574 6120 3d20 636f 6d70 7574     meta = comput
+00006a20: 655f 6d65 7461 2866 756e 632c 2064 7479  e_meta(func, dty
+00006a30: 7065 2c20 2a61 7267 732c 202a 2a6b 7761  pe, *args, **kwa
+00006a40: 7267 7329 0a20 2020 2020 2020 2065 7863  rgs).        exc
+00006a50: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00006a60: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
+00006a70: 0a20 2020 2020 2020 2064 7479 7065 203d  .        dtype =
+00006a80: 2061 7070 6c79 5f69 6e66 6572 5f64 7479   apply_infer_dty
+00006a90: 7065 2866 756e 632c 2061 7267 732c 206f  pe(func, args, o
+00006aa0: 7269 6769 6e61 6c5f 6b77 6172 6773 2c20  riginal_kwargs, 
+00006ab0: 226d 6170 5f62 6c6f 636b 7322 290a 0a20  "map_blocks").. 
+00006ac0: 2020 2069 6620 6472 6f70 5f61 7869 733a     if drop_axis:
+00006ad0: 0a20 2020 2020 2020 206e 6469 6d5f 6f75  .        ndim_ou
+00006ae0: 7420 3d20 6c65 6e28 6f75 745f 696e 6429  t = len(out_ind)
+00006af0: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+00006b00: 6920 3c20 2d6e 6469 6d5f 6f75 7420 6f72  i < -ndim_out or
+00006b10: 2069 203e 3d20 6e64 696d 5f6f 7574 2066   i >= ndim_out f
+00006b20: 6f72 2069 2069 6e20 6472 6f70 5f61 7869  or i in drop_axi
+00006b30: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+00006b40: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
+00006b50: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00006b60: 2020 6622 6472 6f70 5f61 7869 7320 6f75    f"drop_axis ou
+00006b70: 7420 6f66 2072 616e 6765 2028 6472 6f70  t of range (drop
+00006b80: 5f61 7869 733d 7b64 726f 705f 6178 6973  _axis={drop_axis
+00006b90: 7d2c 2022 0a20 2020 2020 2020 2020 2020  }, ".           
+00006ba0: 2020 2020 2066 2262 7574 206f 7574 7075       f"but outpu
+00006bb0: 7420 6973 207b 6e64 696d 5f6f 7574 7d64  t is {ndim_out}d
+00006bc0: 292e 220a 2020 2020 2020 2020 2020 2020  ).".            
+00006bd0: 290a 2020 2020 2020 2020 6472 6f70 5f61  ).        drop_a
+00006be0: 7869 7320 3d20 5b69 2025 206e 6469 6d5f  xis = [i % ndim_
+00006bf0: 6f75 7420 666f 7220 6920 696e 2064 726f  out for i in dro
+00006c00: 705f 6178 6973 5d0a 2020 2020 2020 2020  p_axis].        
+00006c10: 6f75 745f 696e 6420 3d20 7475 706c 6528  out_ind = tuple(
+00006c20: 7820 666f 7220 692c 2078 2069 6e20 656e  x for i, x in en
+00006c30: 756d 6572 6174 6528 6f75 745f 696e 6429  umerate(out_ind)
+00006c40: 2069 6620 6920 6e6f 7420 696e 2064 726f   if i not in dro
+00006c50: 705f 6178 6973 290a 2020 2020 6966 206e  p_axis).    if n
+00006c60: 6577 5f61 7869 7320 6973 204e 6f6e 6520  ew_axis is None 
+00006c70: 616e 6420 6368 756e 6b73 2069 7320 6e6f  and chunks is no
+00006c80: 7420 4e6f 6e65 2061 6e64 206c 656e 286f  t None and len(o
+00006c90: 7574 5f69 6e64 2920 3c20 6c65 6e28 6368  ut_ind) < len(ch
+00006ca0: 756e 6b73 293a 0a20 2020 2020 2020 206e  unks):.        n
+00006cb0: 6577 5f61 7869 7320 3d20 7261 6e67 6528  ew_axis = range(
+00006cc0: 6c65 6e28 6368 756e 6b73 2920 2d20 6c65  len(chunks) - le
+00006cd0: 6e28 6f75 745f 696e 6429 290a 2020 2020  n(out_ind)).    
+00006ce0: 6966 206e 6577 5f61 7869 733a 0a20 2020  if new_axis:.   
+00006cf0: 2020 2020 2023 206e 6577 5f61 7869 7320       # new_axis 
+00006d00: 3d20 5b78 202b 206c 656e 2864 726f 705f  = [x + len(drop_
+00006d10: 6178 6973 2920 666f 7220 7820 696e 206e  axis) for x in n
+00006d20: 6577 5f61 7869 735d 0a20 2020 2020 2020  ew_axis].       
+00006d30: 206f 7574 5f69 6e64 203d 206c 6973 7428   out_ind = list(
+00006d40: 6f75 745f 696e 6429 0a20 2020 2020 2020  out_ind).       
+00006d50: 2066 6f72 2061 7820 696e 2073 6f72 7465   for ax in sorte
+00006d60: 6428 6e65 775f 6178 6973 293a 0a20 2020  d(new_axis):.   
+00006d70: 2020 2020 2020 2020 206e 203d 206c 656e           n = len
+00006d80: 286f 7574 5f69 6e64 2920 2b20 6c65 6e28  (out_ind) + len(
+00006d90: 6472 6f70 5f61 7869 7329 0a20 2020 2020  drop_axis).     
+00006da0: 2020 2020 2020 206f 7574 5f69 6e64 2e69         out_ind.i
+00006db0: 6e73 6572 7428 6178 2c20 6e29 0a20 2020  nsert(ax, n).   
+00006dc0: 2020 2020 2020 2020 2069 6620 6368 756e           if chun
+00006dd0: 6b73 2069 7320 6e6f 7420 4e6f 6e65 3a0a  ks is not None:.
+00006de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006df0: 6e65 775f 6178 6573 5b6e 5d20 3d20 6368  new_axes[n] = ch
+00006e00: 756e 6b73 5b61 785d 0a20 2020 2020 2020  unks[ax].       
+00006e10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+00006e20: 2020 2020 2020 2020 2020 206e 6577 5f61             new_a
+00006e30: 7865 735b 6e5d 203d 2031 0a20 2020 2020  xes[n] = 1.     
+00006e40: 2020 206f 7574 5f69 6e64 203d 2074 7570     out_ind = tup
+00006e50: 6c65 286f 7574 5f69 6e64 290a 2020 2020  le(out_ind).    
+00006e60: 2020 2020 6966 206d 6178 286e 6577 5f61      if max(new_a
+00006e70: 7869 7329 203e 206d 6178 286f 7574 5f69  xis) > max(out_i
+00006e80: 6e64 293a 0a20 2020 2020 2020 2020 2020  nd):.           
+00006e90: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00006ea0: 7228 224e 6577 5f61 7869 7320 7661 6c75  r("New_axis valu
+00006eb0: 6573 2064 6f20 6e6f 7420 6669 6c6c 2069  es do not fill i
+00006ec0: 6e20 616c 6c20 6469 6d65 6e73 696f 6e73  n all dimensions
+00006ed0: 2229 0a0a 2020 2020 6966 2063 6875 6e6b  ")..    if chunk
+00006ee0: 7320 6973 206e 6f74 204e 6f6e 653a 0a20  s is not None:. 
+00006ef0: 2020 2020 2020 2069 6620 6c65 6e28 6368         if len(ch
+00006f00: 756e 6b73 2920 213d 206c 656e 286f 7574  unks) != len(out
+00006f10: 5f69 6e64 293a 0a20 2020 2020 2020 2020  _ind):.         
+00006f20: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
+00006f30: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00006f40: 2020 2020 2066 2250 726f 7669 6465 6420       f"Provided 
+00006f50: 6368 756e 6b73 2068 6176 6520 7b6c 656e  chunks have {len
+00006f60: 2863 6875 6e6b 7329 7d20 6469 6d73 3b20  (chunks)} dims; 
+00006f70: 6578 7065 6374 6564 207b 6c65 6e28 6f75  expected {len(ou
+00006f80: 745f 696e 6429 7d20 6469 6d73 220a 2020  t_ind)} dims".  
+00006f90: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00006fa0: 2020 2020 6164 6a75 7374 5f63 6875 6e6b      adjust_chunk
+00006fb0: 7320 3d20 6469 6374 287a 6970 286f 7574  s = dict(zip(out
+00006fc0: 5f69 6e64 2c20 6368 756e 6b73 2929 0a20  _ind, chunks)). 
+00006fd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00006fe0: 2061 646a 7573 745f 6368 756e 6b73 203d   adjust_chunks =
+00006ff0: 204e 6f6e 650a 0a20 2020 2069 6620 656e   None..    if en
+00007000: 666f 7263 655f 6e64 696d 3a0a 2020 2020  force_ndim:.    
+00007010: 2020 2020 6f75 7420 3d20 626c 6f63 6b77      out = blockw
+00007020: 6973 6528 0a20 2020 2020 2020 2020 2020  ise(.           
+00007030: 2061 7070 6c79 5f61 6e64 5f65 6e66 6f72   apply_and_enfor
+00007040: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+00007050: 6f75 745f 696e 642c 0a20 2020 2020 2020  out_ind,.       
+00007060: 2020 2020 202a 636f 6e63 6174 2861 7267       *concat(arg
+00007070: 7061 6972 7329 2c0a 2020 2020 2020 2020  pairs),.        
+00007080: 2020 2020 6578 7065 6374 6564 5f6e 6469      expected_ndi
+00007090: 6d3d 6c65 6e28 6f75 745f 696e 6429 2c0a  m=len(out_ind),.
+000070a0: 2020 2020 2020 2020 2020 2020 5f66 756e              _fun
+000070b0: 633d 6675 6e63 2c0a 2020 2020 2020 2020  c=func,.        
+000070c0: 2020 2020 6e61 6d65 3d6e 616d 652c 0a20      name=name,. 
+000070d0: 2020 2020 2020 2020 2020 206e 6577 5f61             new_a
+000070e0: 7865 733d 6e65 775f 6178 6573 2c0a 2020  xes=new_axes,.  
+000070f0: 2020 2020 2020 2020 2020 6474 7970 653d            dtype=
+00007100: 6474 7970 652c 0a20 2020 2020 2020 2020  dtype,.         
+00007110: 2020 2063 6f6e 6361 7465 6e61 7465 3d54     concatenate=T
+00007120: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+00007130: 2061 6c69 676e 5f61 7272 6179 733d 4661   align_arrays=Fa
+00007140: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00007150: 2061 646a 7573 745f 6368 756e 6b73 3d61   adjust_chunks=a
+00007160: 646a 7573 745f 6368 756e 6b73 2c0a 2020  djust_chunks,.  
+00007170: 2020 2020 2020 2020 2020 6d65 7461 3d6d            meta=m
+00007180: 6574 612c 0a20 2020 2020 2020 2020 2020  eta,.           
+00007190: 202a 2a6b 7761 7267 732c 0a20 2020 2020   **kwargs,.     
+000071a0: 2020 2029 0a20 2020 2065 6c73 653a 0a20     ).    else:. 
+000071b0: 2020 2020 2020 206f 7574 203d 2062 6c6f         out = blo
+000071c0: 636b 7769 7365 280a 2020 2020 2020 2020  ckwise(.        
+000071d0: 2020 2020 6675 6e63 2c0a 2020 2020 2020      func,.      
+000071e0: 2020 2020 2020 6f75 745f 696e 642c 0a20        out_ind,. 
+000071f0: 2020 2020 2020 2020 2020 202a 636f 6e63             *conc
+00007200: 6174 2861 7267 7061 6972 7329 2c0a 2020  at(argpairs),.  
+00007210: 2020 2020 2020 2020 2020 6e61 6d65 3d6e            name=n
+00007220: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
+00007230: 206e 6577 5f61 7865 733d 6e65 775f 6178   new_axes=new_ax
+00007240: 6573 2c0a 2020 2020 2020 2020 2020 2020  es,.            
+00007250: 6474 7970 653d 6474 7970 652c 0a20 2020  dtype=dtype,.   
+00007260: 2020 2020 2020 2020 2063 6f6e 6361 7465           concate
+00007270: 6e61 7465 3d54 7275 652c 0a20 2020 2020  nate=True,.     
+00007280: 2020 2020 2020 2061 6c69 676e 5f61 7272         align_arr
+00007290: 6179 733d 4661 6c73 652c 0a20 2020 2020  ays=False,.     
+000072a0: 2020 2020 2020 2061 646a 7573 745f 6368         adjust_ch
+000072b0: 756e 6b73 3d61 646a 7573 745f 6368 756e  unks=adjust_chun
+000072c0: 6b73 2c0a 2020 2020 2020 2020 2020 2020  ks,.            
+000072d0: 6d65 7461 3d6d 6574 612c 0a20 2020 2020  meta=meta,.     
+000072e0: 2020 2020 2020 202a 2a6b 7761 7267 732c         **kwargs,
+000072f0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00007300: 6578 7472 615f 6172 6770 6169 7273 203d  extra_argpairs =
+00007310: 205b 5d0a 2020 2020 6578 7472 615f 6e61   [].    extra_na
+00007320: 6d65 7320 3d20 5b5d 0a20 2020 2023 2049  mes = [].    # I
+00007330: 6620 6675 6e63 2068 6173 2062 6c6f 636b  f func has block
+00007340: 5f69 6420 6173 2061 6e20 6172 6775 6d65  _id as an argume
+00007350: 6e74 2c20 636f 6e73 7472 7563 7420 616e  nt, construct an
+00007360: 2061 7272 6179 206f 6620 626c 6f63 6b20   array of block 
+00007370: 4944 7320 616e 640a 2020 2020 2320 7072  IDs and.    # pr
+00007380: 6570 6172 6520 746f 2069 6e6a 6563 7420  epare to inject 
+00007390: 6974 2e0a 2020 2020 6966 2068 6173 5f6b  it..    if has_k
+000073a0: 6579 776f 7264 2866 756e 632c 2022 626c  eyword(func, "bl
+000073b0: 6f63 6b5f 6964 2229 3a0a 2020 2020 2020  ock_id"):.      
+000073c0: 2020 626c 6f63 6b5f 6964 5f6e 616d 6520    block_id_name 
+000073d0: 3d20 2262 6c6f 636b 2d69 642d 2220 2b20  = "block-id-" + 
+000073e0: 6f75 742e 6e61 6d65 0a20 2020 2020 2020  out.name.       
+000073f0: 2062 6c6f 636b 5f69 645f 6473 6b20 3d20   block_id_dsk = 
+00007400: 7b0a 2020 2020 2020 2020 2020 2020 2862  {.            (b
+00007410: 6c6f 636b 5f69 645f 6e61 6d65 2c29 202b  lock_id_name,) +
+00007420: 2062 6c6f 636b 5f69 643a 2062 6c6f 636b   block_id: block
+00007430: 5f69 640a 2020 2020 2020 2020 2020 2020  _id.            
+00007440: 666f 7220 626c 6f63 6b5f 6964 2069 6e20  for block_id in 
+00007450: 7072 6f64 7563 7428 2a28 7261 6e67 6528  product(*(range(
+00007460: 6c65 6e28 6329 2920 666f 7220 6320 696e  len(c)) for c in
+00007470: 206f 7574 2e63 6875 6e6b 7329 290a 2020   out.chunks)).  
+00007480: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00007490: 626c 6f63 6b5f 6964 5f61 7272 6179 203d  block_id_array =
+000074a0: 2041 7272 6179 280a 2020 2020 2020 2020   Array(.        
+000074b0: 2020 2020 626c 6f63 6b5f 6964 5f64 736b      block_id_dsk
+000074c0: 2c0a 2020 2020 2020 2020 2020 2020 626c  ,.            bl
+000074d0: 6f63 6b5f 6964 5f6e 616d 652c 0a20 2020  ock_id_name,.   
+000074e0: 2020 2020 2020 2020 2063 6875 6e6b 733d           chunks=
+000074f0: 7475 706c 6528 2831 2c29 202a 206c 656e  tuple((1,) * len
+00007500: 2863 2920 666f 7220 6320 696e 206f 7574  (c) for c in out
+00007510: 2e63 6875 6e6b 7329 2c0a 2020 2020 2020  .chunks),.      
+00007520: 2020 2020 2020 6474 7970 653d 6e70 2e6f        dtype=np.o
+00007530: 626a 6563 745f 2c0a 2020 2020 2020 2020  bject_,.        
+00007540: 290a 2020 2020 2020 2020 6578 7472 615f  ).        extra_
+00007550: 6172 6770 6169 7273 2e61 7070 656e 6428  argpairs.append(
+00007560: 2862 6c6f 636b 5f69 645f 6172 7261 792c  (block_id_array,
+00007570: 206f 7574 5f69 6e64 2929 0a20 2020 2020   out_ind)).     
+00007580: 2020 2065 7874 7261 5f6e 616d 6573 2e61     extra_names.a
+00007590: 7070 656e 6428 2262 6c6f 636b 5f69 6422  ppend("block_id"
+000075a0: 290a 0a20 2020 2023 2049 6620 6675 6e63  )..    # If func
+000075b0: 2068 6173 2062 6c6f 636b 5f69 6e66 6f20   has block_info 
+000075c0: 6173 2061 6e20 6172 6775 6d65 6e74 2c20  as an argument, 
+000075d0: 636f 6e73 7472 7563 7420 616e 2061 7272  construct an arr
+000075e0: 6179 206f 6620 626c 6f63 6b20 696e 666f  ay of block info
+000075f0: 0a20 2020 2023 206f 626a 6563 7473 2061  .    # objects a
+00007600: 6e64 2070 7265 7061 7265 2074 6f20 696e  nd prepare to in
+00007610: 6a65 6374 2069 742e 0a20 2020 2069 6620  ject it..    if 
+00007620: 6861 735f 6b65 7977 6f72 6428 6675 6e63  has_keyword(func
+00007630: 2c20 2262 6c6f 636b 5f69 6e66 6f22 293a  , "block_info"):
+00007640: 0a20 2020 2020 2020 2073 7461 7274 7320  .        starts 
+00007650: 3d20 7b7d 0a20 2020 2020 2020 206e 756d  = {}.        num
+00007660: 5f63 6875 6e6b 7320 3d20 7b7d 0a20 2020  _chunks = {}.   
+00007670: 2020 2020 2073 6861 7065 7320 3d20 7b7d       shapes = {}
+00007680: 0a0a 2020 2020 2020 2020 666f 7220 692c  ..        for i,
+00007690: 2028 6172 672c 2069 6e5f 696e 6429 2069   (arg, in_ind) i
+000076a0: 6e20 656e 756d 6572 6174 6528 6172 6770  n enumerate(argp
+000076b0: 6169 7273 293a 0a20 2020 2020 2020 2020  airs):.         
+000076c0: 2020 2069 6620 696e 5f69 6e64 2069 7320     if in_ind is 
+000076d0: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
+000076e0: 2020 2020 2020 2020 2020 7368 6170 6573            shapes
+000076f0: 5b69 5d20 3d20 6172 672e 7368 6170 650a  [i] = arg.shape.
+00007700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007710: 6966 2064 726f 705f 6178 6973 3a0a 2020  if drop_axis:.  
+00007720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007730: 2020 2320 5765 2063 6f6e 6361 7465 6e61    # We concatena
+00007740: 7465 2061 6c6f 6e67 2064 726f 7070 6564  te along dropped
+00007750: 2061 7865 732c 2073 6f20 7765 206e 6565   axes, so we nee
+00007760: 6420 746f 2074 7265 6174 2074 6865 6d0a  d to treat them.
+00007770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007780: 2020 2020 2320 6173 2069 6620 7468 6572      # as if ther
+00007790: 6520 6973 206f 6e6c 7920 6120 7369 6e67  e is only a sing
+000077a0: 6c65 2063 6875 6e6b 2e0a 2020 2020 2020  le chunk..      
+000077b0: 2020 2020 2020 2020 2020 2020 2020 7374                st
+000077c0: 6172 7473 5b69 5d20 3d20 5b0a 2020 2020  arts[i] = [.    
+000077d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000077e0: 2020 2020 280a 2020 2020 2020 2020 2020      (.          
 000077f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007800: 2020 2028 0a20 2020 2020 2020 2020 2020     (.           
-00007810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007820: 2063 6163 6865 645f 6375 6d73 756d 2861   cached_cumsum(a
-00007830: 7267 2e63 6875 6e6b 735b 6a5d 2c20 696e  rg.chunks[j], in
-00007840: 6974 6961 6c5f 7a65 726f 3d54 7275 6529  itial_zero=True)
-00007850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007860: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00007870: 696e 6420 696e 206f 7574 5f69 6e64 0a20  ind in out_ind. 
-00007880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007890: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
-000078a0: 5b30 2c20 6172 672e 7368 6170 655b 6a5d  [0, arg.shape[j]
-000078b0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000078c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000078d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078e0: 2020 2020 666f 7220 6a2c 2069 6e64 2069      for j, ind i
-000078f0: 6e20 656e 756d 6572 6174 6528 696e 5f69  n enumerate(in_i
-00007900: 6e64 290a 2020 2020 2020 2020 2020 2020  nd).            
-00007910: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00007920: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
-00007930: 6d5f 6368 756e 6b73 5b69 5d20 3d20 7475  m_chunks[i] = tu
-00007940: 706c 6528 6c65 6e28 7329 202d 2031 2066  ple(len(s) - 1 f
-00007950: 6f72 2073 2069 6e20 7374 6172 7473 5b69  or s in starts[i
-00007960: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00007970: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00007980: 2020 2020 2020 2020 2020 2020 2073 7461               sta
-00007990: 7274 735b 695d 203d 205b 0a20 2020 2020  rts[i] = [.     
-000079a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000079b0: 2020 2063 6163 6865 645f 6375 6d73 756d     cached_cumsum
-000079c0: 2863 2c20 696e 6974 6961 6c5f 7a65 726f  (c, initial_zero
-000079d0: 3d54 7275 6529 2066 6f72 2063 2069 6e20  =True) for c in 
-000079e0: 6172 672e 6368 756e 6b73 0a20 2020 2020  arg.chunks.     
-000079f0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00007a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007a10: 2020 2020 206e 756d 5f63 6875 6e6b 735b       num_chunks[
-00007a20: 695d 203d 2061 7267 2e6e 756d 626c 6f63  i] = arg.numbloc
-00007a30: 6b73 0a20 2020 2020 2020 206f 7574 5f73  ks.        out_s
-00007a40: 7461 7274 7320 3d20 5b63 6163 6865 645f  tarts = [cached_
-00007a50: 6375 6d73 756d 2863 2c20 696e 6974 6961  cumsum(c, initia
-00007a60: 6c5f 7a65 726f 3d54 7275 6529 2066 6f72  l_zero=True) for
-00007a70: 2063 2069 6e20 6f75 742e 6368 756e 6b73   c in out.chunks
-00007a80: 5d0a 0a20 2020 2020 2020 2062 6c6f 636b  ]..        block
-00007a90: 5f69 6e66 6f5f 6e61 6d65 203d 2022 626c  _info_name = "bl
-00007aa0: 6f63 6b2d 696e 666f 2d22 202b 206f 7574  ock-info-" + out
-00007ab0: 2e6e 616d 650a 2020 2020 2020 2020 626c  .name.        bl
-00007ac0: 6f63 6b5f 696e 666f 5f64 736b 203d 207b  ock_info_dsk = {
-00007ad0: 7d0a 2020 2020 2020 2020 666f 7220 626c  }.        for bl
-00007ae0: 6f63 6b5f 6964 2069 6e20 7072 6f64 7563  ock_id in produc
-00007af0: 7428 2a28 7261 6e67 6528 6c65 6e28 6329  t(*(range(len(c)
-00007b00: 2920 666f 7220 6320 696e 206f 7574 2e63  ) for c in out.c
-00007b10: 6875 6e6b 7329 293a 0a20 2020 2020 2020  hunks)):.       
-00007b20: 2020 2020 2023 2047 6574 2070 6f73 6974       # Get posit
-00007b30: 696f 6e20 6f66 2063 6875 6e6b 2c20 696e  ion of chunk, in
-00007b40: 6465 7865 6420 6279 2061 7869 7320 6c61  dexed by axis la
-00007b50: 6265 6c73 0a20 2020 2020 2020 2020 2020  bels.           
-00007b60: 206c 6f63 6174 696f 6e20 3d20 7b6f 7574   location = {out
-00007b70: 5f69 6e64 5b69 5d3a 206c 6f63 2066 6f72  _ind[i]: loc for
-00007b80: 2069 2c20 6c6f 6320 696e 2065 6e75 6d65   i, loc in enume
-00007b90: 7261 7465 2862 6c6f 636b 5f69 6429 7d0a  rate(block_id)}.
-00007ba0: 2020 2020 2020 2020 2020 2020 696e 666f              info
-00007bb0: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
-00007bc0: 2020 666f 7220 692c 2073 6861 7065 2069    for i, shape i
-00007bd0: 6e20 7368 6170 6573 2e69 7465 6d73 2829  n shapes.items()
-00007be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00007bf0: 2020 2320 436f 6d70 7574 6520 6368 756e    # Compute chun
-00007c00: 6b20 6b65 7920 696e 2074 6865 2061 7272  k key in the arr
-00007c10: 6179 2c20 7461 6b69 6e67 2062 726f 6164  ay, taking broad
-00007c20: 6361 7374 696e 6720 696e 746f 0a20 2020  casting into.   
-00007c30: 2020 2020 2020 2020 2020 2020 2023 2061               # a
-00007c40: 6363 6f75 6e74 2e20 5765 2064 6f6e 2774  ccount. We don't
-00007c50: 2064 6972 6563 746c 7920 6b6e 6f77 2077   directly know w
-00007c60: 6869 6368 2064 696d 656e 7369 6f6e 7320  hich dimensions 
-00007c70: 6172 650a 2020 2020 2020 2020 2020 2020  are.            
-00007c80: 2020 2020 2320 6272 6f61 6463 6173 742c      # broadcast,
-00007c90: 2062 7574 2061 6e79 2064 696d 656e 7369   but any dimensi
-00007ca0: 6f6e 2077 6974 6820 6f6e 6c79 206f 6e65  on with only one
-00007cb0: 2063 6875 6e6b 2063 616e 2062 650a 2020   chunk can be.  
-00007cc0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00007cd0: 7472 6561 7465 6420 6173 2062 726f 6164  treated as broad
-00007ce0: 6361 7374 2e0a 2020 2020 2020 2020 2020  cast..          
-00007cf0: 2020 2020 2020 6172 725f 6b20 3d20 7475        arr_k = tu
-00007d00: 706c 6528 0a20 2020 2020 2020 2020 2020  ple(.           
-00007d10: 2020 2020 2020 2020 206c 6f63 6174 696f           locatio
-00007d20: 6e2e 6765 7428 696e 642c 2030 2920 6966  n.get(ind, 0) if
-00007d30: 206e 756d 5f63 6875 6e6b 735b 695d 5b6a   num_chunks[i][j
-00007d40: 5d20 3e20 3120 656c 7365 2030 0a20 2020  ] > 1 else 0.   
-00007d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007d60: 2066 6f72 206a 2c20 696e 6420 696e 2065   for j, ind in e
-00007d70: 6e75 6d65 7261 7465 2861 7267 7061 6972  numerate(argpair
-00007d80: 735b 695d 5b31 5d29 0a20 2020 2020 2020  s[i][1]).       
-00007d90: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00007da0: 2020 2020 2020 2020 2020 2069 6e66 6f5b             info[
-00007db0: 695d 203d 207b 0a20 2020 2020 2020 2020  i] = {.         
-00007dc0: 2020 2020 2020 2020 2020 2022 7368 6170             "shap
-00007dd0: 6522 3a20 7368 6170 652c 0a20 2020 2020  e": shape,.     
-00007de0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00007df0: 6e75 6d2d 6368 756e 6b73 223a 206e 756d  num-chunks": num
-00007e00: 5f63 6875 6e6b 735b 695d 2c0a 2020 2020  _chunks[i],.    
-00007e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007e20: 2261 7272 6179 2d6c 6f63 6174 696f 6e22  "array-location"
-00007e30: 3a20 5b0a 2020 2020 2020 2020 2020 2020  : [.            
-00007e40: 2020 2020 2020 2020 2020 2020 2873 7461              (sta
-00007e50: 7274 735b 695d 5b69 6a5d 5b6a 5d2c 2073  rts[i][ij][j], s
-00007e60: 7461 7274 735b 695d 5b69 6a5d 5b6a 202b  tarts[i][ij][j +
-00007e70: 2031 5d29 0a20 2020 2020 2020 2020 2020   1]).           
-00007e80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00007e90: 2069 6a2c 206a 2069 6e20 656e 756d 6572   ij, j in enumer
-00007ea0: 6174 6528 6172 725f 6b29 0a20 2020 2020  ate(arr_k).     
-00007eb0: 2020 2020 2020 2020 2020 2020 2020 205d                 ]
-00007ec0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00007ed0: 2020 2020 2020 2263 6875 6e6b 2d6c 6f63        "chunk-loc
-00007ee0: 6174 696f 6e22 3a20 6172 725f 6b2c 0a20  ation": arr_k,. 
-00007ef0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-00007f00: 0a0a 2020 2020 2020 2020 2020 2020 696e  ..            in
-00007f10: 666f 5b4e 6f6e 655d 203d 207b 0a20 2020  fo[None] = {.   
-00007f20: 2020 2020 2020 2020 2020 2020 2022 7368               "sh
-00007f30: 6170 6522 3a20 6f75 742e 7368 6170 652c  ape": out.shape,
-00007f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007f50: 2022 6e75 6d2d 6368 756e 6b73 223a 206f   "num-chunks": o
-00007f60: 7574 2e6e 756d 626c 6f63 6b73 2c0a 2020  ut.numblocks,.  
-00007f70: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-00007f80: 7272 6179 2d6c 6f63 6174 696f 6e22 3a20  rray-location": 
-00007f90: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00007fa0: 2020 2020 2020 286f 7574 5f73 7461 7274        (out_start
-00007fb0: 735b 696a 5d5b 6a5d 2c20 6f75 745f 7374  s[ij][j], out_st
-00007fc0: 6172 7473 5b69 6a5d 5b6a 202b 2031 5d29  arts[ij][j + 1])
-00007fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007fe0: 2020 2020 2066 6f72 2069 6a2c 206a 2069       for ij, j i
-00007ff0: 6e20 656e 756d 6572 6174 6528 626c 6f63  n enumerate(bloc
-00008000: 6b5f 6964 290a 2020 2020 2020 2020 2020  k_id).          
-00008010: 2020 2020 2020 5d2c 0a20 2020 2020 2020        ],.       
-00008020: 2020 2020 2020 2020 2022 6368 756e 6b2d           "chunk-
-00008030: 6c6f 6361 7469 6f6e 223a 2062 6c6f 636b  location": block
-00008040: 5f69 642c 0a20 2020 2020 2020 2020 2020  _id,.           
-00008050: 2020 2020 2022 6368 756e 6b2d 7368 6170       "chunk-shap
-00008060: 6522 3a20 7475 706c 6528 0a20 2020 2020  e": tuple(.     
-00008070: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00008080: 7574 2e63 6875 6e6b 735b 696a 5d5b 6a5d  ut.chunks[ij][j]
-00008090: 2066 6f72 2069 6a2c 206a 2069 6e20 656e   for ij, j in en
-000080a0: 756d 6572 6174 6528 626c 6f63 6b5f 6964  umerate(block_id
-000080b0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000080c0: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
-000080d0: 2020 2020 2022 6474 7970 6522 3a20 6474       "dtype": dt
-000080e0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-000080f0: 207d 0a20 2020 2020 2020 2020 2020 2062   }.            b
-00008100: 6c6f 636b 5f69 6e66 6f5f 6473 6b5b 2862  lock_info_dsk[(b
-00008110: 6c6f 636b 5f69 6e66 6f5f 6e61 6d65 2c29  lock_info_name,)
-00008120: 202b 2062 6c6f 636b 5f69 645d 203d 2069   + block_id] = i
-00008130: 6e66 6f0a 0a20 2020 2020 2020 2062 6c6f  nfo..        blo
-00008140: 636b 5f69 6e66 6f20 3d20 4172 7261 7928  ck_info = Array(
-00008150: 0a20 2020 2020 2020 2020 2020 2062 6c6f  .            blo
-00008160: 636b 5f69 6e66 6f5f 6473 6b2c 0a20 2020  ck_info_dsk,.   
-00008170: 2020 2020 2020 2020 2062 6c6f 636b 5f69           block_i
-00008180: 6e66 6f5f 6e61 6d65 2c0a 2020 2020 2020  nfo_name,.      
-00008190: 2020 2020 2020 6368 756e 6b73 3d74 7570        chunks=tup
-000081a0: 6c65 2828 312c 2920 2a20 6c65 6e28 6329  le((1,) * len(c)
-000081b0: 2066 6f72 2063 2069 6e20 6f75 742e 6368   for c in out.ch
-000081c0: 756e 6b73 292c 0a20 2020 2020 2020 2020  unks),.         
-000081d0: 2020 2064 7479 7065 3d6e 702e 6f62 6a65     dtype=np.obje
-000081e0: 6374 5f2c 0a20 2020 2020 2020 2029 0a20  ct_,.        ). 
-000081f0: 2020 2020 2020 2065 7874 7261 5f61 7267         extra_arg
-00008200: 7061 6972 732e 6170 7065 6e64 2828 626c  pairs.append((bl
-00008210: 6f63 6b5f 696e 666f 2c20 6f75 745f 696e  ock_info, out_in
-00008220: 6429 290a 2020 2020 2020 2020 6578 7472  d)).        extr
-00008230: 615f 6e61 6d65 732e 6170 7065 6e64 2822  a_names.append("
-00008240: 626c 6f63 6b5f 696e 666f 2229 0a0a 2020  block_info")..  
-00008250: 2020 6966 2065 7874 7261 5f61 7267 7061    if extra_argpa
-00008260: 6972 733a 0a20 2020 2020 2020 2023 2052  irs:.        # R
-00008270: 6577 7269 7465 2074 6865 2042 6c6f 636b  ewrite the Block
-00008280: 7769 7365 206c 6179 6572 2e20 4974 2077  wise layer. It w
-00008290: 6f75 6c64 2062 6520 6e69 6365 2074 6f20  ould be nice to 
-000082a0: 6669 6e64 2061 2077 6179 2074 6f0a 2020  find a way to.  
-000082b0: 2020 2020 2020 2320 6176 6f69 6420 646f        # avoid do
-000082c0: 696e 6720 6974 2074 7769 6365 2c20 6275  ing it twice, bu
-000082d0: 7420 6974 2773 2063 7572 7265 6e74 6c79  t it's currently
-000082e0: 206e 6565 6465 6420 746f 2064 6574 6572   needed to deter
-000082f0: 6d69 6e65 0a20 2020 2020 2020 2023 206f  mine.        # o
-00008300: 7574 2e63 6875 6e6b 7320 6672 6f6d 2074  ut.chunks from t
-00008310: 6865 2066 6972 7374 2070 6173 732e 2053  he first pass. S
-00008320: 696e 6365 2069 7420 636f 6e73 7472 7563  ince it construc
-00008330: 7473 2061 2042 6c6f 636b 7769 7365 0a20  ts a Blockwise. 
-00008340: 2020 2020 2020 2023 2072 6174 6865 7220         # rather 
-00008350: 7468 616e 2061 6e20 6578 7061 6e64 6564  than an expanded
-00008360: 2067 7261 7068 2c20 6974 2073 686f 756c   graph, it shoul
-00008370: 646e 2774 2062 6520 746f 6f20 6578 7065  dn't be too expe
-00008380: 6e73 6976 652e 0a20 2020 2020 2020 206f  nsive..        o
-00008390: 7574 203d 2062 6c6f 636b 7769 7365 280a  ut = blockwise(.
-000083a0: 2020 2020 2020 2020 2020 2020 5f70 6173              _pas
-000083b0: 735f 6578 7472 615f 6b77 6172 6773 2c0a  s_extra_kwargs,.
-000083c0: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-000083d0: 696e 642c 0a20 2020 2020 2020 2020 2020  ind,.           
-000083e0: 2066 756e 632c 0a20 2020 2020 2020 2020   func,.         
-000083f0: 2020 204e 6f6e 652c 0a20 2020 2020 2020     None,.       
-00008400: 2020 2020 2074 7570 6c65 2865 7874 7261       tuple(extra
-00008410: 5f6e 616d 6573 292c 0a20 2020 2020 2020  _names),.       
-00008420: 2020 2020 204e 6f6e 652c 0a20 2020 2020       None,.     
-00008430: 2020 2020 2020 202a 636f 6e63 6174 2865         *concat(e
-00008440: 7874 7261 5f61 7267 7061 6972 7329 2c0a  xtra_argpairs),.
-00008450: 2020 2020 2020 2020 2020 2020 2a63 6f6e              *con
-00008460: 6361 7428 6172 6770 6169 7273 292c 0a20  cat(argpairs),. 
-00008470: 2020 2020 2020 2020 2020 206e 616d 653d             name=
-00008480: 6f75 742e 6e61 6d65 2c0a 2020 2020 2020  out.name,.      
-00008490: 2020 2020 2020 6474 7970 653d 6f75 742e        dtype=out.
-000084a0: 6474 7970 652c 0a20 2020 2020 2020 2020  dtype,.         
-000084b0: 2020 2063 6f6e 6361 7465 6e61 7465 3d54     concatenate=T
-000084c0: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
-000084d0: 2061 6c69 676e 5f61 7272 6179 733d 4661   align_arrays=Fa
-000084e0: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
-000084f0: 2061 646a 7573 745f 6368 756e 6b73 3d64   adjust_chunks=d
-00008500: 6963 7428 7a69 7028 6f75 745f 696e 642c  ict(zip(out_ind,
-00008510: 206f 7574 2e63 6875 6e6b 7329 292c 0a20   out.chunks)),. 
-00008520: 2020 2020 2020 2020 2020 206d 6574 613d             meta=
-00008530: 6d65 7461 2c0a 2020 2020 2020 2020 2020  meta,.          
-00008540: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
-00008550: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
-00008560: 6e20 6f75 740a 0a0a 6465 6620 6170 706c  n out...def appl
-00008570: 795f 616e 645f 656e 666f 7263 6528 2a61  y_and_enforce(*a
-00008580: 7267 732c 202a 2a6b 7761 7267 7329 3a0a  rgs, **kwargs):.
-00008590: 2020 2020 2222 2241 7070 6c79 2061 2066      """Apply a f
-000085a0: 756e 6374 696f 6e2c 2061 6e64 2065 6e66  unction, and enf
-000085b0: 6f72 6365 2074 6865 206f 7574 7075 742e  orce the output.
-000085c0: 6e64 696d 2074 6f20 6d61 7463 6820 6578  ndim to match ex
-000085d0: 7065 6374 6564 5f6e 6469 6d0a 0a20 2020  pected_ndim..   
-000085e0: 2045 6e73 7572 6573 2074 6865 206f 7574   Ensures the out
-000085f0: 7075 7420 6861 7320 7468 6520 6578 7065  put has the expe
-00008600: 6374 6564 2064 696d 656e 7369 6f6e 616c  cted dimensional
-00008610: 6974 792e 2222 220a 2020 2020 6675 6e63  ity.""".    func
-00008620: 203d 206b 7761 7267 732e 706f 7028 225f   = kwargs.pop("_
-00008630: 6675 6e63 2229 0a20 2020 2065 7870 6563  func").    expec
-00008640: 7465 645f 6e64 696d 203d 206b 7761 7267  ted_ndim = kwarg
-00008650: 732e 706f 7028 2265 7870 6563 7465 645f  s.pop("expected_
-00008660: 6e64 696d 2229 0a20 2020 206f 7574 203d  ndim").    out =
-00008670: 2066 756e 6328 2a61 7267 732c 202a 2a6b   func(*args, **k
-00008680: 7761 7267 7329 0a20 2020 2069 6620 6765  wargs).    if ge
-00008690: 7461 7474 7228 6f75 742c 2022 6e64 696d  tattr(out, "ndim
-000086a0: 222c 2030 2920 213d 2065 7870 6563 7465  ", 0) != expecte
-000086b0: 645f 6e64 696d 3a0a 2020 2020 2020 2020  d_ndim:.        
-000086c0: 6f75 745f 6e64 696d 203d 2067 6574 6174  out_ndim = getat
-000086d0: 7472 286f 7574 2c20 226e 6469 6d22 2c20  tr(out, "ndim", 
-000086e0: 3029 0a20 2020 2020 2020 2072 6169 7365  0).        raise
-000086f0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-00008700: 2020 2020 2020 2020 2066 2244 696d 656e           f"Dimen
-00008710: 7369 6f6e 206d 6973 6d61 7463 683a 2065  sion mismatch: e
-00008720: 7870 6563 7465 6420 6f75 7470 7574 206f  xpected output o
-00008730: 6620 7b66 756e 637d 2022 0a20 2020 2020  f {func} ".     
-00008740: 2020 2020 2020 2066 2274 6f20 6861 7665         f"to have
-00008750: 2064 696d 7320 3d20 7b65 7870 6563 7465   dims = {expecte
-00008760: 645f 6e64 696d 7d2e 2020 476f 7420 7b6f  d_ndim}.  Got {o
-00008770: 7574 5f6e 6469 6d7d 2069 6e73 7465 6164  ut_ndim} instead
-00008780: 2e22 0a20 2020 2020 2020 2029 0a20 2020  .".        ).   
-00008790: 2072 6574 7572 6e20 6f75 740a 0a0a 6465   return out...de
-000087a0: 6620 6272 6f61 6463 6173 745f 6368 756e  f broadcast_chun
-000087b0: 6b73 282a 6368 756e 6b73 7329 3a0a 2020  ks(*chunkss):.  
-000087c0: 2020 2222 2243 6f6e 7374 7275 6374 2061    """Construct a
-000087d0: 2063 6875 6e6b 7320 7475 706c 6520 7468   chunks tuple th
-000087e0: 6174 2062 726f 6164 6361 7374 7320 6d61  at broadcasts ma
-000087f0: 6e79 2063 6875 6e6b 7320 7475 706c 6573  ny chunks tuples
-00008800: 0a0a 2020 2020 3e3e 3e20 6120 3d20 2828  ..    >>> a = ((
-00008810: 352c 2035 292c 290a 2020 2020 3e3e 3e20  5, 5),).    >>> 
-00008820: 6220 3d20 2828 352c 2035 292c 290a 2020  b = ((5, 5),).  
-00008830: 2020 3e3e 3e20 6272 6f61 6463 6173 745f    >>> broadcast_
-00008840: 6368 756e 6b73 2861 2c20 6229 0a20 2020  chunks(a, b).   
-00008850: 2028 2835 2c20 3529 2c29 0a0a 2020 2020   ((5, 5),)..    
-00008860: 3e3e 3e20 6120 3d20 2828 3130 2c20 3130  >>> a = ((10, 10
-00008870: 2c20 3130 292c 2028 352c 2035 292c 290a  , 10), (5, 5),).
-00008880: 2020 2020 3e3e 3e20 6220 3d20 2828 352c      >>> b = ((5,
-00008890: 2035 292c 290a 2020 2020 3e3e 3e20 6272   5),).    >>> br
-000088a0: 6f61 6463 6173 745f 6368 756e 6b73 2861  oadcast_chunks(a
-000088b0: 2c20 6229 0a20 2020 2028 2831 302c 2031  , b).    ((10, 1
-000088c0: 302c 2031 3029 2c20 2835 2c20 3529 290a  0, 10), (5, 5)).
-000088d0: 0a20 2020 203e 3e3e 2061 203d 2028 2831  .    >>> a = ((1
-000088e0: 302c 2031 302c 2031 3029 2c20 2835 2c20  0, 10, 10), (5, 
-000088f0: 3529 2c29 0a20 2020 203e 3e3e 2062 203d  5),).    >>> b =
-00008900: 2028 2831 2c29 2c20 2835 2c20 3529 2c29   ((1,), (5, 5),)
-00008910: 0a20 2020 203e 3e3e 2062 726f 6164 6361  .    >>> broadca
-00008920: 7374 5f63 6875 6e6b 7328 612c 2062 290a  st_chunks(a, b).
-00008930: 2020 2020 2828 3130 2c20 3130 2c20 3130      ((10, 10, 10
-00008940: 292c 2028 352c 2035 2929 0a0a 2020 2020  ), (5, 5))..    
-00008950: 3e3e 3e20 6120 3d20 2828 3130 2c20 3130  >>> a = ((10, 10
-00008960: 2c20 3130 292c 2028 352c 2035 292c 290a  , 10), (5, 5),).
-00008970: 2020 2020 3e3e 3e20 6220 3d20 2828 332c      >>> b = ((3,
-00008980: 2033 2c29 2c20 2835 2c20 3529 2c29 0a20   3,), (5, 5),). 
-00008990: 2020 203e 3e3e 2062 726f 6164 6361 7374     >>> broadcast
-000089a0: 5f63 6875 6e6b 7328 612c 2062 290a 2020  _chunks(a, b).  
-000089b0: 2020 5472 6163 6562 6163 6b20 286d 6f73    Traceback (mos
-000089c0: 7420 7265 6365 6e74 2063 616c 6c20 6c61  t recent call la
-000089d0: 7374 293a 0a20 2020 2020 2020 202e 2e2e  st):.        ...
-000089e0: 0a20 2020 2056 616c 7565 4572 726f 723a  .    ValueError:
-000089f0: 2043 6875 6e6b 7320 646f 206e 6f74 2061   Chunks do not a
-00008a00: 6c69 676e 3a20 5b28 3130 2c20 3130 2c20  lign: [(10, 10, 
-00008a10: 3130 292c 2028 332c 2033 295d 0a20 2020  10), (3, 3)].   
-00008a20: 2022 2222 0a20 2020 2069 6620 6e6f 7420   """.    if not 
-00008a30: 6368 756e 6b73 733a 0a20 2020 2020 2020  chunkss:.       
-00008a40: 2072 6574 7572 6e20 2829 0a20 2020 2065   return ().    e
-00008a50: 6c69 6620 6c65 6e28 6368 756e 6b73 7329  lif len(chunkss)
-00008a60: 203d 3d20 313a 0a20 2020 2020 2020 2072   == 1:.        r
-00008a70: 6574 7572 6e20 6368 756e 6b73 735b 305d  eturn chunkss[0]
-00008a80: 0a20 2020 206e 203d 206d 6178 286d 6170  .    n = max(map
-00008a90: 286c 656e 2c20 6368 756e 6b73 7329 290a  (len, chunkss)).
-00008aa0: 2020 2020 6368 756e 6b73 7332 203d 205b      chunkss2 = [
-00008ab0: 2828 312c 292c 2920 2a20 286e 202d 206c  ((1,),) * (n - l
-00008ac0: 656e 2863 2929 202b 2063 2066 6f72 2063  en(c)) + c for c
-00008ad0: 2069 6e20 6368 756e 6b73 735d 0a20 2020   in chunkss].   
-00008ae0: 2072 6573 756c 7420 3d20 5b5d 0a20 2020   result = [].   
-00008af0: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-00008b00: 6e29 3a0a 2020 2020 2020 2020 7374 6570  n):.        step
-00008b10: 3120 3d20 5b63 5b69 5d20 666f 7220 6320  1 = [c[i] for c 
-00008b20: 696e 2063 6875 6e6b 7373 325d 0a20 2020  in chunkss2].   
-00008b30: 2020 2020 2069 6620 616c 6c28 6320 3d3d       if all(c ==
-00008b40: 2028 312c 2920 666f 7220 6320 696e 2073   (1,) for c in s
-00008b50: 7465 7031 293a 0a20 2020 2020 2020 2020  tep1):.         
-00008b60: 2020 2073 7465 7032 203d 2073 7465 7031     step2 = step1
-00008b70: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00008b80: 2020 2020 2020 2020 2020 2073 7465 7032             step2
-00008b90: 203d 205b 6320 666f 7220 6320 696e 2073   = [c for c in s
-00008ba0: 7465 7031 2069 6620 6320 213d 2028 312c  tep1 if c != (1,
-00008bb0: 295d 0a20 2020 2020 2020 2069 6620 6c65  )].        if le
-00008bc0: 6e28 7365 7428 7374 6570 3229 2920 213d  n(set(step2)) !=
-00008bd0: 2031 3a0a 2020 2020 2020 2020 2020 2020   1:.            
-00008be0: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-00008bf0: 2822 4368 756e 6b73 2064 6f20 6e6f 7420  ("Chunks do not 
-00008c00: 616c 6967 6e3a 2025 7322 2025 2073 7472  align: %s" % str
-00008c10: 2873 7465 7032 2929 0a20 2020 2020 2020  (step2)).       
-00008c20: 2072 6573 756c 742e 6170 7065 6e64 2873   result.append(s
-00008c30: 7465 7032 5b30 5d29 0a20 2020 2072 6574  tep2[0]).    ret
-00008c40: 7572 6e20 7475 706c 6528 7265 7375 6c74  urn tuple(result
-00008c50: 290a 0a0a 6465 6620 7374 6f72 6528 0a20  )...def store(. 
-00008c60: 2020 2073 6f75 7263 6573 3a20 4172 7261     sources: Arra
-00008c70: 7920 7c20 436f 6c6c 6563 7469 6f6e 5b41  y | Collection[A
-00008c80: 7272 6179 5d2c 0a20 2020 2074 6172 6765  rray],.    targe
-00008c90: 7473 3a20 4172 7261 794c 696b 6520 7c20  ts: ArrayLike | 
-00008ca0: 4465 6c61 7965 6420 7c20 436f 6c6c 6563  Delayed | Collec
-00008cb0: 7469 6f6e 5b41 7272 6179 4c69 6b65 207c  tion[ArrayLike |
-00008cc0: 2044 656c 6179 6564 5d2c 0a20 2020 206c   Delayed],.    l
-00008cd0: 6f63 6b3a 2062 6f6f 6c20 7c20 4c6f 636b  ock: bool | Lock
-00008ce0: 203d 2054 7275 652c 0a20 2020 2072 6567   = True,.    reg
-00008cf0: 696f 6e73 3a20 7475 706c 655b 736c 6963  ions: tuple[slic
-00008d00: 652c 202e 2e2e 5d20 7c20 436f 6c6c 6563  e, ...] | Collec
-00008d10: 7469 6f6e 5b74 7570 6c65 5b73 6c69 6365  tion[tuple[slice
-00008d20: 2c20 2e2e 2e5d 5d20 7c20 4e6f 6e65 203d  , ...]] | None =
-00008d30: 204e 6f6e 652c 0a20 2020 2063 6f6d 7075   None,.    compu
-00008d40: 7465 3a20 626f 6f6c 203d 2054 7275 652c  te: bool = True,
-00008d50: 0a20 2020 2072 6574 7572 6e5f 7374 6f72  .    return_stor
-00008d60: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
-00008d70: 2c0a 2020 2020 2a2a 6b77 6172 6773 2c0a  ,.    **kwargs,.
-00008d80: 293a 0a20 2020 2022 2222 5374 6f72 6520  ):.    """Store 
-00008d90: 6461 736b 2061 7272 6179 7320 696e 2061  dask arrays in a
-00008da0: 7272 6179 2d6c 696b 6520 6f62 6a65 6374  rray-like object
-00008db0: 732c 206f 7665 7277 7269 7465 2064 6174  s, overwrite dat
-00008dc0: 6120 696e 2074 6172 6765 740a 0a20 2020  a in target..   
-00008dd0: 2054 6869 7320 7374 6f72 6573 2064 6173   This stores das
-00008de0: 6b20 6172 7261 7973 2069 6e74 6f20 6f62  k arrays into ob
-00008df0: 6a65 6374 2074 6861 7420 7375 7070 6f72  ject that suppor
-00008e00: 7473 206e 756d 7079 2d73 7479 6c65 2073  ts numpy-style s
-00008e10: 6574 6974 656d 0a20 2020 2069 6e64 6578  etitem.    index
-00008e20: 696e 672e 2020 4974 2073 746f 7265 7320  ing.  It stores 
-00008e30: 7661 6c75 6573 2063 6875 6e6b 2062 7920  values chunk by 
-00008e40: 6368 756e 6b20 736f 2074 6861 7420 6974  chunk so that it
-00008e50: 2064 6f65 7320 6e6f 7420 6861 7665 2074   does not have t
-00008e60: 6f0a 2020 2020 6669 6c6c 2075 7020 6d65  o.    fill up me
-00008e70: 6d6f 7279 2e20 2046 6f72 2062 6573 7420  mory.  For best 
-00008e80: 7065 7266 6f72 6d61 6e63 6520 796f 7520  performance you 
-00008e90: 6361 6e20 616c 6967 6e20 7468 6520 626c  can align the bl
-00008ea0: 6f63 6b20 7369 7a65 206f 660a 2020 2020  ock size of.    
-00008eb0: 7468 6520 7374 6f72 6167 6520 7461 7267  the storage targ
-00008ec0: 6574 2077 6974 6820 7468 6520 626c 6f63  et with the bloc
-00008ed0: 6b20 7369 7a65 206f 6620 796f 7572 2061  k size of your a
-00008ee0: 7272 6179 2e0a 0a20 2020 2049 6620 796f  rray...    If yo
-00008ef0: 7572 2064 6174 6120 6669 7473 2069 6e20  ur data fits in 
-00008f00: 6d65 6d6f 7279 2074 6865 6e20 796f 7520  memory then you 
-00008f10: 6d61 7920 7072 6566 6572 2063 616c 6c69  may prefer calli
-00008f20: 6e67 0a20 2020 2060 606e 702e 6172 7261  ng.    ``np.arra
-00008f30: 7928 6d79 6172 7261 7929 6060 2069 6e73  y(myarray)`` ins
-00008f40: 7465 6164 2e0a 0a20 2020 2050 6172 616d  tead...    Param
-00008f50: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-00008f60: 2d2d 2d2d 0a0a 2020 2020 736f 7572 6365  ----..    source
-00008f70: 733a 2041 7272 6179 206f 7220 636f 6c6c  s: Array or coll
-00008f80: 6563 7469 6f6e 206f 6620 4172 7261 7973  ection of Arrays
-00008f90: 0a20 2020 2074 6172 6765 7473 3a20 6172  .    targets: ar
-00008fa0: 7261 792d 6c69 6b65 206f 7220 4465 6c61  ray-like or Dela
-00008fb0: 7965 6420 6f72 2063 6f6c 6c65 6374 696f  yed or collectio
-00008fc0: 6e20 6f66 2061 7272 6179 2d6c 696b 6573  n of array-likes
-00008fd0: 2061 6e64 2f6f 7220 4465 6c61 7965 6473   and/or Delayeds
-00008fe0: 0a20 2020 2020 2020 2054 6865 7365 2073  .        These s
-00008ff0: 686f 756c 6420 7375 7070 6f72 7420 7365  hould support se
-00009000: 7469 7465 6d20 7379 6e74 6178 2060 6074  titem syntax ``t
-00009010: 6172 6765 745b 3130 3a32 305d 203d 202e  arget[10:20] = .
-00009020: 2e2e 6060 2e0a 2020 2020 2020 2020 4966  ..``..        If
-00009030: 2073 6f75 7263 6573 2069 7320 6120 7369   sources is a si
-00009040: 6e67 6c65 2069 7465 6d2c 2074 6172 6765  ngle item, targe
-00009050: 7473 206d 7573 7420 6265 2061 2073 696e  ts must be a sin
-00009060: 676c 6520 6974 656d 3b20 6966 2073 6f75  gle item; if sou
-00009070: 7263 6573 2069 7320 610a 2020 2020 2020  rces is a.      
-00009080: 2020 636f 6c6c 6563 7469 6f6e 206f 6620    collection of 
-00009090: 6172 7261 7973 2c20 7461 7267 6574 7320  arrays, targets 
-000090a0: 6d75 7374 2062 6520 6120 6d61 7463 6869  must be a matchi
-000090b0: 6e67 2063 6f6c 6c65 6374 696f 6e2e 0a20  ng collection.. 
-000090c0: 2020 206c 6f63 6b3a 2062 6f6f 6c65 616e     lock: boolean
-000090d0: 206f 7220 7468 7265 6164 696e 672e 4c6f   or threading.Lo
-000090e0: 636b 2c20 6f70 7469 6f6e 616c 0a20 2020  ck, optional.   
-000090f0: 2020 2020 2057 6865 7468 6572 206f 7220       Whether or 
-00009100: 6e6f 7420 746f 206c 6f63 6b20 7468 6520  not to lock the 
-00009110: 6461 7461 2073 746f 7265 7320 7768 696c  data stores whil
-00009120: 6520 7374 6f72 696e 672e 0a20 2020 2020  e storing..     
-00009130: 2020 2050 6173 7320 5472 7565 2028 6c6f     Pass True (lo
-00009140: 636b 2065 6163 6820 6669 6c65 2069 6e64  ck each file ind
-00009150: 6976 6964 7561 6c6c 7929 2c20 4661 6c73  ividually), Fals
-00009160: 6520 2864 6f6e 2774 206c 6f63 6b29 206f  e (don't lock) o
-00009170: 7220 610a 2020 2020 2020 2020 7061 7274  r a.        part
-00009180: 6963 756c 6172 203a 636c 6173 733a 6074  icular :class:`t
-00009190: 6872 6561 6469 6e67 2e4c 6f63 6b60 206f  hreading.Lock` o
-000091a0: 626a 6563 7420 746f 2062 6520 7368 6172  bject to be shar
-000091b0: 6564 2061 6d6f 6e67 2061 6c6c 2077 7269  ed among all wri
-000091c0: 7465 732e 0a20 2020 2072 6567 696f 6e73  tes..    regions
-000091d0: 3a20 7475 706c 6520 6f66 2073 6c69 6365  : tuple of slice
-000091e0: 7320 6f72 2063 6f6c 6c65 6374 696f 6e20  s or collection 
-000091f0: 6f66 2074 7570 6c65 7320 6f66 2073 6c69  of tuples of sli
-00009200: 6365 732c 206f 7074 696f 6e61 6c0a 2020  ces, optional.  
-00009210: 2020 2020 2020 4561 6368 2060 6072 6567        Each ``reg
-00009220: 696f 6e60 6020 7475 706c 6520 696e 2060  ion`` tuple in `
-00009230: 6072 6567 696f 6e73 6060 2073 686f 756c  `regions`` shoul
-00009240: 6420 6265 2073 7563 6820 7468 6174 0a20  d be such that. 
-00009250: 2020 2020 2020 2060 6074 6172 6765 745b         ``target[
-00009260: 7265 6769 6f6e 5d2e 7368 6170 6520 3d20  region].shape = 
-00009270: 736f 7572 6365 2e73 6861 7065 6060 0a20  source.shape``. 
-00009280: 2020 2020 2020 2066 6f72 2074 6865 2063         for the c
-00009290: 6f72 7265 7370 6f6e 6469 6e67 2073 6f75  orresponding sou
-000092a0: 7263 6520 616e 6420 7461 7267 6574 2069  rce and target i
-000092b0: 6e20 736f 7572 6365 7320 616e 6420 7461  n sources and ta
-000092c0: 7267 6574 732c 0a20 2020 2020 2020 2072  rgets,.        r
-000092d0: 6573 7065 6374 6976 656c 792e 2049 6620  espectively. If 
-000092e0: 7468 6973 2069 7320 6120 7475 706c 652c  this is a tuple,
-000092f0: 2074 6865 2063 6f6e 7465 6e74 7320 7769   the contents wi
-00009300: 6c6c 2062 6520 6173 7375 6d65 6420 746f  ll be assumed to
-00009310: 2062 650a 2020 2020 2020 2020 736c 6963   be.        slic
-00009320: 6573 2c20 736f 2064 6f20 6e6f 7420 7072  es, so do not pr
-00009330: 6f76 6964 6520 6120 7475 706c 6520 6f66  ovide a tuple of
-00009340: 2074 7570 6c65 732e 0a20 2020 2063 6f6d   tuples..    com
-00009350: 7075 7465 3a20 626f 6f6c 6561 6e2c 206f  pute: boolean, o
-00009360: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00009370: 4966 2074 7275 6520 636f 6d70 7574 6520  If true compute 
-00009380: 696d 6d65 6469 6174 656c 793b 2072 6574  immediately; ret
-00009390: 7572 6e20 3a63 6c61 7373 3a60 6461 736b  urn :class:`dask
-000093a0: 2e64 656c 6179 6564 2e44 656c 6179 6564  .delayed.Delayed
-000093b0: 6020 6f74 6865 7277 6973 652e 0a20 2020  ` otherwise..   
-000093c0: 2072 6574 7572 6e5f 7374 6f72 6564 3a20   return_stored: 
-000093d0: 626f 6f6c 6561 6e2c 206f 7074 696f 6e61  boolean, optiona
-000093e0: 6c0a 2020 2020 2020 2020 4f70 7469 6f6e  l.        Option
-000093f0: 616c 6c79 2072 6574 7572 6e20 7468 6520  ally return the 
-00009400: 7374 6f72 6564 2072 6573 756c 7420 2864  stored result (d
-00009410: 6566 6175 6c74 2046 616c 7365 292e 0a20  efault False).. 
-00009420: 2020 206b 7761 7267 733a 0a20 2020 2020     kwargs:.     
-00009430: 2020 2050 6172 616d 6574 6572 7320 7061     Parameters pa
-00009440: 7373 6564 2074 6f20 636f 6d70 7574 652f  ssed to compute/
-00009450: 7065 7273 6973 7420 286f 6e6c 7920 7573  persist (only us
-00009460: 6564 2069 6620 636f 6d70 7574 653d 5472  ed if compute=Tr
-00009470: 7565 290a 0a20 2020 2052 6574 7572 6e73  ue)..    Returns
-00009480: 0a20 2020 202d 2d2d 2d2d 2d2d 0a0a 2020  .    -------..  
-00009490: 2020 4966 2072 6574 7572 6e5f 7374 6f72    If return_stor
-000094a0: 6564 3d54 7275 650a 2020 2020 2020 2020  ed=True.        
-000094b0: 7475 706c 6520 6f66 2041 7272 6179 730a  tuple of Arrays.
-000094c0: 2020 2020 4966 2072 6574 7572 6e5f 7374      If return_st
-000094d0: 6f72 6564 3d46 616c 7365 2061 6e64 2063  ored=False and c
-000094e0: 6f6d 7075 7465 3d54 7275 650a 2020 2020  ompute=True.    
-000094f0: 2020 2020 4e6f 6e65 0a20 2020 2049 6620      None.    If 
-00009500: 7265 7475 726e 5f73 746f 7265 643d 4661  return_stored=Fa
-00009510: 6c73 6520 616e 6420 636f 6d70 7574 653d  lse and compute=
-00009520: 4661 6c73 650a 2020 2020 2020 2020 4465  False.        De
-00009530: 6c61 7965 640a 0a20 2020 2045 7861 6d70  layed..    Examp
-00009540: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
-00009550: 0a0a 2020 2020 3e3e 3e20 696d 706f 7274  ..    >>> import
-00009560: 2068 3570 7920 2023 2064 6f63 7465 7374   h5py  # doctest
-00009570: 3a20 2b53 4b49 500a 2020 2020 3e3e 3e20  : +SKIP.    >>> 
-00009580: 6620 3d20 6835 7079 2e46 696c 6528 276d  f = h5py.File('m
-00009590: 7966 696c 652e 6864 6635 272c 206d 6f64  yfile.hdf5', mod
-000095a0: 653d 2761 2729 2020 2320 646f 6374 6573  e='a')  # doctes
-000095b0: 743a 202b 534b 4950 0a20 2020 203e 3e3e  t: +SKIP.    >>>
-000095c0: 2064 7365 7420 3d20 662e 6372 6561 7465   dset = f.create
-000095d0: 5f64 6174 6173 6574 2827 2f64 6174 6127  _dataset('/data'
-000095e0: 2c20 7368 6170 653d 782e 7368 6170 652c  , shape=x.shape,
-000095f0: 0a20 2020 202e 2e2e 2020 2020 2020 2020  .    ...        
-00009600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009610: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
-00009620: 3d78 2e63 6875 6e6b 732c 0a20 2020 202e  =x.chunks,.    .
-00009630: 2e2e 2020 2020 2020 2020 2020 2020 2020  ..              
-00009640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009650: 2020 2020 6474 7970 653d 2766 3827 2920      dtype='f8') 
-00009660: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
-00009670: 500a 0a20 2020 203e 3e3e 2073 746f 7265  P..    >>> store
-00009680: 2878 2c20 6473 6574 2920 2023 2064 6f63  (x, dset)  # doc
-00009690: 7465 7374 3a20 2b53 4b49 500a 0a20 2020  test: +SKIP..   
-000096a0: 2041 6c74 6572 6e61 7469 7665 6c79 2073   Alternatively s
-000096b0: 746f 7265 206d 616e 7920 6172 7261 7973  tore many arrays
-000096c0: 2061 7420 7468 6520 7361 6d65 2074 696d   at the same tim
-000096d0: 650a 0a20 2020 203e 3e3e 2073 746f 7265  e..    >>> store
-000096e0: 285b 782c 2079 2c20 7a5d 2c20 5b64 7365  ([x, y, z], [dse
-000096f0: 7431 2c20 6473 6574 322c 2064 7365 7433  t1, dset2, dset3
-00009700: 5d29 2020 2320 646f 6374 6573 743a 202b  ])  # doctest: +
-00009710: 534b 4950 0a20 2020 2022 2222 0a0a 2020  SKIP.    """..  
-00009720: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-00009730: 736f 7572 6365 732c 2041 7272 6179 293a  sources, Array):
-00009740: 0a20 2020 2020 2020 2073 6f75 7263 6573  .        sources
-00009750: 203d 205b 736f 7572 6365 735d 0a20 2020   = [sources].   
-00009760: 2020 2020 2023 2054 6865 7265 2773 206e       # There's n
-00009770: 6f20 7761 7920 746f 2074 6573 7420 7468  o way to test th
-00009780: 6174 2074 6172 6765 7473 2069 7320 6120  at targets is a 
-00009790: 7369 6e67 6c65 2061 7272 6179 2d6c 696b  single array-lik
-000097a0: 652e 0a20 2020 2020 2020 2023 2057 6520  e..        # We 
-000097b0: 6e65 6564 2074 6f20 7472 7573 7420 7468  need to trust th
-000097c0: 6520 7573 6572 2e0a 2020 2020 2020 2020  e user..        
-000097d0: 7461 7267 6574 7320 3d20 5b74 6172 6765  targets = [targe
-000097e0: 7473 5d20 2023 2074 7970 653a 2069 676e  ts]  # type: ign
-000097f0: 6f72 650a 2020 2020 7461 7267 6574 7320  ore.    targets 
-00009800: 3d20 6361 7374 2822 436f 6c6c 6563 7469  = cast("Collecti
-00009810: 6f6e 5b41 7272 6179 4c69 6b65 207c 2044  on[ArrayLike | D
-00009820: 656c 6179 6564 5d22 2c20 7461 7267 6574  elayed]", target
-00009830: 7329 0a0a 2020 2020 6966 2061 6e79 286e  s)..    if any(n
-00009840: 6f74 2069 7369 6e73 7461 6e63 6528 732c  ot isinstance(s,
-00009850: 2041 7272 6179 2920 666f 7220 7320 696e   Array) for s in
-00009860: 2073 6f75 7263 6573 293a 0a20 2020 2020   sources):.     
-00009870: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00009880: 726f 7228 2241 6c6c 2073 6f75 7263 6573  ror("All sources
-00009890: 206d 7573 7420 6265 2064 6173 6b20 6172   must be dask ar
-000098a0: 7261 7920 6f62 6a65 6374 7322 290a 0a20  ray objects").. 
-000098b0: 2020 2069 6620 6c65 6e28 736f 7572 6365     if len(source
-000098c0: 7329 2021 3d20 6c65 6e28 7461 7267 6574  s) != len(target
-000098d0: 7329 3a0a 2020 2020 2020 2020 7261 6973  s):.        rais
-000098e0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-000098f0: 2020 2020 2020 2020 2020 2244 6966 6665            "Diffe
-00009900: 7265 6e74 206e 756d 6265 7220 6f66 2073  rent number of s
-00009910: 6f75 7263 6573 205b 2564 5d20 616e 6420  ources [%d] and 
-00009920: 7461 7267 6574 7320 5b25 645d 220a 2020  targets [%d]".  
-00009930: 2020 2020 2020 2020 2020 2520 286c 656e            % (len
-00009940: 2873 6f75 7263 6573 292c 206c 656e 2874  (sources), len(t
-00009950: 6172 6765 7473 2929 0a20 2020 2020 2020  argets)).       
-00009960: 2029 0a0a 2020 2020 6966 2069 7369 6e73   )..    if isins
-00009970: 7461 6e63 6528 7265 6769 6f6e 732c 2074  tance(regions, t
-00009980: 7570 6c65 2920 6f72 2072 6567 696f 6e73  uple) or regions
-00009990: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000099a0: 2020 7265 6769 6f6e 735f 6c69 7374 203d    regions_list =
-000099b0: 205b 7265 6769 6f6e 735d 202a 206c 656e   [regions] * len
-000099c0: 2873 6f75 7263 6573 290a 2020 2020 656c  (sources).    el
-000099d0: 7365 3a0a 2020 2020 2020 2020 7265 6769  se:.        regi
-000099e0: 6f6e 735f 6c69 7374 203d 206c 6973 7428  ons_list = list(
-000099f0: 7265 6769 6f6e 7329 0a20 2020 2020 2020  regions).       
-00009a00: 2069 6620 6c65 6e28 736f 7572 6365 7329   if len(sources)
-00009a10: 2021 3d20 6c65 6e28 7265 6769 6f6e 735f   != len(regions_
-00009a20: 6c69 7374 293a 0a20 2020 2020 2020 2020  list):.         
-00009a30: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00009a40: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00009a50: 2020 2020 2066 2244 6966 6665 7265 6e74       f"Different
-00009a60: 206e 756d 6265 7220 6f66 2073 6f75 7263   number of sourc
-00009a70: 6573 205b 7b6c 656e 2873 6f75 7263 6573  es [{len(sources
-00009a80: 297d 5d20 616e 6420 220a 2020 2020 2020  )}] and ".      
-00009a90: 2020 2020 2020 2020 2020 6622 7461 7267            f"targ
-00009aa0: 6574 7320 5b7b 6c65 6e28 7461 7267 6574  ets [{len(target
-00009ab0: 7329 7d5d 2074 6861 6e20 7265 6769 6f6e  s)}] than region
-00009ac0: 7320 5b7b 6c65 6e28 7265 6769 6f6e 735f  s [{len(regions_
-00009ad0: 6c69 7374 297d 5d22 0a20 2020 2020 2020  list)}]".       
-00009ae0: 2020 2020 2029 0a20 2020 2064 656c 2072       ).    del r
-00009af0: 6567 696f 6e73 0a0a 2020 2020 2320 4f70  egions..    # Op
-00009b00: 7469 6d69 7a65 2061 6c6c 2073 6f75 7263  timize all sourc
-00009b10: 6573 2074 6f67 6574 6865 720a 2020 2020  es together.    
-00009b20: 736f 7572 6365 735f 686c 6720 3d20 4869  sources_hlg = Hi
-00009b30: 6768 4c65 7665 6c47 7261 7068 2e6d 6572  ghLevelGraph.mer
-00009b40: 6765 282a 5b65 2e5f 5f64 6173 6b5f 6772  ge(*[e.__dask_gr
-00009b50: 6170 685f 5f28 2920 666f 7220 6520 696e  aph__() for e in
-00009b60: 2073 6f75 7263 6573 5d29 0a20 2020 2073   sources]).    s
-00009b70: 6f75 7263 6573 5f6c 6179 6572 203d 2041  ources_layer = A
-00009b80: 7272 6179 2e5f 5f64 6173 6b5f 6f70 7469  rray.__dask_opti
-00009b90: 6d69 7a65 5f5f 280a 2020 2020 2020 2020  mize__(.        
-00009ba0: 736f 7572 6365 735f 686c 672c 206c 6973  sources_hlg, lis
-00009bb0: 7428 636f 7265 2e66 6c61 7474 656e 285b  t(core.flatten([
-00009bc0: 652e 5f5f 6461 736b 5f6b 6579 735f 5f28  e.__dask_keys__(
-00009bd0: 2920 666f 7220 6520 696e 2073 6f75 7263  ) for e in sourc
-00009be0: 6573 5d29 290a 2020 2020 290a 2020 2020  es])).    ).    
-00009bf0: 736f 7572 6365 735f 6e61 6d65 203d 2022  sources_name = "
-00009c00: 7374 6f72 652d 736f 7572 6365 732d 2220  store-sources-" 
-00009c10: 2b20 746f 6b65 6e69 7a65 2873 6f75 7263  + tokenize(sourc
-00009c20: 6573 290a 2020 2020 6c61 7965 7273 203d  es).    layers =
-00009c30: 207b 736f 7572 6365 735f 6e61 6d65 3a20   {sources_name: 
-00009c40: 736f 7572 6365 735f 6c61 7965 727d 0a20  sources_layer}. 
-00009c50: 2020 2064 6570 656e 6465 6e63 6965 733a     dependencies:
-00009c60: 2064 6963 745b 7374 722c 2073 6574 5b73   dict[str, set[s
-00009c70: 7472 5d5d 203d 207b 736f 7572 6365 735f  tr]] = {sources_
-00009c80: 6e61 6d65 3a20 7365 7428 297d 0a0a 2020  name: set()}..  
-00009c90: 2020 2320 4f70 7469 6d69 7a65 2061 6c6c    # Optimize all
-00009ca0: 2074 6172 6765 7473 2074 6f67 6574 6865   targets togethe
-00009cb0: 720a 2020 2020 7461 7267 6574 735f 6b65  r.    targets_ke
-00009cc0: 7973 203d 205b 5d0a 2020 2020 7461 7267  ys = [].    targ
-00009cd0: 6574 735f 6473 6b73 203d 205b 5d0a 2020  ets_dsks = [].  
-00009ce0: 2020 666f 7220 7420 696e 2074 6172 6765    for t in targe
-00009cf0: 7473 3a0a 2020 2020 2020 2020 6966 2069  ts:.        if i
-00009d00: 7369 6e73 7461 6e63 6528 742c 2044 656c  sinstance(t, Del
-00009d10: 6179 6564 293a 0a20 2020 2020 2020 2020  ayed):.         
-00009d20: 2020 2074 6172 6765 7473 5f6b 6579 732e     targets_keys.
-00009d30: 6170 7065 6e64 2874 2e6b 6579 290a 2020  append(t.key).  
-00009d40: 2020 2020 2020 2020 2020 7461 7267 6574            target
-00009d50: 735f 6473 6b73 2e61 7070 656e 6428 742e  s_dsks.append(t.
-00009d60: 5f5f 6461 736b 5f67 7261 7068 5f5f 2829  __dask_graph__()
-00009d70: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
-00009d80: 735f 6461 736b 5f63 6f6c 6c65 6374 696f  s_dask_collectio
-00009d90: 6e28 7429 3a0a 2020 2020 2020 2020 2020  n(t):.          
-00009da0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-00009db0: 7228 2254 6172 6765 7473 206d 7573 7420  r("Targets must 
-00009dc0: 6265 2065 6974 6865 7220 4465 6c61 7965  be either Delaye
-00009dd0: 6420 6f62 6a65 6374 7320 6f72 2061 7272  d objects or arr
-00009de0: 6179 2d6c 696b 6573 2229 0a0a 2020 2020  ay-likes")..    
-00009df0: 6966 2074 6172 6765 7473 5f64 736b 733a  if targets_dsks:
-00009e00: 0a20 2020 2020 2020 2074 6172 6765 7473  .        targets
-00009e10: 5f68 6c67 203d 2048 6967 684c 6576 656c  _hlg = HighLevel
-00009e20: 4772 6170 682e 6d65 7267 6528 2a74 6172  Graph.merge(*tar
-00009e30: 6765 7473 5f64 736b 7329 0a20 2020 2020  gets_dsks).     
-00009e40: 2020 2074 6172 6765 7473 5f6c 6179 6572     targets_layer
-00009e50: 203d 2044 656c 6179 6564 2e5f 5f64 6173   = Delayed.__das
-00009e60: 6b5f 6f70 7469 6d69 7a65 5f5f 2874 6172  k_optimize__(tar
-00009e70: 6765 7473 5f68 6c67 2c20 7461 7267 6574  gets_hlg, target
-00009e80: 735f 6b65 7973 290a 2020 2020 2020 2020  s_keys).        
-00009e90: 7461 7267 6574 735f 6e61 6d65 203d 2022  targets_name = "
-00009ea0: 7374 6f72 652d 7461 7267 6574 732d 2220  store-targets-" 
-00009eb0: 2b20 746f 6b65 6e69 7a65 2874 6172 6765  + tokenize(targe
-00009ec0: 7473 5f6b 6579 7329 0a20 2020 2020 2020  ts_keys).       
-00009ed0: 206c 6179 6572 735b 7461 7267 6574 735f   layers[targets_
-00009ee0: 6e61 6d65 5d20 3d20 7461 7267 6574 735f  name] = targets_
-00009ef0: 6c61 7965 720a 2020 2020 2020 2020 6465  layer.        de
-00009f00: 7065 6e64 656e 6369 6573 5b74 6172 6765  pendencies[targe
-00009f10: 7473 5f6e 616d 655d 203d 2073 6574 2829  ts_name] = set()
-00009f20: 0a0a 2020 2020 6c6f 6164 5f73 746f 7265  ..    load_store
-00009f30: 6420 3d20 7265 7475 726e 5f73 746f 7265  d = return_store
-00009f40: 6420 616e 6420 6e6f 7420 636f 6d70 7574  d and not comput
-00009f50: 650a 0a20 2020 206d 6170 5f6e 616d 6573  e..    map_names
-00009f60: 203d 205b 0a20 2020 2020 2020 2022 7374   = [.        "st
-00009f70: 6f72 652d 6d61 702d 2220 2b20 746f 6b65  ore-map-" + toke
-00009f80: 6e69 7a65 2873 2c20 7420 6966 2069 7369  nize(s, t if isi
-00009f90: 6e73 7461 6e63 6528 742c 2044 656c 6179  nstance(t, Delay
-00009fa0: 6564 2920 656c 7365 2069 6428 7429 2c20  ed) else id(t), 
-00009fb0: 7229 0a20 2020 2020 2020 2066 6f72 2073  r).        for s
-00009fc0: 2c20 742c 2072 2069 6e20 7a69 7028 736f  , t, r in zip(so
-00009fd0: 7572 6365 732c 2074 6172 6765 7473 2c20  urces, targets, 
-00009fe0: 7265 6769 6f6e 735f 6c69 7374 290a 2020  regions_list).  
-00009ff0: 2020 5d0a 2020 2020 6d61 705f 6b65 7973    ].    map_keys
-0000a000: 3a20 6c69 7374 5b74 7570 6c65 5d20 3d20  : list[tuple] = 
-0000a010: 5b5d 0a0a 2020 2020 666f 7220 732c 2074  []..    for s, t
-0000a020: 2c20 6e2c 2072 2069 6e20 7a69 7028 736f  , n, r in zip(so
-0000a030: 7572 6365 732c 2074 6172 6765 7473 2c20  urces, targets, 
-0000a040: 6d61 705f 6e61 6d65 732c 2072 6567 696f  map_names, regio
-0000a050: 6e73 5f6c 6973 7429 3a0a 2020 2020 2020  ns_list):.      
-0000a060: 2020 6d61 705f 6c61 7965 7220 3d20 696e    map_layer = in
-0000a070: 7365 7274 5f74 6f5f 6f6f 6328 0a20 2020  sert_to_ooc(.   
-0000a080: 2020 2020 2020 2020 206b 6579 733d 732e           keys=s.
-0000a090: 5f5f 6461 736b 5f6b 6579 735f 5f28 292c  __dask_keys__(),
-0000a0a0: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
-0000a0b0: 6e6b 733d 732e 6368 756e 6b73 2c0a 2020  nks=s.chunks,.  
-0000a0c0: 2020 2020 2020 2020 2020 6f75 743d 742e            out=t.
-0000a0d0: 6b65 7920 6966 2069 7369 6e73 7461 6e63  key if isinstanc
-0000a0e0: 6528 742c 2044 656c 6179 6564 2920 656c  e(t, Delayed) el
-0000a0f0: 7365 2074 2c0a 2020 2020 2020 2020 2020  se t,.          
-0000a100: 2020 6e61 6d65 3d6e 2c0a 2020 2020 2020    name=n,.      
-0000a110: 2020 2020 2020 6c6f 636b 3d6c 6f63 6b2c        lock=lock,
-0000a120: 0a20 2020 2020 2020 2020 2020 2072 6567  .            reg
-0000a130: 696f 6e3d 722c 0a20 2020 2020 2020 2020  ion=r,.         
-0000a140: 2020 2072 6574 7572 6e5f 7374 6f72 6564     return_stored
-0000a150: 3d72 6574 7572 6e5f 7374 6f72 6564 2c0a  =return_stored,.
-0000a160: 2020 2020 2020 2020 2020 2020 6c6f 6164              load
-0000a170: 5f73 746f 7265 643d 6c6f 6164 5f73 746f  _stored=load_sto
-0000a180: 7265 642c 0a20 2020 2020 2020 2029 0a20  red,.        ). 
-0000a190: 2020 2020 2020 206c 6179 6572 735b 6e5d         layers[n]
-0000a1a0: 203d 206d 6170 5f6c 6179 6572 0a20 2020   = map_layer.   
-0000a1b0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
-0000a1c0: 6365 2874 2c20 4465 6c61 7965 6429 3a0a  ce(t, Delayed):.
-0000a1d0: 2020 2020 2020 2020 2020 2020 6465 7065              depe
-0000a1e0: 6e64 656e 6369 6573 5b6e 5d20 3d20 7b73  ndencies[n] = {s
-0000a1f0: 6f75 7263 6573 5f6e 616d 652c 2074 6172  ources_name, tar
-0000a200: 6765 7473 5f6e 616d 657d 0a20 2020 2020  gets_name}.     
-0000a210: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000a220: 2020 2020 2064 6570 656e 6465 6e63 6965       dependencie
-0000a230: 735b 6e5d 203d 207b 736f 7572 6365 735f  s[n] = {sources_
-0000a240: 6e61 6d65 7d0a 2020 2020 2020 2020 6d61  name}.        ma
-0000a250: 705f 6b65 7973 202b 3d20 6d61 705f 6c61  p_keys += map_la
-0000a260: 7965 722e 6b65 7973 2829 0a0a 2020 2020  yer.keys()..    
-0000a270: 6966 2072 6574 7572 6e5f 7374 6f72 6564  if return_stored
-0000a280: 3a0a 2020 2020 2020 2020 7374 6f72 655f  :.        store_
-0000a290: 6473 6b20 3d20 4869 6768 4c65 7665 6c47  dsk = HighLevelG
-0000a2a0: 7261 7068 286c 6179 6572 732c 2064 6570  raph(layers, dep
-0000a2b0: 656e 6465 6e63 6965 7329 0a20 2020 2020  endencies).     
-0000a2c0: 2020 206c 6f61 645f 7374 6f72 655f 6473     load_store_ds
-0000a2d0: 6b3a 2048 6967 684c 6576 656c 4772 6170  k: HighLevelGrap
-0000a2e0: 6820 7c20 6469 6374 5b74 7570 6c65 2c20  h | dict[tuple, 
-0000a2f0: 416e 795d 203d 2073 746f 7265 5f64 736b  Any] = store_dsk
-0000a300: 0a20 2020 2020 2020 2069 6620 636f 6d70  .        if comp
-0000a310: 7574 653a 0a20 2020 2020 2020 2020 2020  ute:.           
-0000a320: 2073 746f 7265 5f64 6c79 6473 203d 205b   store_dlyds = [
-0000a330: 4465 6c61 7965 6428 6b2c 2073 746f 7265  Delayed(k, store
-0000a340: 5f64 736b 2c20 6c61 7965 723d 6b5b 305d  _dsk, layer=k[0]
-0000a350: 2920 666f 7220 6b20 696e 206d 6170 5f6b  ) for k in map_k
-0000a360: 6579 735d 0a20 2020 2020 2020 2020 2020  eys].           
-0000a370: 2073 746f 7265 5f64 6c79 6473 203d 2070   store_dlyds = p
-0000a380: 6572 7369 7374 282a 7374 6f72 655f 646c  ersist(*store_dl
-0000a390: 7964 732c 202a 2a6b 7761 7267 7329 0a20  yds, **kwargs). 
-0000a3a0: 2020 2020 2020 2020 2020 2073 746f 7265             store
-0000a3b0: 5f64 736b 5f32 203d 2048 6967 684c 6576  _dsk_2 = HighLev
-0000a3c0: 656c 4772 6170 682e 6d65 7267 6528 2a5b  elGraph.merge(*[
-0000a3d0: 652e 6461 736b 2066 6f72 2065 2069 6e20  e.dask for e in 
-0000a3e0: 7374 6f72 655f 646c 7964 735d 290a 2020  store_dlyds]).  
-0000a3f0: 2020 2020 2020 2020 2020 6c6f 6164 5f73            load_s
-0000a400: 746f 7265 5f64 736b 203d 2072 6574 7269  tore_dsk = retri
-0000a410: 6576 655f 6672 6f6d 5f6f 6f63 286d 6170  eve_from_ooc(map
-0000a420: 5f6b 6579 732c 2073 746f 7265 5f64 736b  _keys, store_dsk
-0000a430: 2c20 7374 6f72 655f 6473 6b5f 3229 0a20  , store_dsk_2). 
-0000a440: 2020 2020 2020 2020 2020 206d 6170 5f6e             map_n
-0000a450: 616d 6573 203d 205b 226c 6f61 642d 2220  ames = ["load-" 
-0000a460: 2b20 6e20 666f 7220 6e20 696e 206d 6170  + n for n in map
-0000a470: 5f6e 616d 6573 5d0a 0a20 2020 2020 2020  _names]..       
-0000a480: 2072 6574 7572 6e20 7475 706c 6528 0a20   return tuple(. 
-0000a490: 2020 2020 2020 2020 2020 2041 7272 6179             Array
-0000a4a0: 286c 6f61 645f 7374 6f72 655f 6473 6b2c  (load_store_dsk,
-0000a4b0: 206e 2c20 732e 6368 756e 6b73 2c20 6d65   n, s.chunks, me
-0000a4c0: 7461 3d73 290a 2020 2020 2020 2020 2020  ta=s).          
-0000a4d0: 2020 666f 7220 732c 206e 2069 6e20 7a69    for s, n in zi
-0000a4e0: 7028 736f 7572 6365 732c 206d 6170 5f6e  p(sources, map_n
-0000a4f0: 616d 6573 290a 2020 2020 2020 2020 290a  ames).        ).
-0000a500: 0a20 2020 2065 6c69 6620 636f 6d70 7574  .    elif comput
-0000a510: 653a 0a20 2020 2020 2020 2073 746f 7265  e:.        store
-0000a520: 5f64 736b 203d 2048 6967 684c 6576 656c  _dsk = HighLevel
-0000a530: 4772 6170 6828 6c61 7965 7273 2c20 6465  Graph(layers, de
-0000a540: 7065 6e64 656e 6369 6573 290a 2020 2020  pendencies).    
-0000a550: 2020 2020 636f 6d70 7574 655f 6173 5f69      compute_as_i
-0000a560: 665f 636f 6c6c 6563 7469 6f6e 2841 7272  f_collection(Arr
-0000a570: 6179 2c20 7374 6f72 655f 6473 6b2c 206d  ay, store_dsk, m
-0000a580: 6170 5f6b 6579 732c 202a 2a6b 7761 7267  ap_keys, **kwarg
-0000a590: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
-0000a5a0: 6e20 4e6f 6e65 0a0a 2020 2020 656c 7365  n None..    else
-0000a5b0: 3a0a 2020 2020 2020 2020 6b65 7920 3d20  :.        key = 
-0000a5c0: 2273 746f 7265 2d22 202b 2074 6f6b 656e  "store-" + token
-0000a5d0: 697a 6528 6d61 705f 6e61 6d65 7329 0a20  ize(map_names). 
-0000a5e0: 2020 2020 2020 206c 6179 6572 735b 6b65         layers[ke
-0000a5f0: 795d 203d 207b 6b65 793a 206d 6170 5f6b  y] = {key: map_k
-0000a600: 6579 737d 0a20 2020 2020 2020 2064 6570  eys}.        dep
-0000a610: 656e 6465 6e63 6965 735b 6b65 795d 203d  endencies[key] =
-0000a620: 2073 6574 286d 6170 5f6e 616d 6573 290a   set(map_names).
-0000a630: 2020 2020 2020 2020 7374 6f72 655f 6473          store_ds
-0000a640: 6b20 3d20 4869 6768 4c65 7665 6c47 7261  k = HighLevelGra
-0000a650: 7068 286c 6179 6572 732c 2064 6570 656e  ph(layers, depen
-0000a660: 6465 6e63 6965 7329 0a20 2020 2020 2020  dencies).       
-0000a670: 2072 6574 7572 6e20 4465 6c61 7965 6428   return Delayed(
-0000a680: 6b65 792c 2073 746f 7265 5f64 736b 290a  key, store_dsk).
-0000a690: 0a0a 6465 6620 626c 6f63 6b64 696d 735f  ..def blockdims_
-0000a6a0: 6672 6f6d 5f62 6c6f 636b 7368 6170 6528  from_blockshape(
-0000a6b0: 7368 6170 652c 2063 6875 6e6b 7329 3a0a  shape, chunks):.
-0000a6c0: 2020 2020 2222 220a 0a20 2020 203e 3e3e      """..    >>>
-0000a6d0: 2062 6c6f 636b 6469 6d73 5f66 726f 6d5f   blockdims_from_
-0000a6e0: 626c 6f63 6b73 6861 7065 2828 3130 2c20  blockshape((10, 
-0000a6f0: 3130 292c 2028 342c 2033 2929 0a20 2020  10), (4, 3)).   
-0000a700: 2028 2834 2c20 342c 2032 292c 2028 332c   ((4, 4, 2), (3,
-0000a710: 2033 2c20 332c 2031 2929 0a20 2020 203e   3, 3, 1)).    >
-0000a720: 3e3e 2062 6c6f 636b 6469 6d73 5f66 726f  >> blockdims_fro
-0000a730: 6d5f 626c 6f63 6b73 6861 7065 2828 3130  m_blockshape((10
-0000a740: 2c20 3029 2c20 2834 2c20 3029 290a 2020  , 0), (4, 0)).  
-0000a750: 2020 2828 342c 2034 2c20 3229 2c20 2830    ((4, 4, 2), (0
-0000a760: 2c29 290a 2020 2020 2222 220a 2020 2020  ,)).    """.    
-0000a770: 6966 2063 6875 6e6b 7320 6973 204e 6f6e  if chunks is Non
-0000a780: 653a 0a20 2020 2020 2020 2072 6169 7365  e:.        raise
-0000a790: 2054 7970 6545 7272 6f72 2822 4d75 7374   TypeError("Must
-0000a7a0: 2073 7570 706c 7920 6368 756e 6b73 3d20   supply chunks= 
-0000a7b0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-0000a7c0: 2229 0a20 2020 2069 6620 7368 6170 6520  ").    if shape 
-0000a7d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000a7e0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
-0000a7f0: 2822 4d75 7374 2073 7570 706c 7920 7368  ("Must supply sh
-0000a800: 6170 653d 206b 6579 776f 7264 2061 7267  ape= keyword arg
-0000a810: 756d 656e 7422 290a 2020 2020 6966 206e  ument").    if n
-0000a820: 702e 6973 6e61 6e28 7375 6d28 7368 6170  p.isnan(sum(shap
-0000a830: 6529 2920 6f72 206e 702e 6973 6e61 6e28  e)) or np.isnan(
-0000a840: 7375 6d28 6368 756e 6b73 2929 3a0a 2020  sum(chunks)):.  
-0000a850: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0000a860: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0000a870: 2020 2020 2241 7272 6179 2063 6875 6e6b      "Array chunk
-0000a880: 2073 697a 6573 2061 7265 2075 6e6b 6e6f   sizes are unkno
-0000a890: 776e 2e20 7368 6170 653a 2025 732c 2063  wn. shape: %s, c
-0000a8a0: 6875 6e6b 733a 2025 7325 7322 0a20 2020  hunks: %s%s".   
-0000a8b0: 2020 2020 2020 2020 2025 2028 7368 6170           % (shap
-0000a8c0: 652c 2063 6875 6e6b 732c 2075 6e6b 6e6f  e, chunks, unkno
-0000a8d0: 776e 5f63 6875 6e6b 5f6d 6573 7361 6765  wn_chunk_message
-0000a8e0: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
-0000a8f0: 6966 206e 6f74 2061 6c6c 286d 6170 2869  if not all(map(i
-0000a900: 735f 696e 7465 6765 722c 2063 6875 6e6b  s_integer, chunk
-0000a910: 7329 293a 0a20 2020 2020 2020 2072 6169  s)):.        rai
-0000a920: 7365 2056 616c 7565 4572 726f 7228 2263  se ValueError("c
-0000a930: 6875 6e6b 7320 6361 6e20 6f6e 6c79 2063  hunks can only c
-0000a940: 6f6e 7461 696e 2069 6e74 6567 6572 732e  ontain integers.
-0000a950: 2229 0a20 2020 2069 6620 6e6f 7420 616c  ").    if not al
-0000a960: 6c28 6d61 7028 6973 5f69 6e74 6567 6572  l(map(is_integer
-0000a970: 2c20 7368 6170 6529 293a 0a20 2020 2020  , shape)):.     
-0000a980: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0000a990: 726f 7228 2273 6861 7065 2063 616e 206f  ror("shape can o
-0000a9a0: 6e6c 7920 636f 6e74 6169 6e20 696e 7465  nly contain inte
-0000a9b0: 6765 7273 2e22 290a 2020 2020 7368 6170  gers.").    shap
-0000a9c0: 6520 3d20 7475 706c 6528 6d61 7028 696e  e = tuple(map(in
-0000a9d0: 742c 2073 6861 7065 2929 0a20 2020 2063  t, shape)).    c
-0000a9e0: 6875 6e6b 7320 3d20 7475 706c 6528 6d61  hunks = tuple(ma
-0000a9f0: 7028 696e 742c 2063 6875 6e6b 7329 290a  p(int, chunks)).
-0000aa00: 2020 2020 7265 7475 726e 2074 7570 6c65      return tuple
-0000aa10: 280a 2020 2020 2020 2020 2828 6264 2c29  (.        ((bd,)
-0000aa20: 202a 2028 6420 2f2f 2062 6429 202b 2028   * (d // bd) + (
-0000aa30: 2864 2025 2062 642c 2920 6966 2064 2025  (d % bd,) if d %
-0000aa40: 2062 6420 656c 7365 2028 2929 2069 6620   bd else ()) if 
-0000aa50: 6420 656c 7365 2028 302c 2929 0a20 2020  d else (0,)).   
-0000aa60: 2020 2020 2066 6f72 2064 2c20 6264 2069       for d, bd i
-0000aa70: 6e20 7a69 7028 7368 6170 652c 2063 6875  n zip(shape, chu
-0000aa80: 6e6b 7329 0a20 2020 2029 0a0a 0a64 6566  nks).    )...def
-0000aa90: 2066 696e 616c 697a 6528 7265 7375 6c74   finalize(result
-0000aaa0: 7329 3a0a 2020 2020 6966 206e 6f74 2072  s):.    if not r
-0000aab0: 6573 756c 7473 3a0a 2020 2020 2020 2020  esults:.        
-0000aac0: 7265 7475 726e 2063 6f6e 6361 7465 6e61  return concatena
-0000aad0: 7465 3328 7265 7375 6c74 7329 0a20 2020  te3(results).   
-0000aae0: 2072 6573 756c 7473 3220 3d20 7265 7375   results2 = resu
-0000aaf0: 6c74 730a 2020 2020 7768 696c 6520 6973  lts.    while is
-0000ab00: 696e 7374 616e 6365 2872 6573 756c 7473  instance(results
-0000ab10: 322c 2028 7475 706c 652c 206c 6973 7429  2, (tuple, list)
-0000ab20: 293a 0a20 2020 2020 2020 2069 6620 6c65  ):.        if le
-0000ab30: 6e28 7265 7375 6c74 7332 2920 3e20 313a  n(results2) > 1:
-0000ab40: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000ab50: 7572 6e20 636f 6e63 6174 656e 6174 6533  urn concatenate3
-0000ab60: 2872 6573 756c 7473 290a 2020 2020 2020  (results).      
-0000ab70: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000ab80: 2020 2020 7265 7375 6c74 7332 203d 2072      results2 = r
-0000ab90: 6573 756c 7473 325b 305d 0a20 2020 2072  esults2[0].    r
-0000aba0: 6574 7572 6e20 756e 7061 636b 5f73 696e  eturn unpack_sin
-0000abb0: 676c 6574 6f6e 2872 6573 756c 7473 290a  gleton(results).
-0000abc0: 0a0a 4348 554e 4b53 5f4e 4f4e 455f 4552  ..CHUNKS_NONE_ER
-0000abd0: 524f 525f 4d45 5353 4147 4520 3d20 2222  ROR_MESSAGE = ""
-0000abe0: 220a 596f 7520 6d75 7374 2073 7065 6369  ".You must speci
-0000abf0: 6679 2061 2063 6875 6e6b 733d 206b 6579  fy a chunks= key
-0000ac00: 776f 7264 2061 7267 756d 656e 742e 0a54  word argument..T
-0000ac10: 6869 7320 7370 6563 6966 6965 7320 7468  his specifies th
-0000ac20: 6520 6368 756e 6b73 697a 6520 6f66 2079  e chunksize of y
-0000ac30: 6f75 7220 6172 7261 7920 626c 6f63 6b73  our array blocks
-0000ac40: 2e0a 0a53 6565 2074 6865 2066 6f6c 6c6f  ...See the follo
-0000ac50: 7769 6e67 2064 6f63 756d 656e 7461 7469  wing documentati
-0000ac60: 6f6e 2070 6167 6520 666f 7220 6465 7461  on page for deta
-0000ac70: 696c 733a 0a20 2068 7474 7073 3a2f 2f64  ils:.  https://d
-0000ac80: 6f63 732e 6461 736b 2e6f 7267 2f65 6e2f  ocs.dask.org/en/
-0000ac90: 6c61 7465 7374 2f61 7272 6179 2d63 7265  latest/array-cre
-0000aca0: 6174 696f 6e2e 6874 6d6c 2363 6875 6e6b  ation.html#chunk
-0000acb0: 730a 2222 222e 7374 7269 7028 290a 0a0a  s.""".strip()...
-0000acc0: 636c 6173 7320 4172 7261 7928 4461 736b  class Array(Dask
-0000acd0: 4d65 7468 6f64 734d 6978 696e 293a 0a20  MethodsMixin):. 
-0000ace0: 2020 2022 2222 5061 7261 6c6c 656c 2044     """Parallel D
-0000acf0: 6173 6b20 4172 7261 790a 0a20 2020 2041  ask Array..    A
-0000ad00: 2070 6172 616c 6c65 6c20 6e64 2d61 7272   parallel nd-arr
-0000ad10: 6179 2063 6f6d 7072 6973 6564 206f 6620  ay comprised of 
-0000ad20: 6d61 6e79 206e 756d 7079 2061 7272 6179  many numpy array
-0000ad30: 7320 6172 7261 6e67 6564 2069 6e20 6120  s arranged in a 
-0000ad40: 6772 6964 2e0a 0a20 2020 2054 6869 7320  grid...    This 
-0000ad50: 636f 6e73 7472 7563 746f 7220 6973 2066  constructor is f
-0000ad60: 6f72 2061 6476 616e 6365 6420 7573 6573  or advanced uses
-0000ad70: 206f 6e6c 792e 2020 466f 7220 6e6f 726d   only.  For norm
-0000ad80: 616c 2075 7365 2073 6565 2074 6865 0a20  al use see the. 
-0000ad90: 2020 203a 6675 6e63 3a60 6461 736b 2e61     :func:`dask.a
-0000ada0: 7272 6179 2e66 726f 6d5f 6172 7261 7960  rray.from_array`
-0000adb0: 2066 756e 6374 696f 6e2e 0a0a 2020 2020   function...    
-0000adc0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0000add0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6461  ---------.    da
-0000ade0: 736b 203a 2064 6963 740a 2020 2020 2020  sk : dict.      
-0000adf0: 2020 5461 736b 2064 6570 656e 6465 6e63    Task dependenc
-0000ae00: 7920 6772 6170 680a 2020 2020 6e61 6d65  y graph.    name
-0000ae10: 203a 2073 7472 696e 670a 2020 2020 2020   : string.      
-0000ae20: 2020 4e61 6d65 206f 6620 6172 7261 7920    Name of array 
-0000ae30: 696e 2064 6173 6b0a 2020 2020 7368 6170  in dask.    shap
-0000ae40: 6520 3a20 7475 706c 6520 6f66 2069 6e74  e : tuple of int
-0000ae50: 730a 2020 2020 2020 2020 5368 6170 6520  s.        Shape 
-0000ae60: 6f66 2074 6865 2065 6e74 6972 6520 6172  of the entire ar
-0000ae70: 7261 790a 2020 2020 6368 756e 6b73 3a20  ray.    chunks: 
-0000ae80: 6974 6572 6162 6c65 206f 6620 7475 706c  iterable of tupl
-0000ae90: 6573 0a20 2020 2020 2020 2062 6c6f 636b  es.        block
-0000aea0: 2073 697a 6573 2061 6c6f 6e67 2065 6163   sizes along eac
-0000aeb0: 6820 6469 6d65 6e73 696f 6e0a 2020 2020  h dimension.    
-0000aec0: 6474 7970 6520 3a20 7374 7220 6f72 2064  dtype : str or d
-0000aed0: 7479 7065 0a20 2020 2020 2020 2054 7970  type.        Typ
-0000aee0: 6563 6f64 6520 6f72 2064 6174 612d 7479  ecode or data-ty
-0000aef0: 7065 2066 6f72 2074 6865 206e 6577 2044  pe for the new D
-0000af00: 6173 6b20 4172 7261 790a 2020 2020 6d65  ask Array.    me
-0000af10: 7461 203a 2065 6d70 7479 206e 6461 7272  ta : empty ndarr
-0000af20: 6179 0a20 2020 2020 2020 2065 6d70 7479  ay.        empty
-0000af30: 206e 6461 7272 6179 2063 7265 6174 6564   ndarray created
-0000af40: 2077 6974 6820 7361 6d65 204e 756d 5079   with same NumPy
-0000af50: 2062 6163 6b65 6e64 2c20 6e64 696d 2061   backend, ndim a
-0000af60: 6e64 2064 7479 7065 2061 7320 7468 650a  nd dtype as the.
-0000af70: 2020 2020 2020 2020 4461 736b 2041 7272          Dask Arr
-0000af80: 6179 2062 6569 6e67 2063 7265 6174 6564  ay being created
-0000af90: 2028 6f76 6572 7269 6465 7320 6474 7970   (overrides dtyp
-0000afa0: 6529 0a0a 2020 2020 5365 6520 416c 736f  e)..    See Also
-0000afb0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-0000afc0: 2020 6461 736b 2e61 7272 6179 2e66 726f    dask.array.fro
-0000afd0: 6d5f 6172 7261 790a 2020 2020 2222 220a  m_array.    """.
-0000afe0: 0a20 2020 205f 5f73 6c6f 7473 5f5f 203d  .    __slots__ =
-0000aff0: 2022 6461 736b 222c 2022 5f5f 6e61 6d65   "dask", "__name
-0000b000: 222c 2022 5f63 6163 6865 645f 6b65 7973  ", "_cached_keys
-0000b010: 222c 2022 5f5f 6368 756e 6b73 222c 2022  ", "__chunks", "
-0000b020: 5f6d 6574 6122 2c20 225f 5f64 6963 745f  _meta", "__dict_
-0000b030: 5f22 0a0a 2020 2020 6465 6620 5f5f 6e65  _"..    def __ne
-0000b040: 775f 5f28 636c 732c 2064 6173 6b2c 206e  w__(cls, dask, n
-0000b050: 616d 652c 2063 6875 6e6b 732c 2064 7479  ame, chunks, dty
-0000b060: 7065 3d4e 6f6e 652c 206d 6574 613d 4e6f  pe=None, meta=No
-0000b070: 6e65 2c20 7368 6170 653d 4e6f 6e65 293a  ne, shape=None):
-0000b080: 0a20 2020 2020 2020 2073 656c 6620 3d20  .        self = 
-0000b090: 7375 7065 7228 292e 5f5f 6e65 775f 5f28  super().__new__(
-0000b0a0: 636c 7329 0a20 2020 2020 2020 2061 7373  cls).        ass
-0000b0b0: 6572 7420 6973 696e 7374 616e 6365 2864  ert isinstance(d
-0000b0c0: 6173 6b2c 204d 6170 7069 6e67 290a 2020  ask, Mapping).  
-0000b0d0: 2020 2020 2020 6966 206e 6f74 2069 7369        if not isi
-0000b0e0: 6e73 7461 6e63 6528 6461 736b 2c20 4869  nstance(dask, Hi
-0000b0f0: 6768 4c65 7665 6c47 7261 7068 293a 0a20  ghLevelGraph):. 
-0000b100: 2020 2020 2020 2020 2020 2064 6173 6b20             dask 
-0000b110: 3d20 4869 6768 4c65 7665 6c47 7261 7068  = HighLevelGraph
-0000b120: 2e66 726f 6d5f 636f 6c6c 6563 7469 6f6e  .from_collection
-0000b130: 7328 6e61 6d65 2c20 6461 736b 2c20 6465  s(name, dask, de
-0000b140: 7065 6e64 656e 6369 6573 3d28 2929 0a20  pendencies=()). 
-0000b150: 2020 2020 2020 2073 656c 662e 6461 736b         self.dask
-0000b160: 203d 2064 6173 6b0a 2020 2020 2020 2020   = dask.        
-0000b170: 7365 6c66 2e5f 6e61 6d65 203d 2073 7472  self._name = str
-0000b180: 286e 616d 6529 0a20 2020 2020 2020 206d  (name).        m
-0000b190: 6574 6120 3d20 6d65 7461 5f66 726f 6d5f  eta = meta_from_
-0000b1a0: 6172 7261 7928 6d65 7461 2c20 6474 7970  array(meta, dtyp
-0000b1b0: 653d 6474 7970 6529 0a0a 2020 2020 2020  e=dtype)..      
-0000b1c0: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
-0000b1d0: 2020 2069 7369 6e73 7461 6e63 6528 6368     isinstance(ch
-0000b1e0: 756e 6b73 2c20 7374 7229 0a20 2020 2020  unks, str).     
-0000b1f0: 2020 2020 2020 206f 7220 6973 696e 7374         or isinst
-0000b200: 616e 6365 2863 6875 6e6b 732c 2074 7570  ance(chunks, tup
-0000b210: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-0000b220: 616e 6420 6368 756e 6b73 0a20 2020 2020  and chunks.     
-0000b230: 2020 2020 2020 2061 6e64 2061 6e79 2869         and any(i
-0000b240: 7369 6e73 7461 6e63 6528 632c 2073 7472  sinstance(c, str
-0000b250: 2920 666f 7220 6320 696e 2063 6875 6e6b  ) for c in chunk
-0000b260: 7329 0a20 2020 2020 2020 2029 3a0a 2020  s).        ):.  
-0000b270: 2020 2020 2020 2020 2020 6474 203d 206d            dt = m
-0000b280: 6574 612e 6474 7970 650a 2020 2020 2020  eta.dtype.      
-0000b290: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000b2a0: 2020 2020 6474 203d 204e 6f6e 650a 2020      dt = None.  
-0000b2b0: 2020 2020 2020 7365 6c66 2e5f 6368 756e        self._chun
-0000b2c0: 6b73 203d 206e 6f72 6d61 6c69 7a65 5f63  ks = normalize_c
-0000b2d0: 6875 6e6b 7328 6368 756e 6b73 2c20 7368  hunks(chunks, sh
-0000b2e0: 6170 652c 2064 7479 7065 3d64 7429 0a20  ape, dtype=dt). 
-0000b2f0: 2020 2020 2020 2069 6620 7365 6c66 2e63         if self.c
-0000b300: 6875 6e6b 7320 6973 204e 6f6e 653a 0a20  hunks is None:. 
-0000b310: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000b320: 2056 616c 7565 4572 726f 7228 4348 554e   ValueError(CHUN
-0000b330: 4b53 5f4e 4f4e 455f 4552 524f 525f 4d45  KS_NONE_ERROR_ME
-0000b340: 5353 4147 4529 0a20 2020 2020 2020 2073  SSAGE).        s
-0000b350: 656c 662e 5f6d 6574 6120 3d20 6d65 7461  elf._meta = meta
-0000b360: 5f66 726f 6d5f 6172 7261 7928 6d65 7461  _from_array(meta
-0000b370: 2c20 6e64 696d 3d73 656c 662e 6e64 696d  , ndim=self.ndim
-0000b380: 2c20 6474 7970 653d 6474 7970 6529 0a0a  , dtype=dtype)..
-0000b390: 2020 2020 2020 2020 666f 7220 706c 7567          for plug
-0000b3a0: 696e 2069 6e20 636f 6e66 6967 2e67 6574  in in config.get
-0000b3b0: 2822 6172 7261 795f 706c 7567 696e 7322  ("array_plugins"
-0000b3c0: 2c20 2829 293a 0a20 2020 2020 2020 2020  , ()):.         
-0000b3d0: 2020 2072 6573 756c 7420 3d20 706c 7567     result = plug
-0000b3e0: 696e 2873 656c 6629 0a20 2020 2020 2020  in(self).       
-0000b3f0: 2020 2020 2069 6620 7265 7375 6c74 2069       if result i
-0000b400: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0000b410: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-0000b420: 203d 2072 6573 756c 740a 0a20 2020 2020   = result..     
-0000b430: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000b440: 2020 2020 6c61 7965 7220 3d20 7365 6c66      layer = self
-0000b450: 2e64 6173 6b2e 6c61 7965 7273 5b6e 616d  .dask.layers[nam
-0000b460: 655d 0a20 2020 2020 2020 2065 7863 6570  e].        excep
-0000b470: 7420 2841 7474 7269 6275 7465 4572 726f  t (AttributeErro
-0000b480: 722c 204b 6579 4572 726f 7229 3a0a 2020  r, KeyError):.  
-0000b490: 2020 2020 2020 2020 2020 2320 7365 6c66            # self
-0000b4a0: 2069 7320 6e6f 206c 6f6e 6765 7220 616e   is no longer an
-0000b4b0: 2041 7272 6179 2061 6674 6572 2061 7070   Array after app
-0000b4c0: 6c79 696e 6720 7468 6520 706c 7567 696e  lying the plugin
-0000b4d0: 732c 204f 520a 2020 2020 2020 2020 2020  s, OR.          
-0000b4e0: 2020 2320 6120 706c 7567 696e 2072 6570    # a plugin rep
-0000b4f0: 6c61 6365 6420 7468 6520 4869 6768 4c65  laced the HighLe
-0000b500: 7665 6c47 7261 7068 2077 6974 6820 6120  velGraph with a 
-0000b510: 706c 6169 6e20 6469 6374 2c20 4f52 0a20  plain dict, OR. 
-0000b520: 2020 2020 2020 2020 2020 2023 206e 616d             # nam
-0000b530: 6520 6973 206e 6f74 2074 6865 2074 6f70  e is not the top
-0000b540: 206c 6179 6572 2773 206e 616d 6520 2874   layer's name (t
-0000b550: 6869 7320 6361 6e20 6861 7070 656e 2061  his can happen a
-0000b560: 6674 6572 2074 6865 206c 6179 6572 2069  fter the layer i
-0000b570: 730a 2020 2020 2020 2020 2020 2020 2320  s.            # 
-0000b580: 6d61 6e69 7075 6c61 7465 642c 2074 6f20  manipulated, to 
-0000b590: 6176 6f69 6420 6120 636f 6c6c 6973 696f  avoid a collisio
-0000b5a0: 6e29 0a20 2020 2020 2020 2020 2020 2070  n).            p
-0000b5b0: 6173 730a 2020 2020 2020 2020 656c 7365  ass.        else
-0000b5c0: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000b5d0: 206c 6179 6572 2e63 6f6c 6c65 6374 696f   layer.collectio
-0000b5e0: 6e5f 616e 6e6f 7461 7469 6f6e 7320 6973  n_annotations is
-0000b5f0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-0000b600: 2020 2020 2020 206c 6179 6572 2e63 6f6c         layer.col
-0000b610: 6c65 6374 696f 6e5f 616e 6e6f 7461 7469  lection_annotati
-0000b620: 6f6e 7320 3d20 7b0a 2020 2020 2020 2020  ons = {.        
-0000b630: 2020 2020 2020 2020 2020 2020 2273 6861              "sha
-0000b640: 7065 223a 2073 656c 662e 7368 6170 652c  pe": self.shape,
-0000b650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b660: 2020 2020 2022 6474 7970 6522 3a20 7365       "dtype": se
-0000b670: 6c66 2e64 7479 7065 2c0a 2020 2020 2020  lf.dtype,.      
-0000b680: 2020 2020 2020 2020 2020 2020 2020 2263                "c
-0000b690: 6875 6e6b 7369 7a65 223a 2073 656c 662e  hunksize": self.
-0000b6a0: 6368 756e 6b73 697a 652c 0a20 2020 2020  chunksize,.     
-0000b6b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000b6c0: 6368 756e 6b73 223a 2073 656c 662e 6368  chunks": self.ch
-0000b6d0: 756e 6b73 2c0a 2020 2020 2020 2020 2020  unks,.          
-0000b6e0: 2020 2020 2020 2020 2020 2274 7970 6522            "type"
-0000b6f0: 3a20 7479 7065 6e61 6d65 2874 7970 6528  : typename(type(
-0000b700: 7365 6c66 2929 2c0a 2020 2020 2020 2020  self)),.        
-0000b710: 2020 2020 2020 2020 2020 2020 2263 6875              "chu
-0000b720: 6e6b 5f74 7970 6522 3a20 7479 7065 6e61  nk_type": typena
-0000b730: 6d65 2874 7970 6528 7365 6c66 2e5f 6d65  me(type(self._me
-0000b740: 7461 2929 2c0a 2020 2020 2020 2020 2020  ta)),.          
-0000b750: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-0000b760: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000b770: 2020 2020 2020 2020 2020 6c61 7965 722e            layer.
-0000b780: 636f 6c6c 6563 7469 6f6e 5f61 6e6e 6f74  collection_annot
-0000b790: 6174 696f 6e73 2e75 7064 6174 6528 0a20  ations.update(. 
-0000b7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7b0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-0000b7c0: 2020 2020 2020 2020 2020 2020 2022 7368               "sh
-0000b7d0: 6170 6522 3a20 7365 6c66 2e73 6861 7065  ape": self.shape
-0000b7e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000b7f0: 2020 2020 2020 2020 2020 2264 7479 7065            "dtype
-0000b800: 223a 2073 656c 662e 6474 7970 652c 0a20  ": self.dtype,. 
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b820: 2020 2020 2020 2022 6368 756e 6b73 697a         "chunksiz
-0000b830: 6522 3a20 7365 6c66 2e63 6875 6e6b 7369  e": self.chunksi
-0000b840: 7a65 2c0a 2020 2020 2020 2020 2020 2020  ze,.            
-0000b850: 2020 2020 2020 2020 2020 2020 2263 6875              "chu
-0000b860: 6e6b 7322 3a20 7365 6c66 2e63 6875 6e6b  nks": self.chunk
-0000b870: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0000b880: 2020 2020 2020 2020 2020 2022 7479 7065             "type
-0000b890: 223a 2074 7970 656e 616d 6528 7479 7065  ": typename(type
-0000b8a0: 2873 656c 6629 292c 0a20 2020 2020 2020  (self)),.       
-0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8c0: 2022 6368 756e 6b5f 7479 7065 223a 2074   "chunk_type": t
-0000b8d0: 7970 656e 616d 6528 7479 7065 2873 656c  ypename(type(sel
-0000b8e0: 662e 5f6d 6574 6129 292c 0a20 2020 2020  f._meta)),.     
-0000b8f0: 2020 2020 2020 2020 2020 2020 2020 207d                 }
-0000b900: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b910: 2029 0a0a 2020 2020 2020 2020 7265 7475   )..        retu
-0000b920: 726e 2073 656c 660a 0a20 2020 2064 6566  rn self..    def
-0000b930: 205f 5f72 6564 7563 655f 5f28 7365 6c66   __reduce__(self
-0000b940: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-0000b950: 6e20 2841 7272 6179 2c20 2873 656c 662e  n (Array, (self.
-0000b960: 6461 736b 2c20 7365 6c66 2e6e 616d 652c  dask, self.name,
-0000b970: 2073 656c 662e 6368 756e 6b73 2c20 7365   self.chunks, se
-0000b980: 6c66 2e64 7479 7065 2c20 7365 6c66 2e5f  lf.dtype, self._
-0000b990: 6d65 7461 2929 0a0a 2020 2020 6465 6620  meta))..    def 
-0000b9a0: 5f5f 6461 736b 5f67 7261 7068 5f5f 2873  __dask_graph__(s
-0000b9b0: 656c 6629 202d 3e20 4772 6170 683a 0a20  elf) -> Graph:. 
-0000b9c0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000b9d0: 6c66 2e64 6173 6b0a 0a20 2020 2064 6566  lf.dask..    def
-0000b9e0: 205f 5f64 6173 6b5f 6c61 7965 7273 5f5f   __dask_layers__
-0000b9f0: 2873 656c 6629 202d 3e20 5365 7175 656e  (self) -> Sequen
-0000ba00: 6365 5b73 7472 5d3a 0a20 2020 2020 2020  ce[str]:.       
-0000ba10: 2072 6574 7572 6e20 2873 656c 662e 6e61   return (self.na
-0000ba20: 6d65 2c29 0a0a 2020 2020 6465 6620 5f5f  me,)..    def __
-0000ba30: 6461 736b 5f6b 6579 735f 5f28 7365 6c66  dask_keys__(self
-0000ba40: 2920 2d3e 204e 6573 7465 644b 6579 733a  ) -> NestedKeys:
-0000ba50: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
-0000ba60: 2e5f 6361 6368 6564 5f6b 6579 7320 6973  ._cached_keys is
-0000ba70: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-0000ba80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-0000ba90: 6c66 2e5f 6361 6368 6564 5f6b 6579 730a  lf._cached_keys.
-0000baa0: 0a20 2020 2020 2020 206e 616d 652c 2063  .        name, c
-0000bab0: 6875 6e6b 732c 206e 756d 626c 6f63 6b73  hunks, numblocks
-0000bac0: 203d 2073 656c 662e 6e61 6d65 2c20 7365   = self.name, se
-0000bad0: 6c66 2e63 6875 6e6b 732c 2073 656c 662e  lf.chunks, self.
-0000bae0: 6e75 6d62 6c6f 636b 730a 0a20 2020 2020  numblocks..     
-0000baf0: 2020 2064 6566 206b 6579 7328 2a61 7267     def keys(*arg
-0000bb00: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000bb10: 6966 206e 6f74 2063 6875 6e6b 733a 0a20  if not chunks:. 
-0000bb20: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000bb30: 6574 7572 6e20 5b28 6e61 6d65 2c29 5d0a  eturn [(name,)].
-0000bb40: 2020 2020 2020 2020 2020 2020 696e 6420              ind 
-0000bb50: 3d20 6c65 6e28 6172 6773 290a 2020 2020  = len(args).    
-0000bb60: 2020 2020 2020 2020 6966 2069 6e64 202b          if ind +
-0000bb70: 2031 203d 3d20 6c65 6e28 6e75 6d62 6c6f   1 == len(numblo
-0000bb80: 636b 7329 3a0a 2020 2020 2020 2020 2020  cks):.          
-0000bb90: 2020 2020 2020 7265 7375 6c74 203d 205b        result = [
-0000bba0: 286e 616d 652c 2920 2b20 6172 6773 202b  (name,) + args +
-0000bbb0: 2028 692c 2920 666f 7220 6920 696e 2072   (i,) for i in r
-0000bbc0: 616e 6765 286e 756d 626c 6f63 6b73 5b69  ange(numblocks[i
-0000bbd0: 6e64 5d29 5d0a 2020 2020 2020 2020 2020  nd])].          
-0000bbe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000bbf0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
-0000bc00: 205b 6b65 7973 282a 2861 7267 7320 2b20   [keys(*(args + 
-0000bc10: 2869 2c29 2929 2066 6f72 2069 2069 6e20  (i,))) for i in 
-0000bc20: 7261 6e67 6528 6e75 6d62 6c6f 636b 735b  range(numblocks[
-0000bc30: 696e 645d 295d 0a20 2020 2020 2020 2020  ind])].         
-0000bc40: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
-0000bc50: 0a0a 2020 2020 2020 2020 7365 6c66 2e5f  ..        self._
-0000bc60: 6361 6368 6564 5f6b 6579 7320 3d20 7265  cached_keys = re
-0000bc70: 7375 6c74 203d 206b 6579 7328 290a 2020  sult = keys().  
-0000bc80: 2020 2020 2020 7265 7475 726e 2072 6573        return res
-0000bc90: 756c 740a 0a20 2020 2064 6566 205f 5f64  ult..    def __d
-0000bca0: 6173 6b5f 746f 6b65 6e69 7a65 5f5f 2873  ask_tokenize__(s
-0000bcb0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0000bcc0: 7475 726e 2073 656c 662e 6e61 6d65 0a0a  turn self.name..
-0000bcd0: 2020 2020 5f5f 6461 736b 5f6f 7074 696d      __dask_optim
-0000bce0: 697a 655f 5f20 3d20 676c 6f62 616c 6d65  ize__ = globalme
-0000bcf0: 7468 6f64 280a 2020 2020 2020 2020 6f70  thod(.        op
-0000bd00: 7469 6d69 7a65 2c20 6b65 793d 2261 7272  timize, key="arr
-0000bd10: 6179 5f6f 7074 696d 697a 6522 2c20 6661  ay_optimize", fa
-0000bd20: 6c73 6579 3d64 6f6e 745f 6f70 7469 6d69  lsey=dont_optimi
-0000bd30: 7a65 0a20 2020 2029 0a20 2020 205f 5f64  ze.    ).    __d
-0000bd40: 6173 6b5f 7363 6865 6475 6c65 725f 5f20  ask_scheduler__ 
-0000bd50: 3d20 7374 6174 6963 6d65 7468 6f64 2844  = staticmethod(D
-0000bd60: 4546 4155 4c54 5f47 4554 290a 0a20 2020  EFAULT_GET)..   
-0000bd70: 2064 6566 205f 5f64 6173 6b5f 706f 7374   def __dask_post
-0000bd80: 636f 6d70 7574 655f 5f28 7365 6c66 293a  compute__(self):
-0000bd90: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000bda0: 6669 6e61 6c69 7a65 2c20 2829 0a0a 2020  finalize, ()..  
-0000bdb0: 2020 6465 6620 5f5f 6461 736b 5f70 6f73    def __dask_pos
-0000bdc0: 7470 6572 7369 7374 5f5f 2873 656c 6629  tpersist__(self)
-0000bdd0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000bde0: 2073 656c 662e 5f72 6562 7569 6c64 2c20   self._rebuild, 
-0000bdf0: 2829 0a0a 2020 2020 6465 6620 5f72 6562  ()..    def _reb
-0000be00: 7569 6c64 2873 656c 662c 2064 736b 2c20  uild(self, dsk, 
-0000be10: 2a2c 2072 656e 616d 653d 4e6f 6e65 293a  *, rename=None):
-0000be20: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-0000be30: 7365 6c66 2e5f 6e61 6d65 0a20 2020 2020  self._name.     
-0000be40: 2020 2069 6620 7265 6e61 6d65 3a0a 2020     if rename:.  
-0000be50: 2020 2020 2020 2020 2020 6e61 6d65 203d            name =
-0000be60: 2072 656e 616d 652e 6765 7428 6e61 6d65   rename.get(name
-0000be70: 2c20 6e61 6d65 290a 2020 2020 2020 2020  , name).        
-0000be80: 7265 7475 726e 2041 7272 6179 2864 736b  return Array(dsk
-0000be90: 2c20 6e61 6d65 2c20 7365 6c66 2e63 6875  , name, self.chu
-0000bea0: 6e6b 732c 2073 656c 662e 6474 7970 652c  nks, self.dtype,
-0000beb0: 2073 656c 662e 5f6d 6574 6129 0a0a 2020   self._meta)..  
-0000bec0: 2020 6465 6620 5f72 6573 6574 5f63 6163    def _reset_cac
-0000bed0: 6865 2873 656c 662c 206b 6579 3d4e 6f6e  he(self, key=Non
-0000bee0: 6529 3a0a 2020 2020 2020 2020 2222 220a  e):.        """.
-0000bef0: 2020 2020 2020 2020 5265 7365 7420 6361          Reset ca
-0000bf00: 6368 6564 2070 726f 7065 7274 6965 732e  ched properties.
-0000bf10: 0a0a 2020 2020 2020 2020 5061 7261 6d65  ..        Parame
-0000bf20: 7465 7273 0a20 2020 2020 2020 202d 2d2d  ters.        ---
-0000bf30: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-0000bf40: 6b65 7920 3a20 7374 722c 206f 7074 696f  key : str, optio
-0000bf50: 6e61 6c0a 2020 2020 2020 2020 2020 2020  nal.            
-0000bf60: 5265 6d6f 7665 2073 7065 6369 6669 6564  Remove specified
-0000bf70: 206b 6579 2e20 5468 6520 6465 6661 756c   key. The defaul
-0000bf80: 7420 7265 6d6f 7665 7320 616c 6c20 6974  t removes all it
-0000bf90: 656d 732e 0a20 2020 2020 2020 2022 2222  ems..        """
-0000bfa0: 0a20 2020 2020 2020 2069 6620 6b65 7920  .        if key 
-0000bfb0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0000bfc0: 2020 2020 2073 656c 662e 5f5f 6469 6374       self.__dict
-0000bfd0: 5f5f 2e63 6c65 6172 2829 0a20 2020 2020  __.clear().     
-0000bfe0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000bff0: 2020 2020 2073 656c 662e 5f5f 6469 6374       self.__dict
-0000c000: 5f5f 2e70 6f70 286b 6579 2c20 4e6f 6e65  __.pop(key, None
-0000c010: 290a 0a20 2020 2040 6361 6368 6564 5f70  )..    @cached_p
-0000c020: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-0000c030: 5f6b 6579 5f61 7272 6179 2873 656c 6629  _key_array(self)
-0000c040: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000c050: 206e 702e 6172 7261 7928 7365 6c66 2e5f   np.array(self._
-0000c060: 5f64 6173 6b5f 6b65 7973 5f5f 2829 2c20  _dask_keys__(), 
-0000c070: 6474 7970 653d 6f62 6a65 6374 290a 0a20  dtype=object).. 
-0000c080: 2020 2040 6361 6368 6564 5f70 726f 7065     @cached_prope
-0000c090: 7274 790a 2020 2020 6465 6620 6e75 6d62  rty.    def numb
-0000c0a0: 6c6f 636b 7328 7365 6c66 293a 0a20 2020  locks(self):.   
-0000c0b0: 2020 2020 2072 6574 7572 6e20 7475 706c       return tupl
-0000c0c0: 6528 6d61 7028 6c65 6e2c 2073 656c 662e  e(map(len, self.
-0000c0d0: 6368 756e 6b73 2929 0a0a 2020 2020 4063  chunks))..    @c
-0000c0e0: 6163 6865 645f 7072 6f70 6572 7479 0a20  ached_property. 
-0000c0f0: 2020 2064 6566 206e 7061 7274 6974 696f     def npartitio
-0000c100: 6e73 2873 656c 6629 3a0a 2020 2020 2020  ns(self):.      
-0000c110: 2020 7265 7475 726e 2072 6564 7563 6528    return reduce(
-0000c120: 6d75 6c2c 2073 656c 662e 6e75 6d62 6c6f  mul, self.numblo
-0000c130: 636b 732c 2031 290a 0a20 2020 2064 6566  cks, 1)..    def
-0000c140: 2063 6f6d 7075 7465 5f63 6875 6e6b 5f73   compute_chunk_s
-0000c150: 697a 6573 2873 656c 6629 3a0a 2020 2020  izes(self):.    
-0000c160: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000c170: 436f 6d70 7574 6520 7468 6520 6368 756e  Compute the chun
-0000c180: 6b20 7369 7a65 7320 666f 7220 6120 4461  k sizes for a Da
-0000c190: 736b 2061 7272 6179 2e20 5468 6973 2069  sk array. This i
-0000c1a0: 7320 6573 7065 6369 616c 6c79 2075 7365  s especially use
-0000c1b0: 6675 6c0a 2020 2020 2020 2020 7768 656e  ful.        when
-0000c1c0: 2074 6865 2063 6875 6e6b 2073 697a 6573   the chunk sizes
-0000c1d0: 2061 7265 2075 6e6b 6e6f 776e 2028 652e   are unknown (e.
-0000c1e0: 672e 2c20 7768 656e 2069 6e64 6578 696e  g., when indexin
-0000c1f0: 6720 6f6e 6520 4461 736b 2061 7272 6179  g one Dask array
-0000c200: 0a20 2020 2020 2020 2077 6974 6820 616e  .        with an
-0000c210: 6f74 6865 7229 2e0a 0a20 2020 2020 2020  other)...       
-0000c220: 204e 6f74 6573 0a20 2020 2020 2020 202d   Notes.        -
-0000c230: 2d2d 2d2d 0a20 2020 2020 2020 2054 6869  ----.        Thi
-0000c240: 7320 6675 6e63 7469 6f6e 206d 6f64 6966  s function modif
-0000c250: 6965 7320 7468 6520 4461 736b 2061 7272  ies the Dask arr
-0000c260: 6179 2069 6e2d 706c 6163 652e 0a0a 2020  ay in-place...  
-0000c270: 2020 2020 2020 4578 616d 706c 6573 0a20        Examples. 
-0000c280: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-0000c290: 2020 2020 2020 2020 3e3e 3e20 696d 706f          >>> impo
-0000c2a0: 7274 2064 6173 6b2e 6172 7261 7920 6173  rt dask.array as
-0000c2b0: 2064 610a 2020 2020 2020 2020 3e3e 3e20   da.        >>> 
-0000c2c0: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
-0000c2d0: 6e70 0a20 2020 2020 2020 203e 3e3e 2078  np.        >>> x
-0000c2e0: 203d 2064 612e 6672 6f6d 5f61 7272 6179   = da.from_array
-0000c2f0: 285b 2d32 2c20 2d31 2c20 302c 2031 2c20  ([-2, -1, 0, 1, 
-0000c300: 325d 2c20 6368 756e 6b73 3d32 290a 2020  2], chunks=2).  
-0000c310: 2020 2020 2020 3e3e 3e20 782e 6368 756e        >>> x.chun
-0000c320: 6b73 0a20 2020 2020 2020 2028 2832 2c20  ks.        ((2, 
-0000c330: 322c 2031 292c 290a 2020 2020 2020 2020  2, 1),).        
-0000c340: 3e3e 3e20 7920 3d20 785b 7820 3c3d 2030  >>> y = x[x <= 0
-0000c350: 5d0a 2020 2020 2020 2020 3e3e 3e20 792e  ].        >>> y.
-0000c360: 6368 756e 6b73 0a20 2020 2020 2020 2028  chunks.        (
-0000c370: 286e 616e 2c20 6e61 6e2c 206e 616e 292c  (nan, nan, nan),
-0000c380: 290a 2020 2020 2020 2020 3e3e 3e20 792e  ).        >>> y.
-0000c390: 636f 6d70 7574 655f 6368 756e 6b5f 7369  compute_chunk_si
-0000c3a0: 7a65 7328 2920 2023 2069 6e2d 706c 6163  zes()  # in-plac
-0000c3b0: 6520 636f 6d70 7574 6174 696f 6e0a 2020  e computation.  
-0000c3c0: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-0000c3d0: 3c67 6574 6974 656d 2c20 7368 6170 653d  <getitem, shape=
-0000c3e0: 2833 2c29 2c20 6474 7970 653d 696e 7436  (3,), dtype=int6
-0000c3f0: 342c 2063 6875 6e6b 7369 7a65 3d28 322c  4, chunksize=(2,
-0000c400: 292c 2063 6875 6e6b 7479 7065 3d6e 756d  ), chunktype=num
-0000c410: 7079 2e6e 6461 7272 6179 3e0a 2020 2020  py.ndarray>.    
-0000c420: 2020 2020 3e3e 3e20 792e 6368 756e 6b73      >>> y.chunks
-0000c430: 0a20 2020 2020 2020 2028 2832 2c20 312c  .        ((2, 1,
-0000c440: 2030 292c 290a 0a20 2020 2020 2020 2022   0),)..        "
-0000c450: 2222 0a20 2020 2020 2020 2078 203d 2073  "".        x = s
-0000c460: 656c 660a 2020 2020 2020 2020 6368 756e  elf.        chun
-0000c470: 6b5f 7368 6170 6573 203d 2078 2e6d 6170  k_shapes = x.map
-0000c480: 5f62 6c6f 636b 7328 0a20 2020 2020 2020  _blocks(.       
-0000c490: 2020 2020 205f 6765 745f 6368 756e 6b5f       _get_chunk_
-0000c4a0: 7368 6170 652c 0a20 2020 2020 2020 2020  shape,.         
-0000c4b0: 2020 2064 7479 7065 3d69 6e74 2c0a 2020     dtype=int,.  
-0000c4c0: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
-0000c4d0: 3d74 7570 6c65 286c 656e 2863 2920 2a20  =tuple(len(c) * 
-0000c4e0: 2831 2c29 2066 6f72 2063 2069 6e20 782e  (1,) for c in x.
-0000c4f0: 6368 756e 6b73 2920 2b20 2828 782e 6e64  chunks) + ((x.nd
-0000c500: 696d 2c29 2c29 2c0a 2020 2020 2020 2020  im,),),.        
-0000c510: 2020 2020 6e65 775f 6178 6973 3d78 2e6e      new_axis=x.n
-0000c520: 6469 6d2c 0a20 2020 2020 2020 2029 0a0a  dim,.        )..
-0000c530: 2020 2020 2020 2020 6320 3d20 5b5d 0a20          c = []. 
-0000c540: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0000c550: 7261 6e67 6528 782e 6e64 696d 293a 0a20  range(x.ndim):. 
-0000c560: 2020 2020 2020 2020 2020 2073 203d 2078             s = x
-0000c570: 2e6e 6469 6d20 2a20 5b30 5d20 2b20 5b69  .ndim * [0] + [i
-0000c580: 5d0a 2020 2020 2020 2020 2020 2020 735b  ].            s[
-0000c590: 695d 203d 2073 6c69 6365 284e 6f6e 6529  i] = slice(None)
-0000c5a0: 0a20 2020 2020 2020 2020 2020 2073 203d  .            s =
-0000c5b0: 2074 7570 6c65 2873 290a 0a20 2020 2020   tuple(s)..     
-0000c5c0: 2020 2020 2020 2063 2e61 7070 656e 6428         c.append(
-0000c5d0: 7475 706c 6528 6368 756e 6b5f 7368 6170  tuple(chunk_shap
-0000c5e0: 6573 5b73 5d29 290a 0a20 2020 2020 2020  es[s]))..       
-0000c5f0: 2023 2060 6d61 705f 626c 6f63 6b73 6020   # `map_blocks` 
-0000c600: 6173 7369 676e 7320 6e75 6d70 7920 6474  assigns numpy dt
-0000c610: 7970 6573 0a20 2020 2020 2020 2023 2063  ypes.        # c
-0000c620: 6173 7420 6368 756e 6b20 6469 6d65 6e73  ast chunk dimens
-0000c630: 696f 6e73 2062 6163 6b20 746f 2070 7974  ions back to pyt
-0000c640: 686f 6e20 696e 7420 6265 666f 7265 2072  hon int before r
-0000c650: 6574 7572 6e69 6e67 0a20 2020 2020 2020  eturning.       
-0000c660: 2078 2e5f 6368 756e 6b73 203d 2074 7570   x._chunks = tup
-0000c670: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
-0000c680: 7475 706c 6528 696e 7428 6368 756e 6b29  tuple(int(chunk)
-0000c690: 2066 6f72 2063 6875 6e6b 2069 6e20 6368   for chunk in ch
-0000c6a0: 756e 6b73 2920 666f 7220 6368 756e 6b73  unks) for chunks
-0000c6b0: 2069 6e20 636f 6d70 7574 6528 7475 706c   in compute(tupl
-0000c6c0: 6528 6329 295b 305d 0a20 2020 2020 2020  e(c))[0].       
-0000c6d0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-0000c6e0: 6e20 780a 0a20 2020 2040 6361 6368 6564  n x..    @cached
-0000c6f0: 5f70 726f 7065 7274 790a 2020 2020 6465  _property.    de
-0000c700: 6620 7368 6170 6528 7365 6c66 2920 2d3e  f shape(self) ->
-0000c710: 2074 7570 6c65 5b54 5f49 6e74 4f72 4e61   tuple[T_IntOrNa
-0000c720: 4e2c 202e 2e2e 5d3a 0a20 2020 2020 2020  N, ...]:.       
-0000c730: 2072 6574 7572 6e20 7475 706c 6528 6361   return tuple(ca
-0000c740: 6368 6564 5f63 756d 7375 6d28 632c 2069  ched_cumsum(c, i
-0000c750: 6e69 7469 616c 5f7a 6572 6f3d 5472 7565  nitial_zero=True
-0000c760: 295b 2d31 5d20 666f 7220 6320 696e 2073  )[-1] for c in s
-0000c770: 656c 662e 6368 756e 6b73 290a 0a20 2020  elf.chunks)..   
-0000c780: 2040 7072 6f70 6572 7479 0a20 2020 2064   @property.    d
-0000c790: 6566 2063 6875 6e6b 7369 7a65 2873 656c  ef chunksize(sel
-0000c7a0: 6629 202d 3e20 7475 706c 655b 545f 496e  f) -> tuple[T_In
-0000c7b0: 744f 724e 614e 2c20 2e2e 2e5d 3a0a 2020  tOrNaN, ...]:.  
-0000c7c0: 2020 2020 2020 7265 7475 726e 2074 7570        return tup
-0000c7d0: 6c65 286d 6178 2863 2920 666f 7220 6320  le(max(c) for c 
-0000c7e0: 696e 2073 656c 662e 6368 756e 6b73 290a  in self.chunks).
-0000c7f0: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
-0000c800: 2020 2064 6566 2064 7479 7065 2873 656c     def dtype(sel
-0000c810: 6629 3a0a 2020 2020 2020 2020 6966 2069  f):.        if i
-0000c820: 7369 6e73 7461 6e63 6528 7365 6c66 2e5f  sinstance(self._
-0000c830: 6d65 7461 2c20 7475 706c 6529 3a0a 2020  meta, tuple):.  
-0000c840: 2020 2020 2020 2020 2020 6474 7970 6520            dtype 
-0000c850: 3d20 7365 6c66 2e5f 6d65 7461 5b30 5d2e  = self._meta[0].
-0000c860: 6474 7970 650a 2020 2020 2020 2020 656c  dtype.        el
-0000c870: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000c880: 6474 7970 6520 3d20 7365 6c66 2e5f 6d65  dtype = self._me
-0000c890: 7461 2e64 7479 7065 0a20 2020 2020 2020  ta.dtype.       
-0000c8a0: 2072 6574 7572 6e20 6474 7970 650a 0a20   return dtype.. 
-0000c8b0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0000c8c0: 2064 6566 205f 6368 756e 6b73 2873 656c   def _chunks(sel
-0000c8d0: 6629 3a0a 2020 2020 2020 2020 2222 224e  f):.        """N
-0000c8e0: 6f6e 2d70 7562 6c69 6320 6368 756e 6b73  on-public chunks
-0000c8f0: 2070 726f 7065 7274 792e 2041 6c6c 6f77   property. Allow
-0000c900: 7320 7365 7474 696e 6720 6120 6368 756e  s setting a chun
-0000c910: 6b20 7661 6c75 652e 2222 220a 2020 2020  k value.""".    
-0000c920: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000c930: 5f5f 6368 756e 6b73 0a0a 2020 2020 405f  __chunks..    @_
-0000c940: 6368 756e 6b73 2e73 6574 7465 720a 2020  chunks.setter.  
-0000c950: 2020 6465 6620 5f63 6875 6e6b 7328 7365    def _chunks(se
-0000c960: 6c66 2c20 6368 756e 6b73 293a 0a20 2020  lf, chunks):.   
-0000c970: 2020 2020 2073 656c 662e 5f5f 6368 756e       self.__chun
-0000c980: 6b73 203d 2063 6875 6e6b 730a 0a20 2020  ks = chunks..   
-0000c990: 2020 2020 2023 2057 6865 6e20 7468 6520       # When the 
-0000c9a0: 6368 756e 6b73 2063 6861 6e67 6573 2074  chunks changes t
-0000c9b0: 6865 2063 6163 6865 6420 7072 6f70 6572  he cached proper
-0000c9c0: 7469 6573 2074 6861 7420 7761 730a 2020  ties that was.  
-0000c9d0: 2020 2020 2020 2320 6465 7065 6e64 656e        # dependen
-0000c9e0: 7420 6f6e 2069 7420 6e65 6564 7320 746f  t on it needs to
-0000c9f0: 2062 6520 6465 6c65 7465 643a 0a20 2020   be deleted:.   
-0000ca00: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-0000ca10: 5b22 6e75 6d62 6c6f 636b 7322 2c20 226e  ["numblocks", "n
-0000ca20: 7061 7274 6974 696f 6e73 222c 2022 7368  partitions", "sh
-0000ca30: 6170 6522 2c20 226e 6469 6d22 2c20 2273  ape", "ndim", "s
-0000ca40: 697a 6522 2c20 225f 6b65 795f 6172 7261  ize", "_key_arra
-0000ca50: 7922 5d3a 0a20 2020 2020 2020 2020 2020  y"]:.           
-0000ca60: 2073 656c 662e 5f72 6573 6574 5f63 6163   self._reset_cac
-0000ca70: 6865 286b 6579 290a 0a20 2020 2040 7072  he(key)..    @pr
-0000ca80: 6f70 6572 7479 0a20 2020 2064 6566 2063  operty.    def c
-0000ca90: 6875 6e6b 7328 7365 6c66 293a 0a20 2020  hunks(self):.   
-0000caa0: 2020 2020 2022 2222 4368 756e 6b73 2070       """Chunks p
-0000cab0: 726f 7065 7274 792e 2222 220a 2020 2020  roperty.""".    
-0000cac0: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000cad0: 5f5f 6368 756e 6b73 0a0a 2020 2020 4063  __chunks..    @c
-0000cae0: 6875 6e6b 732e 7365 7474 6572 0a20 2020  hunks.setter.   
-0000caf0: 2064 6566 2063 6875 6e6b 7328 7365 6c66   def chunks(self
-0000cb00: 2c20 6368 756e 6b73 293a 0a20 2020 2020  , chunks):.     
-0000cb10: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-0000cb20: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-0000cb30: 2243 616e 206e 6f74 2073 6574 2063 6875  "Can not set chu
-0000cb40: 6e6b 7320 6469 7265 6374 6c79 5c6e 5c6e  nks directly\n\n
-0000cb50: 220a 2020 2020 2020 2020 2020 2020 2250  ".            "P
-0000cb60: 6c65 6173 6520 7573 6520 7468 6520 7265  lease use the re
-0000cb70: 6368 756e 6b20 6d65 7468 6f64 2069 6e73  chunk method ins
-0000cb80: 7465 6164 3a5c 6e22 0a20 2020 2020 2020  tead:\n".       
-0000cb90: 2020 2020 2066 2220 2078 2e72 6563 6875       f"  x.rechu
-0000cba0: 6e6b 287b 6368 756e 6b73 7d29 5c6e 5c6e  nk({chunks})\n\n
-0000cbb0: 220a 2020 2020 2020 2020 2020 2020 2249  ".            "I
-0000cbc0: 6620 7472 7969 6e67 2074 6f20 6176 6f69  f trying to avoi
-0000cbd0: 6420 756e 6b6e 6f77 6e20 6368 756e 6b73  d unknown chunks
-0000cbe0: 2c20 7573 655c 6e22 0a20 2020 2020 2020  , use\n".       
-0000cbf0: 2020 2020 2022 2020 782e 636f 6d70 7574       "  x.comput
-0000cc00: 655f 6368 756e 6b5f 7369 7a65 7328 2922  e_chunk_sizes()"
-0000cc10: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0000cc20: 6465 6620 5f5f 6c65 6e5f 5f28 7365 6c66  def __len__(self
-0000cc30: 293a 0a20 2020 2020 2020 2069 6620 6e6f  ):.        if no
-0000cc40: 7420 7365 6c66 2e63 6875 6e6b 733a 0a20  t self.chunks:. 
-0000cc50: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000cc60: 2054 7970 6545 7272 6f72 2822 6c65 6e28   TypeError("len(
-0000cc70: 2920 6f66 2075 6e73 697a 6564 206f 626a  ) of unsized obj
-0000cc80: 6563 7422 290a 2020 2020 2020 2020 6966  ect").        if
-0000cc90: 206e 702e 6973 6e61 6e28 7365 6c66 2e63   np.isnan(self.c
-0000cca0: 6875 6e6b 735b 305d 292e 616e 7928 293a  hunks[0]).any():
-0000ccb0: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
-0000ccc0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-0000ccd0: 2020 2020 2022 4361 6e6e 6f74 2063 616c       "Cannot cal
-0000cce0: 6c20 6c65 6e28 2920 6f6e 206f 626a 6563  l len() on objec
-0000ccf0: 7420 7769 7468 2075 6e6b 6e6f 776e 2063  t with unknown c
-0000cd00: 6875 6e6b 2073 697a 652e 220a 2020 2020  hunk size.".    
-0000cd10: 2020 2020 2020 2020 2020 2020 6622 7b75              f"{u
-0000cd20: 6e6b 6e6f 776e 5f63 6875 6e6b 5f6d 6573  nknown_chunk_mes
-0000cd30: 7361 6765 7d22 0a20 2020 2020 2020 2020  sage}".         
-0000cd40: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000cd50: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000cd60: 7228 6d73 6729 0a20 2020 2020 2020 2072  r(msg).        r
-0000cd70: 6574 7572 6e20 696e 7428 7375 6d28 7365  eturn int(sum(se
-0000cd80: 6c66 2e63 6875 6e6b 735b 305d 2929 0a0a  lf.chunks[0]))..
-0000cd90: 2020 2020 6465 6620 5f5f 6172 7261 795f      def __array_
-0000cda0: 7566 756e 635f 5f28 7365 6c66 2c20 6e75  ufunc__(self, nu
-0000cdb0: 6d70 795f 7566 756e 632c 206d 6574 686f  mpy_ufunc, metho
-0000cdc0: 642c 202a 696e 7075 7473 2c20 2a2a 6b77  d, *inputs, **kw
-0000cdd0: 6172 6773 293a 0a20 2020 2020 2020 206f  args):.        o
-0000cde0: 7574 203d 206b 7761 7267 732e 6765 7428  ut = kwargs.get(
-0000cdf0: 226f 7574 222c 2028 2929 0a20 2020 2020  "out", ()).     
-0000ce00: 2020 2066 6f72 2078 2069 6e20 696e 7075     for x in inpu
-0000ce10: 7473 202b 206f 7574 3a0a 2020 2020 2020  ts + out:.      
-0000ce20: 2020 2020 2020 6966 205f 7368 6f75 6c64        if _should
-0000ce30: 5f64 656c 6567 6174 6528 7365 6c66 2c20  _delegate(self, 
-0000ce40: 7829 3a0a 2020 2020 2020 2020 2020 2020  x):.            
-0000ce50: 2020 2020 7265 7475 726e 204e 6f74 496d      return NotIm
-0000ce60: 706c 656d 656e 7465 640a 0a20 2020 2020  plemented..     
-0000ce70: 2020 2069 6620 6d65 7468 6f64 203d 3d20     if method == 
-0000ce80: 225f 5f63 616c 6c5f 5f22 3a0a 2020 2020  "__call__":.    
-0000ce90: 2020 2020 2020 2020 6966 206e 756d 7079          if numpy
-0000cea0: 5f75 6675 6e63 2069 7320 6e70 2e6d 6174  _ufunc is np.mat
-0000ceb0: 6d75 6c3a 0a20 2020 2020 2020 2020 2020  mul:.           
-0000cec0: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
-0000ced0: 7272 6179 2e72 6f75 7469 6e65 7320 696d  rray.routines im
-0000cee0: 706f 7274 206d 6174 6d75 6c0a 0a20 2020  port matmul..   
-0000cef0: 2020 2020 2020 2020 2020 2020 2023 2073               # s
-0000cf00: 7065 6369 616c 2063 6173 6520 756e 7469  pecial case unti
-0000cf10: 6c20 6170 706c 795f 6775 6675 6e63 2068  l apply_gufunc h
-0000cf20: 616e 646c 6573 206f 7074 696f 6e61 6c20  andles optional 
-0000cf30: 6469 6d65 6e73 696f 6e73 0a20 2020 2020  dimensions.     
-0000cf40: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000cf50: 6e20 6d61 746d 756c 282a 696e 7075 7473  n matmul(*inputs
-0000cf60: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
-0000cf70: 2020 2020 2020 2020 6966 206e 756d 7079          if numpy
-0000cf80: 5f75 6675 6e63 2e73 6967 6e61 7475 7265  _ufunc.signature
-0000cf90: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0000cfa0: 2020 2020 2020 2020 2020 2020 2020 6672                fr
-0000cfb0: 6f6d 2064 6173 6b2e 6172 7261 792e 6775  om dask.array.gu
-0000cfc0: 6675 6e63 2069 6d70 6f72 7420 6170 706c  func import appl
-0000cfd0: 795f 6775 6675 6e63 0a0a 2020 2020 2020  y_gufunc..      
-0000cfe0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000cff0: 2061 7070 6c79 5f67 7566 756e 6328 0a20   apply_gufunc(. 
-0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d010: 2020 206e 756d 7079 5f75 6675 6e63 2c20     numpy_ufunc, 
-0000d020: 6e75 6d70 795f 7566 756e 632e 7369 676e  numpy_ufunc.sign
-0000d030: 6174 7572 652c 202a 696e 7075 7473 2c20  ature, *inputs, 
-0000d040: 2a2a 6b77 6172 6773 0a20 2020 2020 2020  **kwargs.       
-0000d050: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000d060: 2020 2020 2020 2069 6620 6e75 6d70 795f         if numpy_
-0000d070: 7566 756e 632e 6e6f 7574 203e 2031 3a0a  ufunc.nout > 1:.
-0000d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d090: 6672 6f6d 2064 6173 6b2e 6172 7261 7920  from dask.array 
-0000d0a0: 696d 706f 7274 2075 6675 6e63 0a0a 2020  import ufunc..  
-0000d0b0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0000d0c0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000d0d0: 2020 2020 2020 2064 615f 7566 756e 6320         da_ufunc 
-0000d0e0: 3d20 6765 7461 7474 7228 7566 756e 632c  = getattr(ufunc,
-0000d0f0: 206e 756d 7079 5f75 6675 6e63 2e5f 5f6e   numpy_ufunc.__n
-0000d100: 616d 655f 5f29 0a20 2020 2020 2020 2020  ame__).         
-0000d110: 2020 2020 2020 2065 7863 6570 7420 4174         except At
-0000d120: 7472 6962 7574 6545 7272 6f72 3a0a 2020  tributeError:.  
-0000d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d140: 2020 7265 7475 726e 204e 6f74 496d 706c    return NotImpl
-0000d150: 656d 656e 7465 640a 2020 2020 2020 2020  emented.        
-0000d160: 2020 2020 2020 2020 7265 7475 726e 2064          return d
-0000d170: 615f 7566 756e 6328 2a69 6e70 7574 732c  a_ufunc(*inputs,
-0000d180: 202a 2a6b 7761 7267 7329 0a20 2020 2020   **kwargs).     
-0000d190: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000d1a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000d1b0: 7572 6e20 656c 656d 7769 7365 286e 756d  urn elemwise(num
-0000d1c0: 7079 5f75 6675 6e63 2c20 2a69 6e70 7574  py_ufunc, *input
-0000d1d0: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
-0000d1e0: 2020 2020 2065 6c69 6620 6d65 7468 6f64       elif method
-0000d1f0: 203d 3d20 226f 7574 6572 223a 0a20 2020   == "outer":.   
-0000d200: 2020 2020 2020 2020 2066 726f 6d20 6461           from da
-0000d210: 736b 2e61 7272 6179 2069 6d70 6f72 7420  sk.array import 
-0000d220: 7566 756e 630a 0a20 2020 2020 2020 2020  ufunc..         
-0000d230: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000d240: 2020 2020 2020 2020 6461 5f75 6675 6e63          da_ufunc
-0000d250: 203d 2067 6574 6174 7472 2875 6675 6e63   = getattr(ufunc
-0000d260: 2c20 6e75 6d70 795f 7566 756e 632e 5f5f  , numpy_ufunc.__
-0000d270: 6e61 6d65 5f5f 290a 2020 2020 2020 2020  name__).        
-0000d280: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
-0000d290: 6275 7465 4572 726f 723a 0a20 2020 2020  buteError:.     
-0000d2a0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000d2b0: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
-0000d2c0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000d2d0: 7572 6e20 6461 5f75 6675 6e63 2e6f 7574  urn da_ufunc.out
-0000d2e0: 6572 282a 696e 7075 7473 2c20 2a2a 6b77  er(*inputs, **kw
-0000d2f0: 6172 6773 290a 2020 2020 2020 2020 656c  args).        el
-0000d300: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d310: 7265 7475 726e 204e 6f74 496d 706c 656d  return NotImplem
-0000d320: 656e 7465 640a 0a20 2020 2064 6566 205f  ented..    def _
-0000d330: 5f72 6570 725f 5f28 7365 6c66 293a 0a20  _repr__(self):. 
-0000d340: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000d350: 2020 2020 3e3e 3e20 696d 706f 7274 2064      >>> import d
-0000d360: 6173 6b2e 6172 7261 7920 6173 2064 610a  ask.array as da.
-0000d370: 2020 2020 2020 2020 3e3e 3e20 6461 2e6f          >>> da.o
-0000d380: 6e65 7328 2831 302c 2031 3029 2c20 6368  nes((10, 10), ch
-0000d390: 756e 6b73 3d28 352c 2035 292c 2064 7479  unks=(5, 5), dty
-0000d3a0: 7065 3d27 6934 2729 0a20 2020 2020 2020  pe='i4').       
-0000d3b0: 2064 6173 6b2e 6172 7261 793c 2e2e 2e2c   dask.array<...,
-0000d3c0: 2073 6861 7065 3d28 3130 2c20 3130 292c   shape=(10, 10),
-0000d3d0: 2064 7479 7065 3d69 6e74 3332 2c20 6368   dtype=int32, ch
-0000d3e0: 756e 6b73 697a 653d 2835 2c20 3529 2c20  unksize=(5, 5), 
-0000d3f0: 6368 756e 6b74 7970 653d 6e75 6d70 792e  chunktype=numpy.
-0000d400: 6e64 6172 7261 793e 0a20 2020 2020 2020  ndarray>.       
-0000d410: 2022 2222 0a20 2020 2020 2020 2063 6875   """.        chu
-0000d420: 6e6b 7369 7a65 203d 2073 7472 2873 656c  nksize = str(sel
-0000d430: 662e 6368 756e 6b73 697a 6529 0a20 2020  f.chunksize).   
-0000d440: 2020 2020 206e 616d 6520 3d20 7365 6c66       name = self
-0000d450: 2e6e 616d 652e 7273 706c 6974 2822 2d22  .name.rsplit("-"
-0000d460: 2c20 3129 5b30 5d0a 2020 2020 2020 2020  , 1)[0].        
-0000d470: 7265 7475 726e 2028 0a20 2020 2020 2020  return (.       
-0000d480: 2020 2020 2022 6461 736b 2e61 7272 6179       "dask.array
-0000d490: 3c7b 7d2c 2073 6861 7065 3d7b 7d2c 2064  <{}, shape={}, d
-0000d4a0: 7479 7065 3d7b 7d2c 2063 6875 6e6b 7369  type={}, chunksi
-0000d4b0: 7a65 3d7b 7d2c 2063 6875 6e6b 7479 7065  ze={}, chunktype
-0000d4c0: 3d7b 7d2e 7b7d 3e22 2e66 6f72 6d61 7428  ={}.{}>".format(
-0000d4d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d4e0: 206e 616d 652c 0a20 2020 2020 2020 2020   name,.         
-0000d4f0: 2020 2020 2020 2073 656c 662e 7368 6170         self.shap
-0000d500: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0000d510: 2020 2073 656c 662e 6474 7970 652c 0a20     self.dtype,. 
-0000d520: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0000d530: 6875 6e6b 7369 7a65 2c0a 2020 2020 2020  hunksize,.      
-0000d540: 2020 2020 2020 2020 2020 7479 7065 2873            type(s
-0000d550: 656c 662e 5f6d 6574 6129 2e5f 5f6d 6f64  elf._meta).__mod
-0000d560: 756c 655f 5f2e 7370 6c69 7428 222e 2229  ule__.split(".")
-0000d570: 5b30 5d2c 0a20 2020 2020 2020 2020 2020  [0],.           
-0000d580: 2020 2020 2074 7970 6528 7365 6c66 2e5f       type(self._
-0000d590: 6d65 7461 292e 5f5f 6e61 6d65 5f5f 2c0a  meta).__name__,.
-0000d5a0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000d5b0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-0000d5c0: 205f 7265 7072 5f68 746d 6c5f 2873 656c   _repr_html_(sel
-0000d5d0: 6629 3a0a 2020 2020 2020 2020 7472 793a  f):.        try:
-0000d5e0: 0a20 2020 2020 2020 2020 2020 2067 7269  .            gri
-0000d5f0: 6420 3d20 7365 6c66 2e74 6f5f 7376 6728  d = self.to_svg(
-0000d600: 7369 7a65 3d63 6f6e 6669 672e 6765 7428  size=config.get(
-0000d610: 2261 7272 6179 2e73 7667 2e73 697a 6522  "array.svg.size"
-0000d620: 2c20 3132 3029 290a 2020 2020 2020 2020  , 120)).        
-0000d630: 6578 6365 7074 204e 6f74 496d 706c 656d  except NotImplem
-0000d640: 656e 7465 6445 7272 6f72 3a0a 2020 2020  entedError:.    
-0000d650: 2020 2020 2020 2020 6772 6964 203d 2022          grid = "
-0000d660: 220a 0a20 2020 2020 2020 2069 6620 2273  "..        if "s
-0000d670: 7061 7273 6522 2069 6e20 7479 7065 6e61  parse" in typena
-0000d680: 6d65 2874 7970 6528 7365 6c66 2e5f 6d65  me(type(self._me
-0000d690: 7461 2929 3a0a 2020 2020 2020 2020 2020  ta)):.          
-0000d6a0: 2020 6e62 7974 6573 203d 204e 6f6e 650a    nbytes = None.
-0000d6b0: 2020 2020 2020 2020 2020 2020 6362 7974              cbyt
-0000d6c0: 6573 203d 204e 6f6e 650a 2020 2020 2020  es = None.      
-0000d6d0: 2020 656c 6966 206e 6f74 206d 6174 682e    elif not math.
-0000d6e0: 6973 6e61 6e28 7365 6c66 2e6e 6279 7465  isnan(self.nbyte
-0000d6f0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0000d700: 6e62 7974 6573 203d 2066 6f72 6d61 745f  nbytes = format_
-0000d710: 6279 7465 7328 7365 6c66 2e6e 6279 7465  bytes(self.nbyte
-0000d720: 7329 0a20 2020 2020 2020 2020 2020 2063  s).            c
-0000d730: 6279 7465 7320 3d20 666f 726d 6174 5f62  bytes = format_b
-0000d740: 7974 6573 286d 6174 682e 7072 6f64 2873  ytes(math.prod(s
-0000d750: 656c 662e 6368 756e 6b73 697a 6529 202a  elf.chunksize) *
-0000d760: 2073 656c 662e 6474 7970 652e 6974 656d   self.dtype.item
-0000d770: 7369 7a65 290a 2020 2020 2020 2020 656c  size).        el
-0000d780: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d790: 6e62 7974 6573 203d 2022 756e 6b6e 6f77  nbytes = "unknow
-0000d7a0: 6e22 0a20 2020 2020 2020 2020 2020 2063  n".            c
-0000d7b0: 6279 7465 7320 3d20 2275 6e6b 6e6f 776e  bytes = "unknown
-0000d7c0: 220a 0a20 2020 2020 2020 2072 6574 7572  "..        retur
-0000d7d0: 6e20 6765 745f 7465 6d70 6c61 7465 2822  n get_template("
-0000d7e0: 6172 7261 792e 6874 6d6c 2e6a 3222 292e  array.html.j2").
-0000d7f0: 7265 6e64 6572 280a 2020 2020 2020 2020  render(.        
-0000d800: 2020 2020 6172 7261 793d 7365 6c66 2c0a      array=self,.
-0000d810: 2020 2020 2020 2020 2020 2020 6772 6964              grid
-0000d820: 3d67 7269 642c 0a20 2020 2020 2020 2020  =grid,.         
-0000d830: 2020 206e 6279 7465 733d 6e62 7974 6573     nbytes=nbytes
-0000d840: 2c0a 2020 2020 2020 2020 2020 2020 6362  ,.            cb
-0000d850: 7974 6573 3d63 6279 7465 732c 0a20 2020  ytes=cbytes,.   
-0000d860: 2020 2020 2020 2020 206c 6179 6572 733d           layers=
-0000d870: 6d61 7962 655f 706c 7572 616c 697a 6528  maybe_pluralize(
-0000d880: 6c65 6e28 7365 6c66 2e64 6173 6b2e 6c61  len(self.dask.la
-0000d890: 7965 7273 292c 2022 6772 6170 6820 6c61  yers), "graph la
-0000d8a0: 7965 7222 292c 0a20 2020 2020 2020 2029  yer"),.        )
-0000d8b0: 0a0a 2020 2020 4063 6163 6865 645f 7072  ..    @cached_pr
-0000d8c0: 6f70 6572 7479 0a20 2020 2064 6566 206e  operty.    def n
-0000d8d0: 6469 6d28 7365 6c66 2920 2d3e 2069 6e74  dim(self) -> int
-0000d8e0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0000d8f0: 206c 656e 2873 656c 662e 7368 6170 6529   len(self.shape)
-0000d900: 0a0a 2020 2020 4063 6163 6865 645f 7072  ..    @cached_pr
-0000d910: 6f70 6572 7479 0a20 2020 2064 6566 2073  operty.    def s
-0000d920: 697a 6528 7365 6c66 2920 2d3e 2054 5f49  ize(self) -> T_I
-0000d930: 6e74 4f72 4e61 4e3a 0a20 2020 2020 2020  ntOrNaN:.       
-0000d940: 2022 2222 4e75 6d62 6572 206f 6620 656c   """Number of el
-0000d950: 656d 656e 7473 2069 6e20 6172 7261 7922  ements in array"
-0000d960: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
-0000d970: 6e20 7265 6475 6365 286d 756c 2c20 7365  n reduce(mul, se
-0000d980: 6c66 2e73 6861 7065 2c20 3129 0a0a 2020  lf.shape, 1)..  
-0000d990: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0000d9a0: 6465 6620 6e62 7974 6573 2873 656c 6629  def nbytes(self)
-0000d9b0: 202d 3e20 545f 496e 744f 724e 614e 3a0a   -> T_IntOrNaN:.
-0000d9c0: 2020 2020 2020 2020 2222 224e 756d 6265          """Numbe
-0000d9d0: 7220 6f66 2062 7974 6573 2069 6e20 6172  r of bytes in ar
-0000d9e0: 7261 7922 2222 0a20 2020 2020 2020 2072  ray""".        r
-0000d9f0: 6574 7572 6e20 7365 6c66 2e73 697a 6520  eturn self.size 
-0000da00: 2a20 7365 6c66 2e64 7479 7065 2e69 7465  * self.dtype.ite
-0000da10: 6d73 697a 650a 0a20 2020 2040 7072 6f70  msize..    @prop
-0000da20: 6572 7479 0a20 2020 2064 6566 2069 7465  erty.    def ite
-0000da30: 6d73 697a 6528 7365 6c66 2920 2d3e 2069  msize(self) -> i
-0000da40: 6e74 3a0a 2020 2020 2020 2020 2222 224c  nt:.        """L
-0000da50: 656e 6774 6820 6f66 206f 6e65 2061 7272  ength of one arr
-0000da60: 6179 2065 6c65 6d65 6e74 2069 6e20 6279  ay element in by
-0000da70: 7465 7322 2222 0a20 2020 2020 2020 2072  tes""".        r
-0000da80: 6574 7572 6e20 7365 6c66 2e64 7479 7065  eturn self.dtype
-0000da90: 2e69 7465 6d73 697a 650a 0a20 2020 2040  .itemsize..    @
-0000daa0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
-0000dab0: 205f 6e61 6d65 2873 656c 6629 3a0a 2020   _name(self):.  
-0000dac0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0000dad0: 662e 5f5f 6e61 6d65 0a0a 2020 2020 405f  f.__name..    @_
-0000dae0: 6e61 6d65 2e73 6574 7465 720a 2020 2020  name.setter.    
-0000daf0: 6465 6620 5f6e 616d 6528 7365 6c66 2c20  def _name(self, 
-0000db00: 7661 6c29 3a0a 2020 2020 2020 2020 7365  val):.        se
-0000db10: 6c66 2e5f 5f6e 616d 6520 3d20 7661 6c0a  lf.__name = val.
-0000db20: 2020 2020 2020 2020 2320 436c 6561 7220          # Clear 
-0000db30: 7468 6520 6b65 7920 6361 6368 6520 7768  the key cache wh
-0000db40: 656e 2074 6865 206e 616d 6520 6973 2072  en the name is r
-0000db50: 6573 6574 0a20 2020 2020 2020 2073 656c  eset.        sel
-0000db60: 662e 5f63 6163 6865 645f 6b65 7973 203d  f._cached_keys =
-0000db70: 204e 6f6e 650a 2020 2020 2020 2020 7365   None.        se
-0000db80: 6c66 2e5f 7265 7365 745f 6361 6368 6528  lf._reset_cache(
-0000db90: 225f 6b65 795f 6172 7261 7922 290a 0a20  "_key_array").. 
-0000dba0: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
-0000dbb0: 2064 6566 206e 616d 6528 7365 6c66 293a   def name(self):
-0000dbc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000dbd0: 7365 6c66 2e5f 5f6e 616d 650a 0a20 2020  self.__name..   
-0000dbe0: 2040 6e61 6d65 2e73 6574 7465 720a 2020   @name.setter.  
-0000dbf0: 2020 6465 6620 6e61 6d65 2873 656c 662c    def name(self,
-0000dc00: 2076 616c 293a 0a20 2020 2020 2020 2072   val):.        r
-0000dc10: 6169 7365 2054 7970 6545 7272 6f72 280a  aise TypeError(.
-0000dc20: 2020 2020 2020 2020 2020 2020 2243 616e              "Can
-0000dc30: 6e6f 7420 7365 7420 6e61 6d65 2064 6972  not set name dir
-0000dc40: 6563 746c 795c 6e5c 6e22 0a20 2020 2020  ectly\n\n".     
-0000dc50: 2020 2020 2020 2022 4e61 6d65 2069 7320         "Name is 
-0000dc60: 7573 6564 2074 6f20 7265 6c61 7465 2074  used to relate t
-0000dc70: 6865 2061 7272 6179 2074 6f20 7468 6520  he array to the 
-0000dc80: 7461 736b 2067 7261 7068 2e5c 6e22 0a20  task graph.\n". 
-0000dc90: 2020 2020 2020 2020 2020 2022 4974 2069             "It i
-0000dca0: 7320 756e 636f 6d6d 6f6e 2074 6f20 6e65  s uncommon to ne
-0000dcb0: 6564 2074 6f20 6368 616e 6765 2069 742c  ed to change it,
-0000dcc0: 2062 7574 2069 6620 796f 7520 646f 5c6e   but if you do\n
-0000dcd0: 220a 2020 2020 2020 2020 2020 2020 2270  ".            "p
-0000dce0: 6c65 6173 6520 7365 7420 6060 2e5f 6e61  lease set ``._na
-0000dcf0: 6d65 6060 220a 2020 2020 2020 2020 290a  me``".        ).
-0000dd00: 0a20 2020 2064 6566 205f 5f69 7465 725f  .    def __iter_
-0000dd10: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
-0000dd20: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0000dd30: 6c65 6e28 7365 6c66 2929 3a0a 2020 2020  len(self)):.    
-0000dd40: 2020 2020 2020 2020 7969 656c 6420 7365          yield se
-0000dd50: 6c66 5b69 5d0a 0a20 2020 205f 5f61 7272  lf[i]..    __arr
-0000dd60: 6179 5f70 7269 6f72 6974 795f 5f20 3d20  ay_priority__ = 
-0000dd70: 3131 2020 2320 6869 6768 6572 2074 6861  11  # higher tha
-0000dd80: 6e20 6e75 6d70 792e 6e64 6172 7261 7920  n numpy.ndarray 
-0000dd90: 616e 6420 6e75 6d70 792e 6d61 7472 6978  and numpy.matrix
-0000dda0: 0a0a 2020 2020 6465 6620 5f5f 6172 7261  ..    def __arra
-0000ddb0: 795f 5f28 7365 6c66 2c20 6474 7970 653d  y__(self, dtype=
-0000ddc0: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 293a  None, **kwargs):
-0000ddd0: 0a20 2020 2020 2020 2078 203d 2073 656c  .        x = sel
-0000dde0: 662e 636f 6d70 7574 6528 290a 2020 2020  f.compute().    
-0000ddf0: 2020 2020 6966 2064 7479 7065 2061 6e64      if dtype and
-0000de00: 2078 2e64 7479 7065 2021 3d20 6474 7970   x.dtype != dtyp
-0000de10: 653a 0a20 2020 2020 2020 2020 2020 2078  e:.            x
-0000de20: 203d 2078 2e61 7374 7970 6528 6474 7970   = x.astype(dtyp
-0000de30: 6529 0a20 2020 2020 2020 2069 6620 6e6f  e).        if no
-0000de40: 7420 6973 696e 7374 616e 6365 2878 2c20  t isinstance(x, 
-0000de50: 6e70 2e6e 6461 7272 6179 293a 0a20 2020  np.ndarray):.   
-0000de60: 2020 2020 2020 2020 2078 203d 206e 702e           x = np.
-0000de70: 6172 7261 7928 7829 0a20 2020 2020 2020  array(x).       
-0000de80: 2072 6574 7572 6e20 780a 0a20 2020 2064   return x..    d
-0000de90: 6566 205f 5f61 7272 6179 5f66 756e 6374  ef __array_funct
-0000dea0: 696f 6e5f 5f28 7365 6c66 2c20 6675 6e63  ion__(self, func
-0000deb0: 2c20 7479 7065 732c 2061 7267 732c 206b  , types, args, k
-0000dec0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
-0000ded0: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
-0000dee0: 7920 6173 206d 6f64 756c 650a 0a20 2020  y as module..   
-0000def0: 2020 2020 2064 6566 2068 616e 646c 655f       def handle_
-0000df00: 6e6f 6e6d 6174 6368 696e 675f 6e61 6d65  nonmatching_name
-0000df10: 7328 6675 6e63 2c20 6172 6773 2c20 6b77  s(func, args, kw
-0000df20: 6172 6773 293a 0a20 2020 2020 2020 2020  args):.         
-0000df30: 2020 2069 6620 6675 6e63 206e 6f74 2069     if func not i
-0000df40: 6e20 5f48 414e 444c 4544 5f46 554e 4354  n _HANDLED_FUNCT
-0000df50: 494f 4e53 3a0a 2020 2020 2020 2020 2020  IONS:.          
-0000df60: 2020 2020 2020 7761 726e 696e 6773 2e77        warnings.w
-0000df70: 6172 6e28 0a20 2020 2020 2020 2020 2020  arn(.           
-0000df80: 2020 2020 2020 2020 2022 5468 6520 607b           "The `{
-0000df90: 7d60 2066 756e 6374 696f 6e20 6973 206e  }` function is n
-0000dfa0: 6f74 2069 6d70 6c65 6d65 6e74 6564 2062  ot implemented b
-0000dfb0: 7920 4461 736b 2061 7272 6179 2e20 220a  y Dask array. ".
-0000dfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000dfd0: 2020 2020 2259 6f75 206d 6179 2077 616e      "You may wan
-0000dfe0: 7420 746f 2075 7365 2074 6865 2064 612e  t to use the da.
-0000dff0: 6d61 705f 626c 6f63 6b73 2066 756e 6374  map_blocks funct
-0000e000: 696f 6e20 220a 2020 2020 2020 2020 2020  ion ".          
-0000e010: 2020 2020 2020 2020 2020 226f 7220 736f            "or so
-0000e020: 6d65 7468 696e 6720 7369 6d69 6c61 7220  mething similar 
-0000e030: 746f 2073 696c 656e 6365 2074 6869 7320  to silence this 
-0000e040: 7761 726e 696e 672e 2022 0a20 2020 2020  warning. ".     
-0000e050: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000e060: 596f 7572 2063 6f64 6520 6d61 7920 7374  Your code may st
-0000e070: 6f70 2077 6f72 6b69 6e67 2069 6e20 6120  op working in a 
-0000e080: 6675 7475 7265 2072 656c 6561 7365 2e22  future release."
-0000e090: 2e66 6f72 6d61 7428 0a20 2020 2020 2020  .format(.       
-0000e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e0b0: 2066 756e 632e 5f5f 6d6f 6475 6c65 5f5f   func.__module__
-0000e0c0: 202b 2022 2e22 202b 2066 756e 632e 5f5f   + "." + func.__
-0000e0d0: 6e61 6d65 5f5f 0a20 2020 2020 2020 2020  name__.         
-0000e0e0: 2020 2020 2020 2020 2020 2029 2c0a 2020             ),.  
-0000e0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e100: 2020 4675 7475 7265 5761 726e 696e 672c    FutureWarning,
-0000e110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e120: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
-0000e130: 2020 2023 204e 6565 6420 746f 2063 6f6e     # Need to con
-0000e140: 7665 7274 2074 6f20 6172 7261 7920 6f62  vert to array ob
-0000e150: 6a65 6374 2028 652e 672e 206e 756d 7079  ject (e.g. numpy
-0000e160: 2e6e 6461 7272 6179 206f 720a 2020 2020  .ndarray or.    
-0000e170: 2020 2020 2020 2020 2020 2020 2320 6375              # cu
-0000e180: 7079 2e6e 6461 7272 6179 2920 6173 206e  py.ndarray) as n
-0000e190: 6565 6465 642c 2073 6f20 7765 2063 616e  eeded, so we can
-0000e1a0: 2063 616c 6c20 7468 6520 4e75 6d50 7920   call the NumPy 
-0000e1b0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-0000e1c0: 2020 2020 2020 2020 2023 2061 6761 696e           # again
-0000e1d0: 2061 6e64 2069 7420 6765 7473 2074 6865   and it gets the
-0000e1e0: 2063 6861 6e63 6520 746f 2064 6973 7061   chance to dispa
-0000e1f0: 7463 6820 746f 2074 6865 2072 6967 6874  tch to the right
-0000e200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000e210: 2023 2069 6d70 6c65 6d65 6e74 6174 696f   # implementatio
-0000e220: 6e2e 0a20 2020 2020 2020 2020 2020 2020  n..             
-0000e230: 2020 2061 7267 732c 206b 7761 7267 7320     args, kwargs 
-0000e240: 3d20 636f 6d70 7574 6528 6172 6773 2c20  = compute(args, 
-0000e250: 6b77 6172 6773 290a 2020 2020 2020 2020  kwargs).        
-0000e260: 2020 2020 2020 2020 7265 7475 726e 2066          return f
-0000e270: 756e 6328 2a61 7267 732c 202a 2a6b 7761  unc(*args, **kwa
-0000e280: 7267 7329 0a0a 2020 2020 2020 2020 2020  rgs)..          
-0000e290: 2020 7265 7475 726e 205f 4841 4e44 4c45    return _HANDLE
-0000e2a0: 445f 4655 4e43 5449 4f4e 535b 6675 6e63  D_FUNCTIONS[func
-0000e2b0: 5d28 2a61 7267 732c 202a 2a6b 7761 7267  ](*args, **kwarg
-0000e2c0: 7329 0a0a 2020 2020 2020 2020 2320 4669  s)..        # Fi
-0000e2d0: 7273 742c 2076 6572 6966 7920 7468 6174  rst, verify that
-0000e2e0: 2061 6c6c 2074 7970 6573 2061 7265 2068   all types are h
-0000e2f0: 616e 646c 6564 2062 7920 4461 736b 2e20  andled by Dask. 
-0000e300: 4f74 6865 7277 6973 652c 2072 6574 7572  Otherwise, retur
-0000e310: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
-0000e320: 2e0a 2020 2020 2020 2020 6966 206e 6f74  ..        if not
-0000e330: 2061 6c6c 280a 2020 2020 2020 2020 2020   all(.          
-0000e340: 2020 2320 4163 6365 7074 206f 7572 206f    # Accept our o
-0000e350: 776e 2073 7570 6572 636c 6173 7365 7320  wn superclasses 
-0000e360: 6173 2072 6563 6f6d 6d65 6e64 6564 2062  as recommended b
-0000e370: 7920 4e45 502d 3133 0a20 2020 2020 2020  y NEP-13.       
-0000e380: 2020 2020 2023 2028 6874 7470 733a 2f2f       # (https://
-0000e390: 6e75 6d70 792e 6f72 672f 6e65 7073 2f6e  numpy.org/neps/n
-0000e3a0: 6570 2d30 3031 332d 7566 756e 632d 6f76  ep-0013-ufunc-ov
-0000e3b0: 6572 7269 6465 732e 6874 6d6c 2373 7562  errides.html#sub
-0000e3c0: 636c 6173 732d 6869 6572 6172 6368 6965  class-hierarchie
-0000e3d0: 7329 0a20 2020 2020 2020 2020 2020 2069  s).            i
-0000e3e0: 7373 7562 636c 6173 7328 7479 7065 2873  ssubclass(type(s
-0000e3f0: 656c 6629 2c20 7479 7065 5f29 206f 7220  elf), type_) or 
-0000e400: 6973 5f76 616c 6964 5f63 6875 6e6b 5f74  is_valid_chunk_t
-0000e410: 7970 6528 7479 7065 5f29 0a20 2020 2020  ype(type_).     
-0000e420: 2020 2020 2020 2066 6f72 2074 7970 655f         for type_
-0000e430: 2069 6e20 7479 7065 730a 2020 2020 2020   in types.      
-0000e440: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0000e450: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
-0000e460: 6d65 6e74 6564 0a0a 2020 2020 2020 2020  mented..        
-0000e470: 2320 4e6f 7720 7472 7920 746f 2066 696e  # Now try to fin
-0000e480: 6420 6120 6d61 7463 6869 6e67 2066 756e  d a matching fun
-0000e490: 6374 696f 6e20 6e61 6d65 2e20 2049 6620  ction name.  If 
-0000e4a0: 7468 6174 2064 6f65 736e 2774 2077 6f72  that doesn't wor
-0000e4b0: 6b2c 2077 6520 6d61 790a 2020 2020 2020  k, we may.      
-0000e4c0: 2020 2320 6265 2064 6561 6c69 6e67 2077    # be dealing w
-0000e4d0: 6974 6820 616e 2061 6c69 6173 206f 7220  ith an alias or 
-0000e4e0: 6120 6675 6e63 7469 6f6e 2074 6861 7427  a function that'
-0000e4f0: 7320 7369 6d70 6c79 206e 6f74 2069 6e20  s simply not in 
-0000e500: 7468 6520 4461 736b 2041 5049 2e0a 2020  the Dask API..  
-0000e510: 2020 2020 2020 2320 4861 6e64 6c65 2061        # Handle a
-0000e520: 6c69 6173 6573 2076 6961 2074 6865 205f  liases via the _
-0000e530: 4841 4e44 4c45 445f 4655 4e43 5449 4f4e  HANDLED_FUNCTION
-0000e540: 5320 6469 6374 206d 6170 7069 6e67 2c20  S dict mapping, 
-0000e550: 616e 6420 7761 726e 206f 7468 6572 7769  and warn otherwi
-0000e560: 7365 2e0a 2020 2020 2020 2020 666f 7220  se..        for 
-0000e570: 7375 626d 6f64 756c 6520 696e 2066 756e  submodule in fun
-0000e580: 632e 5f5f 6d6f 6475 6c65 5f5f 2e73 706c  c.__module__.spl
-0000e590: 6974 2822 2e22 295b 313a 5d3a 0a20 2020  it(".")[1:]:.   
-0000e5a0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000e5b0: 2020 2020 2020 2020 2020 2020 2020 6d6f                mo
-0000e5c0: 6475 6c65 203d 2067 6574 6174 7472 286d  dule = getattr(m
-0000e5d0: 6f64 756c 652c 2073 7562 6d6f 6475 6c65  odule, submodule
-0000e5e0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
-0000e5f0: 6365 7074 2041 7474 7269 6275 7465 4572  cept AttributeEr
-0000e600: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
-0000e610: 2020 2020 2072 6574 7572 6e20 6861 6e64       return hand
-0000e620: 6c65 5f6e 6f6e 6d61 7463 6869 6e67 5f6e  le_nonmatching_n
-0000e630: 616d 6573 2866 756e 632c 2061 7267 732c  ames(func, args,
-0000e640: 206b 7761 7267 7329 0a0a 2020 2020 2020   kwargs)..      
-0000e650: 2020 6966 206e 6f74 2068 6173 6174 7472    if not hasattr
-0000e660: 286d 6f64 756c 652c 2066 756e 632e 5f5f  (module, func.__
-0000e670: 6e61 6d65 5f5f 293a 0a20 2020 2020 2020  name__):.       
-0000e680: 2020 2020 2072 6574 7572 6e20 6861 6e64       return hand
-0000e690: 6c65 5f6e 6f6e 6d61 7463 6869 6e67 5f6e  le_nonmatching_n
-0000e6a0: 616d 6573 2866 756e 632c 2061 7267 732c  ames(func, args,
-0000e6b0: 206b 7761 7267 7329 0a0a 2020 2020 2020   kwargs)..      
-0000e6c0: 2020 6461 5f66 756e 6320 3d20 6765 7461    da_func = geta
-0000e6d0: 7474 7228 6d6f 6475 6c65 2c20 6675 6e63  ttr(module, func
-0000e6e0: 2e5f 5f6e 616d 655f 5f29 0a20 2020 2020  .__name__).     
-0000e6f0: 2020 2069 6620 6461 5f66 756e 6320 6973     if da_func is
-0000e700: 2066 756e 633a 0a20 2020 2020 2020 2020   func:.         
-0000e710: 2020 2072 6574 7572 6e20 6861 6e64 6c65     return handle
-0000e720: 5f6e 6f6e 6d61 7463 6869 6e67 5f6e 616d  _nonmatching_nam
-0000e730: 6573 2866 756e 632c 2061 7267 732c 206b  es(func, args, k
-0000e740: 7761 7267 7329 0a0a 2020 2020 2020 2020  wargs)..        
-0000e750: 2320 4966 2060 606c 696b 6560 6020 6973  # If ``like`` is
-0000e760: 2063 6f6e 7461 696e 6564 2069 6e20 6060   contained in ``
-0000e770: 6461 5f66 756e 6360 6027 7320 7369 676e  da_func``'s sign
-0000e780: 6174 7572 652c 2061 6464 2060 606c 696b  ature, add ``lik
-0000e790: 653d 7365 6c66 6060 0a20 2020 2020 2020  e=self``.       
-0000e7a0: 2023 2074 6f20 7468 6520 6b77 6172 6773   # to the kwargs
-0000e7b0: 2064 6963 7469 6f6e 6172 792e 0a20 2020   dictionary..   
-0000e7c0: 2020 2020 2069 6620 6861 735f 6b65 7977       if has_keyw
-0000e7d0: 6f72 6428 6461 5f66 756e 632c 2022 6c69  ord(da_func, "li
-0000e7e0: 6b65 2229 3a0a 2020 2020 2020 2020 2020  ke"):.          
-0000e7f0: 2020 6b77 6172 6773 5b22 6c69 6b65 225d    kwargs["like"]
-0000e800: 203d 2073 656c 660a 0a20 2020 2020 2020   = self..       
-0000e810: 2072 6574 7572 6e20 6461 5f66 756e 6328   return da_func(
-0000e820: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
-0000e830: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-0000e840: 2020 2020 6465 6620 5f65 6c65 6d77 6973      def _elemwis
-0000e850: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0000e860: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
-0000e870: 0a0a 2020 2020 4077 7261 7073 2873 746f  ..    @wraps(sto
-0000e880: 7265 290a 2020 2020 6465 6620 7374 6f72  re).    def stor
-0000e890: 6528 7365 6c66 2c20 7461 7267 6574 2c20  e(self, target, 
-0000e8a0: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0000e8b0: 2020 2072 203d 2073 746f 7265 285b 7365     r = store([se
-0000e8c0: 6c66 5d2c 205b 7461 7267 6574 5d2c 202a  lf], [target], *
-0000e8d0: 2a6b 7761 7267 7329 0a0a 2020 2020 2020  *kwargs)..      
-0000e8e0: 2020 6966 206b 7761 7267 732e 6765 7428    if kwargs.get(
-0000e8f0: 2272 6574 7572 6e5f 7374 6f72 6564 222c  "return_stored",
-0000e900: 2046 616c 7365 293a 0a20 2020 2020 2020   False):.       
-0000e910: 2020 2020 2072 203d 2072 5b30 5d0a 0a20       r = r[0].. 
-0000e920: 2020 2020 2020 2072 6574 7572 6e20 720a         return r.
-0000e930: 0a20 2020 2064 6566 2074 6f5f 7376 6728  .    def to_svg(
-0000e940: 7365 6c66 2c20 7369 7a65 3d35 3030 293a  self, size=500):
-0000e950: 0a20 2020 2020 2020 2022 2222 436f 6e76  .        """Conv
-0000e960: 6572 7420 6368 756e 6b73 2066 726f 6d20  ert chunks from 
-0000e970: 4461 736b 2041 7272 6179 2069 6e74 6f20  Dask Array into 
-0000e980: 616e 2053 5647 2049 6d61 6765 0a0a 2020  an SVG Image..  
-0000e990: 2020 2020 2020 5061 7261 6d65 7465 7273        Parameters
-0000e9a0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0000e9b0: 2d2d 2d0a 2020 2020 2020 2020 6368 756e  ---.        chun
-0000e9c0: 6b73 3a20 7475 706c 650a 2020 2020 2020  ks: tuple.      
-0000e9d0: 2020 7369 7a65 3a20 696e 740a 2020 2020    size: int.    
-0000e9e0: 2020 2020 2020 2020 526f 7567 6820 7369          Rough si
-0000e9f0: 7a65 206f 6620 7468 6520 696d 6167 650a  ze of the image.
-0000ea00: 0a20 2020 2020 2020 2045 7861 6d70 6c65  .        Example
-0000ea10: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
-0000ea20: 2d2d 0a20 2020 2020 2020 203e 3e3e 2078  --.        >>> x
-0000ea30: 2e74 6f5f 7376 6728 7369 7a65 3d35 3030  .to_svg(size=500
-0000ea40: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-0000ea50: 4b49 500a 0a20 2020 2020 2020 2052 6574  KIP..        Ret
-0000ea60: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
-0000ea70: 2d2d 2d2d 0a20 2020 2020 2020 2074 6578  ----.        tex
-0000ea80: 743a 2041 6e20 7376 6720 7374 7269 6e67  t: An svg string
-0000ea90: 2064 6570 6963 7469 6e67 2074 6865 2061   depicting the a
-0000eaa0: 7272 6179 2061 7320 6120 6772 6964 206f  rray as a grid o
-0000eab0: 6620 6368 756e 6b73 0a20 2020 2020 2020  f chunks.       
-0000eac0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-0000ead0: 6d20 6461 736b 2e61 7272 6179 2e73 7667  m dask.array.svg
-0000eae0: 2069 6d70 6f72 7420 7376 670a 0a20 2020   import svg..   
-0000eaf0: 2020 2020 2072 6574 7572 6e20 7376 6728       return svg(
-0000eb00: 7365 6c66 2e63 6875 6e6b 732c 2073 697a  self.chunks, siz
-0000eb10: 653d 7369 7a65 290a 0a20 2020 2064 6566  e=size)..    def
-0000eb20: 2074 6f5f 6864 6635 2873 656c 662c 2066   to_hdf5(self, f
-0000eb30: 696c 656e 616d 652c 2064 6174 6170 6174  ilename, datapat
-0000eb40: 682c 202a 2a6b 7761 7267 7329 3a0a 2020  h, **kwargs):.  
-0000eb50: 2020 2020 2020 2222 2253 746f 7265 2061        """Store a
-0000eb60: 7272 6179 2069 6e20 4844 4635 2066 696c  rray in HDF5 fil
-0000eb70: 650a 0a20 2020 2020 2020 203e 3e3e 2078  e..        >>> x
-0000eb80: 2e74 6f5f 6864 6635 2827 6d79 6669 6c65  .to_hdf5('myfile
-0000eb90: 2e68 6466 3527 2c20 272f 7827 2920 2023  .hdf5', '/x')  #
-0000eba0: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
-0000ebb0: 0a20 2020 2020 2020 204f 7074 696f 6e61  .        Optiona
-0000ebc0: 6c6c 7920 7072 6f76 6964 6520 6172 6775  lly provide argu
-0000ebd0: 6d65 6e74 7320 6173 2074 686f 7567 6820  ments as though 
-0000ebe0: 746f 2060 6068 3570 792e 4669 6c65 2e63  to ``h5py.File.c
-0000ebf0: 7265 6174 655f 6461 7461 7365 7460 600a  reate_dataset``.
-0000ec00: 0a20 2020 2020 2020 203e 3e3e 2078 2e74  .        >>> x.t
-0000ec10: 6f5f 6864 6635 2827 6d79 6669 6c65 2e68  o_hdf5('myfile.h
-0000ec20: 6466 3527 2c20 272f 7827 2c20 636f 6d70  df5', '/x', comp
-0000ec30: 7265 7373 696f 6e3d 276c 7a66 272c 2073  ression='lzf', s
-0000ec40: 6875 6666 6c65 3d54 7275 6529 2020 2320  huffle=True)  # 
-0000ec50: 646f 6374 6573 743a 202b 534b 4950 0a0a  doctest: +SKIP..
-0000ec60: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-0000ec70: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-0000ec80: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
-0000ec90: 7272 6179 2e73 746f 7265 0a20 2020 2020  rray.store.     
-0000eca0: 2020 2068 3570 792e 4669 6c65 2e63 7265     h5py.File.cre
-0000ecb0: 6174 655f 6461 7461 7365 740a 2020 2020  ate_dataset.    
-0000ecc0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000ecd0: 7265 7475 726e 2074 6f5f 6864 6635 2866  return to_hdf5(f
-0000ece0: 696c 656e 616d 652c 2064 6174 6170 6174  ilename, datapat
-0000ecf0: 682c 2073 656c 662c 202a 2a6b 7761 7267  h, self, **kwarg
-0000ed00: 7329 0a0a 2020 2020 6465 6620 746f 5f64  s)..    def to_d
-0000ed10: 6173 6b5f 6461 7461 6672 616d 6528 7365  ask_dataframe(se
-0000ed20: 6c66 2c20 636f 6c75 6d6e 733d 4e6f 6e65  lf, columns=None
-0000ed30: 2c20 696e 6465 783d 4e6f 6e65 2c20 6d65  , index=None, me
-0000ed40: 7461 3d4e 6f6e 6529 3a0a 2020 2020 2020  ta=None):.      
-0000ed50: 2020 2222 2243 6f6e 7665 7274 2064 6173    """Convert das
-0000ed60: 6b20 4172 7261 7920 746f 2064 6173 6b20  k Array to dask 
-0000ed70: 4461 7461 6672 616d 650a 0a20 2020 2020  Dataframe..     
-0000ed80: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
-0000ed90: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
-0000eda0: 0a20 2020 2020 2020 2063 6f6c 756d 6e73  .        columns
-0000edb0: 3a20 6c69 7374 206f 7220 7374 7269 6e67  : list or string
-0000edc0: 0a20 2020 2020 2020 2020 2020 206c 6973  .            lis
-0000edd0: 7420 6f66 2063 6f6c 756d 6e20 6e61 6d65  t of column name
-0000ede0: 7320 6966 2044 6174 6146 7261 6d65 2c20  s if DataFrame, 
-0000edf0: 7369 6e67 6c65 2073 7472 696e 6720 6966  single string if
-0000ee00: 2053 6572 6965 730a 2020 2020 2020 2020   Series.        
-0000ee10: 696e 6465 7820 3a20 6461 736b 2e64 6174  index : dask.dat
-0000ee20: 6166 7261 6d65 2e49 6e64 6578 2c20 6f70  aframe.Index, op
-0000ee30: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-0000ee40: 2020 2041 6e20 6f70 7469 6f6e 616c 202a     An optional *
-0000ee50: 6461 736b 2a20 496e 6465 7820 746f 2075  dask* Index to u
-0000ee60: 7365 2066 6f72 2074 6865 206f 7574 7075  se for the outpu
-0000ee70: 7420 5365 7269 6573 206f 7220 4461 7461  t Series or Data
-0000ee80: 4672 616d 652e 0a0a 2020 2020 2020 2020  Frame...        
-0000ee90: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-0000eea0: 6f75 7470 7574 2069 6e64 6578 2064 6570  output index dep
-0000eeb0: 656e 6473 206f 6e20 7768 6574 6865 7220  ends on whether 
-0000eec0: 7468 6520 6172 7261 7920 6861 7320 616e  the array has an
-0000eed0: 7920 756e 6b6e 6f77 6e0a 2020 2020 2020  y unknown.      
-0000eee0: 2020 2020 2020 6368 756e 6b73 2e20 4966        chunks. If
-0000eef0: 2074 6865 7265 2061 7265 2061 6e79 2075   there are any u
-0000ef00: 6e6b 6e6f 776e 2063 6875 6e6b 732c 2074  nknown chunks, t
-0000ef10: 6865 206f 7574 7075 7420 6861 7320 6060  he output has ``
-0000ef20: 4e6f 6e65 6060 0a20 2020 2020 2020 2020  None``.         
-0000ef30: 2020 2066 6f72 2061 6c6c 2074 6865 2064     for all the d
-0000ef40: 6976 6973 696f 6e73 2028 6f6e 6520 7065  ivisions (one pe
-0000ef50: 7220 6368 756e 6b29 2e20 4966 2061 6c6c  r chunk). If all
-0000ef60: 2074 6865 2063 6875 6e6b 7320 6172 6520   the chunks are 
-0000ef70: 6b6e 6f77 6e2c 0a20 2020 2020 2020 2020  known,.         
-0000ef80: 2020 2061 2064 6566 6175 6c74 2069 6e64     a default ind
-0000ef90: 6578 2077 6974 6820 6b6e 6f77 6e20 6469  ex with known di
-0000efa0: 7669 7369 6f6e 7320 6973 2063 7265 6174  visions is creat
-0000efb0: 6564 2e0a 0a20 2020 2020 2020 2020 2020  ed...           
-0000efc0: 2053 7065 6369 6679 696e 6720 6060 696e   Specifying ``in
-0000efd0: 6465 7860 6020 6361 6e20 6265 2075 7365  dex`` can be use
-0000efe0: 6675 6c20 6966 2079 6f75 2772 6520 636f  ful if you're co
-0000eff0: 6e66 6f72 6d69 6e67 2061 2044 6173 6b20  nforming a Dask 
-0000f000: 4172 7261 790a 2020 2020 2020 2020 2020  Array.          
-0000f010: 2020 746f 2061 6e20 6578 6973 7469 6e67    to an existing
-0000f020: 2064 6173 6b20 5365 7269 6573 206f 7220   dask Series or 
-0000f030: 4461 7461 4672 616d 652c 2061 6e64 2079  DataFrame, and y
-0000f040: 6f75 2077 6f75 6c64 206c 696b 6520 7468  ou would like th
-0000f050: 650a 2020 2020 2020 2020 2020 2020 696e  e.            in
-0000f060: 6469 6365 7320 746f 206d 6174 6368 2e0a  dices to match..
-0000f070: 2020 2020 2020 2020 6d65 7461 203a 206f          meta : o
-0000f080: 626a 6563 742c 206f 7074 696f 6e61 6c0a  bject, optional.
-0000f090: 2020 2020 2020 2020 2020 2020 416e 206f              An o
-0000f0a0: 7074 696f 6e61 6c20 606d 6574 6160 2070  ptional `meta` p
-0000f0b0: 6172 616d 6574 6572 2063 616e 2062 6520  arameter can be 
-0000f0c0: 7061 7373 6564 2066 6f72 2064 6173 6b0a  passed for dask.
-0000f0d0: 2020 2020 2020 2020 2020 2020 746f 2073              to s
-0000f0e0: 7065 6369 6679 2074 6865 2063 6f6e 6372  pecify the concr
-0000f0f0: 6574 6520 6461 7461 6672 616d 6520 7479  ete dataframe ty
-0000f100: 7065 2074 6f20 7573 6520 666f 7220 7061  pe to use for pa
-0000f110: 7274 6974 696f 6e73 206f 660a 2020 2020  rtitions of.    
-0000f120: 2020 2020 2020 2020 7468 6520 4461 736b          the Dask
-0000f130: 2064 6174 6166 7261 6d65 2e20 4279 2064   dataframe. By d
-0000f140: 6566 6175 6c74 2c20 7061 6e64 6173 2044  efault, pandas D
-0000f150: 6174 6146 7261 6d65 2069 7320 7573 6564  ataFrame is used
-0000f160: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-0000f170: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-0000f180: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
-0000f190: 6b2e 6461 7461 6672 616d 652e 6672 6f6d  k.dataframe.from
-0000f1a0: 5f64 6173 6b5f 6172 7261 790a 2020 2020  _dask_array.    
-0000f1b0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000f1c0: 6672 6f6d 2064 6173 6b2e 6461 7461 6672  from dask.datafr
-0000f1d0: 616d 6520 696d 706f 7274 2066 726f 6d5f  ame import from_
-0000f1e0: 6461 736b 5f61 7272 6179 0a0a 2020 2020  dask_array..    
-0000f1f0: 2020 2020 7265 7475 726e 2066 726f 6d5f      return from_
-0000f200: 6461 736b 5f61 7272 6179 2873 656c 662c  dask_array(self,
-0000f210: 2063 6f6c 756d 6e73 3d63 6f6c 756d 6e73   columns=columns
-0000f220: 2c20 696e 6465 783d 696e 6465 782c 206d  , index=index, m
-0000f230: 6574 613d 6d65 7461 290a 0a20 2020 2064  eta=meta)..    d
-0000f240: 6566 2074 6f5f 6261 636b 656e 6428 7365  ef to_backend(se
-0000f250: 6c66 2c20 6261 636b 656e 643a 2073 7472  lf, backend: str
-0000f260: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c20   | None = None, 
-0000f270: 2a2a 6b77 6172 6773 293a 0a20 2020 2020  **kwargs):.     
-0000f280: 2020 2022 2222 4d6f 7665 2074 6f20 6120     """Move to a 
-0000f290: 6e65 7720 4172 7261 7920 6261 636b 656e  new Array backen
-0000f2a0: 640a 0a20 2020 2020 2020 2050 6172 616d  d..        Param
-0000f2b0: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
-0000f2c0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-0000f2d0: 2062 6163 6b65 6e64 203a 2073 7472 2c20   backend : str, 
-0000f2e0: 4f70 7469 6f6e 616c 0a20 2020 2020 2020  Optional.       
-0000f2f0: 2020 2020 2054 6865 206e 616d 6520 6f66       The name of
-0000f300: 2074 6865 206e 6577 2062 6163 6b65 6e64   the new backend
-0000f310: 2074 6f20 6d6f 7665 2074 6f2e 2054 6865   to move to. The
-0000f320: 2064 6566 6175 6c74 0a20 2020 2020 2020   default.       
-0000f330: 2020 2020 2069 7320 7468 6520 6375 7272       is the curr
-0000f340: 656e 7420 2261 7272 6179 2e62 6163 6b65  ent "array.backe
-0000f350: 6e64 2220 636f 6e66 6967 7572 6174 696f  nd" configuratio
-0000f360: 6e2e 0a0a 2020 2020 2020 2020 5265 7475  n...        Retu
-0000f370: 726e 730a 2020 2020 2020 2020 2d2d 2d2d  rns.        ----
-0000f380: 2d2d 2d0a 2020 2020 2020 2020 4172 7261  ---.        Arra
-0000f390: 790a 2020 2020 2020 2020 2222 220a 2020  y.        """.  
-0000f3a0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-0000f3b0: 6172 7261 792e 6372 6561 7469 6f6e 2069  array.creation i
-0000f3c0: 6d70 6f72 7420 746f 5f62 6163 6b65 6e64  mport to_backend
-0000f3d0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000f3e0: 2074 6f5f 6261 636b 656e 6428 7365 6c66   to_backend(self
-0000f3f0: 2c20 6261 636b 656e 643d 6261 636b 656e  , backend=backen
-0000f400: 642c 202a 2a6b 7761 7267 7329 0a0a 2020  d, **kwargs)..  
-0000f410: 2020 6465 6620 5f5f 626f 6f6c 5f5f 2873    def __bool__(s
-0000f420: 656c 6629 3a0a 2020 2020 2020 2020 6966  elf):.        if
-0000f430: 2073 656c 662e 7369 7a65 203e 2031 3a0a   self.size > 1:.
-0000f440: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f450: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
-0000f460: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000f470: 5468 6520 7472 7574 6820 7661 6c75 6520  The truth value 
-0000f480: 6f66 2061 207b 7365 6c66 2e5f 5f63 6c61  of a {self.__cla
-0000f490: 7373 5f5f 2e5f 5f6e 616d 655f 5f7d 2069  ss__.__name__} i
-0000f4a0: 7320 616d 6269 6775 6f75 732e 2022 0a20  s ambiguous. ". 
-0000f4b0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000f4c0: 5573 6520 612e 616e 7928 2920 6f72 2061  Use a.any() or a
-0000f4d0: 2e61 6c6c 2829 2e22 0a20 2020 2020 2020  .all().".       
-0000f4e0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-0000f4f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000f500: 2072 6574 7572 6e20 626f 6f6c 2873 656c   return bool(sel
-0000f510: 662e 636f 6d70 7574 6528 2929 0a0a 2020  f.compute())..  
-0000f520: 2020 5f5f 6e6f 6e7a 6572 6f5f 5f20 3d20    __nonzero__ = 
-0000f530: 5f5f 626f 6f6c 5f5f 2020 2320 7079 7468  __bool__  # pyth
-0000f540: 6f6e 2032 0a0a 2020 2020 6465 6620 5f73  on 2..    def _s
-0000f550: 6361 6c61 7266 756e 6328 7365 6c66 2c20  calarfunc(self, 
-0000f560: 6361 7374 5f74 7970 6529 3a0a 2020 2020  cast_type):.    
-0000f570: 2020 2020 6966 2073 656c 662e 7369 7a65      if self.size
-0000f580: 203e 2031 3a0a 2020 2020 2020 2020 2020   > 1:.          
-0000f590: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
-0000f5a0: 7228 224f 6e6c 7920 6c65 6e67 7468 2d31  r("Only length-1
-0000f5b0: 2061 7272 6179 7320 6361 6e20 6265 2063   arrays can be c
-0000f5c0: 6f6e 7665 7274 6564 2074 6f20 5079 7468  onverted to Pyth
-0000f5d0: 6f6e 2073 6361 6c61 7273 2229 0a20 2020  on scalars").   
-0000f5e0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000f5f0: 2020 2020 2020 2072 6574 7572 6e20 6361         return ca
-0000f600: 7374 5f74 7970 6528 7365 6c66 2e63 6f6d  st_type(self.com
-0000f610: 7075 7465 2829 2e69 7465 6d28 2929 0a0a  pute().item())..
-0000f620: 2020 2020 6465 6620 5f5f 696e 745f 5f28      def __int__(
-0000f630: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-0000f640: 6574 7572 6e20 7365 6c66 2e5f 7363 616c  eturn self._scal
-0000f650: 6172 6675 6e63 2869 6e74 290a 0a20 2020  arfunc(int)..   
-0000f660: 205f 5f6c 6f6e 675f 5f20 3d20 5f5f 696e   __long__ = __in
-0000f670: 745f 5f20 2023 2070 7974 686f 6e20 320a  t__  # python 2.
-0000f680: 0a20 2020 2064 6566 205f 5f66 6c6f 6174  .    def __float
-0000f690: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
-0000f6a0: 2020 7265 7475 726e 2073 656c 662e 5f73    return self._s
-0000f6b0: 6361 6c61 7266 756e 6328 666c 6f61 7429  calarfunc(float)
-0000f6c0: 0a0a 2020 2020 6465 6620 5f5f 636f 6d70  ..    def __comp
-0000f6d0: 6c65 785f 5f28 7365 6c66 293a 0a20 2020  lex__(self):.   
-0000f6e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
-0000f6f0: 2e5f 7363 616c 6172 6675 6e63 2863 6f6d  ._scalarfunc(com
-0000f700: 706c 6578 290a 0a20 2020 2064 6566 205f  plex)..    def _
-0000f710: 5f69 6e64 6578 5f5f 2873 656c 6629 3a0a  _index__(self):.
-0000f720: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000f730: 656c 662e 5f73 6361 6c61 7266 756e 6328  elf._scalarfunc(
-0000f740: 6f70 6572 6174 6f72 2e69 6e64 6578 290a  operator.index).
-0000f750: 0a20 2020 2064 6566 205f 5f73 6574 6974  .    def __setit
-0000f760: 656d 5f5f 2873 656c 662c 206b 6579 2c20  em__(self, key, 
-0000f770: 7661 6c75 6529 3a0a 2020 2020 2020 2020  value):.        
-0000f780: 6966 2076 616c 7565 2069 7320 6e70 2e6d  if value is np.m
-0000f790: 612e 6d61 736b 6564 3a0a 2020 2020 2020  a.masked:.      
-0000f7a0: 2020 2020 2020 7661 6c75 6520 3d20 6e70        value = np
-0000f7b0: 2e6d 612e 6d61 736b 6564 5f61 6c6c 2828  .ma.masked_all((
-0000f7c0: 292c 2064 7479 7065 3d73 656c 662e 6474  ), dtype=self.dt
-0000f7d0: 7970 6529 0a0a 2020 2020 2020 2020 6966  ype)..        if
-0000f7e0: 2028 0a20 2020 2020 2020 2020 2020 206e   (.            n
-0000f7f0: 6f74 2069 735f 6461 736b 5f63 6f6c 6c65  ot is_dask_colle
-0000f800: 6374 696f 6e28 7661 6c75 6529 0a20 2020  ction(value).   
-0000f810: 2020 2020 2020 2020 2061 6e64 2069 7373           and iss
-0000f820: 7562 636c 6173 7328 7365 6c66 2e64 7479  ubclass(self.dty
-0000f830: 7065 2e74 7970 652c 2049 6e74 6567 7261  pe.type, Integra
-0000f840: 6c29 0a20 2020 2020 2020 2020 2020 2061  l).            a
-0000f850: 6e64 206e 702e 6973 6e61 6e28 7661 6c75  nd np.isnan(valu
-0000f860: 6529 2e61 6e79 2829 0a20 2020 2020 2020  e).any().       
-0000f870: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
-0000f880: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000f890: 2822 6361 6e6e 6f74 2063 6f6e 7665 7274  ("cannot convert
-0000f8a0: 2066 6c6f 6174 204e 614e 2074 6f20 696e   float NaN to in
-0000f8b0: 7465 6765 7222 290a 0a20 2020 2020 2020  teger")..       
-0000f8c0: 2023 2320 5573 6520 7468 6520 2277 6865   ## Use the "whe
-0000f8d0: 7265 2220 6d65 7468 6f64 2066 6f72 2063  re" method for c
-0000f8e0: 6173 6573 2077 6865 6e20 6b65 7920 6973  ases when key is
-0000f8f0: 2061 6e20 4172 7261 790a 2020 2020 2020   an Array.      
-0000f900: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0000f910: 6b65 792c 2041 7272 6179 293a 0a20 2020  key, Array):.   
-0000f920: 2020 2020 2020 2020 2066 726f 6d20 6461           from da
-0000f930: 736b 2e61 7272 6179 2e72 6f75 7469 6e65  sk.array.routine
-0000f940: 7320 696d 706f 7274 2077 6865 7265 0a0a  s import where..
-0000f950: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000f960: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
-0000f970: 2041 7272 6179 2920 616e 6420 7661 6c75   Array) and valu
-0000f980: 652e 6e64 696d 203e 2031 3a0a 2020 2020  e.ndim > 1:.    
-0000f990: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000f9a0: 6520 5661 6c75 6545 7272 6f72 2822 626f  e ValueError("bo
-0000f9b0: 6f6c 6561 6e20 696e 6465 7820 6172 7261  olean index arra
-0000f9c0: 7920 7368 6f75 6c64 2068 6176 6520 3120  y should have 1 
-0000f9d0: 6469 6d65 6e73 696f 6e22 290a 2020 2020  dimension").    
-0000f9e0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000f9f0: 2020 2020 2020 2020 2020 2020 2079 203d               y =
-0000fa00: 2077 6865 7265 286b 6579 2c20 7661 6c75   where(key, valu
-0000fa10: 652c 2073 656c 6629 0a20 2020 2020 2020  e, self).       
-0000fa20: 2020 2020 2065 7863 6570 7420 5661 6c75       except Valu
-0000fa30: 6545 7272 6f72 2061 7320 653a 0a20 2020  eError as e:.   
-0000fa40: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0000fa50: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-0000fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa70: 2020 2022 426f 6f6c 6561 6e20 696e 6465     "Boolean inde
-0000fa80: 7820 6173 7369 676e 6d65 6e74 2069 6e20  x assignment in 
-0000fa90: 4461 736b 2022 0a20 2020 2020 2020 2020  Dask ".         
-0000faa0: 2020 2020 2020 2020 2020 2022 6578 7065             "expe
-0000fab0: 6374 7320 6571 7561 6c6c 7920 7368 6170  cts equally shap
-0000fac0: 6564 2061 7272 6179 732e 5c6e 4578 616d  ed arrays.\nExam
-0000fad0: 706c 653a 2064 6131 5b64 6132 5d20 3d20  ple: da1[da2] = 
-0000fae0: 6461 3320 220a 2020 2020 2020 2020 2020  da3 ".          
-0000faf0: 2020 2020 2020 2020 2020 2277 6865 7265            "where
-0000fb00: 2064 6131 2e73 6861 7065 203d 3d20 2834   da1.shape == (4
-0000fb10: 2c29 2c20 6461 322e 7368 6170 6520 3d3d  ,), da2.shape ==
-0000fb20: 2028 342c 2920 220a 2020 2020 2020 2020   (4,) ".        
-0000fb30: 2020 2020 2020 2020 2020 2020 2261 6e64              "and
-0000fb40: 2064 6133 2e73 6861 7065 203d 3d20 2834   da3.shape == (4
-0000fb50: 2c29 2e5c 6e22 0a20 2020 2020 2020 2020  ,).\n".         
-0000fb60: 2020 2020 2020 2020 2020 2022 416c 7465             "Alte
-0000fb70: 726e 6174 6976 656c 792c 2079 6f75 2063  rnatively, you c
-0000fb80: 616e 2075 7365 2074 6865 2065 7874 656e  an use the exten
-0000fb90: 6465 6420 4150 4920 7468 6174 2073 7570  ded API that sup
-0000fba0: 706f 7274 7322 0a20 2020 2020 2020 2020  ports".         
-0000fbb0: 2020 2020 2020 2020 2020 2022 696e 6465             "inde
-0000fbc0: 7869 6e67 2077 6974 6820 7475 706c 6573  xing with tuples
-0000fbd0: 2e5c 6e45 7861 6d70 6c65 3a20 6461 315b  .\nExample: da1[
-0000fbe0: 2864 6132 2c29 5d20 3d20 6461 332e 220a  (da2,)] = da3.".
-0000fbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fc00: 2920 6672 6f6d 2065 0a20 2020 2020 2020  ) from e.       
-0000fc10: 2020 2020 2073 656c 662e 5f6d 6574 6120       self._meta 
-0000fc20: 3d20 792e 5f6d 6574 610a 2020 2020 2020  = y._meta.      
-0000fc30: 2020 2020 2020 7365 6c66 2e64 6173 6b20        self.dask 
-0000fc40: 3d20 792e 6461 736b 0a20 2020 2020 2020  = y.dask.       
-0000fc50: 2020 2020 2073 656c 662e 5f6e 616d 6520       self._name 
-0000fc60: 3d20 792e 6e61 6d65 0a20 2020 2020 2020  = y.name.       
-0000fc70: 2020 2020 2073 656c 662e 5f63 6875 6e6b       self._chunk
-0000fc80: 7320 3d20 792e 6368 756e 6b73 0a20 2020  s = y.chunks.   
-0000fc90: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
-0000fca0: 0a20 2020 2020 2020 2069 6620 6e70 2e69  .        if np.i
-0000fcb0: 736e 616e 2873 656c 662e 7368 6170 6529  snan(self.shape)
-0000fcc0: 2e61 6e79 2829 3a0a 2020 2020 2020 2020  .any():.        
-0000fcd0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000fce0: 7272 6f72 2866 2241 7272 6179 7320 6368  rror(f"Arrays ch
-0000fcf0: 756e 6b20 7369 7a65 7320 6172 6520 756e  unk sizes are un
-0000fd00: 6b6e 6f77 6e2e 207b 756e 6b6e 6f77 6e5f  known. {unknown_
-0000fd10: 6368 756e 6b5f 6d65 7373 6167 657d 2229  chunk_message}")
-0000fd20: 0a0a 2020 2020 2020 2020 2320 5374 696c  ..        # Stil
-0000fd30: 6c20 6865 7265 3f20 5468 656e 2061 7070  l here? Then app
-0000fd40: 6c79 2074 6865 2061 7373 6967 6e6d 656e  ly the assignmen
-0000fd50: 7420 746f 206f 7468 6572 2074 7970 6520  t to other type 
-0000fd60: 6f66 0a20 2020 2020 2020 2023 2069 6e64  of.        # ind
-0000fd70: 6963 6573 2076 6961 2074 6865 2060 7365  ices via the `se
-0000fd80: 7469 7465 6d5f 6172 7261 7960 2066 756e  titem_array` fun
-0000fd90: 6374 696f 6e2e 0a20 2020 2020 2020 2076  ction..        v
-0000fda0: 616c 7565 203d 2061 7361 6e79 6172 7261  alue = asanyarra
-0000fdb0: 7928 7661 6c75 6529 0a0a 2020 2020 2020  y(value)..      
-0000fdc0: 2020 6f75 7420 3d20 2273 6574 6974 656d    out = "setitem
-0000fdd0: 2d22 202b 2074 6f6b 656e 697a 6528 7365  -" + tokenize(se
-0000fde0: 6c66 2c20 6b65 792c 2076 616c 7565 290a  lf, key, value).
-0000fdf0: 2020 2020 2020 2020 6473 6b20 3d20 7365          dsk = se
-0000fe00: 7469 7465 6d5f 6172 7261 7928 6f75 742c  titem_array(out,
-0000fe10: 2073 656c 662c 206b 6579 2c20 7661 6c75   self, key, valu
-0000fe20: 6529 0a0a 2020 2020 2020 2020 6d65 7461  e)..        meta
-0000fe30: 203d 206d 6574 615f 6672 6f6d 5f61 7272   = meta_from_arr
-0000fe40: 6179 2873 656c 662e 5f6d 6574 6129 0a20  ay(self._meta). 
-0000fe50: 2020 2020 2020 2069 6620 6e70 2e69 7373         if np.iss
-0000fe60: 6361 6c61 7228 6d65 7461 293a 0a20 2020  calar(meta):.   
-0000fe70: 2020 2020 2020 2020 206d 6574 6120 3d20           meta = 
-0000fe80: 6e70 2e61 7272 6179 286d 6574 6129 0a0a  np.array(meta)..
-0000fe90: 2020 2020 2020 2020 6772 6170 6820 3d20          graph = 
-0000fea0: 4869 6768 4c65 7665 6c47 7261 7068 2e66  HighLevelGraph.f
-0000feb0: 726f 6d5f 636f 6c6c 6563 7469 6f6e 7328  rom_collections(
-0000fec0: 6f75 742c 2064 736b 2c20 6465 7065 6e64  out, dsk, depend
-0000fed0: 656e 6369 6573 3d5b 7365 6c66 5d29 0a20  encies=[self]). 
-0000fee0: 2020 2020 2020 2079 203d 2041 7272 6179         y = Array
-0000fef0: 2867 7261 7068 2c20 6f75 742c 2063 6875  (graph, out, chu
-0000ff00: 6e6b 733d 7365 6c66 2e63 6875 6e6b 732c  nks=self.chunks,
-0000ff10: 2064 7479 7065 3d73 656c 662e 6474 7970   dtype=self.dtyp
-0000ff20: 652c 206d 6574 613d 6d65 7461 290a 0a20  e, meta=meta).. 
-0000ff30: 2020 2020 2020 2073 656c 662e 5f6d 6574         self._met
-0000ff40: 6120 3d20 792e 5f6d 6574 610a 2020 2020  a = y._meta.    
-0000ff50: 2020 2020 7365 6c66 2e64 6173 6b20 3d20      self.dask = 
-0000ff60: 792e 6461 736b 0a20 2020 2020 2020 2073  y.dask.        s
-0000ff70: 656c 662e 5f6e 616d 6520 3d20 792e 6e61  elf._name = y.na
-0000ff80: 6d65 0a20 2020 2020 2020 2073 656c 662e  me.        self.
-0000ff90: 5f63 6875 6e6b 7320 3d20 792e 6368 756e  _chunks = y.chun
-0000ffa0: 6b73 0a0a 2020 2020 6465 6620 5f5f 6765  ks..    def __ge
-0000ffb0: 7469 7465 6d5f 5f28 7365 6c66 2c20 696e  titem__(self, in
-0000ffc0: 6465 7829 3a0a 2020 2020 2020 2020 2320  dex):.        # 
-0000ffd0: 4669 656c 6420 6163 6365 7373 2c20 652e  Field access, e.
-0000ffe0: 672e 2078 5b27 6127 5d20 6f72 2078 5b5b  g. x['a'] or x[[
-0000fff0: 2761 272c 2027 6227 5d5d 0a20 2020 2020  'a', 'b']].     
-00010000: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00010010: 2869 6e64 6578 2c20 7374 7229 206f 7220  (index, str) or 
-00010020: 280a 2020 2020 2020 2020 2020 2020 6973  (.            is
-00010030: 696e 7374 616e 6365 2869 6e64 6578 2c20  instance(index, 
-00010040: 6c69 7374 2920 616e 6420 696e 6465 7820  list) and index 
-00010050: 616e 6420 616c 6c28 6973 696e 7374 616e  and all(isinstan
-00010060: 6365 2869 2c20 7374 7229 2066 6f72 2069  ce(i, str) for i
-00010070: 2069 6e20 696e 6465 7829 0a20 2020 2020   in index).     
-00010080: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00010090: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-000100a0: 696e 6465 782c 2073 7472 293a 0a20 2020  index, str):.   
-000100b0: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
-000100c0: 3d20 7365 6c66 2e64 7479 7065 5b69 6e64  = self.dtype[ind
-000100d0: 6578 5d0a 2020 2020 2020 2020 2020 2020  ex].            
-000100e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000100f0: 2020 2020 2020 6474 203d 206e 702e 6474        dt = np.dt
-00010100: 7970 6528 0a20 2020 2020 2020 2020 2020  ype(.           
-00010110: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
-00010120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010130: 2020 2022 6e61 6d65 7322 3a20 696e 6465     "names": inde
-00010140: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-00010150: 2020 2020 2020 2020 2020 2022 666f 726d             "form
-00010160: 6174 7322 3a20 5b73 656c 662e 6474 7970  ats": [self.dtyp
-00010170: 652e 6669 656c 6473 5b6e 616d 655d 5b30  e.fields[name][0
-00010180: 5d20 666f 7220 6e61 6d65 2069 6e20 696e  ] for name in in
-00010190: 6465 785d 2c0a 2020 2020 2020 2020 2020  dex],.          
-000101a0: 2020 2020 2020 2020 2020 2020 2020 226f                "o
-000101b0: 6666 7365 7473 223a 205b 7365 6c66 2e64  ffsets": [self.d
-000101c0: 7479 7065 2e66 6965 6c64 735b 6e61 6d65  type.fields[name
-000101d0: 5d5b 315d 2066 6f72 206e 616d 6520 696e  ][1] for name in
-000101e0: 2069 6e64 6578 5d2c 0a20 2020 2020 2020   index],.       
-000101f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010200: 2022 6974 656d 7369 7a65 223a 2073 656c   "itemsize": sel
-00010210: 662e 6474 7970 652e 6974 656d 7369 7a65  f.dtype.itemsize
-00010220: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00010230: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00010240: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00010250: 2020 2020 2020 2069 6620 6474 2e73 6861         if dt.sha
-00010260: 7065 3a0a 2020 2020 2020 2020 2020 2020  pe:.            
-00010270: 2020 2020 6e65 775f 6178 6973 203d 206c      new_axis = l
-00010280: 6973 7428 7261 6e67 6528 7365 6c66 2e6e  ist(range(self.n
-00010290: 6469 6d2c 2073 656c 662e 6e64 696d 202b  dim, self.ndim +
-000102a0: 206c 656e 2864 742e 7368 6170 6529 2929   len(dt.shape)))
-000102b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000102c0: 2063 6875 6e6b 7320 3d20 7365 6c66 2e63   chunks = self.c
-000102d0: 6875 6e6b 7320 2b20 7475 706c 6528 2869  hunks + tuple((i
-000102e0: 2c29 2066 6f72 2069 2069 6e20 6474 2e73  ,) for i in dt.s
-000102f0: 6861 7065 290a 2020 2020 2020 2020 2020  hape).          
-00010300: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00010310: 662e 6d61 705f 626c 6f63 6b73 280a 2020  f.map_blocks(.  
-00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010330: 2020 6765 7469 7465 6d2c 2069 6e64 6578    getitem, index
-00010340: 2c20 6474 7970 653d 6474 2e62 6173 652c  , dtype=dt.base,
-00010350: 2063 6875 6e6b 733d 6368 756e 6b73 2c20   chunks=chunks, 
-00010360: 6e65 775f 6178 6973 3d6e 6577 5f61 7869  new_axis=new_axi
-00010370: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00010380: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-00010390: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000103a0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-000103b0: 662e 6d61 705f 626c 6f63 6b73 2867 6574  f.map_blocks(get
-000103c0: 6974 656d 2c20 696e 6465 782c 2064 7479  item, index, dty
-000103d0: 7065 3d64 7429 0a0a 2020 2020 2020 2020  pe=dt)..        
-000103e0: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-000103f0: 6528 696e 6465 782c 2074 7570 6c65 293a  e(index, tuple):
-00010400: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
-00010410: 6578 203d 2028 696e 6465 782c 290a 0a20  ex = (index,).. 
-00010420: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
-00010430: 2e61 7272 6179 2e73 6c69 6369 6e67 2069  .array.slicing i
-00010440: 6d70 6f72 7420 280a 2020 2020 2020 2020  mport (.        
-00010450: 2020 2020 6e6f 726d 616c 697a 655f 696e      normalize_in
-00010460: 6465 782c 0a20 2020 2020 2020 2020 2020  dex,.           
-00010470: 2073 6c69 6365 5f77 6974 685f 626f 6f6c   slice_with_bool
-00010480: 5f64 6173 6b5f 6172 7261 792c 0a20 2020  _dask_array,.   
-00010490: 2020 2020 2020 2020 2073 6c69 6365 5f77           slice_w
-000104a0: 6974 685f 696e 745f 6461 736b 5f61 7272  ith_int_dask_arr
-000104b0: 6179 2c0a 2020 2020 2020 2020 290a 0a20  ay,.        ).. 
-000104c0: 2020 2020 2020 2069 6e64 6578 3220 3d20         index2 = 
-000104d0: 6e6f 726d 616c 697a 655f 696e 6465 7828  normalize_index(
-000104e0: 696e 6465 782c 2073 656c 662e 7368 6170  index, self.shap
-000104f0: 6529 0a20 2020 2020 2020 2064 6570 656e  e).        depen
-00010500: 6465 6e63 6965 7320 3d20 7b73 656c 662e  dencies = {self.
-00010510: 6e61 6d65 7d0a 2020 2020 2020 2020 666f  name}.        fo
-00010520: 7220 6920 696e 2069 6e64 6578 323a 0a20  r i in index2:. 
-00010530: 2020 2020 2020 2020 2020 2069 6620 6973             if is
-00010540: 696e 7374 616e 6365 2869 2c20 4172 7261  instance(i, Arra
-00010550: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
-00010560: 2020 2020 6465 7065 6e64 656e 6369 6573      dependencies
-00010570: 2e61 6464 2869 2e6e 616d 6529 0a0a 2020  .add(i.name)..  
-00010580: 2020 2020 2020 6966 2061 6e79 2869 7369        if any(isi
-00010590: 6e73 7461 6e63 6528 692c 2041 7272 6179  nstance(i, Array
-000105a0: 2920 616e 6420 692e 6474 7970 652e 6b69  ) and i.dtype.ki
-000105b0: 6e64 2069 6e20 2269 7522 2066 6f72 2069  nd in "iu" for i
-000105c0: 2069 6e20 696e 6465 7832 293a 0a20 2020   in index2):.   
-000105d0: 2020 2020 2020 2020 2073 656c 662c 2069           self, i
-000105e0: 6e64 6578 3220 3d20 736c 6963 655f 7769  ndex2 = slice_wi
-000105f0: 7468 5f69 6e74 5f64 6173 6b5f 6172 7261  th_int_dask_arra
-00010600: 7928 7365 6c66 2c20 696e 6465 7832 290a  y(self, index2).
-00010610: 2020 2020 2020 2020 6966 2061 6e79 2869          if any(i
-00010620: 7369 6e73 7461 6e63 6528 692c 2041 7272  sinstance(i, Arr
-00010630: 6179 2920 616e 6420 692e 6474 7970 6520  ay) and i.dtype 
-00010640: 3d3d 2062 6f6f 6c20 666f 7220 6920 696e  == bool for i in
-00010650: 2069 6e64 6578 3229 3a0a 2020 2020 2020   index2):.      
-00010660: 2020 2020 2020 7365 6c66 2c20 696e 6465        self, inde
-00010670: 7832 203d 2073 6c69 6365 5f77 6974 685f  x2 = slice_with_
-00010680: 626f 6f6c 5f64 6173 6b5f 6172 7261 7928  bool_dask_array(
-00010690: 7365 6c66 2c20 696e 6465 7832 290a 0a20  self, index2).. 
-000106a0: 2020 2020 2020 2069 6620 616c 6c28 6973         if all(is
-000106b0: 696e 7374 616e 6365 2869 2c20 736c 6963  instance(i, slic
-000106c0: 6529 2061 6e64 2069 203d 3d20 736c 6963  e) and i == slic
-000106d0: 6528 4e6f 6e65 2920 666f 7220 6920 696e  e(None) for i in
-000106e0: 2069 6e64 6578 3229 3a0a 2020 2020 2020   index2):.      
-000106f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-00010700: 660a 0a20 2020 2020 2020 206f 7574 203d  f..        out =
-00010710: 2022 6765 7469 7465 6d2d 2220 2b20 746f   "getitem-" + to
-00010720: 6b65 6e69 7a65 2873 656c 662c 2069 6e64  kenize(self, ind
-00010730: 6578 3229 0a20 2020 2020 2020 2064 736b  ex2).        dsk
-00010740: 2c20 6368 756e 6b73 203d 2073 6c69 6365  , chunks = slice
-00010750: 5f61 7272 6179 286f 7574 2c20 7365 6c66  _array(out, self
-00010760: 2e6e 616d 652c 2073 656c 662e 6368 756e  .name, self.chun
-00010770: 6b73 2c20 696e 6465 7832 2c20 7365 6c66  ks, index2, self
-00010780: 2e69 7465 6d73 697a 6529 0a0a 2020 2020  .itemsize)..    
-00010790: 2020 2020 6772 6170 6820 3d20 4869 6768      graph = High
-000107a0: 4c65 7665 6c47 7261 7068 2e66 726f 6d5f  LevelGraph.from_
-000107b0: 636f 6c6c 6563 7469 6f6e 7328 6f75 742c  collections(out,
-000107c0: 2064 736b 2c20 6465 7065 6e64 656e 6369   dsk, dependenci
-000107d0: 6573 3d5b 7365 6c66 5d29 0a0a 2020 2020  es=[self])..    
-000107e0: 2020 2020 6d65 7461 203d 206d 6574 615f      meta = meta_
-000107f0: 6672 6f6d 5f61 7272 6179 2873 656c 662e  from_array(self.
-00010800: 5f6d 6574 612c 206e 6469 6d3d 6c65 6e28  _meta, ndim=len(
-00010810: 6368 756e 6b73 2929 0a20 2020 2020 2020  chunks)).       
-00010820: 2069 6620 6e70 2e69 7373 6361 6c61 7228   if np.isscalar(
-00010830: 6d65 7461 293a 0a20 2020 2020 2020 2020  meta):.         
-00010840: 2020 206d 6574 6120 3d20 6e70 2e61 7272     meta = np.arr
-00010850: 6179 286d 6574 6129 0a0a 2020 2020 2020  ay(meta)..      
-00010860: 2020 7265 7475 726e 2041 7272 6179 2867    return Array(g
-00010870: 7261 7068 2c20 6f75 742c 2063 6875 6e6b  raph, out, chunk
-00010880: 732c 206d 6574 613d 6d65 7461 290a 0a20  s, meta=meta).. 
-00010890: 2020 2064 6566 205f 7669 6e64 6578 2873     def _vindex(s
-000108a0: 656c 662c 206b 6579 293a 0a20 2020 2020  elf, key):.     
-000108b0: 2020 2069 6620 6e6f 7420 6973 696e 7374     if not isinst
-000108c0: 616e 6365 286b 6579 2c20 7475 706c 6529  ance(key, tuple)
-000108d0: 3a0a 2020 2020 2020 2020 2020 2020 6b65  :.            ke
-000108e0: 7920 3d20 286b 6579 2c29 0a20 2020 2020  y = (key,).     
-000108f0: 2020 2069 6620 616e 7928 6b20 6973 204e     if any(k is N
-00010900: 6f6e 6520 666f 7220 6b20 696e 206b 6579  one for k in key
-00010910: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
-00010920: 6169 7365 2049 6e64 6578 4572 726f 7228  aise IndexError(
-00010930: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010940: 2022 7669 6e64 6578 2064 6f65 7320 6e6f   "vindex does no
-00010950: 7420 7375 7070 6f72 7420 696e 6465 7869  t support indexi
-00010960: 6e67 2077 6974 6820 4e6f 6e65 2028 6e70  ng with None (np
-00010970: 2e6e 6577 6178 6973 292c 2022 0a20 2020  .newaxis), ".   
-00010980: 2020 2020 2020 2020 2020 2020 2022 676f               "go
-00010990: 7420 7b7d 222e 666f 726d 6174 286b 6579  t {}".format(key
-000109a0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-000109b0: 2020 2020 2020 2020 6966 2061 6c6c 2869          if all(i
-000109c0: 7369 6e73 7461 6e63 6528 6b2c 2073 6c69  sinstance(k, sli
-000109d0: 6365 2920 666f 7220 6b20 696e 206b 6579  ce) for k in key
-000109e0: 293a 0a20 2020 2020 2020 2020 2020 2069  ):.            i
-000109f0: 6620 616c 6c28 0a20 2020 2020 2020 2020  f all(.         
-00010a00: 2020 2020 2020 206b 2e69 6e64 6963 6573         k.indices
-00010a10: 2864 2920 3d3d 2073 6c69 6365 2830 2c20  (d) == slice(0, 
-00010a20: 6429 2e69 6e64 6963 6573 2864 2920 666f  d).indices(d) fo
-00010a30: 7220 6b2c 2064 2069 6e20 7a69 7028 6b65  r k, d in zip(ke
-00010a40: 792c 2073 656c 662e 7368 6170 6529 0a20  y, self.shape). 
-00010a50: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-00010a60: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00010a70: 7475 726e 2073 656c 660a 2020 2020 2020  turn self.      
-00010a80: 2020 2020 2020 7261 6973 6520 496e 6465        raise Inde
-00010a90: 7845 7272 6f72 280a 2020 2020 2020 2020  xError(.        
-00010aa0: 2020 2020 2020 2020 2276 696e 6465 7820          "vindex 
-00010ab0: 7265 7175 6972 6573 2061 7420 6c65 6173  requires at leas
-00010ac0: 7420 6f6e 6520 6e6f 6e2d 736c 6963 6520  t one non-slice 
-00010ad0: 746f 2076 6563 746f 7269 7a65 206f 7665  to vectorize ove
-00010ae0: 7220 220a 2020 2020 2020 2020 2020 2020  r ".            
-00010af0: 2020 2020 2277 6865 6e20 7468 6520 736c      "when the sl
-00010b00: 6963 6573 2061 7265 206e 6f74 206f 7665  ices are not ove
-00010b10: 7220 7468 6520 656e 7469 7265 2061 7272  r the entire arr
-00010b20: 6179 2028 692e 652c 2078 5b3a 5d29 2e20  ay (i.e, x[:]). 
-00010b30: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-00010b40: 2020 2255 7365 206e 6f72 6d61 6c20 736c    "Use normal sl
-00010b50: 6963 696e 6720 696e 7374 6561 6420 7768  icing instead wh
-00010b60: 656e 206f 6e6c 7920 7573 696e 6720 736c  en only using sl
-00010b70: 6963 6573 2e20 476f 743a 207b 7d22 2e66  ices. Got: {}".f
-00010b80: 6f72 6d61 7428 6b65 7929 0a20 2020 2020  ormat(key).     
-00010b90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00010ba0: 2065 6c69 6620 616e 7928 6973 5f64 6173   elif any(is_das
-00010bb0: 6b5f 636f 6c6c 6563 7469 6f6e 286b 2920  k_collection(k) 
-00010bc0: 666f 7220 6b20 696e 206b 6579 293a 0a20  for k in key):. 
-00010bd0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-00010be0: 2049 6e64 6578 4572 726f 7228 0a20 2020   IndexError(.   
-00010bf0: 2020 2020 2020 2020 2020 2020 2022 7669               "vi
-00010c00: 6e64 6578 2064 6f65 7320 6e6f 7420 7375  ndex does not su
-00010c10: 7070 6f72 7420 696e 6465 7869 6e67 2077  pport indexing w
-00010c20: 6974 6820 6461 736b 206f 626a 6563 7473  ith dask objects
-00010c30: 2e20 4361 6c6c 2063 6f6d 7075 7465 2022  . Call compute "
-00010c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00010c50: 2022 6f6e 2074 6865 2069 6e64 6578 6572   "on the indexer
-00010c60: 2066 6972 7374 2074 6f20 6765 7420 616e   first to get an
-00010c70: 2065 7661 6c75 7261 7465 6420 6172 7261   evalurated arra
-00010c80: 792e 2047 6f74 3a20 7b7d 222e 666f 726d  y. Got: {}".form
-00010c90: 6174 286b 6579 290a 2020 2020 2020 2020  at(key).        
-00010ca0: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-00010cb0: 7475 726e 205f 7669 6e64 6578 2873 656c  turn _vindex(sel
-00010cc0: 662c 202a 6b65 7929 0a0a 2020 2020 4070  f, *key)..    @p
-00010cd0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00010ce0: 7669 6e64 6578 2873 656c 6629 3a0a 2020  vindex(self):.  
-00010cf0: 2020 2020 2020 2222 2256 6563 746f 7269        """Vectori
-00010d00: 7a65 6420 696e 6465 7869 6e67 2077 6974  zed indexing wit
-00010d10: 6820 6272 6f61 6463 6173 7469 6e67 2e0a  h broadcasting..
-00010d20: 0a20 2020 2020 2020 2054 6869 7320 6973  .        This is
-00010d30: 2065 7175 6976 616c 656e 7420 746f 206e   equivalent to n
-00010d40: 756d 7079 2773 2061 6476 616e 6365 6420  umpy's advanced 
-00010d50: 696e 6465 7869 6e67 2c20 7573 696e 6720  indexing, using 
-00010d60: 6172 7261 7973 2074 6861 7420 6172 650a  arrays that are.
-00010d70: 2020 2020 2020 2020 6272 6f61 6463 6173          broadcas
-00010d80: 7420 6167 6169 6e73 7420 6561 6368 206f  t against each o
-00010d90: 7468 6572 2e20 5468 6973 2061 6c6c 6f77  ther. This allow
-00010da0: 7320 666f 7220 706f 696e 7477 6973 6520  s for pointwise 
-00010db0: 696e 6465 7869 6e67 3a0a 0a20 2020 2020  indexing:..     
-00010dc0: 2020 203e 3e3e 2069 6d70 6f72 7420 6461     >>> import da
-00010dd0: 736b 2e61 7272 6179 2061 7320 6461 0a20  sk.array as da. 
-00010de0: 2020 2020 2020 203e 3e3e 2078 203d 206e         >>> x = n
-00010df0: 702e 6172 7261 7928 5b5b 312c 2032 2c20  p.array([[1, 2, 
-00010e00: 335d 2c20 5b34 2c20 352c 2036 5d2c 205b  3], [4, 5, 6], [
-00010e10: 372c 2038 2c20 395d 5d29 0a20 2020 2020  7, 8, 9]]).     
-00010e20: 2020 203e 3e3e 2078 203d 2064 612e 6672     >>> x = da.fr
-00010e30: 6f6d 5f61 7272 6179 2878 2c20 6368 756e  om_array(x, chun
-00010e40: 6b73 3d32 290a 2020 2020 2020 2020 3e3e  ks=2).        >>
-00010e50: 3e20 782e 7669 6e64 6578 5b5b 302c 2031  > x.vindex[[0, 1
-00010e60: 2c20 325d 2c20 5b30 2c20 312c 2032 5d5d  , 2], [0, 1, 2]]
-00010e70: 2e63 6f6d 7075 7465 2829 0a20 2020 2020  .compute().     
-00010e80: 2020 2061 7272 6179 285b 312c 2035 2c20     array([1, 5, 
-00010e90: 395d 290a 0a20 2020 2020 2020 204d 6978  9])..        Mix
-00010ea0: 6564 2062 6173 6963 2f61 6476 616e 6365  ed basic/advance
-00010eb0: 6420 696e 6465 7869 6e67 2077 6974 6820  d indexing with 
-00010ec0: 736c 6963 6573 2f61 7272 6179 7320 6973  slices/arrays is
-00010ed0: 2061 6c73 6f20 7375 7070 6f72 7465 642e   also supported.
-00010ee0: 2054 6865 0a20 2020 2020 2020 206f 7264   The.        ord
-00010ef0: 6572 206f 6620 6469 6d65 6e73 696f 6e73  er of dimensions
-00010f00: 2069 6e20 7468 6520 7265 7375 6c74 2066   in the result f
-00010f10: 6f6c 6c6f 7773 2074 686f 7365 2070 726f  ollows those pro
-00010f20: 706f 7365 6420 666f 720a 2020 2020 2020  posed for.      
-00010f30: 2020 606e 6461 7272 6179 2e76 696e 6465    `ndarray.vinde
-00010f40: 7820 3c68 7474 7073 3a2f 2f67 6974 6875  x <https://githu
-00010f50: 622e 636f 6d2f 6e75 6d70 792f 6e75 6d70  b.com/numpy/nump
-00010f60: 792f 7075 6c6c 2f36 3235 363e 605f 3a0a  y/pull/6256>`_:.
-00010f70: 2020 2020 2020 2020 7468 6520 7375 6273          the subs
-00010f80: 7061 6365 2073 7061 6e6e 6564 2062 7920  pace spanned by 
-00010f90: 6172 7261 7973 2069 7320 666f 6c6c 6f77  arrays is follow
-00010fa0: 6564 2062 7920 616c 6c20 736c 6963 6573  ed by all slices
-00010fb0: 2e0a 0a20 2020 2020 2020 204e 6f74 653a  ...        Note:
-00010fc0: 2060 6076 696e 6465 7860 6020 7072 6f76   ``vindex`` prov
-00010fd0: 6964 6573 206d 6f72 6520 6765 6e65 7261  ides more genera
-00010fe0: 6c20 6675 6e63 7469 6f6e 616c 6974 7920  l functionality 
-00010ff0: 7468 616e 2073 7461 6e64 6172 640a 2020  than standard.  
-00011000: 2020 2020 2020 696e 6465 7869 6e67 2c20        indexing, 
-00011010: 6275 7420 6974 2061 6c73 6f20 6861 7320  but it also has 
-00011020: 6665 7765 7220 6f70 7469 6d69 7a61 7469  fewer optimizati
-00011030: 6f6e 7320 616e 6420 6361 6e20 6265 2073  ons and can be s
-00011040: 6967 6e69 6669 6361 6e74 6c79 0a20 2020  ignificantly.   
-00011050: 2020 2020 2073 6c6f 7765 722e 0a20 2020       slower..   
-00011060: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00011070: 2072 6574 7572 6e20 496e 6465 7843 616c   return IndexCal
-00011080: 6c61 626c 6528 7365 6c66 2e5f 7669 6e64  lable(self._vind
-00011090: 6578 290a 0a20 2020 2040 7072 6f70 6572  ex)..    @proper
-000110a0: 7479 0a20 2020 2064 6566 2062 6c6f 636b  ty.    def block
-000110b0: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
-000110c0: 2022 2222 416e 2061 7272 6179 2d6c 696b   """An array-lik
-000110d0: 6520 696e 7465 7266 6163 6520 746f 2074  e interface to t
-000110e0: 6865 2062 6c6f 636b 7320 6f66 2061 6e20  he blocks of an 
-000110f0: 6172 7261 792e 0a0a 2020 2020 2020 2020  array...        
-00011100: 5468 6973 2072 6574 7572 6e73 2061 2060  This returns a `
-00011110: 6042 6c6f 636b 7669 6577 6060 206f 626a  `Blockview`` obj
-00011120: 6563 7420 7468 6174 2070 726f 7669 6465  ect that provide
-00011130: 7320 616e 2061 7272 6179 2d6c 696b 6520  s an array-like 
-00011140: 696e 7465 7266 6163 650a 2020 2020 2020  interface.      
-00011150: 2020 746f 2074 6865 2062 6c6f 636b 7320    to the blocks 
-00011160: 6f66 2061 2064 6173 6b20 6172 7261 792e  of a dask array.
-00011170: 2020 4e75 6d70 792d 7374 796c 6520 696e    Numpy-style in
-00011180: 6465 7869 6e67 206f 6620 6120 6060 426c  dexing of a ``Bl
-00011190: 6f63 6b76 6965 7760 6020 6f62 6a65 6374  ockview`` object
-000111a0: 0a20 2020 2020 2020 2072 6574 7572 6e73  .        returns
-000111b0: 2061 2073 656c 6563 7469 6f6e 206f 6620   a selection of 
-000111c0: 626c 6f63 6b73 2061 7320 6120 6e65 7720  blocks as a new 
-000111d0: 6461 736b 2061 7272 6179 2e0a 0a20 2020  dask array...   
-000111e0: 2020 2020 2059 6f75 2063 616e 2069 6e64       You can ind
-000111f0: 6578 2060 6061 7272 6179 2e62 6c6f 636b  ex ``array.block
-00011200: 7360 6020 6c69 6b65 2061 206e 756d 7079  s`` like a numpy
-00011210: 2061 7272 6179 206f 6620 7368 6170 650a   array of shape.
-00011220: 2020 2020 2020 2020 6571 7561 6c20 746f          equal to
-00011230: 2074 6865 206e 756d 6265 7220 6f66 2062   the number of b
-00011240: 6c6f 636b 7320 696e 2065 6163 6820 6469  locks in each di
-00011250: 6d65 6e73 696f 6e2c 2028 6176 6169 6c61  mension, (availa
-00011260: 626c 6520 6173 0a20 2020 2020 2020 2061  ble as.        a
-00011270: 7272 6179 2e62 6c6f 636b 732e 7369 7a65  rray.blocks.size
-00011280: 292e 2020 5468 6520 6469 6d65 6e73 696f  ).  The dimensio
-00011290: 6e61 6c69 7479 206f 6620 7468 6520 6f75  nality of the ou
-000112a0: 7470 7574 2061 7272 6179 206d 6174 6368  tput array match
-000112b0: 6573 0a20 2020 2020 2020 2074 6865 2064  es.        the d
-000112c0: 696d 656e 7369 6f6e 206f 6620 7468 6973  imension of this
-000112d0: 2061 7272 6179 2c20 6576 656e 2069 6620   array, even if 
-000112e0: 696e 7465 6765 7220 696e 6469 6365 7320  integer indices 
-000112f0: 6172 6520 7061 7373 6564 2e0a 2020 2020  are passed..    
-00011300: 2020 2020 536c 6963 696e 6720 7769 7468      Slicing with
-00011310: 2060 606e 702e 6e65 7761 7869 7360 6020   ``np.newaxis`` 
-00011320: 6f72 206d 756c 7469 706c 6520 6c69 7374  or multiple list
-00011330: 7320 6973 206e 6f74 2073 7570 706f 7274  s is not support
-00011340: 6564 2e0a 0a20 2020 2020 2020 2045 7861  ed...        Exa
-00011350: 6d70 6c65 730a 2020 2020 2020 2020 2d2d  mples.        --
-00011360: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 203e  ------.        >
-00011370: 3e3e 2069 6d70 6f72 7420 6461 736b 2e61  >> import dask.a
-00011380: 7272 6179 2061 7320 6461 0a20 2020 2020  rray as da.     
-00011390: 2020 203e 3e3e 2078 203d 2064 612e 6172     >>> x = da.ar
-000113a0: 616e 6765 2838 2c20 6368 756e 6b73 3d32  ange(8, chunks=2
-000113b0: 290a 2020 2020 2020 2020 3e3e 3e20 782e  ).        >>> x.
-000113c0: 626c 6f63 6b73 2e73 6861 7065 2023 2061  blocks.shape # a
-000113d0: 6c69 6173 6573 2078 2e6e 756d 626c 6f63  liases x.numbloc
-000113e0: 6b73 0a20 2020 2020 2020 2028 342c 290a  ks.        (4,).
-000113f0: 2020 2020 2020 2020 3e3e 3e20 782e 626c          >>> x.bl
-00011400: 6f63 6b73 5b30 5d2e 636f 6d70 7574 6528  ocks[0].compute(
-00011410: 290a 2020 2020 2020 2020 6172 7261 7928  ).        array(
-00011420: 5b30 2c20 315d 290a 2020 2020 2020 2020  [0, 1]).        
-00011430: 3e3e 3e20 782e 626c 6f63 6b73 5b3a 335d  >>> x.blocks[:3]
-00011440: 2e63 6f6d 7075 7465 2829 0a20 2020 2020  .compute().     
-00011450: 2020 2061 7272 6179 285b 302c 2031 2c20     array([0, 1, 
-00011460: 322c 2033 2c20 342c 2035 5d29 0a20 2020  2, 3, 4, 5]).   
-00011470: 2020 2020 203e 3e3e 2078 2e62 6c6f 636b       >>> x.block
-00011480: 735b 3a3a 325d 2e63 6f6d 7075 7465 2829  s[::2].compute()
-00011490: 0a20 2020 2020 2020 2061 7272 6179 285b  .        array([
-000114a0: 302c 2031 2c20 342c 2035 5d29 0a20 2020  0, 1, 4, 5]).   
-000114b0: 2020 2020 203e 3e3e 2078 2e62 6c6f 636b       >>> x.block
-000114c0: 735b 5b2d 312c 2030 5d5d 2e63 6f6d 7075  s[[-1, 0]].compu
-000114d0: 7465 2829 0a20 2020 2020 2020 2061 7272  te().        arr
-000114e0: 6179 285b 362c 2037 2c20 302c 2031 5d29  ay([6, 7, 0, 1])
-000114f0: 0a20 2020 2020 2020 203e 3e3e 2078 2e62  .        >>> x.b
-00011500: 6c6f 636b 732e 7261 7665 6c28 2920 2320  locks.ravel() # 
-00011510: 646f 6374 6573 743a 202b 4e4f 524d 414c  doctest: +NORMAL
-00011520: 495a 455f 5748 4954 4553 5041 4345 0a20  IZE_WHITESPACE. 
-00011530: 2020 2020 2020 205b 6461 736b 2e61 7272         [dask.arr
-00011540: 6179 3c62 6c6f 636b 732c 2073 6861 7065  ay<blocks, shape
-00011550: 3d28 322c 292c 2064 7479 7065 3d69 6e74  =(2,), dtype=int
-00011560: 3634 2c20 6368 756e 6b73 697a 653d 2832  64, chunksize=(2
-00011570: 2c29 2c20 6368 756e 6b74 7970 653d 6e75  ,), chunktype=nu
-00011580: 6d70 792e 6e64 6172 7261 793e 2c0a 2020  mpy.ndarray>,.  
-00011590: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
-000115a0: 793c 626c 6f63 6b73 2c20 7368 6170 653d  y<blocks, shape=
-000115b0: 2832 2c29 2c20 6474 7970 653d 696e 7436  (2,), dtype=int6
-000115c0: 342c 2063 6875 6e6b 7369 7a65 3d28 322c  4, chunksize=(2,
-000115d0: 292c 2063 6875 6e6b 7479 7065 3d6e 756d  ), chunktype=num
-000115e0: 7079 2e6e 6461 7272 6179 3e2c 0a20 2020  py.ndarray>,.   
-000115f0: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-00011600: 3c62 6c6f 636b 732c 2073 6861 7065 3d28  <blocks, shape=(
-00011610: 322c 292c 2064 7479 7065 3d69 6e74 3634  2,), dtype=int64
-00011620: 2c20 6368 756e 6b73 697a 653d 2832 2c29  , chunksize=(2,)
-00011630: 2c20 6368 756e 6b74 7970 653d 6e75 6d70  , chunktype=nump
-00011640: 792e 6e64 6172 7261 793e 2c0a 2020 2020  y.ndarray>,.    
-00011650: 2020 2020 2064 6173 6b2e 6172 7261 793c       dask.array<
-00011660: 626c 6f63 6b73 2c20 7368 6170 653d 2832  blocks, shape=(2
-00011670: 2c29 2c20 6474 7970 653d 696e 7436 342c  ,), dtype=int64,
-00011680: 2063 6875 6e6b 7369 7a65 3d28 322c 292c   chunksize=(2,),
-00011690: 2063 6875 6e6b 7479 7065 3d6e 756d 7079   chunktype=numpy
-000116a0: 2e6e 6461 7272 6179 3e5d 0a0a 2020 2020  .ndarray>]..    
-000116b0: 2020 2020 5265 7475 726e 730a 2020 2020      Returns.    
-000116c0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000116d0: 2020 2020 416e 2069 6e73 7461 6e63 6520      An instance 
-000116e0: 6f66 2060 6064 6173 6b2e 6172 7261 792e  of ``dask.array.
-000116f0: 426c 6f63 6b76 6965 7760 600a 2020 2020  Blockview``.    
-00011700: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00011710: 7265 7475 726e 2042 6c6f 636b 5669 6577  return BlockView
-00011720: 2873 656c 6629 0a0a 2020 2020 4070 726f  (self)..    @pro
-00011730: 7065 7274 790a 2020 2020 6465 6620 7061  perty.    def pa
-00011740: 7274 6974 696f 6e73 2873 656c 6629 3a0a  rtitions(self):.
-00011750: 2020 2020 2020 2020 2222 2253 6c69 6365          """Slice
-00011760: 2061 6e20 6172 7261 7920 6279 2070 6172   an array by par
-00011770: 7469 7469 6f6e 732e 2041 6c69 6173 206f  titions. Alias o
-00011780: 6620 6461 736b 2061 7272 6179 202e 626c  f dask array .bl
-00011790: 6f63 6b73 2061 7474 7269 6275 7465 2e0a  ocks attribute..
-000117a0: 0a20 2020 2020 2020 2054 6869 7320 616c  .        This al
-000117b0: 6961 7320 616c 6c6f 7773 2079 6f75 2074  ias allows you t
-000117c0: 6f20 7772 6974 6520 6167 6e6f 7374 6963  o write agnostic
-000117d0: 2063 6f64 6520 7468 6174 2077 6f72 6b73   code that works
-000117e0: 2077 6974 6820 626f 7468 0a20 2020 2020   with both.     
-000117f0: 2020 2064 6173 6b20 6172 7261 7973 2061     dask arrays a
-00011800: 6e64 2064 6173 6b20 6461 7461 6672 616d  nd dask datafram
-00011810: 6573 2e0a 0a20 2020 2020 2020 2054 6869  es...        Thi
-00011820: 7320 7265 7475 726e 7320 6120 6060 426c  s returns a ``Bl
-00011830: 6f63 6b76 6965 7760 6020 6f62 6a65 6374  ockview`` object
-00011840: 2074 6861 7420 7072 6f76 6964 6573 2061   that provides a
-00011850: 6e20 6172 7261 792d 6c69 6b65 2069 6e74  n array-like int
-00011860: 6572 6661 6365 0a20 2020 2020 2020 2074  erface.        t
-00011870: 6f20 7468 6520 626c 6f63 6b73 206f 6620  o the blocks of 
-00011880: 6120 6461 736b 2061 7272 6179 2e20 204e  a dask array.  N
-00011890: 756d 7079 2d73 7479 6c65 2069 6e64 6578  umpy-style index
-000118a0: 696e 6720 6f66 2061 2060 6042 6c6f 636b  ing of a ``Block
-000118b0: 7669 6577 6060 206f 626a 6563 740a 2020  view`` object.  
-000118c0: 2020 2020 2020 7265 7475 726e 7320 6120        returns a 
-000118d0: 7365 6c65 6374 696f 6e20 6f66 2062 6c6f  selection of blo
-000118e0: 636b 7320 6173 2061 206e 6577 2064 6173  cks as a new das
-000118f0: 6b20 6172 7261 792e 0a0a 2020 2020 2020  k array...      
-00011900: 2020 596f 7520 6361 6e20 696e 6465 7820    You can index 
-00011910: 6060 6172 7261 792e 626c 6f63 6b73 6060  ``array.blocks``
-00011920: 206c 696b 6520 6120 6e75 6d70 7920 6172   like a numpy ar
-00011930: 7261 7920 6f66 2073 6861 7065 0a20 2020  ray of shape.   
-00011940: 2020 2020 2065 7175 616c 2074 6f20 7468       equal to th
-00011950: 6520 6e75 6d62 6572 206f 6620 626c 6f63  e number of bloc
-00011960: 6b73 2069 6e20 6561 6368 2064 696d 656e  ks in each dimen
-00011970: 7369 6f6e 2c20 2861 7661 696c 6162 6c65  sion, (available
-00011980: 2061 730a 2020 2020 2020 2020 6172 7261   as.        arra
-00011990: 792e 626c 6f63 6b73 2e73 697a 6529 2e20  y.blocks.size). 
-000119a0: 2054 6865 2064 696d 656e 7369 6f6e 616c   The dimensional
-000119b0: 6974 7920 6f66 2074 6865 206f 7574 7075  ity of the outpu
-000119c0: 7420 6172 7261 7920 6d61 7463 6865 730a  t array matches.
-000119d0: 2020 2020 2020 2020 7468 6520 6469 6d65          the dime
-000119e0: 6e73 696f 6e20 6f66 2074 6869 7320 6172  nsion of this ar
-000119f0: 7261 792c 2065 7665 6e20 6966 2069 6e74  ray, even if int
-00011a00: 6567 6572 2069 6e64 6963 6573 2061 7265  eger indices are
-00011a10: 2070 6173 7365 642e 0a20 2020 2020 2020   passed..       
-00011a20: 2053 6c69 6369 6e67 2077 6974 6820 6060   Slicing with ``
-00011a30: 6e70 2e6e 6577 6178 6973 6060 206f 7220  np.newaxis`` or 
-00011a40: 6d75 6c74 6970 6c65 206c 6973 7473 2069  multiple lists i
-00011a50: 7320 6e6f 7420 7375 7070 6f72 7465 642e  s not supported.
-00011a60: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
-00011a70: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
-00011a80: 2d2d 2d0a 2020 2020 2020 2020 3e3e 3e20  ---.        >>> 
-00011a90: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
-00011aa0: 7920 6173 2064 610a 2020 2020 2020 2020  y as da.        
-00011ab0: 3e3e 3e20 7820 3d20 6461 2e61 7261 6e67  >>> x = da.arang
-00011ac0: 6528 382c 2063 6875 6e6b 733d 3229 0a20  e(8, chunks=2). 
-00011ad0: 2020 2020 2020 203e 3e3e 2078 2e70 6172         >>> x.par
-00011ae0: 7469 7469 6f6e 732e 7368 6170 6520 2320  titions.shape # 
-00011af0: 616c 6961 7365 7320 782e 6e75 6d62 6c6f  aliases x.numblo
-00011b00: 636b 730a 2020 2020 2020 2020 2834 2c29  cks.        (4,)
-00011b10: 0a20 2020 2020 2020 203e 3e3e 2078 2e70  .        >>> x.p
-00011b20: 6172 7469 7469 6f6e 735b 305d 2e63 6f6d  artitions[0].com
-00011b30: 7075 7465 2829 0a20 2020 2020 2020 2061  pute().        a
-00011b40: 7272 6179 285b 302c 2031 5d29 0a20 2020  rray([0, 1]).   
-00011b50: 2020 2020 203e 3e3e 2078 2e70 6172 7469       >>> x.parti
-00011b60: 7469 6f6e 735b 3a33 5d2e 636f 6d70 7574  tions[:3].comput
-00011b70: 6528 290a 2020 2020 2020 2020 6172 7261  e().        arra
-00011b80: 7928 5b30 2c20 312c 2032 2c20 332c 2034  y([0, 1, 2, 3, 4
-00011b90: 2c20 355d 290a 2020 2020 2020 2020 3e3e  , 5]).        >>
-00011ba0: 3e20 782e 7061 7274 6974 696f 6e73 5b3a  > x.partitions[:
-00011bb0: 3a32 5d2e 636f 6d70 7574 6528 290a 2020  :2].compute().  
-00011bc0: 2020 2020 2020 6172 7261 7928 5b30 2c20        array([0, 
-00011bd0: 312c 2034 2c20 355d 290a 2020 2020 2020  1, 4, 5]).      
-00011be0: 2020 3e3e 3e20 782e 7061 7274 6974 696f    >>> x.partitio
-00011bf0: 6e73 5b5b 2d31 2c20 305d 5d2e 636f 6d70  ns[[-1, 0]].comp
-00011c00: 7574 6528 290a 2020 2020 2020 2020 6172  ute().        ar
-00011c10: 7261 7928 5b36 2c20 372c 2030 2c20 315d  ray([6, 7, 0, 1]
-00011c20: 290a 2020 2020 2020 2020 3e3e 3e20 782e  ).        >>> x.
-00011c30: 7061 7274 6974 696f 6e73 2e72 6176 656c  partitions.ravel
-00011c40: 2829 2023 2064 6f63 7465 7374 3a20 2b4e  () # doctest: +N
-00011c50: 4f52 4d41 4c49 5a45 5f57 4849 5445 5350  ORMALIZE_WHITESP
-00011c60: 4143 450a 2020 2020 2020 2020 5b64 6173  ACE.        [das
-00011c70: 6b2e 6172 7261 793c 626c 6f63 6b73 2c20  k.array<blocks, 
-00011c80: 7368 6170 653d 2832 2c29 2c20 6474 7970  shape=(2,), dtyp
-00011c90: 653d 696e 7436 342c 2063 6875 6e6b 7369  e=int64, chunksi
-00011ca0: 7a65 3d28 322c 292c 2063 6875 6e6b 7479  ze=(2,), chunkty
-00011cb0: 7065 3d6e 756d 7079 2e6e 6461 7272 6179  pe=numpy.ndarray
-00011cc0: 3e2c 0a20 2020 2020 2020 2020 6461 736b  >,.         dask
-00011cd0: 2e61 7272 6179 3c62 6c6f 636b 732c 2073  .array<blocks, s
-00011ce0: 6861 7065 3d28 322c 292c 2064 7479 7065  hape=(2,), dtype
-00011cf0: 3d69 6e74 3634 2c20 6368 756e 6b73 697a  =int64, chunksiz
-00011d00: 653d 2832 2c29 2c20 6368 756e 6b74 7970  e=(2,), chunktyp
-00011d10: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
-00011d20: 2c0a 2020 2020 2020 2020 2064 6173 6b2e  ,.         dask.
-00011d30: 6172 7261 793c 626c 6f63 6b73 2c20 7368  array<blocks, sh
-00011d40: 6170 653d 2832 2c29 2c20 6474 7970 653d  ape=(2,), dtype=
-00011d50: 696e 7436 342c 2063 6875 6e6b 7369 7a65  int64, chunksize
-00011d60: 3d28 322c 292c 2063 6875 6e6b 7479 7065  =(2,), chunktype
-00011d70: 3d6e 756d 7079 2e6e 6461 7272 6179 3e2c  =numpy.ndarray>,
-00011d80: 0a20 2020 2020 2020 2020 6461 736b 2e61  .         dask.a
-00011d90: 7272 6179 3c62 6c6f 636b 732c 2073 6861  rray<blocks, sha
-00011da0: 7065 3d28 322c 292c 2064 7479 7065 3d69  pe=(2,), dtype=i
-00011db0: 6e74 3634 2c20 6368 756e 6b73 697a 653d  nt64, chunksize=
-00011dc0: 2832 2c29 2c20 6368 756e 6b74 7970 653d  (2,), chunktype=
-00011dd0: 6e75 6d70 792e 6e64 6172 7261 793e 5d0a  numpy.ndarray>].
-00011de0: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00011df0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00011e00: 0a20 2020 2020 2020 2041 6e20 696e 7374  .        An inst
-00011e10: 616e 6365 206f 6620 6060 6461 2e61 7272  ance of ``da.arr
-00011e20: 6179 2e42 6c6f 636b 7669 6577 6060 0a20  ay.Blockview``. 
-00011e30: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00011e40: 2020 2072 6574 7572 6e20 7365 6c66 2e62     return self.b
-00011e50: 6c6f 636b 730a 0a20 2020 2064 6566 2064  locks..    def d
-00011e60: 6f74 2873 656c 662c 206f 7468 6572 293a  ot(self, other):
-00011e70: 0a20 2020 2020 2020 2022 2222 446f 7420  .        """Dot 
-00011e80: 7072 6f64 7563 7420 6f66 2073 656c 6620  product of self 
-00011e90: 616e 6420 6f74 6865 722e 0a0a 2020 2020  and other...    
-00011ea0: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
-00011eb0: 6e63 3a60 6461 736b 2e61 7272 6179 2e74  nc:`dask.array.t
-00011ec0: 656e 736f 7264 6f74 6020 666f 7220 6675  ensordot` for fu
-00011ed0: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
-00011ee0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-00011ef0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-00011f00: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
-00011f10: 6b2e 6172 7261 792e 646f 7420 3a20 6571  k.array.dot : eq
-00011f20: 7569 7661 6c65 6e74 2066 756e 6374 696f  uivalent functio
-00011f30: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
-00011f40: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-00011f50: 6172 7261 792e 726f 7574 696e 6573 2069  array.routines i
-00011f60: 6d70 6f72 7420 7465 6e73 6f72 646f 740a  mport tensordot.
-00011f70: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00011f80: 7465 6e73 6f72 646f 7428 7365 6c66 2c20  tensordot(self, 
-00011f90: 6f74 6865 722c 2061 7865 733d 2828 7365  other, axes=((se
-00011fa0: 6c66 2e6e 6469 6d20 2d20 312c 292c 2028  lf.ndim - 1,), (
-00011fb0: 6f74 6865 722e 6e64 696d 202d 2032 2c29  other.ndim - 2,)
-00011fc0: 2929 0a0a 2020 2020 4070 726f 7065 7274  ))..    @propert
-00011fd0: 790a 2020 2020 6465 6620 4128 7365 6c66  y.    def A(self
-00011fe0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00011ff0: 6e20 7365 6c66 0a0a 2020 2020 4070 726f  n self..    @pro
-00012000: 7065 7274 790a 2020 2020 6465 6620 5428  perty.    def T(
-00012010: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
-00012020: 6574 7572 6e20 7365 6c66 2e74 7261 6e73  eturn self.trans
-00012030: 706f 7365 2829 0a0a 2020 2020 6465 6620  pose()..    def 
-00012040: 7472 616e 7370 6f73 6528 7365 6c66 2c20  transpose(self, 
-00012050: 2a61 7865 7329 3a0a 2020 2020 2020 2020  *axes):.        
-00012060: 2222 2252 6576 6572 7365 206f 7220 7065  """Reverse or pe
-00012070: 726d 7574 6520 7468 6520 6178 6573 206f  rmute the axes o
-00012080: 6620 616e 2061 7272 6179 2e20 5265 7475  f an array. Retu
-00012090: 726e 2074 6865 206d 6f64 6966 6965 6420  rn the modified 
-000120a0: 6172 7261 792e 0a0a 2020 2020 2020 2020  array...        
-000120b0: 5265 6665 7220 746f 203a 6675 6e63 3a60  Refer to :func:`
-000120c0: 6461 736b 2e61 7272 6179 2e74 7261 6e73  dask.array.trans
-000120d0: 706f 7365 6020 666f 7220 6675 6c6c 2064  pose` for full d
-000120e0: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
-000120f0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00012100: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00012110: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
-00012120: 7261 792e 7472 616e 7370 6f73 6520 3a20  ray.transpose : 
-00012130: 6571 7569 7661 6c65 6e74 2066 756e 6374  equivalent funct
-00012140: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
-00012150: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
-00012160: 6b2e 6172 7261 792e 726f 7574 696e 6573  k.array.routines
-00012170: 2069 6d70 6f72 7420 7472 616e 7370 6f73   import transpos
-00012180: 650a 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
-00012190: 7420 6178 6573 3a0a 2020 2020 2020 2020  t axes:.        
-000121a0: 2020 2020 6178 6573 203d 204e 6f6e 650a      axes = None.
-000121b0: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
-000121c0: 2861 7865 7329 203d 3d20 3120 616e 6420  (axes) == 1 and 
-000121d0: 6973 696e 7374 616e 6365 2861 7865 735b  isinstance(axes[
-000121e0: 305d 2c20 4974 6572 6162 6c65 293a 0a20  0], Iterable):. 
-000121f0: 2020 2020 2020 2020 2020 2061 7865 7320             axes 
-00012200: 3d20 6178 6573 5b30 5d0a 2020 2020 2020  = axes[0].      
-00012210: 2020 6966 2028 6178 6573 203d 3d20 7475    if (axes == tu
-00012220: 706c 6528 7261 6e67 6528 7365 6c66 2e6e  ple(range(self.n
-00012230: 6469 6d29 2929 206f 7220 2861 7865 7320  dim))) or (axes 
-00012240: 3d3d 2074 7570 6c65 2872 616e 6765 282d  == tuple(range(-
-00012250: 7365 6c66 2e6e 6469 6d2c 2030 2929 293a  self.ndim, 0))):
-00012260: 0a20 2020 2020 2020 2020 2020 2023 206e  .            # n
-00012270: 6f20 7472 616e 7370 6f73 6520 6e65 6365  o transpose nece
-00012280: 7373 6172 790a 2020 2020 2020 2020 2020  ssary.          
-00012290: 2020 7265 7475 726e 2073 656c 660a 2020    return self.  
-000122a0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-000122b0: 2020 2020 2020 2020 7265 7475 726e 2074          return t
-000122c0: 7261 6e73 706f 7365 2873 656c 662c 2061  ranspose(self, a
-000122d0: 7865 733d 6178 6573 290a 0a20 2020 2064  xes=axes)..    d
-000122e0: 6566 2072 6176 656c 2873 656c 6629 3a0a  ef ravel(self):.
-000122f0: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
-00012300: 6e20 6120 666c 6174 7465 6e65 6420 6172  n a flattened ar
-00012310: 7261 792e 0a0a 2020 2020 2020 2020 5265  ray...        Re
-00012320: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
-00012330: 736b 2e61 7272 6179 2e72 6176 656c 6020  sk.array.ravel` 
-00012340: 666f 7220 6675 6c6c 2064 6f63 756d 656e  for full documen
-00012350: 7461 7469 6f6e 2e0a 0a20 2020 2020 2020  tation...       
-00012360: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-00012370: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00012380: 2020 2064 6173 6b2e 6172 7261 792e 7261     dask.array.ra
-00012390: 7665 6c20 3a20 6571 7569 7661 6c65 6e74  vel : equivalent
-000123a0: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-000123b0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-000123c0: 6f6d 2064 6173 6b2e 6172 7261 792e 726f  om dask.array.ro
-000123d0: 7574 696e 6573 2069 6d70 6f72 7420 7261  utines import ra
-000123e0: 7665 6c0a 0a20 2020 2020 2020 2072 6574  vel..        ret
-000123f0: 7572 6e20 7261 7665 6c28 7365 6c66 290a  urn ravel(self).
-00012400: 0a20 2020 2066 6c61 7474 656e 203d 2072  .    flatten = r
-00012410: 6176 656c 0a0a 2020 2020 6465 6620 6368  avel..    def ch
-00012420: 6f6f 7365 2873 656c 662c 2063 686f 6963  oose(self, choic
-00012430: 6573 293a 0a20 2020 2020 2020 2022 2222  es):.        """
-00012440: 5573 6520 616e 2069 6e64 6578 2061 7272  Use an index arr
-00012450: 6179 2074 6f20 636f 6e73 7472 7563 7420  ay to construct 
-00012460: 6120 6e65 7720 6172 7261 7920 6672 6f6d  a new array from
-00012470: 2061 2073 6574 206f 6620 6368 6f69 6365   a set of choice
-00012480: 732e 0a0a 2020 2020 2020 2020 5265 6665  s...        Refe
-00012490: 7220 746f 203a 6675 6e63 3a60 6461 736b  r to :func:`dask
-000124a0: 2e61 7272 6179 2e63 686f 6f73 6560 2066  .array.choose` f
-000124b0: 6f72 2066 756c 6c20 646f 6375 6d65 6e74  or full document
-000124c0: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-000124d0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-000124e0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-000124f0: 2020 6461 736b 2e61 7272 6179 2e63 686f    dask.array.cho
-00012500: 6f73 6520 3a20 6571 7569 7661 6c65 6e74  ose : equivalent
-00012510: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
-00012520: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
-00012530: 6f6d 2064 6173 6b2e 6172 7261 792e 726f  om dask.array.ro
-00012540: 7574 696e 6573 2069 6d70 6f72 7420 6368  utines import ch
-00012550: 6f6f 7365 0a0a 2020 2020 2020 2020 7265  oose..        re
-00012560: 7475 726e 2063 686f 6f73 6528 7365 6c66  turn choose(self
-00012570: 2c20 6368 6f69 6365 7329 0a0a 2020 2020  , choices)..    
-00012580: 6465 6620 7265 7368 6170 6528 7365 6c66  def reshape(self
-00012590: 2c20 2a73 6861 7065 2c20 6d65 7267 655f  , *shape, merge_
-000125a0: 6368 756e 6b73 3d54 7275 652c 206c 696d  chunks=True, lim
-000125b0: 6974 3d4e 6f6e 6529 3a0a 2020 2020 2020  it=None):.      
-000125c0: 2020 2222 2252 6573 6861 7065 2061 7272    """Reshape arr
-000125d0: 6179 2074 6f20 6e65 7720 7368 6170 650a  ay to new shape.
-000125e0: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-000125f0: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
-00012600: 7261 792e 7265 7368 6170 6560 2066 6f72  ray.reshape` for
-00012610: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
-00012620: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
-00012630: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00012640: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00012650: 6461 736b 2e61 7272 6179 2e72 6573 6861  dask.array.resha
-00012660: 7065 203a 2065 7175 6976 616c 656e 7420  pe : equivalent 
-00012670: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00012680: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00012690: 6d20 6461 736b 2e61 7272 6179 2e72 6573  m dask.array.res
-000126a0: 6861 7065 2069 6d70 6f72 7420 7265 7368  hape import resh
-000126b0: 6170 650a 0a20 2020 2020 2020 2069 6620  ape..        if 
-000126c0: 6c65 6e28 7368 6170 6529 203d 3d20 3120  len(shape) == 1 
-000126d0: 616e 6420 6e6f 7420 6973 696e 7374 616e  and not isinstan
-000126e0: 6365 2873 6861 7065 5b30 5d2c 204e 756d  ce(shape[0], Num
-000126f0: 6265 7229 3a0a 2020 2020 2020 2020 2020  ber):.          
-00012700: 2020 7368 6170 6520 3d20 7368 6170 655b    shape = shape[
-00012710: 305d 0a20 2020 2020 2020 2072 6574 7572  0].        retur
-00012720: 6e20 7265 7368 6170 6528 7365 6c66 2c20  n reshape(self, 
-00012730: 7368 6170 652c 206d 6572 6765 5f63 6875  shape, merge_chu
-00012740: 6e6b 733d 6d65 7267 655f 6368 756e 6b73  nks=merge_chunks
-00012750: 2c20 6c69 6d69 743d 6c69 6d69 7429 0a0a  , limit=limit)..
-00012760: 2020 2020 6465 6620 746f 706b 2873 656c      def topk(sel
-00012770: 662c 206b 2c20 6178 6973 3d2d 312c 2073  f, k, axis=-1, s
-00012780: 706c 6974 5f65 7665 7279 3d4e 6f6e 6529  plit_every=None)
-00012790: 3a0a 2020 2020 2020 2020 2222 2254 6865  :.        """The
-000127a0: 2074 6f70 206b 2065 6c65 6d65 6e74 7320   top k elements 
-000127b0: 6f66 2061 6e20 6172 7261 792e 0a0a 2020  of an array...  
-000127c0: 2020 2020 2020 5265 6665 7220 746f 203a        Refer to :
-000127d0: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
-000127e0: 2e74 6f70 6b60 2066 6f72 2066 756c 6c20  .topk` for full 
-000127f0: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
-00012800: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-00012810: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00012820: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
-00012830: 7272 6179 2e74 6f70 6b20 3a20 6571 7569  rray.topk : equi
-00012840: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
-00012850: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00012860: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
-00012870: 7261 792e 7265 6475 6374 696f 6e73 2069  ray.reductions i
-00012880: 6d70 6f72 7420 746f 706b 0a0a 2020 2020  mport topk..    
-00012890: 2020 2020 7265 7475 726e 2074 6f70 6b28      return topk(
-000128a0: 7365 6c66 2c20 6b2c 2061 7869 733d 6178  self, k, axis=ax
-000128b0: 6973 2c20 7370 6c69 745f 6576 6572 793d  is, split_every=
-000128c0: 7370 6c69 745f 6576 6572 7929 0a0a 2020  split_every)..  
-000128d0: 2020 6465 6620 6172 6774 6f70 6b28 7365    def argtopk(se
-000128e0: 6c66 2c20 6b2c 2061 7869 733d 2d31 2c20  lf, k, axis=-1, 
-000128f0: 7370 6c69 745f 6576 6572 793d 4e6f 6e65  split_every=None
-00012900: 293a 0a20 2020 2020 2020 2022 2222 5468  ):.        """Th
-00012910: 6520 696e 6469 6365 7320 6f66 2074 6865  e indices of the
-00012920: 2074 6f70 206b 2065 6c65 6d65 6e74 7320   top k elements 
-00012930: 6f66 2061 6e20 6172 7261 792e 0a0a 2020  of an array...  
-00012940: 2020 2020 2020 5265 6665 7220 746f 203a        Refer to :
-00012950: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
-00012960: 2e61 7267 746f 706b 6020 666f 7220 6675  .argtopk` for fu
-00012970: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
-00012980: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-00012990: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-000129a0: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
-000129b0: 6b2e 6172 7261 792e 6172 6774 6f70 6b20  k.array.argtopk 
-000129c0: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
-000129d0: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
-000129e0: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
-000129f0: 6173 6b2e 6172 7261 792e 7265 6475 6374  ask.array.reduct
-00012a00: 696f 6e73 2069 6d70 6f72 7420 6172 6774  ions import argt
-00012a10: 6f70 6b0a 0a20 2020 2020 2020 2072 6574  opk..        ret
-00012a20: 7572 6e20 6172 6774 6f70 6b28 7365 6c66  urn argtopk(self
-00012a30: 2c20 6b2c 2061 7869 733d 6178 6973 2c20  , k, axis=axis, 
-00012a40: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
-00012a50: 745f 6576 6572 7929 0a0a 2020 2020 6465  t_every)..    de
-00012a60: 6620 6173 7479 7065 2873 656c 662c 2064  f astype(self, d
-00012a70: 7479 7065 2c20 2a2a 6b77 6172 6773 293a  type, **kwargs):
-00012a80: 0a20 2020 2020 2020 2022 2222 436f 7079  .        """Copy
-00012a90: 206f 6620 7468 6520 6172 7261 792c 2063   of the array, c
-00012aa0: 6173 7420 746f 2061 2073 7065 6369 6669  ast to a specifi
-00012ab0: 6564 2074 7970 652e 0a0a 2020 2020 2020  ed type...      
-00012ac0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00012ad0: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
-00012ae0: 2020 2020 2020 2020 6474 7970 6520 3a20          dtype : 
-00012af0: 7374 7220 6f72 2064 7479 7065 0a20 2020  str or dtype.   
-00012b00: 2020 2020 2020 2020 2054 7970 6563 6f64           Typecod
-00012b10: 6520 6f72 2064 6174 612d 7479 7065 2074  e or data-type t
-00012b20: 6f20 7768 6963 6820 7468 6520 6172 7261  o which the arra
-00012b30: 7920 6973 2063 6173 742e 0a20 2020 2020  y is cast..     
-00012b40: 2020 2063 6173 7469 6e67 203a 207b 276e     casting : {'n
-00012b50: 6f27 2c20 2765 7175 6976 272c 2027 7361  o', 'equiv', 'sa
-00012b60: 6665 272c 2027 7361 6d65 5f6b 696e 6427  fe', 'same_kind'
-00012b70: 2c20 2775 6e73 6166 6527 7d2c 206f 7074  , 'unsafe'}, opt
-00012b80: 696f 6e61 6c0a 2020 2020 2020 2020 2020  ional.          
-00012b90: 2020 436f 6e74 726f 6c73 2077 6861 7420    Controls what 
-00012ba0: 6b69 6e64 206f 6620 6461 7461 2063 6173  kind of data cas
-00012bb0: 7469 6e67 206d 6179 206f 6363 7572 2e20  ting may occur. 
-00012bc0: 4465 6661 756c 7473 2074 6f20 2775 6e73  Defaults to 'uns
-00012bd0: 6166 6527 0a20 2020 2020 2020 2020 2020  afe'.           
-00012be0: 2066 6f72 2062 6163 6b77 6172 6473 2063   for backwards c
-00012bf0: 6f6d 7061 7469 6269 6c69 7479 2e0a 0a20  ompatibility... 
-00012c00: 2020 2020 2020 2020 2020 202a 2027 6e6f             * 'no
-00012c10: 2720 6d65 616e 7320 7468 6520 6461 7461  ' means the data
-00012c20: 2074 7970 6573 2073 686f 756c 6420 6e6f   types should no
-00012c30: 7420 6265 2063 6173 7420 6174 2061 6c6c  t be cast at all
-00012c40: 2e0a 2020 2020 2020 2020 2020 2020 2a20  ..            * 
-00012c50: 2765 7175 6976 2720 6d65 616e 7320 6f6e  'equiv' means on
-00012c60: 6c79 2062 7974 652d 6f72 6465 7220 6368  ly byte-order ch
-00012c70: 616e 6765 7320 6172 6520 616c 6c6f 7765  anges are allowe
-00012c80: 642e 0a20 2020 2020 2020 2020 2020 202a  d..            *
-00012c90: 2027 7361 6665 2720 6d65 616e 7320 6f6e   'safe' means on
-00012ca0: 6c79 2063 6173 7473 2077 6869 6368 2063  ly casts which c
-00012cb0: 616e 2070 7265 7365 7276 6520 7661 6c75  an preserve valu
-00012cc0: 6573 2061 7265 2061 6c6c 6f77 6564 2e0a  es are allowed..
-00012cd0: 2020 2020 2020 2020 2020 2020 2a20 2773              * 's
-00012ce0: 616d 655f 6b69 6e64 2720 6d65 616e 7320  ame_kind' means 
-00012cf0: 6f6e 6c79 2073 6166 6520 6361 7374 7320  only safe casts 
-00012d00: 6f72 2063 6173 7473 2077 6974 6869 6e20  or casts within 
-00012d10: 6120 6b69 6e64 2c0a 2020 2020 2020 2020  a kind,.        
-00012d20: 2020 2020 2020 2020 6c69 6b65 2066 6c6f          like flo
-00012d30: 6174 3634 2074 6f20 666c 6f61 7433 322c  at64 to float32,
-00012d40: 2061 7265 2061 6c6c 6f77 6564 2e0a 2020   are allowed..  
-00012d50: 2020 2020 2020 2020 2020 2a20 2775 6e73            * 'uns
-00012d60: 6166 6527 206d 6561 6e73 2061 6e79 2064  afe' means any d
-00012d70: 6174 6120 636f 6e76 6572 7369 6f6e 7320  ata conversions 
-00012d80: 6d61 7920 6265 2064 6f6e 652e 0a20 2020  may be done..   
-00012d90: 2020 2020 2063 6f70 7920 3a20 626f 6f6c       copy : bool
-00012da0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-00012db0: 2020 2020 2020 2042 7920 6465 6661 756c         By defaul
-00012dc0: 742c 2061 7374 7970 6520 616c 7761 7973  t, astype always
-00012dd0: 2072 6574 7572 6e73 2061 206e 6577 6c79   returns a newly
-00012de0: 2061 6c6c 6f63 6174 6564 2061 7272 6179   allocated array
-00012df0: 2e20 4966 2074 6869 730a 2020 2020 2020  . If this.      
-00012e00: 2020 2020 2020 6973 2073 6574 2074 6f20        is set to 
-00012e10: 4661 6c73 6520 616e 6420 7468 6520 6064  False and the `d
-00012e20: 7479 7065 6020 7265 7175 6972 656d 656e  type` requiremen
-00012e30: 7420 6973 2073 6174 6973 6669 6564 2c20  t is satisfied, 
-00012e40: 7468 6520 696e 7075 740a 2020 2020 2020  the input.      
-00012e50: 2020 2020 2020 6172 7261 7920 6973 2072        array is r
-00012e60: 6574 7572 6e65 6420 696e 7374 6561 6420  eturned instead 
-00012e70: 6f66 2061 2063 6f70 792e 0a0a 2020 2020  of a copy...    
-00012e80: 2020 2020 2020 2020 2e2e 206e 6f74 653a          .. note:
-00012e90: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
-00012ea0: 2020 2044 6173 6b20 646f 6573 206e 6f74     Dask does not
-00012eb0: 2072 6573 7065 6374 2074 6865 2063 6f6e   respect the con
-00012ec0: 7469 6775 6f75 7320 6d65 6d6f 7279 206c  tiguous memory l
-00012ed0: 6179 6f75 7420 6f66 2074 6865 2061 7272  ayout of the arr
-00012ee0: 6179 2c0a 2020 2020 2020 2020 2020 2020  ay,.            
-00012ef0: 2020 2020 616e 6420 7769 6c6c 2069 676e      and will ign
-00012f00: 6f72 6520 7468 6520 6060 6f72 6465 7260  ore the ``order`
-00012f10: 6020 6b65 7977 6f72 6420 6172 6775 6d65  ` keyword argume
-00012f20: 6e74 2e0a 2020 2020 2020 2020 2020 2020  nt..            
-00012f30: 2020 2020 5468 6520 6465 6661 756c 7420      The default 
-00012f40: 6f72 6465 7220 6973 2027 4327 2063 6f6e  order is 'C' con
-00012f50: 7469 6775 6f75 732e 0a20 2020 2020 2020  tiguous..       
-00012f60: 2022 2222 0a20 2020 2020 2020 206b 7761   """.        kwa
-00012f70: 7267 732e 706f 7028 226f 7264 6572 222c  rgs.pop("order",
-00012f80: 204e 6f6e 6529 2020 2320 606f 7264 6572   None)  # `order
-00012f90: 6020 6973 206e 6f74 2072 6573 7065 6374  ` is not respect
-00012fa0: 6564 2c20 736f 2077 6520 7265 6d6f 7665  ed, so we remove
-00012fb0: 2074 6869 7320 6b77 6172 670a 2020 2020   this kwarg.    
-00012fc0: 2020 2020 2320 5363 616c 6172 7320 646f      # Scalars do
-00012fd0: 6e27 7420 7461 6b65 2060 6361 7374 696e  n't take `castin
-00012fe0: 6760 206f 7220 6063 6f70 7960 206b 7761  g` or `copy` kwa
-00012ff0: 7267 7320 2d20 6173 2073 7563 6820 7765  rgs - as such we
-00013000: 206f 6e6c 7920 7061 7373 0a20 2020 2020   only pass.     
-00013010: 2020 2023 2074 6865 6d20 746f 2060 6d61     # them to `ma
-00013020: 705f 626c 6f63 6b73 6020 6966 2073 7065  p_blocks` if spe
-00013030: 6369 6669 6564 2062 7920 7573 6572 2028  cified by user (
-00013040: 6469 6666 6572 656e 7420 7468 616e 2064  different than d
-00013050: 6566 6175 6c74 7329 2e0a 2020 2020 2020  efaults)..      
-00013060: 2020 6578 7472 6120 3d20 7365 7428 6b77    extra = set(kw
-00013070: 6172 6773 2920 2d20 7b22 6361 7374 696e  args) - {"castin
-00013080: 6722 2c20 2263 6f70 7922 7d0a 2020 2020  g", "copy"}.    
-00013090: 2020 2020 6966 2065 7874 7261 3a0a 2020      if extra:.  
-000130a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000130b0: 5479 7065 4572 726f 7228 0a20 2020 2020  TypeError(.     
-000130c0: 2020 2020 2020 2020 2020 2066 2261 7374             f"ast
-000130d0: 7970 6520 646f 6573 206e 6f74 2074 616b  ype does not tak
-000130e0: 6520 7468 6520 666f 6c6c 6f77 696e 6720  e the following 
-000130f0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-00013100: 733a 207b 6c69 7374 2865 7874 7261 297d  s: {list(extra)}
-00013110: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-00013120: 2020 2020 2020 2020 6361 7374 696e 6720          casting 
-00013130: 3d20 6b77 6172 6773 2e67 6574 2822 6361  = kwargs.get("ca
-00013140: 7374 696e 6722 2c20 2275 6e73 6166 6522  sting", "unsafe"
-00013150: 290a 2020 2020 2020 2020 6474 7970 6520  ).        dtype 
-00013160: 3d20 6e70 2e64 7479 7065 2864 7479 7065  = np.dtype(dtype
-00013170: 290a 2020 2020 2020 2020 6966 2073 656c  ).        if sel
-00013180: 662e 6474 7970 6520 3d3d 2064 7479 7065  f.dtype == dtype
-00013190: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-000131a0: 7475 726e 2073 656c 660a 2020 2020 2020  turn self.      
-000131b0: 2020 656c 6966 206e 6f74 206e 702e 6361    elif not np.ca
-000131c0: 6e5f 6361 7374 2873 656c 662e 6474 7970  n_cast(self.dtyp
-000131d0: 652c 2064 7479 7065 2c20 6361 7374 696e  e, dtype, castin
-000131e0: 673d 6361 7374 696e 6729 3a0a 2020 2020  g=casting):.    
-000131f0: 2020 2020 2020 2020 7261 6973 6520 5479          raise Ty
-00013200: 7065 4572 726f 7228 0a20 2020 2020 2020  peError(.       
-00013210: 2020 2020 2020 2020 2066 2243 616e 6e6f           f"Canno
-00013220: 7420 6361 7374 2061 7272 6179 2066 726f  t cast array fro
-00013230: 6d20 7b73 656c 662e 6474 7970 6521 727d  m {self.dtype!r}
-00013240: 2074 6f20 7b64 7479 7065 2172 7d20 220a   to {dtype!r} ".
-00013250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013260: 6622 6163 636f 7264 696e 6720 746f 2074  f"according to t
-00013270: 6865 2072 756c 6520 7b63 6173 7469 6e67  he rule {casting
-00013280: 2172 7d22 0a20 2020 2020 2020 2020 2020  !r}".           
-00013290: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-000132a0: 6e20 7365 6c66 2e6d 6170 5f62 6c6f 636b  n self.map_block
-000132b0: 7328 6368 756e 6b2e 6173 7479 7065 2c20  s(chunk.astype, 
-000132c0: 6474 7970 653d 6474 7970 652c 2061 7374  dtype=dtype, ast
-000132d0: 7970 655f 6474 7970 653d 6474 7970 652c  ype_dtype=dtype,
-000132e0: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
-000132f0: 6465 6620 5f5f 6162 735f 5f28 7365 6c66  def __abs__(self
-00013300: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00013310: 6e20 656c 656d 7769 7365 286f 7065 7261  n elemwise(opera
-00013320: 746f 722e 6162 732c 2073 656c 6629 0a0a  tor.abs, self)..
-00013330: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
-00013340: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
-00013350: 720a 2020 2020 6465 6620 5f5f 6164 645f  r.    def __add_
-00013360: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
-00013370: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00013380: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
-00013390: 2e61 6464 2c20 7365 6c66 2c20 6f74 6865  .add, self, othe
-000133a0: 7229 0a0a 2020 2020 4063 6865 636b 5f69  r)..    @check_i
-000133b0: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
-000133c0: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
-000133d0: 7261 6464 5f5f 2873 656c 662c 206f 7468  radd__(self, oth
-000133e0: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
-000133f0: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
-00013400: 7261 746f 722e 6164 642c 206f 7468 6572  rator.add, other
-00013410: 2c20 7365 6c66 290a 0a20 2020 2040 6368  , self)..    @ch
-00013420: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
-00013430: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
-00013440: 6566 205f 5f61 6e64 5f5f 2873 656c 662c  ef __and__(self,
-00013450: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00013460: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
-00013470: 286f 7065 7261 746f 722e 616e 645f 2c20  (operator.and_, 
-00013480: 7365 6c66 2c20 6f74 6865 7229 0a0a 2020  self, other)..  
-00013490: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
-000134a0: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
-000134b0: 2020 2020 6465 6620 5f5f 7261 6e64 5f5f      def __rand__
-000134c0: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
-000134d0: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-000134e0: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
-000134f0: 616e 645f 2c20 6f74 6865 722c 2073 656c  and_, other, sel
-00013500: 6629 0a0a 2020 2020 4063 6865 636b 5f69  f)..    @check_i
-00013510: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
-00013520: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
-00013530: 6469 765f 5f28 7365 6c66 2c20 6f74 6865  div__(self, othe
-00013540: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-00013550: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
-00013560: 6174 6f72 2e64 6976 2c20 7365 6c66 2c20  ator.div, self, 
-00013570: 6f74 6865 7229 0a0a 2020 2020 4063 6865  other)..    @che
-00013580: 636b 5f69 665f 6861 6e64 6c65 645f 6769  ck_if_handled_gi
-00013590: 7665 6e5f 6f74 6865 720a 2020 2020 6465  ven_other.    de
-000135a0: 6620 5f5f 7264 6976 5f5f 2873 656c 662c  f __rdiv__(self,
-000135b0: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-000135c0: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
-000135d0: 286f 7065 7261 746f 722e 6469 762c 206f  (operator.div, o
-000135e0: 7468 6572 2c20 7365 6c66 290a 0a20 2020  ther, self)..   
-000135f0: 2040 6368 6563 6b5f 6966 5f68 616e 646c   @check_if_handl
-00013600: 6564 5f67 6976 656e 5f6f 7468 6572 0a20  ed_given_other. 
-00013610: 2020 2064 6566 205f 5f65 715f 5f28 7365     def __eq__(se
-00013620: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-00013630: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
-00013640: 6973 6528 6f70 6572 6174 6f72 2e65 712c  ise(operator.eq,
-00013650: 2073 656c 662c 206f 7468 6572 290a 0a20   self, other).. 
-00013660: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
-00013670: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
-00013680: 0a20 2020 2064 6566 205f 5f67 745f 5f28  .    def __gt__(
-00013690: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
-000136a0: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
-000136b0: 6d77 6973 6528 6f70 6572 6174 6f72 2e67  mwise(operator.g
-000136c0: 742c 2073 656c 662c 206f 7468 6572 290a  t, self, other).
-000136d0: 0a20 2020 2040 6368 6563 6b5f 6966 5f68  .    @check_if_h
-000136e0: 616e 646c 6564 5f67 6976 656e 5f6f 7468  andled_given_oth
-000136f0: 6572 0a20 2020 2064 6566 205f 5f67 655f  er.    def __ge_
-00013700: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
-00013710: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-00013720: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
-00013730: 2e67 652c 2073 656c 662c 206f 7468 6572  .ge, self, other
-00013740: 290a 0a20 2020 2064 6566 205f 5f69 6e76  )..    def __inv
-00013750: 6572 745f 5f28 7365 6c66 293a 0a20 2020  ert__(self):.   
-00013760: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
-00013770: 7769 7365 286f 7065 7261 746f 722e 696e  wise(operator.in
-00013780: 7665 7274 2c20 7365 6c66 290a 0a20 2020  vert, self)..   
-00013790: 2040 6368 6563 6b5f 6966 5f68 616e 646c   @check_if_handl
-000137a0: 6564 5f67 6976 656e 5f6f 7468 6572 0a20  ed_given_other. 
-000137b0: 2020 2064 6566 205f 5f6c 7368 6966 745f     def __lshift_
-000137c0: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
-000137d0: 2020 2020 2020 2020 7265 7475 726e 2065          return e
-000137e0: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
-000137f0: 2e6c 7368 6966 742c 2073 656c 662c 206f  .lshift, self, o
-00013800: 7468 6572 290a 0a20 2020 2040 6368 6563  ther)..    @chec
-00013810: 6b5f 6966 5f68 616e 646c 6564 5f67 6976  k_if_handled_giv
-00013820: 656e 5f6f 7468 6572 0a20 2020 2064 6566  en_other.    def
-00013830: 205f 5f72 6c73 6869 6674 5f5f 2873 656c   __rlshift__(sel
-00013840: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-00013850: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
-00013860: 7365 286f 7065 7261 746f 722e 6c73 6869  se(operator.lshi
-00013870: 6674 2c20 6f74 6865 722c 2073 656c 6629  ft, other, self)
-00013880: 0a0a 2020 2020 4063 6865 636b 5f69 665f  ..    @check_if_
-00013890: 6861 6e64 6c65 645f 6769 7665 6e5f 6f74  handled_given_ot
-000138a0: 6865 720a 2020 2020 6465 6620 5f5f 6c74  her.    def __lt
-000138b0: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-000138c0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000138d0: 656c 656d 7769 7365 286f 7065 7261 746f  elemwise(operato
-000138e0: 722e 6c74 2c20 7365 6c66 2c20 6f74 6865  r.lt, self, othe
-000138f0: 7229 0a0a 2020 2020 4063 6865 636b 5f69  r)..    @check_i
-00013900: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
-00013910: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
-00013920: 6c65 5f5f 2873 656c 662c 206f 7468 6572  le__(self, other
-00013930: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00013940: 6e20 656c 656d 7769 7365 286f 7065 7261  n elemwise(opera
-00013950: 746f 722e 6c65 2c20 7365 6c66 2c20 6f74  tor.le, self, ot
-00013960: 6865 7229 0a0a 2020 2020 4063 6865 636b  her)..    @check
-00013970: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
-00013980: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
-00013990: 5f5f 6d6f 645f 5f28 7365 6c66 2c20 6f74  __mod__(self, ot
-000139a0: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-000139b0: 7475 726e 2065 6c65 6d77 6973 6528 6f70  turn elemwise(op
-000139c0: 6572 6174 6f72 2e6d 6f64 2c20 7365 6c66  erator.mod, self
-000139d0: 2c20 6f74 6865 7229 0a0a 2020 2020 4063  , other)..    @c
-000139e0: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
-000139f0: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
-00013a00: 6465 6620 5f5f 726d 6f64 5f5f 2873 656c  def __rmod__(sel
-00013a10: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
-00013a20: 2020 2072 6574 7572 6e20 656c 656d 7769     return elemwi
-00013a30: 7365 286f 7065 7261 746f 722e 6d6f 642c  se(operator.mod,
-00013a40: 206f 7468 6572 2c20 7365 6c66 290a 0a20   other, self).. 
-00013a50: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
-00013a60: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
-00013a70: 0a20 2020 2064 6566 205f 5f6d 756c 5f5f  .    def __mul__
-00013a80: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
-00013a90: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00013aa0: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
-00013ab0: 6d75 6c2c 2073 656c 662c 206f 7468 6572  mul, self, other
-00013ac0: 290a 0a20 2020 2040 6368 6563 6b5f 6966  )..    @check_if
-00013ad0: 5f68 616e 646c 6564 5f67 6976 656e 5f6f  _handled_given_o
-00013ae0: 7468 6572 0a20 2020 2064 6566 205f 5f72  ther.    def __r
-00013af0: 6d75 6c5f 5f28 7365 6c66 2c20 6f74 6865  mul__(self, othe
-00013b00: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-00013b10: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
-00013b20: 6174 6f72 2e6d 756c 2c20 6f74 6865 722c  ator.mul, other,
-00013b30: 2073 656c 6629 0a0a 2020 2020 4063 6865   self)..    @che
-00013b40: 636b 5f69 665f 6861 6e64 6c65 645f 6769  ck_if_handled_gi
-00013b50: 7665 6e5f 6f74 6865 720a 2020 2020 6465  ven_other.    de
-00013b60: 6620 5f5f 6e65 5f5f 2873 656c 662c 206f  f __ne__(self, o
-00013b70: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
-00013b80: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
-00013b90: 7065 7261 746f 722e 6e65 2c20 7365 6c66  perator.ne, self
-00013ba0: 2c20 6f74 6865 7229 0a0a 2020 2020 6465  , other)..    de
-00013bb0: 6620 5f5f 6e65 675f 5f28 7365 6c66 293a  f __neg__(self):
-00013bc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00013bd0: 656c 656d 7769 7365 286f 7065 7261 746f  elemwise(operato
-00013be0: 722e 6e65 672c 2073 656c 6629 0a0a 2020  r.neg, self)..  
-00013bf0: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
-00013c00: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
-00013c10: 2020 2020 6465 6620 5f5f 6f72 5f5f 2873      def __or__(s
-00013c20: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-00013c30: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
-00013c40: 7769 7365 286f 7065 7261 746f 722e 6f72  wise(operator.or
-00013c50: 5f2c 2073 656c 662c 206f 7468 6572 290a  _, self, other).
-00013c60: 0a20 2020 2064 6566 205f 5f70 6f73 5f5f  .    def __pos__
-00013c70: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
-00013c80: 7265 7475 726e 2073 656c 660a 0a20 2020  return self..   
-00013c90: 2040 6368 6563 6b5f 6966 5f68 616e 646c   @check_if_handl
-00013ca0: 6564 5f67 6976 656e 5f6f 7468 6572 0a20  ed_given_other. 
-00013cb0: 2020 2064 6566 205f 5f72 6f72 5f5f 2873     def __ror__(s
-00013cc0: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-00013cd0: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
-00013ce0: 7769 7365 286f 7065 7261 746f 722e 6f72  wise(operator.or
-00013cf0: 5f2c 206f 7468 6572 2c20 7365 6c66 290a  _, other, self).
-00013d00: 0a20 2020 2040 6368 6563 6b5f 6966 5f68  .    @check_if_h
-00013d10: 616e 646c 6564 5f67 6976 656e 5f6f 7468  andled_given_oth
-00013d20: 6572 0a20 2020 2064 6566 205f 5f70 6f77  er.    def __pow
-00013d30: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
-00013d40: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00013d50: 656c 656d 7769 7365 286f 7065 7261 746f  elemwise(operato
-00013d60: 722e 706f 772c 2073 656c 662c 206f 7468  r.pow, self, oth
-00013d70: 6572 290a 0a20 2020 2040 6368 6563 6b5f  er)..    @check_
-00013d80: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
-00013d90: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
-00013da0: 5f72 706f 775f 5f28 7365 6c66 2c20 6f74  _rpow__(self, ot
-00013db0: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-00013dc0: 7475 726e 2065 6c65 6d77 6973 6528 6f70  turn elemwise(op
-00013dd0: 6572 6174 6f72 2e70 6f77 2c20 6f74 6865  erator.pow, othe
-00013de0: 722c 2073 656c 6629 0a0a 2020 2020 4063  r, self)..    @c
-00013df0: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
-00013e00: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
-00013e10: 6465 6620 5f5f 7273 6869 6674 5f5f 2873  def __rshift__(s
-00013e20: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
-00013e30: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
-00013e40: 7769 7365 286f 7065 7261 746f 722e 7273  wise(operator.rs
-00013e50: 6869 6674 2c20 7365 6c66 2c20 6f74 6865  hift, self, othe
-00013e60: 7229 0a0a 2020 2020 4063 6865 636b 5f69  r)..    @check_i
-00013e70: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
-00013e80: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
-00013e90: 7272 7368 6966 745f 5f28 7365 6c66 2c20  rrshift__(self, 
-00013ea0: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
-00013eb0: 7265 7475 726e 2065 6c65 6d77 6973 6528  return elemwise(
-00013ec0: 6f70 6572 6174 6f72 2e72 7368 6966 742c  operator.rshift,
-00013ed0: 206f 7468 6572 2c20 7365 6c66 290a 0a20   other, self).. 
-00013ee0: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
-00013ef0: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
-00013f00: 0a20 2020 2064 6566 205f 5f73 7562 5f5f  .    def __sub__
-00013f10: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
-00013f20: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
-00013f30: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
-00013f40: 7375 622c 2073 656c 662c 206f 7468 6572  sub, self, other
-00013f50: 290a 0a20 2020 2040 6368 6563 6b5f 6966  )..    @check_if
-00013f60: 5f68 616e 646c 6564 5f67 6976 656e 5f6f  _handled_given_o
-00013f70: 7468 6572 0a20 2020 2064 6566 205f 5f72  ther.    def __r
-00013f80: 7375 625f 5f28 7365 6c66 2c20 6f74 6865  sub__(self, othe
-00013f90: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
-00013fa0: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
-00013fb0: 6174 6f72 2e73 7562 2c20 6f74 6865 722c  ator.sub, other,
-00013fc0: 2073 656c 6629 0a0a 2020 2020 4063 6865   self)..    @che
-00013fd0: 636b 5f69 665f 6861 6e64 6c65 645f 6769  ck_if_handled_gi
-00013fe0: 7665 6e5f 6f74 6865 720a 2020 2020 6465  ven_other.    de
-00013ff0: 6620 5f5f 7472 7565 6469 765f 5f28 7365  f __truediv__(se
-00014000: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
-00014010: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
-00014020: 6973 6528 6f70 6572 6174 6f72 2e74 7275  ise(operator.tru
-00014030: 6564 6976 2c20 7365 6c66 2c20 6f74 6865  ediv, self, othe
-00014040: 7229 0a0a 2020 2020 4063 6865 636b 5f69  r)..    @check_i
-00014050: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
-00014060: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
-00014070: 7274 7275 6564 6976 5f5f 2873 656c 662c  rtruediv__(self,
-00014080: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00014090: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
-000140a0: 286f 7065 7261 746f 722e 7472 7565 6469  (operator.truedi
-000140b0: 762c 206f 7468 6572 2c20 7365 6c66 290a  v, other, self).
-000140c0: 0a20 2020 2040 6368 6563 6b5f 6966 5f68  .    @check_if_h
-000140d0: 616e 646c 6564 5f67 6976 656e 5f6f 7468  andled_given_oth
-000140e0: 6572 0a20 2020 2064 6566 205f 5f66 6c6f  er.    def __flo
-000140f0: 6f72 6469 765f 5f28 7365 6c66 2c20 6f74  ordiv__(self, ot
-00014100: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
-00014110: 7475 726e 2065 6c65 6d77 6973 6528 6f70  turn elemwise(op
-00014120: 6572 6174 6f72 2e66 6c6f 6f72 6469 762c  erator.floordiv,
-00014130: 2073 656c 662c 206f 7468 6572 290a 0a20   self, other).. 
-00014140: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
-00014150: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
-00014160: 0a20 2020 2064 6566 205f 5f72 666c 6f6f  .    def __rfloo
-00014170: 7264 6976 5f5f 2873 656c 662c 206f 7468  rdiv__(self, oth
-00014180: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
-00014190: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
-000141a0: 7261 746f 722e 666c 6f6f 7264 6976 2c20  rator.floordiv, 
-000141b0: 6f74 6865 722c 2073 656c 6629 0a0a 2020  other, self)..  
-000141c0: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
-000141d0: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
-000141e0: 2020 2020 6465 6620 5f5f 786f 725f 5f28      def __xor__(
-000141f0: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
-00014200: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
-00014210: 6d77 6973 6528 6f70 6572 6174 6f72 2e78  mwise(operator.x
-00014220: 6f72 2c20 7365 6c66 2c20 6f74 6865 7229  or, self, other)
-00014230: 0a0a 2020 2020 4063 6865 636b 5f69 665f  ..    @check_if_
-00014240: 6861 6e64 6c65 645f 6769 7665 6e5f 6f74  handled_given_ot
-00014250: 6865 720a 2020 2020 6465 6620 5f5f 7278  her.    def __rx
-00014260: 6f72 5f5f 2873 656c 662c 206f 7468 6572  or__(self, other
-00014270: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00014280: 6e20 656c 656d 7769 7365 286f 7065 7261  n elemwise(opera
-00014290: 746f 722e 786f 722c 206f 7468 6572 2c20  tor.xor, other, 
-000142a0: 7365 6c66 290a 0a20 2020 2040 6368 6563  self)..    @chec
-000142b0: 6b5f 6966 5f68 616e 646c 6564 5f67 6976  k_if_handled_giv
-000142c0: 656e 5f6f 7468 6572 0a20 2020 2064 6566  en_other.    def
-000142d0: 205f 5f6d 6174 6d75 6c5f 5f28 7365 6c66   __matmul__(self
-000142e0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
-000142f0: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
-00014300: 792e 726f 7574 696e 6573 2069 6d70 6f72  y.routines impor
-00014310: 7420 6d61 746d 756c 0a0a 2020 2020 2020  t matmul..      
-00014320: 2020 7265 7475 726e 206d 6174 6d75 6c28    return matmul(
-00014330: 7365 6c66 2c20 6f74 6865 7229 0a0a 2020  self, other)..  
-00014340: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
-00014350: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
-00014360: 2020 2020 6465 6620 5f5f 726d 6174 6d75      def __rmatmu
-00014370: 6c5f 5f28 7365 6c66 2c20 6f74 6865 7229  l__(self, other)
-00014380: 3a0a 2020 2020 2020 2020 6672 6f6d 2064  :.        from d
-00014390: 6173 6b2e 6172 7261 792e 726f 7574 696e  ask.array.routin
-000143a0: 6573 2069 6d70 6f72 7420 6d61 746d 756c  es import matmul
-000143b0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000143c0: 206d 6174 6d75 6c28 6f74 6865 722c 2073   matmul(other, s
-000143d0: 656c 6629 0a0a 2020 2020 4063 6865 636b  elf)..    @check
-000143e0: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
-000143f0: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
-00014400: 5f5f 6469 766d 6f64 5f5f 2873 656c 662c  __divmod__(self,
-00014410: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
-00014420: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
-00014430: 2e75 6675 6e63 2069 6d70 6f72 7420 6469  .ufunc import di
-00014440: 766d 6f64 0a0a 2020 2020 2020 2020 7265  vmod..        re
-00014450: 7475 726e 2064 6976 6d6f 6428 7365 6c66  turn divmod(self
-00014460: 2c20 6f74 6865 7229 0a0a 2020 2020 4063  , other)..    @c
-00014470: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
-00014480: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
-00014490: 6465 6620 5f5f 7264 6976 6d6f 645f 5f28  def __rdivmod__(
-000144a0: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
-000144b0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
-000144c0: 6172 7261 792e 7566 756e 6320 696d 706f  array.ufunc impo
-000144d0: 7274 2064 6976 6d6f 640a 0a20 2020 2020  rt divmod..     
-000144e0: 2020 2072 6574 7572 6e20 6469 766d 6f64     return divmod
-000144f0: 286f 7468 6572 2c20 7365 6c66 290a 0a20  (other, self).. 
-00014500: 2020 2064 6566 2061 6e79 2873 656c 662c     def any(self,
-00014510: 2061 7869 733d 4e6f 6e65 2c20 6b65 6570   axis=None, keep
-00014520: 6469 6d73 3d46 616c 7365 2c20 7370 6c69  dims=False, spli
-00014530: 745f 6576 6572 793d 4e6f 6e65 2c20 6f75  t_every=None, ou
-00014540: 743d 4e6f 6e65 293a 0a20 2020 2020 2020  t=None):.       
-00014550: 2022 2222 5265 7475 726e 7320 5472 7565   """Returns True
-00014560: 2069 6620 616e 7920 6f66 2074 6865 2065   if any of the e
-00014570: 6c65 6d65 6e74 7320 6576 616c 7561 7465  lements evaluate
-00014580: 2074 6f20 5472 7565 2e0a 0a20 2020 2020   to True...     
-00014590: 2020 2052 6566 6572 2074 6f20 3a66 756e     Refer to :fun
-000145a0: 633a 6064 6173 6b2e 6172 7261 792e 616e  c:`dask.array.an
-000145b0: 7960 2066 6f72 2066 756c 6c20 646f 6375  y` for full docu
-000145c0: 6d65 6e74 6174 696f 6e2e 0a0a 2020 2020  mentation...    
-000145d0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-000145e0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-000145f0: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-00014600: 2e61 6e79 203a 2065 7175 6976 616c 656e  .any : equivalen
-00014610: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
-00014620: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00014630: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
-00014640: 6564 7563 7469 6f6e 7320 696d 706f 7274  eductions import
-00014650: 2061 6e79 0a0a 2020 2020 2020 2020 7265   any..        re
-00014660: 7475 726e 2061 6e79 2873 656c 662c 2061  turn any(self, a
-00014670: 7869 733d 6178 6973 2c20 6b65 6570 6469  xis=axis, keepdi
-00014680: 6d73 3d6b 6565 7064 696d 732c 2073 706c  ms=keepdims, spl
-00014690: 6974 5f65 7665 7279 3d73 706c 6974 5f65  it_every=split_e
-000146a0: 7665 7279 2c20 6f75 743d 6f75 7429 0a0a  very, out=out)..
-000146b0: 2020 2020 6465 6620 616c 6c28 7365 6c66      def all(self
-000146c0: 2c20 6178 6973 3d4e 6f6e 652c 206b 6565  , axis=None, kee
-000146d0: 7064 696d 733d 4661 6c73 652c 2073 706c  pdims=False, spl
-000146e0: 6974 5f65 7665 7279 3d4e 6f6e 652c 206f  it_every=None, o
-000146f0: 7574 3d4e 6f6e 6529 3a0a 2020 2020 2020  ut=None):.      
-00014700: 2020 2222 2252 6574 7572 6e73 2054 7275    """Returns Tru
-00014710: 6520 6966 2061 6c6c 2065 6c65 6d65 6e74  e if all element
-00014720: 7320 6576 616c 7561 7465 2074 6f20 5472  s evaluate to Tr
-00014730: 7565 2e0a 0a20 2020 2020 2020 2052 6566  ue...        Ref
-00014740: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
-00014750: 6b2e 6172 7261 792e 616c 6c60 2066 6f72  k.array.all` for
-00014760: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
-00014770: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
-00014780: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00014790: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-000147a0: 6461 736b 2e61 7272 6179 2e61 6c6c 203a  dask.array.all :
-000147b0: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
-000147c0: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
-000147d0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
-000147e0: 736b 2e61 7272 6179 2e72 6564 7563 7469  sk.array.reducti
-000147f0: 6f6e 7320 696d 706f 7274 2061 6c6c 0a0a  ons import all..
-00014800: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00014810: 6c6c 2873 656c 662c 2061 7869 733d 6178  ll(self, axis=ax
-00014820: 6973 2c20 6b65 6570 6469 6d73 3d6b 6565  is, keepdims=kee
-00014830: 7064 696d 732c 2073 706c 6974 5f65 7665  pdims, split_eve
-00014840: 7279 3d73 706c 6974 5f65 7665 7279 2c20  ry=split_every, 
-00014850: 6f75 743d 6f75 7429 0a0a 2020 2020 6465  out=out)..    de
-00014860: 6620 6d69 6e28 7365 6c66 2c20 6178 6973  f min(self, axis
-00014870: 3d4e 6f6e 652c 206b 6565 7064 696d 733d  =None, keepdims=
-00014880: 4661 6c73 652c 2073 706c 6974 5f65 7665  False, split_eve
-00014890: 7279 3d4e 6f6e 652c 206f 7574 3d4e 6f6e  ry=None, out=Non
-000148a0: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
-000148b0: 6574 7572 6e20 7468 6520 6d69 6e69 6d75  eturn the minimu
-000148c0: 6d20 616c 6f6e 6720 6120 6769 7665 6e20  m along a given 
-000148d0: 6178 6973 2e0a 0a20 2020 2020 2020 2052  axis...        R
-000148e0: 6566 6572 2074 6f20 3a66 756e 633a 6064  efer to :func:`d
-000148f0: 6173 6b2e 6172 7261 792e 6d69 6e60 2066  ask.array.min` f
-00014900: 6f72 2066 756c 6c20 646f 6375 6d65 6e74  or full document
-00014910: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00014920: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-00014930: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00014940: 2020 6461 736b 2e61 7272 6179 2e6d 696e    dask.array.min
-00014950: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
-00014960: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
-00014970: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00014980: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
-00014990: 7469 6f6e 7320 696d 706f 7274 206d 696e  tions import min
-000149a0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000149b0: 206d 696e 2873 656c 662c 2061 7869 733d   min(self, axis=
-000149c0: 6178 6973 2c20 6b65 6570 6469 6d73 3d6b  axis, keepdims=k
-000149d0: 6565 7064 696d 732c 2073 706c 6974 5f65  eepdims, split_e
-000149e0: 7665 7279 3d73 706c 6974 5f65 7665 7279  very=split_every
-000149f0: 2c20 6f75 743d 6f75 7429 0a0a 2020 2020  , out=out)..    
-00014a00: 6465 6620 6d61 7828 7365 6c66 2c20 6178  def max(self, ax
-00014a10: 6973 3d4e 6f6e 652c 206b 6565 7064 696d  is=None, keepdim
-00014a20: 733d 4661 6c73 652c 2073 706c 6974 5f65  s=False, split_e
-00014a30: 7665 7279 3d4e 6f6e 652c 206f 7574 3d4e  very=None, out=N
-00014a40: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00014a50: 2252 6574 7572 6e20 7468 6520 6d61 7869  "Return the maxi
-00014a60: 6d75 6d20 616c 6f6e 6720 6120 6769 7665  mum along a give
-00014a70: 6e20 6178 6973 2e0a 0a20 2020 2020 2020  n axis...       
-00014a80: 2052 6566 6572 2074 6f20 3a66 756e 633a   Refer to :func:
-00014a90: 6064 6173 6b2e 6172 7261 792e 6d61 7860  `dask.array.max`
-00014aa0: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
-00014ab0: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
-00014ac0: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-00014ad0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00014ae0: 2020 2020 6461 736b 2e61 7272 6179 2e6d      dask.array.m
-00014af0: 6178 203a 2065 7175 6976 616c 656e 7420  ax : equivalent 
-00014b00: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00014b10: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00014b20: 6d20 6461 736b 2e61 7272 6179 2e72 6564  m dask.array.red
-00014b30: 7563 7469 6f6e 7320 696d 706f 7274 206d  uctions import m
-00014b40: 6178 0a0a 2020 2020 2020 2020 7265 7475  ax..        retu
-00014b50: 726e 206d 6178 2873 656c 662c 2061 7869  rn max(self, axi
-00014b60: 733d 6178 6973 2c20 6b65 6570 6469 6d73  s=axis, keepdims
-00014b70: 3d6b 6565 7064 696d 732c 2073 706c 6974  =keepdims, split
-00014b80: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
-00014b90: 7279 2c20 6f75 743d 6f75 7429 0a0a 2020  ry, out=out)..  
-00014ba0: 2020 6465 6620 6172 676d 696e 2873 656c    def argmin(sel
-00014bb0: 662c 2061 7869 733d 4e6f 6e65 2c20 2a2c  f, axis=None, *,
-00014bc0: 206b 6565 7064 696d 733d 4661 6c73 652c   keepdims=False,
-00014bd0: 2073 706c 6974 5f65 7665 7279 3d4e 6f6e   split_every=Non
-00014be0: 652c 206f 7574 3d4e 6f6e 6529 3a0a 2020  e, out=None):.  
-00014bf0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
-00014c00: 696e 6469 6365 7320 6f66 2074 6865 206d  indices of the m
-00014c10: 696e 696d 756d 2076 616c 7565 7320 616c  inimum values al
-00014c20: 6f6e 6720 7468 6520 6769 7665 6e20 6178  ong the given ax
-00014c30: 6973 2e0a 0a20 2020 2020 2020 2052 6566  is...        Ref
-00014c40: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
-00014c50: 6b2e 6172 7261 792e 6172 676d 696e 6020  k.array.argmin` 
-00014c60: 666f 7220 6675 6c6c 2064 6f63 756d 656e  for full documen
-00014c70: 7461 7469 6f6e 2e0a 0a20 2020 2020 2020  tation...       
-00014c80: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-00014c90: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00014ca0: 2020 2064 6173 6b2e 6172 7261 792e 6172     dask.array.ar
-00014cb0: 676d 696e 203a 2065 7175 6976 616c 656e  gmin : equivalen
-00014cc0: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
-00014cd0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00014ce0: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
-00014cf0: 6564 7563 7469 6f6e 7320 696d 706f 7274  eductions import
-00014d00: 2061 7267 6d69 6e0a 0a20 2020 2020 2020   argmin..       
-00014d10: 2072 6574 7572 6e20 6172 676d 696e 280a   return argmin(.
-00014d20: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00014d30: 2c20 6178 6973 3d61 7869 732c 206b 6565  , axis=axis, kee
-00014d40: 7064 696d 733d 6b65 6570 6469 6d73 2c20  pdims=keepdims, 
-00014d50: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
-00014d60: 745f 6576 6572 792c 206f 7574 3d6f 7574  t_every, out=out
-00014d70: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00014d80: 6465 6620 6172 676d 6178 2873 656c 662c  def argmax(self,
-00014d90: 2061 7869 733d 4e6f 6e65 2c20 2a2c 206b   axis=None, *, k
-00014da0: 6565 7064 696d 733d 4661 6c73 652c 2073  eepdims=False, s
-00014db0: 706c 6974 5f65 7665 7279 3d4e 6f6e 652c  plit_every=None,
-00014dc0: 206f 7574 3d4e 6f6e 6529 3a0a 2020 2020   out=None):.    
-00014dd0: 2020 2020 2222 2252 6574 7572 6e20 696e      """Return in
-00014de0: 6469 6365 7320 6f66 2074 6865 206d 6178  dices of the max
-00014df0: 696d 756d 2076 616c 7565 7320 616c 6f6e  imum values alon
-00014e00: 6720 7468 6520 6769 7665 6e20 6178 6973  g the given axis
-00014e10: 2e0a 0a20 2020 2020 2020 2052 6566 6572  ...        Refer
-00014e20: 2074 6f20 3a66 756e 633a 6064 6173 6b2e   to :func:`dask.
-00014e30: 6172 7261 792e 6172 676d 6178 6020 666f  array.argmax` fo
-00014e40: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
-00014e50: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
-00014e60: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-00014e70: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00014e80: 2064 6173 6b2e 6172 7261 792e 6172 676d   dask.array.argm
-00014e90: 6178 203a 2065 7175 6976 616c 656e 7420  ax : equivalent 
-00014ea0: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00014eb0: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00014ec0: 6d20 6461 736b 2e61 7272 6179 2e72 6564  m dask.array.red
-00014ed0: 7563 7469 6f6e 7320 696d 706f 7274 2061  uctions import a
-00014ee0: 7267 6d61 780a 0a20 2020 2020 2020 2072  rgmax..        r
-00014ef0: 6574 7572 6e20 6172 676d 6178 280a 2020  eturn argmax(.  
-00014f00: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
-00014f10: 6178 6973 3d61 7869 732c 206b 6565 7064  axis=axis, keepd
-00014f20: 696d 733d 6b65 6570 6469 6d73 2c20 7370  ims=keepdims, sp
-00014f30: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
-00014f40: 6576 6572 792c 206f 7574 3d6f 7574 0a20  every, out=out. 
-00014f50: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00014f60: 6620 7375 6d28 7365 6c66 2c20 6178 6973  f sum(self, axis
-00014f70: 3d4e 6f6e 652c 2064 7479 7065 3d4e 6f6e  =None, dtype=Non
-00014f80: 652c 206b 6565 7064 696d 733d 4661 6c73  e, keepdims=Fals
-00014f90: 652c 2073 706c 6974 5f65 7665 7279 3d4e  e, split_every=N
-00014fa0: 6f6e 652c 206f 7574 3d4e 6f6e 6529 3a0a  one, out=None):.
-00014fb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00014fc0: 2020 2020 5265 7475 726e 2074 6865 2073      Return the s
-00014fd0: 756d 206f 6620 7468 6520 6172 7261 7920  um of the array 
-00014fe0: 656c 656d 656e 7473 206f 7665 7220 7468  elements over th
-00014ff0: 6520 6769 7665 6e20 6178 6973 2e0a 0a20  e given axis... 
-00015000: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
-00015010: 3a66 756e 633a 6064 6173 6b2e 6172 7261  :func:`dask.arra
-00015020: 792e 7375 6d60 2066 6f72 2066 756c 6c20  y.sum` for full 
-00015030: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
-00015040: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-00015050: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00015060: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
-00015070: 7272 6179 2e73 756d 203a 2065 7175 6976  rray.sum : equiv
-00015080: 616c 656e 7420 6675 6e63 7469 6f6e 0a20  alent function. 
-00015090: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000150a0: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
-000150b0: 6179 2e72 6564 7563 7469 6f6e 7320 696d  ay.reductions im
-000150c0: 706f 7274 2073 756d 0a0a 2020 2020 2020  port sum..      
-000150d0: 2020 7265 7475 726e 2073 756d 280a 2020    return sum(.  
-000150e0: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
-000150f0: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-00015100: 3d61 7869 732c 0a20 2020 2020 2020 2020  =axis,.         
-00015110: 2020 2064 7479 7065 3d64 7479 7065 2c0a     dtype=dtype,.
-00015120: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-00015130: 6469 6d73 3d6b 6565 7064 696d 732c 0a20  dims=keepdims,. 
-00015140: 2020 2020 2020 2020 2020 2073 706c 6974             split
-00015150: 5f65 7665 7279 3d73 706c 6974 5f65 7665  _every=split_eve
-00015160: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-00015170: 6f75 743d 6f75 742c 0a20 2020 2020 2020  out=out,.       
-00015180: 2029 0a0a 2020 2020 6465 6620 7472 6163   )..    def trac
-00015190: 6528 7365 6c66 2c20 6f66 6673 6574 3d30  e(self, offset=0
-000151a0: 2c20 6178 6973 313d 302c 2061 7869 7332  , axis1=0, axis2
-000151b0: 3d31 2c20 6474 7970 653d 4e6f 6e65 293a  =1, dtype=None):
-000151c0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-000151d0: 726e 2074 6865 2073 756d 2061 6c6f 6e67  rn the sum along
-000151e0: 2064 6961 676f 6e61 6c73 206f 6620 7468   diagonals of th
-000151f0: 6520 6172 7261 792e 0a0a 2020 2020 2020  e array...      
-00015200: 2020 5265 6665 7220 746f 203a 6675 6e63    Refer to :func
-00015210: 3a60 6461 736b 2e61 7272 6179 2e74 7261  :`dask.array.tra
-00015220: 6365 6020 666f 7220 6675 6c6c 2064 6f63  ce` for full doc
-00015230: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
-00015240: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
-00015250: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
-00015260: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
-00015270: 792e 7472 6163 6520 3a20 6571 7569 7661  y.trace : equiva
-00015280: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
-00015290: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000152a0: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
-000152b0: 792e 7265 6475 6374 696f 6e73 2069 6d70  y.reductions imp
-000152c0: 6f72 7420 7472 6163 650a 0a20 2020 2020  ort trace..     
-000152d0: 2020 2072 6574 7572 6e20 7472 6163 6528     return trace(
-000152e0: 7365 6c66 2c20 6f66 6673 6574 3d6f 6666  self, offset=off
-000152f0: 7365 742c 2061 7869 7331 3d61 7869 7331  set, axis1=axis1
-00015300: 2c20 6178 6973 323d 6178 6973 322c 2064  , axis2=axis2, d
-00015310: 7479 7065 3d64 7479 7065 290a 0a20 2020  type=dtype)..   
-00015320: 2064 6566 2070 726f 6428 7365 6c66 2c20   def prod(self, 
-00015330: 6178 6973 3d4e 6f6e 652c 2064 7479 7065  axis=None, dtype
-00015340: 3d4e 6f6e 652c 206b 6565 7064 696d 733d  =None, keepdims=
-00015350: 4661 6c73 652c 2073 706c 6974 5f65 7665  False, split_eve
-00015360: 7279 3d4e 6f6e 652c 206f 7574 3d4e 6f6e  ry=None, out=Non
-00015370: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
-00015380: 6574 7572 6e20 7468 6520 7072 6f64 7563  eturn the produc
-00015390: 7420 6f66 2074 6865 2061 7272 6179 2065  t of the array e
-000153a0: 6c65 6d65 6e74 7320 6f76 6572 2074 6865  lements over the
-000153b0: 2067 6976 656e 2061 7869 730a 0a20 2020   given axis..   
-000153c0: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
-000153d0: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
-000153e0: 7072 6f64 6020 666f 7220 6675 6c6c 2064  prod` for full d
-000153f0: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
-00015400: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
-00015410: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
-00015420: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
-00015430: 7261 792e 7072 6f64 203a 2065 7175 6976  ray.prod : equiv
-00015440: 616c 656e 7420 6675 6e63 7469 6f6e 0a20  alent function. 
-00015450: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015460: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
-00015470: 6179 2e72 6564 7563 7469 6f6e 7320 696d  ay.reductions im
-00015480: 706f 7274 2070 726f 640a 0a20 2020 2020  port prod..     
-00015490: 2020 2072 6574 7572 6e20 7072 6f64 280a     return prod(.
-000154a0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000154b0: 2c0a 2020 2020 2020 2020 2020 2020 6178  ,.            ax
-000154c0: 6973 3d61 7869 732c 0a20 2020 2020 2020  is=axis,.       
-000154d0: 2020 2020 2064 7479 7065 3d64 7479 7065       dtype=dtype
-000154e0: 2c0a 2020 2020 2020 2020 2020 2020 6b65  ,.            ke
-000154f0: 6570 6469 6d73 3d6b 6565 7064 696d 732c  epdims=keepdims,
-00015500: 0a20 2020 2020 2020 2020 2020 2073 706c  .            spl
-00015510: 6974 5f65 7665 7279 3d73 706c 6974 5f65  it_every=split_e
-00015520: 7665 7279 2c0a 2020 2020 2020 2020 2020  very,.          
-00015530: 2020 6f75 743d 6f75 742c 0a20 2020 2020    out=out,.     
-00015540: 2020 2029 0a0a 2020 2020 6465 6620 6d65     )..    def me
-00015550: 616e 2873 656c 662c 2061 7869 733d 4e6f  an(self, axis=No
-00015560: 6e65 2c20 6474 7970 653d 4e6f 6e65 2c20  ne, dtype=None, 
-00015570: 6b65 6570 6469 6d73 3d46 616c 7365 2c20  keepdims=False, 
-00015580: 7370 6c69 745f 6576 6572 793d 4e6f 6e65  split_every=None
-00015590: 2c20 6f75 743d 4e6f 6e65 293a 0a20 2020  , out=None):.   
-000155a0: 2020 2020 2022 2222 5265 7475 726e 7320       """Returns 
-000155b0: 7468 6520 6176 6572 6167 6520 6f66 2074  the average of t
-000155c0: 6865 2061 7272 6179 2065 6c65 6d65 6e74  he array element
-000155d0: 7320 616c 6f6e 6720 6769 7665 6e20 6178  s along given ax
-000155e0: 6973 2e0a 0a20 2020 2020 2020 2052 6566  is...        Ref
-000155f0: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
-00015600: 6b2e 6172 7261 792e 6d65 616e 6020 666f  k.array.mean` fo
-00015610: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
-00015620: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
-00015630: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
-00015640: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
-00015650: 2064 6173 6b2e 6172 7261 792e 6d65 616e   dask.array.mean
-00015660: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
-00015670: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
-00015680: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
-00015690: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
-000156a0: 7469 6f6e 7320 696d 706f 7274 206d 6561  tions import mea
-000156b0: 6e0a 0a20 2020 2020 2020 2072 6574 7572  n..        retur
-000156c0: 6e20 6d65 616e 280a 2020 2020 2020 2020  n mean(.        
-000156d0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-000156e0: 2020 2020 2020 6178 6973 3d61 7869 732c        axis=axis,
-000156f0: 0a20 2020 2020 2020 2020 2020 2064 7479  .            dty
-00015700: 7065 3d64 7479 7065 2c0a 2020 2020 2020  pe=dtype,.      
-00015710: 2020 2020 2020 6b65 6570 6469 6d73 3d6b        keepdims=k
-00015720: 6565 7064 696d 732c 0a20 2020 2020 2020  eepdims,.       
-00015730: 2020 2020 2073 706c 6974 5f65 7665 7279       split_every
-00015740: 3d73 706c 6974 5f65 7665 7279 2c0a 2020  =split_every,.  
-00015750: 2020 2020 2020 2020 2020 6f75 743d 6f75            out=ou
-00015760: 742c 0a20 2020 2020 2020 2029 0a0a 2020  t,.        )..  
-00015770: 2020 6465 6620 7374 6428 0a20 2020 2020    def std(.     
-00015780: 2020 2073 656c 662c 2061 7869 733d 4e6f     self, axis=No
-00015790: 6e65 2c20 6474 7970 653d 4e6f 6e65 2c20  ne, dtype=None, 
-000157a0: 6b65 6570 6469 6d73 3d46 616c 7365 2c20  keepdims=False, 
-000157b0: 6464 6f66 3d30 2c20 7370 6c69 745f 6576  ddof=0, split_ev
-000157c0: 6572 793d 4e6f 6e65 2c20 6f75 743d 4e6f  ery=None, out=No
-000157d0: 6e65 0a20 2020 2029 3a0a 2020 2020 2020  ne.    ):.      
-000157e0: 2020 2222 2252 6574 7572 6e73 2074 6865    """Returns the
-000157f0: 2073 7461 6e64 6172 6420 6465 7669 6174   standard deviat
-00015800: 696f 6e20 6f66 2074 6865 2061 7272 6179  ion of the array
-00015810: 2065 6c65 6d65 6e74 7320 616c 6f6e 6720   elements along 
-00015820: 6769 7665 6e20 6178 6973 2e0a 0a20 2020  given axis...   
-00015830: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
-00015840: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
-00015850: 7374 6460 2066 6f72 2066 756c 6c20 646f  std` for full do
-00015860: 6375 6d65 6e74 6174 696f 6e2e 0a0a 2020  cumentation...  
-00015870: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
-00015880: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-00015890: 2020 2020 2020 2020 6461 736b 2e61 7272          dask.arr
-000158a0: 6179 2e73 7464 203a 2065 7175 6976 616c  ay.std : equival
-000158b0: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
-000158c0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-000158d0: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
-000158e0: 2e72 6564 7563 7469 6f6e 7320 696d 706f  .reductions impo
-000158f0: 7274 2073 7464 0a0a 2020 2020 2020 2020  rt std..        
-00015900: 7265 7475 726e 2073 7464 280a 2020 2020  return std(.    
-00015910: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-00015920: 2020 2020 2020 2020 2020 6178 6973 3d61            axis=a
-00015930: 7869 732c 0a20 2020 2020 2020 2020 2020  xis,.           
-00015940: 2064 7479 7065 3d64 7479 7065 2c0a 2020   dtype=dtype,.  
-00015950: 2020 2020 2020 2020 2020 6b65 6570 6469            keepdi
-00015960: 6d73 3d6b 6565 7064 696d 732c 0a20 2020  ms=keepdims,.   
-00015970: 2020 2020 2020 2020 2064 646f 663d 6464           ddof=dd
-00015980: 6f66 2c0a 2020 2020 2020 2020 2020 2020  of,.            
-00015990: 7370 6c69 745f 6576 6572 793d 7370 6c69  split_every=spli
-000159a0: 745f 6576 6572 792c 0a20 2020 2020 2020  t_every,.       
-000159b0: 2020 2020 206f 7574 3d6f 7574 2c0a 2020       out=out,.  
-000159c0: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
-000159d0: 2076 6172 280a 2020 2020 2020 2020 7365   var(.        se
-000159e0: 6c66 2c20 6178 6973 3d4e 6f6e 652c 2064  lf, axis=None, d
-000159f0: 7479 7065 3d4e 6f6e 652c 206b 6565 7064  type=None, keepd
-00015a00: 696d 733d 4661 6c73 652c 2064 646f 663d  ims=False, ddof=
-00015a10: 302c 2073 706c 6974 5f65 7665 7279 3d4e  0, split_every=N
-00015a20: 6f6e 652c 206f 7574 3d4e 6f6e 650a 2020  one, out=None.  
-00015a30: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-00015a40: 5265 7475 726e 7320 7468 6520 7661 7269  Returns the vari
-00015a50: 616e 6365 206f 6620 7468 6520 6172 7261  ance of the arra
-00015a60: 7920 656c 656d 656e 7473 2c20 616c 6f6e  y elements, alon
-00015a70: 6720 6769 7665 6e20 6178 6973 2e0a 0a20  g given axis... 
-00015a80: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
-00015a90: 3a66 756e 633a 6064 6173 6b2e 6172 7261  :func:`dask.arra
-00015aa0: 792e 7661 7260 2066 6f72 2066 756c 6c20  y.var` for full 
-00015ab0: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
-00015ac0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
-00015ad0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
-00015ae0: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
-00015af0: 7272 6179 2e76 6172 203a 2065 7175 6976  rray.var : equiv
-00015b00: 616c 656e 7420 6675 6e63 7469 6f6e 0a20  alent function. 
-00015b10: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00015b20: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
-00015b30: 6179 2e72 6564 7563 7469 6f6e 7320 696d  ay.reductions im
-00015b40: 706f 7274 2076 6172 0a0a 2020 2020 2020  port var..      
-00015b50: 2020 7265 7475 726e 2076 6172 280a 2020    return var(.  
-00015b60: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
-00015b70: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-00015b80: 3d61 7869 732c 0a20 2020 2020 2020 2020  =axis,.         
-00015b90: 2020 2064 7479 7065 3d64 7479 7065 2c0a     dtype=dtype,.
-00015ba0: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-00015bb0: 6469 6d73 3d6b 6565 7064 696d 732c 0a20  dims=keepdims,. 
-00015bc0: 2020 2020 2020 2020 2020 2064 646f 663d             ddof=
-00015bd0: 6464 6f66 2c0a 2020 2020 2020 2020 2020  ddof,.          
-00015be0: 2020 7370 6c69 745f 6576 6572 793d 7370    split_every=sp
-00015bf0: 6c69 745f 6576 6572 792c 0a20 2020 2020  lit_every,.     
-00015c00: 2020 2020 2020 206f 7574 3d6f 7574 2c0a         out=out,.
-00015c10: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00015c20: 6566 206d 6f6d 656e 7428 0a20 2020 2020  ef moment(.     
-00015c30: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00015c40: 206f 7264 6572 2c0a 2020 2020 2020 2020   order,.        
-00015c50: 6178 6973 3d4e 6f6e 652c 0a20 2020 2020  axis=None,.     
-00015c60: 2020 2064 7479 7065 3d4e 6f6e 652c 0a20     dtype=None,. 
-00015c70: 2020 2020 2020 206b 6565 7064 696d 733d         keepdims=
-00015c80: 4661 6c73 652c 0a20 2020 2020 2020 2064  False,.        d
-00015c90: 646f 663d 302c 0a20 2020 2020 2020 2073  dof=0,.        s
-00015ca0: 706c 6974 5f65 7665 7279 3d4e 6f6e 652c  plit_every=None,
-00015cb0: 0a20 2020 2020 2020 206f 7574 3d4e 6f6e  .        out=Non
-00015cc0: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-00015cd0: 2020 2222 2243 616c 6375 6c61 7465 2074    """Calculate t
-00015ce0: 6865 206e 7468 2063 656e 7472 616c 697a  he nth centraliz
-00015cf0: 6564 206d 6f6d 656e 742e 0a0a 2020 2020  ed moment...    
-00015d00: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
-00015d10: 6e63 3a60 6461 736b 2e61 7272 6179 2e6d  nc:`dask.array.m
-00015d20: 6f6d 656e 7460 2066 6f72 2074 6865 2066  oment` for the f
-00015d30: 756c 6c20 646f 6375 6d65 6e74 6174 696f  ull documentatio
-00015d40: 6e2e 0a0a 2020 2020 2020 2020 5365 6520  n...        See 
-00015d50: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
-00015d60: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
-00015d70: 736b 2e61 7272 6179 2e6d 6f6d 656e 7420  sk.array.moment 
-00015d80: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
-00015d90: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
-00015da0: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
-00015db0: 6173 6b2e 6172 7261 792e 7265 6475 6374  ask.array.reduct
-00015dc0: 696f 6e73 2069 6d70 6f72 7420 6d6f 6d65  ions import mome
-00015dd0: 6e74 0a0a 2020 2020 2020 2020 7265 7475  nt..        retu
-00015de0: 726e 206d 6f6d 656e 7428 0a20 2020 2020  rn moment(.     
-00015df0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-00015e00: 2020 2020 2020 2020 206f 7264 6572 2c0a           order,.
-00015e10: 2020 2020 2020 2020 2020 2020 6178 6973              axis
-00015e20: 3d61 7869 732c 0a20 2020 2020 2020 2020  =axis,.         
-00015e30: 2020 2064 7479 7065 3d64 7479 7065 2c0a     dtype=dtype,.
-00015e40: 2020 2020 2020 2020 2020 2020 6b65 6570              keep
-00015e50: 6469 6d73 3d6b 6565 7064 696d 732c 0a20  dims=keepdims,. 
-00015e60: 2020 2020 2020 2020 2020 2064 646f 663d             ddof=
-00015e70: 6464 6f66 2c0a 2020 2020 2020 2020 2020  ddof,.          
-00015e80: 2020 7370 6c69 745f 6576 6572 793d 7370    split_every=sp
-00015e90: 6c69 745f 6576 6572 792c 0a20 2020 2020  lit_every,.     
-00015ea0: 2020 2020 2020 206f 7574 3d6f 7574 2c0a         out=out,.
-00015eb0: 2020 2020 2020 2020 290a 0a20 2020 2040          )..    @
-00015ec0: 7772 6170 7328 6d61 705f 626c 6f63 6b73  wraps(map_blocks
-00015ed0: 290a 2020 2020 6465 6620 6d61 705f 626c  ).    def map_bl
-00015ee0: 6f63 6b73 2873 656c 662c 2066 756e 632c  ocks(self, func,
-00015ef0: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00015f00: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00015f10: 6e20 6d61 705f 626c 6f63 6b73 2866 756e  n map_blocks(fun
-00015f20: 632c 2073 656c 662c 202a 6172 6773 2c20  c, self, *args, 
-00015f30: 2a2a 6b77 6172 6773 290a 0a20 2020 2064  **kwargs)..    d
-00015f40: 6566 206d 6170 5f6f 7665 726c 6170 2873  ef map_overlap(s
-00015f50: 656c 662c 2066 756e 632c 2064 6570 7468  elf, func, depth
-00015f60: 2c20 626f 756e 6461 7279 3d4e 6f6e 652c  , boundary=None,
-00015f70: 2074 7269 6d3d 5472 7565 2c20 2a2a 6b77   trim=True, **kw
-00015f80: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-00015f90: 2222 4d61 7020 6120 6675 6e63 7469 6f6e  ""Map a function
-00015fa0: 206f 7665 7220 626c 6f63 6b73 206f 6620   over blocks of 
-00015fb0: 7468 6520 6172 7261 7920 7769 7468 2073  the array with s
-00015fc0: 6f6d 6520 6f76 6572 6c61 700a 0a20 2020  ome overlap..   
-00015fd0: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
-00015fe0: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
-00015ff0: 6d61 705f 6f76 6572 6c61 7060 2066 6f72  map_overlap` for
-00016000: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
-00016010: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
-00016020: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00016030: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00016040: 6461 736b 2e61 7272 6179 2e6d 6170 5f6f  dask.array.map_o
-00016050: 7665 726c 6170 203a 2065 7175 6976 616c  verlap : equival
-00016060: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
-00016070: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016080: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
-00016090: 2e6f 7665 726c 6170 2069 6d70 6f72 7420  .overlap import 
-000160a0: 6d61 705f 6f76 6572 6c61 700a 0a20 2020  map_overlap..   
-000160b0: 2020 2020 2072 6574 7572 6e20 6d61 705f       return map_
-000160c0: 6f76 6572 6c61 7028 0a20 2020 2020 2020  overlap(.       
-000160d0: 2020 2020 2066 756e 632c 2073 656c 662c       func, self,
-000160e0: 2064 6570 7468 3d64 6570 7468 2c20 626f   depth=depth, bo
-000160f0: 756e 6461 7279 3d62 6f75 6e64 6172 792c  undary=boundary,
-00016100: 2074 7269 6d3d 7472 696d 2c20 2a2a 6b77   trim=trim, **kw
-00016110: 6172 6773 0a20 2020 2020 2020 2029 0a0a  args.        )..
-00016120: 2020 2020 6465 6620 6375 6d73 756d 2873      def cumsum(s
-00016130: 656c 662c 2061 7869 732c 2064 7479 7065  elf, axis, dtype
-00016140: 3d4e 6f6e 652c 206f 7574 3d4e 6f6e 652c  =None, out=None,
-00016150: 202a 2c20 6d65 7468 6f64 3d22 7365 7175   *, method="sequ
-00016160: 656e 7469 616c 2229 3a0a 2020 2020 2020  ential"):.      
-00016170: 2020 2222 2252 6574 7572 6e20 7468 6520    """Return the 
-00016180: 6375 6d75 6c61 7469 7665 2073 756d 206f  cumulative sum o
-00016190: 6620 7468 6520 656c 656d 656e 7473 2061  f the elements a
-000161a0: 6c6f 6e67 2074 6865 2067 6976 656e 2061  long the given a
-000161b0: 7869 732e 0a0a 2020 2020 2020 2020 5265  xis...        Re
-000161c0: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
-000161d0: 736b 2e61 7272 6179 2e63 756d 7375 6d60  sk.array.cumsum`
-000161e0: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
-000161f0: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
-00016200: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-00016210: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00016220: 2020 2020 6461 736b 2e61 7272 6179 2e63      dask.array.c
-00016230: 756d 7375 6d20 3a20 6571 7569 7661 6c65  umsum : equivale
-00016240: 6e74 2066 756e 6374 696f 6e0a 2020 2020  nt function.    
-00016250: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00016260: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
-00016270: 7265 6475 6374 696f 6e73 2069 6d70 6f72  reductions impor
-00016280: 7420 6375 6d73 756d 0a0a 2020 2020 2020  t cumsum..      
-00016290: 2020 7265 7475 726e 2063 756d 7375 6d28    return cumsum(
-000162a0: 7365 6c66 2c20 6178 6973 2c20 6474 7970  self, axis, dtyp
-000162b0: 652c 206f 7574 3d6f 7574 2c20 6d65 7468  e, out=out, meth
-000162c0: 6f64 3d6d 6574 686f 6429 0a0a 2020 2020  od=method)..    
-000162d0: 6465 6620 6375 6d70 726f 6428 7365 6c66  def cumprod(self
-000162e0: 2c20 6178 6973 2c20 6474 7970 653d 4e6f  , axis, dtype=No
-000162f0: 6e65 2c20 6f75 743d 4e6f 6e65 2c20 2a2c  ne, out=None, *,
-00016300: 206d 6574 686f 643d 2273 6571 7565 6e74   method="sequent
-00016310: 6961 6c22 293a 0a20 2020 2020 2020 2022  ial"):.        "
-00016320: 2222 5265 7475 726e 2074 6865 2063 756d  ""Return the cum
-00016330: 756c 6174 6976 6520 7072 6f64 7563 7420  ulative product 
-00016340: 6f66 2074 6865 2065 6c65 6d65 6e74 7320  of the elements 
-00016350: 616c 6f6e 6720 7468 6520 6769 7665 6e20  along the given 
-00016360: 6178 6973 2e0a 0a20 2020 2020 2020 2052  axis...        R
-00016370: 6566 6572 2074 6f20 3a66 756e 633a 6064  efer to :func:`d
-00016380: 6173 6b2e 6172 7261 792e 6375 6d70 726f  ask.array.cumpro
-00016390: 6460 2066 6f72 2066 756c 6c20 646f 6375  d` for full docu
-000163a0: 6d65 6e74 6174 696f 6e2e 0a0a 2020 2020  mentation...    
-000163b0: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-000163c0: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-000163d0: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-000163e0: 2e63 756d 7072 6f64 203a 2065 7175 6976  .cumprod : equiv
-000163f0: 616c 656e 7420 6675 6e63 7469 6f6e 0a20  alent function. 
-00016400: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00016410: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
-00016420: 6179 2e72 6564 7563 7469 6f6e 7320 696d  ay.reductions im
-00016430: 706f 7274 2063 756d 7072 6f64 0a0a 2020  port cumprod..  
-00016440: 2020 2020 2020 7265 7475 726e 2063 756d        return cum
-00016450: 7072 6f64 2873 656c 662c 2061 7869 732c  prod(self, axis,
-00016460: 2064 7479 7065 2c20 6f75 743d 6f75 742c   dtype, out=out,
-00016470: 206d 6574 686f 643d 6d65 7468 6f64 290a   method=method).
-00016480: 0a20 2020 2064 6566 2073 7175 6565 7a65  .    def squeeze
-00016490: 2873 656c 662c 2061 7869 733d 4e6f 6e65  (self, axis=None
-000164a0: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
-000164b0: 6d6f 7665 2061 7865 7320 6f66 206c 656e  move axes of len
-000164c0: 6774 6820 6f6e 6520 6672 6f6d 2061 7272  gth one from arr
-000164d0: 6179 2e0a 0a20 2020 2020 2020 2052 6566  ay...        Ref
-000164e0: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
-000164f0: 6b2e 6172 7261 792e 7371 7565 657a 6560  k.array.squeeze`
-00016500: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
-00016510: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
-00016520: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
-00016530: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00016540: 2020 2020 6461 736b 2e61 7272 6179 2e73      dask.array.s
-00016550: 7175 6565 7a65 203a 2065 7175 6976 616c  queeze : equival
-00016560: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
-00016570: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00016580: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
-00016590: 2e72 6f75 7469 6e65 7320 696d 706f 7274  .routines import
-000165a0: 2073 7175 6565 7a65 0a0a 2020 2020 2020   squeeze..      
-000165b0: 2020 7265 7475 726e 2073 7175 6565 7a65    return squeeze
-000165c0: 2873 656c 662c 2061 7869 7329 0a0a 2020  (self, axis)..  
-000165d0: 2020 6465 6620 7265 6368 756e 6b28 0a20    def rechunk(. 
-000165e0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-000165f0: 2020 2020 2063 6875 6e6b 733d 2261 7574       chunks="aut
-00016600: 6f22 2c0a 2020 2020 2020 2020 7468 7265  o",.        thre
-00016610: 7368 6f6c 643d 4e6f 6e65 2c0a 2020 2020  shold=None,.    
-00016620: 2020 2020 626c 6f63 6b5f 7369 7a65 5f6c      block_size_l
-00016630: 696d 6974 3d4e 6f6e 652c 0a20 2020 2020  imit=None,.     
-00016640: 2020 2062 616c 616e 6365 3d46 616c 7365     balance=False
-00016650: 2c0a 2020 2020 2020 2020 6d65 7468 6f64  ,.        method
-00016660: 3d4e 6f6e 652c 0a20 2020 2029 3a0a 2020  =None,.    ):.  
-00016670: 2020 2020 2020 2222 2243 6f6e 7665 7274        """Convert
-00016680: 2062 6c6f 636b 7320 696e 2064 6173 6b20   blocks in dask 
-00016690: 6172 7261 7920 7820 666f 7220 6e65 7720  array x for new 
-000166a0: 6368 756e 6b73 2e0a 0a20 2020 2020 2020  chunks...       
-000166b0: 2052 6566 6572 2074 6f20 3a66 756e 633a   Refer to :func:
-000166c0: 6064 6173 6b2e 6172 7261 792e 7265 6368  `dask.array.rech
-000166d0: 756e 6b60 2066 6f72 2066 756c 6c20 646f  unk` for full do
-000166e0: 6375 6d65 6e74 6174 696f 6e2e 0a0a 2020  cumentation...  
-000166f0: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
-00016700: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
-00016710: 2020 2020 2020 2020 6461 736b 2e61 7272          dask.arr
-00016720: 6179 2e72 6563 6875 6e6b 203a 2065 7175  ay.rechunk : equ
-00016730: 6976 616c 656e 7420 6675 6e63 7469 6f6e  ivalent function
-00016740: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00016750: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
-00016760: 7272 6179 2e72 6563 6875 6e6b 2069 6d70  rray.rechunk imp
-00016770: 6f72 7420 7265 6368 756e 6b20 2023 2061  ort rechunk  # a
-00016780: 766f 6964 2063 6972 6375 6c61 7220 696d  void circular im
-00016790: 706f 7274 0a0a 2020 2020 2020 2020 7265  port..        re
-000167a0: 7475 726e 2072 6563 6875 6e6b 2873 656c  turn rechunk(sel
-000167b0: 662c 2063 6875 6e6b 732c 2074 6872 6573  f, chunks, thres
-000167c0: 686f 6c64 2c20 626c 6f63 6b5f 7369 7a65  hold, block_size
-000167d0: 5f6c 696d 6974 2c20 6261 6c61 6e63 652c  _limit, balance,
-000167e0: 206d 6574 686f 6429 0a0a 2020 2020 4070   method)..    @p
-000167f0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
-00016800: 7265 616c 2873 656c 6629 3a0a 2020 2020  real(self):.    
-00016810: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
-00016820: 7261 792e 7566 756e 6320 696d 706f 7274  ray.ufunc import
-00016830: 2072 6561 6c0a 0a20 2020 2020 2020 2072   real..        r
-00016840: 6574 7572 6e20 7265 616c 2873 656c 6629  eturn real(self)
-00016850: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
-00016860: 2020 2020 6465 6620 696d 6167 2873 656c      def imag(sel
-00016870: 6629 3a0a 2020 2020 2020 2020 6672 6f6d  f):.        from
-00016880: 2064 6173 6b2e 6172 7261 792e 7566 756e   dask.array.ufun
-00016890: 6320 696d 706f 7274 2069 6d61 670a 0a20  c import imag.. 
-000168a0: 2020 2020 2020 2072 6574 7572 6e20 696d         return im
-000168b0: 6167 2873 656c 6629 0a0a 2020 2020 6465  ag(self)..    de
-000168c0: 6620 636f 6e6a 2873 656c 6629 3a0a 2020  f conj(self):.  
-000168d0: 2020 2020 2020 2222 2243 6f6d 706c 6578        """Complex
-000168e0: 2d63 6f6e 6a75 6761 7465 2061 6c6c 2065  -conjugate all e
-000168f0: 6c65 6d65 6e74 732e 0a0a 2020 2020 2020  lements...      
-00016900: 2020 5265 6665 7220 746f 203a 6675 6e63    Refer to :func
-00016910: 3a60 6461 736b 2e61 7272 6179 2e63 6f6e  :`dask.array.con
-00016920: 6a60 2066 6f72 2066 756c 6c20 646f 6375  j` for full docu
-00016930: 6d65 6e74 6174 696f 6e2e 0a0a 2020 2020  mentation...    
-00016940: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00016950: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00016960: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-00016970: 2e63 6f6e 6a20 3a20 6571 7569 7661 6c65  .conj : equivale
-00016980: 6e74 2066 756e 6374 696f 6e0a 2020 2020  nt function.    
-00016990: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-000169a0: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
-000169b0: 7566 756e 6320 696d 706f 7274 2063 6f6e  ufunc import con
-000169c0: 6a0a 0a20 2020 2020 2020 2072 6574 7572  j..        retur
-000169d0: 6e20 636f 6e6a 2873 656c 6629 0a0a 2020  n conj(self)..  
-000169e0: 2020 6465 6620 636c 6970 2873 656c 662c    def clip(self,
-000169f0: 206d 696e 3d4e 6f6e 652c 206d 6178 3d4e   min=None, max=N
-00016a00: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
-00016a10: 2252 6574 7572 6e20 616e 2061 7272 6179  "Return an array
-00016a20: 2077 686f 7365 2076 616c 7565 7320 6172   whose values ar
-00016a30: 6520 6c69 6d69 7465 6420 746f 2060 605b  e limited to ``[
-00016a40: 6d69 6e2c 206d 6178 5d60 602e 0a20 2020  min, max]``..   
-00016a50: 2020 2020 204f 6e65 206f 6620 6d61 7820       One of max 
-00016a60: 6f72 206d 696e 206d 7573 7420 6265 2067  or min must be g
-00016a70: 6976 656e 2e0a 0a20 2020 2020 2020 2052  iven...        R
-00016a80: 6566 6572 2074 6f20 3a66 756e 633a 6064  efer to :func:`d
-00016a90: 6173 6b2e 6172 7261 792e 636c 6970 6020  ask.array.clip` 
-00016aa0: 666f 7220 6675 6c6c 2064 6f63 756d 656e  for full documen
-00016ab0: 7461 7469 6f6e 2e0a 0a20 2020 2020 2020  tation...       
-00016ac0: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-00016ad0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-00016ae0: 2020 2064 6173 6b2e 6172 7261 792e 636c     dask.array.cl
-00016af0: 6970 203a 2065 7175 6976 616c 656e 7420  ip : equivalent 
-00016b00: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00016b10: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00016b20: 6d20 6461 736b 2e61 7272 6179 2e75 6675  m dask.array.ufu
-00016b30: 6e63 2069 6d70 6f72 7420 636c 6970 0a0a  nc import clip..
-00016b40: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-00016b50: 6c69 7028 7365 6c66 2c20 6d69 6e2c 206d  lip(self, min, m
-00016b60: 6178 290a 0a20 2020 2064 6566 2076 6965  ax)..    def vie
-00016b70: 7728 7365 6c66 2c20 6474 7970 653d 4e6f  w(self, dtype=No
-00016b80: 6e65 2c20 6f72 6465 723d 2243 2229 3a0a  ne, order="C"):.
-00016b90: 2020 2020 2020 2020 2222 2247 6574 2061          """Get a
-00016ba0: 2076 6965 7720 6f66 2074 6865 2061 7272   view of the arr
-00016bb0: 6179 2061 7320 6120 6e65 7720 6461 7461  ay as a new data
-00016bc0: 2074 7970 650a 0a20 2020 2020 2020 2050   type..        P
-00016bd0: 6172 616d 6574 6572 730a 2020 2020 2020  arameters.      
-00016be0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
-00016bf0: 2020 2020 2064 7479 7065 3a0a 2020 2020       dtype:.    
-00016c00: 2020 2020 2020 2020 5468 6520 6474 7970          The dtyp
-00016c10: 6520 6279 2077 6869 6368 2074 6f20 7669  e by which to vi
-00016c20: 6577 2074 6865 2061 7272 6179 2e0a 2020  ew the array..  
-00016c30: 2020 2020 2020 2020 2020 5468 6520 6465            The de
-00016c40: 6661 756c 742c 204e 6f6e 652c 2072 6573  fault, None, res
-00016c50: 756c 7473 2069 6e20 7468 6520 7669 6577  ults in the view
-00016c60: 2068 6176 696e 6720 7468 6520 7361 6d65   having the same
-00016c70: 2064 6174 612d 7479 7065 0a20 2020 2020   data-type.     
-00016c80: 2020 2020 2020 2061 7320 7468 6520 6f72         as the or
-00016c90: 6967 696e 616c 2061 7272 6179 2e0a 2020  iginal array..  
-00016ca0: 2020 2020 2020 6f72 6465 723a 2073 7472        order: str
-00016cb0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-00016cc0: 2743 2720 6f72 2027 4627 2028 466f 7274  'C' or 'F' (Fort
-00016cd0: 7261 6e29 206f 7264 6572 696e 670a 0a20  ran) ordering.. 
-00016ce0: 2020 2020 2020 2054 6869 7320 7265 696e         This rein
-00016cf0: 7465 7270 7265 7473 2074 6865 2062 7974  terprets the byt
-00016d00: 6573 206f 6620 7468 6520 6172 7261 7920  es of the array 
-00016d10: 756e 6465 7220 6120 6e65 7720 6474 7970  under a new dtyp
-00016d20: 652e 2020 4966 2074 6861 740a 2020 2020  e.  If that.    
-00016d30: 2020 2020 6474 7970 6520 646f 6573 206e      dtype does n
-00016d40: 6f74 2068 6176 6520 7468 6520 7361 6d65  ot have the same
-00016d50: 2073 697a 6520 6173 2074 6865 206f 7269   size as the ori
-00016d60: 6769 6e61 6c20 6172 7261 7920 7468 656e  ginal array then
-00016d70: 2074 6865 2073 6861 7065 0a20 2020 2020   the shape.     
-00016d80: 2020 2077 696c 6c20 6368 616e 6765 2e0a     will change..
-00016d90: 0a20 2020 2020 2020 2042 6577 6172 6520  .        Beware 
-00016da0: 7468 6174 2062 6f74 6820 6e75 6d70 7920  that both numpy 
-00016db0: 616e 6420 6461 736b 2e61 7272 6179 2063  and dask.array c
-00016dc0: 616e 2062 6568 6176 6520 6f64 646c 7920  an behave oddly 
-00016dd0: 7768 656e 2074 616b 696e 670a 2020 2020  when taking.    
-00016de0: 2020 2020 7368 6170 652d 6368 616e 6769      shape-changi
-00016df0: 6e67 2076 6965 7773 206f 6620 6172 7261  ng views of arra
-00016e00: 7973 2075 6e64 6572 2046 6f72 7472 616e  ys under Fortran
-00016e10: 206f 7264 6572 696e 672e 2020 556e 6465   ordering.  Unde
-00016e20: 7220 736f 6d65 0a20 2020 2020 2020 2076  r some.        v
-00016e30: 6572 7369 6f6e 7320 6f66 204e 756d 5079  ersions of NumPy
-00016e40: 2074 6869 7320 6675 6e63 7469 6f6e 2077   this function w
-00016e50: 696c 6c20 6661 696c 2077 6865 6e20 7461  ill fail when ta
-00016e60: 6b69 6e67 2073 6861 7065 2d63 6861 6e67  king shape-chang
-00016e70: 696e 670a 2020 2020 2020 2020 7669 6577  ing.        view
-00016e80: 7320 6f66 2046 6f72 7472 616e 206f 7264  s of Fortran ord
-00016e90: 6572 6564 2061 7272 6179 7320 6966 2074  ered arrays if t
-00016ea0: 6865 2066 6972 7374 2064 696d 656e 7369  he first dimensi
-00016eb0: 6f6e 2068 6173 2063 6875 6e6b 7320 6f66  on has chunks of
-00016ec0: 0a20 2020 2020 2020 2073 697a 6520 6f6e  .        size on
-00016ed0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00016ee0: 2020 2020 2020 2069 6620 6474 7970 6520         if dtype 
-00016ef0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00016f00: 2020 2020 2064 7479 7065 203d 2073 656c       dtype = sel
-00016f10: 662e 6474 7970 650a 2020 2020 2020 2020  f.dtype.        
-00016f20: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00016f30: 2020 6474 7970 6520 3d20 6e70 2e64 7479    dtype = np.dty
-00016f40: 7065 2864 7479 7065 290a 2020 2020 2020  pe(dtype).      
-00016f50: 2020 6d75 6c74 203d 2073 656c 662e 6474    mult = self.dt
-00016f60: 7970 652e 6974 656d 7369 7a65 202f 2064  ype.itemsize / d
-00016f70: 7479 7065 2e69 7465 6d73 697a 650a 0a20  type.itemsize.. 
-00016f80: 2020 2020 2020 2069 6620 6f72 6465 7220         if order 
-00016f90: 3d3d 2022 4322 3a0a 2020 2020 2020 2020  == "C":.        
-00016fa0: 2020 2020 6368 756e 6b73 203d 2073 656c      chunks = sel
-00016fb0: 662e 6368 756e 6b73 5b3a 2d31 5d20 2b20  f.chunks[:-1] + 
-00016fc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00016fd0: 2020 7475 706c 6528 656e 7375 7265 5f69    tuple(ensure_i
-00016fe0: 6e74 2863 202a 206d 756c 7429 2066 6f72  nt(c * mult) for
-00016ff0: 2063 2069 6e20 7365 6c66 2e63 6875 6e6b   c in self.chunk
-00017000: 735b 2d31 5d29 2c0a 2020 2020 2020 2020  s[-1]),.        
-00017010: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-00017020: 6966 206f 7264 6572 203d 3d20 2246 223a  if order == "F":
-00017030: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
-00017040: 6e6b 7320 3d20 280a 2020 2020 2020 2020  nks = (.        
-00017050: 2020 2020 2020 2020 7475 706c 6528 656e          tuple(en
-00017060: 7375 7265 5f69 6e74 2863 202a 206d 756c  sure_int(c * mul
-00017070: 7429 2066 6f72 2063 2069 6e20 7365 6c66  t) for c in self
-00017080: 2e63 6875 6e6b 735b 305d 292c 0a20 2020  .chunks[0]),.   
-00017090: 2020 2020 2020 2020 2029 202b 2073 656c           ) + sel
-000170a0: 662e 6368 756e 6b73 5b31 3a5d 0a20 2020  f.chunks[1:].   
-000170b0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000170c0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000170d0: 7565 4572 726f 7228 224f 7264 6572 206d  ueError("Order m
-000170e0: 7573 7420 6265 206f 6e65 206f 6620 2743  ust be one of 'C
-000170f0: 2720 6f72 2027 4627 2229 0a0a 2020 2020  ' or 'F'")..    
-00017100: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-00017110: 6d61 705f 626c 6f63 6b73 280a 2020 2020  map_blocks(.    
-00017120: 2020 2020 2020 2020 6368 756e 6b2e 7669          chunk.vi
-00017130: 6577 2c20 6474 7970 652c 206f 7264 6572  ew, dtype, order
-00017140: 3d6f 7264 6572 2c20 6474 7970 653d 6474  =order, dtype=dt
-00017150: 7970 652c 2063 6875 6e6b 733d 6368 756e  ype, chunks=chun
-00017160: 6b73 0a20 2020 2020 2020 2029 0a0a 2020  ks.        )..  
-00017170: 2020 6465 6620 7377 6170 6178 6573 2873    def swapaxes(s
-00017180: 656c 662c 2061 7869 7331 2c20 6178 6973  elf, axis1, axis
-00017190: 3229 3a0a 2020 2020 2020 2020 2222 2252  2):.        """R
-000171a0: 6574 7572 6e20 6120 7669 6577 206f 6620  eturn a view of 
-000171b0: 7468 6520 6172 7261 7920 7769 7468 2060  the array with `
-000171c0: 6061 7869 7331 6060 2061 6e64 2060 6061  `axis1`` and ``a
-000171d0: 7869 7332 6060 2069 6e74 6572 6368 616e  xis2`` interchan
-000171e0: 6765 642e 0a0a 2020 2020 2020 2020 5265  ged...        Re
-000171f0: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
-00017200: 736b 2e61 7272 6179 2e73 7761 7061 7865  sk.array.swapaxe
-00017210: 7360 2066 6f72 2066 756c 6c20 646f 6375  s` for full docu
-00017220: 6d65 6e74 6174 696f 6e2e 0a0a 2020 2020  mentation...    
-00017230: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00017240: 2020 2020 202d 2d2d 2d2d 2d2d 2d0a 2020       --------.  
-00017250: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
-00017260: 2e73 7761 7061 7865 7320 3a20 6571 7569  .swapaxes : equi
-00017270: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
-00017280: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00017290: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
-000172a0: 7261 792e 726f 7574 696e 6573 2069 6d70  ray.routines imp
-000172b0: 6f72 7420 7377 6170 6178 6573 0a0a 2020  ort swapaxes..  
-000172c0: 2020 2020 2020 7265 7475 726e 2073 7761        return swa
-000172d0: 7061 7865 7328 7365 6c66 2c20 6178 6973  paxes(self, axis
-000172e0: 312c 2061 7869 7332 290a 0a20 2020 2064  1, axis2)..    d
-000172f0: 6566 2072 6f75 6e64 2873 656c 662c 2064  ef round(self, d
-00017300: 6563 696d 616c 733d 3029 3a0a 2020 2020  ecimals=0):.    
-00017310: 2020 2020 2222 2252 6574 7572 6e20 6172      """Return ar
-00017320: 7261 7920 7769 7468 2065 6163 6820 656c  ray with each el
-00017330: 656d 656e 7420 726f 756e 6465 6420 746f  ement rounded to
-00017340: 2074 6865 2067 6976 656e 206e 756d 6265   the given numbe
-00017350: 7220 6f66 2064 6563 696d 616c 732e 0a0a  r of decimals...
-00017360: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
-00017370: 203a 6675 6e63 3a60 6461 736b 2e61 7272   :func:`dask.arr
-00017380: 6179 2e72 6f75 6e64 6020 666f 7220 6675  ay.round` for fu
-00017390: 6c6c 2064 6f63 756d 656e 7461 7469 6f6e  ll documentation
-000173a0: 2e0a 0a20 2020 2020 2020 2053 6565 2041  ...        See A
-000173b0: 6c73 6f0a 2020 2020 2020 2020 2d2d 2d2d  lso.        ----
-000173c0: 2d2d 2d2d 0a20 2020 2020 2020 2064 6173  ----.        das
-000173d0: 6b2e 6172 7261 792e 726f 756e 6420 3a20  k.array.round : 
-000173e0: 6571 7569 7661 6c65 6e74 2066 756e 6374  equivalent funct
-000173f0: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
-00017400: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
-00017410: 6b2e 6172 7261 792e 726f 7574 696e 6573  k.array.routines
-00017420: 2069 6d70 6f72 7420 726f 756e 640a 0a20   import round.. 
-00017430: 2020 2020 2020 2072 6574 7572 6e20 726f         return ro
-00017440: 756e 6428 7365 6c66 2c20 6465 6369 6d61  und(self, decima
-00017450: 6c73 3d64 6563 696d 616c 7329 0a0a 2020  ls=decimals)..  
-00017460: 2020 6465 6620 636f 7079 2873 656c 6629    def copy(self)
-00017470: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
-00017480: 2020 2020 2020 436f 7079 2061 7272 6179        Copy array
-00017490: 2e20 2054 6869 7320 6973 2061 206e 6f2d  .  This is a no-
-000174a0: 6f70 2066 6f72 2064 6173 6b2e 6172 7261  op for dask.arra
-000174b0: 7973 2c20 7768 6963 6820 6172 6520 696d  ys, which are im
-000174c0: 6d75 7461 626c 650a 2020 2020 2020 2020  mutable.        
-000174d0: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
-000174e0: 726e 2041 7272 6179 2873 656c 662e 6461  rn Array(self.da
-000174f0: 736b 2c20 7365 6c66 2e6e 616d 652c 2073  sk, self.name, s
-00017500: 656c 662e 6368 756e 6b73 2c20 6d65 7461  elf.chunks, meta
-00017510: 3d73 656c 6629 0a0a 2020 2020 6465 6620  =self)..    def 
-00017520: 5f5f 6465 6570 636f 7079 5f5f 2873 656c  __deepcopy__(sel
-00017530: 662c 206d 656d 6f29 3a0a 2020 2020 2020  f, memo):.      
-00017540: 2020 6320 3d20 7365 6c66 2e63 6f70 7928    c = self.copy(
-00017550: 290a 2020 2020 2020 2020 6d65 6d6f 5b69  ).        memo[i
-00017560: 6428 7365 6c66 295d 203d 2063 0a20 2020  d(self)] = c.   
-00017570: 2020 2020 2072 6574 7572 6e20 630a 0a20       return c.. 
-00017580: 2020 2064 6566 2074 6f5f 6465 6c61 7965     def to_delaye
-00017590: 6428 7365 6c66 2c20 6f70 7469 6d69 7a65  d(self, optimize
-000175a0: 5f67 7261 7068 3d54 7275 6529 3a0a 2020  _graph=True):.  
-000175b0: 2020 2020 2020 2222 2243 6f6e 7665 7274        """Convert
-000175c0: 2069 6e74 6f20 616e 2061 7272 6179 206f   into an array o
-000175d0: 6620 3a63 6c61 7373 3a60 6461 736b 2e64  f :class:`dask.d
-000175e0: 656c 6179 6564 2e44 656c 6179 6564 6020  elayed.Delayed` 
-000175f0: 6f62 6a65 6374 732c 206f 6e65 2070 6572  objects, one per
-00017600: 2063 6875 6e6b 2e0a 0a20 2020 2020 2020   chunk...       
-00017610: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00017620: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-00017630: 2020 2020 2020 206f 7074 696d 697a 655f         optimize_
-00017640: 6772 6170 6820 3a20 626f 6f6c 2c20 6f70  graph : bool, op
-00017650: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
-00017660: 2020 2049 6620 5472 7565 205b 6465 6661     If True [defa
-00017670: 756c 745d 2c20 7468 6520 6772 6170 6820  ult], the graph 
-00017680: 6973 206f 7074 696d 697a 6564 2062 6566  is optimized bef
-00017690: 6f72 6520 636f 6e76 6572 7469 6e67 2069  ore converting i
-000176a0: 6e74 6f0a 2020 2020 2020 2020 2020 2020  nto.            
-000176b0: 3a63 6c61 7373 3a60 6461 736b 2e64 656c  :class:`dask.del
-000176c0: 6179 6564 2e44 656c 6179 6564 6020 6f62  ayed.Delayed` ob
-000176d0: 6a65 6374 732e 0a0a 2020 2020 2020 2020  jects...        
-000176e0: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
-000176f0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00017700: 2020 6461 736b 2e61 7272 6179 2e66 726f    dask.array.fro
-00017710: 6d5f 6465 6c61 7965 640a 2020 2020 2020  m_delayed.      
-00017720: 2020 2222 220a 2020 2020 2020 2020 6b65    """.        ke
-00017730: 7973 203d 2073 656c 662e 5f5f 6461 736b  ys = self.__dask
-00017740: 5f6b 6579 735f 5f28 290a 2020 2020 2020  _keys__().      
-00017750: 2020 6772 6170 6820 3d20 7365 6c66 2e5f    graph = self._
-00017760: 5f64 6173 6b5f 6772 6170 685f 5f28 290a  _dask_graph__().
-00017770: 2020 2020 2020 2020 6c61 7965 7220 3d20          layer = 
-00017780: 7365 6c66 2e5f 5f64 6173 6b5f 6c61 7965  self.__dask_laye
-00017790: 7273 5f5f 2829 5b30 5d0a 2020 2020 2020  rs__()[0].      
-000177a0: 2020 6966 206f 7074 696d 697a 655f 6772    if optimize_gr
-000177b0: 6170 683a 0a20 2020 2020 2020 2020 2020  aph:.           
-000177c0: 2067 7261 7068 203d 2073 656c 662e 5f5f   graph = self.__
-000177d0: 6461 736b 5f6f 7074 696d 697a 655f 5f28  dask_optimize__(
-000177e0: 6772 6170 682c 206b 6579 7329 2020 2320  graph, keys)  # 
-000177f0: 544f 444f 2c20 646f 6e27 7420 636f 6c6c  TODO, don't coll
-00017800: 6170 6520 6772 6170 680a 2020 2020 2020  ape graph.      
-00017810: 2020 2020 2020 6c61 7965 7220 3d20 2264        layer = "d
-00017820: 656c 6179 6564 2d22 202b 2073 656c 662e  elayed-" + self.
-00017830: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-00017840: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
-00017850: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
-00017860: 6c65 6374 696f 6e73 286c 6179 6572 2c20  lections(layer, 
-00017870: 6772 6170 682c 2064 6570 656e 6465 6e63  graph, dependenc
-00017880: 6965 733d 2829 290a 2020 2020 2020 2020  ies=()).        
-00017890: 4c20 3d20 6e64 6565 706d 6170 2873 656c  L = ndeepmap(sel
-000178a0: 662e 6e64 696d 2c20 6c61 6d62 6461 206b  f.ndim, lambda k
-000178b0: 3a20 4465 6c61 7965 6428 6b2c 2067 7261  : Delayed(k, gra
-000178c0: 7068 2c20 6c61 7965 723d 6c61 7965 7229  ph, layer=layer)
-000178d0: 2c20 6b65 7973 290a 2020 2020 2020 2020  , keys).        
-000178e0: 7265 7475 726e 206e 702e 6172 7261 7928  return np.array(
-000178f0: 4c2c 2064 7479 7065 3d6f 626a 6563 7429  L, dtype=object)
-00017900: 0a0a 2020 2020 6465 6620 7265 7065 6174  ..    def repeat
-00017910: 2873 656c 662c 2072 6570 6561 7473 2c20  (self, repeats, 
-00017920: 6178 6973 3d4e 6f6e 6529 3a0a 2020 2020  axis=None):.    
-00017930: 2020 2020 2222 2252 6570 6561 7420 656c      """Repeat el
-00017940: 656d 656e 7473 206f 6620 616e 2061 7272  ements of an arr
-00017950: 6179 2e0a 0a20 2020 2020 2020 2052 6566  ay...        Ref
-00017960: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
-00017970: 6b2e 6172 7261 792e 7265 7065 6174 6020  k.array.repeat` 
-00017980: 666f 7220 6675 6c6c 2064 6f63 756d 656e  for full documen
-00017990: 7461 7469 6f6e 2e0a 0a20 2020 2020 2020  tation...       
-000179a0: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
-000179b0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
-000179c0: 2020 2064 6173 6b2e 6172 7261 792e 7265     dask.array.re
-000179d0: 7065 6174 203a 2065 7175 6976 616c 656e  peat : equivalen
-000179e0: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
-000179f0: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
-00017a00: 726f 6d20 6461 736b 2e61 7272 6179 2e63  rom dask.array.c
-00017a10: 7265 6174 696f 6e20 696d 706f 7274 2072  reation import r
-00017a20: 6570 6561 740a 0a20 2020 2020 2020 2072  epeat..        r
-00017a30: 6574 7572 6e20 7265 7065 6174 2873 656c  eturn repeat(sel
-00017a40: 662c 2072 6570 6561 7473 2c20 6178 6973  f, repeats, axis
-00017a50: 3d61 7869 7329 0a0a 2020 2020 6465 6620  =axis)..    def 
-00017a60: 6e6f 6e7a 6572 6f28 7365 6c66 293a 0a20  nonzero(self):. 
-00017a70: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
-00017a80: 2074 6865 2069 6e64 6963 6573 206f 6620   the indices of 
-00017a90: 7468 6520 656c 656d 656e 7473 2074 6861  the elements tha
-00017aa0: 7420 6172 6520 6e6f 6e2d 7a65 726f 2e0a  t are non-zero..
-00017ab0: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
-00017ac0: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
-00017ad0: 7261 792e 6e6f 6e7a 6572 6f60 2066 6f72  ray.nonzero` for
-00017ae0: 2066 756c 6c20 646f 6375 6d65 6e74 6174   full documentat
-00017af0: 696f 6e2e 0a0a 2020 2020 2020 2020 5365  ion...        Se
-00017b00: 6520 416c 736f 0a20 2020 2020 2020 202d  e Also.        -
-00017b10: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
-00017b20: 6461 736b 2e61 7272 6179 2e6e 6f6e 7a65  dask.array.nonze
-00017b30: 726f 203a 2065 7175 6976 616c 656e 7420  ro : equivalent 
-00017b40: 6675 6e63 7469 6f6e 0a20 2020 2020 2020  function.       
-00017b50: 2022 2222 0a20 2020 2020 2020 2066 726f   """.        fro
-00017b60: 6d20 6461 736b 2e61 7272 6179 2e72 6f75  m dask.array.rou
-00017b70: 7469 6e65 7320 696d 706f 7274 206e 6f6e  tines import non
-00017b80: 7a65 726f 0a0a 2020 2020 2020 2020 7265  zero..        re
-00017b90: 7475 726e 206e 6f6e 7a65 726f 2873 656c  turn nonzero(sel
-00017ba0: 6629 0a0a 2020 2020 6465 6620 746f 5f7a  f)..    def to_z
-00017bb0: 6172 7228 7365 6c66 2c20 2a61 7267 732c  arr(self, *args,
-00017bc0: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
-00017bd0: 2020 2020 2222 2253 6176 6520 6172 7261      """Save arra
-00017be0: 7920 746f 2074 6865 207a 6172 7220 7374  y to the zarr st
-00017bf0: 6f72 6167 6520 666f 726d 6174 0a0a 2020  orage format..  
-00017c00: 2020 2020 2020 5365 6520 6874 7470 733a        See https:
-00017c10: 2f2f 7a61 7272 2e72 6561 6474 6865 646f  //zarr.readthedo
-00017c20: 6373 2e69 6f20 666f 7220 6465 7461 696c  cs.io for detail
-00017c30: 7320 6162 6f75 7420 7468 6520 666f 726d  s about the form
-00017c40: 6174 2e0a 0a20 2020 2020 2020 2052 6566  at...        Ref
-00017c50: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
-00017c60: 6b2e 6172 7261 792e 746f 5f7a 6172 7260  k.array.to_zarr`
-00017c70: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
-00017c80: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
-00017c90: 2020 5365 6520 616c 736f 0a20 2020 2020    See also.     
-00017ca0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
-00017cb0: 2020 2020 6461 736b 2e61 7272 6179 2e74      dask.array.t
-00017cc0: 6f5f 7a61 7272 203a 2065 7175 6976 616c  o_zarr : equival
-00017cd0: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
-00017ce0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00017cf0: 2072 6574 7572 6e20 746f 5f7a 6172 7228   return to_zarr(
-00017d00: 7365 6c66 2c20 2a61 7267 732c 202a 2a6b  self, *args, **k
-00017d10: 7761 7267 7329 0a0a 2020 2020 6465 6620  wargs)..    def 
-00017d20: 746f 5f74 696c 6564 6228 7365 6c66 2c20  to_tiledb(self, 
-00017d30: 7572 692c 202a 6172 6773 2c20 2a2a 6b77  uri, *args, **kw
-00017d40: 6172 6773 293a 0a20 2020 2020 2020 2022  args):.        "
-00017d50: 2222 5361 7665 2061 7272 6179 2074 6f20  ""Save array to 
-00017d60: 7468 6520 5469 6c65 4442 2073 746f 7261  the TileDB stora
-00017d70: 6765 206d 616e 6167 6572 0a0a 2020 2020  ge manager..    
-00017d80: 2020 2020 5365 6520 6874 7470 733a 2f2f      See https://
-00017d90: 646f 6373 2e74 696c 6564 622e 696f 2066  docs.tiledb.io f
-00017da0: 6f72 2064 6574 6169 6c73 2061 626f 7574  or details about
-00017db0: 2074 6865 2066 6f72 6d61 7420 616e 6420   the format and 
-00017dc0: 656e 6769 6e65 2e0a 0a20 2020 2020 2020  engine...       
-00017dd0: 2053 6565 2066 756e 6374 696f 6e20 3a66   See function :f
-00017de0: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
-00017df0: 746f 5f74 696c 6564 6260 2066 6f72 2061  to_tiledb` for a
-00017e00: 7267 756d 656e 7420 646f 6375 6d65 6e74  rgument document
-00017e10: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
-00017e20: 5365 6520 616c 736f 0a20 2020 2020 2020  See also.       
-00017e30: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
-00017e40: 2020 6461 736b 2e61 7272 6179 2e74 6f5f    dask.array.to_
-00017e50: 7469 6c65 6462 203a 2065 7175 6976 616c  tiledb : equival
-00017e60: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
-00017e70: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00017e80: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
-00017e90: 2e74 696c 6564 625f 696f 2069 6d70 6f72  .tiledb_io impor
-00017ea0: 7420 746f 5f74 696c 6564 620a 0a20 2020  t to_tiledb..   
-00017eb0: 2020 2020 2072 6574 7572 6e20 746f 5f74       return to_t
-00017ec0: 696c 6564 6228 7365 6c66 2c20 7572 692c  iledb(self, uri,
-00017ed0: 202a 6172 6773 2c20 2a2a 6b77 6172 6773   *args, **kwargs
-00017ee0: 290a 0a0a 6465 6620 656e 7375 7265 5f69  )...def ensure_i
-00017ef0: 6e74 2866 293a 0a20 2020 2069 203d 2069  nt(f):.    i = i
-00017f00: 6e74 2866 290a 2020 2020 6966 2069 2021  nt(f).    if i !
-00017f10: 3d20 663a 0a20 2020 2020 2020 2072 6169  = f:.        rai
-00017f20: 7365 2056 616c 7565 4572 726f 7228 2243  se ValueError("C
-00017f30: 6f75 6c64 206e 6f74 2063 6f65 7263 6520  ould not coerce 
-00017f40: 2566 2074 6f20 696e 7465 6765 7222 2025  %f to integer" %
-00017f50: 2066 290a 2020 2020 7265 7475 726e 2069   f).    return i
-00017f60: 0a0a 0a64 6566 206e 6f72 6d61 6c69 7a65  ...def normalize
-00017f70: 5f63 6875 6e6b 7328 6368 756e 6b73 2c20  _chunks(chunks, 
-00017f80: 7368 6170 653d 4e6f 6e65 2c20 6c69 6d69  shape=None, limi
-00017f90: 743d 4e6f 6e65 2c20 6474 7970 653d 4e6f  t=None, dtype=No
-00017fa0: 6e65 2c20 7072 6576 696f 7573 5f63 6875  ne, previous_chu
-00017fb0: 6e6b 733d 4e6f 6e65 293a 0a20 2020 2022  nks=None):.    "
-00017fc0: 2222 4e6f 726d 616c 697a 6520 6368 756e  ""Normalize chun
-00017fd0: 6b73 2074 6f20 7475 706c 6520 6f66 2074  ks to tuple of t
-00017fe0: 7570 6c65 730a 0a20 2020 2054 6869 7320  uples..    This 
-00017ff0: 7461 6b65 7320 696e 2061 2076 6172 6965  takes in a varie
-00018000: 7479 206f 6620 696e 7075 7420 7479 7065  ty of input type
-00018010: 7320 616e 6420 696e 666f 726d 6174 696f  s and informatio
-00018020: 6e20 616e 6420 7072 6f64 7563 6573 2061  n and produces a
-00018030: 2066 756c 6c0a 2020 2020 7475 706c 652d   full.    tuple-
-00018040: 6f66 2d74 7570 6c65 7320 7265 7375 6c74  of-tuples result
-00018050: 2066 6f72 2063 6875 6e6b 732c 2073 7569   for chunks, sui
-00018060: 7461 626c 6520 746f 2062 6520 7061 7373  table to be pass
-00018070: 6564 2074 6f20 4172 7261 7920 6f72 0a20  ed to Array or. 
-00018080: 2020 2072 6563 6875 6e6b 206f 7220 616e     rechunk or an
-00018090: 7920 6f74 6865 7220 6f70 6572 6174 696f  y other operatio
-000180a0: 6e20 7468 6174 2063 7265 6174 6573 2061  n that creates a
-000180b0: 2044 6173 6b20 6172 7261 792e 0a0a 2020   Dask array...  
-000180c0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-000180d0: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-000180e0: 6368 756e 6b73 3a20 7475 706c 652c 2069  chunks: tuple, i
-000180f0: 6e74 2c20 6469 6374 2c20 6f72 2073 7472  nt, dict, or str
-00018100: 696e 670a 2020 2020 2020 2020 5468 6520  ing.        The 
-00018110: 6368 756e 6b73 2074 6f20 6265 206e 6f72  chunks to be nor
-00018120: 6d61 6c69 7a65 642e 2020 5365 6520 6578  malized.  See ex
-00018130: 616d 706c 6573 2062 656c 6f77 2066 6f72  amples below for
-00018140: 206d 6f72 6520 6465 7461 696c 730a 2020   more details.  
-00018150: 2020 7368 6170 653a 2054 7570 6c65 5b69    shape: Tuple[i
-00018160: 6e74 5d0a 2020 2020 2020 2020 5468 6520  nt].        The 
-00018170: 7368 6170 6520 6f66 2074 6865 2061 7272  shape of the arr
-00018180: 6179 0a20 2020 206c 696d 6974 3a20 696e  ay.    limit: in
-00018190: 7420 286f 7074 696f 6e61 6c29 0a20 2020  t (optional).   
-000181a0: 2020 2020 2054 6865 206d 6178 696d 756d       The maximum
-000181b0: 2062 6c6f 636b 2073 697a 6520 746f 2074   block size to t
-000181c0: 6172 6765 7420 696e 2062 7974 6573 2c0a  arget in bytes,.
-000181d0: 2020 2020 2020 2020 6966 2066 7265 6564          if freed
-000181e0: 6f6d 2069 7320 6769 7665 6e20 746f 2063  om is given to c
-000181f0: 686f 6f73 650a 2020 2020 6474 7970 653a  hoose.    dtype:
-00018200: 206e 702e 6474 7970 650a 2020 2020 7072   np.dtype.    pr
-00018210: 6576 696f 7573 5f63 6875 6e6b 733a 2054  evious_chunks: T
-00018220: 7570 6c65 5b54 7570 6c65 5b69 6e74 5d5d  uple[Tuple[int]]
-00018230: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-00018240: 2020 4368 756e 6b73 2066 726f 6d20 6120    Chunks from a 
-00018250: 7072 6576 696f 7573 2061 7272 6179 2074  previous array t
-00018260: 6861 7420 7765 2073 686f 756c 6420 7573  hat we should us
-00018270: 6520 666f 7220 696e 7370 6972 6174 696f  e for inspiratio
-00018280: 6e20 7768 656e 0a20 2020 2020 2020 2072  n when.        r
-00018290: 6563 6875 6e6b 696e 6720 6175 746f 2064  echunking auto d
-000182a0: 696d 656e 7369 6f6e 732e 2020 4966 206e  imensions.  If n
-000182b0: 6f74 2070 726f 7669 6465 6420 6275 7420  ot provided but 
-000182c0: 6175 746f 2d63 6875 6e6b 696e 6720 6578  auto-chunking ex
-000182d0: 6973 7473 0a20 2020 2020 2020 2074 6865  ists.        the
-000182e0: 6e20 6175 746f 2d64 696d 656e 7369 6f6e  n auto-dimension
-000182f0: 7320 7769 6c6c 2070 7265 6665 7220 7371  s will prefer sq
-00018300: 7561 7265 2d6c 696b 6520 6368 756e 6b20  uare-like chunk 
-00018310: 7368 6170 6573 2e0a 0a20 2020 2045 7861  shapes...    Exa
-00018320: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
-00018330: 2d2d 0a20 2020 2053 7065 6369 6679 2075  --.    Specify u
-00018340: 6e69 666f 726d 2063 6875 6e6b 2073 697a  niform chunk siz
-00018350: 6573 0a0a 2020 2020 3e3e 3e20 6672 6f6d  es..    >>> from
-00018360: 2064 6173 6b2e 6172 7261 792e 636f 7265   dask.array.core
-00018370: 2069 6d70 6f72 7420 6e6f 726d 616c 697a   import normaliz
-00018380: 655f 6368 756e 6b73 0a20 2020 203e 3e3e  e_chunks.    >>>
-00018390: 206e 6f72 6d61 6c69 7a65 5f63 6875 6e6b   normalize_chunk
-000183a0: 7328 2832 2c20 3229 2c20 7368 6170 653d  s((2, 2), shape=
-000183b0: 2835 2c20 3629 290a 2020 2020 2828 322c  (5, 6)).    ((2,
-000183c0: 2032 2c20 3129 2c20 2832 2c20 322c 2032   2, 1), (2, 2, 2
-000183d0: 2929 0a0a 2020 2020 416c 736f 2070 6173  ))..    Also pas
-000183e0: 7365 7320 7468 726f 7567 6820 6675 6c6c  ses through full
-000183f0: 7920 6578 706c 6963 6974 2074 7570 6c65  y explicit tuple
-00018400: 2d6f 662d 7475 706c 6573 0a0a 2020 2020  -of-tuples..    
-00018410: 3e3e 3e20 6e6f 726d 616c 697a 655f 6368  >>> normalize_ch
-00018420: 756e 6b73 2828 2832 2c20 322c 2031 292c  unks(((2, 2, 1),
-00018430: 2028 322c 2032 2c20 3229 292c 2073 6861   (2, 2, 2)), sha
-00018440: 7065 3d28 352c 2036 2929 0a20 2020 2028  pe=(5, 6)).    (
-00018450: 2832 2c20 322c 2031 292c 2028 322c 2032  (2, 2, 1), (2, 2
-00018460: 2c20 3229 290a 0a20 2020 2043 6c65 616e  , 2))..    Clean
-00018470: 7320 7570 206c 6973 7473 2074 6f20 7475  s up lists to tu
-00018480: 706c 6573 0a0a 2020 2020 3e3e 3e20 6e6f  ples..    >>> no
-00018490: 726d 616c 697a 655f 6368 756e 6b73 285b  rmalize_chunks([
-000184a0: 5b32 2c20 325d 2c20 5b33 2c20 335d 5d29  [2, 2], [3, 3]])
-000184b0: 0a20 2020 2028 2832 2c20 3229 2c20 2833  .    ((2, 2), (3
-000184c0: 2c20 3329 290a 0a20 2020 2045 7870 616e  , 3))..    Expan
-000184d0: 6473 2069 6e74 6567 6572 2069 6e70 7574  ds integer input
-000184e0: 7320 3130 202d 3e20 2831 302c 2031 3029  s 10 -> (10, 10)
-000184f0: 0a0a 2020 2020 3e3e 3e20 6e6f 726d 616c  ..    >>> normal
-00018500: 697a 655f 6368 756e 6b73 2831 302c 2073  ize_chunks(10, s
-00018510: 6861 7065 3d28 3330 2c20 3529 290a 2020  hape=(30, 5)).  
-00018520: 2020 2828 3130 2c20 3130 2c20 3130 292c    ((10, 10, 10),
-00018530: 2028 352c 2929 0a0a 2020 2020 4578 7061   (5,))..    Expa
-00018540: 6e64 7320 6469 6374 2069 6e70 7574 730a  nds dict inputs.
-00018550: 0a20 2020 203e 3e3e 206e 6f72 6d61 6c69  .    >>> normali
-00018560: 7a65 5f63 6875 6e6b 7328 7b30 3a20 322c  ze_chunks({0: 2,
-00018570: 2031 3a20 337d 2c20 7368 6170 653d 2836   1: 3}, shape=(6
-00018580: 2c20 3629 290a 2020 2020 2828 322c 2032  , 6)).    ((2, 2
-00018590: 2c20 3229 2c20 2833 2c20 3329 290a 0a20  , 2), (3, 3)).. 
-000185a0: 2020 2054 6865 2076 616c 7565 7320 2d31     The values -1
-000185b0: 2061 6e64 204e 6f6e 6520 6765 7420 6d61   and None get ma
-000185c0: 7070 6564 2074 6f20 6675 6c6c 2073 697a  pped to full siz
-000185d0: 650a 0a20 2020 203e 3e3e 206e 6f72 6d61  e..    >>> norma
-000185e0: 6c69 7a65 5f63 6875 6e6b 7328 2835 2c20  lize_chunks((5, 
-000185f0: 2d31 292c 2073 6861 7065 3d28 3130 2c20  -1), shape=(10, 
-00018600: 3130 2929 0a20 2020 2028 2835 2c20 3529  10)).    ((5, 5)
-00018610: 2c20 2831 302c 2929 0a0a 2020 2020 5573  , (10,))..    Us
-00018620: 6520 7468 6520 7661 6c75 6520 2261 7574  e the value "aut
-00018630: 6f22 2074 6f20 6175 746f 6d61 7469 6361  o" to automatica
-00018640: 6c6c 7920 6465 7465 726d 696e 6520 6368  lly determine ch
-00018650: 756e 6b20 7369 7a65 7320 616c 6f6e 6720  unk sizes along 
-00018660: 6365 7274 6169 6e0a 2020 2020 6469 6d65  certain.    dime
-00018670: 6e73 696f 6e73 2e20 2054 6869 7320 7573  nsions.  This us
-00018680: 6573 2074 6865 2060 606c 696d 6974 3d60  es the ``limit=`
-00018690: 6020 616e 6420 6060 6474 7970 653d 6060  ` and ``dtype=``
-000186a0: 206b 6579 776f 7264 7320 746f 0a20 2020   keywords to.   
-000186b0: 2064 6574 6572 6d69 6e65 2068 6f77 206c   determine how l
-000186c0: 6172 6765 2074 6f20 6d61 6b65 2074 6865  arge to make the
-000186d0: 2063 6875 6e6b 732e 2020 5468 6520 7465   chunks.  The te
-000186e0: 726d 2022 6175 746f 2220 6361 6e20 6265  rm "auto" can be
-000186f0: 2075 7365 640a 2020 2020 616e 7977 6865   used.    anywhe
-00018700: 7265 2061 6e20 696e 7465 6765 7220 6361  re an integer ca
-00018710: 6e20 6265 2075 7365 642e 2020 5365 6520  n be used.  See 
-00018720: 6172 7261 7920 6368 756e 6b69 6e67 2064  array chunking d
-00018730: 6f63 756d 656e 7461 7469 6f6e 2066 6f72  ocumentation for
-00018740: 206d 6f72 650a 2020 2020 696e 666f 726d   more.    inform
-00018750: 6174 696f 6e2e 0a0a 2020 2020 3e3e 3e20  ation...    >>> 
-00018760: 6e6f 726d 616c 697a 655f 6368 756e 6b73  normalize_chunks
-00018770: 2828 2261 7574 6f22 2c29 2c20 7368 6170  (("auto",), shap
-00018780: 653d 2832 302c 292c 206c 696d 6974 3d35  e=(20,), limit=5
-00018790: 2c20 6474 7970 653d 2775 696e 7438 2729  , dtype='uint8')
-000187a0: 0a20 2020 2028 2835 2c20 352c 2035 2c20  .    ((5, 5, 5, 
-000187b0: 3529 2c29 0a0a 2020 2020 596f 7520 6361  5),)..    You ca
-000187c0: 6e20 616c 736f 2075 7365 2062 7974 6520  n also use byte 
-000187d0: 7369 7a65 7320 2873 6565 203a 6675 6e63  sizes (see :func
-000187e0: 3a60 6461 736b 2e75 7469 6c73 2e70 6172  :`dask.utils.par
-000187f0: 7365 5f62 7974 6573 6029 2069 6e20 706c  se_bytes`) in pl
-00018800: 6163 6520 6f66 0a20 2020 2022 6175 746f  ace of.    "auto
-00018810: 2220 746f 2061 736b 2066 6f72 2061 2070  " to ask for a p
-00018820: 6172 7469 6375 6c61 7220 7369 7a65 0a0a  articular size..
-00018830: 2020 2020 3e3e 3e20 6e6f 726d 616c 697a      >>> normaliz
-00018840: 655f 6368 756e 6b73 2822 316b 6942 222c  e_chunks("1kiB",
-00018850: 2073 6861 7065 3d28 3230 3030 2c29 2c20   shape=(2000,), 
-00018860: 6474 7970 653d 2766 6c6f 6174 3332 2729  dtype='float32')
-00018870: 0a20 2020 2028 2832 3536 2c20 3235 362c  .    ((256, 256,
-00018880: 2032 3536 2c20 3235 362c 2032 3536 2c20   256, 256, 256, 
-00018890: 3235 362c 2032 3536 2c20 3230 3829 2c29  256, 256, 208),)
-000188a0: 0a0a 2020 2020 5265 7370 6563 7473 206e  ..    Respects n
-000188b0: 756c 6c20 6469 6d65 6e73 696f 6e73 0a0a  ull dimensions..
-000188c0: 2020 2020 3e3e 3e20 6e6f 726d 616c 697a      >>> normaliz
-000188d0: 655f 6368 756e 6b73 2828 292c 2073 6861  e_chunks((), sha
-000188e0: 7065 3d28 302c 2030 2929 0a20 2020 2028  pe=(0, 0)).    (
-000188f0: 2830 2c29 2c20 2830 2c29 290a 2020 2020  (0,), (0,)).    
-00018900: 2222 220a 2020 2020 6966 2064 7479 7065  """.    if dtype
-00018910: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
-00018920: 6e63 6528 6474 7970 652c 206e 702e 6474  nce(dtype, np.dt
-00018930: 7970 6529 3a0a 2020 2020 2020 2020 6474  ype):.        dt
-00018940: 7970 6520 3d20 6e70 2e64 7479 7065 2864  ype = np.dtype(d
-00018950: 7479 7065 290a 2020 2020 6966 2063 6875  type).    if chu
-00018960: 6e6b 7320 6973 204e 6f6e 653a 0a20 2020  nks is None:.   
-00018970: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-00018980: 4572 726f 7228 4348 554e 4b53 5f4e 4f4e  Error(CHUNKS_NON
-00018990: 455f 4552 524f 525f 4d45 5353 4147 4529  E_ERROR_MESSAGE)
-000189a0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-000189b0: 6365 2863 6875 6e6b 732c 206c 6973 7429  ce(chunks, list)
-000189c0: 3a0a 2020 2020 2020 2020 6368 756e 6b73  :.        chunks
-000189d0: 203d 2074 7570 6c65 2863 6875 6e6b 7329   = tuple(chunks)
-000189e0: 0a20 2020 2069 6620 6973 696e 7374 616e  .    if isinstan
-000189f0: 6365 2863 6875 6e6b 732c 2028 4e75 6d62  ce(chunks, (Numb
-00018a00: 6572 2c20 7374 7229 293a 0a20 2020 2020  er, str)):.     
-00018a10: 2020 2063 6875 6e6b 7320 3d20 2863 6875     chunks = (chu
-00018a20: 6e6b 732c 2920 2a20 6c65 6e28 7368 6170  nks,) * len(shap
-00018a30: 6529 0a20 2020 2069 6620 6973 696e 7374  e).    if isinst
-00018a40: 616e 6365 2863 6875 6e6b 732c 2064 6963  ance(chunks, dic
-00018a50: 7429 3a0a 2020 2020 2020 2020 6368 756e  t):.        chun
-00018a60: 6b73 203d 2074 7570 6c65 2863 6875 6e6b  ks = tuple(chunk
-00018a70: 732e 6765 7428 692c 204e 6f6e 6529 2066  s.get(i, None) f
-00018a80: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
-00018a90: 6e28 7368 6170 6529 2929 0a20 2020 2069  n(shape))).    i
-00018aa0: 6620 6973 696e 7374 616e 6365 2863 6875  f isinstance(chu
-00018ab0: 6e6b 732c 206e 702e 6e64 6172 7261 7929  nks, np.ndarray)
-00018ac0: 3a0a 2020 2020 2020 2020 6368 756e 6b73  :.        chunks
-00018ad0: 203d 2063 6875 6e6b 732e 746f 6c69 7374   = chunks.tolist
-00018ae0: 2829 0a20 2020 2069 6620 6e6f 7420 6368  ().    if not ch
-00018af0: 756e 6b73 2061 6e64 2073 6861 7065 2061  unks and shape a
-00018b00: 6e64 2061 6c6c 2873 203d 3d20 3020 666f  nd all(s == 0 fo
-00018b10: 7220 7320 696e 2073 6861 7065 293a 0a20  r s in shape):. 
-00018b20: 2020 2020 2020 2063 6875 6e6b 7320 3d20         chunks = 
-00018b30: 2828 302c 292c 2920 2a20 6c65 6e28 7368  ((0,),) * len(sh
-00018b40: 6170 6529 0a0a 2020 2020 6966 2028 0a20  ape)..    if (. 
-00018b50: 2020 2020 2020 2073 6861 7065 0a20 2020         shape.   
-00018b60: 2020 2020 2061 6e64 206c 656e 2873 6861       and len(sha
-00018b70: 7065 2920 3d3d 2031 0a20 2020 2020 2020  pe) == 1.       
-00018b80: 2061 6e64 206c 656e 2863 6875 6e6b 7329   and len(chunks)
-00018b90: 203e 2031 0a20 2020 2020 2020 2061 6e64   > 1.        and
-00018ba0: 2061 6c6c 2869 7369 6e73 7461 6e63 6528   all(isinstance(
-00018bb0: 632c 2028 4e75 6d62 6572 2c20 7374 7229  c, (Number, str)
-00018bc0: 2920 666f 7220 6320 696e 2063 6875 6e6b  ) for c in chunk
-00018bd0: 7329 0a20 2020 2029 3a0a 2020 2020 2020  s).    ):.      
-00018be0: 2020 6368 756e 6b73 203d 2028 6368 756e    chunks = (chun
-00018bf0: 6b73 2c29 0a0a 2020 2020 6966 2073 6861  ks,)..    if sha
-00018c00: 7065 2061 6e64 206c 656e 2863 6875 6e6b  pe and len(chunk
-00018c10: 7329 2021 3d20 6c65 6e28 7368 6170 6529  s) != len(shape)
-00018c20: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00018c30: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00018c40: 2020 2020 2020 2020 2243 6875 6e6b 7320          "Chunks 
-00018c50: 616e 6420 7368 6170 6520 6d75 7374 2062  and shape must b
-00018c60: 6520 6f66 2074 6865 2073 616d 6520 6c65  e of the same le
-00018c70: 6e67 7468 2f64 696d 656e 7369 6f6e 2e20  ngth/dimension. 
-00018c80: 220a 2020 2020 2020 2020 2020 2020 2247  ".            "G
-00018c90: 6f74 2063 6875 6e6b 733d 2573 2c20 7368  ot chunks=%s, sh
-00018ca0: 6170 653d 2573 2220 2520 2863 6875 6e6b  ape=%s" % (chunk
-00018cb0: 732c 2073 6861 7065 290a 2020 2020 2020  s, shape).      
-00018cc0: 2020 290a 2020 2020 6966 202d 3120 696e    ).    if -1 in
-00018cd0: 2063 6875 6e6b 7320 6f72 204e 6f6e 6520   chunks or None 
-00018ce0: 696e 2063 6875 6e6b 733a 0a20 2020 2020  in chunks:.     
-00018cf0: 2020 2063 6875 6e6b 7320 3d20 7475 706c     chunks = tupl
-00018d00: 6528 7320 6966 2063 203d 3d20 2d31 206f  e(s if c == -1 o
-00018d10: 7220 6320 6973 204e 6f6e 6520 656c 7365  r c is None else
-00018d20: 2063 2066 6f72 2063 2c20 7320 696e 207a   c for c, s in z
-00018d30: 6970 2863 6875 6e6b 732c 2073 6861 7065  ip(chunks, shape
-00018d40: 2929 0a0a 2020 2020 2320 4966 2073 7065  ))..    # If spe
-00018d50: 6369 6679 696e 6720 6368 756e 6b20 7369  cifying chunk si
-00018d60: 7a65 2069 6e20 6279 7465 732c 2075 7365  ze in bytes, use
-00018d70: 2074 6861 7420 7661 6c75 6520 746f 2073   that value to s
-00018d80: 6574 2074 6865 206c 696d 6974 2e0a 2020  et the limit..  
-00018d90: 2020 2320 5665 7269 6679 2074 6865 7265    # Verify there
-00018da0: 2069 7320 6f6e 6c79 206f 6e65 2063 6f6e   is only one con
-00018db0: 7369 7374 656e 7420 7661 6c75 6520 6f66  sistent value of
-00018dc0: 206c 696d 6974 206f 7220 6368 756e 6b2d   limit or chunk-
-00018dd0: 6279 7465 7320 7573 6564 2e0a 2020 2020  bytes used..    
-00018de0: 666f 7220 6320 696e 2063 6875 6e6b 733a  for c in chunks:
-00018df0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-00018e00: 7374 616e 6365 2863 2c20 7374 7229 2061  stance(c, str) a
-00018e10: 6e64 2063 2021 3d20 2261 7574 6f22 3a0a  nd c != "auto":.
-00018e20: 2020 2020 2020 2020 2020 2020 7061 7273              pars
-00018e30: 6564 203d 2070 6172 7365 5f62 7974 6573  ed = parse_bytes
-00018e40: 2863 290a 2020 2020 2020 2020 2020 2020  (c).            
-00018e50: 6966 206c 696d 6974 2069 7320 4e6f 6e65  if limit is None
-00018e60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018e70: 2020 6c69 6d69 7420 3d20 7061 7273 6564    limit = parsed
-00018e80: 0a20 2020 2020 2020 2020 2020 2065 6c69  .            eli
-00018e90: 6620 7061 7273 6564 2021 3d20 6c69 6d69  f parsed != limi
-00018ea0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00018eb0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00018ec0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00018ed0: 2020 2020 2020 2020 2022 4f6e 6c79 206f           "Only o
-00018ee0: 6e65 2063 6f6e 7369 7374 656e 7420 7661  ne consistent va
-00018ef0: 6c75 6520 6f66 206c 696d 6974 206f 7220  lue of limit or 
-00018f00: 6368 756e 6b20 6973 2061 6c6c 6f77 6564  chunk is allowed
-00018f10: 2e22 0a20 2020 2020 2020 2020 2020 2020  .".             
-00018f20: 2020 2020 2020 2022 5573 6564 2025 7320         "Used %s 
-00018f30: 213d 2025 7322 2025 2028 7061 7273 6564  != %s" % (parsed
-00018f40: 2c20 6c69 6d69 7429 0a20 2020 2020 2020  , limit).       
-00018f50: 2020 2020 2020 2020 2029 0a20 2020 2023           ).    #
-00018f60: 2053 7562 7374 6974 7574 6520 6279 7465   Substitute byte
-00018f70: 206c 696d 6974 7320 7769 7468 2027 6175   limits with 'au
-00018f80: 746f 2720 6e6f 7720 7468 6174 206c 696d  to' now that lim
-00018f90: 6974 2069 7320 7365 742e 0a20 2020 2063  it is set..    c
-00018fa0: 6875 6e6b 7320 3d20 7475 706c 6528 2261  hunks = tuple("a
-00018fb0: 7574 6f22 2069 6620 6973 696e 7374 616e  uto" if isinstan
-00018fc0: 6365 2863 2c20 7374 7229 2061 6e64 2063  ce(c, str) and c
-00018fd0: 2021 3d20 2261 7574 6f22 2065 6c73 6520   != "auto" else 
-00018fe0: 6320 666f 7220 6320 696e 2063 6875 6e6b  c for c in chunk
-00018ff0: 7329 0a0a 2020 2020 6966 2061 6e79 2863  s)..    if any(c
-00019000: 203d 3d20 2261 7574 6f22 2066 6f72 2063   == "auto" for c
-00019010: 2069 6e20 6368 756e 6b73 293a 0a20 2020   in chunks):.   
-00019020: 2020 2020 2063 6875 6e6b 7320 3d20 6175       chunks = au
-00019030: 746f 5f63 6875 6e6b 7328 6368 756e 6b73  to_chunks(chunks
-00019040: 2c20 7368 6170 652c 206c 696d 6974 2c20  , shape, limit, 
-00019050: 6474 7970 652c 2070 7265 7669 6f75 735f  dtype, previous_
-00019060: 6368 756e 6b73 290a 0a20 2020 2069 6620  chunks)..    if 
-00019070: 7368 6170 6520 6973 206e 6f74 204e 6f6e  shape is not Non
-00019080: 653a 0a20 2020 2020 2020 2063 6875 6e6b  e:.        chunk
-00019090: 7320 3d20 7475 706c 6528 6320 6966 2063  s = tuple(c if c
-000190a0: 206e 6f74 2069 6e20 7b4e 6f6e 652c 202d   not in {None, -
-000190b0: 317d 2065 6c73 6520 7320 666f 7220 632c  1} else s for c,
-000190c0: 2073 2069 6e20 7a69 7028 6368 756e 6b73   s in zip(chunks
-000190d0: 2c20 7368 6170 6529 290a 0a20 2020 2061  , shape))..    a
-000190e0: 6c6c 696e 7473 203d 204e 6f6e 650a 2020  llints = None.  
-000190f0: 2020 6966 2063 6875 6e6b 7320 616e 6420    if chunks and 
-00019100: 7368 6170 6520 6973 206e 6f74 204e 6f6e  shape is not Non
-00019110: 653a 0a20 2020 2020 2020 2023 2061 6c6c  e:.        # all
-00019120: 696e 7473 3a20 6469 6420 7765 2073 7461  ints: did we sta
-00019130: 7274 2077 6974 6820 6368 756e 6b73 2061  rt with chunks a
-00019140: 7320 6120 7369 6d70 6c65 2074 7570 6c65  s a simple tuple
-00019150: 206f 6620 696e 7473 3f0a 2020 2020 2020   of ints?.      
-00019160: 2020 616c 6c69 6e74 7320 3d20 616c 6c28    allints = all(
-00019170: 6973 696e 7374 616e 6365 2863 2c20 696e  isinstance(c, in
-00019180: 7429 2066 6f72 2063 2069 6e20 6368 756e  t) for c in chun
-00019190: 6b73 290a 2020 2020 2020 2020 6368 756e  ks).        chun
-000191a0: 6b73 203d 2073 756d 280a 2020 2020 2020  ks = sum(.      
-000191b0: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-000191c0: 2020 2020 2020 2020 626c 6f63 6b64 696d          blockdim
-000191d0: 735f 6672 6f6d 5f62 6c6f 636b 7368 6170  s_from_blockshap
-000191e0: 6528 2873 2c29 2c20 2863 2c29 290a 2020  e((s,), (c,)).  
-000191f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00019200: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00019210: 632c 2028 7475 706c 652c 206c 6973 7429  c, (tuple, list)
-00019220: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019230: 2020 656c 7365 2028 632c 290a 2020 2020    else (c,).    
-00019240: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00019250: 732c 2063 2069 6e20 7a69 7028 7368 6170  s, c in zip(shap
-00019260: 652c 2063 6875 6e6b 7329 0a20 2020 2020  e, chunks).     
-00019270: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-00019280: 2020 2020 2020 2829 2c0a 2020 2020 2020        (),.      
-00019290: 2020 290a 2020 2020 666f 7220 6320 696e    ).    for c in
-000192a0: 2063 6875 6e6b 733a 0a20 2020 2020 2020   chunks:.       
-000192b0: 2069 6620 6e6f 7420 633a 0a20 2020 2020   if not c:.     
-000192c0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000192d0: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
-000192e0: 2020 2020 2020 2020 2022 456d 7074 7920           "Empty 
-000192f0: 7475 706c 6573 2061 7265 206e 6f74 2061  tuples are not a
-00019300: 6c6c 6f77 6564 2069 6e20 6368 756e 6b73  llowed in chunks
-00019310: 2e20 4578 7072 6573 7320 220a 2020 2020  . Express ".    
-00019320: 2020 2020 2020 2020 2020 2020 227a 6572              "zer
-00019330: 6f20 6c65 6e67 7468 2064 696d 656e 7369  o length dimensi
-00019340: 6f6e 7320 7769 7468 2030 2873 2920 696e  ons with 0(s) in
-00019350: 2063 6875 6e6b 7322 0a20 2020 2020 2020   chunks".       
-00019360: 2020 2020 2029 0a0a 2020 2020 6966 2073       )..    if s
-00019370: 6861 7065 2069 7320 6e6f 7420 4e6f 6e65  hape is not None
-00019380: 3a0a 2020 2020 2020 2020 6966 206c 656e  :.        if len
-00019390: 2863 6875 6e6b 7329 2021 3d20 6c65 6e28  (chunks) != len(
-000193a0: 7368 6170 6529 3a0a 2020 2020 2020 2020  shape):.        
-000193b0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-000193c0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-000193d0: 2020 2020 2020 2249 6e70 7574 2061 7272        "Input arr
-000193e0: 6179 2068 6173 2025 6420 6469 6d65 6e73  ay has %d dimens
-000193f0: 696f 6e73 2062 7574 2074 6865 2073 7570  ions but the sup
-00019400: 706c 6965 6420 220a 2020 2020 2020 2020  plied ".        
-00019410: 2020 2020 2020 2020 2263 6875 6e6b 7320          "chunks 
-00019420: 6861 7320 6f6e 6c79 2025 6420 6469 6d65  has only %d dime
-00019430: 6e73 696f 6e73 2220 2520 286c 656e 2873  nsions" % (len(s
-00019440: 6861 7065 292c 206c 656e 2863 6875 6e6b  hape), len(chunk
-00019450: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-00019460: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00019470: 2061 6c6c 280a 2020 2020 2020 2020 2020   all(.          
-00019480: 2020 6320 3d3d 2073 206f 7220 286d 6174    c == s or (mat
-00019490: 682e 6973 6e61 6e28 6329 206f 7220 6d61  h.isnan(c) or ma
-000194a0: 7468 2e69 736e 616e 2873 2929 0a20 2020  th.isnan(s)).   
-000194b0: 2020 2020 2020 2020 2066 6f72 2063 2c20           for c, 
-000194c0: 7320 696e 207a 6970 286d 6170 2873 756d  s in zip(map(sum
-000194d0: 2c20 6368 756e 6b73 292c 2073 6861 7065  , chunks), shape
-000194e0: 290a 2020 2020 2020 2020 293a 0a20 2020  ).        ):.   
-000194f0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-00019500: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
-00019510: 2020 2020 2020 2020 2020 2022 4368 756e             "Chun
-00019520: 6b73 2064 6f20 6e6f 7420 6164 6420 7570  ks do not add up
-00019530: 2074 6f20 7368 6170 652e 2022 0a20 2020   to shape. ".   
-00019540: 2020 2020 2020 2020 2020 2020 2022 476f               "Go
-00019550: 7420 6368 756e 6b73 3d25 732c 2073 6861  t chunks=%s, sha
-00019560: 7065 3d25 7322 2025 2028 6368 756e 6b73  pe=%s" % (chunks
-00019570: 2c20 7368 6170 6529 0a20 2020 2020 2020  , shape).       
-00019580: 2020 2020 2029 0a20 2020 2069 6620 616c       ).    if al
-00019590: 6c69 6e74 7320 6f72 2069 7369 6e73 7461  lints or isinsta
-000195a0: 6e63 6528 7375 6d28 7375 6d28 5f29 2066  nce(sum(sum(_) f
-000195b0: 6f72 205f 2069 6e20 6368 756e 6b73 292c  or _ in chunks),
-000195c0: 2069 6e74 293a 0a20 2020 2020 2020 2023   int):.        #
-000195d0: 2046 6173 7470 6174 6820 666f 7220 7768   Fastpath for wh
-000195e0: 656e 2077 6520 616c 7265 6164 7920 6b6e  en we already kn
-000195f0: 6f77 2063 6875 6e6b 7320 636f 6e74 6169  ow chunks contai
-00019600: 6e73 206f 6e6c 7920 696e 7465 6765 7273  ns only integers
-00019610: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019620: 7475 706c 6528 7475 706c 6528 6368 2920  tuple(tuple(ch) 
-00019630: 666f 7220 6368 2069 6e20 6368 756e 6b73  for ch in chunks
-00019640: 290a 2020 2020 7265 7475 726e 2074 7570  ).    return tup
-00019650: 6c65 280a 2020 2020 2020 2020 7475 706c  le(.        tupl
-00019660: 6528 696e 7428 7829 2069 6620 6e6f 7420  e(int(x) if not 
-00019670: 6d61 7468 2e69 736e 616e 2878 2920 656c  math.isnan(x) el
-00019680: 7365 206e 702e 6e61 6e20 666f 7220 7820  se np.nan for x 
-00019690: 696e 2063 2920 666f 7220 6320 696e 2063  in c) for c in c
-000196a0: 6875 6e6b 730a 2020 2020 290a 0a0a 6465  hunks.    )...de
-000196b0: 6620 5f63 6f6d 7075 7465 5f6d 756c 7469  f _compute_multi
-000196c0: 706c 6965 7228 6c69 6d69 743a 2069 6e74  plier(limit: int
-000196d0: 2c20 6474 7970 652c 206c 6172 6765 7374  , dtype, largest
-000196e0: 5f62 6c6f 636b 3a20 696e 742c 2072 6573  _block: int, res
-000196f0: 756c 7429 3a0a 2020 2020 2222 220a 2020  ult):.    """.  
-00019700: 2020 5574 696c 6974 7920 6675 6e63 7469    Utility functi
-00019710: 6f6e 2066 6f72 2061 7574 6f5f 6368 756e  on for auto_chun
-00019720: 6b2c 2074 6f20 6669 6e20 686f 7720 6d75  k, to fin how mu
-00019730: 6368 206c 6172 6765 7220 6f72 2073 6d61  ch larger or sma
-00019740: 6c6c 6572 2074 6865 2069 6465 616c 0a20  ller the ideal. 
-00019750: 2020 2063 6875 6e6b 2073 697a 6520 6973     chunk size is
-00019760: 2072 656c 6174 6976 6520 746f 2077 6861   relative to wha
-00019770: 7420 7765 2068 6176 6520 6e6f 772e 0a20  t we have now.. 
-00019780: 2020 2022 2222 0a20 2020 2072 6574 7572     """.    retur
-00019790: 6e20 280a 2020 2020 2020 2020 6c69 6d69  n (.        limi
-000197a0: 740a 2020 2020 2020 2020 2f20 6474 7970  t.        / dtyp
-000197b0: 652e 6974 656d 7369 7a65 0a20 2020 2020  e.itemsize.     
-000197c0: 2020 202f 206c 6172 6765 7374 5f62 6c6f     / largest_blo
-000197d0: 636b 0a20 2020 2020 2020 202f 206d 6174  ck.        / mat
-000197e0: 682e 7072 6f64 2872 2066 6f72 2072 2069  h.prod(r for r i
-000197f0: 6e20 7265 7375 6c74 2e76 616c 7565 7328  n result.values(
-00019800: 2920 6966 2072 290a 2020 2020 290a 0a0a  ) if r).    )...
-00019810: 6465 6620 6175 746f 5f63 6875 6e6b 7328  def auto_chunks(
-00019820: 6368 756e 6b73 2c20 7368 6170 652c 206c  chunks, shape, l
-00019830: 696d 6974 2c20 6474 7970 652c 2070 7265  imit, dtype, pre
-00019840: 7669 6f75 735f 6368 756e 6b73 3d4e 6f6e  vious_chunks=Non
-00019850: 6529 3a0a 2020 2020 2222 2244 6574 6572  e):.    """Deter
-00019860: 6d69 6e65 2061 7574 6f6d 6174 6963 2063  mine automatic c
-00019870: 6875 6e6b 730a 0a20 2020 2054 6869 7320  hunks..    This 
-00019880: 7461 6b65 7320 696e 2061 2063 6875 6e6b  takes in a chunk
-00019890: 7320 7661 6c75 6520 7468 6174 2063 6f6e  s value that con
-000198a0: 7461 696e 7320 6060 2261 7574 6f22 6060  tains ``"auto"``
-000198b0: 2076 616c 7565 7320 696e 2063 6572 7461   values in certa
-000198c0: 696e 0a20 2020 2064 696d 656e 7369 6f6e  in.    dimension
-000198d0: 7320 616e 6420 7265 706c 6163 6573 2074  s and replaces t
-000198e0: 686f 7365 2076 616c 7565 7320 7769 7468  hose values with
-000198f0: 2063 6f6e 6372 6574 6520 6469 6d65 6e73   concrete dimens
-00019900: 696f 6e20 7369 7a65 7320 7468 6174 2074  ion sizes that t
-00019910: 7279 0a20 2020 2074 6f20 6765 7420 6368  ry.    to get ch
-00019920: 756e 6b73 2074 6f20 6265 206f 6620 6120  unks to be of a 
-00019930: 6365 7274 6169 6e20 7369 7a65 2069 6e20  certain size in 
-00019940: 6279 7465 732c 2070 726f 7669 6465 6420  bytes, provided 
-00019950: 6279 2074 6865 2060 606c 696d 6974 3d60  by the ``limit=`
-00019960: 600a 2020 2020 6b65 7977 6f72 642e 2020  `.    keyword.  
-00019970: 4966 206d 756c 7469 706c 6520 6469 6d65  If multiple dime
-00019980: 6e73 696f 6e73 2061 7265 206d 6172 6b65  nsions are marke
-00019990: 6420 6173 2060 6022 6175 746f 2260 6020  d as ``"auto"`` 
-000199a0: 7468 656e 2074 6865 7920 7769 6c6c 0a20  then they will. 
-000199b0: 2020 2061 6c6c 2072 6573 706f 6e64 2074     all respond t
-000199c0: 6f20 6d65 6574 2074 6865 2064 6573 6972  o meet the desir
-000199d0: 6564 2062 7974 6520 6c69 6d69 742c 2074  ed byte limit, t
-000199e0: 7279 696e 6720 746f 2072 6573 7065 6374  rying to respect
-000199f0: 2074 6865 2061 7370 6563 740a 2020 2020   the aspect.    
-00019a00: 7261 7469 6f20 6f66 2074 6865 6972 2064  ratio of their d
-00019a10: 696d 656e 7369 6f6e 7320 696e 2060 6070  imensions in ``p
-00019a20: 7265 7669 6f75 735f 6368 756e 6b73 3d60  revious_chunks=`
-00019a30: 602c 2069 6620 6769 7665 6e2e 0a0a 2020  `, if given...  
-00019a40: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
-00019a50: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
-00019a60: 6368 756e 6b73 3a20 5475 706c 650a 2020  chunks: Tuple.  
-00019a70: 2020 2020 2020 4120 7475 706c 6520 6f66        A tuple of
-00019a80: 2065 6974 6865 7220 6469 6d65 6e73 696f   either dimensio
-00019a90: 6e73 206f 7220 7475 706c 6573 206f 6620  ns or tuples of 
-00019aa0: 6578 706c 6963 6974 2063 6875 6e6b 2064  explicit chunk d
-00019ab0: 696d 656e 7369 6f6e 730a 2020 2020 2020  imensions.      
-00019ac0: 2020 536f 6d65 2065 6e74 7269 6573 2073    Some entries s
-00019ad0: 686f 756c 6420 6265 2022 6175 746f 220a  hould be "auto".
-00019ae0: 2020 2020 7368 6170 653a 2054 7570 6c65      shape: Tuple
-00019af0: 5b69 6e74 5d0a 2020 2020 6c69 6d69 743a  [int].    limit:
-00019b00: 2069 6e74 2c20 7374 720a 2020 2020 2020   int, str.      
-00019b10: 2020 5468 6520 6d61 7869 6d75 6d20 616c    The maximum al
-00019b20: 6c6f 7761 626c 6520 7369 7a65 206f 6620  lowable size of 
-00019b30: 6120 6368 756e 6b20 696e 2062 7974 6573  a chunk in bytes
-00019b40: 0a20 2020 2070 7265 7669 6f75 735f 6368  .    previous_ch
-00019b50: 756e 6b73 3a20 5475 706c 655b 5475 706c  unks: Tuple[Tupl
-00019b60: 655b 696e 745d 5d0a 0a20 2020 2053 6565  e[int]]..    See
-00019b70: 2061 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d   also.    ------
-00019b80: 2d2d 0a20 2020 206e 6f72 6d61 6c69 7a65  --.    normalize
-00019b90: 5f63 6875 6e6b 733a 2066 6f72 2066 756c  _chunks: for ful
-00019ba0: 6c20 646f 6373 7472 696e 6720 616e 6420  l docstring and 
-00019bb0: 7061 7261 6d65 7465 7273 0a20 2020 2022  parameters.    "
-00019bc0: 2222 0a20 2020 2069 6620 7072 6576 696f  "".    if previo
-00019bd0: 7573 5f63 6875 6e6b 7320 6973 206e 6f74  us_chunks is not
-00019be0: 204e 6f6e 653a 0a20 2020 2020 2020 2070   None:.        p
-00019bf0: 7265 7669 6f75 735f 6368 756e 6b73 203d  revious_chunks =
-00019c00: 2074 7570 6c65 280a 2020 2020 2020 2020   tuple(.        
-00019c10: 2020 2020 6320 6966 2069 7369 6e73 7461      c if isinsta
-00019c20: 6e63 6528 632c 2074 7570 6c65 2920 656c  nce(c, tuple) el
-00019c30: 7365 2028 632c 2920 666f 7220 6320 696e  se (c,) for c in
-00019c40: 2070 7265 7669 6f75 735f 6368 756e 6b73   previous_chunks
-00019c50: 0a20 2020 2020 2020 2029 0a20 2020 2063  .        ).    c
-00019c60: 6875 6e6b 7320 3d20 6c69 7374 2863 6875  hunks = list(chu
-00019c70: 6e6b 7329 0a0a 2020 2020 6175 746f 7320  nks)..    autos 
-00019c80: 3d20 7b69 2066 6f72 2069 2c20 6320 696e  = {i for i, c in
-00019c90: 2065 6e75 6d65 7261 7465 2863 6875 6e6b   enumerate(chunk
-00019ca0: 7329 2069 6620 6320 3d3d 2022 6175 746f  s) if c == "auto
-00019cb0: 227d 0a20 2020 2069 6620 6e6f 7420 6175  "}.    if not au
-00019cc0: 746f 733a 0a20 2020 2020 2020 2072 6574  tos:.        ret
-00019cd0: 7572 6e20 7475 706c 6528 6368 756e 6b73  urn tuple(chunks
-00019ce0: 290a 0a20 2020 2069 6620 6c69 6d69 7420  )..    if limit 
-00019cf0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00019d00: 206c 696d 6974 203d 2063 6f6e 6669 672e   limit = config.
-00019d10: 6765 7428 2261 7272 6179 2e63 6875 6e6b  get("array.chunk
-00019d20: 2d73 697a 6522 290a 2020 2020 6966 2069  -size").    if i
-00019d30: 7369 6e73 7461 6e63 6528 6c69 6d69 742c  sinstance(limit,
-00019d40: 2073 7472 293a 0a20 2020 2020 2020 206c   str):.        l
-00019d50: 696d 6974 203d 2070 6172 7365 5f62 7974  imit = parse_byt
-00019d60: 6573 286c 696d 6974 290a 0a20 2020 2069  es(limit)..    i
-00019d70: 6620 6474 7970 6520 6973 204e 6f6e 653a  f dtype is None:
-00019d80: 0a20 2020 2020 2020 2072 6169 7365 2054  .        raise T
-00019d90: 7970 6545 7272 6f72 2822 6474 7970 6520  ypeError("dtype 
-00019da0: 6d75 7374 2062 6520 6b6e 6f77 6e20 666f  must be known fo
-00019db0: 7220 6175 746f 2d63 6875 6e6b 696e 6722  r auto-chunking"
-00019dc0: 290a 0a20 2020 2069 6620 6474 7970 652e  )..    if dtype.
-00019dd0: 6861 736f 626a 6563 743a 0a20 2020 2020  hasobject:.     
-00019de0: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-00019df0: 656d 656e 7465 6445 7272 6f72 280a 2020  ementedError(.  
-00019e00: 2020 2020 2020 2020 2020 2243 616e 206e            "Can n
-00019e10: 6f74 2075 7365 2061 7574 6f20 7265 6368  ot use auto rech
-00019e20: 756e 6b69 6e67 2077 6974 6820 6f62 6a65  unking with obje
-00019e30: 6374 2064 7479 7065 2e20 220a 2020 2020  ct dtype. ".    
-00019e40: 2020 2020 2020 2020 2257 6520 6172 6520          "We are 
-00019e50: 756e 6162 6c65 2074 6f20 6573 7469 6d61  unable to estima
-00019e60: 7465 2074 6865 2073 697a 6520 696e 2062  te the size in b
-00019e70: 7974 6573 206f 6620 6f62 6a65 6374 2064  ytes of object d
-00019e80: 6174 6122 0a20 2020 2020 2020 2029 0a0a  ata".        )..
-00019e90: 2020 2020 666f 7220 7820 696e 2074 7570      for x in tup
-00019ea0: 6c65 2863 6875 6e6b 7329 202b 2074 7570  le(chunks) + tup
-00019eb0: 6c65 2873 6861 7065 293a 0a20 2020 2020  le(shape):.     
-00019ec0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00019ed0: 2020 2020 6973 696e 7374 616e 6365 2878      isinstance(x
-00019ee0: 2c20 4e75 6d62 6572 290a 2020 2020 2020  , Number).      
-00019ef0: 2020 2020 2020 616e 6420 6e70 2e69 736e        and np.isn
-00019f00: 616e 2878 290a 2020 2020 2020 2020 2020  an(x).          
-00019f10: 2020 6f72 2069 7369 6e73 7461 6e63 6528    or isinstance(
-00019f20: 782c 2074 7570 6c65 290a 2020 2020 2020  x, tuple).      
-00019f30: 2020 2020 2020 616e 6420 6e70 2e69 736e        and np.isn
-00019f40: 616e 2878 292e 616e 7928 290a 2020 2020  an(x).any().    
-00019f50: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00019f60: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00019f70: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00019f80: 2020 2020 2022 4361 6e20 6e6f 7420 7065       "Can not pe
-00019f90: 7266 6f72 6d20 6175 746f 6d61 7469 6320  rform automatic 
-00019fa0: 7265 6368 756e 6b69 6e67 2077 6974 6820  rechunking with 
-00019fb0: 756e 6b6e 6f77 6e20 220a 2020 2020 2020  unknown ".      
-00019fc0: 2020 2020 2020 2020 2020 2228 6e61 6e29            "(nan)
-00019fd0: 2063 6875 6e6b 2073 697a 6573 2e25 7322   chunk sizes.%s"
-00019fe0: 2025 2075 6e6b 6e6f 776e 5f63 6875 6e6b   % unknown_chunk
-00019ff0: 5f6d 6573 7361 6765 0a20 2020 2020 2020  _message.       
-0001a000: 2020 2020 2029 0a0a 2020 2020 6c69 6d69       )..    limi
-0001a010: 7420 3d20 6d61 7828 312c 206c 696d 6974  t = max(1, limit
-0001a020: 290a 0a20 2020 206c 6172 6765 7374 5f62  )..    largest_b
-0001a030: 6c6f 636b 203d 206d 6174 682e 7072 6f64  lock = math.prod
-0001a040: 280a 2020 2020 2020 2020 6373 2069 6620  (.        cs if 
-0001a050: 6973 696e 7374 616e 6365 2863 732c 204e  isinstance(cs, N
-0001a060: 756d 6265 7229 2065 6c73 6520 6d61 7828  umber) else max(
-0001a070: 6373 2920 666f 7220 6373 2069 6e20 6368  cs) for cs in ch
-0001a080: 756e 6b73 2069 6620 6373 2021 3d20 2261  unks if cs != "a
-0001a090: 7574 6f22 0a20 2020 2029 0a0a 2020 2020  uto".    )..    
-0001a0a0: 6966 2070 7265 7669 6f75 735f 6368 756e  if previous_chun
-0001a0b0: 6b73 3a0a 2020 2020 2020 2020 2320 4261  ks:.        # Ba
-0001a0c0: 7365 2069 6465 616c 2072 6174 696f 206f  se ideal ratio o
-0001a0d0: 6e20 7468 6520 6d65 6469 616e 2063 6875  n the median chu
-0001a0e0: 6e6b 2073 697a 6520 6f66 2074 6865 2070  nk size of the p
-0001a0f0: 7265 7669 6f75 7320 6368 756e 6b73 0a20  revious chunks. 
-0001a100: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
-0001a110: 7b61 3a20 6e70 2e6d 6564 6961 6e28 7072  {a: np.median(pr
-0001a120: 6576 696f 7573 5f63 6875 6e6b 735b 615d  evious_chunks[a]
-0001a130: 2920 666f 7220 6120 696e 2061 7574 6f73  ) for a in autos
-0001a140: 7d0a 0a20 2020 2020 2020 2069 6465 616c  }..        ideal
-0001a150: 5f73 6861 7065 203d 205b 5d0a 2020 2020  _shape = [].    
-0001a160: 2020 2020 666f 7220 692c 2073 2069 6e20      for i, s in 
-0001a170: 656e 756d 6572 6174 6528 7368 6170 6529  enumerate(shape)
-0001a180: 3a0a 2020 2020 2020 2020 2020 2020 6368  :.            ch
-0001a190: 756e 6b5f 6672 6571 7565 6e63 6965 7320  unk_frequencies 
-0001a1a0: 3d20 6672 6571 7565 6e63 6965 7328 7072  = frequencies(pr
-0001a1b0: 6576 696f 7573 5f63 6875 6e6b 735b 695d  evious_chunks[i]
-0001a1c0: 290a 2020 2020 2020 2020 2020 2020 6d6f  ).            mo
-0001a1d0: 6465 2c20 636f 756e 7420 3d20 6d61 7828  de, count = max(
-0001a1e0: 6368 756e 6b5f 6672 6571 7565 6e63 6965  chunk_frequencie
-0001a1f0: 732e 6974 656d 7328 292c 206b 6579 3d6c  s.items(), key=l
-0001a200: 616d 6264 6120 6b76 3a20 6b76 5b31 5d29  ambda kv: kv[1])
-0001a210: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001a220: 6d6f 6465 203e 2031 2061 6e64 2063 6f75  mode > 1 and cou
-0001a230: 6e74 203e 3d20 6c65 6e28 7072 6576 696f  nt >= len(previo
-0001a240: 7573 5f63 6875 6e6b 735b 695d 2920 2f20  us_chunks[i]) / 
-0001a250: 323a 0a20 2020 2020 2020 2020 2020 2020  2:.             
-0001a260: 2020 2069 6465 616c 5f73 6861 7065 2e61     ideal_shape.a
-0001a270: 7070 656e 6428 6d6f 6465 290a 2020 2020  ppend(mode).    
-0001a280: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001a290: 2020 2020 2020 2020 2020 2020 2020 6964                id
-0001a2a0: 6561 6c5f 7368 6170 652e 6170 7065 6e64  eal_shape.append
-0001a2b0: 2873 290a 0a20 2020 2020 2020 2023 2048  (s)..        # H
-0001a2c0: 6f77 206d 7563 6820 6c61 7267 6572 206f  ow much larger o
-0001a2d0: 7220 736d 616c 6c65 7220 7468 6520 6964  r smaller the id
-0001a2e0: 6561 6c20 6368 756e 6b20 7369 7a65 2069  eal chunk size i
-0001a2f0: 7320 7265 6c61 7469 7665 2074 6f20 7768  s relative to wh
-0001a300: 6174 2077 6520 6861 7665 206e 6f77 0a20  at we have now. 
-0001a310: 2020 2020 2020 206d 756c 7469 706c 6965         multiplie
-0001a320: 7220 3d20 5f63 6f6d 7075 7465 5f6d 756c  r = _compute_mul
-0001a330: 7469 706c 6965 7228 6c69 6d69 742c 2064  tiplier(limit, d
-0001a340: 7479 7065 2c20 6c61 7267 6573 745f 626c  type, largest_bl
-0001a350: 6f63 6b2c 2072 6573 756c 7429 0a0a 2020  ock, result)..  
-0001a360: 2020 2020 2020 6c61 7374 5f6d 756c 7469        last_multi
-0001a370: 706c 6965 7220 3d20 300a 2020 2020 2020  plier = 0.      
-0001a380: 2020 6c61 7374 5f61 7574 6f73 203d 2073    last_autos = s
-0001a390: 6574 2829 0a20 2020 2020 2020 2077 6869  et().        whi
-0001a3a0: 6c65 2028 0a20 2020 2020 2020 2020 2020  le (.           
-0001a3b0: 206d 756c 7469 706c 6965 7220 213d 206c   multiplier != l
-0001a3c0: 6173 745f 6d75 6c74 6970 6c69 6572 206f  ast_multiplier o
-0001a3d0: 7220 6175 746f 7320 213d 206c 6173 745f  r autos != last_
-0001a3e0: 6175 746f 730a 2020 2020 2020 2020 293a  autos.        ):
-0001a3f0: 2020 2320 7768 696c 6520 7468 696e 6773    # while things
-0001a400: 2063 6861 6e67 650a 2020 2020 2020 2020   change.        
-0001a410: 2020 2020 6c61 7374 5f6d 756c 7469 706c      last_multipl
-0001a420: 6965 7220 3d20 6d75 6c74 6970 6c69 6572  ier = multiplier
-0001a430: 2020 2320 7265 636f 7264 2070 7265 7669    # record previ
-0001a440: 6f75 7320 7661 6c75 6573 0a20 2020 2020  ous values.     
-0001a450: 2020 2020 2020 206c 6173 745f 6175 746f         last_auto
-0001a460: 7320 3d20 7365 7428 6175 746f 7329 2020  s = set(autos)  
-0001a470: 2320 7265 636f 7264 2070 7265 7669 6f75  # record previou
-0001a480: 7320 7661 6c75 6573 0a0a 2020 2020 2020  s values..      
-0001a490: 2020 2020 2020 2320 4578 7061 6e64 206f        # Expand o
-0001a4a0: 7220 636f 6e74 7261 6374 2065 6163 6820  r contract each 
-0001a4b0: 6f66 2074 6865 2064 696d 656e 7369 6f6e  of the dimension
-0001a4c0: 7320 6170 7072 6f70 7269 6174 656c 790a  s appropriately.
-0001a4d0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-0001a4e0: 6120 696e 2073 6f72 7465 6428 6175 746f  a in sorted(auto
-0001a4f0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
-0001a500: 2020 2020 6966 2069 6465 616c 5f73 6861      if ideal_sha
-0001a510: 7065 5b61 5d20 3d3d 2030 3a0a 2020 2020  pe[a] == 0:.    
+00007800: 2020 6361 6368 6564 5f63 756d 7375 6d28    cached_cumsum(
+00007810: 6172 672e 6368 756e 6b73 5b6a 5d2c 2069  arg.chunks[j], i
+00007820: 6e69 7469 616c 5f7a 6572 6f3d 5472 7565  nitial_zero=True
+00007830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007840: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00007850: 2069 6e64 2069 6e20 6f75 745f 696e 640a   ind in out_ind.
+00007860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007870: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00007880: 205b 302c 2061 7267 2e73 6861 7065 5b6a   [0, arg.shape[j
+00007890: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
+000078a0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000078b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000078c0: 2020 2020 2066 6f72 206a 2c20 696e 6420       for j, ind 
+000078d0: 696e 2065 6e75 6d65 7261 7465 2869 6e5f  in enumerate(in_
+000078e0: 696e 6429 0a20 2020 2020 2020 2020 2020  ind).           
+000078f0: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+00007900: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00007910: 756d 5f63 6875 6e6b 735b 695d 203d 2074  um_chunks[i] = t
+00007920: 7570 6c65 286c 656e 2873 2920 2d20 3120  uple(len(s) - 1 
+00007930: 666f 7220 7320 696e 2073 7461 7274 735b  for s in starts[
+00007940: 695d 290a 2020 2020 2020 2020 2020 2020  i]).            
+00007950: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00007960: 2020 2020 2020 2020 2020 2020 2020 7374                st
+00007970: 6172 7473 5b69 5d20 3d20 5b0a 2020 2020  arts[i] = [.    
+00007980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007990: 2020 2020 6361 6368 6564 5f63 756d 7375      cached_cumsu
+000079a0: 6d28 632c 2069 6e69 7469 616c 5f7a 6572  m(c, initial_zer
+000079b0: 6f3d 5472 7565 2920 666f 7220 6320 696e  o=True) for c in
+000079c0: 2061 7267 2e63 6875 6e6b 730a 2020 2020   arg.chunks.    
+000079d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000079e0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000079f0: 2020 2020 2020 6e75 6d5f 6368 756e 6b73        num_chunks
+00007a00: 5b69 5d20 3d20 6172 672e 6e75 6d62 6c6f  [i] = arg.numblo
+00007a10: 636b 730a 2020 2020 2020 2020 6f75 745f  cks.        out_
+00007a20: 7374 6172 7473 203d 205b 6361 6368 6564  starts = [cached
+00007a30: 5f63 756d 7375 6d28 632c 2069 6e69 7469  _cumsum(c, initi
+00007a40: 616c 5f7a 6572 6f3d 5472 7565 2920 666f  al_zero=True) fo
+00007a50: 7220 6320 696e 206f 7574 2e63 6875 6e6b  r c in out.chunk
+00007a60: 735d 0a0a 2020 2020 2020 2020 626c 6f63  s]..        bloc
+00007a70: 6b5f 696e 666f 5f6e 616d 6520 3d20 2262  k_info_name = "b
+00007a80: 6c6f 636b 2d69 6e66 6f2d 2220 2b20 6f75  lock-info-" + ou
+00007a90: 742e 6e61 6d65 0a20 2020 2020 2020 2062  t.name.        b
+00007aa0: 6c6f 636b 5f69 6e66 6f5f 6473 6b20 3d20  lock_info_dsk = 
+00007ab0: 7b7d 0a20 2020 2020 2020 2066 6f72 2062  {}.        for b
+00007ac0: 6c6f 636b 5f69 6420 696e 2070 726f 6475  lock_id in produ
+00007ad0: 6374 282a 2872 616e 6765 286c 656e 2863  ct(*(range(len(c
+00007ae0: 2929 2066 6f72 2063 2069 6e20 6f75 742e  )) for c in out.
+00007af0: 6368 756e 6b73 2929 3a0a 2020 2020 2020  chunks)):.      
+00007b00: 2020 2020 2020 2320 4765 7420 706f 7369        # Get posi
+00007b10: 7469 6f6e 206f 6620 6368 756e 6b2c 2069  tion of chunk, i
+00007b20: 6e64 6578 6564 2062 7920 6178 6973 206c  ndexed by axis l
+00007b30: 6162 656c 730a 2020 2020 2020 2020 2020  abels.          
+00007b40: 2020 6c6f 6361 7469 6f6e 203d 207b 6f75    location = {ou
+00007b50: 745f 696e 645b 695d 3a20 6c6f 6320 666f  t_ind[i]: loc fo
+00007b60: 7220 692c 206c 6f63 2069 6e20 656e 756d  r i, loc in enum
+00007b70: 6572 6174 6528 626c 6f63 6b5f 6964 297d  erate(block_id)}
+00007b80: 0a20 2020 2020 2020 2020 2020 2069 6e66  .            inf
+00007b90: 6f20 3d20 7b7d 0a20 2020 2020 2020 2020  o = {}.         
+00007ba0: 2020 2066 6f72 2069 2c20 7368 6170 6520     for i, shape 
+00007bb0: 696e 2073 6861 7065 732e 6974 656d 7328  in shapes.items(
+00007bc0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00007bd0: 2020 2023 2043 6f6d 7075 7465 2063 6875     # Compute chu
+00007be0: 6e6b 206b 6579 2069 6e20 7468 6520 6172  nk key in the ar
+00007bf0: 7261 792c 2074 616b 696e 6720 6272 6f61  ray, taking broa
+00007c00: 6463 6173 7469 6e67 2069 6e74 6f0a 2020  dcasting into.  
+00007c10: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00007c20: 6163 636f 756e 742e 2057 6520 646f 6e27  account. We don'
+00007c30: 7420 6469 7265 6374 6c79 206b 6e6f 7720  t directly know 
+00007c40: 7768 6963 6820 6469 6d65 6e73 696f 6e73  which dimensions
+00007c50: 2061 7265 0a20 2020 2020 2020 2020 2020   are.           
+00007c60: 2020 2020 2023 2062 726f 6164 6361 7374       # broadcast
+00007c70: 2c20 6275 7420 616e 7920 6469 6d65 6e73  , but any dimens
+00007c80: 696f 6e20 7769 7468 206f 6e6c 7920 6f6e  ion with only on
+00007c90: 6520 6368 756e 6b20 6361 6e20 6265 0a20  e chunk can be. 
+00007ca0: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00007cb0: 2074 7265 6174 6564 2061 7320 6272 6f61   treated as broa
+00007cc0: 6463 6173 742e 0a20 2020 2020 2020 2020  dcast..         
+00007cd0: 2020 2020 2020 2061 7272 5f6b 203d 2074         arr_k = t
+00007ce0: 7570 6c65 280a 2020 2020 2020 2020 2020  uple(.          
+00007cf0: 2020 2020 2020 2020 2020 6c6f 6361 7469            locati
+00007d00: 6f6e 2e67 6574 2869 6e64 2c20 3029 2069  on.get(ind, 0) i
+00007d10: 6620 6e75 6d5f 6368 756e 6b73 5b69 5d5b  f num_chunks[i][
+00007d20: 6a5d 203e 2031 2065 6c73 6520 300a 2020  j] > 1 else 0.  
+00007d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007d40: 2020 666f 7220 6a2c 2069 6e64 2069 6e20    for j, ind in 
+00007d50: 656e 756d 6572 6174 6528 6172 6770 6169  enumerate(argpai
+00007d60: 7273 5b69 5d5b 315d 290a 2020 2020 2020  rs[i][1]).      
+00007d70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00007d80: 2020 2020 2020 2020 2020 2020 696e 666f              info
+00007d90: 5b69 5d20 3d20 7b0a 2020 2020 2020 2020  [i] = {.        
+00007da0: 2020 2020 2020 2020 2020 2020 2273 6861              "sha
+00007db0: 7065 223a 2073 6861 7065 2c0a 2020 2020  pe": shape,.    
+00007dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007dd0: 226e 756d 2d63 6875 6e6b 7322 3a20 6e75  "num-chunks": nu
+00007de0: 6d5f 6368 756e 6b73 5b69 5d2c 0a20 2020  m_chunks[i],.   
+00007df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007e00: 2022 6172 7261 792d 6c6f 6361 7469 6f6e   "array-location
+00007e10: 223a 205b 0a20 2020 2020 2020 2020 2020  ": [.           
+00007e20: 2020 2020 2020 2020 2020 2020 2028 7374               (st
+00007e30: 6172 7473 5b69 5d5b 696a 5d5b 6a5d 2c20  arts[i][ij][j], 
+00007e40: 7374 6172 7473 5b69 5d5b 696a 5d5b 6a20  starts[i][ij][j 
+00007e50: 2b20 315d 290a 2020 2020 2020 2020 2020  + 1]).          
+00007e60: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00007e70: 7220 696a 2c20 6a20 696e 2065 6e75 6d65  r ij, j in enume
+00007e80: 7261 7465 2861 7272 5f6b 290a 2020 2020  rate(arr_k).    
+00007e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ea0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
+00007eb0: 2020 2020 2020 2022 6368 756e 6b2d 6c6f         "chunk-lo
+00007ec0: 6361 7469 6f6e 223a 2061 7272 5f6b 2c0a  cation": arr_k,.
+00007ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ee0: 7d0a 0a20 2020 2020 2020 2020 2020 2069  }..            i
+00007ef0: 6e66 6f5b 4e6f 6e65 5d20 3d20 7b0a 2020  nfo[None] = {.  
+00007f00: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+00007f10: 6861 7065 223a 206f 7574 2e73 6861 7065  hape": out.shape
+00007f20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007f30: 2020 226e 756d 2d63 6875 6e6b 7322 3a20    "num-chunks": 
+00007f40: 6f75 742e 6e75 6d62 6c6f 636b 732c 0a20  out.numblocks,. 
+00007f50: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00007f60: 6172 7261 792d 6c6f 6361 7469 6f6e 223a  array-location":
+00007f70: 205b 0a20 2020 2020 2020 2020 2020 2020   [.             
+00007f80: 2020 2020 2020 2028 6f75 745f 7374 6172         (out_star
+00007f90: 7473 5b69 6a5d 5b6a 5d2c 206f 7574 5f73  ts[ij][j], out_s
+00007fa0: 7461 7274 735b 696a 5d5b 6a20 2b20 315d  tarts[ij][j + 1]
+00007fb0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007fc0: 2020 2020 2020 666f 7220 696a 2c20 6a20        for ij, j 
+00007fd0: 696e 2065 6e75 6d65 7261 7465 2862 6c6f  in enumerate(blo
+00007fe0: 636b 5f69 6429 0a20 2020 2020 2020 2020  ck_id).         
+00007ff0: 2020 2020 2020 205d 2c0a 2020 2020 2020         ],.      
+00008000: 2020 2020 2020 2020 2020 2263 6875 6e6b            "chunk
+00008010: 2d6c 6f63 6174 696f 6e22 3a20 626c 6f63  -location": bloc
+00008020: 6b5f 6964 2c0a 2020 2020 2020 2020 2020  k_id,.          
+00008030: 2020 2020 2020 2263 6875 6e6b 2d73 6861        "chunk-sha
+00008040: 7065 223a 2074 7570 6c65 280a 2020 2020  pe": tuple(.    
+00008050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008060: 6f75 742e 6368 756e 6b73 5b69 6a5d 5b6a  out.chunks[ij][j
+00008070: 5d20 666f 7220 696a 2c20 6a20 696e 2065  ] for ij, j in e
+00008080: 6e75 6d65 7261 7465 2862 6c6f 636b 5f69  numerate(block_i
+00008090: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
+000080a0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
+000080b0: 2020 2020 2020 2264 7479 7065 223a 2064        "dtype": d
+000080c0: 7479 7065 2c0a 2020 2020 2020 2020 2020  type,.          
+000080d0: 2020 7d0a 2020 2020 2020 2020 2020 2020    }.            
+000080e0: 626c 6f63 6b5f 696e 666f 5f64 736b 5b28  block_info_dsk[(
+000080f0: 626c 6f63 6b5f 696e 666f 5f6e 616d 652c  block_info_name,
+00008100: 2920 2b20 626c 6f63 6b5f 6964 5d20 3d20  ) + block_id] = 
+00008110: 696e 666f 0a0a 2020 2020 2020 2020 626c  info..        bl
+00008120: 6f63 6b5f 696e 666f 203d 2041 7272 6179  ock_info = Array
+00008130: 280a 2020 2020 2020 2020 2020 2020 626c  (.            bl
+00008140: 6f63 6b5f 696e 666f 5f64 736b 2c0a 2020  ock_info_dsk,.  
+00008150: 2020 2020 2020 2020 2020 626c 6f63 6b5f            block_
+00008160: 696e 666f 5f6e 616d 652c 0a20 2020 2020  info_name,.     
+00008170: 2020 2020 2020 2063 6875 6e6b 733d 7475         chunks=tu
+00008180: 706c 6528 2831 2c29 202a 206c 656e 2863  ple((1,) * len(c
+00008190: 2920 666f 7220 6320 696e 206f 7574 2e63  ) for c in out.c
+000081a0: 6875 6e6b 7329 2c0a 2020 2020 2020 2020  hunks),.        
+000081b0: 2020 2020 6474 7970 653d 6e70 2e6f 626a      dtype=np.obj
+000081c0: 6563 745f 2c0a 2020 2020 2020 2020 290a  ect_,.        ).
+000081d0: 2020 2020 2020 2020 6578 7472 615f 6172          extra_ar
+000081e0: 6770 6169 7273 2e61 7070 656e 6428 2862  gpairs.append((b
+000081f0: 6c6f 636b 5f69 6e66 6f2c 206f 7574 5f69  lock_info, out_i
+00008200: 6e64 2929 0a20 2020 2020 2020 2065 7874  nd)).        ext
+00008210: 7261 5f6e 616d 6573 2e61 7070 656e 6428  ra_names.append(
+00008220: 2262 6c6f 636b 5f69 6e66 6f22 290a 0a20  "block_info").. 
+00008230: 2020 2069 6620 6578 7472 615f 6172 6770     if extra_argp
+00008240: 6169 7273 3a0a 2020 2020 2020 2020 2320  airs:.        # 
+00008250: 5265 7772 6974 6520 7468 6520 426c 6f63  Rewrite the Bloc
+00008260: 6b77 6973 6520 6c61 7965 722e 2049 7420  kwise layer. It 
+00008270: 776f 756c 6420 6265 206e 6963 6520 746f  would be nice to
+00008280: 2066 696e 6420 6120 7761 7920 746f 0a20   find a way to. 
+00008290: 2020 2020 2020 2023 2061 766f 6964 2064         # avoid d
+000082a0: 6f69 6e67 2069 7420 7477 6963 652c 2062  oing it twice, b
+000082b0: 7574 2069 7427 7320 6375 7272 656e 746c  ut it's currentl
+000082c0: 7920 6e65 6564 6564 2074 6f20 6465 7465  y needed to dete
+000082d0: 726d 696e 650a 2020 2020 2020 2020 2320  rmine.        # 
+000082e0: 6f75 742e 6368 756e 6b73 2066 726f 6d20  out.chunks from 
+000082f0: 7468 6520 6669 7273 7420 7061 7373 2e20  the first pass. 
+00008300: 5369 6e63 6520 6974 2063 6f6e 7374 7275  Since it constru
+00008310: 6374 7320 6120 426c 6f63 6b77 6973 650a  cts a Blockwise.
+00008320: 2020 2020 2020 2020 2320 7261 7468 6572          # rather
+00008330: 2074 6861 6e20 616e 2065 7870 616e 6465   than an expande
+00008340: 6420 6772 6170 682c 2069 7420 7368 6f75  d graph, it shou
+00008350: 6c64 6e27 7420 6265 2074 6f6f 2065 7870  ldn't be too exp
+00008360: 656e 7369 7665 2e0a 2020 2020 2020 2020  ensive..        
+00008370: 6f75 7420 3d20 626c 6f63 6b77 6973 6528  out = blockwise(
+00008380: 0a20 2020 2020 2020 2020 2020 205f 7061  .            _pa
+00008390: 7373 5f65 7874 7261 5f6b 7761 7267 732c  ss_extra_kwargs,
+000083a0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+000083b0: 5f69 6e64 2c0a 2020 2020 2020 2020 2020  _ind,.          
+000083c0: 2020 6675 6e63 2c0a 2020 2020 2020 2020    func,.        
+000083d0: 2020 2020 4e6f 6e65 2c0a 2020 2020 2020      None,.      
+000083e0: 2020 2020 2020 7475 706c 6528 6578 7472        tuple(extr
+000083f0: 615f 6e61 6d65 7329 2c0a 2020 2020 2020  a_names),.      
+00008400: 2020 2020 2020 4e6f 6e65 2c0a 2020 2020        None,.    
+00008410: 2020 2020 2020 2020 2a63 6f6e 6361 7428          *concat(
+00008420: 6578 7472 615f 6172 6770 6169 7273 292c  extra_argpairs),
+00008430: 0a20 2020 2020 2020 2020 2020 202a 636f  .            *co
+00008440: 6e63 6174 2861 7267 7061 6972 7329 2c0a  ncat(argpairs),.
+00008450: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00008460: 3d6f 7574 2e6e 616d 652c 0a20 2020 2020  =out.name,.     
+00008470: 2020 2020 2020 2064 7479 7065 3d6f 7574         dtype=out
+00008480: 2e64 7479 7065 2c0a 2020 2020 2020 2020  .dtype,.        
+00008490: 2020 2020 636f 6e63 6174 656e 6174 653d      concatenate=
+000084a0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
+000084b0: 2020 616c 6967 6e5f 6172 7261 7973 3d46    align_arrays=F
+000084c0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+000084d0: 2020 6164 6a75 7374 5f63 6875 6e6b 733d    adjust_chunks=
+000084e0: 6469 6374 287a 6970 286f 7574 5f69 6e64  dict(zip(out_ind
+000084f0: 2c20 6f75 742e 6368 756e 6b73 2929 2c0a  , out.chunks)),.
+00008500: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
+00008510: 3d6d 6574 612c 0a20 2020 2020 2020 2020  =meta,.         
+00008520: 2020 202a 2a6b 7761 7267 732c 0a20 2020     **kwargs,.   
+00008530: 2020 2020 2029 0a0a 2020 2020 7265 7475       )..    retu
+00008540: 726e 206f 7574 0a0a 0a64 6566 2061 7070  rn out...def app
+00008550: 6c79 5f61 6e64 5f65 6e66 6f72 6365 282a  ly_and_enforce(*
+00008560: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+00008570: 0a20 2020 2022 2222 4170 706c 7920 6120  .    """Apply a 
+00008580: 6675 6e63 7469 6f6e 2c20 616e 6420 656e  function, and en
+00008590: 666f 7263 6520 7468 6520 6f75 7470 7574  force the output
+000085a0: 2e6e 6469 6d20 746f 206d 6174 6368 2065  .ndim to match e
+000085b0: 7870 6563 7465 645f 6e64 696d 0a0a 2020  xpected_ndim..  
+000085c0: 2020 456e 7375 7265 7320 7468 6520 6f75    Ensures the ou
+000085d0: 7470 7574 2068 6173 2074 6865 2065 7870  tput has the exp
+000085e0: 6563 7465 6420 6469 6d65 6e73 696f 6e61  ected dimensiona
+000085f0: 6c69 7479 2e22 2222 0a20 2020 2066 756e  lity.""".    fun
+00008600: 6320 3d20 6b77 6172 6773 2e70 6f70 2822  c = kwargs.pop("
+00008610: 5f66 756e 6322 290a 2020 2020 6578 7065  _func").    expe
+00008620: 6374 6564 5f6e 6469 6d20 3d20 6b77 6172  cted_ndim = kwar
+00008630: 6773 2e70 6f70 2822 6578 7065 6374 6564  gs.pop("expected
+00008640: 5f6e 6469 6d22 290a 2020 2020 6f75 7420  _ndim").    out 
+00008650: 3d20 6675 6e63 282a 6172 6773 2c20 2a2a  = func(*args, **
+00008660: 6b77 6172 6773 290a 2020 2020 6966 2067  kwargs).    if g
+00008670: 6574 6174 7472 286f 7574 2c20 226e 6469  etattr(out, "ndi
+00008680: 6d22 2c20 3029 2021 3d20 6578 7065 6374  m", 0) != expect
+00008690: 6564 5f6e 6469 6d3a 0a20 2020 2020 2020  ed_ndim:.       
+000086a0: 206f 7574 5f6e 6469 6d20 3d20 6765 7461   out_ndim = geta
+000086b0: 7474 7228 6f75 742c 2022 6e64 696d 222c  ttr(out, "ndim",
+000086c0: 2030 290a 2020 2020 2020 2020 7261 6973   0).        rais
+000086d0: 6520 5661 6c75 6545 7272 6f72 280a 2020  e ValueError(.  
+000086e0: 2020 2020 2020 2020 2020 6622 4469 6d65            f"Dime
+000086f0: 6e73 696f 6e20 6d69 736d 6174 6368 3a20  nsion mismatch: 
+00008700: 6578 7065 6374 6564 206f 7574 7075 7420  expected output 
+00008710: 6f66 207b 6675 6e63 7d20 220a 2020 2020  of {func} ".    
+00008720: 2020 2020 2020 2020 6622 746f 2068 6176          f"to hav
+00008730: 6520 6469 6d73 203d 207b 6578 7065 6374  e dims = {expect
+00008740: 6564 5f6e 6469 6d7d 2e20 2047 6f74 207b  ed_ndim}.  Got {
+00008750: 6f75 745f 6e64 696d 7d20 696e 7374 6561  out_ndim} instea
+00008760: 642e 220a 2020 2020 2020 2020 290a 2020  d.".        ).  
+00008770: 2020 7265 7475 726e 206f 7574 0a0a 0a64    return out...d
+00008780: 6566 2062 726f 6164 6361 7374 5f63 6875  ef broadcast_chu
+00008790: 6e6b 7328 2a63 6875 6e6b 7373 293a 0a20  nks(*chunkss):. 
+000087a0: 2020 2022 2222 436f 6e73 7472 7563 7420     """Construct 
+000087b0: 6120 6368 756e 6b73 2074 7570 6c65 2074  a chunks tuple t
+000087c0: 6861 7420 6272 6f61 6463 6173 7473 206d  hat broadcasts m
+000087d0: 616e 7920 6368 756e 6b73 2074 7570 6c65  any chunks tuple
+000087e0: 730a 0a20 2020 203e 3e3e 2061 203d 2028  s..    >>> a = (
+000087f0: 2835 2c20 3529 2c29 0a20 2020 203e 3e3e  (5, 5),).    >>>
+00008800: 2062 203d 2028 2835 2c20 3529 2c29 0a20   b = ((5, 5),). 
+00008810: 2020 203e 3e3e 2062 726f 6164 6361 7374     >>> broadcast
+00008820: 5f63 6875 6e6b 7328 612c 2062 290a 2020  _chunks(a, b).  
+00008830: 2020 2828 352c 2035 292c 290a 0a20 2020    ((5, 5),)..   
+00008840: 203e 3e3e 2061 203d 2028 2831 302c 2031   >>> a = ((10, 1
+00008850: 302c 2031 3029 2c20 2835 2c20 3529 2c29  0, 10), (5, 5),)
+00008860: 0a20 2020 203e 3e3e 2062 203d 2028 2835  .    >>> b = ((5
+00008870: 2c20 3529 2c29 0a20 2020 203e 3e3e 2062  , 5),).    >>> b
+00008880: 726f 6164 6361 7374 5f63 6875 6e6b 7328  roadcast_chunks(
+00008890: 612c 2062 290a 2020 2020 2828 3130 2c20  a, b).    ((10, 
+000088a0: 3130 2c20 3130 292c 2028 352c 2035 2929  10, 10), (5, 5))
+000088b0: 0a0a 2020 2020 3e3e 3e20 6120 3d20 2828  ..    >>> a = ((
+000088c0: 3130 2c20 3130 2c20 3130 292c 2028 352c  10, 10, 10), (5,
+000088d0: 2035 292c 290a 2020 2020 3e3e 3e20 6220   5),).    >>> b 
+000088e0: 3d20 2828 312c 292c 2028 352c 2035 292c  = ((1,), (5, 5),
+000088f0: 290a 2020 2020 3e3e 3e20 6272 6f61 6463  ).    >>> broadc
+00008900: 6173 745f 6368 756e 6b73 2861 2c20 6229  ast_chunks(a, b)
+00008910: 0a20 2020 2028 2831 302c 2031 302c 2031  .    ((10, 10, 1
+00008920: 3029 2c20 2835 2c20 3529 290a 0a20 2020  0), (5, 5))..   
+00008930: 203e 3e3e 2061 203d 2028 2831 302c 2031   >>> a = ((10, 1
+00008940: 302c 2031 3029 2c20 2835 2c20 3529 2c29  0, 10), (5, 5),)
+00008950: 0a20 2020 203e 3e3e 2062 203d 2028 2833  .    >>> b = ((3
+00008960: 2c20 332c 292c 2028 352c 2035 292c 290a  , 3,), (5, 5),).
+00008970: 2020 2020 3e3e 3e20 6272 6f61 6463 6173      >>> broadcas
+00008980: 745f 6368 756e 6b73 2861 2c20 6229 0a20  t_chunks(a, b). 
+00008990: 2020 2054 7261 6365 6261 636b 2028 6d6f     Traceback (mo
+000089a0: 7374 2072 6563 656e 7420 6361 6c6c 206c  st recent call l
+000089b0: 6173 7429 3a0a 2020 2020 2020 2020 2e2e  ast):.        ..
+000089c0: 2e0a 2020 2020 5661 6c75 6545 7272 6f72  ..    ValueError
+000089d0: 3a20 4368 756e 6b73 2064 6f20 6e6f 7420  : Chunks do not 
+000089e0: 616c 6967 6e3a 205b 2831 302c 2031 302c  align: [(10, 10,
+000089f0: 2031 3029 2c20 2833 2c20 3329 5d0a 2020   10), (3, 3)].  
+00008a00: 2020 2222 220a 2020 2020 6966 206e 6f74    """.    if not
+00008a10: 2063 6875 6e6b 7373 3a0a 2020 2020 2020   chunkss:.      
+00008a20: 2020 7265 7475 726e 2028 290a 2020 2020    return ().    
+00008a30: 656c 6966 206c 656e 2863 6875 6e6b 7373  elif len(chunkss
+00008a40: 2920 3d3d 2031 3a0a 2020 2020 2020 2020  ) == 1:.        
+00008a50: 7265 7475 726e 2063 6875 6e6b 7373 5b30  return chunkss[0
+00008a60: 5d0a 2020 2020 6e20 3d20 6d61 7828 6d61  ].    n = max(ma
+00008a70: 7028 6c65 6e2c 2063 6875 6e6b 7373 2929  p(len, chunkss))
+00008a80: 0a20 2020 2063 6875 6e6b 7373 3220 3d20  .    chunkss2 = 
+00008a90: 5b28 2831 2c29 2c29 202a 2028 6e20 2d20  [((1,),) * (n - 
+00008aa0: 6c65 6e28 6329 2920 2b20 6320 666f 7220  len(c)) + c for 
+00008ab0: 6320 696e 2063 6875 6e6b 7373 5d0a 2020  c in chunkss].  
+00008ac0: 2020 7265 7375 6c74 203d 205b 5d0a 2020    result = [].  
+00008ad0: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00008ae0: 286e 293a 0a20 2020 2020 2020 2073 7465  (n):.        ste
+00008af0: 7031 203d 205b 635b 695d 2066 6f72 2063  p1 = [c[i] for c
+00008b00: 2069 6e20 6368 756e 6b73 7332 5d0a 2020   in chunkss2].  
+00008b10: 2020 2020 2020 6966 2061 6c6c 2863 203d        if all(c =
+00008b20: 3d20 2831 2c29 2066 6f72 2063 2069 6e20  = (1,) for c in 
+00008b30: 7374 6570 3129 3a0a 2020 2020 2020 2020  step1):.        
+00008b40: 2020 2020 7374 6570 3220 3d20 7374 6570      step2 = step
+00008b50: 310a 2020 2020 2020 2020 656c 7365 3a0a  1.        else:.
+00008b60: 2020 2020 2020 2020 2020 2020 7374 6570              step
+00008b70: 3220 3d20 5b63 2066 6f72 2063 2069 6e20  2 = [c for c in 
+00008b80: 7374 6570 3120 6966 2063 2021 3d20 2831  step1 if c != (1
+00008b90: 2c29 5d0a 2020 2020 2020 2020 6966 206c  ,)].        if l
+00008ba0: 656e 2873 6574 2873 7465 7032 2929 2021  en(set(step2)) !
+00008bb0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00008bc0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+00008bd0: 7228 2243 6875 6e6b 7320 646f 206e 6f74  r("Chunks do not
+00008be0: 2061 6c69 676e 3a20 2573 2220 2520 7374   align: %s" % st
+00008bf0: 7228 7374 6570 3229 290a 2020 2020 2020  r(step2)).      
+00008c00: 2020 7265 7375 6c74 2e61 7070 656e 6428    result.append(
+00008c10: 7374 6570 325b 305d 290a 2020 2020 7265  step2[0]).    re
+00008c20: 7475 726e 2074 7570 6c65 2872 6573 756c  turn tuple(resul
+00008c30: 7429 0a0a 0a64 6566 2073 746f 7265 280a  t)...def store(.
+00008c40: 2020 2020 736f 7572 6365 733a 2041 7272      sources: Arr
+00008c50: 6179 207c 2043 6f6c 6c65 6374 696f 6e5b  ay | Collection[
+00008c60: 4172 7261 795d 2c0a 2020 2020 7461 7267  Array],.    targ
+00008c70: 6574 733a 2041 7272 6179 4c69 6b65 207c  ets: ArrayLike |
+00008c80: 2044 656c 6179 6564 207c 2043 6f6c 6c65   Delayed | Colle
+00008c90: 6374 696f 6e5b 4172 7261 794c 696b 6520  ction[ArrayLike 
+00008ca0: 7c20 4465 6c61 7965 645d 2c0a 2020 2020  | Delayed],.    
+00008cb0: 6c6f 636b 3a20 626f 6f6c 207c 204c 6f63  lock: bool | Loc
+00008cc0: 6b20 3d20 5472 7565 2c0a 2020 2020 7265  k = True,.    re
+00008cd0: 6769 6f6e 733a 2074 7570 6c65 5b73 6c69  gions: tuple[sli
+00008ce0: 6365 2c20 2e2e 2e5d 207c 2043 6f6c 6c65  ce, ...] | Colle
+00008cf0: 6374 696f 6e5b 7475 706c 655b 736c 6963  ction[tuple[slic
+00008d00: 652c 202e 2e2e 5d5d 207c 204e 6f6e 6520  e, ...]] | None 
+00008d10: 3d20 4e6f 6e65 2c0a 2020 2020 636f 6d70  = None,.    comp
+00008d20: 7574 653a 2062 6f6f 6c20 3d20 5472 7565  ute: bool = True
+00008d30: 2c0a 2020 2020 7265 7475 726e 5f73 746f  ,.    return_sto
+00008d40: 7265 643a 2062 6f6f 6c20 3d20 4661 6c73  red: bool = Fals
+00008d50: 652c 0a20 2020 202a 2a6b 7761 7267 732c  e,.    **kwargs,
+00008d60: 0a29 3a0a 2020 2020 2222 2253 746f 7265  .):.    """Store
+00008d70: 2064 6173 6b20 6172 7261 7973 2069 6e20   dask arrays in 
+00008d80: 6172 7261 792d 6c69 6b65 206f 626a 6563  array-like objec
+00008d90: 7473 2c20 6f76 6572 7772 6974 6520 6461  ts, overwrite da
+00008da0: 7461 2069 6e20 7461 7267 6574 0a0a 2020  ta in target..  
+00008db0: 2020 5468 6973 2073 746f 7265 7320 6461    This stores da
+00008dc0: 736b 2061 7272 6179 7320 696e 746f 206f  sk arrays into o
+00008dd0: 626a 6563 7420 7468 6174 2073 7570 706f  bject that suppo
+00008de0: 7274 7320 6e75 6d70 792d 7374 796c 6520  rts numpy-style 
+00008df0: 7365 7469 7465 6d0a 2020 2020 696e 6465  setitem.    inde
+00008e00: 7869 6e67 2e20 2049 7420 7374 6f72 6573  xing.  It stores
+00008e10: 2076 616c 7565 7320 6368 756e 6b20 6279   values chunk by
+00008e20: 2063 6875 6e6b 2073 6f20 7468 6174 2069   chunk so that i
+00008e30: 7420 646f 6573 206e 6f74 2068 6176 6520  t does not have 
+00008e40: 746f 0a20 2020 2066 696c 6c20 7570 206d  to.    fill up m
+00008e50: 656d 6f72 792e 2020 466f 7220 6265 7374  emory.  For best
+00008e60: 2070 6572 666f 726d 616e 6365 2079 6f75   performance you
+00008e70: 2063 616e 2061 6c69 676e 2074 6865 2062   can align the b
+00008e80: 6c6f 636b 2073 697a 6520 6f66 0a20 2020  lock size of.   
+00008e90: 2074 6865 2073 746f 7261 6765 2074 6172   the storage tar
+00008ea0: 6765 7420 7769 7468 2074 6865 2062 6c6f  get with the blo
+00008eb0: 636b 2073 697a 6520 6f66 2079 6f75 7220  ck size of your 
+00008ec0: 6172 7261 792e 0a0a 2020 2020 4966 2079  array...    If y
+00008ed0: 6f75 7220 6461 7461 2066 6974 7320 696e  our data fits in
+00008ee0: 206d 656d 6f72 7920 7468 656e 2079 6f75   memory then you
+00008ef0: 206d 6179 2070 7265 6665 7220 6361 6c6c   may prefer call
+00008f00: 696e 670a 2020 2020 6060 6e70 2e61 7272  ing.    ``np.arr
+00008f10: 6179 286d 7961 7272 6179 2960 6020 696e  ay(myarray)`` in
+00008f20: 7374 6561 642e 0a0a 2020 2020 5061 7261  stead...    Para
+00008f30: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+00008f40: 2d2d 2d2d 2d0a 0a20 2020 2073 6f75 7263  -----..    sourc
+00008f50: 6573 3a20 4172 7261 7920 6f72 2063 6f6c  es: Array or col
+00008f60: 6c65 6374 696f 6e20 6f66 2041 7272 6179  lection of Array
+00008f70: 730a 2020 2020 7461 7267 6574 733a 2061  s.    targets: a
+00008f80: 7272 6179 2d6c 696b 6520 6f72 2044 656c  rray-like or Del
+00008f90: 6179 6564 206f 7220 636f 6c6c 6563 7469  ayed or collecti
+00008fa0: 6f6e 206f 6620 6172 7261 792d 6c69 6b65  on of array-like
+00008fb0: 7320 616e 642f 6f72 2044 656c 6179 6564  s and/or Delayed
+00008fc0: 730a 2020 2020 2020 2020 5468 6573 6520  s.        These 
+00008fd0: 7368 6f75 6c64 2073 7570 706f 7274 2073  should support s
+00008fe0: 6574 6974 656d 2073 796e 7461 7820 6060  etitem syntax ``
+00008ff0: 7461 7267 6574 5b31 303a 3230 5d20 3d20  target[10:20] = 
+00009000: 2e2e 2e60 602e 0a20 2020 2020 2020 2049  ...``..        I
+00009010: 6620 736f 7572 6365 7320 6973 2061 2073  f sources is a s
+00009020: 696e 676c 6520 6974 656d 2c20 7461 7267  ingle item, targ
+00009030: 6574 7320 6d75 7374 2062 6520 6120 7369  ets must be a si
+00009040: 6e67 6c65 2069 7465 6d3b 2069 6620 736f  ngle item; if so
+00009050: 7572 6365 7320 6973 2061 0a20 2020 2020  urces is a.     
+00009060: 2020 2063 6f6c 6c65 6374 696f 6e20 6f66     collection of
+00009070: 2061 7272 6179 732c 2074 6172 6765 7473   arrays, targets
+00009080: 206d 7573 7420 6265 2061 206d 6174 6368   must be a match
+00009090: 696e 6720 636f 6c6c 6563 7469 6f6e 2e0a  ing collection..
+000090a0: 2020 2020 6c6f 636b 3a20 626f 6f6c 6561      lock: boolea
+000090b0: 6e20 6f72 2074 6872 6561 6469 6e67 2e4c  n or threading.L
+000090c0: 6f63 6b2c 206f 7074 696f 6e61 6c0a 2020  ock, optional.  
+000090d0: 2020 2020 2020 5768 6574 6865 7220 6f72        Whether or
+000090e0: 206e 6f74 2074 6f20 6c6f 636b 2074 6865   not to lock the
+000090f0: 2064 6174 6120 7374 6f72 6573 2077 6869   data stores whi
+00009100: 6c65 2073 746f 7269 6e67 2e0a 2020 2020  le storing..    
+00009110: 2020 2020 5061 7373 2054 7275 6520 286c      Pass True (l
+00009120: 6f63 6b20 6561 6368 2066 696c 6520 696e  ock each file in
+00009130: 6469 7669 6475 616c 6c79 292c 2046 616c  dividually), Fal
+00009140: 7365 2028 646f 6e27 7420 6c6f 636b 2920  se (don't lock) 
+00009150: 6f72 2061 0a20 2020 2020 2020 2070 6172  or a.        par
+00009160: 7469 6375 6c61 7220 3a63 6c61 7373 3a60  ticular :class:`
+00009170: 7468 7265 6164 696e 672e 4c6f 636b 6020  threading.Lock` 
+00009180: 6f62 6a65 6374 2074 6f20 6265 2073 6861  object to be sha
+00009190: 7265 6420 616d 6f6e 6720 616c 6c20 7772  red among all wr
+000091a0: 6974 6573 2e0a 2020 2020 7265 6769 6f6e  ites..    region
+000091b0: 733a 2074 7570 6c65 206f 6620 736c 6963  s: tuple of slic
+000091c0: 6573 206f 7220 636f 6c6c 6563 7469 6f6e  es or collection
+000091d0: 206f 6620 7475 706c 6573 206f 6620 736c   of tuples of sl
+000091e0: 6963 6573 2c20 6f70 7469 6f6e 616c 0a20  ices, optional. 
+000091f0: 2020 2020 2020 2045 6163 6820 6060 7265         Each ``re
+00009200: 6769 6f6e 6060 2074 7570 6c65 2069 6e20  gion`` tuple in 
+00009210: 6060 7265 6769 6f6e 7360 6020 7368 6f75  ``regions`` shou
+00009220: 6c64 2062 6520 7375 6368 2074 6861 740a  ld be such that.
+00009230: 2020 2020 2020 2020 6060 7461 7267 6574          ``target
+00009240: 5b72 6567 696f 6e5d 2e73 6861 7065 203d  [region].shape =
+00009250: 2073 6f75 7263 652e 7368 6170 6560 600a   source.shape``.
+00009260: 2020 2020 2020 2020 666f 7220 7468 6520          for the 
+00009270: 636f 7272 6573 706f 6e64 696e 6720 736f  corresponding so
+00009280: 7572 6365 2061 6e64 2074 6172 6765 7420  urce and target 
+00009290: 696e 2073 6f75 7263 6573 2061 6e64 2074  in sources and t
+000092a0: 6172 6765 7473 2c0a 2020 2020 2020 2020  argets,.        
+000092b0: 7265 7370 6563 7469 7665 6c79 2e20 4966  respectively. If
+000092c0: 2074 6869 7320 6973 2061 2074 7570 6c65   this is a tuple
+000092d0: 2c20 7468 6520 636f 6e74 656e 7473 2077  , the contents w
+000092e0: 696c 6c20 6265 2061 7373 756d 6564 2074  ill be assumed t
+000092f0: 6f20 6265 0a20 2020 2020 2020 2073 6c69  o be.        sli
+00009300: 6365 732c 2073 6f20 646f 206e 6f74 2070  ces, so do not p
+00009310: 726f 7669 6465 2061 2074 7570 6c65 206f  rovide a tuple o
+00009320: 6620 7475 706c 6573 2e0a 2020 2020 636f  f tuples..    co
+00009330: 6d70 7574 653a 2062 6f6f 6c65 616e 2c20  mpute: boolean, 
+00009340: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+00009350: 2049 6620 7472 7565 2063 6f6d 7075 7465   If true compute
+00009360: 2069 6d6d 6564 6961 7465 6c79 3b20 7265   immediately; re
+00009370: 7475 726e 203a 636c 6173 733a 6064 6173  turn :class:`das
+00009380: 6b2e 6465 6c61 7965 642e 4465 6c61 7965  k.delayed.Delaye
+00009390: 6460 206f 7468 6572 7769 7365 2e0a 2020  d` otherwise..  
+000093a0: 2020 7265 7475 726e 5f73 746f 7265 643a    return_stored:
+000093b0: 2062 6f6f 6c65 616e 2c20 6f70 7469 6f6e   boolean, option
+000093c0: 616c 0a20 2020 2020 2020 204f 7074 696f  al.        Optio
+000093d0: 6e61 6c6c 7920 7265 7475 726e 2074 6865  nally return the
+000093e0: 2073 746f 7265 6420 7265 7375 6c74 2028   stored result (
+000093f0: 6465 6661 756c 7420 4661 6c73 6529 2e0a  default False)..
+00009400: 2020 2020 6b77 6172 6773 3a0a 2020 2020      kwargs:.    
+00009410: 2020 2020 5061 7261 6d65 7465 7273 2070      Parameters p
+00009420: 6173 7365 6420 746f 2063 6f6d 7075 7465  assed to compute
+00009430: 2f70 6572 7369 7374 2028 6f6e 6c79 2075  /persist (only u
+00009440: 7365 6420 6966 2063 6f6d 7075 7465 3d54  sed if compute=T
+00009450: 7275 6529 0a0a 2020 2020 5265 7475 726e  rue)..    Return
+00009460: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 0a20  s.    -------.. 
+00009470: 2020 2049 6620 7265 7475 726e 5f73 746f     If return_sto
+00009480: 7265 643d 5472 7565 0a20 2020 2020 2020  red=True.       
+00009490: 2074 7570 6c65 206f 6620 4172 7261 7973   tuple of Arrays
+000094a0: 0a20 2020 2049 6620 7265 7475 726e 5f73  .    If return_s
+000094b0: 746f 7265 643d 4661 6c73 6520 616e 6420  tored=False and 
+000094c0: 636f 6d70 7574 653d 5472 7565 0a20 2020  compute=True.   
+000094d0: 2020 2020 204e 6f6e 650a 2020 2020 4966       None.    If
+000094e0: 2072 6574 7572 6e5f 7374 6f72 6564 3d46   return_stored=F
+000094f0: 616c 7365 2061 6e64 2063 6f6d 7075 7465  alse and compute
+00009500: 3d46 616c 7365 0a20 2020 2020 2020 2044  =False.        D
+00009510: 656c 6179 6564 0a0a 2020 2020 4578 616d  elayed..    Exam
+00009520: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
+00009530: 2d0a 0a20 2020 203e 3e3e 2069 6d70 6f72  -..    >>> impor
+00009540: 7420 6835 7079 2020 2320 646f 6374 6573  t h5py  # doctes
+00009550: 743a 202b 534b 4950 0a20 2020 203e 3e3e  t: +SKIP.    >>>
+00009560: 2066 203d 2068 3570 792e 4669 6c65 2827   f = h5py.File('
+00009570: 6d79 6669 6c65 2e68 6466 3527 2c20 6d6f  myfile.hdf5', mo
+00009580: 6465 3d27 6127 2920 2023 2064 6f63 7465  de='a')  # docte
+00009590: 7374 3a20 2b53 4b49 500a 2020 2020 3e3e  st: +SKIP.    >>
+000095a0: 3e20 6473 6574 203d 2066 2e63 7265 6174  > dset = f.creat
+000095b0: 655f 6461 7461 7365 7428 272f 6461 7461  e_dataset('/data
+000095c0: 272c 2073 6861 7065 3d78 2e73 6861 7065  ', shape=x.shape
+000095d0: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
+000095e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095f0: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+00009600: 733d 782e 6368 756e 6b73 2c0a 2020 2020  s=x.chunks,.    
+00009610: 2e2e 2e20 2020 2020 2020 2020 2020 2020  ...             
+00009620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009630: 2020 2020 2064 7479 7065 3d27 6638 2729       dtype='f8')
+00009640: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
+00009650: 4950 0a0a 2020 2020 3e3e 3e20 7374 6f72  IP..    >>> stor
+00009660: 6528 782c 2064 7365 7429 2020 2320 646f  e(x, dset)  # do
+00009670: 6374 6573 743a 202b 534b 4950 0a0a 2020  ctest: +SKIP..  
+00009680: 2020 416c 7465 726e 6174 6976 656c 7920    Alternatively 
+00009690: 7374 6f72 6520 6d61 6e79 2061 7272 6179  store many array
+000096a0: 7320 6174 2074 6865 2073 616d 6520 7469  s at the same ti
+000096b0: 6d65 0a0a 2020 2020 3e3e 3e20 7374 6f72  me..    >>> stor
+000096c0: 6528 5b78 2c20 792c 207a 5d2c 205b 6473  e([x, y, z], [ds
+000096d0: 6574 312c 2064 7365 7432 2c20 6473 6574  et1, dset2, dset
+000096e0: 335d 2920 2023 2064 6f63 7465 7374 3a20  3])  # doctest: 
+000096f0: 2b53 4b49 500a 2020 2020 2222 220a 0a20  +SKIP.    """.. 
+00009700: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00009710: 2873 6f75 7263 6573 2c20 4172 7261 7929  (sources, Array)
+00009720: 3a0a 2020 2020 2020 2020 736f 7572 6365  :.        source
+00009730: 7320 3d20 5b73 6f75 7263 6573 5d0a 2020  s = [sources].  
+00009740: 2020 2020 2020 2320 5468 6572 6527 7320        # There's 
+00009750: 6e6f 2077 6179 2074 6f20 7465 7374 2074  no way to test t
+00009760: 6861 7420 7461 7267 6574 7320 6973 2061  hat targets is a
+00009770: 2073 696e 676c 6520 6172 7261 792d 6c69   single array-li
+00009780: 6b65 2e0a 2020 2020 2020 2020 2320 5765  ke..        # We
+00009790: 206e 6565 6420 746f 2074 7275 7374 2074   need to trust t
+000097a0: 6865 2075 7365 722e 0a20 2020 2020 2020  he user..       
+000097b0: 2074 6172 6765 7473 203d 205b 7461 7267   targets = [targ
+000097c0: 6574 735d 2020 2320 7479 7065 3a20 6967  ets]  # type: ig
+000097d0: 6e6f 7265 0a20 2020 2074 6172 6765 7473  nore.    targets
+000097e0: 203d 2063 6173 7428 2243 6f6c 6c65 6374   = cast("Collect
+000097f0: 696f 6e5b 4172 7261 794c 696b 6520 7c20  ion[ArrayLike | 
+00009800: 4465 6c61 7965 645d 222c 2074 6172 6765  Delayed]", targe
+00009810: 7473 290a 0a20 2020 2069 6620 616e 7928  ts)..    if any(
+00009820: 6e6f 7420 6973 696e 7374 616e 6365 2873  not isinstance(s
+00009830: 2c20 4172 7261 7929 2066 6f72 2073 2069  , Array) for s i
+00009840: 6e20 736f 7572 6365 7329 3a0a 2020 2020  n sources):.    
+00009850: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00009860: 7272 6f72 2822 416c 6c20 736f 7572 6365  rror("All source
+00009870: 7320 6d75 7374 2062 6520 6461 736b 2061  s must be dask a
+00009880: 7272 6179 206f 626a 6563 7473 2229 0a0a  rray objects")..
+00009890: 2020 2020 6966 206c 656e 2873 6f75 7263      if len(sourc
+000098a0: 6573 2920 213d 206c 656e 2874 6172 6765  es) != len(targe
+000098b0: 7473 293a 0a20 2020 2020 2020 2072 6169  ts):.        rai
+000098c0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+000098d0: 2020 2020 2020 2020 2020 2022 4469 6666             "Diff
+000098e0: 6572 656e 7420 6e75 6d62 6572 206f 6620  erent number of 
+000098f0: 736f 7572 6365 7320 5b25 645d 2061 6e64  sources [%d] and
+00009900: 2074 6172 6765 7473 205b 2564 5d22 0a20   targets [%d]". 
+00009910: 2020 2020 2020 2020 2020 2025 2028 6c65             % (le
+00009920: 6e28 736f 7572 6365 7329 2c20 6c65 6e28  n(sources), len(
+00009930: 7461 7267 6574 7329 290a 2020 2020 2020  targets)).      
+00009940: 2020 290a 0a20 2020 2069 6620 6973 696e    )..    if isin
+00009950: 7374 616e 6365 2872 6567 696f 6e73 2c20  stance(regions, 
+00009960: 7475 706c 6529 206f 7220 7265 6769 6f6e  tuple) or region
+00009970: 7320 6973 204e 6f6e 653a 0a20 2020 2020  s is None:.     
+00009980: 2020 2072 6567 696f 6e73 5f6c 6973 7420     regions_list 
+00009990: 3d20 5b72 6567 696f 6e73 5d20 2a20 6c65  = [regions] * le
+000099a0: 6e28 736f 7572 6365 7329 0a20 2020 2065  n(sources).    e
+000099b0: 6c73 653a 0a20 2020 2020 2020 2072 6567  lse:.        reg
+000099c0: 696f 6e73 5f6c 6973 7420 3d20 6c69 7374  ions_list = list
+000099d0: 2872 6567 696f 6e73 290a 2020 2020 2020  (regions).      
+000099e0: 2020 6966 206c 656e 2873 6f75 7263 6573    if len(sources
+000099f0: 2920 213d 206c 656e 2872 6567 696f 6e73  ) != len(regions
+00009a00: 5f6c 6973 7429 3a0a 2020 2020 2020 2020  _list):.        
+00009a10: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00009a20: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00009a30: 2020 2020 2020 6622 4469 6666 6572 656e        f"Differen
+00009a40: 7420 6e75 6d62 6572 206f 6620 736f 7572  t number of sour
+00009a50: 6365 7320 5b7b 6c65 6e28 736f 7572 6365  ces [{len(source
+00009a60: 7329 7d5d 2061 6e64 2022 0a20 2020 2020  s)}] and ".     
+00009a70: 2020 2020 2020 2020 2020 2066 2274 6172             f"tar
+00009a80: 6765 7473 205b 7b6c 656e 2874 6172 6765  gets [{len(targe
+00009a90: 7473 297d 5d20 7468 616e 2072 6567 696f  ts)}] than regio
+00009aa0: 6e73 205b 7b6c 656e 2872 6567 696f 6e73  ns [{len(regions
+00009ab0: 5f6c 6973 7429 7d5d 220a 2020 2020 2020  _list)}]".      
+00009ac0: 2020 2020 2020 290a 2020 2020 6465 6c20        ).    del 
+00009ad0: 7265 6769 6f6e 730a 0a20 2020 2023 204f  regions..    # O
+00009ae0: 7074 696d 697a 6520 616c 6c20 736f 7572  ptimize all sour
+00009af0: 6365 7320 746f 6765 7468 6572 0a20 2020  ces together.   
+00009b00: 2073 6f75 7263 6573 5f68 6c67 203d 2048   sources_hlg = H
+00009b10: 6967 684c 6576 656c 4772 6170 682e 6d65  ighLevelGraph.me
+00009b20: 7267 6528 2a5b 652e 5f5f 6461 736b 5f67  rge(*[e.__dask_g
+00009b30: 7261 7068 5f5f 2829 2066 6f72 2065 2069  raph__() for e i
+00009b40: 6e20 736f 7572 6365 735d 290a 2020 2020  n sources]).    
+00009b50: 736f 7572 6365 735f 6c61 7965 7220 3d20  sources_layer = 
+00009b60: 4172 7261 792e 5f5f 6461 736b 5f6f 7074  Array.__dask_opt
+00009b70: 696d 697a 655f 5f28 0a20 2020 2020 2020  imize__(.       
+00009b80: 2073 6f75 7263 6573 5f68 6c67 2c20 6c69   sources_hlg, li
+00009b90: 7374 2863 6f72 652e 666c 6174 7465 6e28  st(core.flatten(
+00009ba0: 5b65 2e5f 5f64 6173 6b5f 6b65 7973 5f5f  [e.__dask_keys__
+00009bb0: 2829 2066 6f72 2065 2069 6e20 736f 7572  () for e in sour
+00009bc0: 6365 735d 2929 0a20 2020 2029 0a20 2020  ces])).    ).   
+00009bd0: 2073 6f75 7263 6573 5f6e 616d 6520 3d20   sources_name = 
+00009be0: 2273 746f 7265 2d73 6f75 7263 6573 2d22  "store-sources-"
+00009bf0: 202b 2074 6f6b 656e 697a 6528 736f 7572   + tokenize(sour
+00009c00: 6365 7329 0a20 2020 206c 6179 6572 7320  ces).    layers 
+00009c10: 3d20 7b73 6f75 7263 6573 5f6e 616d 653a  = {sources_name:
+00009c20: 2073 6f75 7263 6573 5f6c 6179 6572 7d0a   sources_layer}.
+00009c30: 2020 2020 6465 7065 6e64 656e 6369 6573      dependencies
+00009c40: 3a20 6469 6374 5b73 7472 2c20 7365 745b  : dict[str, set[
+00009c50: 7374 725d 5d20 3d20 7b73 6f75 7263 6573  str]] = {sources
+00009c60: 5f6e 616d 653a 2073 6574 2829 7d0a 0a20  _name: set()}.. 
+00009c70: 2020 2023 204f 7074 696d 697a 6520 616c     # Optimize al
+00009c80: 6c20 7461 7267 6574 7320 746f 6765 7468  l targets togeth
+00009c90: 6572 0a20 2020 2074 6172 6765 7473 5f6b  er.    targets_k
+00009ca0: 6579 7320 3d20 5b5d 0a20 2020 2074 6172  eys = [].    tar
+00009cb0: 6765 7473 5f64 736b 7320 3d20 5b5d 0a20  gets_dsks = []. 
+00009cc0: 2020 2066 6f72 2074 2069 6e20 7461 7267     for t in targ
+00009cd0: 6574 733a 0a20 2020 2020 2020 2069 6620  ets:.        if 
+00009ce0: 6973 696e 7374 616e 6365 2874 2c20 4465  isinstance(t, De
+00009cf0: 6c61 7965 6429 3a0a 2020 2020 2020 2020  layed):.        
+00009d00: 2020 2020 7461 7267 6574 735f 6b65 7973      targets_keys
+00009d10: 2e61 7070 656e 6428 742e 6b65 7929 0a20  .append(t.key). 
+00009d20: 2020 2020 2020 2020 2020 2074 6172 6765             targe
+00009d30: 7473 5f64 736b 732e 6170 7065 6e64 2874  ts_dsks.append(t
+00009d40: 2e5f 5f64 6173 6b5f 6772 6170 685f 5f28  .__dask_graph__(
+00009d50: 2929 0a20 2020 2020 2020 2065 6c69 6620  )).        elif 
+00009d60: 6973 5f64 6173 6b5f 636f 6c6c 6563 7469  is_dask_collecti
+00009d70: 6f6e 2874 293a 0a20 2020 2020 2020 2020  on(t):.         
+00009d80: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+00009d90: 6f72 2822 5461 7267 6574 7320 6d75 7374  or("Targets must
+00009da0: 2062 6520 6569 7468 6572 2044 656c 6179   be either Delay
+00009db0: 6564 206f 626a 6563 7473 206f 7220 6172  ed objects or ar
+00009dc0: 7261 792d 6c69 6b65 7322 290a 0a20 2020  ray-likes")..   
+00009dd0: 2069 6620 7461 7267 6574 735f 6473 6b73   if targets_dsks
+00009de0: 3a0a 2020 2020 2020 2020 7461 7267 6574  :.        target
+00009df0: 735f 686c 6720 3d20 4869 6768 4c65 7665  s_hlg = HighLeve
+00009e00: 6c47 7261 7068 2e6d 6572 6765 282a 7461  lGraph.merge(*ta
+00009e10: 7267 6574 735f 6473 6b73 290a 2020 2020  rgets_dsks).    
+00009e20: 2020 2020 7461 7267 6574 735f 6c61 7965      targets_laye
+00009e30: 7220 3d20 4465 6c61 7965 642e 5f5f 6461  r = Delayed.__da
+00009e40: 736b 5f6f 7074 696d 697a 655f 5f28 7461  sk_optimize__(ta
+00009e50: 7267 6574 735f 686c 672c 2074 6172 6765  rgets_hlg, targe
+00009e60: 7473 5f6b 6579 7329 0a20 2020 2020 2020  ts_keys).       
+00009e70: 2074 6172 6765 7473 5f6e 616d 6520 3d20   targets_name = 
+00009e80: 2273 746f 7265 2d74 6172 6765 7473 2d22  "store-targets-"
+00009e90: 202b 2074 6f6b 656e 697a 6528 7461 7267   + tokenize(targ
+00009ea0: 6574 735f 6b65 7973 290a 2020 2020 2020  ets_keys).      
+00009eb0: 2020 6c61 7965 7273 5b74 6172 6765 7473    layers[targets
+00009ec0: 5f6e 616d 655d 203d 2074 6172 6765 7473  _name] = targets
+00009ed0: 5f6c 6179 6572 0a20 2020 2020 2020 2064  _layer.        d
+00009ee0: 6570 656e 6465 6e63 6965 735b 7461 7267  ependencies[targ
+00009ef0: 6574 735f 6e61 6d65 5d20 3d20 7365 7428  ets_name] = set(
+00009f00: 290a 0a20 2020 206c 6f61 645f 7374 6f72  )..    load_stor
+00009f10: 6564 203d 2072 6574 7572 6e5f 7374 6f72  ed = return_stor
+00009f20: 6564 2061 6e64 206e 6f74 2063 6f6d 7075  ed and not compu
+00009f30: 7465 0a0a 2020 2020 6d61 705f 6e61 6d65  te..    map_name
+00009f40: 7320 3d20 5b0a 2020 2020 2020 2020 2273  s = [.        "s
+00009f50: 746f 7265 2d6d 6170 2d22 202b 2074 6f6b  tore-map-" + tok
+00009f60: 656e 697a 6528 732c 2074 2069 6620 6973  enize(s, t if is
+00009f70: 696e 7374 616e 6365 2874 2c20 4465 6c61  instance(t, Dela
+00009f80: 7965 6429 2065 6c73 6520 6964 2874 292c  yed) else id(t),
+00009f90: 2072 290a 2020 2020 2020 2020 666f 7220   r).        for 
+00009fa0: 732c 2074 2c20 7220 696e 207a 6970 2873  s, t, r in zip(s
+00009fb0: 6f75 7263 6573 2c20 7461 7267 6574 732c  ources, targets,
+00009fc0: 2072 6567 696f 6e73 5f6c 6973 7429 0a20   regions_list). 
+00009fd0: 2020 205d 0a20 2020 206d 6170 5f6b 6579     ].    map_key
+00009fe0: 733a 206c 6973 745b 7475 706c 655d 203d  s: list[tuple] =
+00009ff0: 205b 5d0a 0a20 2020 2066 6f72 2073 2c20   []..    for s, 
+0000a000: 742c 206e 2c20 7220 696e 207a 6970 2873  t, n, r in zip(s
+0000a010: 6f75 7263 6573 2c20 7461 7267 6574 732c  ources, targets,
+0000a020: 206d 6170 5f6e 616d 6573 2c20 7265 6769   map_names, regi
+0000a030: 6f6e 735f 6c69 7374 293a 0a20 2020 2020  ons_list):.     
+0000a040: 2020 206d 6170 5f6c 6179 6572 203d 2069     map_layer = i
+0000a050: 6e73 6572 745f 746f 5f6f 6f63 280a 2020  nsert_to_ooc(.  
+0000a060: 2020 2020 2020 2020 2020 6b65 7973 3d73            keys=s
+0000a070: 2e5f 5f64 6173 6b5f 6b65 7973 5f5f 2829  .__dask_keys__()
+0000a080: 2c0a 2020 2020 2020 2020 2020 2020 6368  ,.            ch
+0000a090: 756e 6b73 3d73 2e63 6875 6e6b 732c 0a20  unks=s.chunks,. 
+0000a0a0: 2020 2020 2020 2020 2020 206f 7574 3d74             out=t
+0000a0b0: 2e6b 6579 2069 6620 6973 696e 7374 616e  .key if isinstan
+0000a0c0: 6365 2874 2c20 4465 6c61 7965 6429 2065  ce(t, Delayed) e
+0000a0d0: 6c73 6520 742c 0a20 2020 2020 2020 2020  lse t,.         
+0000a0e0: 2020 206e 616d 653d 6e2c 0a20 2020 2020     name=n,.     
+0000a0f0: 2020 2020 2020 206c 6f63 6b3d 6c6f 636b         lock=lock
+0000a100: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
+0000a110: 6769 6f6e 3d72 2c0a 2020 2020 2020 2020  gion=r,.        
+0000a120: 2020 2020 7265 7475 726e 5f73 746f 7265      return_store
+0000a130: 643d 7265 7475 726e 5f73 746f 7265 642c  d=return_stored,
+0000a140: 0a20 2020 2020 2020 2020 2020 206c 6f61  .            loa
+0000a150: 645f 7374 6f72 6564 3d6c 6f61 645f 7374  d_stored=load_st
+0000a160: 6f72 6564 2c0a 2020 2020 2020 2020 290a  ored,.        ).
+0000a170: 2020 2020 2020 2020 6c61 7965 7273 5b6e          layers[n
+0000a180: 5d20 3d20 6d61 705f 6c61 7965 720a 2020  ] = map_layer.  
+0000a190: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+0000a1a0: 6e63 6528 742c 2044 656c 6179 6564 293a  nce(t, Delayed):
+0000a1b0: 0a20 2020 2020 2020 2020 2020 2064 6570  .            dep
+0000a1c0: 656e 6465 6e63 6965 735b 6e5d 203d 207b  endencies[n] = {
+0000a1d0: 736f 7572 6365 735f 6e61 6d65 2c20 7461  sources_name, ta
+0000a1e0: 7267 6574 735f 6e61 6d65 7d0a 2020 2020  rgets_name}.    
+0000a1f0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000a200: 2020 2020 2020 6465 7065 6e64 656e 6369        dependenci
+0000a210: 6573 5b6e 5d20 3d20 7b73 6f75 7263 6573  es[n] = {sources
+0000a220: 5f6e 616d 657d 0a20 2020 2020 2020 206d  _name}.        m
+0000a230: 6170 5f6b 6579 7320 2b3d 206d 6170 5f6c  ap_keys += map_l
+0000a240: 6179 6572 2e6b 6579 7328 290a 0a20 2020  ayer.keys()..   
+0000a250: 2069 6620 7265 7475 726e 5f73 746f 7265   if return_store
+0000a260: 643a 0a20 2020 2020 2020 2073 746f 7265  d:.        store
+0000a270: 5f64 736b 203d 2048 6967 684c 6576 656c  _dsk = HighLevel
+0000a280: 4772 6170 6828 6c61 7965 7273 2c20 6465  Graph(layers, de
+0000a290: 7065 6e64 656e 6369 6573 290a 2020 2020  pendencies).    
+0000a2a0: 2020 2020 6c6f 6164 5f73 746f 7265 5f64      load_store_d
+0000a2b0: 736b 3a20 4869 6768 4c65 7665 6c47 7261  sk: HighLevelGra
+0000a2c0: 7068 207c 2064 6963 745b 7475 706c 652c  ph | dict[tuple,
+0000a2d0: 2041 6e79 5d20 3d20 7374 6f72 655f 6473   Any] = store_ds
+0000a2e0: 6b0a 2020 2020 2020 2020 6966 2063 6f6d  k.        if com
+0000a2f0: 7075 7465 3a0a 2020 2020 2020 2020 2020  pute:.          
+0000a300: 2020 7374 6f72 655f 646c 7964 7320 3d20    store_dlyds = 
+0000a310: 5b44 656c 6179 6564 286b 2c20 7374 6f72  [Delayed(k, stor
+0000a320: 655f 6473 6b2c 206c 6179 6572 3d6b 5b30  e_dsk, layer=k[0
+0000a330: 5d29 2066 6f72 206b 2069 6e20 6d61 705f  ]) for k in map_
+0000a340: 6b65 7973 5d0a 2020 2020 2020 2020 2020  keys].          
+0000a350: 2020 7374 6f72 655f 646c 7964 7320 3d20    store_dlyds = 
+0000a360: 7065 7273 6973 7428 2a73 746f 7265 5f64  persist(*store_d
+0000a370: 6c79 6473 2c20 2a2a 6b77 6172 6773 290a  lyds, **kwargs).
+0000a380: 2020 2020 2020 2020 2020 2020 7374 6f72              stor
+0000a390: 655f 6473 6b5f 3220 3d20 4869 6768 4c65  e_dsk_2 = HighLe
+0000a3a0: 7665 6c47 7261 7068 2e6d 6572 6765 282a  velGraph.merge(*
+0000a3b0: 5b65 2e64 6173 6b20 666f 7220 6520 696e  [e.dask for e in
+0000a3c0: 2073 746f 7265 5f64 6c79 6473 5d29 0a20   store_dlyds]). 
+0000a3d0: 2020 2020 2020 2020 2020 206c 6f61 645f             load_
+0000a3e0: 7374 6f72 655f 6473 6b20 3d20 7265 7472  store_dsk = retr
+0000a3f0: 6965 7665 5f66 726f 6d5f 6f6f 6328 6d61  ieve_from_ooc(ma
+0000a400: 705f 6b65 7973 2c20 7374 6f72 655f 6473  p_keys, store_ds
+0000a410: 6b2c 2073 746f 7265 5f64 736b 5f32 290a  k, store_dsk_2).
+0000a420: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+0000a430: 6e61 6d65 7320 3d20 5b22 6c6f 6164 2d22  names = ["load-"
+0000a440: 202b 206e 2066 6f72 206e 2069 6e20 6d61   + n for n in ma
+0000a450: 705f 6e61 6d65 735d 0a0a 2020 2020 2020  p_names]..      
+0000a460: 2020 7265 7475 726e 2074 7570 6c65 280a    return tuple(.
+0000a470: 2020 2020 2020 2020 2020 2020 4172 7261              Arra
+0000a480: 7928 6c6f 6164 5f73 746f 7265 5f64 736b  y(load_store_dsk
+0000a490: 2c20 6e2c 2073 2e63 6875 6e6b 732c 206d  , n, s.chunks, m
+0000a4a0: 6574 613d 7329 0a20 2020 2020 2020 2020  eta=s).         
+0000a4b0: 2020 2066 6f72 2073 2c20 6e20 696e 207a     for s, n in z
+0000a4c0: 6970 2873 6f75 7263 6573 2c20 6d61 705f  ip(sources, map_
+0000a4d0: 6e61 6d65 7329 0a20 2020 2020 2020 2029  names).        )
+0000a4e0: 0a0a 2020 2020 656c 6966 2063 6f6d 7075  ..    elif compu
+0000a4f0: 7465 3a0a 2020 2020 2020 2020 7374 6f72  te:.        stor
+0000a500: 655f 6473 6b20 3d20 4869 6768 4c65 7665  e_dsk = HighLeve
+0000a510: 6c47 7261 7068 286c 6179 6572 732c 2064  lGraph(layers, d
+0000a520: 6570 656e 6465 6e63 6965 7329 0a20 2020  ependencies).   
+0000a530: 2020 2020 2063 6f6d 7075 7465 5f61 735f       compute_as_
+0000a540: 6966 5f63 6f6c 6c65 6374 696f 6e28 4172  if_collection(Ar
+0000a550: 7261 792c 2073 746f 7265 5f64 736b 2c20  ray, store_dsk, 
+0000a560: 6d61 705f 6b65 7973 2c20 2a2a 6b77 6172  map_keys, **kwar
+0000a570: 6773 290a 2020 2020 2020 2020 7265 7475  gs).        retu
+0000a580: 726e 204e 6f6e 650a 0a20 2020 2065 6c73  rn None..    els
+0000a590: 653a 0a20 2020 2020 2020 206b 6579 203d  e:.        key =
+0000a5a0: 2022 7374 6f72 652d 2220 2b20 746f 6b65   "store-" + toke
+0000a5b0: 6e69 7a65 286d 6170 5f6e 616d 6573 290a  nize(map_names).
+0000a5c0: 2020 2020 2020 2020 6c61 7965 7273 5b6b          layers[k
+0000a5d0: 6579 5d20 3d20 7b6b 6579 3a20 6d61 705f  ey] = {key: map_
+0000a5e0: 6b65 7973 7d0a 2020 2020 2020 2020 6465  keys}.        de
+0000a5f0: 7065 6e64 656e 6369 6573 5b6b 6579 5d20  pendencies[key] 
+0000a600: 3d20 7365 7428 6d61 705f 6e61 6d65 7329  = set(map_names)
+0000a610: 0a20 2020 2020 2020 2073 746f 7265 5f64  .        store_d
+0000a620: 736b 203d 2048 6967 684c 6576 656c 4772  sk = HighLevelGr
+0000a630: 6170 6828 6c61 7965 7273 2c20 6465 7065  aph(layers, depe
+0000a640: 6e64 656e 6369 6573 290a 2020 2020 2020  ndencies).      
+0000a650: 2020 7265 7475 726e 2044 656c 6179 6564    return Delayed
+0000a660: 286b 6579 2c20 7374 6f72 655f 6473 6b29  (key, store_dsk)
+0000a670: 0a0a 0a64 6566 2062 6c6f 636b 6469 6d73  ...def blockdims
+0000a680: 5f66 726f 6d5f 626c 6f63 6b73 6861 7065  _from_blockshape
+0000a690: 2873 6861 7065 2c20 6368 756e 6b73 293a  (shape, chunks):
+0000a6a0: 0a20 2020 2022 2222 0a0a 2020 2020 3e3e  .    """..    >>
+0000a6b0: 3e20 626c 6f63 6b64 696d 735f 6672 6f6d  > blockdims_from
+0000a6c0: 5f62 6c6f 636b 7368 6170 6528 2831 302c  _blockshape((10,
+0000a6d0: 2031 3029 2c20 2834 2c20 3329 290a 2020   10), (4, 3)).  
+0000a6e0: 2020 2828 342c 2034 2c20 3229 2c20 2833    ((4, 4, 2), (3
+0000a6f0: 2c20 332c 2033 2c20 3129 290a 2020 2020  , 3, 3, 1)).    
+0000a700: 3e3e 3e20 626c 6f63 6b64 696d 735f 6672  >>> blockdims_fr
+0000a710: 6f6d 5f62 6c6f 636b 7368 6170 6528 2831  om_blockshape((1
+0000a720: 302c 2030 292c 2028 342c 2030 2929 0a20  0, 0), (4, 0)). 
+0000a730: 2020 2028 2834 2c20 342c 2032 292c 2028     ((4, 4, 2), (
+0000a740: 302c 2929 0a20 2020 2022 2222 0a20 2020  0,)).    """.   
+0000a750: 2069 6620 6368 756e 6b73 2069 7320 4e6f   if chunks is No
+0000a760: 6e65 3a0a 2020 2020 2020 2020 7261 6973  ne:.        rais
+0000a770: 6520 5479 7065 4572 726f 7228 224d 7573  e TypeError("Mus
+0000a780: 7420 7375 7070 6c79 2063 6875 6e6b 733d  t supply chunks=
+0000a790: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+0000a7a0: 7422 290a 2020 2020 6966 2073 6861 7065  t").    if shape
+0000a7b0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000a7c0: 2020 7261 6973 6520 5479 7065 4572 726f    raise TypeErro
+0000a7d0: 7228 224d 7573 7420 7375 7070 6c79 2073  r("Must supply s
+0000a7e0: 6861 7065 3d20 6b65 7977 6f72 6420 6172  hape= keyword ar
+0000a7f0: 6775 6d65 6e74 2229 0a20 2020 2069 6620  gument").    if 
+0000a800: 6e70 2e69 736e 616e 2873 756d 2873 6861  np.isnan(sum(sha
+0000a810: 7065 2929 206f 7220 6e70 2e69 736e 616e  pe)) or np.isnan
+0000a820: 2873 756d 2863 6875 6e6b 7329 293a 0a20  (sum(chunks)):. 
+0000a830: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+0000a840: 7565 4572 726f 7228 0a20 2020 2020 2020  ueError(.       
+0000a850: 2020 2020 2022 4172 7261 7920 6368 756e       "Array chun
+0000a860: 6b20 7369 7a65 7320 6172 6520 756e 6b6e  k sizes are unkn
+0000a870: 6f77 6e2e 2073 6861 7065 3a20 2573 2c20  own. shape: %s, 
+0000a880: 6368 756e 6b73 3a20 2573 2573 220a 2020  chunks: %s%s".  
+0000a890: 2020 2020 2020 2020 2020 2520 2873 6861            % (sha
+0000a8a0: 7065 2c20 6368 756e 6b73 2c20 756e 6b6e  pe, chunks, unkn
+0000a8b0: 6f77 6e5f 6368 756e 6b5f 6d65 7373 6167  own_chunk_messag
+0000a8c0: 6529 0a20 2020 2020 2020 2029 0a20 2020  e).        ).   
+0000a8d0: 2069 6620 6e6f 7420 616c 6c28 6d61 7028   if not all(map(
+0000a8e0: 6973 5f69 6e74 6567 6572 2c20 6368 756e  is_integer, chun
+0000a8f0: 6b73 2929 3a0a 2020 2020 2020 2020 7261  ks)):.        ra
+0000a900: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+0000a910: 6368 756e 6b73 2063 616e 206f 6e6c 7920  chunks can only 
+0000a920: 636f 6e74 6169 6e20 696e 7465 6765 7273  contain integers
+0000a930: 2e22 290a 2020 2020 6966 206e 6f74 2061  .").    if not a
+0000a940: 6c6c 286d 6170 2869 735f 696e 7465 6765  ll(map(is_intege
+0000a950: 722c 2073 6861 7065 2929 3a0a 2020 2020  r, shape)):.    
+0000a960: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0000a970: 7272 6f72 2822 7368 6170 6520 6361 6e20  rror("shape can 
+0000a980: 6f6e 6c79 2063 6f6e 7461 696e 2069 6e74  only contain int
+0000a990: 6567 6572 732e 2229 0a20 2020 2073 6861  egers.").    sha
+0000a9a0: 7065 203d 2074 7570 6c65 286d 6170 2869  pe = tuple(map(i
+0000a9b0: 6e74 2c20 7368 6170 6529 290a 2020 2020  nt, shape)).    
+0000a9c0: 6368 756e 6b73 203d 2074 7570 6c65 286d  chunks = tuple(m
+0000a9d0: 6170 2869 6e74 2c20 6368 756e 6b73 2929  ap(int, chunks))
+0000a9e0: 0a20 2020 2072 6574 7572 6e20 7475 706c  .    return tupl
+0000a9f0: 6528 0a20 2020 2020 2020 2028 2862 642c  e(.        ((bd,
+0000aa00: 2920 2a20 2864 202f 2f20 6264 2920 2b20  ) * (d // bd) + 
+0000aa10: 2828 6420 2520 6264 2c29 2069 6620 6420  ((d % bd,) if d 
+0000aa20: 2520 6264 2065 6c73 6520 2829 2920 6966  % bd else ()) if
+0000aa30: 2064 2065 6c73 6520 2830 2c29 290a 2020   d else (0,)).  
+0000aa40: 2020 2020 2020 666f 7220 642c 2062 6420        for d, bd 
+0000aa50: 696e 207a 6970 2873 6861 7065 2c20 6368  in zip(shape, ch
+0000aa60: 756e 6b73 290a 2020 2020 290a 0a0a 6465  unks).    )...de
+0000aa70: 6620 6669 6e61 6c69 7a65 2872 6573 756c  f finalize(resul
+0000aa80: 7473 293a 0a20 2020 2069 6620 6e6f 7420  ts):.    if not 
+0000aa90: 7265 7375 6c74 733a 0a20 2020 2020 2020  results:.       
+0000aaa0: 2072 6574 7572 6e20 636f 6e63 6174 656e   return concaten
+0000aab0: 6174 6533 2872 6573 756c 7473 290a 2020  ate3(results).  
+0000aac0: 2020 7265 7375 6c74 7332 203d 2072 6573    results2 = res
+0000aad0: 756c 7473 0a20 2020 2077 6869 6c65 2069  ults.    while i
+0000aae0: 7369 6e73 7461 6e63 6528 7265 7375 6c74  sinstance(result
+0000aaf0: 7332 2c20 2874 7570 6c65 2c20 6c69 7374  s2, (tuple, list
+0000ab00: 2929 3a0a 2020 2020 2020 2020 6966 206c  )):.        if l
+0000ab10: 656e 2872 6573 756c 7473 3229 203e 2031  en(results2) > 1
+0000ab20: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+0000ab30: 7475 726e 2063 6f6e 6361 7465 6e61 7465  turn concatenate
+0000ab40: 3328 7265 7375 6c74 7329 0a20 2020 2020  3(results).     
+0000ab50: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000ab60: 2020 2020 2072 6573 756c 7473 3220 3d20       results2 = 
+0000ab70: 7265 7375 6c74 7332 5b30 5d0a 2020 2020  results2[0].    
+0000ab80: 7265 7475 726e 2075 6e70 6163 6b5f 7369  return unpack_si
+0000ab90: 6e67 6c65 746f 6e28 7265 7375 6c74 7329  ngleton(results)
+0000aba0: 0a0a 0a43 4855 4e4b 535f 4e4f 4e45 5f45  ...CHUNKS_NONE_E
+0000abb0: 5252 4f52 5f4d 4553 5341 4745 203d 2022  RROR_MESSAGE = "
+0000abc0: 2222 0a59 6f75 206d 7573 7420 7370 6563  "".You must spec
+0000abd0: 6966 7920 6120 6368 756e 6b73 3d20 6b65  ify a chunks= ke
+0000abe0: 7977 6f72 6420 6172 6775 6d65 6e74 2e0a  yword argument..
+0000abf0: 5468 6973 2073 7065 6369 6669 6573 2074  This specifies t
+0000ac00: 6865 2063 6875 6e6b 7369 7a65 206f 6620  he chunksize of 
+0000ac10: 796f 7572 2061 7272 6179 2062 6c6f 636b  your array block
+0000ac20: 732e 0a0a 5365 6520 7468 6520 666f 6c6c  s...See the foll
+0000ac30: 6f77 696e 6720 646f 6375 6d65 6e74 6174  owing documentat
+0000ac40: 696f 6e20 7061 6765 2066 6f72 2064 6574  ion page for det
+0000ac50: 6169 6c73 3a0a 2020 6874 7470 733a 2f2f  ails:.  https://
+0000ac60: 646f 6373 2e64 6173 6b2e 6f72 672f 656e  docs.dask.org/en
+0000ac70: 2f6c 6174 6573 742f 6172 7261 792d 6372  /latest/array-cr
+0000ac80: 6561 7469 6f6e 2e68 746d 6c23 6368 756e  eation.html#chun
+0000ac90: 6b73 0a22 2222 2e73 7472 6970 2829 0a0a  ks.""".strip()..
+0000aca0: 0a63 6c61 7373 2041 7272 6179 2844 6173  .class Array(Das
+0000acb0: 6b4d 6574 686f 6473 4d69 7869 6e29 3a0a  kMethodsMixin):.
+0000acc0: 2020 2020 2222 2250 6172 616c 6c65 6c20      """Parallel 
+0000acd0: 4461 736b 2041 7272 6179 0a0a 2020 2020  Dask Array..    
+0000ace0: 4120 7061 7261 6c6c 656c 206e 642d 6172  A parallel nd-ar
+0000acf0: 7261 7920 636f 6d70 7269 7365 6420 6f66  ray comprised of
+0000ad00: 206d 616e 7920 6e75 6d70 7920 6172 7261   many numpy arra
+0000ad10: 7973 2061 7272 616e 6765 6420 696e 2061  ys arranged in a
+0000ad20: 2067 7269 642e 0a0a 2020 2020 5468 6973   grid...    This
+0000ad30: 2063 6f6e 7374 7275 6374 6f72 2069 7320   constructor is 
+0000ad40: 666f 7220 6164 7661 6e63 6564 2075 7365  for advanced use
+0000ad50: 7320 6f6e 6c79 2e20 2046 6f72 206e 6f72  s only.  For nor
+0000ad60: 6d61 6c20 7573 6520 7365 6520 7468 650a  mal use see the.
+0000ad70: 2020 2020 3a66 756e 633a 6064 6173 6b2e      :func:`dask.
+0000ad80: 6172 7261 792e 6672 6f6d 5f61 7272 6179  array.from_array
+0000ad90: 6020 6675 6e63 7469 6f6e 2e0a 0a20 2020  ` function...   
+0000ada0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
+0000adb0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064  ----------.    d
+0000adc0: 6173 6b20 3a20 6469 6374 0a20 2020 2020  ask : dict.     
+0000add0: 2020 2054 6173 6b20 6465 7065 6e64 656e     Task dependen
+0000ade0: 6379 2067 7261 7068 0a20 2020 206e 616d  cy graph.    nam
+0000adf0: 6520 3a20 7374 7269 6e67 0a20 2020 2020  e : string.     
+0000ae00: 2020 204e 616d 6520 6f66 2061 7272 6179     Name of array
+0000ae10: 2069 6e20 6461 736b 0a20 2020 2073 6861   in dask.    sha
+0000ae20: 7065 203a 2074 7570 6c65 206f 6620 696e  pe : tuple of in
+0000ae30: 7473 0a20 2020 2020 2020 2053 6861 7065  ts.        Shape
+0000ae40: 206f 6620 7468 6520 656e 7469 7265 2061   of the entire a
+0000ae50: 7272 6179 0a20 2020 2063 6875 6e6b 733a  rray.    chunks:
+0000ae60: 2069 7465 7261 626c 6520 6f66 2074 7570   iterable of tup
+0000ae70: 6c65 730a 2020 2020 2020 2020 626c 6f63  les.        bloc
+0000ae80: 6b20 7369 7a65 7320 616c 6f6e 6720 6561  k sizes along ea
+0000ae90: 6368 2064 696d 656e 7369 6f6e 0a20 2020  ch dimension.   
+0000aea0: 2064 7479 7065 203a 2073 7472 206f 7220   dtype : str or 
+0000aeb0: 6474 7970 650a 2020 2020 2020 2020 5479  dtype.        Ty
+0000aec0: 7065 636f 6465 206f 7220 6461 7461 2d74  pecode or data-t
+0000aed0: 7970 6520 666f 7220 7468 6520 6e65 7720  ype for the new 
+0000aee0: 4461 736b 2041 7272 6179 0a20 2020 206d  Dask Array.    m
+0000aef0: 6574 6120 3a20 656d 7074 7920 6e64 6172  eta : empty ndar
+0000af00: 7261 790a 2020 2020 2020 2020 656d 7074  ray.        empt
+0000af10: 7920 6e64 6172 7261 7920 6372 6561 7465  y ndarray create
+0000af20: 6420 7769 7468 2073 616d 6520 4e75 6d50  d with same NumP
+0000af30: 7920 6261 636b 656e 642c 206e 6469 6d20  y backend, ndim 
+0000af40: 616e 6420 6474 7970 6520 6173 2074 6865  and dtype as the
+0000af50: 0a20 2020 2020 2020 2044 6173 6b20 4172  .        Dask Ar
+0000af60: 7261 7920 6265 696e 6720 6372 6561 7465  ray being create
+0000af70: 6420 286f 7665 7272 6964 6573 2064 7479  d (overrides dty
+0000af80: 7065 290a 0a20 2020 2053 6565 2041 6c73  pe)..    See Als
+0000af90: 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  o.    --------. 
+0000afa0: 2020 2064 6173 6b2e 6172 7261 792e 6672     dask.array.fr
+0000afb0: 6f6d 5f61 7272 6179 0a20 2020 2022 2222  om_array.    """
+0000afc0: 0a0a 2020 2020 5f5f 736c 6f74 735f 5f20  ..    __slots__ 
+0000afd0: 3d20 2264 6173 6b22 2c20 225f 5f6e 616d  = "dask", "__nam
+0000afe0: 6522 2c20 225f 6361 6368 6564 5f6b 6579  e", "_cached_key
+0000aff0: 7322 2c20 225f 5f63 6875 6e6b 7322 2c20  s", "__chunks", 
+0000b000: 225f 6d65 7461 222c 2022 5f5f 6469 6374  "_meta", "__dict
+0000b010: 5f5f 220a 0a20 2020 2064 6566 205f 5f6e  __"..    def __n
+0000b020: 6577 5f5f 2863 6c73 2c20 6461 736b 2c20  ew__(cls, dask, 
+0000b030: 6e61 6d65 2c20 6368 756e 6b73 2c20 6474  name, chunks, dt
+0000b040: 7970 653d 4e6f 6e65 2c20 6d65 7461 3d4e  ype=None, meta=N
+0000b050: 6f6e 652c 2073 6861 7065 3d4e 6f6e 6529  one, shape=None)
+0000b060: 3a0a 2020 2020 2020 2020 7365 6c66 203d  :.        self =
+0000b070: 2073 7570 6572 2829 2e5f 5f6e 6577 5f5f   super().__new__
+0000b080: 2863 6c73 290a 2020 2020 2020 2020 6173  (cls).        as
+0000b090: 7365 7274 2069 7369 6e73 7461 6e63 6528  sert isinstance(
+0000b0a0: 6461 736b 2c20 4d61 7070 696e 6729 0a20  dask, Mapping). 
+0000b0b0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000b0c0: 696e 7374 616e 6365 2864 6173 6b2c 2048  instance(dask, H
+0000b0d0: 6967 684c 6576 656c 4772 6170 6829 3a0a  ighLevelGraph):.
+0000b0e0: 2020 2020 2020 2020 2020 2020 6461 736b              dask
+0000b0f0: 203d 2048 6967 684c 6576 656c 4772 6170   = HighLevelGrap
+0000b100: 682e 6672 6f6d 5f63 6f6c 6c65 6374 696f  h.from_collectio
+0000b110: 6e73 286e 616d 652c 2064 6173 6b2c 2064  ns(name, dask, d
+0000b120: 6570 656e 6465 6e63 6965 733d 2829 290a  ependencies=()).
+0000b130: 2020 2020 2020 2020 7365 6c66 2e64 6173          self.das
+0000b140: 6b20 3d20 6461 736b 0a20 2020 2020 2020  k = dask.       
+0000b150: 2073 656c 662e 5f6e 616d 6520 3d20 7374   self._name = st
+0000b160: 7228 6e61 6d65 290a 2020 2020 2020 2020  r(name).        
+0000b170: 6d65 7461 203d 206d 6574 615f 6672 6f6d  meta = meta_from
+0000b180: 5f61 7272 6179 286d 6574 612c 2064 7479  _array(meta, dty
+0000b190: 7065 3d64 7479 7065 290a 0a20 2020 2020  pe=dtype)..     
+0000b1a0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
+0000b1b0: 2020 2020 6973 696e 7374 616e 6365 2863      isinstance(c
+0000b1c0: 6875 6e6b 732c 2073 7472 290a 2020 2020  hunks, str).    
+0000b1d0: 2020 2020 2020 2020 6f72 2069 7369 6e73          or isins
+0000b1e0: 7461 6e63 6528 6368 756e 6b73 2c20 7475  tance(chunks, tu
+0000b1f0: 706c 6529 0a20 2020 2020 2020 2020 2020  ple).           
+0000b200: 2061 6e64 2063 6875 6e6b 730a 2020 2020   and chunks.    
+0000b210: 2020 2020 2020 2020 616e 6420 616e 7928          and any(
+0000b220: 6973 696e 7374 616e 6365 2863 2c20 7374  isinstance(c, st
+0000b230: 7229 2066 6f72 2063 2069 6e20 6368 756e  r) for c in chun
+0000b240: 6b73 290a 2020 2020 2020 2020 293a 0a20  ks).        ):. 
+0000b250: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
+0000b260: 6d65 7461 2e64 7479 7065 0a20 2020 2020  meta.dtype.     
+0000b270: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000b280: 2020 2020 2064 7420 3d20 4e6f 6e65 0a20       dt = None. 
+0000b290: 2020 2020 2020 2073 656c 662e 5f63 6875         self._chu
+0000b2a0: 6e6b 7320 3d20 6e6f 726d 616c 697a 655f  nks = normalize_
+0000b2b0: 6368 756e 6b73 2863 6875 6e6b 732c 2073  chunks(chunks, s
+0000b2c0: 6861 7065 2c20 6474 7970 653d 6474 290a  hape, dtype=dt).
+0000b2d0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+0000b2e0: 6368 756e 6b73 2069 7320 4e6f 6e65 3a0a  chunks is None:.
+0000b2f0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000b300: 6520 5661 6c75 6545 7272 6f72 2843 4855  e ValueError(CHU
+0000b310: 4e4b 535f 4e4f 4e45 5f45 5252 4f52 5f4d  NKS_NONE_ERROR_M
+0000b320: 4553 5341 4745 290a 2020 2020 2020 2020  ESSAGE).        
+0000b330: 7365 6c66 2e5f 6d65 7461 203d 206d 6574  self._meta = met
+0000b340: 615f 6672 6f6d 5f61 7272 6179 286d 6574  a_from_array(met
+0000b350: 612c 206e 6469 6d3d 7365 6c66 2e6e 6469  a, ndim=self.ndi
+0000b360: 6d2c 2064 7479 7065 3d64 7479 7065 290a  m, dtype=dtype).
+0000b370: 0a20 2020 2020 2020 2066 6f72 2070 6c75  .        for plu
+0000b380: 6769 6e20 696e 2063 6f6e 6669 672e 6765  gin in config.ge
+0000b390: 7428 2261 7272 6179 5f70 6c75 6769 6e73  t("array_plugins
+0000b3a0: 222c 2028 2929 3a0a 2020 2020 2020 2020  ", ()):.        
+0000b3b0: 2020 2020 7265 7375 6c74 203d 2070 6c75      result = plu
+0000b3c0: 6769 6e28 7365 6c66 290a 2020 2020 2020  gin(self).      
+0000b3d0: 2020 2020 2020 6966 2072 6573 756c 7420        if result 
+0000b3e0: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0000b3f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000b400: 6620 3d20 7265 7375 6c74 0a0a 2020 2020  f = result..    
+0000b410: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000b420: 2020 2020 206c 6179 6572 203d 2073 656c       layer = sel
+0000b430: 662e 6461 736b 2e6c 6179 6572 735b 6e61  f.dask.layers[na
+0000b440: 6d65 5d0a 2020 2020 2020 2020 6578 6365  me].        exce
+0000b450: 7074 2028 4174 7472 6962 7574 6545 7272  pt (AttributeErr
+0000b460: 6f72 2c20 4b65 7945 7272 6f72 293a 0a20  or, KeyError):. 
+0000b470: 2020 2020 2020 2020 2020 2023 2073 656c             # sel
+0000b480: 6620 6973 206e 6f20 6c6f 6e67 6572 2061  f is no longer a
+0000b490: 6e20 4172 7261 7920 6166 7465 7220 6170  n Array after ap
+0000b4a0: 706c 7969 6e67 2074 6865 2070 6c75 6769  plying the plugi
+0000b4b0: 6e73 2c20 4f52 0a20 2020 2020 2020 2020  ns, OR.         
+0000b4c0: 2020 2023 2061 2070 6c75 6769 6e20 7265     # a plugin re
+0000b4d0: 706c 6163 6564 2074 6865 2048 6967 684c  placed the HighL
+0000b4e0: 6576 656c 4772 6170 6820 7769 7468 2061  evelGraph with a
+0000b4f0: 2070 6c61 696e 2064 6963 742c 204f 520a   plain dict, OR.
+0000b500: 2020 2020 2020 2020 2020 2020 2320 6e61              # na
+0000b510: 6d65 2069 7320 6e6f 7420 7468 6520 746f  me is not the to
+0000b520: 7020 6c61 7965 7227 7320 6e61 6d65 2028  p layer's name (
+0000b530: 7468 6973 2063 616e 2068 6170 7065 6e20  this can happen 
+0000b540: 6166 7465 7220 7468 6520 6c61 7965 7220  after the layer 
+0000b550: 6973 0a20 2020 2020 2020 2020 2020 2023  is.            #
+0000b560: 206d 616e 6970 756c 6174 6564 2c20 746f   manipulated, to
+0000b570: 2061 766f 6964 2061 2063 6f6c 6c69 7369   avoid a collisi
+0000b580: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
+0000b590: 7061 7373 0a20 2020 2020 2020 2065 6c73  pass.        els
+0000b5a0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
+0000b5b0: 6620 6c61 7965 722e 636f 6c6c 6563 7469  f layer.collecti
+0000b5c0: 6f6e 5f61 6e6e 6f74 6174 696f 6e73 2069  on_annotations i
+0000b5d0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+0000b5e0: 2020 2020 2020 2020 6c61 7965 722e 636f          layer.co
+0000b5f0: 6c6c 6563 7469 6f6e 5f61 6e6e 6f74 6174  llection_annotat
+0000b600: 696f 6e73 203d 207b 0a20 2020 2020 2020  ions = {.       
+0000b610: 2020 2020 2020 2020 2020 2020 2022 7368               "sh
+0000b620: 6170 6522 3a20 7365 6c66 2e73 6861 7065  ape": self.shape
+0000b630: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000b640: 2020 2020 2020 2264 7479 7065 223a 2073        "dtype": s
+0000b650: 656c 662e 6474 7970 652c 0a20 2020 2020  elf.dtype,.     
+0000b660: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000b670: 6368 756e 6b73 697a 6522 3a20 7365 6c66  chunksize": self
+0000b680: 2e63 6875 6e6b 7369 7a65 2c0a 2020 2020  .chunksize,.    
+0000b690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b6a0: 2263 6875 6e6b 7322 3a20 7365 6c66 2e63  "chunks": self.c
+0000b6b0: 6875 6e6b 732c 0a20 2020 2020 2020 2020  hunks,.         
+0000b6c0: 2020 2020 2020 2020 2020 2022 7479 7065             "type
+0000b6d0: 223a 2074 7970 656e 616d 6528 7479 7065  ": typename(type
+0000b6e0: 2873 656c 6629 292c 0a20 2020 2020 2020  (self)),.       
+0000b6f0: 2020 2020 2020 2020 2020 2020 2022 6368               "ch
+0000b700: 756e 6b5f 7479 7065 223a 2074 7970 656e  unk_type": typen
+0000b710: 616d 6528 7479 7065 2873 656c 662e 5f6d  ame(type(self._m
+0000b720: 6574 6129 292c 0a20 2020 2020 2020 2020  eta)),.         
+0000b730: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000b740: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000b750: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+0000b760: 2e63 6f6c 6c65 6374 696f 6e5f 616e 6e6f  .collection_anno
+0000b770: 7461 7469 6f6e 732e 7570 6461 7465 280a  tations.update(.
+0000b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b790: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+0000b7a0: 2020 2020 2020 2020 2020 2020 2020 2273                "s
+0000b7b0: 6861 7065 223a 2073 656c 662e 7368 6170  hape": self.shap
+0000b7c0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+0000b7d0: 2020 2020 2020 2020 2020 2022 6474 7970             "dtyp
+0000b7e0: 6522 3a20 7365 6c66 2e64 7479 7065 2c0a  e": self.dtype,.
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b800: 2020 2020 2020 2020 2263 6875 6e6b 7369          "chunksi
+0000b810: 7a65 223a 2073 656c 662e 6368 756e 6b73  ze": self.chunks
+0000b820: 697a 652c 0a20 2020 2020 2020 2020 2020  ize,.           
+0000b830: 2020 2020 2020 2020 2020 2020 2022 6368               "ch
+0000b840: 756e 6b73 223a 2073 656c 662e 6368 756e  unks": self.chun
+0000b850: 6b73 2c0a 2020 2020 2020 2020 2020 2020  ks,.            
+0000b860: 2020 2020 2020 2020 2020 2020 2274 7970              "typ
+0000b870: 6522 3a20 7479 7065 6e61 6d65 2874 7970  e": typename(typ
+0000b880: 6528 7365 6c66 2929 2c0a 2020 2020 2020  e(self)),.      
+0000b890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8a0: 2020 2263 6875 6e6b 5f74 7970 6522 3a20    "chunk_type": 
+0000b8b0: 7479 7065 6e61 6d65 2874 7970 6528 7365  typename(type(se
+0000b8c0: 6c66 2e5f 6d65 7461 2929 2c0a 2020 2020  lf._meta)),.    
+0000b8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8e0: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0000b8f0: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
+0000b900: 7572 6e20 7365 6c66 0a0a 2020 2020 6465  urn self..    de
+0000b910: 6620 5f5f 7265 6475 6365 5f5f 2873 656c  f __reduce__(sel
+0000b920: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0000b930: 726e 2028 4172 7261 792c 2028 7365 6c66  rn (Array, (self
+0000b940: 2e64 6173 6b2c 2073 656c 662e 6e61 6d65  .dask, self.name
+0000b950: 2c20 7365 6c66 2e63 6875 6e6b 732c 2073  , self.chunks, s
+0000b960: 656c 662e 6474 7970 652c 2073 656c 662e  elf.dtype, self.
+0000b970: 5f6d 6574 6129 290a 0a20 2020 2064 6566  _meta))..    def
+0000b980: 205f 5f64 6173 6b5f 6772 6170 685f 5f28   __dask_graph__(
+0000b990: 7365 6c66 2920 2d3e 2047 7261 7068 3a0a  self) -> Graph:.
+0000b9a0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000b9b0: 656c 662e 6461 736b 0a0a 2020 2020 6465  elf.dask..    de
+0000b9c0: 6620 5f5f 6461 736b 5f6c 6179 6572 735f  f __dask_layers_
+0000b9d0: 5f28 7365 6c66 2920 2d3e 2053 6571 7565  _(self) -> Seque
+0000b9e0: 6e63 655b 7374 725d 3a0a 2020 2020 2020  nce[str]:.      
+0000b9f0: 2020 7265 7475 726e 2028 7365 6c66 2e6e    return (self.n
+0000ba00: 616d 652c 290a 0a20 2020 2064 6566 205f  ame,)..    def _
+0000ba10: 5f64 6173 6b5f 6b65 7973 5f5f 2873 656c  _dask_keys__(sel
+0000ba20: 6629 202d 3e20 4e65 7374 6564 4b65 7973  f) -> NestedKeys
+0000ba30: 3a0a 2020 2020 2020 2020 6966 2073 656c  :.        if sel
+0000ba40: 662e 5f63 6163 6865 645f 6b65 7973 2069  f._cached_keys i
+0000ba50: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0000ba60: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000ba70: 656c 662e 5f63 6163 6865 645f 6b65 7973  elf._cached_keys
+0000ba80: 0a0a 2020 2020 2020 2020 6e61 6d65 2c20  ..        name, 
+0000ba90: 6368 756e 6b73 2c20 6e75 6d62 6c6f 636b  chunks, numblock
+0000baa0: 7320 3d20 7365 6c66 2e6e 616d 652c 2073  s = self.name, s
+0000bab0: 656c 662e 6368 756e 6b73 2c20 7365 6c66  elf.chunks, self
+0000bac0: 2e6e 756d 626c 6f63 6b73 0a0a 2020 2020  .numblocks..    
+0000bad0: 2020 2020 6465 6620 6b65 7973 282a 6172      def keys(*ar
+0000bae0: 6773 293a 0a20 2020 2020 2020 2020 2020  gs):.           
+0000baf0: 2069 6620 6e6f 7420 6368 756e 6b73 3a0a   if not chunks:.
+0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb10: 7265 7475 726e 205b 286e 616d 652c 295d  return [(name,)]
+0000bb20: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0000bb30: 203d 206c 656e 2861 7267 7329 0a20 2020   = len(args).   
+0000bb40: 2020 2020 2020 2020 2069 6620 696e 6420           if ind 
+0000bb50: 2b20 3120 3d3d 206c 656e 286e 756d 626c  + 1 == len(numbl
+0000bb60: 6f63 6b73 293a 0a20 2020 2020 2020 2020  ocks):.         
+0000bb70: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+0000bb80: 5b28 6e61 6d65 2c29 202b 2061 7267 7320  [(name,) + args 
+0000bb90: 2b20 2869 2c29 2066 6f72 2069 2069 6e20  + (i,) for i in 
+0000bba0: 7261 6e67 6528 6e75 6d62 6c6f 636b 735b  range(numblocks[
+0000bbb0: 696e 645d 295d 0a20 2020 2020 2020 2020  ind])].         
+0000bbc0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000bbd0: 2020 2020 2020 2020 2072 6573 756c 7420           result 
+0000bbe0: 3d20 5b6b 6579 7328 2a28 6172 6773 202b  = [keys(*(args +
+0000bbf0: 2028 692c 2929 2920 666f 7220 6920 696e   (i,))) for i in
+0000bc00: 2072 616e 6765 286e 756d 626c 6f63 6b73   range(numblocks
+0000bc10: 5b69 6e64 5d29 5d0a 2020 2020 2020 2020  [ind])].        
+0000bc20: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+0000bc30: 740a 0a20 2020 2020 2020 2073 656c 662e  t..        self.
+0000bc40: 5f63 6163 6865 645f 6b65 7973 203d 2072  _cached_keys = r
+0000bc50: 6573 756c 7420 3d20 6b65 7973 2829 0a20  esult = keys(). 
+0000bc60: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000bc70: 7375 6c74 0a0a 2020 2020 6465 6620 5f5f  sult..    def __
+0000bc80: 6461 736b 5f74 6f6b 656e 697a 655f 5f28  dask_tokenize__(
+0000bc90: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0000bca0: 6574 7572 6e20 7365 6c66 2e6e 616d 650a  eturn self.name.
+0000bcb0: 0a20 2020 205f 5f64 6173 6b5f 6f70 7469  .    __dask_opti
+0000bcc0: 6d69 7a65 5f5f 203d 2067 6c6f 6261 6c6d  mize__ = globalm
+0000bcd0: 6574 686f 6428 0a20 2020 2020 2020 206f  ethod(.        o
+0000bce0: 7074 696d 697a 652c 206b 6579 3d22 6172  ptimize, key="ar
+0000bcf0: 7261 795f 6f70 7469 6d69 7a65 222c 2066  ray_optimize", f
+0000bd00: 616c 7365 793d 646f 6e74 5f6f 7074 696d  alsey=dont_optim
+0000bd10: 697a 650a 2020 2020 290a 2020 2020 5f5f  ize.    ).    __
+0000bd20: 6461 736b 5f73 6368 6564 756c 6572 5f5f  dask_scheduler__
+0000bd30: 203d 2073 7461 7469 636d 6574 686f 6428   = staticmethod(
+0000bd40: 4445 4641 554c 545f 4745 5429 0a0a 2020  DEFAULT_GET)..  
+0000bd50: 2020 6465 6620 5f5f 6461 736b 5f70 6f73    def __dask_pos
+0000bd60: 7463 6f6d 7075 7465 5f5f 2873 656c 6629  tcompute__(self)
+0000bd70: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000bd80: 2066 696e 616c 697a 652c 2028 290a 0a20   finalize, ().. 
+0000bd90: 2020 2064 6566 205f 5f64 6173 6b5f 706f     def __dask_po
+0000bda0: 7374 7065 7273 6973 745f 5f28 7365 6c66  stpersist__(self
+0000bdb0: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0000bdc0: 6e20 7365 6c66 2e5f 7265 6275 696c 642c  n self._rebuild,
+0000bdd0: 2028 290a 0a20 2020 2064 6566 205f 7265   ()..    def _re
+0000bde0: 6275 696c 6428 7365 6c66 2c20 6473 6b2c  build(self, dsk,
+0000bdf0: 202a 2c20 7265 6e61 6d65 3d4e 6f6e 6529   *, rename=None)
+0000be00: 3a0a 2020 2020 2020 2020 6e61 6d65 203d  :.        name =
+0000be10: 2073 656c 662e 5f6e 616d 650a 2020 2020   self._name.    
+0000be20: 2020 2020 6966 2072 656e 616d 653a 0a20      if rename:. 
+0000be30: 2020 2020 2020 2020 2020 206e 616d 6520             name 
+0000be40: 3d20 7265 6e61 6d65 2e67 6574 286e 616d  = rename.get(nam
+0000be50: 652c 206e 616d 6529 0a20 2020 2020 2020  e, name).       
+0000be60: 2072 6574 7572 6e20 4172 7261 7928 6473   return Array(ds
+0000be70: 6b2c 206e 616d 652c 2073 656c 662e 6368  k, name, self.ch
+0000be80: 756e 6b73 2c20 7365 6c66 2e64 7479 7065  unks, self.dtype
+0000be90: 2c20 7365 6c66 2e5f 6d65 7461 290a 0a20  , self._meta).. 
+0000bea0: 2020 2064 6566 205f 7265 7365 745f 6361     def _reset_ca
+0000beb0: 6368 6528 7365 6c66 2c20 6b65 793d 4e6f  che(self, key=No
+0000bec0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+0000bed0: 0a20 2020 2020 2020 2052 6573 6574 2063  .        Reset c
+0000bee0: 6163 6865 6420 7072 6f70 6572 7469 6573  ached properties
+0000bef0: 2e0a 0a20 2020 2020 2020 2050 6172 616d  ...        Param
+0000bf00: 6574 6572 730a 2020 2020 2020 2020 2d2d  eters.        --
+0000bf10: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+0000bf20: 206b 6579 203a 2073 7472 2c20 6f70 7469   key : str, opti
+0000bf30: 6f6e 616c 0a20 2020 2020 2020 2020 2020  onal.           
+0000bf40: 2052 656d 6f76 6520 7370 6563 6966 6965   Remove specifie
+0000bf50: 6420 6b65 792e 2054 6865 2064 6566 6175  d key. The defau
+0000bf60: 6c74 2072 656d 6f76 6573 2061 6c6c 2069  lt removes all i
+0000bf70: 7465 6d73 2e0a 2020 2020 2020 2020 2222  tems..        ""
+0000bf80: 220a 2020 2020 2020 2020 6966 206b 6579  ".        if key
+0000bf90: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+0000bfa0: 2020 2020 2020 7365 6c66 2e5f 5f64 6963        self.__dic
+0000bfb0: 745f 5f2e 636c 6561 7228 290a 2020 2020  t__.clear().    
+0000bfc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000bfd0: 2020 2020 2020 7365 6c66 2e5f 5f64 6963        self.__dic
+0000bfe0: 745f 5f2e 706f 7028 6b65 792c 204e 6f6e  t__.pop(key, Non
+0000bff0: 6529 0a0a 2020 2020 4063 6163 6865 645f  e)..    @cached_
+0000c000: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+0000c010: 205f 6b65 795f 6172 7261 7928 7365 6c66   _key_array(self
+0000c020: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0000c030: 6e20 6e70 2e61 7272 6179 2873 656c 662e  n np.array(self.
+0000c040: 5f5f 6461 736b 5f6b 6579 735f 5f28 292c  __dask_keys__(),
+0000c050: 2064 7479 7065 3d6f 626a 6563 7429 0a0a   dtype=object)..
+0000c060: 2020 2020 4063 6163 6865 645f 7072 6f70      @cached_prop
+0000c070: 6572 7479 0a20 2020 2064 6566 206e 756d  erty.    def num
+0000c080: 626c 6f63 6b73 2873 656c 6629 3a0a 2020  blocks(self):.  
+0000c090: 2020 2020 2020 7265 7475 726e 2074 7570        return tup
+0000c0a0: 6c65 286d 6170 286c 656e 2c20 7365 6c66  le(map(len, self
+0000c0b0: 2e63 6875 6e6b 7329 290a 0a20 2020 2040  .chunks))..    @
+0000c0c0: 6361 6368 6564 5f70 726f 7065 7274 790a  cached_property.
+0000c0d0: 2020 2020 6465 6620 6e70 6172 7469 7469      def npartiti
+0000c0e0: 6f6e 7328 7365 6c66 293a 0a20 2020 2020  ons(self):.     
+0000c0f0: 2020 2072 6574 7572 6e20 7265 6475 6365     return reduce
+0000c100: 286d 756c 2c20 7365 6c66 2e6e 756d 626c  (mul, self.numbl
+0000c110: 6f63 6b73 2c20 3129 0a0a 2020 2020 6465  ocks, 1)..    de
+0000c120: 6620 636f 6d70 7574 655f 6368 756e 6b5f  f compute_chunk_
+0000c130: 7369 7a65 7328 7365 6c66 293a 0a20 2020  sizes(self):.   
+0000c140: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000c150: 2043 6f6d 7075 7465 2074 6865 2063 6875   Compute the chu
+0000c160: 6e6b 2073 697a 6573 2066 6f72 2061 2044  nk sizes for a D
+0000c170: 6173 6b20 6172 7261 792e 2054 6869 7320  ask array. This 
+0000c180: 6973 2065 7370 6563 6961 6c6c 7920 7573  is especially us
+0000c190: 6566 756c 0a20 2020 2020 2020 2077 6865  eful.        whe
+0000c1a0: 6e20 7468 6520 6368 756e 6b20 7369 7a65  n the chunk size
+0000c1b0: 7320 6172 6520 756e 6b6e 6f77 6e20 2865  s are unknown (e
+0000c1c0: 2e67 2e2c 2077 6865 6e20 696e 6465 7869  .g., when indexi
+0000c1d0: 6e67 206f 6e65 2044 6173 6b20 6172 7261  ng one Dask arra
+0000c1e0: 790a 2020 2020 2020 2020 7769 7468 2061  y.        with a
+0000c1f0: 6e6f 7468 6572 292e 0a0a 2020 2020 2020  nother)...      
+0000c200: 2020 4e6f 7465 730a 2020 2020 2020 2020    Notes.        
+0000c210: 2d2d 2d2d 2d0a 2020 2020 2020 2020 5468  -----.        Th
+0000c220: 6973 2066 756e 6374 696f 6e20 6d6f 6469  is function modi
+0000c230: 6669 6573 2074 6865 2044 6173 6b20 6172  fies the Dask ar
+0000c240: 7261 7920 696e 2d70 6c61 6365 2e0a 0a20  ray in-place... 
+0000c250: 2020 2020 2020 2045 7861 6d70 6c65 730a         Examples.
+0000c260: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+0000c270: 0a20 2020 2020 2020 203e 3e3e 2069 6d70  .        >>> imp
+0000c280: 6f72 7420 6461 736b 2e61 7272 6179 2061  ort dask.array a
+0000c290: 7320 6461 0a20 2020 2020 2020 203e 3e3e  s da.        >>>
+0000c2a0: 2069 6d70 6f72 7420 6e75 6d70 7920 6173   import numpy as
+0000c2b0: 206e 700a 2020 2020 2020 2020 3e3e 3e20   np.        >>> 
+0000c2c0: 7820 3d20 6461 2e66 726f 6d5f 6172 7261  x = da.from_arra
+0000c2d0: 7928 5b2d 322c 202d 312c 2030 2c20 312c  y([-2, -1, 0, 1,
+0000c2e0: 2032 5d2c 2063 6875 6e6b 733d 3229 0a20   2], chunks=2). 
+0000c2f0: 2020 2020 2020 203e 3e3e 2078 2e63 6875         >>> x.chu
+0000c300: 6e6b 730a 2020 2020 2020 2020 2828 322c  nks.        ((2,
+0000c310: 2032 2c20 3129 2c29 0a20 2020 2020 2020   2, 1),).       
+0000c320: 203e 3e3e 2079 203d 2078 5b78 203c 3d20   >>> y = x[x <= 
+0000c330: 305d 0a20 2020 2020 2020 203e 3e3e 2079  0].        >>> y
+0000c340: 2e63 6875 6e6b 730a 2020 2020 2020 2020  .chunks.        
+0000c350: 2828 6e61 6e2c 206e 616e 2c20 6e61 6e29  ((nan, nan, nan)
+0000c360: 2c29 0a20 2020 2020 2020 203e 3e3e 2079  ,).        >>> y
+0000c370: 2e63 6f6d 7075 7465 5f63 6875 6e6b 5f73  .compute_chunk_s
+0000c380: 697a 6573 2829 2020 2320 696e 2d70 6c61  izes()  # in-pla
+0000c390: 6365 2063 6f6d 7075 7461 7469 6f6e 0a20  ce computation. 
+0000c3a0: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+0000c3b0: 793c 6765 7469 7465 6d2c 2073 6861 7065  y<getitem, shape
+0000c3c0: 3d28 332c 292c 2064 7479 7065 3d69 6e74  =(3,), dtype=int
+0000c3d0: 3634 2c20 6368 756e 6b73 697a 653d 2832  64, chunksize=(2
+0000c3e0: 2c29 2c20 6368 756e 6b74 7970 653d 6e75  ,), chunktype=nu
+0000c3f0: 6d70 792e 6e64 6172 7261 793e 0a20 2020  mpy.ndarray>.   
+0000c400: 2020 2020 203e 3e3e 2079 2e63 6875 6e6b       >>> y.chunk
+0000c410: 730a 2020 2020 2020 2020 2828 322c 2031  s.        ((2, 1
+0000c420: 2c20 3029 2c29 0a0a 2020 2020 2020 2020  , 0),)..        
+0000c430: 2222 220a 2020 2020 2020 2020 7820 3d20  """.        x = 
+0000c440: 7365 6c66 0a20 2020 2020 2020 2063 6875  self.        chu
+0000c450: 6e6b 5f73 6861 7065 7320 3d20 782e 6d61  nk_shapes = x.ma
+0000c460: 705f 626c 6f63 6b73 280a 2020 2020 2020  p_blocks(.      
+0000c470: 2020 2020 2020 5f67 6574 5f63 6875 6e6b        _get_chunk
+0000c480: 5f73 6861 7065 2c0a 2020 2020 2020 2020  _shape,.        
+0000c490: 2020 2020 6474 7970 653d 696e 742c 0a20      dtype=int,. 
+0000c4a0: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
+0000c4b0: 733d 7475 706c 6528 6c65 6e28 6329 202a  s=tuple(len(c) *
+0000c4c0: 2028 312c 2920 666f 7220 6320 696e 2078   (1,) for c in x
+0000c4d0: 2e63 6875 6e6b 7329 202b 2028 2878 2e6e  .chunks) + ((x.n
+0000c4e0: 6469 6d2c 292c 292c 0a20 2020 2020 2020  dim,),),.       
+0000c4f0: 2020 2020 206e 6577 5f61 7869 733d 782e       new_axis=x.
+0000c500: 6e64 696d 2c0a 2020 2020 2020 2020 290a  ndim,.        ).
+0000c510: 0a20 2020 2020 2020 2063 203d 205b 5d0a  .        c = [].
+0000c520: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
+0000c530: 2072 616e 6765 2878 2e6e 6469 6d29 3a0a   range(x.ndim):.
+0000c540: 2020 2020 2020 2020 2020 2020 7320 3d20              s = 
+0000c550: 782e 6e64 696d 202a 205b 305d 202b 205b  x.ndim * [0] + [
+0000c560: 695d 0a20 2020 2020 2020 2020 2020 2073  i].            s
+0000c570: 5b69 5d20 3d20 736c 6963 6528 4e6f 6e65  [i] = slice(None
+0000c580: 290a 2020 2020 2020 2020 2020 2020 7320  ).            s 
+0000c590: 3d20 7475 706c 6528 7329 0a0a 2020 2020  = tuple(s)..    
+0000c5a0: 2020 2020 2020 2020 632e 6170 7065 6e64          c.append
+0000c5b0: 2874 7570 6c65 2863 6875 6e6b 5f73 6861  (tuple(chunk_sha
+0000c5c0: 7065 735b 735d 2929 0a0a 2020 2020 2020  pes[s]))..      
+0000c5d0: 2020 2320 606d 6170 5f62 6c6f 636b 7360    # `map_blocks`
+0000c5e0: 2061 7373 6967 6e73 206e 756d 7079 2064   assigns numpy d
+0000c5f0: 7479 7065 730a 2020 2020 2020 2020 2320  types.        # 
+0000c600: 6361 7374 2063 6875 6e6b 2064 696d 656e  cast chunk dimen
+0000c610: 7369 6f6e 7320 6261 636b 2074 6f20 7079  sions back to py
+0000c620: 7468 6f6e 2069 6e74 2062 6566 6f72 6520  thon int before 
+0000c630: 7265 7475 726e 696e 670a 2020 2020 2020  returning.      
+0000c640: 2020 782e 5f63 6875 6e6b 7320 3d20 7475    x._chunks = tu
+0000c650: 706c 6528 0a20 2020 2020 2020 2020 2020  ple(.           
+0000c660: 2074 7570 6c65 2869 6e74 2863 6875 6e6b   tuple(int(chunk
+0000c670: 2920 666f 7220 6368 756e 6b20 696e 2063  ) for chunk in c
+0000c680: 6875 6e6b 7329 2066 6f72 2063 6875 6e6b  hunks) for chunk
+0000c690: 7320 696e 2063 6f6d 7075 7465 2874 7570  s in compute(tup
+0000c6a0: 6c65 2863 2929 5b30 5d0a 2020 2020 2020  le(c))[0].      
+0000c6b0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+0000c6c0: 726e 2078 0a0a 2020 2020 4063 6163 6865  rn x..    @cache
+0000c6d0: 645f 7072 6f70 6572 7479 0a20 2020 2064  d_property.    d
+0000c6e0: 6566 2073 6861 7065 2873 656c 6629 202d  ef shape(self) -
+0000c6f0: 3e20 7475 706c 655b 545f 496e 744f 724e  > tuple[T_IntOrN
+0000c700: 614e 2c20 2e2e 2e5d 3a0a 2020 2020 2020  aN, ...]:.      
+0000c710: 2020 7265 7475 726e 2074 7570 6c65 2863    return tuple(c
+0000c720: 6163 6865 645f 6375 6d73 756d 2863 2c20  ached_cumsum(c, 
+0000c730: 696e 6974 6961 6c5f 7a65 726f 3d54 7275  initial_zero=Tru
+0000c740: 6529 5b2d 315d 2066 6f72 2063 2069 6e20  e)[-1] for c in 
+0000c750: 7365 6c66 2e63 6875 6e6b 7329 0a0a 2020  self.chunks)..  
+0000c760: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
+0000c770: 6465 6620 6368 756e 6b73 697a 6528 7365  def chunksize(se
+0000c780: 6c66 2920 2d3e 2074 7570 6c65 5b54 5f49  lf) -> tuple[T_I
+0000c790: 6e74 4f72 4e61 4e2c 202e 2e2e 5d3a 0a20  ntOrNaN, ...]:. 
+0000c7a0: 2020 2020 2020 2072 6574 7572 6e20 7475         return tu
+0000c7b0: 706c 6528 6d61 7828 6329 2066 6f72 2063  ple(max(c) for c
+0000c7c0: 2069 6e20 7365 6c66 2e63 6875 6e6b 7329   in self.chunks)
+0000c7d0: 0a0a 2020 2020 4070 726f 7065 7274 790a  ..    @property.
+0000c7e0: 2020 2020 6465 6620 6474 7970 6528 7365      def dtype(se
+0000c7f0: 6c66 293a 0a20 2020 2020 2020 2069 6620  lf):.        if 
+0000c800: 6973 696e 7374 616e 6365 2873 656c 662e  isinstance(self.
+0000c810: 5f6d 6574 612c 2074 7570 6c65 293a 0a20  _meta, tuple):. 
+0000c820: 2020 2020 2020 2020 2020 2064 7479 7065             dtype
+0000c830: 203d 2073 656c 662e 5f6d 6574 615b 305d   = self._meta[0]
+0000c840: 2e64 7479 7065 0a20 2020 2020 2020 2065  .dtype.        e
+0000c850: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000c860: 2064 7479 7065 203d 2073 656c 662e 5f6d   dtype = self._m
+0000c870: 6574 612e 6474 7970 650a 2020 2020 2020  eta.dtype.      
+0000c880: 2020 7265 7475 726e 2064 7479 7065 0a0a    return dtype..
+0000c890: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+0000c8a0: 2020 6465 6620 5f63 6875 6e6b 7328 7365    def _chunks(se
+0000c8b0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0000c8c0: 4e6f 6e2d 7075 626c 6963 2063 6875 6e6b  Non-public chunk
+0000c8d0: 7320 7072 6f70 6572 7479 2e20 416c 6c6f  s property. Allo
+0000c8e0: 7773 2073 6574 7469 6e67 2061 2063 6875  ws setting a chu
+0000c8f0: 6e6b 2076 616c 7565 2e22 2222 0a20 2020  nk value.""".   
+0000c900: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000c910: 2e5f 5f63 6875 6e6b 730a 0a20 2020 2040  .__chunks..    @
+0000c920: 5f63 6875 6e6b 732e 7365 7474 6572 0a20  _chunks.setter. 
+0000c930: 2020 2064 6566 205f 6368 756e 6b73 2873     def _chunks(s
+0000c940: 656c 662c 2063 6875 6e6b 7329 3a0a 2020  elf, chunks):.  
+0000c950: 2020 2020 2020 7365 6c66 2e5f 5f63 6875        self.__chu
+0000c960: 6e6b 7320 3d20 6368 756e 6b73 0a0a 2020  nks = chunks..  
+0000c970: 2020 2020 2020 2320 5768 656e 2074 6865        # When the
+0000c980: 2063 6875 6e6b 7320 6368 616e 6765 7320   chunks changes 
+0000c990: 7468 6520 6361 6368 6564 2070 726f 7065  the cached prope
+0000c9a0: 7274 6965 7320 7468 6174 2077 6173 0a20  rties that was. 
+0000c9b0: 2020 2020 2020 2023 2064 6570 656e 6465         # depende
+0000c9c0: 6e74 206f 6e20 6974 206e 6565 6473 2074  nt on it needs t
+0000c9d0: 6f20 6265 2064 656c 6574 6564 3a0a 2020  o be deleted:.  
+0000c9e0: 2020 2020 2020 666f 7220 6b65 7920 696e        for key in
+0000c9f0: 205b 226e 756d 626c 6f63 6b73 222c 2022   ["numblocks", "
+0000ca00: 6e70 6172 7469 7469 6f6e 7322 2c20 2273  npartitions", "s
+0000ca10: 6861 7065 222c 2022 6e64 696d 222c 2022  hape", "ndim", "
+0000ca20: 7369 7a65 222c 2022 5f6b 6579 5f61 7272  size", "_key_arr
+0000ca30: 6179 225d 3a0a 2020 2020 2020 2020 2020  ay"]:.          
+0000ca40: 2020 7365 6c66 2e5f 7265 7365 745f 6361    self._reset_ca
+0000ca50: 6368 6528 6b65 7929 0a0a 2020 2020 4070  che(key)..    @p
+0000ca60: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000ca70: 6368 756e 6b73 2873 656c 6629 3a0a 2020  chunks(self):.  
+0000ca80: 2020 2020 2020 2222 2243 6875 6e6b 7320        """Chunks 
+0000ca90: 7072 6f70 6572 7479 2e22 2222 0a20 2020  property.""".   
+0000caa0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+0000cab0: 2e5f 5f63 6875 6e6b 730a 0a20 2020 2040  .__chunks..    @
+0000cac0: 6368 756e 6b73 2e73 6574 7465 720a 2020  chunks.setter.  
+0000cad0: 2020 6465 6620 6368 756e 6b73 2873 656c    def chunks(sel
+0000cae0: 662c 2063 6875 6e6b 7329 3a0a 2020 2020  f, chunks):.    
+0000caf0: 2020 2020 7261 6973 6520 5479 7065 4572      raise TypeEr
+0000cb00: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0000cb10: 2022 4361 6e20 6e6f 7420 7365 7420 6368   "Can not set ch
+0000cb20: 756e 6b73 2064 6972 6563 746c 795c 6e5c  unks directly\n\
+0000cb30: 6e22 0a20 2020 2020 2020 2020 2020 2022  n".            "
+0000cb40: 506c 6561 7365 2075 7365 2074 6865 2072  Please use the r
+0000cb50: 6563 6875 6e6b 206d 6574 686f 6420 696e  echunk method in
+0000cb60: 7374 6561 643a 5c6e 220a 2020 2020 2020  stead:\n".      
+0000cb70: 2020 2020 2020 6622 2020 782e 7265 6368        f"  x.rech
+0000cb80: 756e 6b28 7b63 6875 6e6b 737d 295c 6e5c  unk({chunks})\n\
+0000cb90: 6e22 0a20 2020 2020 2020 2020 2020 2022  n".            "
+0000cba0: 4966 2074 7279 696e 6720 746f 2061 766f  If trying to avo
+0000cbb0: 6964 2075 6e6b 6e6f 776e 2063 6875 6e6b  id unknown chunk
+0000cbc0: 732c 2075 7365 5c6e 220a 2020 2020 2020  s, use\n".      
+0000cbd0: 2020 2020 2020 2220 2078 2e63 6f6d 7075        "  x.compu
+0000cbe0: 7465 5f63 6875 6e6b 5f73 697a 6573 2829  te_chunk_sizes()
+0000cbf0: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+0000cc00: 2064 6566 205f 5f6c 656e 5f5f 2873 656c   def __len__(sel
+0000cc10: 6629 3a0a 2020 2020 2020 2020 6966 206e  f):.        if n
+0000cc20: 6f74 2073 656c 662e 6368 756e 6b73 3a0a  ot self.chunks:.
+0000cc30: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000cc40: 6520 5479 7065 4572 726f 7228 226c 656e  e TypeError("len
+0000cc50: 2829 206f 6620 756e 7369 7a65 6420 6f62  () of unsized ob
+0000cc60: 6a65 6374 2229 0a20 2020 2020 2020 2069  ject").        i
+0000cc70: 6620 6e70 2e69 736e 616e 2873 656c 662e  f np.isnan(self.
+0000cc80: 6368 756e 6b73 5b30 5d29 2e61 6e79 2829  chunks[0]).any()
+0000cc90: 3a0a 2020 2020 2020 2020 2020 2020 6d73  :.            ms
+0000cca0: 6720 3d20 280a 2020 2020 2020 2020 2020  g = (.          
+0000ccb0: 2020 2020 2020 2243 616e 6e6f 7420 6361        "Cannot ca
+0000ccc0: 6c6c 206c 656e 2829 206f 6e20 6f62 6a65  ll len() on obje
+0000ccd0: 6374 2077 6974 6820 756e 6b6e 6f77 6e20  ct with unknown 
+0000cce0: 6368 756e 6b20 7369 7a65 2e22 0a20 2020  chunk size.".   
+0000ccf0: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
+0000cd00: 756e 6b6e 6f77 6e5f 6368 756e 6b5f 6d65  unknown_chunk_me
+0000cd10: 7373 6167 657d 220a 2020 2020 2020 2020  ssage}".        
+0000cd20: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0000cd30: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0000cd40: 6f72 286d 7367 290a 2020 2020 2020 2020  or(msg).        
+0000cd50: 7265 7475 726e 2069 6e74 2873 756d 2873  return int(sum(s
+0000cd60: 656c 662e 6368 756e 6b73 5b30 5d29 290a  elf.chunks[0])).
+0000cd70: 0a20 2020 2064 6566 205f 5f61 7272 6179  .    def __array
+0000cd80: 5f75 6675 6e63 5f5f 2873 656c 662c 206e  _ufunc__(self, n
+0000cd90: 756d 7079 5f75 6675 6e63 2c20 6d65 7468  umpy_ufunc, meth
+0000cda0: 6f64 2c20 2a69 6e70 7574 732c 202a 2a6b  od, *inputs, **k
+0000cdb0: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0000cdc0: 6f75 7420 3d20 6b77 6172 6773 2e67 6574  out = kwargs.get
+0000cdd0: 2822 6f75 7422 2c20 2829 290a 2020 2020  ("out", ()).    
+0000cde0: 2020 2020 666f 7220 7820 696e 2069 6e70      for x in inp
+0000cdf0: 7574 7320 2b20 6f75 743a 0a20 2020 2020  uts + out:.     
+0000ce00: 2020 2020 2020 2069 6620 5f73 686f 756c         if _shoul
+0000ce10: 645f 6465 6c65 6761 7465 2873 656c 662c  d_delegate(self,
+0000ce20: 2078 293a 0a20 2020 2020 2020 2020 2020   x):.           
+0000ce30: 2020 2020 2072 6574 7572 6e20 4e6f 7449       return NotI
+0000ce40: 6d70 6c65 6d65 6e74 6564 0a0a 2020 2020  mplemented..    
+0000ce50: 2020 2020 6966 206d 6574 686f 6420 3d3d      if method ==
+0000ce60: 2022 5f5f 6361 6c6c 5f5f 223a 0a20 2020   "__call__":.   
+0000ce70: 2020 2020 2020 2020 2069 6620 6e75 6d70           if nump
+0000ce80: 795f 7566 756e 6320 6973 206e 702e 6d61  y_ufunc is np.ma
+0000ce90: 746d 756c 3a0a 2020 2020 2020 2020 2020  tmul:.          
+0000cea0: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+0000ceb0: 6172 7261 792e 726f 7574 696e 6573 2069  array.routines i
+0000cec0: 6d70 6f72 7420 6d61 746d 756c 0a0a 2020  mport matmul..  
+0000ced0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+0000cee0: 7370 6563 6961 6c20 6361 7365 2075 6e74  special case unt
+0000cef0: 696c 2061 7070 6c79 5f67 7566 756e 6320  il apply_gufunc 
+0000cf00: 6861 6e64 6c65 7320 6f70 7469 6f6e 616c  handles optional
+0000cf10: 2064 696d 656e 7369 6f6e 730a 2020 2020   dimensions.    
+0000cf20: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000cf30: 726e 206d 6174 6d75 6c28 2a69 6e70 7574  rn matmul(*input
+0000cf40: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
+0000cf50: 2020 2020 2020 2020 2069 6620 6e75 6d70           if nump
+0000cf60: 795f 7566 756e 632e 7369 676e 6174 7572  y_ufunc.signatur
+0000cf70: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+0000cf80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000cf90: 726f 6d20 6461 736b 2e61 7272 6179 2e67  rom dask.array.g
+0000cfa0: 7566 756e 6320 696d 706f 7274 2061 7070  ufunc import app
+0000cfb0: 6c79 5f67 7566 756e 630a 0a20 2020 2020  ly_gufunc..     
+0000cfc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000cfd0: 6e20 6170 706c 795f 6775 6675 6e63 280a  n apply_gufunc(.
+0000cfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cff0: 2020 2020 6e75 6d70 795f 7566 756e 632c      numpy_ufunc,
+0000d000: 206e 756d 7079 5f75 6675 6e63 2e73 6967   numpy_ufunc.sig
+0000d010: 6e61 7475 7265 2c20 2a69 6e70 7574 732c  nature, *inputs,
+0000d020: 202a 2a6b 7761 7267 730a 2020 2020 2020   **kwargs.      
+0000d030: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000d040: 2020 2020 2020 2020 6966 206e 756d 7079          if numpy
+0000d050: 5f75 6675 6e63 2e6e 6f75 7420 3e20 313a  _ufunc.nout > 1:
+0000d060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d070: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+0000d080: 2069 6d70 6f72 7420 7566 756e 630a 0a20   import ufunc.. 
+0000d090: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0000d0a0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000d0b0: 2020 2020 2020 2020 6461 5f75 6675 6e63          da_ufunc
+0000d0c0: 203d 2067 6574 6174 7472 2875 6675 6e63   = getattr(ufunc
+0000d0d0: 2c20 6e75 6d70 795f 7566 756e 632e 5f5f  , numpy_ufunc.__
+0000d0e0: 6e61 6d65 5f5f 290a 2020 2020 2020 2020  name__).        
+0000d0f0: 2020 2020 2020 2020 6578 6365 7074 2041          except A
+0000d100: 7474 7269 6275 7465 4572 726f 723a 0a20  ttributeError:. 
+0000d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d120: 2020 2072 6574 7572 6e20 4e6f 7449 6d70     return NotImp
+0000d130: 6c65 6d65 6e74 6564 0a20 2020 2020 2020  lemented.       
+0000d140: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000d150: 6461 5f75 6675 6e63 282a 696e 7075 7473  da_ufunc(*inputs
+0000d160: 2c20 2a2a 6b77 6172 6773 290a 2020 2020  , **kwargs).    
+0000d170: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0000d180: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000d190: 7475 726e 2065 6c65 6d77 6973 6528 6e75  turn elemwise(nu
+0000d1a0: 6d70 795f 7566 756e 632c 202a 696e 7075  mpy_ufunc, *inpu
+0000d1b0: 7473 2c20 2a2a 6b77 6172 6773 290a 2020  ts, **kwargs).  
+0000d1c0: 2020 2020 2020 656c 6966 206d 6574 686f        elif metho
+0000d1d0: 6420 3d3d 2022 6f75 7465 7222 3a0a 2020  d == "outer":.  
+0000d1e0: 2020 2020 2020 2020 2020 6672 6f6d 2064            from d
+0000d1f0: 6173 6b2e 6172 7261 7920 696d 706f 7274  ask.array import
+0000d200: 2075 6675 6e63 0a0a 2020 2020 2020 2020   ufunc..        
+0000d210: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000d220: 2020 2020 2020 2020 2064 615f 7566 756e           da_ufun
+0000d230: 6320 3d20 6765 7461 7474 7228 7566 756e  c = getattr(ufun
+0000d240: 632c 206e 756d 7079 5f75 6675 6e63 2e5f  c, numpy_ufunc._
+0000d250: 5f6e 616d 655f 5f29 0a20 2020 2020 2020  _name__).       
+0000d260: 2020 2020 2065 7863 6570 7420 4174 7472       except Attr
+0000d270: 6962 7574 6545 7272 6f72 3a0a 2020 2020  ibuteError:.    
+0000d280: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000d290: 726e 204e 6f74 496d 706c 656d 656e 7465  rn NotImplemente
+0000d2a0: 640a 2020 2020 2020 2020 2020 2020 7265  d.            re
+0000d2b0: 7475 726e 2064 615f 7566 756e 632e 6f75  turn da_ufunc.ou
+0000d2c0: 7465 7228 2a69 6e70 7574 732c 202a 2a6b  ter(*inputs, **k
+0000d2d0: 7761 7267 7329 0a20 2020 2020 2020 2065  wargs).        e
+0000d2e0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000d2f0: 2072 6574 7572 6e20 4e6f 7449 6d70 6c65   return NotImple
+0000d300: 6d65 6e74 6564 0a0a 2020 2020 6465 6620  mented..    def 
+0000d310: 5f5f 7265 7072 5f5f 2873 656c 6629 3a0a  __repr__(self):.
+0000d320: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0000d330: 2020 2020 203e 3e3e 2069 6d70 6f72 7420       >>> import 
+0000d340: 6461 736b 2e61 7272 6179 2061 7320 6461  dask.array as da
+0000d350: 0a20 2020 2020 2020 203e 3e3e 2064 612e  .        >>> da.
+0000d360: 6f6e 6573 2828 3130 2c20 3130 292c 2063  ones((10, 10), c
+0000d370: 6875 6e6b 733d 2835 2c20 3529 2c20 6474  hunks=(5, 5), dt
+0000d380: 7970 653d 2769 3427 290a 2020 2020 2020  ype='i4').      
+0000d390: 2020 6461 736b 2e61 7272 6179 3c2e 2e2e    dask.array<...
+0000d3a0: 2c20 7368 6170 653d 2831 302c 2031 3029  , shape=(10, 10)
+0000d3b0: 2c20 6474 7970 653d 696e 7433 322c 2063  , dtype=int32, c
+0000d3c0: 6875 6e6b 7369 7a65 3d28 352c 2035 292c  hunksize=(5, 5),
+0000d3d0: 2063 6875 6e6b 7479 7065 3d6e 756d 7079   chunktype=numpy
+0000d3e0: 2e6e 6461 7272 6179 3e0a 2020 2020 2020  .ndarray>.      
+0000d3f0: 2020 2222 220a 2020 2020 2020 2020 6368    """.        ch
+0000d400: 756e 6b73 697a 6520 3d20 7374 7228 7365  unksize = str(se
+0000d410: 6c66 2e63 6875 6e6b 7369 7a65 290a 2020  lf.chunksize).  
+0000d420: 2020 2020 2020 6e61 6d65 203d 2073 656c        name = sel
+0000d430: 662e 6e61 6d65 2e72 7370 6c69 7428 222d  f.name.rsplit("-
+0000d440: 222c 2031 295b 305d 0a20 2020 2020 2020  ", 1)[0].       
+0000d450: 2072 6574 7572 6e20 280a 2020 2020 2020   return (.      
+0000d460: 2020 2020 2020 2264 6173 6b2e 6172 7261        "dask.arra
+0000d470: 793c 7b7d 2c20 7368 6170 653d 7b7d 2c20  y<{}, shape={}, 
+0000d480: 6474 7970 653d 7b7d 2c20 6368 756e 6b73  dtype={}, chunks
+0000d490: 697a 653d 7b7d 2c20 6368 756e 6b74 7970  ize={}, chunktyp
+0000d4a0: 653d 7b7d 2e7b 7d3e 222e 666f 726d 6174  e={}.{}>".format
+0000d4b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d4c0: 2020 6e61 6d65 2c0a 2020 2020 2020 2020    name,.        
+0000d4d0: 2020 2020 2020 2020 7365 6c66 2e73 6861          self.sha
+0000d4e0: 7065 2c0a 2020 2020 2020 2020 2020 2020  pe,.            
+0000d4f0: 2020 2020 7365 6c66 2e64 7479 7065 2c0a      self.dtype,.
+0000d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d510: 6368 756e 6b73 697a 652c 0a20 2020 2020  chunksize,.     
+0000d520: 2020 2020 2020 2020 2020 2074 7970 6528             type(
+0000d530: 7365 6c66 2e5f 6d65 7461 292e 5f5f 6d6f  self._meta).__mo
+0000d540: 6475 6c65 5f5f 2e73 706c 6974 2822 2e22  dule__.split("."
+0000d550: 295b 305d 2c0a 2020 2020 2020 2020 2020  )[0],.          
+0000d560: 2020 2020 2020 7479 7065 2873 656c 662e        type(self.
+0000d570: 5f6d 6574 6129 2e5f 5f6e 616d 655f 5f2c  _meta).__name__,
+0000d580: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0000d590: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0000d5a0: 6620 5f72 6570 725f 6874 6d6c 5f28 7365  f _repr_html_(se
+0000d5b0: 6c66 293a 0a20 2020 2020 2020 2074 7279  lf):.        try
+0000d5c0: 3a0a 2020 2020 2020 2020 2020 2020 6772  :.            gr
+0000d5d0: 6964 203d 2073 656c 662e 746f 5f73 7667  id = self.to_svg
+0000d5e0: 2873 697a 653d 636f 6e66 6967 2e67 6574  (size=config.get
+0000d5f0: 2822 6172 7261 792e 7376 672e 7369 7a65  ("array.svg.size
+0000d600: 222c 2031 3230 2929 0a20 2020 2020 2020  ", 120)).       
+0000d610: 2065 7863 6570 7420 4e6f 7449 6d70 6c65   except NotImple
+0000d620: 6d65 6e74 6564 4572 726f 723a 0a20 2020  mentedError:.   
+0000d630: 2020 2020 2020 2020 2067 7269 6420 3d20           grid = 
+0000d640: 2222 0a0a 2020 2020 2020 2020 6966 2022  ""..        if "
+0000d650: 7370 6172 7365 2220 696e 2074 7970 656e  sparse" in typen
+0000d660: 616d 6528 7479 7065 2873 656c 662e 5f6d  ame(type(self._m
+0000d670: 6574 6129 293a 0a20 2020 2020 2020 2020  eta)):.         
+0000d680: 2020 206e 6279 7465 7320 3d20 4e6f 6e65     nbytes = None
+0000d690: 0a20 2020 2020 2020 2020 2020 2063 6279  .            cby
+0000d6a0: 7465 7320 3d20 4e6f 6e65 0a20 2020 2020  tes = None.     
+0000d6b0: 2020 2065 6c69 6620 6e6f 7420 6d61 7468     elif not math
+0000d6c0: 2e69 736e 616e 2873 656c 662e 6e62 7974  .isnan(self.nbyt
+0000d6d0: 6573 293a 0a20 2020 2020 2020 2020 2020  es):.           
+0000d6e0: 206e 6279 7465 7320 3d20 666f 726d 6174   nbytes = format
+0000d6f0: 5f62 7974 6573 2873 656c 662e 6e62 7974  _bytes(self.nbyt
+0000d700: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0000d710: 6362 7974 6573 203d 2066 6f72 6d61 745f  cbytes = format_
+0000d720: 6279 7465 7328 6d61 7468 2e70 726f 6428  bytes(math.prod(
+0000d730: 7365 6c66 2e63 6875 6e6b 7369 7a65 2920  self.chunksize) 
+0000d740: 2a20 7365 6c66 2e64 7479 7065 2e69 7465  * self.dtype.ite
+0000d750: 6d73 697a 6529 0a20 2020 2020 2020 2065  msize).        e
+0000d760: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000d770: 206e 6279 7465 7320 3d20 2275 6e6b 6e6f   nbytes = "unkno
+0000d780: 776e 220a 2020 2020 2020 2020 2020 2020  wn".            
+0000d790: 6362 7974 6573 203d 2022 756e 6b6e 6f77  cbytes = "unknow
+0000d7a0: 6e22 0a0a 2020 2020 2020 2020 7265 7475  n"..        retu
+0000d7b0: 726e 2067 6574 5f74 656d 706c 6174 6528  rn get_template(
+0000d7c0: 2261 7272 6179 2e68 746d 6c2e 6a32 2229  "array.html.j2")
+0000d7d0: 2e72 656e 6465 7228 0a20 2020 2020 2020  .render(.       
+0000d7e0: 2020 2020 2061 7272 6179 3d73 656c 662c       array=self,
+0000d7f0: 0a20 2020 2020 2020 2020 2020 2067 7269  .            gri
+0000d800: 643d 6772 6964 2c0a 2020 2020 2020 2020  d=grid,.        
+0000d810: 2020 2020 6e62 7974 6573 3d6e 6279 7465      nbytes=nbyte
+0000d820: 732c 0a20 2020 2020 2020 2020 2020 2063  s,.            c
+0000d830: 6279 7465 733d 6362 7974 6573 2c0a 2020  bytes=cbytes,.  
+0000d840: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+0000d850: 3d6d 6179 6265 5f70 6c75 7261 6c69 7a65  =maybe_pluralize
+0000d860: 286c 656e 2873 656c 662e 6461 736b 2e6c  (len(self.dask.l
+0000d870: 6179 6572 7329 2c20 2267 7261 7068 206c  ayers), "graph l
+0000d880: 6179 6572 2229 2c0a 2020 2020 2020 2020  ayer"),.        
+0000d890: 290a 0a20 2020 2040 6361 6368 6564 5f70  )..    @cached_p
+0000d8a0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000d8b0: 6e64 696d 2873 656c 6629 202d 3e20 696e  ndim(self) -> in
+0000d8c0: 743a 0a20 2020 2020 2020 2072 6574 7572  t:.        retur
+0000d8d0: 6e20 6c65 6e28 7365 6c66 2e73 6861 7065  n len(self.shape
+0000d8e0: 290a 0a20 2020 2040 6361 6368 6564 5f70  )..    @cached_p
+0000d8f0: 726f 7065 7274 790a 2020 2020 6465 6620  roperty.    def 
+0000d900: 7369 7a65 2873 656c 6629 202d 3e20 545f  size(self) -> T_
+0000d910: 496e 744f 724e 614e 3a0a 2020 2020 2020  IntOrNaN:.      
+0000d920: 2020 2222 224e 756d 6265 7220 6f66 2065    """Number of e
+0000d930: 6c65 6d65 6e74 7320 696e 2061 7272 6179  lements in array
+0000d940: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+0000d950: 726e 2072 6564 7563 6528 6d75 6c2c 2073  rn reduce(mul, s
+0000d960: 656c 662e 7368 6170 652c 2031 290a 0a20  elf.shape, 1).. 
+0000d970: 2020 2040 7072 6f70 6572 7479 0a20 2020     @property.   
+0000d980: 2064 6566 206e 6279 7465 7328 7365 6c66   def nbytes(self
+0000d990: 2920 2d3e 2054 5f49 6e74 4f72 4e61 4e3a  ) -> T_IntOrNaN:
+0000d9a0: 0a20 2020 2020 2020 2022 2222 4e75 6d62  .        """Numb
+0000d9b0: 6572 206f 6620 6279 7465 7320 696e 2061  er of bytes in a
+0000d9c0: 7272 6179 2222 220a 2020 2020 2020 2020  rray""".        
+0000d9d0: 7265 7475 726e 2073 656c 662e 7369 7a65  return self.size
+0000d9e0: 202a 2073 656c 662e 6474 7970 652e 6974   * self.dtype.it
+0000d9f0: 656d 7369 7a65 0a0a 2020 2020 4070 726f  emsize..    @pro
+0000da00: 7065 7274 790a 2020 2020 6465 6620 6974  perty.    def it
+0000da10: 656d 7369 7a65 2873 656c 6629 202d 3e20  emsize(self) -> 
+0000da20: 696e 743a 0a20 2020 2020 2020 2022 2222  int:.        """
+0000da30: 4c65 6e67 7468 206f 6620 6f6e 6520 6172  Length of one ar
+0000da40: 7261 7920 656c 656d 656e 7420 696e 2062  ray element in b
+0000da50: 7974 6573 2222 220a 2020 2020 2020 2020  ytes""".        
+0000da60: 7265 7475 726e 2073 656c 662e 6474 7970  return self.dtyp
+0000da70: 652e 6974 656d 7369 7a65 0a0a 2020 2020  e.itemsize..    
+0000da80: 4070 726f 7065 7274 790a 2020 2020 6465  @property.    de
+0000da90: 6620 5f6e 616d 6528 7365 6c66 293a 0a20  f _name(self):. 
+0000daa0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0000dab0: 6c66 2e5f 5f6e 616d 650a 0a20 2020 2040  lf.__name..    @
+0000dac0: 5f6e 616d 652e 7365 7474 6572 0a20 2020  _name.setter.   
+0000dad0: 2064 6566 205f 6e61 6d65 2873 656c 662c   def _name(self,
+0000dae0: 2076 616c 293a 0a20 2020 2020 2020 2073   val):.        s
+0000daf0: 656c 662e 5f5f 6e61 6d65 203d 2076 616c  elf.__name = val
+0000db00: 0a20 2020 2020 2020 2023 2043 6c65 6172  .        # Clear
+0000db10: 2074 6865 206b 6579 2063 6163 6865 2077   the key cache w
+0000db20: 6865 6e20 7468 6520 6e61 6d65 2069 7320  hen the name is 
+0000db30: 7265 7365 740a 2020 2020 2020 2020 7365  reset.        se
+0000db40: 6c66 2e5f 6361 6368 6564 5f6b 6579 7320  lf._cached_keys 
+0000db50: 3d20 4e6f 6e65 0a20 2020 2020 2020 2073  = None.        s
+0000db60: 656c 662e 5f72 6573 6574 5f63 6163 6865  elf._reset_cache
+0000db70: 2822 5f6b 6579 5f61 7272 6179 2229 0a0a  ("_key_array")..
+0000db80: 2020 2020 4070 726f 7065 7274 790a 2020      @property.  
+0000db90: 2020 6465 6620 6e61 6d65 2873 656c 6629    def name(self)
+0000dba0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0000dbb0: 2073 656c 662e 5f5f 6e61 6d65 0a0a 2020   self.__name..  
+0000dbc0: 2020 406e 616d 652e 7365 7474 6572 0a20    @name.setter. 
+0000dbd0: 2020 2064 6566 206e 616d 6528 7365 6c66     def name(self
+0000dbe0: 2c20 7661 6c29 3a0a 2020 2020 2020 2020  , val):.        
+0000dbf0: 7261 6973 6520 5479 7065 4572 726f 7228  raise TypeError(
+0000dc00: 0a20 2020 2020 2020 2020 2020 2022 4361  .            "Ca
+0000dc10: 6e6e 6f74 2073 6574 206e 616d 6520 6469  nnot set name di
+0000dc20: 7265 6374 6c79 5c6e 5c6e 220a 2020 2020  rectly\n\n".    
+0000dc30: 2020 2020 2020 2020 224e 616d 6520 6973          "Name is
+0000dc40: 2075 7365 6420 746f 2072 656c 6174 6520   used to relate 
+0000dc50: 7468 6520 6172 7261 7920 746f 2074 6865  the array to the
+0000dc60: 2074 6173 6b20 6772 6170 682e 5c6e 220a   task graph.\n".
+0000dc70: 2020 2020 2020 2020 2020 2020 2249 7420              "It 
+0000dc80: 6973 2075 6e63 6f6d 6d6f 6e20 746f 206e  is uncommon to n
+0000dc90: 6565 6420 746f 2063 6861 6e67 6520 6974  eed to change it
+0000dca0: 2c20 6275 7420 6966 2079 6f75 2064 6f5c  , but if you do\
+0000dcb0: 6e22 0a20 2020 2020 2020 2020 2020 2022  n".            "
+0000dcc0: 706c 6561 7365 2073 6574 2060 602e 5f6e  please set ``._n
+0000dcd0: 616d 6560 6022 0a20 2020 2020 2020 2029  ame``".        )
+0000dce0: 0a0a 2020 2020 6465 6620 5f5f 6974 6572  ..    def __iter
+0000dcf0: 5f5f 2873 656c 6629 3a0a 2020 2020 2020  __(self):.      
+0000dd00: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+0000dd10: 286c 656e 2873 656c 6629 293a 0a20 2020  (len(self)):.   
+0000dd20: 2020 2020 2020 2020 2079 6965 6c64 2073           yield s
+0000dd30: 656c 665b 695d 0a0a 2020 2020 5f5f 6172  elf[i]..    __ar
+0000dd40: 7261 795f 7072 696f 7269 7479 5f5f 203d  ray_priority__ =
+0000dd50: 2031 3120 2023 2068 6967 6865 7220 7468   11  # higher th
+0000dd60: 616e 206e 756d 7079 2e6e 6461 7272 6179  an numpy.ndarray
+0000dd70: 2061 6e64 206e 756d 7079 2e6d 6174 7269   and numpy.matri
+0000dd80: 780a 0a20 2020 2064 6566 205f 5f61 7272  x..    def __arr
+0000dd90: 6179 5f5f 2873 656c 662c 2064 7479 7065  ay__(self, dtype
+0000dda0: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
+0000ddb0: 3a0a 2020 2020 2020 2020 7820 3d20 7365  :.        x = se
+0000ddc0: 6c66 2e63 6f6d 7075 7465 2829 0a20 2020  lf.compute().   
+0000ddd0: 2020 2020 2069 6620 6474 7970 6520 616e       if dtype an
+0000dde0: 6420 782e 6474 7970 6520 213d 2064 7479  d x.dtype != dty
+0000ddf0: 7065 3a0a 2020 2020 2020 2020 2020 2020  pe:.            
+0000de00: 7820 3d20 782e 6173 7479 7065 2864 7479  x = x.astype(dty
+0000de10: 7065 290a 2020 2020 2020 2020 6966 206e  pe).        if n
+0000de20: 6f74 2069 7369 6e73 7461 6e63 6528 782c  ot isinstance(x,
+0000de30: 206e 702e 6e64 6172 7261 7929 3a0a 2020   np.ndarray):.  
+0000de40: 2020 2020 2020 2020 2020 7820 3d20 6e70            x = np
+0000de50: 2e61 7272 6179 2878 290a 2020 2020 2020  .array(x).      
+0000de60: 2020 7265 7475 726e 2078 0a0a 2020 2020    return x..    
+0000de70: 6465 6620 5f5f 6172 7261 795f 6675 6e63  def __array_func
+0000de80: 7469 6f6e 5f5f 2873 656c 662c 2066 756e  tion__(self, fun
+0000de90: 632c 2074 7970 6573 2c20 6172 6773 2c20  c, types, args, 
+0000dea0: 6b77 6172 6773 293a 0a20 2020 2020 2020  kwargs):.       
+0000deb0: 2069 6d70 6f72 7420 6461 736b 2e61 7272   import dask.arr
+0000dec0: 6179 2061 7320 6d6f 6475 6c65 0a0a 2020  ay as module..  
+0000ded0: 2020 2020 2020 6465 6620 6861 6e64 6c65        def handle
+0000dee0: 5f6e 6f6e 6d61 7463 6869 6e67 5f6e 616d  _nonmatching_nam
+0000def0: 6573 2866 756e 632c 2061 7267 732c 206b  es(func, args, k
+0000df00: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+0000df10: 2020 2020 6966 2066 756e 6320 6e6f 7420      if func not 
+0000df20: 696e 205f 4841 4e44 4c45 445f 4655 4e43  in _HANDLED_FUNC
+0000df30: 5449 4f4e 533a 0a20 2020 2020 2020 2020  TIONS:.         
+0000df40: 2020 2020 2020 2077 6172 6e69 6e67 732e         warnings.
+0000df50: 7761 726e 280a 2020 2020 2020 2020 2020  warn(.          
+0000df60: 2020 2020 2020 2020 2020 2254 6865 2060            "The `
+0000df70: 7b7d 6020 6675 6e63 7469 6f6e 2069 7320  {}` function is 
+0000df80: 6e6f 7420 696d 706c 656d 656e 7465 6420  not implemented 
+0000df90: 6279 2044 6173 6b20 6172 7261 792e 2022  by Dask array. "
+0000dfa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000dfb0: 2020 2020 2022 596f 7520 6d61 7920 7761       "You may wa
+0000dfc0: 6e74 2074 6f20 7573 6520 7468 6520 6461  nt to use the da
+0000dfd0: 2e6d 6170 5f62 6c6f 636b 7320 6675 6e63  .map_blocks func
+0000dfe0: 7469 6f6e 2022 0a20 2020 2020 2020 2020  tion ".         
+0000dff0: 2020 2020 2020 2020 2020 2022 6f72 2073             "or s
+0000e000: 6f6d 6574 6869 6e67 2073 696d 696c 6172  omething similar
+0000e010: 2074 6f20 7369 6c65 6e63 6520 7468 6973   to silence this
+0000e020: 2077 6172 6e69 6e67 2e20 220a 2020 2020   warning. ".    
+0000e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e040: 2259 6f75 7220 636f 6465 206d 6179 2073  "Your code may s
+0000e050: 746f 7020 776f 726b 696e 6720 696e 2061  top working in a
+0000e060: 2066 7574 7572 6520 7265 6c65 6173 652e   future release.
+0000e070: 222e 666f 726d 6174 280a 2020 2020 2020  ".format(.      
+0000e080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e090: 2020 6675 6e63 2e5f 5f6d 6f64 756c 655f    func.__module_
+0000e0a0: 5f20 2b20 222e 2220 2b20 6675 6e63 2e5f  _ + "." + func._
+0000e0b0: 5f6e 616d 655f 5f0a 2020 2020 2020 2020  _name__.        
+0000e0c0: 2020 2020 2020 2020 2020 2020 292c 0a20              ),. 
+0000e0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e0e0: 2020 2046 7574 7572 6557 6172 6e69 6e67     FutureWarning
+0000e0f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000e100: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+0000e110: 2020 2020 2320 4e65 6564 2074 6f20 636f      # Need to co
+0000e120: 6e76 6572 7420 746f 2061 7272 6179 206f  nvert to array o
+0000e130: 626a 6563 7420 2865 2e67 2e20 6e75 6d70  bject (e.g. nump
+0000e140: 792e 6e64 6172 7261 7920 6f72 0a20 2020  y.ndarray or.   
+0000e150: 2020 2020 2020 2020 2020 2020 2023 2063               # c
+0000e160: 7570 792e 6e64 6172 7261 7929 2061 7320  upy.ndarray) as 
+0000e170: 6e65 6564 6564 2c20 736f 2077 6520 6361  needed, so we ca
+0000e180: 6e20 6361 6c6c 2074 6865 204e 756d 5079  n call the NumPy
+0000e190: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+0000e1a0: 2020 2020 2020 2020 2020 2320 6167 6169            # agai
+0000e1b0: 6e20 616e 6420 6974 2067 6574 7320 7468  n and it gets th
+0000e1c0: 6520 6368 616e 6365 2074 6f20 6469 7370  e chance to disp
+0000e1d0: 6174 6368 2074 6f20 7468 6520 7269 6768  atch to the righ
+0000e1e0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+0000e1f0: 2020 2320 696d 706c 656d 656e 7461 7469    # implementati
+0000e200: 6f6e 2e0a 2020 2020 2020 2020 2020 2020  on..            
+0000e210: 2020 2020 6172 6773 2c20 6b77 6172 6773      args, kwargs
+0000e220: 203d 2063 6f6d 7075 7465 2861 7267 732c   = compute(args,
+0000e230: 206b 7761 7267 7329 0a20 2020 2020 2020   kwargs).       
+0000e240: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000e250: 6675 6e63 282a 6172 6773 2c20 2a2a 6b77  func(*args, **kw
+0000e260: 6172 6773 290a 0a20 2020 2020 2020 2020  args)..         
+0000e270: 2020 2072 6574 7572 6e20 5f48 414e 444c     return _HANDL
+0000e280: 4544 5f46 554e 4354 494f 4e53 5b66 756e  ED_FUNCTIONS[fun
+0000e290: 635d 282a 6172 6773 2c20 2a2a 6b77 6172  c](*args, **kwar
+0000e2a0: 6773 290a 0a20 2020 2020 2020 2023 2046  gs)..        # F
+0000e2b0: 6972 7374 2c20 7665 7269 6679 2074 6861  irst, verify tha
+0000e2c0: 7420 616c 6c20 7479 7065 7320 6172 6520  t all types are 
+0000e2d0: 6861 6e64 6c65 6420 6279 2044 6173 6b2e  handled by Dask.
+0000e2e0: 204f 7468 6572 7769 7365 2c20 7265 7475   Otherwise, retu
+0000e2f0: 726e 204e 6f74 496d 706c 656d 656e 7465  rn NotImplemente
+0000e300: 642e 0a20 2020 2020 2020 2069 6620 6e6f  d..        if no
+0000e310: 7420 616c 6c28 0a20 2020 2020 2020 2020  t all(.         
+0000e320: 2020 2023 2041 6363 6570 7420 6f75 7220     # Accept our 
+0000e330: 6f77 6e20 7375 7065 7263 6c61 7373 6573  own superclasses
+0000e340: 2061 7320 7265 636f 6d6d 656e 6465 6420   as recommended 
+0000e350: 6279 204e 4550 2d31 330a 2020 2020 2020  by NEP-13.      
+0000e360: 2020 2020 2020 2320 2868 7474 7073 3a2f        # (https:/
+0000e370: 2f6e 756d 7079 2e6f 7267 2f6e 6570 732f  /numpy.org/neps/
+0000e380: 6e65 702d 3030 3133 2d75 6675 6e63 2d6f  nep-0013-ufunc-o
+0000e390: 7665 7272 6964 6573 2e68 746d 6c23 7375  verrides.html#su
+0000e3a0: 6263 6c61 7373 2d68 6965 7261 7263 6869  bclass-hierarchi
+0000e3b0: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+0000e3c0: 6973 7375 6263 6c61 7373 2874 7970 6528  issubclass(type(
+0000e3d0: 7365 6c66 292c 2074 7970 655f 2920 6f72  self), type_) or
+0000e3e0: 2069 735f 7661 6c69 645f 6368 756e 6b5f   is_valid_chunk_
+0000e3f0: 7479 7065 2874 7970 655f 290a 2020 2020  type(type_).    
+0000e400: 2020 2020 2020 2020 666f 7220 7479 7065          for type
+0000e410: 5f20 696e 2074 7970 6573 0a20 2020 2020  _ in types.     
+0000e420: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+0000e430: 2020 7265 7475 726e 204e 6f74 496d 706c    return NotImpl
+0000e440: 656d 656e 7465 640a 0a20 2020 2020 2020  emented..       
+0000e450: 2023 204e 6f77 2074 7279 2074 6f20 6669   # Now try to fi
+0000e460: 6e64 2061 206d 6174 6368 696e 6720 6675  nd a matching fu
+0000e470: 6e63 7469 6f6e 206e 616d 652e 2020 4966  nction name.  If
+0000e480: 2074 6861 7420 646f 6573 6e27 7420 776f   that doesn't wo
+0000e490: 726b 2c20 7765 206d 6179 0a20 2020 2020  rk, we may.     
+0000e4a0: 2020 2023 2062 6520 6465 616c 696e 6720     # be dealing 
+0000e4b0: 7769 7468 2061 6e20 616c 6961 7320 6f72  with an alias or
+0000e4c0: 2061 2066 756e 6374 696f 6e20 7468 6174   a function that
+0000e4d0: 2773 2073 696d 706c 7920 6e6f 7420 696e  's simply not in
+0000e4e0: 2074 6865 2044 6173 6b20 4150 492e 0a20   the Dask API.. 
+0000e4f0: 2020 2020 2020 2023 2048 616e 646c 6520         # Handle 
+0000e500: 616c 6961 7365 7320 7669 6120 7468 6520  aliases via the 
+0000e510: 5f48 414e 444c 4544 5f46 554e 4354 494f  _HANDLED_FUNCTIO
+0000e520: 4e53 2064 6963 7420 6d61 7070 696e 672c  NS dict mapping,
+0000e530: 2061 6e64 2077 6172 6e20 6f74 6865 7277   and warn otherw
+0000e540: 6973 652e 0a20 2020 2020 2020 2066 6f72  ise..        for
+0000e550: 2073 7562 6d6f 6475 6c65 2069 6e20 6675   submodule in fu
+0000e560: 6e63 2e5f 5f6d 6f64 756c 655f 5f2e 7370  nc.__module__.sp
+0000e570: 6c69 7428 222e 2229 5b31 3a5d 3a0a 2020  lit(".")[1:]:.  
+0000e580: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+0000e590: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000e5a0: 6f64 756c 6520 3d20 6765 7461 7474 7228  odule = getattr(
+0000e5b0: 6d6f 6475 6c65 2c20 7375 626d 6f64 756c  module, submodul
+0000e5c0: 6529 0a20 2020 2020 2020 2020 2020 2065  e).            e
+0000e5d0: 7863 6570 7420 4174 7472 6962 7574 6545  xcept AttributeE
+0000e5e0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+0000e5f0: 2020 2020 2020 7265 7475 726e 2068 616e        return han
+0000e600: 646c 655f 6e6f 6e6d 6174 6368 696e 675f  dle_nonmatching_
+0000e610: 6e61 6d65 7328 6675 6e63 2c20 6172 6773  names(func, args
+0000e620: 2c20 6b77 6172 6773 290a 0a20 2020 2020  , kwargs)..     
+0000e630: 2020 2069 6620 6e6f 7420 6861 7361 7474     if not hasatt
+0000e640: 7228 6d6f 6475 6c65 2c20 6675 6e63 2e5f  r(module, func._
+0000e650: 5f6e 616d 655f 5f29 3a0a 2020 2020 2020  _name__):.      
+0000e660: 2020 2020 2020 7265 7475 726e 2068 616e        return han
+0000e670: 646c 655f 6e6f 6e6d 6174 6368 696e 675f  dle_nonmatching_
+0000e680: 6e61 6d65 7328 6675 6e63 2c20 6172 6773  names(func, args
+0000e690: 2c20 6b77 6172 6773 290a 0a20 2020 2020  , kwargs)..     
+0000e6a0: 2020 2064 615f 6675 6e63 203d 2067 6574     da_func = get
+0000e6b0: 6174 7472 286d 6f64 756c 652c 2066 756e  attr(module, fun
+0000e6c0: 632e 5f5f 6e61 6d65 5f5f 290a 2020 2020  c.__name__).    
+0000e6d0: 2020 2020 6966 2064 615f 6675 6e63 2069      if da_func i
+0000e6e0: 7320 6675 6e63 3a0a 2020 2020 2020 2020  s func:.        
+0000e6f0: 2020 2020 7265 7475 726e 2068 616e 646c      return handl
+0000e700: 655f 6e6f 6e6d 6174 6368 696e 675f 6e61  e_nonmatching_na
+0000e710: 6d65 7328 6675 6e63 2c20 6172 6773 2c20  mes(func, args, 
+0000e720: 6b77 6172 6773 290a 0a20 2020 2020 2020  kwargs)..       
+0000e730: 2023 2049 6620 6060 6c69 6b65 6060 2069   # If ``like`` i
+0000e740: 7320 636f 6e74 6169 6e65 6420 696e 2060  s contained in `
+0000e750: 6064 615f 6675 6e63 6060 2773 2073 6967  `da_func``'s sig
+0000e760: 6e61 7475 7265 2c20 6164 6420 6060 6c69  nature, add ``li
+0000e770: 6b65 3d73 656c 6660 600a 2020 2020 2020  ke=self``.      
+0000e780: 2020 2320 746f 2074 6865 206b 7761 7267    # to the kwarg
+0000e790: 7320 6469 6374 696f 6e61 7279 2e0a 2020  s dictionary..  
+0000e7a0: 2020 2020 2020 6966 2068 6173 5f6b 6579        if has_key
+0000e7b0: 776f 7264 2864 615f 6675 6e63 2c20 226c  word(da_func, "l
+0000e7c0: 696b 6522 293a 0a20 2020 2020 2020 2020  ike"):.         
+0000e7d0: 2020 206b 7761 7267 735b 226c 696b 6522     kwargs["like"
+0000e7e0: 5d20 3d20 7365 6c66 0a0a 2020 2020 2020  ] = self..      
+0000e7f0: 2020 7265 7475 726e 2064 615f 6675 6e63    return da_func
+0000e800: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
+0000e810: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+0000e820: 0a20 2020 2064 6566 205f 656c 656d 7769  .    def _elemwi
+0000e830: 7365 2873 656c 6629 3a0a 2020 2020 2020  se(self):.      
+0000e840: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
+0000e850: 650a 0a20 2020 2040 7772 6170 7328 7374  e..    @wraps(st
+0000e860: 6f72 6529 0a20 2020 2064 6566 2073 746f  ore).    def sto
+0000e870: 7265 2873 656c 662c 2074 6172 6765 742c  re(self, target,
+0000e880: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0000e890: 2020 2020 7220 3d20 7374 6f72 6528 5b73      r = store([s
+0000e8a0: 656c 665d 2c20 5b74 6172 6765 745d 2c20  elf], [target], 
+0000e8b0: 2a2a 6b77 6172 6773 290a 0a20 2020 2020  **kwargs)..     
+0000e8c0: 2020 2069 6620 6b77 6172 6773 2e67 6574     if kwargs.get
+0000e8d0: 2822 7265 7475 726e 5f73 746f 7265 6422  ("return_stored"
+0000e8e0: 2c20 4661 6c73 6529 3a0a 2020 2020 2020  , False):.      
+0000e8f0: 2020 2020 2020 7220 3d20 725b 305d 0a0a        r = r[0]..
+0000e900: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000e910: 0a0a 2020 2020 6465 6620 746f 5f73 7667  ..    def to_svg
+0000e920: 2873 656c 662c 2073 697a 653d 3530 3029  (self, size=500)
+0000e930: 3a0a 2020 2020 2020 2020 2222 2243 6f6e  :.        """Con
+0000e940: 7665 7274 2063 6875 6e6b 7320 6672 6f6d  vert chunks from
+0000e950: 2044 6173 6b20 4172 7261 7920 696e 746f   Dask Array into
+0000e960: 2061 6e20 5356 4720 496d 6167 650a 0a20   an SVG Image.. 
+0000e970: 2020 2020 2020 2050 6172 616d 6574 6572         Parameter
+0000e980: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+0000e990: 2d2d 2d2d 0a20 2020 2020 2020 2063 6875  ----.        chu
+0000e9a0: 6e6b 733a 2074 7570 6c65 0a20 2020 2020  nks: tuple.     
+0000e9b0: 2020 2073 697a 653a 2069 6e74 0a20 2020     size: int.   
+0000e9c0: 2020 2020 2020 2020 2052 6f75 6768 2073           Rough s
+0000e9d0: 697a 6520 6f66 2074 6865 2069 6d61 6765  ize of the image
+0000e9e0: 0a0a 2020 2020 2020 2020 4578 616d 706c  ..        Exampl
+0000e9f0: 6573 0a20 2020 2020 2020 202d 2d2d 2d2d  es.        -----
+0000ea00: 2d2d 2d0a 2020 2020 2020 2020 3e3e 3e20  ---.        >>> 
+0000ea10: 782e 746f 5f73 7667 2873 697a 653d 3530  x.to_svg(size=50
+0000ea20: 3029 2020 2320 646f 6374 6573 743a 202b  0)  # doctest: +
+0000ea30: 534b 4950 0a0a 2020 2020 2020 2020 5265  SKIP..        Re
+0000ea40: 7475 726e 730a 2020 2020 2020 2020 2d2d  turns.        --
+0000ea50: 2d2d 2d2d 2d0a 2020 2020 2020 2020 7465  -----.        te
+0000ea60: 7874 3a20 416e 2073 7667 2073 7472 696e  xt: An svg strin
+0000ea70: 6720 6465 7069 6374 696e 6720 7468 6520  g depicting the 
+0000ea80: 6172 7261 7920 6173 2061 2067 7269 6420  array as a grid 
+0000ea90: 6f66 2063 6875 6e6b 730a 2020 2020 2020  of chunks.      
+0000eaa0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+0000eab0: 6f6d 2064 6173 6b2e 6172 7261 792e 7376  om dask.array.sv
+0000eac0: 6720 696d 706f 7274 2073 7667 0a0a 2020  g import svg..  
+0000ead0: 2020 2020 2020 7265 7475 726e 2073 7667        return svg
+0000eae0: 2873 656c 662e 6368 756e 6b73 2c20 7369  (self.chunks, si
+0000eaf0: 7a65 3d73 697a 6529 0a0a 2020 2020 6465  ze=size)..    de
+0000eb00: 6620 746f 5f68 6466 3528 7365 6c66 2c20  f to_hdf5(self, 
+0000eb10: 6669 6c65 6e61 6d65 2c20 6461 7461 7061  filename, datapa
+0000eb20: 7468 2c20 2a2a 6b77 6172 6773 293a 0a20  th, **kwargs):. 
+0000eb30: 2020 2020 2020 2022 2222 5374 6f72 6520         """Store 
+0000eb40: 6172 7261 7920 696e 2048 4446 3520 6669  array in HDF5 fi
+0000eb50: 6c65 0a0a 2020 2020 2020 2020 3e3e 3e20  le..        >>> 
+0000eb60: 782e 746f 5f68 6466 3528 276d 7966 696c  x.to_hdf5('myfil
+0000eb70: 652e 6864 6635 272c 2027 2f78 2729 2020  e.hdf5', '/x')  
+0000eb80: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
+0000eb90: 0a0a 2020 2020 2020 2020 4f70 7469 6f6e  ..        Option
+0000eba0: 616c 6c79 2070 726f 7669 6465 2061 7267  ally provide arg
+0000ebb0: 756d 656e 7473 2061 7320 7468 6f75 6768  uments as though
+0000ebc0: 2074 6f20 6060 6835 7079 2e46 696c 652e   to ``h5py.File.
+0000ebd0: 6372 6561 7465 5f64 6174 6173 6574 6060  create_dataset``
+0000ebe0: 0a0a 2020 2020 2020 2020 3e3e 3e20 782e  ..        >>> x.
+0000ebf0: 746f 5f68 6466 3528 276d 7966 696c 652e  to_hdf5('myfile.
+0000ec00: 6864 6635 272c 2027 2f78 272c 2063 6f6d  hdf5', '/x', com
+0000ec10: 7072 6573 7369 6f6e 3d27 6c7a 6627 2c20  pression='lzf', 
+0000ec20: 7368 7566 666c 653d 5472 7565 2920 2023  shuffle=True)  #
+0000ec30: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
+0000ec40: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+0000ec50: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+0000ec60: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+0000ec70: 6172 7261 792e 7374 6f72 650a 2020 2020  array.store.    
+0000ec80: 2020 2020 6835 7079 2e46 696c 652e 6372      h5py.File.cr
+0000ec90: 6561 7465 5f64 6174 6173 6574 0a20 2020  eate_dataset.   
+0000eca0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000ecb0: 2072 6574 7572 6e20 746f 5f68 6466 3528   return to_hdf5(
+0000ecc0: 6669 6c65 6e61 6d65 2c20 6461 7461 7061  filename, datapa
+0000ecd0: 7468 2c20 7365 6c66 2c20 2a2a 6b77 6172  th, self, **kwar
+0000ece0: 6773 290a 0a20 2020 2064 6566 2074 6f5f  gs)..    def to_
+0000ecf0: 6461 736b 5f64 6174 6166 7261 6d65 2873  dask_dataframe(s
+0000ed00: 656c 662c 2063 6f6c 756d 6e73 3d4e 6f6e  elf, columns=Non
+0000ed10: 652c 2069 6e64 6578 3d4e 6f6e 652c 206d  e, index=None, m
+0000ed20: 6574 613d 4e6f 6e65 293a 0a20 2020 2020  eta=None):.     
+0000ed30: 2020 2022 2222 436f 6e76 6572 7420 6461     """Convert da
+0000ed40: 736b 2041 7272 6179 2074 6f20 6461 736b  sk Array to dask
+0000ed50: 2044 6174 6166 7261 6d65 0a0a 2020 2020   Dataframe..    
+0000ed60: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
+0000ed70: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d2d         ---------
+0000ed80: 2d0a 2020 2020 2020 2020 636f 6c75 6d6e  -.        column
+0000ed90: 733a 206c 6973 7420 6f72 2073 7472 696e  s: list or strin
+0000eda0: 670a 2020 2020 2020 2020 2020 2020 6c69  g.            li
+0000edb0: 7374 206f 6620 636f 6c75 6d6e 206e 616d  st of column nam
+0000edc0: 6573 2069 6620 4461 7461 4672 616d 652c  es if DataFrame,
+0000edd0: 2073 696e 676c 6520 7374 7269 6e67 2069   single string i
+0000ede0: 6620 5365 7269 6573 0a20 2020 2020 2020  f Series.       
+0000edf0: 2069 6e64 6578 203a 2064 6173 6b2e 6461   index : dask.da
+0000ee00: 7461 6672 616d 652e 496e 6465 782c 206f  taframe.Index, o
+0000ee10: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+0000ee20: 2020 2020 416e 206f 7074 696f 6e61 6c20      An optional 
+0000ee30: 2a64 6173 6b2a 2049 6e64 6578 2074 6f20  *dask* Index to 
+0000ee40: 7573 6520 666f 7220 7468 6520 6f75 7470  use for the outp
+0000ee50: 7574 2053 6572 6965 7320 6f72 2044 6174  ut Series or Dat
+0000ee60: 6146 7261 6d65 2e0a 0a20 2020 2020 2020  aFrame...       
+0000ee70: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
+0000ee80: 206f 7574 7075 7420 696e 6465 7820 6465   output index de
+0000ee90: 7065 6e64 7320 6f6e 2077 6865 7468 6572  pends on whether
+0000eea0: 2074 6865 2061 7272 6179 2068 6173 2061   the array has a
+0000eeb0: 6e79 2075 6e6b 6e6f 776e 0a20 2020 2020  ny unknown.     
+0000eec0: 2020 2020 2020 2063 6875 6e6b 732e 2049         chunks. I
+0000eed0: 6620 7468 6572 6520 6172 6520 616e 7920  f there are any 
+0000eee0: 756e 6b6e 6f77 6e20 6368 756e 6b73 2c20  unknown chunks, 
+0000eef0: 7468 6520 6f75 7470 7574 2068 6173 2060  the output has `
+0000ef00: 604e 6f6e 6560 600a 2020 2020 2020 2020  `None``.        
+0000ef10: 2020 2020 666f 7220 616c 6c20 7468 6520      for all the 
+0000ef20: 6469 7669 7369 6f6e 7320 286f 6e65 2070  divisions (one p
+0000ef30: 6572 2063 6875 6e6b 292e 2049 6620 616c  er chunk). If al
+0000ef40: 6c20 7468 6520 6368 756e 6b73 2061 7265  l the chunks are
+0000ef50: 206b 6e6f 776e 2c0a 2020 2020 2020 2020   known,.        
+0000ef60: 2020 2020 6120 6465 6661 756c 7420 696e      a default in
+0000ef70: 6465 7820 7769 7468 206b 6e6f 776e 2064  dex with known d
+0000ef80: 6976 6973 696f 6e73 2069 7320 6372 6561  ivisions is crea
+0000ef90: 7465 642e 0a0a 2020 2020 2020 2020 2020  ted...          
+0000efa0: 2020 5370 6563 6966 7969 6e67 2060 6069    Specifying ``i
+0000efb0: 6e64 6578 6060 2063 616e 2062 6520 7573  ndex`` can be us
+0000efc0: 6566 756c 2069 6620 796f 7527 7265 2063  eful if you're c
+0000efd0: 6f6e 666f 726d 696e 6720 6120 4461 736b  onforming a Dask
+0000efe0: 2041 7272 6179 0a20 2020 2020 2020 2020   Array.         
+0000eff0: 2020 2074 6f20 616e 2065 7869 7374 696e     to an existin
+0000f000: 6720 6461 736b 2053 6572 6965 7320 6f72  g dask Series or
+0000f010: 2044 6174 6146 7261 6d65 2c20 616e 6420   DataFrame, and 
+0000f020: 796f 7520 776f 756c 6420 6c69 6b65 2074  you would like t
+0000f030: 6865 0a20 2020 2020 2020 2020 2020 2069  he.            i
+0000f040: 6e64 6963 6573 2074 6f20 6d61 7463 682e  ndices to match.
+0000f050: 0a20 2020 2020 2020 206d 6574 6120 3a20  .        meta : 
+0000f060: 6f62 6a65 6374 2c20 6f70 7469 6f6e 616c  object, optional
+0000f070: 0a20 2020 2020 2020 2020 2020 2041 6e20  .            An 
+0000f080: 6f70 7469 6f6e 616c 2060 6d65 7461 6020  optional `meta` 
+0000f090: 7061 7261 6d65 7465 7220 6361 6e20 6265  parameter can be
+0000f0a0: 2070 6173 7365 6420 666f 7220 6461 736b   passed for dask
+0000f0b0: 0a20 2020 2020 2020 2020 2020 2074 6f20  .            to 
+0000f0c0: 7370 6563 6966 7920 7468 6520 636f 6e63  specify the conc
+0000f0d0: 7265 7465 2064 6174 6166 7261 6d65 2074  rete dataframe t
+0000f0e0: 7970 6520 746f 2075 7365 2066 6f72 2070  ype to use for p
+0000f0f0: 6172 7469 7469 6f6e 7320 6f66 0a20 2020  artitions of.   
+0000f100: 2020 2020 2020 2020 2074 6865 2044 6173           the Das
+0000f110: 6b20 6461 7461 6672 616d 652e 2042 7920  k dataframe. By 
+0000f120: 6465 6661 756c 742c 2070 616e 6461 7320  default, pandas 
+0000f130: 4461 7461 4672 616d 6520 6973 2075 7365  DataFrame is use
+0000f140: 642e 0a0a 2020 2020 2020 2020 5365 6520  d...        See 
+0000f150: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+0000f160: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
+0000f170: 736b 2e64 6174 6166 7261 6d65 2e66 726f  sk.dataframe.fro
+0000f180: 6d5f 6461 736b 5f61 7272 6179 0a20 2020  m_dask_array.   
+0000f190: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000f1a0: 2066 726f 6d20 6461 736b 2e64 6174 6166   from dask.dataf
+0000f1b0: 7261 6d65 2069 6d70 6f72 7420 6672 6f6d  rame import from
+0000f1c0: 5f64 6173 6b5f 6172 7261 790a 0a20 2020  _dask_array..   
+0000f1d0: 2020 2020 2072 6574 7572 6e20 6672 6f6d       return from
+0000f1e0: 5f64 6173 6b5f 6172 7261 7928 7365 6c66  _dask_array(self
+0000f1f0: 2c20 636f 6c75 6d6e 733d 636f 6c75 6d6e  , columns=column
+0000f200: 732c 2069 6e64 6578 3d69 6e64 6578 2c20  s, index=index, 
+0000f210: 6d65 7461 3d6d 6574 6129 0a0a 2020 2020  meta=meta)..    
+0000f220: 6465 6620 746f 5f62 6163 6b65 6e64 2873  def to_backend(s
+0000f230: 656c 662c 2062 6163 6b65 6e64 3a20 7374  elf, backend: st
+0000f240: 7220 7c20 4e6f 6e65 203d 204e 6f6e 652c  r | None = None,
+0000f250: 202a 2a6b 7761 7267 7329 3a0a 2020 2020   **kwargs):.    
+0000f260: 2020 2020 2222 224d 6f76 6520 746f 2061      """Move to a
+0000f270: 206e 6577 2041 7272 6179 2062 6163 6b65   new Array backe
+0000f280: 6e64 0a0a 2020 2020 2020 2020 5061 7261  nd..        Para
+0000f290: 6d65 7465 7273 0a20 2020 2020 2020 202d  meters.        -
+0000f2a0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020  ---------.      
+0000f2b0: 2020 6261 636b 656e 6420 3a20 7374 722c    backend : str,
+0000f2c0: 204f 7074 696f 6e61 6c0a 2020 2020 2020   Optional.      
+0000f2d0: 2020 2020 2020 5468 6520 6e61 6d65 206f        The name o
+0000f2e0: 6620 7468 6520 6e65 7720 6261 636b 656e  f the new backen
+0000f2f0: 6420 746f 206d 6f76 6520 746f 2e20 5468  d to move to. Th
+0000f300: 6520 6465 6661 756c 740a 2020 2020 2020  e default.      
+0000f310: 2020 2020 2020 6973 2074 6865 2063 7572        is the cur
+0000f320: 7265 6e74 2022 6172 7261 792e 6261 636b  rent "array.back
+0000f330: 656e 6422 2063 6f6e 6669 6775 7261 7469  end" configurati
+0000f340: 6f6e 2e0a 0a20 2020 2020 2020 2052 6574  on...        Ret
+0000f350: 7572 6e73 0a20 2020 2020 2020 202d 2d2d  urns.        ---
+0000f360: 2d2d 2d2d 0a20 2020 2020 2020 2041 7272  ----.        Arr
+0000f370: 6179 0a20 2020 2020 2020 2022 2222 0a20  ay.        """. 
+0000f380: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+0000f390: 2e61 7272 6179 2e63 7265 6174 696f 6e20  .array.creation 
+0000f3a0: 696d 706f 7274 2074 6f5f 6261 636b 656e  import to_backen
+0000f3b0: 640a 0a20 2020 2020 2020 2072 6574 7572  d..        retur
+0000f3c0: 6e20 746f 5f62 6163 6b65 6e64 2873 656c  n to_backend(sel
+0000f3d0: 662c 2062 6163 6b65 6e64 3d62 6163 6b65  f, backend=backe
+0000f3e0: 6e64 2c20 2a2a 6b77 6172 6773 290a 0a20  nd, **kwargs).. 
+0000f3f0: 2020 2064 6566 205f 5f62 6f6f 6c5f 5f28     def __bool__(
+0000f400: 7365 6c66 293a 0a20 2020 2020 2020 2069  self):.        i
+0000f410: 6620 7365 6c66 2e73 697a 6520 3e20 313a  f self.size > 1:
+0000f420: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000f430: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+0000f440: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000f450: 2254 6865 2074 7275 7468 2076 616c 7565  "The truth value
+0000f460: 206f 6620 6120 7b73 656c 662e 5f5f 636c   of a {self.__cl
+0000f470: 6173 735f 5f2e 5f5f 6e61 6d65 5f5f 7d20  ass__.__name__} 
+0000f480: 6973 2061 6d62 6967 756f 7573 2e20 220a  is ambiguous. ".
+0000f490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f4a0: 2255 7365 2061 2e61 6e79 2829 206f 7220  "Use a.any() or 
+0000f4b0: 612e 616c 6c28 292e 220a 2020 2020 2020  a.all().".      
+0000f4c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000f4d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000f4e0: 2020 7265 7475 726e 2062 6f6f 6c28 7365    return bool(se
+0000f4f0: 6c66 2e63 6f6d 7075 7465 2829 290a 0a20  lf.compute()).. 
+0000f500: 2020 205f 5f6e 6f6e 7a65 726f 5f5f 203d     __nonzero__ =
+0000f510: 205f 5f62 6f6f 6c5f 5f20 2023 2070 7974   __bool__  # pyt
+0000f520: 686f 6e20 320a 0a20 2020 2064 6566 205f  hon 2..    def _
+0000f530: 7363 616c 6172 6675 6e63 2873 656c 662c  scalarfunc(self,
+0000f540: 2063 6173 745f 7479 7065 293a 0a20 2020   cast_type):.   
+0000f550: 2020 2020 2069 6620 7365 6c66 2e73 697a       if self.siz
+0000f560: 6520 3e20 313a 0a20 2020 2020 2020 2020  e > 1:.         
+0000f570: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
+0000f580: 6f72 2822 4f6e 6c79 206c 656e 6774 682d  or("Only length-
+0000f590: 3120 6172 7261 7973 2063 616e 2062 6520  1 arrays can be 
+0000f5a0: 636f 6e76 6572 7465 6420 746f 2050 7974  converted to Pyt
+0000f5b0: 686f 6e20 7363 616c 6172 7322 290a 2020  hon scalars").  
+0000f5c0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000f5d0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+0000f5e0: 6173 745f 7479 7065 2873 656c 662e 636f  ast_type(self.co
+0000f5f0: 6d70 7574 6528 292e 6974 656d 2829 290a  mpute().item()).
+0000f600: 0a20 2020 2064 6566 205f 5f69 6e74 5f5f  .    def __int__
+0000f610: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+0000f620: 7265 7475 726e 2073 656c 662e 5f73 6361  return self._sca
+0000f630: 6c61 7266 756e 6328 696e 7429 0a0a 2020  larfunc(int)..  
+0000f640: 2020 5f5f 6c6f 6e67 5f5f 203d 205f 5f69    __long__ = __i
+0000f650: 6e74 5f5f 2020 2320 7079 7468 6f6e 2032  nt__  # python 2
+0000f660: 0a0a 2020 2020 6465 6620 5f5f 666c 6f61  ..    def __floa
+0000f670: 745f 5f28 7365 6c66 293a 0a20 2020 2020  t__(self):.     
+0000f680: 2020 2072 6574 7572 6e20 7365 6c66 2e5f     return self._
+0000f690: 7363 616c 6172 6675 6e63 2866 6c6f 6174  scalarfunc(float
+0000f6a0: 290a 0a20 2020 2064 6566 205f 5f63 6f6d  )..    def __com
+0000f6b0: 706c 6578 5f5f 2873 656c 6629 3a0a 2020  plex__(self):.  
+0000f6c0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000f6d0: 662e 5f73 6361 6c61 7266 756e 6328 636f  f._scalarfunc(co
+0000f6e0: 6d70 6c65 7829 0a0a 2020 2020 6465 6620  mplex)..    def 
+0000f6f0: 5f5f 696e 6465 785f 5f28 7365 6c66 293a  __index__(self):
+0000f700: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000f710: 7365 6c66 2e5f 7363 616c 6172 6675 6e63  self._scalarfunc
+0000f720: 286f 7065 7261 746f 722e 696e 6465 7829  (operator.index)
+0000f730: 0a0a 2020 2020 6465 6620 5f5f 7365 7469  ..    def __seti
+0000f740: 7465 6d5f 5f28 7365 6c66 2c20 6b65 792c  tem__(self, key,
+0000f750: 2076 616c 7565 293a 0a20 2020 2020 2020   value):.       
+0000f760: 2069 6620 7661 6c75 6520 6973 206e 702e   if value is np.
+0000f770: 6d61 2e6d 6173 6b65 643a 0a20 2020 2020  ma.masked:.     
+0000f780: 2020 2020 2020 2076 616c 7565 203d 206e         value = n
+0000f790: 702e 6d61 2e6d 6173 6b65 645f 616c 6c28  p.ma.masked_all(
+0000f7a0: 2829 2c20 6474 7970 653d 7365 6c66 2e64  (), dtype=self.d
+0000f7b0: 7479 7065 290a 0a20 2020 2020 2020 2069  type)..        i
+0000f7c0: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
+0000f7d0: 6e6f 7420 6973 5f64 6173 6b5f 636f 6c6c  not is_dask_coll
+0000f7e0: 6563 7469 6f6e 2876 616c 7565 290a 2020  ection(value).  
+0000f7f0: 2020 2020 2020 2020 2020 616e 6420 6973            and is
+0000f800: 7375 6263 6c61 7373 2873 656c 662e 6474  subclass(self.dt
+0000f810: 7970 652e 7479 7065 2c20 496e 7465 6772  ype.type, Integr
+0000f820: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+0000f830: 616e 6420 6e70 2e69 736e 616e 2876 616c  and np.isnan(val
+0000f840: 7565 292e 616e 7928 290a 2020 2020 2020  ue).any().      
+0000f850: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+0000f860: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000f870: 7228 2263 616e 6e6f 7420 636f 6e76 6572  r("cannot conver
+0000f880: 7420 666c 6f61 7420 4e61 4e20 746f 2069  t float NaN to i
+0000f890: 6e74 6567 6572 2229 0a0a 2020 2020 2020  nteger")..      
+0000f8a0: 2020 2323 2055 7365 2074 6865 2022 7768    ## Use the "wh
+0000f8b0: 6572 6522 206d 6574 686f 6420 666f 7220  ere" method for 
+0000f8c0: 6361 7365 7320 7768 656e 206b 6579 2069  cases when key i
+0000f8d0: 7320 616e 2041 7272 6179 0a20 2020 2020  s an Array.     
+0000f8e0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0000f8f0: 286b 6579 2c20 4172 7261 7929 3a0a 2020  (key, Array):.  
+0000f900: 2020 2020 2020 2020 2020 6672 6f6d 2064            from d
+0000f910: 6173 6b2e 6172 7261 792e 726f 7574 696e  ask.array.routin
+0000f920: 6573 2069 6d70 6f72 7420 7768 6572 650a  es import where.
+0000f930: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+0000f940: 6973 696e 7374 616e 6365 2876 616c 7565  isinstance(value
+0000f950: 2c20 4172 7261 7929 2061 6e64 2076 616c  , Array) and val
+0000f960: 7565 2e6e 6469 6d20 3e20 313a 0a20 2020  ue.ndim > 1:.   
+0000f970: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000f980: 7365 2056 616c 7565 4572 726f 7228 2262  se ValueError("b
+0000f990: 6f6f 6c65 616e 2069 6e64 6578 2061 7272  oolean index arr
+0000f9a0: 6179 2073 686f 756c 6420 6861 7665 2031  ay should have 1
+0000f9b0: 2064 696d 656e 7369 6f6e 2229 0a20 2020   dimension").   
+0000f9c0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000f9d0: 2020 2020 2020 2020 2020 2020 2020 7920                y 
+0000f9e0: 3d20 7768 6572 6528 6b65 792c 2076 616c  = where(key, val
+0000f9f0: 7565 2c20 7365 6c66 290a 2020 2020 2020  ue, self).      
+0000fa00: 2020 2020 2020 6578 6365 7074 2056 616c        except Val
+0000fa10: 7565 4572 726f 7220 6173 2065 3a0a 2020  ueError as e:.  
+0000fa20: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+0000fa30: 6973 6520 5661 6c75 6545 7272 6f72 280a  ise ValueError(.
+0000fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000fa50: 2020 2020 2242 6f6f 6c65 616e 2069 6e64      "Boolean ind
+0000fa60: 6578 2061 7373 6967 6e6d 656e 7420 696e  ex assignment in
+0000fa70: 2044 6173 6b20 220a 2020 2020 2020 2020   Dask ".        
+0000fa80: 2020 2020 2020 2020 2020 2020 2265 7870              "exp
+0000fa90: 6563 7473 2065 7175 616c 6c79 2073 6861  ects equally sha
+0000faa0: 7065 6420 6172 7261 7973 2e5c 6e45 7861  ped arrays.\nExa
+0000fab0: 6d70 6c65 3a20 6461 315b 6461 325d 203d  mple: da1[da2] =
+0000fac0: 2064 6133 2022 0a20 2020 2020 2020 2020   da3 ".         
+0000fad0: 2020 2020 2020 2020 2020 2022 7768 6572             "wher
+0000fae0: 6520 6461 312e 7368 6170 6520 3d3d 2028  e da1.shape == (
+0000faf0: 342c 292c 2064 6132 2e73 6861 7065 203d  4,), da2.shape =
+0000fb00: 3d20 2834 2c29 2022 0a20 2020 2020 2020  = (4,) ".       
+0000fb10: 2020 2020 2020 2020 2020 2020 2022 616e               "an
+0000fb20: 6420 6461 332e 7368 6170 6520 3d3d 2028  d da3.shape == (
+0000fb30: 342c 292e 5c6e 220a 2020 2020 2020 2020  4,).\n".        
+0000fb40: 2020 2020 2020 2020 2020 2020 2241 6c74              "Alt
+0000fb50: 6572 6e61 7469 7665 6c79 2c20 796f 7520  ernatively, you 
+0000fb60: 6361 6e20 7573 6520 7468 6520 6578 7465  can use the exte
+0000fb70: 6e64 6564 2041 5049 2074 6861 7420 7375  nded API that su
+0000fb80: 7070 6f72 7473 220a 2020 2020 2020 2020  pports".        
+0000fb90: 2020 2020 2020 2020 2020 2020 2269 6e64              "ind
+0000fba0: 6578 696e 6720 7769 7468 2074 7570 6c65  exing with tuple
+0000fbb0: 732e 5c6e 4578 616d 706c 653a 2064 6131  s.\nExample: da1
+0000fbc0: 5b28 6461 322c 295d 203d 2064 6133 2e22  [(da2,)] = da3."
+0000fbd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000fbe0: 2029 2066 726f 6d20 650a 2020 2020 2020   ) from e.      
+0000fbf0: 2020 2020 2020 7365 6c66 2e5f 6d65 7461        self._meta
+0000fc00: 203d 2079 2e5f 6d65 7461 0a20 2020 2020   = y._meta.     
+0000fc10: 2020 2020 2020 2073 656c 662e 6461 736b         self.dask
+0000fc20: 203d 2079 2e64 6173 6b0a 2020 2020 2020   = y.dask.      
+0000fc30: 2020 2020 2020 7365 6c66 2e5f 6e61 6d65        self._name
+0000fc40: 203d 2079 2e6e 616d 650a 2020 2020 2020   = y.name.      
+0000fc50: 2020 2020 2020 7365 6c66 2e5f 6368 756e        self._chun
+0000fc60: 6b73 203d 2079 2e63 6875 6e6b 730a 2020  ks = y.chunks.  
+0000fc70: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000fc80: 0a0a 2020 2020 2020 2020 6966 206e 702e  ..        if np.
+0000fc90: 6973 6e61 6e28 7365 6c66 2e73 6861 7065  isnan(self.shape
+0000fca0: 292e 616e 7928 293a 0a20 2020 2020 2020  ).any():.       
+0000fcb0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000fcc0: 4572 726f 7228 6622 4172 7261 7973 2063  Error(f"Arrays c
+0000fcd0: 6875 6e6b 2073 697a 6573 2061 7265 2075  hunk sizes are u
+0000fce0: 6e6b 6e6f 776e 2e20 7b75 6e6b 6e6f 776e  nknown. {unknown
+0000fcf0: 5f63 6875 6e6b 5f6d 6573 7361 6765 7d22  _chunk_message}"
+0000fd00: 290a 0a20 2020 2020 2020 2023 2053 7469  )..        # Sti
+0000fd10: 6c6c 2068 6572 653f 2054 6865 6e20 6170  ll here? Then ap
+0000fd20: 706c 7920 7468 6520 6173 7369 676e 6d65  ply the assignme
+0000fd30: 6e74 2074 6f20 6f74 6865 7220 7479 7065  nt to other type
+0000fd40: 206f 660a 2020 2020 2020 2020 2320 696e   of.        # in
+0000fd50: 6469 6365 7320 7669 6120 7468 6520 6073  dices via the `s
+0000fd60: 6574 6974 656d 5f61 7272 6179 6020 6675  etitem_array` fu
+0000fd70: 6e63 7469 6f6e 2e0a 2020 2020 2020 2020  nction..        
+0000fd80: 7661 6c75 6520 3d20 6173 616e 7961 7272  value = asanyarr
+0000fd90: 6179 2876 616c 7565 290a 0a20 2020 2020  ay(value)..     
+0000fda0: 2020 206f 7574 203d 2022 7365 7469 7465     out = "setite
+0000fdb0: 6d2d 2220 2b20 746f 6b65 6e69 7a65 2873  m-" + tokenize(s
+0000fdc0: 656c 662c 206b 6579 2c20 7661 6c75 6529  elf, key, value)
+0000fdd0: 0a20 2020 2020 2020 2064 736b 203d 2073  .        dsk = s
+0000fde0: 6574 6974 656d 5f61 7272 6179 286f 7574  etitem_array(out
+0000fdf0: 2c20 7365 6c66 2c20 6b65 792c 2076 616c  , self, key, val
+0000fe00: 7565 290a 0a20 2020 2020 2020 206d 6574  ue)..        met
+0000fe10: 6120 3d20 6d65 7461 5f66 726f 6d5f 6172  a = meta_from_ar
+0000fe20: 7261 7928 7365 6c66 2e5f 6d65 7461 290a  ray(self._meta).
+0000fe30: 2020 2020 2020 2020 6966 206e 702e 6973          if np.is
+0000fe40: 7363 616c 6172 286d 6574 6129 3a0a 2020  scalar(meta):.  
+0000fe50: 2020 2020 2020 2020 2020 6d65 7461 203d            meta =
+0000fe60: 206e 702e 6172 7261 7928 6d65 7461 290a   np.array(meta).
+0000fe70: 0a20 2020 2020 2020 2067 7261 7068 203d  .        graph =
+0000fe80: 2048 6967 684c 6576 656c 4772 6170 682e   HighLevelGraph.
+0000fe90: 6672 6f6d 5f63 6f6c 6c65 6374 696f 6e73  from_collections
+0000fea0: 286f 7574 2c20 6473 6b2c 2064 6570 656e  (out, dsk, depen
+0000feb0: 6465 6e63 6965 733d 5b73 656c 665d 290a  dencies=[self]).
+0000fec0: 2020 2020 2020 2020 7920 3d20 4172 7261          y = Arra
+0000fed0: 7928 6772 6170 682c 206f 7574 2c20 6368  y(graph, out, ch
+0000fee0: 756e 6b73 3d73 656c 662e 6368 756e 6b73  unks=self.chunks
+0000fef0: 2c20 6474 7970 653d 7365 6c66 2e64 7479  , dtype=self.dty
+0000ff00: 7065 2c20 6d65 7461 3d6d 6574 6129 0a0a  pe, meta=meta)..
+0000ff10: 2020 2020 2020 2020 7365 6c66 2e5f 6d65          self._me
+0000ff20: 7461 203d 2079 2e5f 6d65 7461 0a20 2020  ta = y._meta.   
+0000ff30: 2020 2020 2073 656c 662e 6461 736b 203d       self.dask =
+0000ff40: 2079 2e64 6173 6b0a 2020 2020 2020 2020   y.dask.        
+0000ff50: 7365 6c66 2e5f 6e61 6d65 203d 2079 2e6e  self._name = y.n
+0000ff60: 616d 650a 2020 2020 2020 2020 7365 6c66  ame.        self
+0000ff70: 2e5f 6368 756e 6b73 203d 2079 2e63 6875  ._chunks = y.chu
+0000ff80: 6e6b 730a 0a20 2020 2064 6566 205f 5f67  nks..    def __g
+0000ff90: 6574 6974 656d 5f5f 2873 656c 662c 2069  etitem__(self, i
+0000ffa0: 6e64 6578 293a 0a20 2020 2020 2020 2023  ndex):.        #
+0000ffb0: 2046 6965 6c64 2061 6363 6573 732c 2065   Field access, e
+0000ffc0: 2e67 2e20 785b 2761 275d 206f 7220 785b  .g. x['a'] or x[
+0000ffd0: 5b27 6127 2c20 2762 275d 5d0a 2020 2020  ['a', 'b']].    
+0000ffe0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000fff0: 6528 696e 6465 782c 2073 7472 2920 6f72  e(index, str) or
+00010000: 2028 0a20 2020 2020 2020 2020 2020 2069   (.            i
+00010010: 7369 6e73 7461 6e63 6528 696e 6465 782c  sinstance(index,
+00010020: 206c 6973 7429 2061 6e64 2069 6e64 6578   list) and index
+00010030: 2061 6e64 2061 6c6c 2869 7369 6e73 7461   and all(isinsta
+00010040: 6e63 6528 692c 2073 7472 2920 666f 7220  nce(i, str) for 
+00010050: 6920 696e 2069 6e64 6578 290a 2020 2020  i in index).    
+00010060: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00010070: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+00010080: 2869 6e64 6578 2c20 7374 7229 3a0a 2020  (index, str):.  
+00010090: 2020 2020 2020 2020 2020 2020 2020 6474                dt
+000100a0: 203d 2073 656c 662e 6474 7970 655b 696e   = self.dtype[in
+000100b0: 6465 785d 0a20 2020 2020 2020 2020 2020  dex].           
+000100c0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+000100d0: 2020 2020 2020 2064 7420 3d20 6e70 2e64         dt = np.d
+000100e0: 7479 7065 280a 2020 2020 2020 2020 2020  type(.          
+000100f0: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+00010100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010110: 2020 2020 226e 616d 6573 223a 2069 6e64      "names": ind
+00010120: 6578 2c0a 2020 2020 2020 2020 2020 2020  ex,.            
+00010130: 2020 2020 2020 2020 2020 2020 2266 6f72              "for
+00010140: 6d61 7473 223a 205b 7365 6c66 2e64 7479  mats": [self.dty
+00010150: 7065 2e66 6965 6c64 735b 6e61 6d65 5d5b  pe.fields[name][
+00010160: 305d 2066 6f72 206e 616d 6520 696e 2069  0] for name in i
+00010170: 6e64 6578 5d2c 0a20 2020 2020 2020 2020  ndex],.         
+00010180: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+00010190: 6f66 6673 6574 7322 3a20 5b73 656c 662e  offsets": [self.
+000101a0: 6474 7970 652e 6669 656c 6473 5b6e 616d  dtype.fields[nam
+000101b0: 655d 5b31 5d20 666f 7220 6e61 6d65 2069  e][1] for name i
+000101c0: 6e20 696e 6465 785d 2c0a 2020 2020 2020  n index],.      
+000101d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000101e0: 2020 2269 7465 6d73 697a 6522 3a20 7365    "itemsize": se
+000101f0: 6c66 2e64 7479 7065 2e69 7465 6d73 697a  lf.dtype.itemsiz
+00010200: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00010210: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00010220: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
+00010230: 2020 2020 2020 2020 6966 2064 742e 7368          if dt.sh
+00010240: 6170 653a 0a20 2020 2020 2020 2020 2020  ape:.           
+00010250: 2020 2020 206e 6577 5f61 7869 7320 3d20       new_axis = 
+00010260: 6c69 7374 2872 616e 6765 2873 656c 662e  list(range(self.
+00010270: 6e64 696d 2c20 7365 6c66 2e6e 6469 6d20  ndim, self.ndim 
+00010280: 2b20 6c65 6e28 6474 2e73 6861 7065 2929  + len(dt.shape))
+00010290: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000102a0: 2020 6368 756e 6b73 203d 2073 656c 662e    chunks = self.
+000102b0: 6368 756e 6b73 202b 2074 7570 6c65 2828  chunks + tuple((
+000102c0: 692c 2920 666f 7220 6920 696e 2064 742e  i,) for i in dt.
+000102d0: 7368 6170 6529 0a20 2020 2020 2020 2020  shape).         
+000102e0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000102f0: 6c66 2e6d 6170 5f62 6c6f 636b 7328 0a20  lf.map_blocks(. 
+00010300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010310: 2020 2067 6574 6974 656d 2c20 696e 6465     getitem, inde
+00010320: 782c 2064 7479 7065 3d64 742e 6261 7365  x, dtype=dt.base
+00010330: 2c20 6368 756e 6b73 3d63 6875 6e6b 732c  , chunks=chunks,
+00010340: 206e 6577 5f61 7869 733d 6e65 775f 6178   new_axis=new_ax
+00010350: 6973 0a20 2020 2020 2020 2020 2020 2020  is.             
+00010360: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00010370: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00010380: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00010390: 6c66 2e6d 6170 5f62 6c6f 636b 7328 6765  lf.map_blocks(ge
+000103a0: 7469 7465 6d2c 2069 6e64 6578 2c20 6474  titem, index, dt
+000103b0: 7970 653d 6474 290a 0a20 2020 2020 2020  ype=dt)..       
+000103c0: 2069 6620 6e6f 7420 6973 696e 7374 616e   if not isinstan
+000103d0: 6365 2869 6e64 6578 2c20 7475 706c 6529  ce(index, tuple)
+000103e0: 3a0a 2020 2020 2020 2020 2020 2020 696e  :.            in
+000103f0: 6465 7820 3d20 2869 6e64 6578 2c29 0a0a  dex = (index,)..
+00010400: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+00010410: 6b2e 6172 7261 792e 736c 6963 696e 6720  k.array.slicing 
+00010420: 696d 706f 7274 2028 0a20 2020 2020 2020  import (.       
+00010430: 2020 2020 206e 6f72 6d61 6c69 7a65 5f69       normalize_i
+00010440: 6e64 6578 2c0a 2020 2020 2020 2020 2020  ndex,.          
+00010450: 2020 736c 6963 655f 7769 7468 5f62 6f6f    slice_with_boo
+00010460: 6c5f 6461 736b 5f61 7272 6179 2c0a 2020  l_dask_array,.  
+00010470: 2020 2020 2020 2020 2020 736c 6963 655f            slice_
+00010480: 7769 7468 5f69 6e74 5f64 6173 6b5f 6172  with_int_dask_ar
+00010490: 7261 792c 0a20 2020 2020 2020 2029 0a0a  ray,.        )..
+000104a0: 2020 2020 2020 2020 696e 6465 7832 203d          index2 =
+000104b0: 206e 6f72 6d61 6c69 7a65 5f69 6e64 6578   normalize_index
+000104c0: 2869 6e64 6578 2c20 7365 6c66 2e73 6861  (index, self.sha
+000104d0: 7065 290a 2020 2020 2020 2020 6465 7065  pe).        depe
+000104e0: 6e64 656e 6369 6573 203d 207b 7365 6c66  ndencies = {self
+000104f0: 2e6e 616d 657d 0a20 2020 2020 2020 2066  .name}.        f
+00010500: 6f72 2069 2069 6e20 696e 6465 7832 3a0a  or i in index2:.
+00010510: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00010520: 7369 6e73 7461 6e63 6528 692c 2041 7272  sinstance(i, Arr
+00010530: 6179 293a 0a20 2020 2020 2020 2020 2020  ay):.           
+00010540: 2020 2020 2064 6570 656e 6465 6e63 6965       dependencie
+00010550: 732e 6164 6428 692e 6e61 6d65 290a 0a20  s.add(i.name).. 
+00010560: 2020 2020 2020 2069 6620 616e 7928 6973         if any(is
+00010570: 696e 7374 616e 6365 2869 2c20 4172 7261  instance(i, Arra
+00010580: 7929 2061 6e64 2069 2e64 7479 7065 2e6b  y) and i.dtype.k
+00010590: 696e 6420 696e 2022 6975 2220 666f 7220  ind in "iu" for 
+000105a0: 6920 696e 2069 6e64 6578 3229 3a0a 2020  i in index2):.  
+000105b0: 2020 2020 2020 2020 2020 7365 6c66 2c20            self, 
+000105c0: 696e 6465 7832 203d 2073 6c69 6365 5f77  index2 = slice_w
+000105d0: 6974 685f 696e 745f 6461 736b 5f61 7272  ith_int_dask_arr
+000105e0: 6179 2873 656c 662c 2069 6e64 6578 3229  ay(self, index2)
+000105f0: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+00010600: 6973 696e 7374 616e 6365 2869 2c20 4172  isinstance(i, Ar
+00010610: 7261 7929 2061 6e64 2069 2e64 7479 7065  ray) and i.dtype
+00010620: 203d 3d20 626f 6f6c 2066 6f72 2069 2069   == bool for i i
+00010630: 6e20 696e 6465 7832 293a 0a20 2020 2020  n index2):.     
+00010640: 2020 2020 2020 2073 656c 662c 2069 6e64         self, ind
+00010650: 6578 3220 3d20 736c 6963 655f 7769 7468  ex2 = slice_with
+00010660: 5f62 6f6f 6c5f 6461 736b 5f61 7272 6179  _bool_dask_array
+00010670: 2873 656c 662c 2069 6e64 6578 3229 0a0a  (self, index2)..
+00010680: 2020 2020 2020 2020 6966 2061 6c6c 2869          if all(i
+00010690: 7369 6e73 7461 6e63 6528 692c 2073 6c69  sinstance(i, sli
+000106a0: 6365 2920 616e 6420 6920 3d3d 2073 6c69  ce) and i == sli
+000106b0: 6365 284e 6f6e 6529 2066 6f72 2069 2069  ce(None) for i i
+000106c0: 6e20 696e 6465 7832 293a 0a20 2020 2020  n index2):.     
+000106d0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000106e0: 6c66 0a0a 2020 2020 2020 2020 6f75 7420  lf..        out 
+000106f0: 3d20 2267 6574 6974 656d 2d22 202b 2074  = "getitem-" + t
+00010700: 6f6b 656e 697a 6528 7365 6c66 2c20 696e  okenize(self, in
+00010710: 6465 7832 290a 2020 2020 2020 2020 6473  dex2).        ds
+00010720: 6b2c 2063 6875 6e6b 7320 3d20 736c 6963  k, chunks = slic
+00010730: 655f 6172 7261 7928 6f75 742c 2073 656c  e_array(out, sel
+00010740: 662e 6e61 6d65 2c20 7365 6c66 2e63 6875  f.name, self.chu
+00010750: 6e6b 732c 2069 6e64 6578 322c 2073 656c  nks, index2, sel
+00010760: 662e 6974 656d 7369 7a65 290a 0a20 2020  f.itemsize)..   
+00010770: 2020 2020 2067 7261 7068 203d 2048 6967       graph = Hig
+00010780: 684c 6576 656c 4772 6170 682e 6672 6f6d  hLevelGraph.from
+00010790: 5f63 6f6c 6c65 6374 696f 6e73 286f 7574  _collections(out
+000107a0: 2c20 6473 6b2c 2064 6570 656e 6465 6e63  , dsk, dependenc
+000107b0: 6965 733d 5b73 656c 665d 290a 0a20 2020  ies=[self])..   
+000107c0: 2020 2020 206d 6574 6120 3d20 6d65 7461       meta = meta
+000107d0: 5f66 726f 6d5f 6172 7261 7928 7365 6c66  _from_array(self
+000107e0: 2e5f 6d65 7461 2c20 6e64 696d 3d6c 656e  ._meta, ndim=len
+000107f0: 2863 6875 6e6b 7329 290a 2020 2020 2020  (chunks)).      
+00010800: 2020 6966 206e 702e 6973 7363 616c 6172    if np.isscalar
+00010810: 286d 6574 6129 3a0a 2020 2020 2020 2020  (meta):.        
+00010820: 2020 2020 6d65 7461 203d 206e 702e 6172      meta = np.ar
+00010830: 7261 7928 6d65 7461 290a 0a20 2020 2020  ray(meta)..     
+00010840: 2020 2072 6574 7572 6e20 4172 7261 7928     return Array(
+00010850: 6772 6170 682c 206f 7574 2c20 6368 756e  graph, out, chun
+00010860: 6b73 2c20 6d65 7461 3d6d 6574 6129 0a0a  ks, meta=meta)..
+00010870: 2020 2020 6465 6620 5f76 696e 6465 7828      def _vindex(
+00010880: 7365 6c66 2c20 6b65 7929 3a0a 2020 2020  self, key):.    
+00010890: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
+000108a0: 7461 6e63 6528 6b65 792c 2074 7570 6c65  tance(key, tuple
+000108b0: 293a 0a20 2020 2020 2020 2020 2020 206b  ):.            k
+000108c0: 6579 203d 2028 6b65 792c 290a 2020 2020  ey = (key,).    
+000108d0: 2020 2020 6966 2061 6e79 286b 2069 7320      if any(k is 
+000108e0: 4e6f 6e65 2066 6f72 206b 2069 6e20 6b65  None for k in ke
+000108f0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
+00010900: 7261 6973 6520 496e 6465 7845 7272 6f72  raise IndexError
+00010910: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00010920: 2020 2276 696e 6465 7820 646f 6573 206e    "vindex does n
+00010930: 6f74 2073 7570 706f 7274 2069 6e64 6578  ot support index
+00010940: 696e 6720 7769 7468 204e 6f6e 6520 286e  ing with None (n
+00010950: 702e 6e65 7761 7869 7329 2c20 220a 2020  p.newaxis), ".  
+00010960: 2020 2020 2020 2020 2020 2020 2020 2267                "g
+00010970: 6f74 207b 7d22 2e66 6f72 6d61 7428 6b65  ot {}".format(ke
+00010980: 7929 0a20 2020 2020 2020 2020 2020 2029  y).            )
+00010990: 0a20 2020 2020 2020 2069 6620 616c 6c28  .        if all(
+000109a0: 6973 696e 7374 616e 6365 286b 2c20 736c  isinstance(k, sl
+000109b0: 6963 6529 2066 6f72 206b 2069 6e20 6b65  ice) for k in ke
+000109c0: 7929 3a0a 2020 2020 2020 2020 2020 2020  y):.            
+000109d0: 6966 2061 6c6c 280a 2020 2020 2020 2020  if all(.        
+000109e0: 2020 2020 2020 2020 6b2e 696e 6469 6365          k.indice
+000109f0: 7328 6429 203d 3d20 736c 6963 6528 302c  s(d) == slice(0,
+00010a00: 2064 292e 696e 6469 6365 7328 6429 2066   d).indices(d) f
+00010a10: 6f72 206b 2c20 6420 696e 207a 6970 286b  or k, d in zip(k
+00010a20: 6579 2c20 7365 6c66 2e73 6861 7065 290a  ey, self.shape).
+00010a30: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+00010a40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00010a50: 6574 7572 6e20 7365 6c66 0a20 2020 2020  eturn self.     
+00010a60: 2020 2020 2020 2072 6169 7365 2049 6e64         raise Ind
+00010a70: 6578 4572 726f 7228 0a20 2020 2020 2020  exError(.       
+00010a80: 2020 2020 2020 2020 2022 7669 6e64 6578           "vindex
+00010a90: 2072 6571 7569 7265 7320 6174 206c 6561   requires at lea
+00010aa0: 7374 206f 6e65 206e 6f6e 2d73 6c69 6365  st one non-slice
+00010ab0: 2074 6f20 7665 6374 6f72 697a 6520 6f76   to vectorize ov
+00010ac0: 6572 2022 0a20 2020 2020 2020 2020 2020  er ".           
+00010ad0: 2020 2020 2022 7768 656e 2074 6865 2073       "when the s
+00010ae0: 6c69 6365 7320 6172 6520 6e6f 7420 6f76  lices are not ov
+00010af0: 6572 2074 6865 2065 6e74 6972 6520 6172  er the entire ar
+00010b00: 7261 7920 2869 2e65 2c20 785b 3a5d 292e  ray (i.e, x[:]).
+00010b10: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00010b20: 2020 2022 5573 6520 6e6f 726d 616c 2073     "Use normal s
+00010b30: 6c69 6369 6e67 2069 6e73 7465 6164 2077  licing instead w
+00010b40: 6865 6e20 6f6e 6c79 2075 7369 6e67 2073  hen only using s
+00010b50: 6c69 6365 732e 2047 6f74 3a20 7b7d 222e  lices. Got: {}".
+00010b60: 666f 726d 6174 286b 6579 290a 2020 2020  format(key).    
+00010b70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00010b80: 2020 656c 6966 2061 6e79 2869 735f 6461    elif any(is_da
+00010b90: 736b 5f63 6f6c 6c65 6374 696f 6e28 6b29  sk_collection(k)
+00010ba0: 2066 6f72 206b 2069 6e20 6b65 7929 3a0a   for k in key):.
+00010bb0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00010bc0: 6520 496e 6465 7845 7272 6f72 280a 2020  e IndexError(.  
+00010bd0: 2020 2020 2020 2020 2020 2020 2020 2276                "v
+00010be0: 696e 6465 7820 646f 6573 206e 6f74 2073  index does not s
+00010bf0: 7570 706f 7274 2069 6e64 6578 696e 6720  upport indexing 
+00010c00: 7769 7468 2064 6173 6b20 6f62 6a65 6374  with dask object
+00010c10: 732e 2043 616c 6c20 636f 6d70 7574 6520  s. Call compute 
+00010c20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00010c30: 2020 226f 6e20 7468 6520 696e 6465 7865    "on the indexe
+00010c40: 7220 6669 7273 7420 746f 2067 6574 2061  r first to get a
+00010c50: 6e20 6576 616c 7572 6174 6564 2061 7272  n evalurated arr
+00010c60: 6179 2e20 476f 743a 207b 7d22 2e66 6f72  ay. Got: {}".for
+00010c70: 6d61 7428 6b65 7929 0a20 2020 2020 2020  mat(key).       
+00010c80: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+00010c90: 6574 7572 6e20 5f76 696e 6465 7828 7365  eturn _vindex(se
+00010ca0: 6c66 2c20 2a6b 6579 290a 0a20 2020 2040  lf, *key)..    @
+00010cb0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+00010cc0: 2076 696e 6465 7828 7365 6c66 293a 0a20   vindex(self):. 
+00010cd0: 2020 2020 2020 2022 2222 5665 6374 6f72         """Vector
+00010ce0: 697a 6564 2069 6e64 6578 696e 6720 7769  ized indexing wi
+00010cf0: 7468 2062 726f 6164 6361 7374 696e 672e  th broadcasting.
+00010d00: 0a0a 2020 2020 2020 2020 5468 6973 2069  ..        This i
+00010d10: 7320 6571 7569 7661 6c65 6e74 2074 6f20  s equivalent to 
+00010d20: 6e75 6d70 7927 7320 6164 7661 6e63 6564  numpy's advanced
+00010d30: 2069 6e64 6578 696e 672c 2075 7369 6e67   indexing, using
+00010d40: 2061 7272 6179 7320 7468 6174 2061 7265   arrays that are
+00010d50: 0a20 2020 2020 2020 2062 726f 6164 6361  .        broadca
+00010d60: 7374 2061 6761 696e 7374 2065 6163 6820  st against each 
+00010d70: 6f74 6865 722e 2054 6869 7320 616c 6c6f  other. This allo
+00010d80: 7773 2066 6f72 2070 6f69 6e74 7769 7365  ws for pointwise
+00010d90: 2069 6e64 6578 696e 673a 0a0a 2020 2020   indexing:..    
+00010da0: 2020 2020 3e3e 3e20 696d 706f 7274 2064      >>> import d
+00010db0: 6173 6b2e 6172 7261 7920 6173 2064 610a  ask.array as da.
+00010dc0: 2020 2020 2020 2020 3e3e 3e20 7820 3d20          >>> x = 
+00010dd0: 6e70 2e61 7272 6179 285b 5b31 2c20 322c  np.array([[1, 2,
+00010de0: 2033 5d2c 205b 342c 2035 2c20 365d 2c20   3], [4, 5, 6], 
+00010df0: 5b37 2c20 382c 2039 5d5d 290a 2020 2020  [7, 8, 9]]).    
+00010e00: 2020 2020 3e3e 3e20 7820 3d20 6461 2e66      >>> x = da.f
+00010e10: 726f 6d5f 6172 7261 7928 782c 2063 6875  rom_array(x, chu
+00010e20: 6e6b 733d 3229 0a20 2020 2020 2020 203e  nks=2).        >
+00010e30: 3e3e 2078 2e76 696e 6465 785b 5b30 2c20  >> x.vindex[[0, 
+00010e40: 312c 2032 5d2c 205b 302c 2031 2c20 325d  1, 2], [0, 1, 2]
+00010e50: 5d2e 636f 6d70 7574 6528 290a 2020 2020  ].compute().    
+00010e60: 2020 2020 6172 7261 7928 5b31 2c20 352c      array([1, 5,
+00010e70: 2039 5d29 0a0a 2020 2020 2020 2020 4d69   9])..        Mi
+00010e80: 7865 6420 6261 7369 632f 6164 7661 6e63  xed basic/advanc
+00010e90: 6564 2069 6e64 6578 696e 6720 7769 7468  ed indexing with
+00010ea0: 2073 6c69 6365 732f 6172 7261 7973 2069   slices/arrays i
+00010eb0: 7320 616c 736f 2073 7570 706f 7274 6564  s also supported
+00010ec0: 2e20 5468 650a 2020 2020 2020 2020 6f72  . The.        or
+00010ed0: 6465 7220 6f66 2064 696d 656e 7369 6f6e  der of dimension
+00010ee0: 7320 696e 2074 6865 2072 6573 756c 7420  s in the result 
+00010ef0: 666f 6c6c 6f77 7320 7468 6f73 6520 7072  follows those pr
+00010f00: 6f70 6f73 6564 2066 6f72 0a20 2020 2020  oposed for.     
+00010f10: 2020 2060 6e64 6172 7261 792e 7669 6e64     `ndarray.vind
+00010f20: 6578 203c 6874 7470 733a 2f2f 6769 7468  ex <https://gith
+00010f30: 7562 2e63 6f6d 2f6e 756d 7079 2f6e 756d  ub.com/numpy/num
+00010f40: 7079 2f70 756c 6c2f 3632 3536 3e60 5f3a  py/pull/6256>`_:
+00010f50: 0a20 2020 2020 2020 2074 6865 2073 7562  .        the sub
+00010f60: 7370 6163 6520 7370 616e 6e65 6420 6279  space spanned by
+00010f70: 2061 7272 6179 7320 6973 2066 6f6c 6c6f   arrays is follo
+00010f80: 7765 6420 6279 2061 6c6c 2073 6c69 6365  wed by all slice
+00010f90: 732e 0a0a 2020 2020 2020 2020 4e6f 7465  s...        Note
+00010fa0: 3a20 6060 7669 6e64 6578 6060 2070 726f  : ``vindex`` pro
+00010fb0: 7669 6465 7320 6d6f 7265 2067 656e 6572  vides more gener
+00010fc0: 616c 2066 756e 6374 696f 6e61 6c69 7479  al functionality
+00010fd0: 2074 6861 6e20 7374 616e 6461 7264 0a20   than standard. 
+00010fe0: 2020 2020 2020 2069 6e64 6578 696e 672c         indexing,
+00010ff0: 2062 7574 2069 7420 616c 736f 2068 6173   but it also has
+00011000: 2066 6577 6572 206f 7074 696d 697a 6174   fewer optimizat
+00011010: 696f 6e73 2061 6e64 2063 616e 2062 6520  ions and can be 
+00011020: 7369 676e 6966 6963 616e 746c 790a 2020  significantly.  
+00011030: 2020 2020 2020 736c 6f77 6572 2e0a 2020        slower..  
+00011040: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00011050: 2020 7265 7475 726e 2049 6e64 6578 4361    return IndexCa
+00011060: 6c6c 6162 6c65 2873 656c 662e 5f76 696e  llable(self._vin
+00011070: 6465 7829 0a0a 2020 2020 4070 726f 7065  dex)..    @prope
+00011080: 7274 790a 2020 2020 6465 6620 626c 6f63  rty.    def bloc
+00011090: 6b73 2873 656c 6629 3a0a 2020 2020 2020  ks(self):.      
+000110a0: 2020 2222 2241 6e20 6172 7261 792d 6c69    """An array-li
+000110b0: 6b65 2069 6e74 6572 6661 6365 2074 6f20  ke interface to 
+000110c0: 7468 6520 626c 6f63 6b73 206f 6620 616e  the blocks of an
+000110d0: 2061 7272 6179 2e0a 0a20 2020 2020 2020   array...       
+000110e0: 2054 6869 7320 7265 7475 726e 7320 6120   This returns a 
+000110f0: 6060 426c 6f63 6b76 6965 7760 6020 6f62  ``Blockview`` ob
+00011100: 6a65 6374 2074 6861 7420 7072 6f76 6964  ject that provid
+00011110: 6573 2061 6e20 6172 7261 792d 6c69 6b65  es an array-like
+00011120: 2069 6e74 6572 6661 6365 0a20 2020 2020   interface.     
+00011130: 2020 2074 6f20 7468 6520 626c 6f63 6b73     to the blocks
+00011140: 206f 6620 6120 6461 736b 2061 7272 6179   of a dask array
+00011150: 2e20 204e 756d 7079 2d73 7479 6c65 2069  .  Numpy-style i
+00011160: 6e64 6578 696e 6720 6f66 2061 2060 6042  ndexing of a ``B
+00011170: 6c6f 636b 7669 6577 6060 206f 626a 6563  lockview`` objec
+00011180: 740a 2020 2020 2020 2020 7265 7475 726e  t.        return
+00011190: 7320 6120 7365 6c65 6374 696f 6e20 6f66  s a selection of
+000111a0: 2062 6c6f 636b 7320 6173 2061 206e 6577   blocks as a new
+000111b0: 2064 6173 6b20 6172 7261 792e 0a0a 2020   dask array...  
+000111c0: 2020 2020 2020 596f 7520 6361 6e20 696e        You can in
+000111d0: 6465 7820 6060 6172 7261 792e 626c 6f63  dex ``array.bloc
+000111e0: 6b73 6060 206c 696b 6520 6120 6e75 6d70  ks`` like a nump
+000111f0: 7920 6172 7261 7920 6f66 2073 6861 7065  y array of shape
+00011200: 0a20 2020 2020 2020 2065 7175 616c 2074  .        equal t
+00011210: 6f20 7468 6520 6e75 6d62 6572 206f 6620  o the number of 
+00011220: 626c 6f63 6b73 2069 6e20 6561 6368 2064  blocks in each d
+00011230: 696d 656e 7369 6f6e 2c20 2861 7661 696c  imension, (avail
+00011240: 6162 6c65 2061 730a 2020 2020 2020 2020  able as.        
+00011250: 6172 7261 792e 626c 6f63 6b73 2e73 697a  array.blocks.siz
+00011260: 6529 2e20 2054 6865 2064 696d 656e 7369  e).  The dimensi
+00011270: 6f6e 616c 6974 7920 6f66 2074 6865 206f  onality of the o
+00011280: 7574 7075 7420 6172 7261 7920 6d61 7463  utput array matc
+00011290: 6865 730a 2020 2020 2020 2020 7468 6520  hes.        the 
+000112a0: 6469 6d65 6e73 696f 6e20 6f66 2074 6869  dimension of thi
+000112b0: 7320 6172 7261 792c 2065 7665 6e20 6966  s array, even if
+000112c0: 2069 6e74 6567 6572 2069 6e64 6963 6573   integer indices
+000112d0: 2061 7265 2070 6173 7365 642e 0a20 2020   are passed..   
+000112e0: 2020 2020 2053 6c69 6369 6e67 2077 6974       Slicing wit
+000112f0: 6820 6060 6e70 2e6e 6577 6178 6973 6060  h ``np.newaxis``
+00011300: 206f 7220 6d75 6c74 6970 6c65 206c 6973   or multiple lis
+00011310: 7473 2069 7320 6e6f 7420 7375 7070 6f72  ts is not suppor
+00011320: 7465 642e 0a0a 2020 2020 2020 2020 4578  ted...        Ex
+00011330: 616d 706c 6573 0a20 2020 2020 2020 202d  amples.        -
+00011340: 2d2d 2d2d 2d2d 2d0a 2020 2020 2020 2020  -------.        
+00011350: 3e3e 3e20 696d 706f 7274 2064 6173 6b2e  >>> import dask.
+00011360: 6172 7261 7920 6173 2064 610a 2020 2020  array as da.    
+00011370: 2020 2020 3e3e 3e20 7820 3d20 6461 2e61      >>> x = da.a
+00011380: 7261 6e67 6528 382c 2063 6875 6e6b 733d  range(8, chunks=
+00011390: 3229 0a20 2020 2020 2020 203e 3e3e 2078  2).        >>> x
+000113a0: 2e62 6c6f 636b 732e 7368 6170 6520 2320  .blocks.shape # 
+000113b0: 616c 6961 7365 7320 782e 6e75 6d62 6c6f  aliases x.numblo
+000113c0: 636b 730a 2020 2020 2020 2020 2834 2c29  cks.        (4,)
+000113d0: 0a20 2020 2020 2020 203e 3e3e 2078 2e62  .        >>> x.b
+000113e0: 6c6f 636b 735b 305d 2e63 6f6d 7075 7465  locks[0].compute
+000113f0: 2829 0a20 2020 2020 2020 2061 7272 6179  ().        array
+00011400: 285b 302c 2031 5d29 0a20 2020 2020 2020  ([0, 1]).       
+00011410: 203e 3e3e 2078 2e62 6c6f 636b 735b 3a33   >>> x.blocks[:3
+00011420: 5d2e 636f 6d70 7574 6528 290a 2020 2020  ].compute().    
+00011430: 2020 2020 6172 7261 7928 5b30 2c20 312c      array([0, 1,
+00011440: 2032 2c20 332c 2034 2c20 355d 290a 2020   2, 3, 4, 5]).  
+00011450: 2020 2020 2020 3e3e 3e20 782e 626c 6f63        >>> x.bloc
+00011460: 6b73 5b3a 3a32 5d2e 636f 6d70 7574 6528  ks[::2].compute(
+00011470: 290a 2020 2020 2020 2020 6172 7261 7928  ).        array(
+00011480: 5b30 2c20 312c 2034 2c20 355d 290a 2020  [0, 1, 4, 5]).  
+00011490: 2020 2020 2020 3e3e 3e20 782e 626c 6f63        >>> x.bloc
+000114a0: 6b73 5b5b 2d31 2c20 305d 5d2e 636f 6d70  ks[[-1, 0]].comp
+000114b0: 7574 6528 290a 2020 2020 2020 2020 6172  ute().        ar
+000114c0: 7261 7928 5b36 2c20 372c 2030 2c20 315d  ray([6, 7, 0, 1]
+000114d0: 290a 2020 2020 2020 2020 3e3e 3e20 782e  ).        >>> x.
+000114e0: 626c 6f63 6b73 2e72 6176 656c 2829 2023  blocks.ravel() #
+000114f0: 2064 6f63 7465 7374 3a20 2b4e 4f52 4d41   doctest: +NORMA
+00011500: 4c49 5a45 5f57 4849 5445 5350 4143 450a  LIZE_WHITESPACE.
+00011510: 2020 2020 2020 2020 5b64 6173 6b2e 6172          [dask.ar
+00011520: 7261 793c 626c 6f63 6b73 2c20 7368 6170  ray<blocks, shap
+00011530: 653d 2832 2c29 2c20 6474 7970 653d 696e  e=(2,), dtype=in
+00011540: 7436 342c 2063 6875 6e6b 7369 7a65 3d28  t64, chunksize=(
+00011550: 322c 292c 2063 6875 6e6b 7479 7065 3d6e  2,), chunktype=n
+00011560: 756d 7079 2e6e 6461 7272 6179 3e2c 0a20  umpy.ndarray>,. 
+00011570: 2020 2020 2020 2020 6461 736b 2e61 7272          dask.arr
+00011580: 6179 3c62 6c6f 636b 732c 2073 6861 7065  ay<blocks, shape
+00011590: 3d28 322c 292c 2064 7479 7065 3d69 6e74  =(2,), dtype=int
+000115a0: 3634 2c20 6368 756e 6b73 697a 653d 2832  64, chunksize=(2
+000115b0: 2c29 2c20 6368 756e 6b74 7970 653d 6e75  ,), chunktype=nu
+000115c0: 6d70 792e 6e64 6172 7261 793e 2c0a 2020  mpy.ndarray>,.  
+000115d0: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+000115e0: 793c 626c 6f63 6b73 2c20 7368 6170 653d  y<blocks, shape=
+000115f0: 2832 2c29 2c20 6474 7970 653d 696e 7436  (2,), dtype=int6
+00011600: 342c 2063 6875 6e6b 7369 7a65 3d28 322c  4, chunksize=(2,
+00011610: 292c 2063 6875 6e6b 7479 7065 3d6e 756d  ), chunktype=num
+00011620: 7079 2e6e 6461 7272 6179 3e2c 0a20 2020  py.ndarray>,.   
+00011630: 2020 2020 2020 6461 736b 2e61 7272 6179        dask.array
+00011640: 3c62 6c6f 636b 732c 2073 6861 7065 3d28  <blocks, shape=(
+00011650: 322c 292c 2064 7479 7065 3d69 6e74 3634  2,), dtype=int64
+00011660: 2c20 6368 756e 6b73 697a 653d 2832 2c29  , chunksize=(2,)
+00011670: 2c20 6368 756e 6b74 7970 653d 6e75 6d70  , chunktype=nump
+00011680: 792e 6e64 6172 7261 793e 5d0a 0a20 2020  y.ndarray>]..   
+00011690: 2020 2020 2052 6574 7572 6e73 0a20 2020       Returns.   
+000116a0: 2020 2020 202d 2d2d 2d2d 2d2d 0a20 2020       -------.   
+000116b0: 2020 2020 2041 6e20 696e 7374 616e 6365       An instance
+000116c0: 206f 6620 6060 6461 736b 2e61 7272 6179   of ``dask.array
+000116d0: 2e42 6c6f 636b 7669 6577 6060 0a20 2020  .Blockview``.   
+000116e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000116f0: 2072 6574 7572 6e20 426c 6f63 6b56 6965   return BlockVie
+00011700: 7728 7365 6c66 290a 0a20 2020 2040 7072  w(self)..    @pr
+00011710: 6f70 6572 7479 0a20 2020 2064 6566 2070  operty.    def p
+00011720: 6172 7469 7469 6f6e 7328 7365 6c66 293a  artitions(self):
+00011730: 0a20 2020 2020 2020 2022 2222 536c 6963  .        """Slic
+00011740: 6520 616e 2061 7272 6179 2062 7920 7061  e an array by pa
+00011750: 7274 6974 696f 6e73 2e20 416c 6961 7320  rtitions. Alias 
+00011760: 6f66 2064 6173 6b20 6172 7261 7920 2e62  of dask array .b
+00011770: 6c6f 636b 7320 6174 7472 6962 7574 652e  locks attribute.
+00011780: 0a0a 2020 2020 2020 2020 5468 6973 2061  ..        This a
+00011790: 6c69 6173 2061 6c6c 6f77 7320 796f 7520  lias allows you 
+000117a0: 746f 2077 7269 7465 2061 676e 6f73 7469  to write agnosti
+000117b0: 6320 636f 6465 2074 6861 7420 776f 726b  c code that work
+000117c0: 7320 7769 7468 2062 6f74 680a 2020 2020  s with both.    
+000117d0: 2020 2020 6461 736b 2061 7272 6179 7320      dask arrays 
+000117e0: 616e 6420 6461 736b 2064 6174 6166 7261  and dask datafra
+000117f0: 6d65 732e 0a0a 2020 2020 2020 2020 5468  mes...        Th
+00011800: 6973 2072 6574 7572 6e73 2061 2060 6042  is returns a ``B
+00011810: 6c6f 636b 7669 6577 6060 206f 626a 6563  lockview`` objec
+00011820: 7420 7468 6174 2070 726f 7669 6465 7320  t that provides 
+00011830: 616e 2061 7272 6179 2d6c 696b 6520 696e  an array-like in
+00011840: 7465 7266 6163 650a 2020 2020 2020 2020  terface.        
+00011850: 746f 2074 6865 2062 6c6f 636b 7320 6f66  to the blocks of
+00011860: 2061 2064 6173 6b20 6172 7261 792e 2020   a dask array.  
+00011870: 4e75 6d70 792d 7374 796c 6520 696e 6465  Numpy-style inde
+00011880: 7869 6e67 206f 6620 6120 6060 426c 6f63  xing of a ``Bloc
+00011890: 6b76 6965 7760 6020 6f62 6a65 6374 0a20  kview`` object. 
+000118a0: 2020 2020 2020 2072 6574 7572 6e73 2061         returns a
+000118b0: 2073 656c 6563 7469 6f6e 206f 6620 626c   selection of bl
+000118c0: 6f63 6b73 2061 7320 6120 6e65 7720 6461  ocks as a new da
+000118d0: 736b 2061 7272 6179 2e0a 0a20 2020 2020  sk array...     
+000118e0: 2020 2059 6f75 2063 616e 2069 6e64 6578     You can index
+000118f0: 2060 6061 7272 6179 2e62 6c6f 636b 7360   ``array.blocks`
+00011900: 6020 6c69 6b65 2061 206e 756d 7079 2061  ` like a numpy a
+00011910: 7272 6179 206f 6620 7368 6170 650a 2020  rray of shape.  
+00011920: 2020 2020 2020 6571 7561 6c20 746f 2074        equal to t
+00011930: 6865 206e 756d 6265 7220 6f66 2062 6c6f  he number of blo
+00011940: 636b 7320 696e 2065 6163 6820 6469 6d65  cks in each dime
+00011950: 6e73 696f 6e2c 2028 6176 6169 6c61 626c  nsion, (availabl
+00011960: 6520 6173 0a20 2020 2020 2020 2061 7272  e as.        arr
+00011970: 6179 2e62 6c6f 636b 732e 7369 7a65 292e  ay.blocks.size).
+00011980: 2020 5468 6520 6469 6d65 6e73 696f 6e61    The dimensiona
+00011990: 6c69 7479 206f 6620 7468 6520 6f75 7470  lity of the outp
+000119a0: 7574 2061 7272 6179 206d 6174 6368 6573  ut array matches
+000119b0: 0a20 2020 2020 2020 2074 6865 2064 696d  .        the dim
+000119c0: 656e 7369 6f6e 206f 6620 7468 6973 2061  ension of this a
+000119d0: 7272 6179 2c20 6576 656e 2069 6620 696e  rray, even if in
+000119e0: 7465 6765 7220 696e 6469 6365 7320 6172  teger indices ar
+000119f0: 6520 7061 7373 6564 2e0a 2020 2020 2020  e passed..      
+00011a00: 2020 536c 6963 696e 6720 7769 7468 2060    Slicing with `
+00011a10: 606e 702e 6e65 7761 7869 7360 6020 6f72  `np.newaxis`` or
+00011a20: 206d 756c 7469 706c 6520 6c69 7374 7320   multiple lists 
+00011a30: 6973 206e 6f74 2073 7570 706f 7274 6564  is not supported
+00011a40: 2e0a 0a20 2020 2020 2020 2045 7861 6d70  ...        Examp
+00011a50: 6c65 730a 2020 2020 2020 2020 2d2d 2d2d  les.        ----
+00011a60: 2d2d 2d2d 0a20 2020 2020 2020 203e 3e3e  ----.        >>>
+00011a70: 2069 6d70 6f72 7420 6461 736b 2e61 7272   import dask.arr
+00011a80: 6179 2061 7320 6461 0a20 2020 2020 2020  ay as da.       
+00011a90: 203e 3e3e 2078 203d 2064 612e 6172 616e   >>> x = da.aran
+00011aa0: 6765 2838 2c20 6368 756e 6b73 3d32 290a  ge(8, chunks=2).
+00011ab0: 2020 2020 2020 2020 3e3e 3e20 782e 7061          >>> x.pa
+00011ac0: 7274 6974 696f 6e73 2e73 6861 7065 2023  rtitions.shape #
+00011ad0: 2061 6c69 6173 6573 2078 2e6e 756d 626c   aliases x.numbl
+00011ae0: 6f63 6b73 0a20 2020 2020 2020 2028 342c  ocks.        (4,
+00011af0: 290a 2020 2020 2020 2020 3e3e 3e20 782e  ).        >>> x.
+00011b00: 7061 7274 6974 696f 6e73 5b30 5d2e 636f  partitions[0].co
+00011b10: 6d70 7574 6528 290a 2020 2020 2020 2020  mpute().        
+00011b20: 6172 7261 7928 5b30 2c20 315d 290a 2020  array([0, 1]).  
+00011b30: 2020 2020 2020 3e3e 3e20 782e 7061 7274        >>> x.part
+00011b40: 6974 696f 6e73 5b3a 335d 2e63 6f6d 7075  itions[:3].compu
+00011b50: 7465 2829 0a20 2020 2020 2020 2061 7272  te().        arr
+00011b60: 6179 285b 302c 2031 2c20 322c 2033 2c20  ay([0, 1, 2, 3, 
+00011b70: 342c 2035 5d29 0a20 2020 2020 2020 203e  4, 5]).        >
+00011b80: 3e3e 2078 2e70 6172 7469 7469 6f6e 735b  >> x.partitions[
+00011b90: 3a3a 325d 2e63 6f6d 7075 7465 2829 0a20  ::2].compute(). 
+00011ba0: 2020 2020 2020 2061 7272 6179 285b 302c         array([0,
+00011bb0: 2031 2c20 342c 2035 5d29 0a20 2020 2020   1, 4, 5]).     
+00011bc0: 2020 203e 3e3e 2078 2e70 6172 7469 7469     >>> x.partiti
+00011bd0: 6f6e 735b 5b2d 312c 2030 5d5d 2e63 6f6d  ons[[-1, 0]].com
+00011be0: 7075 7465 2829 0a20 2020 2020 2020 2061  pute().        a
+00011bf0: 7272 6179 285b 362c 2037 2c20 302c 2031  rray([6, 7, 0, 1
+00011c00: 5d29 0a20 2020 2020 2020 203e 3e3e 2078  ]).        >>> x
+00011c10: 2e70 6172 7469 7469 6f6e 732e 7261 7665  .partitions.rave
+00011c20: 6c28 2920 2320 646f 6374 6573 743a 202b  l() # doctest: +
+00011c30: 4e4f 524d 414c 495a 455f 5748 4954 4553  NORMALIZE_WHITES
+00011c40: 5041 4345 0a20 2020 2020 2020 205b 6461  PACE.        [da
+00011c50: 736b 2e61 7272 6179 3c62 6c6f 636b 732c  sk.array<blocks,
+00011c60: 2073 6861 7065 3d28 322c 292c 2064 7479   shape=(2,), dty
+00011c70: 7065 3d69 6e74 3634 2c20 6368 756e 6b73  pe=int64, chunks
+00011c80: 697a 653d 2832 2c29 2c20 6368 756e 6b74  ize=(2,), chunkt
+00011c90: 7970 653d 6e75 6d70 792e 6e64 6172 7261  ype=numpy.ndarra
+00011ca0: 793e 2c0a 2020 2020 2020 2020 2064 6173  y>,.         das
+00011cb0: 6b2e 6172 7261 793c 626c 6f63 6b73 2c20  k.array<blocks, 
+00011cc0: 7368 6170 653d 2832 2c29 2c20 6474 7970  shape=(2,), dtyp
+00011cd0: 653d 696e 7436 342c 2063 6875 6e6b 7369  e=int64, chunksi
+00011ce0: 7a65 3d28 322c 292c 2063 6875 6e6b 7479  ze=(2,), chunkty
+00011cf0: 7065 3d6e 756d 7079 2e6e 6461 7272 6179  pe=numpy.ndarray
+00011d00: 3e2c 0a20 2020 2020 2020 2020 6461 736b  >,.         dask
+00011d10: 2e61 7272 6179 3c62 6c6f 636b 732c 2073  .array<blocks, s
+00011d20: 6861 7065 3d28 322c 292c 2064 7479 7065  hape=(2,), dtype
+00011d30: 3d69 6e74 3634 2c20 6368 756e 6b73 697a  =int64, chunksiz
+00011d40: 653d 2832 2c29 2c20 6368 756e 6b74 7970  e=(2,), chunktyp
+00011d50: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
+00011d60: 2c0a 2020 2020 2020 2020 2064 6173 6b2e  ,.         dask.
+00011d70: 6172 7261 793c 626c 6f63 6b73 2c20 7368  array<blocks, sh
+00011d80: 6170 653d 2832 2c29 2c20 6474 7970 653d  ape=(2,), dtype=
+00011d90: 696e 7436 342c 2063 6875 6e6b 7369 7a65  int64, chunksize
+00011da0: 3d28 322c 292c 2063 6875 6e6b 7479 7065  =(2,), chunktype
+00011db0: 3d6e 756d 7079 2e6e 6461 7272 6179 3e5d  =numpy.ndarray>]
+00011dc0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+00011dd0: 730a 2020 2020 2020 2020 2d2d 2d2d 2d2d  s.        ------
+00011de0: 2d0a 2020 2020 2020 2020 416e 2069 6e73  -.        An ins
+00011df0: 7461 6e63 6520 6f66 2060 6064 612e 6172  tance of ``da.ar
+00011e00: 7261 792e 426c 6f63 6b76 6965 7760 600a  ray.Blockview``.
+00011e10: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00011e20: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+00011e30: 626c 6f63 6b73 0a0a 2020 2020 6465 6620  blocks..    def 
+00011e40: 646f 7428 7365 6c66 2c20 6f74 6865 7229  dot(self, other)
+00011e50: 3a0a 2020 2020 2020 2020 2222 2244 6f74  :.        """Dot
+00011e60: 2070 726f 6475 6374 206f 6620 7365 6c66   product of self
+00011e70: 2061 6e64 206f 7468 6572 2e0a 0a20 2020   and other...   
+00011e80: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
+00011e90: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
+00011ea0: 7465 6e73 6f72 646f 7460 2066 6f72 2066  tensordot` for f
+00011eb0: 756c 6c20 646f 6375 6d65 6e74 6174 696f  ull documentatio
+00011ec0: 6e2e 0a0a 2020 2020 2020 2020 5365 6520  n...        See 
+00011ed0: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+00011ee0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
+00011ef0: 736b 2e61 7272 6179 2e64 6f74 203a 2065  sk.array.dot : e
+00011f00: 7175 6976 616c 656e 7420 6675 6e63 7469  quivalent functi
+00011f10: 6f6e 0a20 2020 2020 2020 2022 2222 0a20  on.        """. 
+00011f20: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+00011f30: 2e61 7272 6179 2e72 6f75 7469 6e65 7320  .array.routines 
+00011f40: 696d 706f 7274 2074 656e 736f 7264 6f74  import tensordot
+00011f50: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00011f60: 2074 656e 736f 7264 6f74 2873 656c 662c   tensordot(self,
+00011f70: 206f 7468 6572 2c20 6178 6573 3d28 2873   other, axes=((s
+00011f80: 656c 662e 6e64 696d 202d 2031 2c29 2c20  elf.ndim - 1,), 
+00011f90: 286f 7468 6572 2e6e 6469 6d20 2d20 322c  (other.ndim - 2,
+00011fa0: 2929 290a 0a20 2020 2040 7072 6f70 6572  )))..    @proper
+00011fb0: 7479 0a20 2020 2064 6566 2041 2873 656c  ty.    def A(sel
+00011fc0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+00011fd0: 726e 2073 656c 660a 0a20 2020 2040 7072  rn self..    @pr
+00011fe0: 6f70 6572 7479 0a20 2020 2064 6566 2054  operty.    def T
+00011ff0: 2873 656c 6629 3a0a 2020 2020 2020 2020  (self):.        
+00012000: 7265 7475 726e 2073 656c 662e 7472 616e  return self.tran
+00012010: 7370 6f73 6528 290a 0a20 2020 2064 6566  spose()..    def
+00012020: 2074 7261 6e73 706f 7365 2873 656c 662c   transpose(self,
+00012030: 202a 6178 6573 293a 0a20 2020 2020 2020   *axes):.       
+00012040: 2022 2222 5265 7665 7273 6520 6f72 2070   """Reverse or p
+00012050: 6572 6d75 7465 2074 6865 2061 7865 7320  ermute the axes 
+00012060: 6f66 2061 6e20 6172 7261 792e 2052 6574  of an array. Ret
+00012070: 7572 6e20 7468 6520 6d6f 6469 6669 6564  urn the modified
+00012080: 2061 7272 6179 2e0a 0a20 2020 2020 2020   array...       
+00012090: 2052 6566 6572 2074 6f20 3a66 756e 633a   Refer to :func:
+000120a0: 6064 6173 6b2e 6172 7261 792e 7472 616e  `dask.array.tran
+000120b0: 7370 6f73 6560 2066 6f72 2066 756c 6c20  spose` for full 
+000120c0: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
+000120d0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+000120e0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+000120f0: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
+00012100: 7272 6179 2e74 7261 6e73 706f 7365 203a  rray.transpose :
+00012110: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
+00012120: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
+00012130: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+00012140: 736b 2e61 7272 6179 2e72 6f75 7469 6e65  sk.array.routine
+00012150: 7320 696d 706f 7274 2074 7261 6e73 706f  s import transpo
+00012160: 7365 0a0a 2020 2020 2020 2020 6966 206e  se..        if n
+00012170: 6f74 2061 7865 733a 0a20 2020 2020 2020  ot axes:.       
+00012180: 2020 2020 2061 7865 7320 3d20 4e6f 6e65       axes = None
+00012190: 0a20 2020 2020 2020 2065 6c69 6620 6c65  .        elif le
+000121a0: 6e28 6178 6573 2920 3d3d 2031 2061 6e64  n(axes) == 1 and
+000121b0: 2069 7369 6e73 7461 6e63 6528 6178 6573   isinstance(axes
+000121c0: 5b30 5d2c 2049 7465 7261 626c 6529 3a0a  [0], Iterable):.
+000121d0: 2020 2020 2020 2020 2020 2020 6178 6573              axes
+000121e0: 203d 2061 7865 735b 305d 0a20 2020 2020   = axes[0].     
+000121f0: 2020 2069 6620 2861 7865 7320 3d3d 2074     if (axes == t
+00012200: 7570 6c65 2872 616e 6765 2873 656c 662e  uple(range(self.
+00012210: 6e64 696d 2929 2920 6f72 2028 6178 6573  ndim))) or (axes
+00012220: 203d 3d20 7475 706c 6528 7261 6e67 6528   == tuple(range(
+00012230: 2d73 656c 662e 6e64 696d 2c20 3029 2929  -self.ndim, 0)))
+00012240: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00012250: 6e6f 2074 7261 6e73 706f 7365 206e 6563  no transpose nec
+00012260: 6573 7361 7279 0a20 2020 2020 2020 2020  essary.         
+00012270: 2020 2072 6574 7572 6e20 7365 6c66 0a20     return self. 
+00012280: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00012290: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000122a0: 7472 616e 7370 6f73 6528 7365 6c66 2c20  transpose(self, 
+000122b0: 6178 6573 3d61 7865 7329 0a0a 2020 2020  axes=axes)..    
+000122c0: 6465 6620 7261 7665 6c28 7365 6c66 293a  def ravel(self):
+000122d0: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
+000122e0: 726e 2061 2066 6c61 7474 656e 6564 2061  rn a flattened a
+000122f0: 7272 6179 2e0a 0a20 2020 2020 2020 2052  rray...        R
+00012300: 6566 6572 2074 6f20 3a66 756e 633a 6064  efer to :func:`d
+00012310: 6173 6b2e 6172 7261 792e 7261 7665 6c60  ask.array.ravel`
+00012320: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
+00012330: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
+00012340: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00012350: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00012360: 2020 2020 6461 736b 2e61 7272 6179 2e72      dask.array.r
+00012370: 6176 656c 203a 2065 7175 6976 616c 656e  avel : equivalen
+00012380: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
+00012390: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+000123a0: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
+000123b0: 6f75 7469 6e65 7320 696d 706f 7274 2072  outines import r
+000123c0: 6176 656c 0a0a 2020 2020 2020 2020 7265  avel..        re
+000123d0: 7475 726e 2072 6176 656c 2873 656c 6629  turn ravel(self)
+000123e0: 0a0a 2020 2020 666c 6174 7465 6e20 3d20  ..    flatten = 
+000123f0: 7261 7665 6c0a 0a20 2020 2064 6566 2063  ravel..    def c
+00012400: 686f 6f73 6528 7365 6c66 2c20 6368 6f69  hoose(self, choi
+00012410: 6365 7329 3a0a 2020 2020 2020 2020 2222  ces):.        ""
+00012420: 2255 7365 2061 6e20 696e 6465 7820 6172  "Use an index ar
+00012430: 7261 7920 746f 2063 6f6e 7374 7275 6374  ray to construct
+00012440: 2061 206e 6577 2061 7272 6179 2066 726f   a new array fro
+00012450: 6d20 6120 7365 7420 6f66 2063 686f 6963  m a set of choic
+00012460: 6573 2e0a 0a20 2020 2020 2020 2052 6566  es...        Ref
+00012470: 6572 2074 6f20 3a66 756e 633a 6064 6173  er to :func:`das
+00012480: 6b2e 6172 7261 792e 6368 6f6f 7365 6020  k.array.choose` 
+00012490: 666f 7220 6675 6c6c 2064 6f63 756d 656e  for full documen
+000124a0: 7461 7469 6f6e 2e0a 0a20 2020 2020 2020  tation...       
+000124b0: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+000124c0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+000124d0: 2020 2064 6173 6b2e 6172 7261 792e 6368     dask.array.ch
+000124e0: 6f6f 7365 203a 2065 7175 6976 616c 656e  oose : equivalen
+000124f0: 7420 6675 6e63 7469 6f6e 0a20 2020 2020  t function.     
+00012500: 2020 2022 2222 0a20 2020 2020 2020 2066     """.        f
+00012510: 726f 6d20 6461 736b 2e61 7272 6179 2e72  rom dask.array.r
+00012520: 6f75 7469 6e65 7320 696d 706f 7274 2063  outines import c
+00012530: 686f 6f73 650a 0a20 2020 2020 2020 2072  hoose..        r
+00012540: 6574 7572 6e20 6368 6f6f 7365 2873 656c  eturn choose(sel
+00012550: 662c 2063 686f 6963 6573 290a 0a20 2020  f, choices)..   
+00012560: 2064 6566 2072 6573 6861 7065 2873 656c   def reshape(sel
+00012570: 662c 202a 7368 6170 652c 206d 6572 6765  f, *shape, merge
+00012580: 5f63 6875 6e6b 733d 5472 7565 2c20 6c69  _chunks=True, li
+00012590: 6d69 743d 4e6f 6e65 293a 0a20 2020 2020  mit=None):.     
+000125a0: 2020 2022 2222 5265 7368 6170 6520 6172     """Reshape ar
+000125b0: 7261 7920 746f 206e 6577 2073 6861 7065  ray to new shape
+000125c0: 0a0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
+000125d0: 746f 203a 6675 6e63 3a60 6461 736b 2e61  to :func:`dask.a
+000125e0: 7272 6179 2e72 6573 6861 7065 6020 666f  rray.reshape` fo
+000125f0: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
+00012600: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
+00012610: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00012620: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00012630: 2064 6173 6b2e 6172 7261 792e 7265 7368   dask.array.resh
+00012640: 6170 6520 3a20 6571 7569 7661 6c65 6e74  ape : equivalent
+00012650: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00012660: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00012670: 6f6d 2064 6173 6b2e 6172 7261 792e 7265  om dask.array.re
+00012680: 7368 6170 6520 696d 706f 7274 2072 6573  shape import res
+00012690: 6861 7065 0a0a 2020 2020 2020 2020 6966  hape..        if
+000126a0: 206c 656e 2873 6861 7065 2920 3d3d 2031   len(shape) == 1
+000126b0: 2061 6e64 206e 6f74 2069 7369 6e73 7461   and not isinsta
+000126c0: 6e63 6528 7368 6170 655b 305d 2c20 4e75  nce(shape[0], Nu
+000126d0: 6d62 6572 293a 0a20 2020 2020 2020 2020  mber):.         
+000126e0: 2020 2073 6861 7065 203d 2073 6861 7065     shape = shape
+000126f0: 5b30 5d0a 2020 2020 2020 2020 7265 7475  [0].        retu
+00012700: 726e 2072 6573 6861 7065 2873 656c 662c  rn reshape(self,
+00012710: 2073 6861 7065 2c20 6d65 7267 655f 6368   shape, merge_ch
+00012720: 756e 6b73 3d6d 6572 6765 5f63 6875 6e6b  unks=merge_chunk
+00012730: 732c 206c 696d 6974 3d6c 696d 6974 290a  s, limit=limit).
+00012740: 0a20 2020 2064 6566 2074 6f70 6b28 7365  .    def topk(se
+00012750: 6c66 2c20 6b2c 2061 7869 733d 2d31 2c20  lf, k, axis=-1, 
+00012760: 7370 6c69 745f 6576 6572 793d 4e6f 6e65  split_every=None
+00012770: 293a 0a20 2020 2020 2020 2022 2222 5468  ):.        """Th
+00012780: 6520 746f 7020 6b20 656c 656d 656e 7473  e top k elements
+00012790: 206f 6620 616e 2061 7272 6179 2e0a 0a20   of an array... 
+000127a0: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
+000127b0: 3a66 756e 633a 6064 6173 6b2e 6172 7261  :func:`dask.arra
+000127c0: 792e 746f 706b 6020 666f 7220 6675 6c6c  y.topk` for full
+000127d0: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+000127e0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+000127f0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00012800: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+00012810: 6172 7261 792e 746f 706b 203a 2065 7175  array.topk : equ
+00012820: 6976 616c 656e 7420 6675 6e63 7469 6f6e  ivalent function
+00012830: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00012840: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
+00012850: 7272 6179 2e72 6564 7563 7469 6f6e 7320  rray.reductions 
+00012860: 696d 706f 7274 2074 6f70 6b0a 0a20 2020  import topk..   
+00012870: 2020 2020 2072 6574 7572 6e20 746f 706b       return topk
+00012880: 2873 656c 662c 206b 2c20 6178 6973 3d61  (self, k, axis=a
+00012890: 7869 732c 2073 706c 6974 5f65 7665 7279  xis, split_every
+000128a0: 3d73 706c 6974 5f65 7665 7279 290a 0a20  =split_every).. 
+000128b0: 2020 2064 6566 2061 7267 746f 706b 2873     def argtopk(s
+000128c0: 656c 662c 206b 2c20 6178 6973 3d2d 312c  elf, k, axis=-1,
+000128d0: 2073 706c 6974 5f65 7665 7279 3d4e 6f6e   split_every=Non
+000128e0: 6529 3a0a 2020 2020 2020 2020 2222 2254  e):.        """T
+000128f0: 6865 2069 6e64 6963 6573 206f 6620 7468  he indices of th
+00012900: 6520 746f 7020 6b20 656c 656d 656e 7473  e top k elements
+00012910: 206f 6620 616e 2061 7272 6179 2e0a 0a20   of an array... 
+00012920: 2020 2020 2020 2052 6566 6572 2074 6f20         Refer to 
+00012930: 3a66 756e 633a 6064 6173 6b2e 6172 7261  :func:`dask.arra
+00012940: 792e 6172 6774 6f70 6b60 2066 6f72 2066  y.argtopk` for f
+00012950: 756c 6c20 646f 6375 6d65 6e74 6174 696f  ull documentatio
+00012960: 6e2e 0a0a 2020 2020 2020 2020 5365 6520  n...        See 
+00012970: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+00012980: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
+00012990: 736b 2e61 7272 6179 2e61 7267 746f 706b  sk.array.argtopk
+000129a0: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
+000129b0: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
+000129c0: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+000129d0: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
+000129e0: 7469 6f6e 7320 696d 706f 7274 2061 7267  tions import arg
+000129f0: 746f 706b 0a0a 2020 2020 2020 2020 7265  topk..        re
+00012a00: 7475 726e 2061 7267 746f 706b 2873 656c  turn argtopk(sel
+00012a10: 662c 206b 2c20 6178 6973 3d61 7869 732c  f, k, axis=axis,
+00012a20: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
+00012a30: 6974 5f65 7665 7279 290a 0a20 2020 2064  it_every)..    d
+00012a40: 6566 2061 7374 7970 6528 7365 6c66 2c20  ef astype(self, 
+00012a50: 6474 7970 652c 202a 2a6b 7761 7267 7329  dtype, **kwargs)
+00012a60: 3a0a 2020 2020 2020 2020 2222 2243 6f70  :.        """Cop
+00012a70: 7920 6f66 2074 6865 2061 7272 6179 2c20  y of the array, 
+00012a80: 6361 7374 2074 6f20 6120 7370 6563 6966  cast to a specif
+00012a90: 6965 6420 7479 7065 2e0a 0a20 2020 2020  ied type...     
+00012aa0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00012ab0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d        ----------
+00012ac0: 0a20 2020 2020 2020 2064 7479 7065 203a  .        dtype :
+00012ad0: 2073 7472 206f 7220 6474 7970 650a 2020   str or dtype.  
+00012ae0: 2020 2020 2020 2020 2020 5479 7065 636f            Typeco
+00012af0: 6465 206f 7220 6461 7461 2d74 7970 6520  de or data-type 
+00012b00: 746f 2077 6869 6368 2074 6865 2061 7272  to which the arr
+00012b10: 6179 2069 7320 6361 7374 2e0a 2020 2020  ay is cast..    
+00012b20: 2020 2020 6361 7374 696e 6720 3a20 7b27      casting : {'
+00012b30: 6e6f 272c 2027 6571 7569 7627 2c20 2773  no', 'equiv', 's
+00012b40: 6166 6527 2c20 2773 616d 655f 6b69 6e64  afe', 'same_kind
+00012b50: 272c 2027 756e 7361 6665 277d 2c20 6f70  ', 'unsafe'}, op
+00012b60: 7469 6f6e 616c 0a20 2020 2020 2020 2020  tional.         
+00012b70: 2020 2043 6f6e 7472 6f6c 7320 7768 6174     Controls what
+00012b80: 206b 696e 6420 6f66 2064 6174 6120 6361   kind of data ca
+00012b90: 7374 696e 6720 6d61 7920 6f63 6375 722e  sting may occur.
+00012ba0: 2044 6566 6175 6c74 7320 746f 2027 756e   Defaults to 'un
+00012bb0: 7361 6665 270a 2020 2020 2020 2020 2020  safe'.          
+00012bc0: 2020 666f 7220 6261 636b 7761 7264 7320    for backwards 
+00012bd0: 636f 6d70 6174 6962 696c 6974 792e 0a0a  compatibility...
+00012be0: 2020 2020 2020 2020 2020 2020 2a20 276e              * 'n
+00012bf0: 6f27 206d 6561 6e73 2074 6865 2064 6174  o' means the dat
+00012c00: 6120 7479 7065 7320 7368 6f75 6c64 206e  a types should n
+00012c10: 6f74 2062 6520 6361 7374 2061 7420 616c  ot be cast at al
+00012c20: 6c2e 0a20 2020 2020 2020 2020 2020 202a  l..            *
+00012c30: 2027 6571 7569 7627 206d 6561 6e73 206f   'equiv' means o
+00012c40: 6e6c 7920 6279 7465 2d6f 7264 6572 2063  nly byte-order c
+00012c50: 6861 6e67 6573 2061 7265 2061 6c6c 6f77  hanges are allow
+00012c60: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
+00012c70: 2a20 2773 6166 6527 206d 6561 6e73 206f  * 'safe' means o
+00012c80: 6e6c 7920 6361 7374 7320 7768 6963 6820  nly casts which 
+00012c90: 6361 6e20 7072 6573 6572 7665 2076 616c  can preserve val
+00012ca0: 7565 7320 6172 6520 616c 6c6f 7765 642e  ues are allowed.
+00012cb0: 0a20 2020 2020 2020 2020 2020 202a 2027  .            * '
+00012cc0: 7361 6d65 5f6b 696e 6427 206d 6561 6e73  same_kind' means
+00012cd0: 206f 6e6c 7920 7361 6665 2063 6173 7473   only safe casts
+00012ce0: 206f 7220 6361 7374 7320 7769 7468 696e   or casts within
+00012cf0: 2061 206b 696e 642c 0a20 2020 2020 2020   a kind,.       
+00012d00: 2020 2020 2020 2020 206c 696b 6520 666c           like fl
+00012d10: 6f61 7436 3420 746f 2066 6c6f 6174 3332  oat64 to float32
+00012d20: 2c20 6172 6520 616c 6c6f 7765 642e 0a20  , are allowed.. 
+00012d30: 2020 2020 2020 2020 2020 202a 2027 756e             * 'un
+00012d40: 7361 6665 2720 6d65 616e 7320 616e 7920  safe' means any 
+00012d50: 6461 7461 2063 6f6e 7665 7273 696f 6e73  data conversions
+00012d60: 206d 6179 2062 6520 646f 6e65 2e0a 2020   may be done..  
+00012d70: 2020 2020 2020 636f 7079 203a 2062 6f6f        copy : boo
+00012d80: 6c2c 206f 7074 696f 6e61 6c0a 2020 2020  l, optional.    
+00012d90: 2020 2020 2020 2020 4279 2064 6566 6175          By defau
+00012da0: 6c74 2c20 6173 7479 7065 2061 6c77 6179  lt, astype alway
+00012db0: 7320 7265 7475 726e 7320 6120 6e65 776c  s returns a newl
+00012dc0: 7920 616c 6c6f 6361 7465 6420 6172 7261  y allocated arra
+00012dd0: 792e 2049 6620 7468 6973 0a20 2020 2020  y. If this.     
+00012de0: 2020 2020 2020 2069 7320 7365 7420 746f         is set to
+00012df0: 2046 616c 7365 2061 6e64 2074 6865 2060   False and the `
+00012e00: 6474 7970 6560 2072 6571 7569 7265 6d65  dtype` requireme
+00012e10: 6e74 2069 7320 7361 7469 7366 6965 642c  nt is satisfied,
+00012e20: 2074 6865 2069 6e70 7574 0a20 2020 2020   the input.     
+00012e30: 2020 2020 2020 2061 7272 6179 2069 7320         array is 
+00012e40: 7265 7475 726e 6564 2069 6e73 7465 6164  returned instead
+00012e50: 206f 6620 6120 636f 7079 2e0a 0a20 2020   of a copy...   
+00012e60: 2020 2020 2020 2020 202e 2e20 6e6f 7465           .. note
+00012e70: 3a3a 0a0a 2020 2020 2020 2020 2020 2020  ::..            
+00012e80: 2020 2020 4461 736b 2064 6f65 7320 6e6f      Dask does no
+00012e90: 7420 7265 7370 6563 7420 7468 6520 636f  t respect the co
+00012ea0: 6e74 6967 756f 7573 206d 656d 6f72 7920  ntiguous memory 
+00012eb0: 6c61 796f 7574 206f 6620 7468 6520 6172  layout of the ar
+00012ec0: 7261 792c 0a20 2020 2020 2020 2020 2020  ray,.           
+00012ed0: 2020 2020 2061 6e64 2077 696c 6c20 6967       and will ig
+00012ee0: 6e6f 7265 2074 6865 2060 606f 7264 6572  nore the ``order
+00012ef0: 6060 206b 6579 776f 7264 2061 7267 756d  `` keyword argum
+00012f00: 656e 742e 0a20 2020 2020 2020 2020 2020  ent..           
+00012f10: 2020 2020 2054 6865 2064 6566 6175 6c74       The default
+00012f20: 206f 7264 6572 2069 7320 2743 2720 636f   order is 'C' co
+00012f30: 6e74 6967 756f 7573 2e0a 2020 2020 2020  ntiguous..      
+00012f40: 2020 2222 220a 2020 2020 2020 2020 6b77    """.        kw
+00012f50: 6172 6773 2e70 6f70 2822 6f72 6465 7222  args.pop("order"
+00012f60: 2c20 4e6f 6e65 2920 2023 2060 6f72 6465  , None)  # `orde
+00012f70: 7260 2069 7320 6e6f 7420 7265 7370 6563  r` is not respec
+00012f80: 7465 642c 2073 6f20 7765 2072 656d 6f76  ted, so we remov
+00012f90: 6520 7468 6973 206b 7761 7267 0a20 2020  e this kwarg.   
+00012fa0: 2020 2020 2023 2053 6361 6c61 7273 2064       # Scalars d
+00012fb0: 6f6e 2774 2074 616b 6520 6063 6173 7469  on't take `casti
+00012fc0: 6e67 6020 6f72 2060 636f 7079 6020 6b77  ng` or `copy` kw
+00012fd0: 6172 6773 202d 2061 7320 7375 6368 2077  args - as such w
+00012fe0: 6520 6f6e 6c79 2070 6173 730a 2020 2020  e only pass.    
+00012ff0: 2020 2020 2320 7468 656d 2074 6f20 606d      # them to `m
+00013000: 6170 5f62 6c6f 636b 7360 2069 6620 7370  ap_blocks` if sp
+00013010: 6563 6966 6965 6420 6279 2075 7365 7220  ecified by user 
+00013020: 2864 6966 6665 7265 6e74 2074 6861 6e20  (different than 
+00013030: 6465 6661 756c 7473 292e 0a20 2020 2020  defaults)..     
+00013040: 2020 2065 7874 7261 203d 2073 6574 286b     extra = set(k
+00013050: 7761 7267 7329 202d 207b 2263 6173 7469  wargs) - {"casti
+00013060: 6e67 222c 2022 636f 7079 227d 0a20 2020  ng", "copy"}.   
+00013070: 2020 2020 2069 6620 6578 7472 613a 0a20       if extra:. 
+00013080: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00013090: 2054 7970 6545 7272 6f72 280a 2020 2020   TypeError(.    
+000130a0: 2020 2020 2020 2020 2020 2020 6622 6173              f"as
+000130b0: 7479 7065 2064 6f65 7320 6e6f 7420 7461  type does not ta
+000130c0: 6b65 2074 6865 2066 6f6c 6c6f 7769 6e67  ke the following
+000130d0: 206b 6579 776f 7264 2061 7267 756d 656e   keyword argumen
+000130e0: 7473 3a20 7b6c 6973 7428 6578 7472 6129  ts: {list(extra)
+000130f0: 7d22 0a20 2020 2020 2020 2020 2020 2029  }".            )
+00013100: 0a20 2020 2020 2020 2063 6173 7469 6e67  .        casting
+00013110: 203d 206b 7761 7267 732e 6765 7428 2263   = kwargs.get("c
+00013120: 6173 7469 6e67 222c 2022 756e 7361 6665  asting", "unsafe
+00013130: 2229 0a20 2020 2020 2020 2064 7479 7065  ").        dtype
+00013140: 203d 206e 702e 6474 7970 6528 6474 7970   = np.dtype(dtyp
+00013150: 6529 0a20 2020 2020 2020 2069 6620 7365  e).        if se
+00013160: 6c66 2e64 7479 7065 203d 3d20 6474 7970  lf.dtype == dtyp
+00013170: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
+00013180: 6574 7572 6e20 7365 6c66 0a20 2020 2020  eturn self.     
+00013190: 2020 2065 6c69 6620 6e6f 7420 6e70 2e63     elif not np.c
+000131a0: 616e 5f63 6173 7428 7365 6c66 2e64 7479  an_cast(self.dty
+000131b0: 7065 2c20 6474 7970 652c 2063 6173 7469  pe, dtype, casti
+000131c0: 6e67 3d63 6173 7469 6e67 293a 0a20 2020  ng=casting):.   
+000131d0: 2020 2020 2020 2020 2072 6169 7365 2054           raise T
+000131e0: 7970 6545 7272 6f72 280a 2020 2020 2020  ypeError(.      
+000131f0: 2020 2020 2020 2020 2020 6622 4361 6e6e            f"Cann
+00013200: 6f74 2063 6173 7420 6172 7261 7920 6672  ot cast array fr
+00013210: 6f6d 207b 7365 6c66 2e64 7479 7065 2172  om {self.dtype!r
+00013220: 7d20 746f 207b 6474 7970 6521 727d 2022  } to {dtype!r} "
+00013230: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013240: 2066 2261 6363 6f72 6469 6e67 2074 6f20   f"according to 
+00013250: 7468 6520 7275 6c65 207b 6361 7374 696e  the rule {castin
+00013260: 6721 727d 220a 2020 2020 2020 2020 2020  g!r}".          
+00013270: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
+00013280: 726e 2073 656c 662e 6d61 705f 626c 6f63  rn self.map_bloc
+00013290: 6b73 2863 6875 6e6b 2e61 7374 7970 652c  ks(chunk.astype,
+000132a0: 2064 7479 7065 3d64 7479 7065 2c20 6173   dtype=dtype, as
+000132b0: 7479 7065 5f64 7479 7065 3d64 7479 7065  type_dtype=dtype
+000132c0: 2c20 2a2a 6b77 6172 6773 290a 0a20 2020  , **kwargs)..   
+000132d0: 2064 6566 205f 5f61 6273 5f5f 2873 656c   def __abs__(sel
+000132e0: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+000132f0: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
+00013300: 6174 6f72 2e61 6273 2c20 7365 6c66 290a  ator.abs, self).
+00013310: 0a20 2020 2040 6368 6563 6b5f 6966 5f68  .    @check_if_h
+00013320: 616e 646c 6564 5f67 6976 656e 5f6f 7468  andled_given_oth
+00013330: 6572 0a20 2020 2064 6566 205f 5f61 6464  er.    def __add
+00013340: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
+00013350: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013360: 656c 656d 7769 7365 286f 7065 7261 746f  elemwise(operato
+00013370: 722e 6164 642c 2073 656c 662c 206f 7468  r.add, self, oth
+00013380: 6572 290a 0a20 2020 2040 6368 6563 6b5f  er)..    @check_
+00013390: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+000133a0: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+000133b0: 5f72 6164 645f 5f28 7365 6c66 2c20 6f74  _radd__(self, ot
+000133c0: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
+000133d0: 7475 726e 2065 6c65 6d77 6973 6528 6f70  turn elemwise(op
+000133e0: 6572 6174 6f72 2e61 6464 2c20 6f74 6865  erator.add, othe
+000133f0: 722c 2073 656c 6629 0a0a 2020 2020 4063  r, self)..    @c
+00013400: 6865 636b 5f69 665f 6861 6e64 6c65 645f  heck_if_handled_
+00013410: 6769 7665 6e5f 6f74 6865 720a 2020 2020  given_other.    
+00013420: 6465 6620 5f5f 616e 645f 5f28 7365 6c66  def __and__(self
+00013430: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+00013440: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
+00013450: 6528 6f70 6572 6174 6f72 2e61 6e64 5f2c  e(operator.and_,
+00013460: 2073 656c 662c 206f 7468 6572 290a 0a20   self, other).. 
+00013470: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
+00013480: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
+00013490: 0a20 2020 2064 6566 205f 5f72 616e 645f  .    def __rand_
+000134a0: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+000134b0: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+000134c0: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
+000134d0: 2e61 6e64 5f2c 206f 7468 6572 2c20 7365  .and_, other, se
+000134e0: 6c66 290a 0a20 2020 2040 6368 6563 6b5f  lf)..    @check_
+000134f0: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+00013500: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+00013510: 5f64 6976 5f5f 2873 656c 662c 206f 7468  _div__(self, oth
+00013520: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+00013530: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
+00013540: 7261 746f 722e 6469 762c 2073 656c 662c  rator.div, self,
+00013550: 206f 7468 6572 290a 0a20 2020 2040 6368   other)..    @ch
+00013560: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
+00013570: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
+00013580: 6566 205f 5f72 6469 765f 5f28 7365 6c66  ef __rdiv__(self
+00013590: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+000135a0: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
+000135b0: 6528 6f70 6572 6174 6f72 2e64 6976 2c20  e(operator.div, 
+000135c0: 6f74 6865 722c 2073 656c 6629 0a0a 2020  other, self)..  
+000135d0: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
+000135e0: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
+000135f0: 2020 2020 6465 6620 5f5f 6571 5f5f 2873      def __eq__(s
+00013600: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+00013610: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
+00013620: 7769 7365 286f 7065 7261 746f 722e 6571  wise(operator.eq
+00013630: 2c20 7365 6c66 2c20 6f74 6865 7229 0a0a  , self, other)..
+00013640: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
+00013650: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
+00013660: 720a 2020 2020 6465 6620 5f5f 6774 5f5f  r.    def __gt__
+00013670: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
+00013680: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
+00013690: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
+000136a0: 6774 2c20 7365 6c66 2c20 6f74 6865 7229  gt, self, other)
+000136b0: 0a0a 2020 2020 4063 6865 636b 5f69 665f  ..    @check_if_
+000136c0: 6861 6e64 6c65 645f 6769 7665 6e5f 6f74  handled_given_ot
+000136d0: 6865 720a 2020 2020 6465 6620 5f5f 6765  her.    def __ge
+000136e0: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
+000136f0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013700: 656c 656d 7769 7365 286f 7065 7261 746f  elemwise(operato
+00013710: 722e 6765 2c20 7365 6c66 2c20 6f74 6865  r.ge, self, othe
+00013720: 7229 0a0a 2020 2020 6465 6620 5f5f 696e  r)..    def __in
+00013730: 7665 7274 5f5f 2873 656c 6629 3a0a 2020  vert__(self):.  
+00013740: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
+00013750: 6d77 6973 6528 6f70 6572 6174 6f72 2e69  mwise(operator.i
+00013760: 6e76 6572 742c 2073 656c 6629 0a0a 2020  nvert, self)..  
+00013770: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
+00013780: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
+00013790: 2020 2020 6465 6620 5f5f 6c73 6869 6674      def __lshift
+000137a0: 5f5f 2873 656c 662c 206f 7468 6572 293a  __(self, other):
+000137b0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000137c0: 656c 656d 7769 7365 286f 7065 7261 746f  elemwise(operato
+000137d0: 722e 6c73 6869 6674 2c20 7365 6c66 2c20  r.lshift, self, 
+000137e0: 6f74 6865 7229 0a0a 2020 2020 4063 6865  other)..    @che
+000137f0: 636b 5f69 665f 6861 6e64 6c65 645f 6769  ck_if_handled_gi
+00013800: 7665 6e5f 6f74 6865 720a 2020 2020 6465  ven_other.    de
+00013810: 6620 5f5f 726c 7368 6966 745f 5f28 7365  f __rlshift__(se
+00013820: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
+00013830: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
+00013840: 6973 6528 6f70 6572 6174 6f72 2e6c 7368  ise(operator.lsh
+00013850: 6966 742c 206f 7468 6572 2c20 7365 6c66  ift, other, self
+00013860: 290a 0a20 2020 2040 6368 6563 6b5f 6966  )..    @check_if
+00013870: 5f68 616e 646c 6564 5f67 6976 656e 5f6f  _handled_given_o
+00013880: 7468 6572 0a20 2020 2064 6566 205f 5f6c  ther.    def __l
+00013890: 745f 5f28 7365 6c66 2c20 6f74 6865 7229  t__(self, other)
+000138a0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+000138b0: 2065 6c65 6d77 6973 6528 6f70 6572 6174   elemwise(operat
+000138c0: 6f72 2e6c 742c 2073 656c 662c 206f 7468  or.lt, self, oth
+000138d0: 6572 290a 0a20 2020 2040 6368 6563 6b5f  er)..    @check_
+000138e0: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+000138f0: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+00013900: 5f6c 655f 5f28 7365 6c66 2c20 6f74 6865  _le__(self, othe
+00013910: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+00013920: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
+00013930: 6174 6f72 2e6c 652c 2073 656c 662c 206f  ator.le, self, o
+00013940: 7468 6572 290a 0a20 2020 2040 6368 6563  ther)..    @chec
+00013950: 6b5f 6966 5f68 616e 646c 6564 5f67 6976  k_if_handled_giv
+00013960: 656e 5f6f 7468 6572 0a20 2020 2064 6566  en_other.    def
+00013970: 205f 5f6d 6f64 5f5f 2873 656c 662c 206f   __mod__(self, o
+00013980: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+00013990: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
+000139a0: 7065 7261 746f 722e 6d6f 642c 2073 656c  perator.mod, sel
+000139b0: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
+000139c0: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
+000139d0: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
+000139e0: 2064 6566 205f 5f72 6d6f 645f 5f28 7365   def __rmod__(se
+000139f0: 6c66 2c20 6f74 6865 7229 3a0a 2020 2020  lf, other):.    
+00013a00: 2020 2020 7265 7475 726e 2065 6c65 6d77      return elemw
+00013a10: 6973 6528 6f70 6572 6174 6f72 2e6d 6f64  ise(operator.mod
+00013a20: 2c20 6f74 6865 722c 2073 656c 6629 0a0a  , other, self)..
+00013a30: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
+00013a40: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
+00013a50: 720a 2020 2020 6465 6620 5f5f 6d75 6c5f  r.    def __mul_
+00013a60: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+00013a70: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00013a80: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
+00013a90: 2e6d 756c 2c20 7365 6c66 2c20 6f74 6865  .mul, self, othe
+00013aa0: 7229 0a0a 2020 2020 4063 6865 636b 5f69  r)..    @check_i
+00013ab0: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
+00013ac0: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
+00013ad0: 726d 756c 5f5f 2873 656c 662c 206f 7468  rmul__(self, oth
+00013ae0: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+00013af0: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
+00013b00: 7261 746f 722e 6d75 6c2c 206f 7468 6572  rator.mul, other
+00013b10: 2c20 7365 6c66 290a 0a20 2020 2040 6368  , self)..    @ch
+00013b20: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
+00013b30: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
+00013b40: 6566 205f 5f6e 655f 5f28 7365 6c66 2c20  ef __ne__(self, 
+00013b50: 6f74 6865 7229 3a0a 2020 2020 2020 2020  other):.        
+00013b60: 7265 7475 726e 2065 6c65 6d77 6973 6528  return elemwise(
+00013b70: 6f70 6572 6174 6f72 2e6e 652c 2073 656c  operator.ne, sel
+00013b80: 662c 206f 7468 6572 290a 0a20 2020 2064  f, other)..    d
+00013b90: 6566 205f 5f6e 6567 5f5f 2873 656c 6629  ef __neg__(self)
+00013ba0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00013bb0: 2065 6c65 6d77 6973 6528 6f70 6572 6174   elemwise(operat
+00013bc0: 6f72 2e6e 6567 2c20 7365 6c66 290a 0a20  or.neg, self).. 
+00013bd0: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
+00013be0: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
+00013bf0: 0a20 2020 2064 6566 205f 5f6f 725f 5f28  .    def __or__(
+00013c00: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
+00013c10: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
+00013c20: 6d77 6973 6528 6f70 6572 6174 6f72 2e6f  mwise(operator.o
+00013c30: 725f 2c20 7365 6c66 2c20 6f74 6865 7229  r_, self, other)
+00013c40: 0a0a 2020 2020 6465 6620 5f5f 706f 735f  ..    def __pos_
+00013c50: 5f28 7365 6c66 293a 0a20 2020 2020 2020  _(self):.       
+00013c60: 2072 6574 7572 6e20 7365 6c66 0a0a 2020   return self..  
+00013c70: 2020 4063 6865 636b 5f69 665f 6861 6e64    @check_if_hand
+00013c80: 6c65 645f 6769 7665 6e5f 6f74 6865 720a  led_given_other.
+00013c90: 2020 2020 6465 6620 5f5f 726f 725f 5f28      def __ror__(
+00013ca0: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
+00013cb0: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
+00013cc0: 6d77 6973 6528 6f70 6572 6174 6f72 2e6f  mwise(operator.o
+00013cd0: 725f 2c20 6f74 6865 722c 2073 656c 6629  r_, other, self)
+00013ce0: 0a0a 2020 2020 4063 6865 636b 5f69 665f  ..    @check_if_
+00013cf0: 6861 6e64 6c65 645f 6769 7665 6e5f 6f74  handled_given_ot
+00013d00: 6865 720a 2020 2020 6465 6620 5f5f 706f  her.    def __po
+00013d10: 775f 5f28 7365 6c66 2c20 6f74 6865 7229  w__(self, other)
+00013d20: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+00013d30: 2065 6c65 6d77 6973 6528 6f70 6572 6174   elemwise(operat
+00013d40: 6f72 2e70 6f77 2c20 7365 6c66 2c20 6f74  or.pow, self, ot
+00013d50: 6865 7229 0a0a 2020 2020 4063 6865 636b  her)..    @check
+00013d60: 5f69 665f 6861 6e64 6c65 645f 6769 7665  _if_handled_give
+00013d70: 6e5f 6f74 6865 720a 2020 2020 6465 6620  n_other.    def 
+00013d80: 5f5f 7270 6f77 5f5f 2873 656c 662c 206f  __rpow__(self, o
+00013d90: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+00013da0: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
+00013db0: 7065 7261 746f 722e 706f 772c 206f 7468  perator.pow, oth
+00013dc0: 6572 2c20 7365 6c66 290a 0a20 2020 2040  er, self)..    @
+00013dd0: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
+00013de0: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
+00013df0: 2064 6566 205f 5f72 7368 6966 745f 5f28   def __rshift__(
+00013e00: 7365 6c66 2c20 6f74 6865 7229 3a0a 2020  self, other):.  
+00013e10: 2020 2020 2020 7265 7475 726e 2065 6c65        return ele
+00013e20: 6d77 6973 6528 6f70 6572 6174 6f72 2e72  mwise(operator.r
+00013e30: 7368 6966 742c 2073 656c 662c 206f 7468  shift, self, oth
+00013e40: 6572 290a 0a20 2020 2040 6368 6563 6b5f  er)..    @check_
+00013e50: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+00013e60: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+00013e70: 5f72 7273 6869 6674 5f5f 2873 656c 662c  _rrshift__(self,
+00013e80: 206f 7468 6572 293a 0a20 2020 2020 2020   other):.       
+00013e90: 2072 6574 7572 6e20 656c 656d 7769 7365   return elemwise
+00013ea0: 286f 7065 7261 746f 722e 7273 6869 6674  (operator.rshift
+00013eb0: 2c20 6f74 6865 722c 2073 656c 6629 0a0a  , other, self)..
+00013ec0: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
+00013ed0: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
+00013ee0: 720a 2020 2020 6465 6620 5f5f 7375 625f  r.    def __sub_
+00013ef0: 5f28 7365 6c66 2c20 6f74 6865 7229 3a0a  _(self, other):.
+00013f00: 2020 2020 2020 2020 7265 7475 726e 2065          return e
+00013f10: 6c65 6d77 6973 6528 6f70 6572 6174 6f72  lemwise(operator
+00013f20: 2e73 7562 2c20 7365 6c66 2c20 6f74 6865  .sub, self, othe
+00013f30: 7229 0a0a 2020 2020 4063 6865 636b 5f69  r)..    @check_i
+00013f40: 665f 6861 6e64 6c65 645f 6769 7665 6e5f  f_handled_given_
+00013f50: 6f74 6865 720a 2020 2020 6465 6620 5f5f  other.    def __
+00013f60: 7273 7562 5f5f 2873 656c 662c 206f 7468  rsub__(self, oth
+00013f70: 6572 293a 0a20 2020 2020 2020 2072 6574  er):.        ret
+00013f80: 7572 6e20 656c 656d 7769 7365 286f 7065  urn elemwise(ope
+00013f90: 7261 746f 722e 7375 622c 206f 7468 6572  rator.sub, other
+00013fa0: 2c20 7365 6c66 290a 0a20 2020 2040 6368  , self)..    @ch
+00013fb0: 6563 6b5f 6966 5f68 616e 646c 6564 5f67  eck_if_handled_g
+00013fc0: 6976 656e 5f6f 7468 6572 0a20 2020 2064  iven_other.    d
+00013fd0: 6566 205f 5f74 7275 6564 6976 5f5f 2873  ef __truediv__(s
+00013fe0: 656c 662c 206f 7468 6572 293a 0a20 2020  elf, other):.   
+00013ff0: 2020 2020 2072 6574 7572 6e20 656c 656d       return elem
+00014000: 7769 7365 286f 7065 7261 746f 722e 7472  wise(operator.tr
+00014010: 7565 6469 762c 2073 656c 662c 206f 7468  uediv, self, oth
+00014020: 6572 290a 0a20 2020 2040 6368 6563 6b5f  er)..    @check_
+00014030: 6966 5f68 616e 646c 6564 5f67 6976 656e  if_handled_given
+00014040: 5f6f 7468 6572 0a20 2020 2064 6566 205f  _other.    def _
+00014050: 5f72 7472 7565 6469 765f 5f28 7365 6c66  _rtruediv__(self
+00014060: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+00014070: 2020 7265 7475 726e 2065 6c65 6d77 6973    return elemwis
+00014080: 6528 6f70 6572 6174 6f72 2e74 7275 6564  e(operator.trued
+00014090: 6976 2c20 6f74 6865 722c 2073 656c 6629  iv, other, self)
+000140a0: 0a0a 2020 2020 4063 6865 636b 5f69 665f  ..    @check_if_
+000140b0: 6861 6e64 6c65 645f 6769 7665 6e5f 6f74  handled_given_ot
+000140c0: 6865 720a 2020 2020 6465 6620 5f5f 666c  her.    def __fl
+000140d0: 6f6f 7264 6976 5f5f 2873 656c 662c 206f  oordiv__(self, o
+000140e0: 7468 6572 293a 0a20 2020 2020 2020 2072  ther):.        r
+000140f0: 6574 7572 6e20 656c 656d 7769 7365 286f  eturn elemwise(o
+00014100: 7065 7261 746f 722e 666c 6f6f 7264 6976  perator.floordiv
+00014110: 2c20 7365 6c66 2c20 6f74 6865 7229 0a0a  , self, other)..
+00014120: 2020 2020 4063 6865 636b 5f69 665f 6861      @check_if_ha
+00014130: 6e64 6c65 645f 6769 7665 6e5f 6f74 6865  ndled_given_othe
+00014140: 720a 2020 2020 6465 6620 5f5f 7266 6c6f  r.    def __rflo
+00014150: 6f72 6469 765f 5f28 7365 6c66 2c20 6f74  ordiv__(self, ot
+00014160: 6865 7229 3a0a 2020 2020 2020 2020 7265  her):.        re
+00014170: 7475 726e 2065 6c65 6d77 6973 6528 6f70  turn elemwise(op
+00014180: 6572 6174 6f72 2e66 6c6f 6f72 6469 762c  erator.floordiv,
+00014190: 206f 7468 6572 2c20 7365 6c66 290a 0a20   other, self).. 
+000141a0: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
+000141b0: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
+000141c0: 0a20 2020 2064 6566 205f 5f78 6f72 5f5f  .    def __xor__
+000141d0: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
+000141e0: 2020 2020 2020 2072 6574 7572 6e20 656c         return el
+000141f0: 656d 7769 7365 286f 7065 7261 746f 722e  emwise(operator.
+00014200: 786f 722c 2073 656c 662c 206f 7468 6572  xor, self, other
+00014210: 290a 0a20 2020 2040 6368 6563 6b5f 6966  )..    @check_if
+00014220: 5f68 616e 646c 6564 5f67 6976 656e 5f6f  _handled_given_o
+00014230: 7468 6572 0a20 2020 2064 6566 205f 5f72  ther.    def __r
+00014240: 786f 725f 5f28 7365 6c66 2c20 6f74 6865  xor__(self, othe
+00014250: 7229 3a0a 2020 2020 2020 2020 7265 7475  r):.        retu
+00014260: 726e 2065 6c65 6d77 6973 6528 6f70 6572  rn elemwise(oper
+00014270: 6174 6f72 2e78 6f72 2c20 6f74 6865 722c  ator.xor, other,
+00014280: 2073 656c 6629 0a0a 2020 2020 4063 6865   self)..    @che
+00014290: 636b 5f69 665f 6861 6e64 6c65 645f 6769  ck_if_handled_gi
+000142a0: 7665 6e5f 6f74 6865 720a 2020 2020 6465  ven_other.    de
+000142b0: 6620 5f5f 6d61 746d 756c 5f5f 2873 656c  f __matmul__(sel
+000142c0: 662c 206f 7468 6572 293a 0a20 2020 2020  f, other):.     
+000142d0: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
+000142e0: 6179 2e72 6f75 7469 6e65 7320 696d 706f  ay.routines impo
+000142f0: 7274 206d 6174 6d75 6c0a 0a20 2020 2020  rt matmul..     
+00014300: 2020 2072 6574 7572 6e20 6d61 746d 756c     return matmul
+00014310: 2873 656c 662c 206f 7468 6572 290a 0a20  (self, other).. 
+00014320: 2020 2040 6368 6563 6b5f 6966 5f68 616e     @check_if_han
+00014330: 646c 6564 5f67 6976 656e 5f6f 7468 6572  dled_given_other
+00014340: 0a20 2020 2064 6566 205f 5f72 6d61 746d  .    def __rmatm
+00014350: 756c 5f5f 2873 656c 662c 206f 7468 6572  ul__(self, other
+00014360: 293a 0a20 2020 2020 2020 2066 726f 6d20  ):.        from 
+00014370: 6461 736b 2e61 7272 6179 2e72 6f75 7469  dask.array.routi
+00014380: 6e65 7320 696d 706f 7274 206d 6174 6d75  nes import matmu
+00014390: 6c0a 0a20 2020 2020 2020 2072 6574 7572  l..        retur
+000143a0: 6e20 6d61 746d 756c 286f 7468 6572 2c20  n matmul(other, 
+000143b0: 7365 6c66 290a 0a20 2020 2040 6368 6563  self)..    @chec
+000143c0: 6b5f 6966 5f68 616e 646c 6564 5f67 6976  k_if_handled_giv
+000143d0: 656e 5f6f 7468 6572 0a20 2020 2064 6566  en_other.    def
+000143e0: 205f 5f64 6976 6d6f 645f 5f28 7365 6c66   __divmod__(self
+000143f0: 2c20 6f74 6865 7229 3a0a 2020 2020 2020  , other):.      
+00014400: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+00014410: 792e 7566 756e 6320 696d 706f 7274 2064  y.ufunc import d
+00014420: 6976 6d6f 640a 0a20 2020 2020 2020 2072  ivmod..        r
+00014430: 6574 7572 6e20 6469 766d 6f64 2873 656c  eturn divmod(sel
+00014440: 662c 206f 7468 6572 290a 0a20 2020 2040  f, other)..    @
+00014450: 6368 6563 6b5f 6966 5f68 616e 646c 6564  check_if_handled
+00014460: 5f67 6976 656e 5f6f 7468 6572 0a20 2020  _given_other.   
+00014470: 2064 6566 205f 5f72 6469 766d 6f64 5f5f   def __rdivmod__
+00014480: 2873 656c 662c 206f 7468 6572 293a 0a20  (self, other):. 
+00014490: 2020 2020 2020 2066 726f 6d20 6461 736b         from dask
+000144a0: 2e61 7272 6179 2e75 6675 6e63 2069 6d70  .array.ufunc imp
+000144b0: 6f72 7420 6469 766d 6f64 0a0a 2020 2020  ort divmod..    
+000144c0: 2020 2020 7265 7475 726e 2064 6976 6d6f      return divmo
+000144d0: 6428 6f74 6865 722c 2073 656c 6629 0a0a  d(other, self)..
+000144e0: 2020 2020 6465 6620 616e 7928 7365 6c66      def any(self
+000144f0: 2c20 6178 6973 3d4e 6f6e 652c 206b 6565  , axis=None, kee
+00014500: 7064 696d 733d 4661 6c73 652c 2073 706c  pdims=False, spl
+00014510: 6974 5f65 7665 7279 3d4e 6f6e 652c 206f  it_every=None, o
+00014520: 7574 3d4e 6f6e 6529 3a0a 2020 2020 2020  ut=None):.      
+00014530: 2020 2222 2252 6574 7572 6e73 2054 7275    """Returns Tru
+00014540: 6520 6966 2061 6e79 206f 6620 7468 6520  e if any of the 
+00014550: 656c 656d 656e 7473 2065 7661 6c75 6174  elements evaluat
+00014560: 6520 746f 2054 7275 652e 0a0a 2020 2020  e to True...    
+00014570: 2020 2020 5265 6665 7220 746f 203a 6675      Refer to :fu
+00014580: 6e63 3a60 6461 736b 2e61 7272 6179 2e61  nc:`dask.array.a
+00014590: 6e79 6020 666f 7220 6675 6c6c 2064 6f63  ny` for full doc
+000145a0: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
+000145b0: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+000145c0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+000145d0: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+000145e0: 792e 616e 7920 3a20 6571 7569 7661 6c65  y.any : equivale
+000145f0: 6e74 2066 756e 6374 696f 6e0a 2020 2020  nt function.    
+00014600: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00014610: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
+00014620: 7265 6475 6374 696f 6e73 2069 6d70 6f72  reductions impor
+00014630: 7420 616e 790a 0a20 2020 2020 2020 2072  t any..        r
+00014640: 6574 7572 6e20 616e 7928 7365 6c66 2c20  eturn any(self, 
+00014650: 6178 6973 3d61 7869 732c 206b 6565 7064  axis=axis, keepd
+00014660: 696d 733d 6b65 6570 6469 6d73 2c20 7370  ims=keepdims, sp
+00014670: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
+00014680: 6576 6572 792c 206f 7574 3d6f 7574 290a  every, out=out).
+00014690: 0a20 2020 2064 6566 2061 6c6c 2873 656c  .    def all(sel
+000146a0: 662c 2061 7869 733d 4e6f 6e65 2c20 6b65  f, axis=None, ke
+000146b0: 6570 6469 6d73 3d46 616c 7365 2c20 7370  epdims=False, sp
+000146c0: 6c69 745f 6576 6572 793d 4e6f 6e65 2c20  lit_every=None, 
+000146d0: 6f75 743d 4e6f 6e65 293a 0a20 2020 2020  out=None):.     
+000146e0: 2020 2022 2222 5265 7475 726e 7320 5472     """Returns Tr
+000146f0: 7565 2069 6620 616c 6c20 656c 656d 656e  ue if all elemen
+00014700: 7473 2065 7661 6c75 6174 6520 746f 2054  ts evaluate to T
+00014710: 7275 652e 0a0a 2020 2020 2020 2020 5265  rue...        Re
+00014720: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
+00014730: 736b 2e61 7272 6179 2e61 6c6c 6020 666f  sk.array.all` fo
+00014740: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
+00014750: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
+00014760: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00014770: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00014780: 2064 6173 6b2e 6172 7261 792e 616c 6c20   dask.array.all 
+00014790: 3a20 6571 7569 7661 6c65 6e74 2066 756e  : equivalent fun
+000147a0: 6374 696f 6e0a 2020 2020 2020 2020 2222  ction.        ""
+000147b0: 220a 2020 2020 2020 2020 6672 6f6d 2064  ".        from d
+000147c0: 6173 6b2e 6172 7261 792e 7265 6475 6374  ask.array.reduct
+000147d0: 696f 6e73 2069 6d70 6f72 7420 616c 6c0a  ions import all.
+000147e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000147f0: 616c 6c28 7365 6c66 2c20 6178 6973 3d61  all(self, axis=a
+00014800: 7869 732c 206b 6565 7064 696d 733d 6b65  xis, keepdims=ke
+00014810: 6570 6469 6d73 2c20 7370 6c69 745f 6576  epdims, split_ev
+00014820: 6572 793d 7370 6c69 745f 6576 6572 792c  ery=split_every,
+00014830: 206f 7574 3d6f 7574 290a 0a20 2020 2064   out=out)..    d
+00014840: 6566 206d 696e 2873 656c 662c 2061 7869  ef min(self, axi
+00014850: 733d 4e6f 6e65 2c20 6b65 6570 6469 6d73  s=None, keepdims
+00014860: 3d46 616c 7365 2c20 7370 6c69 745f 6576  =False, split_ev
+00014870: 6572 793d 4e6f 6e65 2c20 6f75 743d 4e6f  ery=None, out=No
+00014880: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00014890: 5265 7475 726e 2074 6865 206d 696e 696d  Return the minim
+000148a0: 756d 2061 6c6f 6e67 2061 2067 6976 656e  um along a given
+000148b0: 2061 7869 732e 0a0a 2020 2020 2020 2020   axis...        
+000148c0: 5265 6665 7220 746f 203a 6675 6e63 3a60  Refer to :func:`
+000148d0: 6461 736b 2e61 7272 6179 2e6d 696e 6020  dask.array.min` 
+000148e0: 666f 7220 6675 6c6c 2064 6f63 756d 656e  for full documen
+000148f0: 7461 7469 6f6e 2e0a 0a20 2020 2020 2020  tation...       
+00014900: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+00014910: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+00014920: 2020 2064 6173 6b2e 6172 7261 792e 6d69     dask.array.mi
+00014930: 6e20 3a20 6571 7569 7661 6c65 6e74 2066  n : equivalent f
+00014940: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
+00014950: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00014960: 2064 6173 6b2e 6172 7261 792e 7265 6475   dask.array.redu
+00014970: 6374 696f 6e73 2069 6d70 6f72 7420 6d69  ctions import mi
+00014980: 6e0a 0a20 2020 2020 2020 2072 6574 7572  n..        retur
+00014990: 6e20 6d69 6e28 7365 6c66 2c20 6178 6973  n min(self, axis
+000149a0: 3d61 7869 732c 206b 6565 7064 696d 733d  =axis, keepdims=
+000149b0: 6b65 6570 6469 6d73 2c20 7370 6c69 745f  keepdims, split_
+000149c0: 6576 6572 793d 7370 6c69 745f 6576 6572  every=split_ever
+000149d0: 792c 206f 7574 3d6f 7574 290a 0a20 2020  y, out=out)..   
+000149e0: 2064 6566 206d 6178 2873 656c 662c 2061   def max(self, a
+000149f0: 7869 733d 4e6f 6e65 2c20 6b65 6570 6469  xis=None, keepdi
+00014a00: 6d73 3d46 616c 7365 2c20 7370 6c69 745f  ms=False, split_
+00014a10: 6576 6572 793d 4e6f 6e65 2c20 6f75 743d  every=None, out=
+00014a20: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+00014a30: 2222 5265 7475 726e 2074 6865 206d 6178  ""Return the max
+00014a40: 696d 756d 2061 6c6f 6e67 2061 2067 6976  imum along a giv
+00014a50: 656e 2061 7869 732e 0a0a 2020 2020 2020  en axis...      
+00014a60: 2020 5265 6665 7220 746f 203a 6675 6e63    Refer to :func
+00014a70: 3a60 6461 736b 2e61 7272 6179 2e6d 6178  :`dask.array.max
+00014a80: 6020 666f 7220 6675 6c6c 2064 6f63 756d  ` for full docum
+00014a90: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
+00014aa0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00014ab0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00014ac0: 2020 2020 2064 6173 6b2e 6172 7261 792e       dask.array.
+00014ad0: 6d61 7820 3a20 6571 7569 7661 6c65 6e74  max : equivalent
+00014ae0: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00014af0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00014b00: 6f6d 2064 6173 6b2e 6172 7261 792e 7265  om dask.array.re
+00014b10: 6475 6374 696f 6e73 2069 6d70 6f72 7420  ductions import 
+00014b20: 6d61 780a 0a20 2020 2020 2020 2072 6574  max..        ret
+00014b30: 7572 6e20 6d61 7828 7365 6c66 2c20 6178  urn max(self, ax
+00014b40: 6973 3d61 7869 732c 206b 6565 7064 696d  is=axis, keepdim
+00014b50: 733d 6b65 6570 6469 6d73 2c20 7370 6c69  s=keepdims, spli
+00014b60: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
+00014b70: 6572 792c 206f 7574 3d6f 7574 290a 0a20  ery, out=out).. 
+00014b80: 2020 2064 6566 2061 7267 6d69 6e28 7365     def argmin(se
+00014b90: 6c66 2c20 6178 6973 3d4e 6f6e 652c 202a  lf, axis=None, *
+00014ba0: 2c20 6b65 6570 6469 6d73 3d46 616c 7365  , keepdims=False
+00014bb0: 2c20 7370 6c69 745f 6576 6572 793d 4e6f  , split_every=No
+00014bc0: 6e65 2c20 6f75 743d 4e6f 6e65 293a 0a20  ne, out=None):. 
+00014bd0: 2020 2020 2020 2022 2222 5265 7475 726e         """Return
+00014be0: 2069 6e64 6963 6573 206f 6620 7468 6520   indices of the 
+00014bf0: 6d69 6e69 6d75 6d20 7661 6c75 6573 2061  minimum values a
+00014c00: 6c6f 6e67 2074 6865 2067 6976 656e 2061  long the given a
+00014c10: 7869 732e 0a0a 2020 2020 2020 2020 5265  xis...        Re
+00014c20: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
+00014c30: 736b 2e61 7272 6179 2e61 7267 6d69 6e60  sk.array.argmin`
+00014c40: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
+00014c50: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
+00014c60: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00014c70: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00014c80: 2020 2020 6461 736b 2e61 7272 6179 2e61      dask.array.a
+00014c90: 7267 6d69 6e20 3a20 6571 7569 7661 6c65  rgmin : equivale
+00014ca0: 6e74 2066 756e 6374 696f 6e0a 2020 2020  nt function.    
+00014cb0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00014cc0: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
+00014cd0: 7265 6475 6374 696f 6e73 2069 6d70 6f72  reductions impor
+00014ce0: 7420 6172 676d 696e 0a0a 2020 2020 2020  t argmin..      
+00014cf0: 2020 7265 7475 726e 2061 7267 6d69 6e28    return argmin(
+00014d00: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00014d10: 662c 2061 7869 733d 6178 6973 2c20 6b65  f, axis=axis, ke
+00014d20: 6570 6469 6d73 3d6b 6565 7064 696d 732c  epdims=keepdims,
+00014d30: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
+00014d40: 6974 5f65 7665 7279 2c20 6f75 743d 6f75  it_every, out=ou
+00014d50: 740a 2020 2020 2020 2020 290a 0a20 2020  t.        )..   
+00014d60: 2064 6566 2061 7267 6d61 7828 7365 6c66   def argmax(self
+00014d70: 2c20 6178 6973 3d4e 6f6e 652c 202a 2c20  , axis=None, *, 
+00014d80: 6b65 6570 6469 6d73 3d46 616c 7365 2c20  keepdims=False, 
+00014d90: 7370 6c69 745f 6576 6572 793d 4e6f 6e65  split_every=None
+00014da0: 2c20 6f75 743d 4e6f 6e65 293a 0a20 2020  , out=None):.   
+00014db0: 2020 2020 2022 2222 5265 7475 726e 2069       """Return i
+00014dc0: 6e64 6963 6573 206f 6620 7468 6520 6d61  ndices of the ma
+00014dd0: 7869 6d75 6d20 7661 6c75 6573 2061 6c6f  ximum values alo
+00014de0: 6e67 2074 6865 2067 6976 656e 2061 7869  ng the given axi
+00014df0: 732e 0a0a 2020 2020 2020 2020 5265 6665  s...        Refe
+00014e00: 7220 746f 203a 6675 6e63 3a60 6461 736b  r to :func:`dask
+00014e10: 2e61 7272 6179 2e61 7267 6d61 7860 2066  .array.argmax` f
+00014e20: 6f72 2066 756c 6c20 646f 6375 6d65 6e74  or full document
+00014e30: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
+00014e40: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00014e50: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00014e60: 2020 6461 736b 2e61 7272 6179 2e61 7267    dask.array.arg
+00014e70: 6d61 7820 3a20 6571 7569 7661 6c65 6e74  max : equivalent
+00014e80: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00014e90: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00014ea0: 6f6d 2064 6173 6b2e 6172 7261 792e 7265  om dask.array.re
+00014eb0: 6475 6374 696f 6e73 2069 6d70 6f72 7420  ductions import 
+00014ec0: 6172 676d 6178 0a0a 2020 2020 2020 2020  argmax..        
+00014ed0: 7265 7475 726e 2061 7267 6d61 7828 0a20  return argmax(. 
+00014ee0: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00014ef0: 2061 7869 733d 6178 6973 2c20 6b65 6570   axis=axis, keep
+00014f00: 6469 6d73 3d6b 6565 7064 696d 732c 2073  dims=keepdims, s
+00014f10: 706c 6974 5f65 7665 7279 3d73 706c 6974  plit_every=split
+00014f20: 5f65 7665 7279 2c20 6f75 743d 6f75 740a  _every, out=out.
+00014f30: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+00014f40: 6566 2073 756d 2873 656c 662c 2061 7869  ef sum(self, axi
+00014f50: 733d 4e6f 6e65 2c20 6474 7970 653d 4e6f  s=None, dtype=No
+00014f60: 6e65 2c20 6b65 6570 6469 6d73 3d46 616c  ne, keepdims=Fal
+00014f70: 7365 2c20 7370 6c69 745f 6576 6572 793d  se, split_every=
+00014f80: 4e6f 6e65 2c20 6f75 743d 4e6f 6e65 293a  None, out=None):
+00014f90: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00014fa0: 2020 2020 2052 6574 7572 6e20 7468 6520       Return the 
+00014fb0: 7375 6d20 6f66 2074 6865 2061 7272 6179  sum of the array
+00014fc0: 2065 6c65 6d65 6e74 7320 6f76 6572 2074   elements over t
+00014fd0: 6865 2067 6976 656e 2061 7869 732e 0a0a  he given axis...
+00014fe0: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
+00014ff0: 203a 6675 6e63 3a60 6461 736b 2e61 7272   :func:`dask.arr
+00015000: 6179 2e73 756d 6020 666f 7220 6675 6c6c  ay.sum` for full
+00015010: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+00015020: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00015030: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00015040: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+00015050: 6172 7261 792e 7375 6d20 3a20 6571 7569  array.sum : equi
+00015060: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+00015070: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015080: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00015090: 7261 792e 7265 6475 6374 696f 6e73 2069  ray.reductions i
+000150a0: 6d70 6f72 7420 7375 6d0a 0a20 2020 2020  mport sum..     
+000150b0: 2020 2072 6574 7572 6e20 7375 6d28 0a20     return sum(. 
+000150c0: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+000150d0: 0a20 2020 2020 2020 2020 2020 2061 7869  .            axi
+000150e0: 733d 6178 6973 2c0a 2020 2020 2020 2020  s=axis,.        
+000150f0: 2020 2020 6474 7970 653d 6474 7970 652c      dtype=dtype,
+00015100: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
+00015110: 7064 696d 733d 6b65 6570 6469 6d73 2c0a  pdims=keepdims,.
+00015120: 2020 2020 2020 2020 2020 2020 7370 6c69              spli
+00015130: 745f 6576 6572 793d 7370 6c69 745f 6576  t_every=split_ev
+00015140: 6572 792c 0a20 2020 2020 2020 2020 2020  ery,.           
+00015150: 206f 7574 3d6f 7574 2c0a 2020 2020 2020   out=out,.      
+00015160: 2020 290a 0a20 2020 2064 6566 2074 7261    )..    def tra
+00015170: 6365 2873 656c 662c 206f 6666 7365 743d  ce(self, offset=
+00015180: 302c 2061 7869 7331 3d30 2c20 6178 6973  0, axis1=0, axis
+00015190: 323d 312c 2064 7479 7065 3d4e 6f6e 6529  2=1, dtype=None)
+000151a0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+000151b0: 7572 6e20 7468 6520 7375 6d20 616c 6f6e  urn the sum alon
+000151c0: 6720 6469 6167 6f6e 616c 7320 6f66 2074  g diagonals of t
+000151d0: 6865 2061 7272 6179 2e0a 0a20 2020 2020  he array...     
+000151e0: 2020 2052 6566 6572 2074 6f20 3a66 756e     Refer to :fun
+000151f0: 633a 6064 6173 6b2e 6172 7261 792e 7472  c:`dask.array.tr
+00015200: 6163 6560 2066 6f72 2066 756c 6c20 646f  ace` for full do
+00015210: 6375 6d65 6e74 6174 696f 6e2e 0a0a 2020  cumentation...  
+00015220: 2020 2020 2020 5365 6520 416c 736f 0a20        See Also. 
+00015230: 2020 2020 2020 202d 2d2d 2d2d 2d2d 2d0a         --------.
+00015240: 2020 2020 2020 2020 6461 736b 2e61 7272          dask.arr
+00015250: 6179 2e74 7261 6365 203a 2065 7175 6976  ay.trace : equiv
+00015260: 616c 656e 7420 6675 6e63 7469 6f6e 0a20  alent function. 
+00015270: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00015280: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
+00015290: 6179 2e72 6564 7563 7469 6f6e 7320 696d  ay.reductions im
+000152a0: 706f 7274 2074 7261 6365 0a0a 2020 2020  port trace..    
+000152b0: 2020 2020 7265 7475 726e 2074 7261 6365      return trace
+000152c0: 2873 656c 662c 206f 6666 7365 743d 6f66  (self, offset=of
+000152d0: 6673 6574 2c20 6178 6973 313d 6178 6973  fset, axis1=axis
+000152e0: 312c 2061 7869 7332 3d61 7869 7332 2c20  1, axis2=axis2, 
+000152f0: 6474 7970 653d 6474 7970 6529 0a0a 2020  dtype=dtype)..  
+00015300: 2020 6465 6620 7072 6f64 2873 656c 662c    def prod(self,
+00015310: 2061 7869 733d 4e6f 6e65 2c20 6474 7970   axis=None, dtyp
+00015320: 653d 4e6f 6e65 2c20 6b65 6570 6469 6d73  e=None, keepdims
+00015330: 3d46 616c 7365 2c20 7370 6c69 745f 6576  =False, split_ev
+00015340: 6572 793d 4e6f 6e65 2c20 6f75 743d 4e6f  ery=None, out=No
+00015350: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+00015360: 5265 7475 726e 2074 6865 2070 726f 6475  Return the produ
+00015370: 6374 206f 6620 7468 6520 6172 7261 7920  ct of the array 
+00015380: 656c 656d 656e 7473 206f 7665 7220 7468  elements over th
+00015390: 6520 6769 7665 6e20 6178 6973 0a0a 2020  e given axis..  
+000153a0: 2020 2020 2020 5265 6665 7220 746f 203a        Refer to :
+000153b0: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+000153c0: 2e70 726f 6460 2066 6f72 2066 756c 6c20  .prod` for full 
+000153d0: 646f 6375 6d65 6e74 6174 696f 6e2e 0a0a  documentation...
+000153e0: 2020 2020 2020 2020 5365 6520 416c 736f          See Also
+000153f0: 0a20 2020 2020 2020 202d 2d2d 2d2d 2d2d  .        -------
+00015400: 2d0a 2020 2020 2020 2020 6461 736b 2e61  -.        dask.a
+00015410: 7272 6179 2e70 726f 6420 3a20 6571 7569  rray.prod : equi
+00015420: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+00015430: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015440: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00015450: 7261 792e 7265 6475 6374 696f 6e73 2069  ray.reductions i
+00015460: 6d70 6f72 7420 7072 6f64 0a0a 2020 2020  mport prod..    
+00015470: 2020 2020 7265 7475 726e 2070 726f 6428      return prod(
+00015480: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00015490: 662c 0a20 2020 2020 2020 2020 2020 2061  f,.            a
+000154a0: 7869 733d 6178 6973 2c0a 2020 2020 2020  xis=axis,.      
+000154b0: 2020 2020 2020 6474 7970 653d 6474 7970        dtype=dtyp
+000154c0: 652c 0a20 2020 2020 2020 2020 2020 206b  e,.            k
+000154d0: 6565 7064 696d 733d 6b65 6570 6469 6d73  eepdims=keepdims
+000154e0: 2c0a 2020 2020 2020 2020 2020 2020 7370  ,.            sp
+000154f0: 6c69 745f 6576 6572 793d 7370 6c69 745f  lit_every=split_
+00015500: 6576 6572 792c 0a20 2020 2020 2020 2020  every,.         
+00015510: 2020 206f 7574 3d6f 7574 2c0a 2020 2020     out=out,.    
+00015520: 2020 2020 290a 0a20 2020 2064 6566 206d      )..    def m
+00015530: 6561 6e28 7365 6c66 2c20 6178 6973 3d4e  ean(self, axis=N
+00015540: 6f6e 652c 2064 7479 7065 3d4e 6f6e 652c  one, dtype=None,
+00015550: 206b 6565 7064 696d 733d 4661 6c73 652c   keepdims=False,
+00015560: 2073 706c 6974 5f65 7665 7279 3d4e 6f6e   split_every=Non
+00015570: 652c 206f 7574 3d4e 6f6e 6529 3a0a 2020  e, out=None):.  
+00015580: 2020 2020 2020 2222 2252 6574 7572 6e73        """Returns
+00015590: 2074 6865 2061 7665 7261 6765 206f 6620   the average of 
+000155a0: 7468 6520 6172 7261 7920 656c 656d 656e  the array elemen
+000155b0: 7473 2061 6c6f 6e67 2067 6976 656e 2061  ts along given a
+000155c0: 7869 732e 0a0a 2020 2020 2020 2020 5265  xis...        Re
+000155d0: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
+000155e0: 736b 2e61 7272 6179 2e6d 6561 6e60 2066  sk.array.mean` f
+000155f0: 6f72 2066 756c 6c20 646f 6375 6d65 6e74  or full document
+00015600: 6174 696f 6e2e 0a0a 2020 2020 2020 2020  ation...        
+00015610: 5365 6520 416c 736f 0a20 2020 2020 2020  See Also.       
+00015620: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 2020   --------.      
+00015630: 2020 6461 736b 2e61 7272 6179 2e6d 6561    dask.array.mea
+00015640: 6e20 3a20 6571 7569 7661 6c65 6e74 2066  n : equivalent f
+00015650: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
+00015660: 2222 220a 2020 2020 2020 2020 6672 6f6d  """.        from
+00015670: 2064 6173 6b2e 6172 7261 792e 7265 6475   dask.array.redu
+00015680: 6374 696f 6e73 2069 6d70 6f72 7420 6d65  ctions import me
+00015690: 616e 0a0a 2020 2020 2020 2020 7265 7475  an..        retu
+000156a0: 726e 206d 6561 6e28 0a20 2020 2020 2020  rn mean(.       
+000156b0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+000156c0: 2020 2020 2020 2061 7869 733d 6178 6973         axis=axis
+000156d0: 2c0a 2020 2020 2020 2020 2020 2020 6474  ,.            dt
+000156e0: 7970 653d 6474 7970 652c 0a20 2020 2020  ype=dtype,.     
+000156f0: 2020 2020 2020 206b 6565 7064 696d 733d         keepdims=
+00015700: 6b65 6570 6469 6d73 2c0a 2020 2020 2020  keepdims,.      
+00015710: 2020 2020 2020 7370 6c69 745f 6576 6572        split_ever
+00015720: 793d 7370 6c69 745f 6576 6572 792c 0a20  y=split_every,. 
+00015730: 2020 2020 2020 2020 2020 206f 7574 3d6f             out=o
+00015740: 7574 2c0a 2020 2020 2020 2020 290a 0a20  ut,.        ).. 
+00015750: 2020 2064 6566 2073 7464 280a 2020 2020     def std(.    
+00015760: 2020 2020 7365 6c66 2c20 6178 6973 3d4e      self, axis=N
+00015770: 6f6e 652c 2064 7479 7065 3d4e 6f6e 652c  one, dtype=None,
+00015780: 206b 6565 7064 696d 733d 4661 6c73 652c   keepdims=False,
+00015790: 2064 646f 663d 302c 2073 706c 6974 5f65   ddof=0, split_e
+000157a0: 7665 7279 3d4e 6f6e 652c 206f 7574 3d4e  very=None, out=N
+000157b0: 6f6e 650a 2020 2020 293a 0a20 2020 2020  one.    ):.     
+000157c0: 2020 2022 2222 5265 7475 726e 7320 7468     """Returns th
+000157d0: 6520 7374 616e 6461 7264 2064 6576 6961  e standard devia
+000157e0: 7469 6f6e 206f 6620 7468 6520 6172 7261  tion of the arra
+000157f0: 7920 656c 656d 656e 7473 2061 6c6f 6e67  y elements along
+00015800: 2067 6976 656e 2061 7869 732e 0a0a 2020   given axis...  
+00015810: 2020 2020 2020 5265 6665 7220 746f 203a        Refer to :
+00015820: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+00015830: 2e73 7464 6020 666f 7220 6675 6c6c 2064  .std` for full d
+00015840: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
+00015850: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+00015860: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+00015870: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
+00015880: 7261 792e 7374 6420 3a20 6571 7569 7661  ray.std : equiva
+00015890: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
+000158a0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+000158b0: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+000158c0: 792e 7265 6475 6374 696f 6e73 2069 6d70  y.reductions imp
+000158d0: 6f72 7420 7374 640a 0a20 2020 2020 2020  ort std..       
+000158e0: 2072 6574 7572 6e20 7374 6428 0a20 2020   return std(.   
+000158f0: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+00015900: 2020 2020 2020 2020 2020 2061 7869 733d             axis=
+00015910: 6178 6973 2c0a 2020 2020 2020 2020 2020  axis,.          
+00015920: 2020 6474 7970 653d 6474 7970 652c 0a20    dtype=dtype,. 
+00015930: 2020 2020 2020 2020 2020 206b 6565 7064             keepd
+00015940: 696d 733d 6b65 6570 6469 6d73 2c0a 2020  ims=keepdims,.  
+00015950: 2020 2020 2020 2020 2020 6464 6f66 3d64            ddof=d
+00015960: 646f 662c 0a20 2020 2020 2020 2020 2020  dof,.           
+00015970: 2073 706c 6974 5f65 7665 7279 3d73 706c   split_every=spl
+00015980: 6974 5f65 7665 7279 2c0a 2020 2020 2020  it_every,.      
+00015990: 2020 2020 2020 6f75 743d 6f75 742c 0a20        out=out,. 
+000159a0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+000159b0: 6620 7661 7228 0a20 2020 2020 2020 2073  f var(.        s
+000159c0: 656c 662c 2061 7869 733d 4e6f 6e65 2c20  elf, axis=None, 
+000159d0: 6474 7970 653d 4e6f 6e65 2c20 6b65 6570  dtype=None, keep
+000159e0: 6469 6d73 3d46 616c 7365 2c20 6464 6f66  dims=False, ddof
+000159f0: 3d30 2c20 7370 6c69 745f 6576 6572 793d  =0, split_every=
+00015a00: 4e6f 6e65 2c20 6f75 743d 4e6f 6e65 0a20  None, out=None. 
+00015a10: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00015a20: 2252 6574 7572 6e73 2074 6865 2076 6172  "Returns the var
+00015a30: 6961 6e63 6520 6f66 2074 6865 2061 7272  iance of the arr
+00015a40: 6179 2065 6c65 6d65 6e74 732c 2061 6c6f  ay elements, alo
+00015a50: 6e67 2067 6976 656e 2061 7869 732e 0a0a  ng given axis...
+00015a60: 2020 2020 2020 2020 5265 6665 7220 746f          Refer to
+00015a70: 203a 6675 6e63 3a60 6461 736b 2e61 7272   :func:`dask.arr
+00015a80: 6179 2e76 6172 6020 666f 7220 6675 6c6c  ay.var` for full
+00015a90: 2064 6f63 756d 656e 7461 7469 6f6e 2e0a   documentation..
+00015aa0: 0a20 2020 2020 2020 2053 6565 2041 6c73  .        See Als
+00015ab0: 6f0a 2020 2020 2020 2020 2d2d 2d2d 2d2d  o.        ------
+00015ac0: 2d2d 0a20 2020 2020 2020 2064 6173 6b2e  --.        dask.
+00015ad0: 6172 7261 792e 7661 7220 3a20 6571 7569  array.var : equi
+00015ae0: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+00015af0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00015b00: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00015b10: 7261 792e 7265 6475 6374 696f 6e73 2069  ray.reductions i
+00015b20: 6d70 6f72 7420 7661 720a 0a20 2020 2020  mport var..     
+00015b30: 2020 2072 6574 7572 6e20 7661 7228 0a20     return var(. 
+00015b40: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00015b50: 0a20 2020 2020 2020 2020 2020 2061 7869  .            axi
+00015b60: 733d 6178 6973 2c0a 2020 2020 2020 2020  s=axis,.        
+00015b70: 2020 2020 6474 7970 653d 6474 7970 652c      dtype=dtype,
+00015b80: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
+00015b90: 7064 696d 733d 6b65 6570 6469 6d73 2c0a  pdims=keepdims,.
+00015ba0: 2020 2020 2020 2020 2020 2020 6464 6f66              ddof
+00015bb0: 3d64 646f 662c 0a20 2020 2020 2020 2020  =ddof,.         
+00015bc0: 2020 2073 706c 6974 5f65 7665 7279 3d73     split_every=s
+00015bd0: 706c 6974 5f65 7665 7279 2c0a 2020 2020  plit_every,.    
+00015be0: 2020 2020 2020 2020 6f75 743d 6f75 742c          out=out,
+00015bf0: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00015c00: 6465 6620 6d6f 6d65 6e74 280a 2020 2020  def moment(.    
+00015c10: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00015c20: 2020 6f72 6465 722c 0a20 2020 2020 2020    order,.       
+00015c30: 2061 7869 733d 4e6f 6e65 2c0a 2020 2020   axis=None,.    
+00015c40: 2020 2020 6474 7970 653d 4e6f 6e65 2c0a      dtype=None,.
+00015c50: 2020 2020 2020 2020 6b65 6570 6469 6d73          keepdims
+00015c60: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00015c70: 6464 6f66 3d30 2c0a 2020 2020 2020 2020  ddof=0,.        
+00015c80: 7370 6c69 745f 6576 6572 793d 4e6f 6e65  split_every=None
+00015c90: 2c0a 2020 2020 2020 2020 6f75 743d 4e6f  ,.        out=No
+00015ca0: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
+00015cb0: 2020 2022 2222 4361 6c63 756c 6174 6520     """Calculate 
+00015cc0: 7468 6520 6e74 6820 6365 6e74 7261 6c69  the nth centrali
+00015cd0: 7a65 6420 6d6f 6d65 6e74 2e0a 0a20 2020  zed moment...   
+00015ce0: 2020 2020 2052 6566 6572 2074 6f20 3a66       Refer to :f
+00015cf0: 756e 633a 6064 6173 6b2e 6172 7261 792e  unc:`dask.array.
+00015d00: 6d6f 6d65 6e74 6020 666f 7220 7468 6520  moment` for the 
+00015d10: 6675 6c6c 2064 6f63 756d 656e 7461 7469  full documentati
+00015d20: 6f6e 2e0a 0a20 2020 2020 2020 2053 6565  on...        See
+00015d30: 2041 6c73 6f0a 2020 2020 2020 2020 2d2d   Also.        --
+00015d40: 2d2d 2d2d 2d2d 0a20 2020 2020 2020 2064  ------.        d
+00015d50: 6173 6b2e 6172 7261 792e 6d6f 6d65 6e74  ask.array.moment
+00015d60: 203a 2065 7175 6976 616c 656e 7420 6675   : equivalent fu
+00015d70: 6e63 7469 6f6e 0a20 2020 2020 2020 2022  nction.        "
+00015d80: 2222 0a20 2020 2020 2020 2066 726f 6d20  "".        from 
+00015d90: 6461 736b 2e61 7272 6179 2e72 6564 7563  dask.array.reduc
+00015da0: 7469 6f6e 7320 696d 706f 7274 206d 6f6d  tions import mom
+00015db0: 656e 740a 0a20 2020 2020 2020 2072 6574  ent..        ret
+00015dc0: 7572 6e20 6d6f 6d65 6e74 280a 2020 2020  urn moment(.    
+00015dd0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00015de0: 2020 2020 2020 2020 2020 6f72 6465 722c            order,
+00015df0: 0a20 2020 2020 2020 2020 2020 2061 7869  .            axi
+00015e00: 733d 6178 6973 2c0a 2020 2020 2020 2020  s=axis,.        
+00015e10: 2020 2020 6474 7970 653d 6474 7970 652c      dtype=dtype,
+00015e20: 0a20 2020 2020 2020 2020 2020 206b 6565  .            kee
+00015e30: 7064 696d 733d 6b65 6570 6469 6d73 2c0a  pdims=keepdims,.
+00015e40: 2020 2020 2020 2020 2020 2020 6464 6f66              ddof
+00015e50: 3d64 646f 662c 0a20 2020 2020 2020 2020  =ddof,.         
+00015e60: 2020 2073 706c 6974 5f65 7665 7279 3d73     split_every=s
+00015e70: 706c 6974 5f65 7665 7279 2c0a 2020 2020  plit_every,.    
+00015e80: 2020 2020 2020 2020 6f75 743d 6f75 742c          out=out,
+00015e90: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
+00015ea0: 4077 7261 7073 286d 6170 5f62 6c6f 636b  @wraps(map_block
+00015eb0: 7329 0a20 2020 2064 6566 206d 6170 5f62  s).    def map_b
+00015ec0: 6c6f 636b 7328 7365 6c66 2c20 6675 6e63  locks(self, func
+00015ed0: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+00015ee0: 7329 3a0a 2020 2020 2020 2020 7265 7475  s):.        retu
+00015ef0: 726e 206d 6170 5f62 6c6f 636b 7328 6675  rn map_blocks(fu
+00015f00: 6e63 2c20 7365 6c66 2c20 2a61 7267 732c  nc, self, *args,
+00015f10: 202a 2a6b 7761 7267 7329 0a0a 2020 2020   **kwargs)..    
+00015f20: 6465 6620 6d61 705f 6f76 6572 6c61 7028  def map_overlap(
+00015f30: 7365 6c66 2c20 6675 6e63 2c20 6465 7074  self, func, dept
+00015f40: 682c 2062 6f75 6e64 6172 793d 4e6f 6e65  h, boundary=None
+00015f50: 2c20 7472 696d 3d54 7275 652c 202a 2a6b  , trim=True, **k
+00015f60: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00015f70: 2222 224d 6170 2061 2066 756e 6374 696f  """Map a functio
+00015f80: 6e20 6f76 6572 2062 6c6f 636b 7320 6f66  n over blocks of
+00015f90: 2074 6865 2061 7272 6179 2077 6974 6820   the array with 
+00015fa0: 736f 6d65 206f 7665 726c 6170 0a0a 2020  some overlap..  
+00015fb0: 2020 2020 2020 5265 6665 7220 746f 203a        Refer to :
+00015fc0: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+00015fd0: 2e6d 6170 5f6f 7665 726c 6170 6020 666f  .map_overlap` fo
+00015fe0: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
+00015ff0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
+00016000: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00016010: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00016020: 2064 6173 6b2e 6172 7261 792e 6d61 705f   dask.array.map_
+00016030: 6f76 6572 6c61 7020 3a20 6571 7569 7661  overlap : equiva
+00016040: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
+00016050: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016060: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+00016070: 792e 6f76 6572 6c61 7020 696d 706f 7274  y.overlap import
+00016080: 206d 6170 5f6f 7665 726c 6170 0a0a 2020   map_overlap..  
+00016090: 2020 2020 2020 7265 7475 726e 206d 6170        return map
+000160a0: 5f6f 7665 726c 6170 280a 2020 2020 2020  _overlap(.      
+000160b0: 2020 2020 2020 6675 6e63 2c20 7365 6c66        func, self
+000160c0: 2c20 6465 7074 683d 6465 7074 682c 2062  , depth=depth, b
+000160d0: 6f75 6e64 6172 793d 626f 756e 6461 7279  oundary=boundary
+000160e0: 2c20 7472 696d 3d74 7269 6d2c 202a 2a6b  , trim=trim, **k
+000160f0: 7761 7267 730a 2020 2020 2020 2020 290a  wargs.        ).
+00016100: 0a20 2020 2064 6566 2063 756d 7375 6d28  .    def cumsum(
+00016110: 7365 6c66 2c20 6178 6973 2c20 6474 7970  self, axis, dtyp
+00016120: 653d 4e6f 6e65 2c20 6f75 743d 4e6f 6e65  e=None, out=None
+00016130: 2c20 2a2c 206d 6574 686f 643d 2273 6571  , *, method="seq
+00016140: 7565 6e74 6961 6c22 293a 0a20 2020 2020  uential"):.     
+00016150: 2020 2022 2222 5265 7475 726e 2074 6865     """Return the
+00016160: 2063 756d 756c 6174 6976 6520 7375 6d20   cumulative sum 
+00016170: 6f66 2074 6865 2065 6c65 6d65 6e74 7320  of the elements 
+00016180: 616c 6f6e 6720 7468 6520 6769 7665 6e20  along the given 
+00016190: 6178 6973 2e0a 0a20 2020 2020 2020 2052  axis...        R
+000161a0: 6566 6572 2074 6f20 3a66 756e 633a 6064  efer to :func:`d
+000161b0: 6173 6b2e 6172 7261 792e 6375 6d73 756d  ask.array.cumsum
+000161c0: 6020 666f 7220 6675 6c6c 2064 6f63 756d  ` for full docum
+000161d0: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
+000161e0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+000161f0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00016200: 2020 2020 2064 6173 6b2e 6172 7261 792e       dask.array.
+00016210: 6375 6d73 756d 203a 2065 7175 6976 616c  cumsum : equival
+00016220: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
+00016230: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00016240: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+00016250: 2e72 6564 7563 7469 6f6e 7320 696d 706f  .reductions impo
+00016260: 7274 2063 756d 7375 6d0a 0a20 2020 2020  rt cumsum..     
+00016270: 2020 2072 6574 7572 6e20 6375 6d73 756d     return cumsum
+00016280: 2873 656c 662c 2061 7869 732c 2064 7479  (self, axis, dty
+00016290: 7065 2c20 6f75 743d 6f75 742c 206d 6574  pe, out=out, met
+000162a0: 686f 643d 6d65 7468 6f64 290a 0a20 2020  hod=method)..   
+000162b0: 2064 6566 2063 756d 7072 6f64 2873 656c   def cumprod(sel
+000162c0: 662c 2061 7869 732c 2064 7479 7065 3d4e  f, axis, dtype=N
+000162d0: 6f6e 652c 206f 7574 3d4e 6f6e 652c 202a  one, out=None, *
+000162e0: 2c20 6d65 7468 6f64 3d22 7365 7175 656e  , method="sequen
+000162f0: 7469 616c 2229 3a0a 2020 2020 2020 2020  tial"):.        
+00016300: 2222 2252 6574 7572 6e20 7468 6520 6375  """Return the cu
+00016310: 6d75 6c61 7469 7665 2070 726f 6475 6374  mulative product
+00016320: 206f 6620 7468 6520 656c 656d 656e 7473   of the elements
+00016330: 2061 6c6f 6e67 2074 6865 2067 6976 656e   along the given
+00016340: 2061 7869 732e 0a0a 2020 2020 2020 2020   axis...        
+00016350: 5265 6665 7220 746f 203a 6675 6e63 3a60  Refer to :func:`
+00016360: 6461 736b 2e61 7272 6179 2e63 756d 7072  dask.array.cumpr
+00016370: 6f64 6020 666f 7220 6675 6c6c 2064 6f63  od` for full doc
+00016380: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
+00016390: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+000163a0: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+000163b0: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+000163c0: 792e 6375 6d70 726f 6420 3a20 6571 7569  y.cumprod : equi
+000163d0: 7661 6c65 6e74 2066 756e 6374 696f 6e0a  valent function.
+000163e0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+000163f0: 2020 2020 6672 6f6d 2064 6173 6b2e 6172      from dask.ar
+00016400: 7261 792e 7265 6475 6374 696f 6e73 2069  ray.reductions i
+00016410: 6d70 6f72 7420 6375 6d70 726f 640a 0a20  mport cumprod.. 
+00016420: 2020 2020 2020 2072 6574 7572 6e20 6375         return cu
+00016430: 6d70 726f 6428 7365 6c66 2c20 6178 6973  mprod(self, axis
+00016440: 2c20 6474 7970 652c 206f 7574 3d6f 7574  , dtype, out=out
+00016450: 2c20 6d65 7468 6f64 3d6d 6574 686f 6429  , method=method)
+00016460: 0a0a 2020 2020 6465 6620 7371 7565 657a  ..    def squeez
+00016470: 6528 7365 6c66 2c20 6178 6973 3d4e 6f6e  e(self, axis=Non
+00016480: 6529 3a0a 2020 2020 2020 2020 2222 2252  e):.        """R
+00016490: 656d 6f76 6520 6178 6573 206f 6620 6c65  emove axes of le
+000164a0: 6e67 7468 206f 6e65 2066 726f 6d20 6172  ngth one from ar
+000164b0: 7261 792e 0a0a 2020 2020 2020 2020 5265  ray...        Re
+000164c0: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
+000164d0: 736b 2e61 7272 6179 2e73 7175 6565 7a65  sk.array.squeeze
+000164e0: 6020 666f 7220 6675 6c6c 2064 6f63 756d  ` for full docum
+000164f0: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
+00016500: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00016510: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00016520: 2020 2020 2064 6173 6b2e 6172 7261 792e       dask.array.
+00016530: 7371 7565 657a 6520 3a20 6571 7569 7661  squeeze : equiva
+00016540: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
+00016550: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016560: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+00016570: 792e 726f 7574 696e 6573 2069 6d70 6f72  y.routines impor
+00016580: 7420 7371 7565 657a 650a 0a20 2020 2020  t squeeze..     
+00016590: 2020 2072 6574 7572 6e20 7371 7565 657a     return squeez
+000165a0: 6528 7365 6c66 2c20 6178 6973 290a 0a20  e(self, axis).. 
+000165b0: 2020 2064 6566 2072 6563 6875 6e6b 280a     def rechunk(.
+000165c0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000165d0: 2020 2020 2020 6368 756e 6b73 3d22 6175        chunks="au
+000165e0: 746f 222c 0a20 2020 2020 2020 2074 6872  to",.        thr
+000165f0: 6573 686f 6c64 3d4e 6f6e 652c 0a20 2020  eshold=None,.   
+00016600: 2020 2020 2062 6c6f 636b 5f73 697a 655f       block_size_
+00016610: 6c69 6d69 743d 4e6f 6e65 2c0a 2020 2020  limit=None,.    
+00016620: 2020 2020 6261 6c61 6e63 653d 4661 6c73      balance=Fals
+00016630: 652c 0a20 2020 2020 2020 206d 6574 686f  e,.        metho
+00016640: 643d 4e6f 6e65 2c0a 2020 2020 293a 0a20  d=None,.    ):. 
+00016650: 2020 2020 2020 2022 2222 436f 6e76 6572         """Conver
+00016660: 7420 626c 6f63 6b73 2069 6e20 6461 736b  t blocks in dask
+00016670: 2061 7272 6179 2078 2066 6f72 206e 6577   array x for new
+00016680: 2063 6875 6e6b 732e 0a0a 2020 2020 2020   chunks...      
+00016690: 2020 5265 6665 7220 746f 203a 6675 6e63    Refer to :func
+000166a0: 3a60 6461 736b 2e61 7272 6179 2e72 6563  :`dask.array.rec
+000166b0: 6875 6e6b 6020 666f 7220 6675 6c6c 2064  hunk` for full d
+000166c0: 6f63 756d 656e 7461 7469 6f6e 2e0a 0a20  ocumentation... 
+000166d0: 2020 2020 2020 2053 6565 2041 6c73 6f0a         See Also.
+000166e0: 2020 2020 2020 2020 2d2d 2d2d 2d2d 2d2d          --------
+000166f0: 0a20 2020 2020 2020 2064 6173 6b2e 6172  .        dask.ar
+00016700: 7261 792e 7265 6368 756e 6b20 3a20 6571  ray.rechunk : eq
+00016710: 7569 7661 6c65 6e74 2066 756e 6374 696f  uivalent functio
+00016720: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
+00016730: 2020 2020 2020 6672 6f6d 2064 6173 6b2e        from dask.
+00016740: 6172 7261 792e 7265 6368 756e 6b20 696d  array.rechunk im
+00016750: 706f 7274 2072 6563 6875 6e6b 2020 2320  port rechunk  # 
+00016760: 6176 6f69 6420 6369 7263 756c 6172 2069  avoid circular i
+00016770: 6d70 6f72 740a 0a20 2020 2020 2020 2072  mport..        r
+00016780: 6574 7572 6e20 7265 6368 756e 6b28 7365  eturn rechunk(se
+00016790: 6c66 2c20 6368 756e 6b73 2c20 7468 7265  lf, chunks, thre
+000167a0: 7368 6f6c 642c 2062 6c6f 636b 5f73 697a  shold, block_siz
+000167b0: 655f 6c69 6d69 742c 2062 616c 616e 6365  e_limit, balance
+000167c0: 2c20 6d65 7468 6f64 290a 0a20 2020 2040  , method)..    @
+000167d0: 7072 6f70 6572 7479 0a20 2020 2064 6566  property.    def
+000167e0: 2072 6561 6c28 7365 6c66 293a 0a20 2020   real(self):.   
+000167f0: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
+00016800: 7272 6179 2e75 6675 6e63 2069 6d70 6f72  rray.ufunc impor
+00016810: 7420 7265 616c 0a0a 2020 2020 2020 2020  t real..        
+00016820: 7265 7475 726e 2072 6561 6c28 7365 6c66  return real(self
+00016830: 290a 0a20 2020 2040 7072 6f70 6572 7479  )..    @property
+00016840: 0a20 2020 2064 6566 2069 6d61 6728 7365  .    def imag(se
+00016850: 6c66 293a 0a20 2020 2020 2020 2066 726f  lf):.        fro
+00016860: 6d20 6461 736b 2e61 7272 6179 2e75 6675  m dask.array.ufu
+00016870: 6e63 2069 6d70 6f72 7420 696d 6167 0a0a  nc import imag..
+00016880: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+00016890: 6d61 6728 7365 6c66 290a 0a20 2020 2064  mag(self)..    d
+000168a0: 6566 2063 6f6e 6a28 7365 6c66 293a 0a20  ef conj(self):. 
+000168b0: 2020 2020 2020 2022 2222 436f 6d70 6c65         """Comple
+000168c0: 782d 636f 6e6a 7567 6174 6520 616c 6c20  x-conjugate all 
+000168d0: 656c 656d 656e 7473 2e0a 0a20 2020 2020  elements...     
+000168e0: 2020 2052 6566 6572 2074 6f20 3a66 756e     Refer to :fun
+000168f0: 633a 6064 6173 6b2e 6172 7261 792e 636f  c:`dask.array.co
+00016900: 6e6a 6020 666f 7220 6675 6c6c 2064 6f63  nj` for full doc
+00016910: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
+00016920: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00016930: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00016940: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+00016950: 792e 636f 6e6a 203a 2065 7175 6976 616c  y.conj : equival
+00016960: 656e 7420 6675 6e63 7469 6f6e 0a20 2020  ent function.   
+00016970: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00016980: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
+00016990: 2e75 6675 6e63 2069 6d70 6f72 7420 636f  .ufunc import co
+000169a0: 6e6a 0a0a 2020 2020 2020 2020 7265 7475  nj..        retu
+000169b0: 726e 2063 6f6e 6a28 7365 6c66 290a 0a20  rn conj(self).. 
+000169c0: 2020 2064 6566 2063 6c69 7028 7365 6c66     def clip(self
+000169d0: 2c20 6d69 6e3d 4e6f 6e65 2c20 6d61 783d  , min=None, max=
+000169e0: 4e6f 6e65 293a 0a20 2020 2020 2020 2022  None):.        "
+000169f0: 2222 5265 7475 726e 2061 6e20 6172 7261  ""Return an arra
+00016a00: 7920 7768 6f73 6520 7661 6c75 6573 2061  y whose values a
+00016a10: 7265 206c 696d 6974 6564 2074 6f20 6060  re limited to ``
+00016a20: 5b6d 696e 2c20 6d61 785d 6060 2e0a 2020  [min, max]``..  
+00016a30: 2020 2020 2020 4f6e 6520 6f66 206d 6178        One of max
+00016a40: 206f 7220 6d69 6e20 6d75 7374 2062 6520   or min must be 
+00016a50: 6769 7665 6e2e 0a0a 2020 2020 2020 2020  given...        
+00016a60: 5265 6665 7220 746f 203a 6675 6e63 3a60  Refer to :func:`
+00016a70: 6461 736b 2e61 7272 6179 2e63 6c69 7060  dask.array.clip`
+00016a80: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
+00016a90: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
+00016aa0: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00016ab0: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+00016ac0: 2020 2020 6461 736b 2e61 7272 6179 2e63      dask.array.c
+00016ad0: 6c69 7020 3a20 6571 7569 7661 6c65 6e74  lip : equivalent
+00016ae0: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00016af0: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00016b00: 6f6d 2064 6173 6b2e 6172 7261 792e 7566  om dask.array.uf
+00016b10: 756e 6320 696d 706f 7274 2063 6c69 700a  unc import clip.
+00016b20: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00016b30: 636c 6970 2873 656c 662c 206d 696e 2c20  clip(self, min, 
+00016b40: 6d61 7829 0a0a 2020 2020 6465 6620 7669  max)..    def vi
+00016b50: 6577 2873 656c 662c 2064 7479 7065 3d4e  ew(self, dtype=N
+00016b60: 6f6e 652c 206f 7264 6572 3d22 4322 293a  one, order="C"):
+00016b70: 0a20 2020 2020 2020 2022 2222 4765 7420  .        """Get 
+00016b80: 6120 7669 6577 206f 6620 7468 6520 6172  a view of the ar
+00016b90: 7261 7920 6173 2061 206e 6577 2064 6174  ray as a new dat
+00016ba0: 6120 7479 7065 0a0a 2020 2020 2020 2020  a type..        
+00016bb0: 5061 7261 6d65 7465 7273 0a20 2020 2020  Parameters.     
+00016bc0: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
+00016bd0: 2020 2020 2020 6474 7970 653a 0a20 2020        dtype:.   
+00016be0: 2020 2020 2020 2020 2054 6865 2064 7479           The dty
+00016bf0: 7065 2062 7920 7768 6963 6820 746f 2076  pe by which to v
+00016c00: 6965 7720 7468 6520 6172 7261 792e 0a20  iew the array.. 
+00016c10: 2020 2020 2020 2020 2020 2054 6865 2064             The d
+00016c20: 6566 6175 6c74 2c20 4e6f 6e65 2c20 7265  efault, None, re
+00016c30: 7375 6c74 7320 696e 2074 6865 2076 6965  sults in the vie
+00016c40: 7720 6861 7669 6e67 2074 6865 2073 616d  w having the sam
+00016c50: 6520 6461 7461 2d74 7970 650a 2020 2020  e data-type.    
+00016c60: 2020 2020 2020 2020 6173 2074 6865 206f          as the o
+00016c70: 7269 6769 6e61 6c20 6172 7261 792e 0a20  riginal array.. 
+00016c80: 2020 2020 2020 206f 7264 6572 3a20 7374         order: st
+00016c90: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
+00016ca0: 2027 4327 206f 7220 2746 2720 2846 6f72   'C' or 'F' (For
+00016cb0: 7472 616e 2920 6f72 6465 7269 6e67 0a0a  tran) ordering..
+00016cc0: 2020 2020 2020 2020 5468 6973 2072 6569          This rei
+00016cd0: 6e74 6572 7072 6574 7320 7468 6520 6279  nterprets the by
+00016ce0: 7465 7320 6f66 2074 6865 2061 7272 6179  tes of the array
+00016cf0: 2075 6e64 6572 2061 206e 6577 2064 7479   under a new dty
+00016d00: 7065 2e20 2049 6620 7468 6174 0a20 2020  pe.  If that.   
+00016d10: 2020 2020 2064 7479 7065 2064 6f65 7320       dtype does 
+00016d20: 6e6f 7420 6861 7665 2074 6865 2073 616d  not have the sam
+00016d30: 6520 7369 7a65 2061 7320 7468 6520 6f72  e size as the or
+00016d40: 6967 696e 616c 2061 7272 6179 2074 6865  iginal array the
+00016d50: 6e20 7468 6520 7368 6170 650a 2020 2020  n the shape.    
+00016d60: 2020 2020 7769 6c6c 2063 6861 6e67 652e      will change.
+00016d70: 0a0a 2020 2020 2020 2020 4265 7761 7265  ..        Beware
+00016d80: 2074 6861 7420 626f 7468 206e 756d 7079   that both numpy
+00016d90: 2061 6e64 2064 6173 6b2e 6172 7261 7920   and dask.array 
+00016da0: 6361 6e20 6265 6861 7665 206f 6464 6c79  can behave oddly
+00016db0: 2077 6865 6e20 7461 6b69 6e67 0a20 2020   when taking.   
+00016dc0: 2020 2020 2073 6861 7065 2d63 6861 6e67       shape-chang
+00016dd0: 696e 6720 7669 6577 7320 6f66 2061 7272  ing views of arr
+00016de0: 6179 7320 756e 6465 7220 466f 7274 7261  ays under Fortra
+00016df0: 6e20 6f72 6465 7269 6e67 2e20 2055 6e64  n ordering.  Und
+00016e00: 6572 2073 6f6d 650a 2020 2020 2020 2020  er some.        
+00016e10: 7665 7273 696f 6e73 206f 6620 4e75 6d50  versions of NumP
+00016e20: 7920 7468 6973 2066 756e 6374 696f 6e20  y this function 
+00016e30: 7769 6c6c 2066 6169 6c20 7768 656e 2074  will fail when t
+00016e40: 616b 696e 6720 7368 6170 652d 6368 616e  aking shape-chan
+00016e50: 6769 6e67 0a20 2020 2020 2020 2076 6965  ging.        vie
+00016e60: 7773 206f 6620 466f 7274 7261 6e20 6f72  ws of Fortran or
+00016e70: 6465 7265 6420 6172 7261 7973 2069 6620  dered arrays if 
+00016e80: 7468 6520 6669 7273 7420 6469 6d65 6e73  the first dimens
+00016e90: 696f 6e20 6861 7320 6368 756e 6b73 206f  ion has chunks o
+00016ea0: 660a 2020 2020 2020 2020 7369 7a65 206f  f.        size o
+00016eb0: 6e65 2e0a 2020 2020 2020 2020 2222 220a  ne..        """.
+00016ec0: 2020 2020 2020 2020 6966 2064 7479 7065          if dtype
+00016ed0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00016ee0: 2020 2020 2020 6474 7970 6520 3d20 7365        dtype = se
+00016ef0: 6c66 2e64 7479 7065 0a20 2020 2020 2020  lf.dtype.       
+00016f00: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00016f10: 2020 2064 7479 7065 203d 206e 702e 6474     dtype = np.dt
+00016f20: 7970 6528 6474 7970 6529 0a20 2020 2020  ype(dtype).     
+00016f30: 2020 206d 756c 7420 3d20 7365 6c66 2e64     mult = self.d
+00016f40: 7479 7065 2e69 7465 6d73 697a 6520 2f20  type.itemsize / 
+00016f50: 6474 7970 652e 6974 656d 7369 7a65 0a0a  dtype.itemsize..
+00016f60: 2020 2020 2020 2020 6966 206f 7264 6572          if order
+00016f70: 203d 3d20 2243 223a 0a20 2020 2020 2020   == "C":.       
+00016f80: 2020 2020 2063 6875 6e6b 7320 3d20 7365       chunks = se
+00016f90: 6c66 2e63 6875 6e6b 735b 3a2d 315d 202b  lf.chunks[:-1] +
+00016fa0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00016fb0: 2020 2074 7570 6c65 2865 6e73 7572 655f     tuple(ensure_
+00016fc0: 696e 7428 6320 2a20 6d75 6c74 2920 666f  int(c * mult) fo
+00016fd0: 7220 6320 696e 2073 656c 662e 6368 756e  r c in self.chun
+00016fe0: 6b73 5b2d 315d 292c 0a20 2020 2020 2020  ks[-1]),.       
+00016ff0: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+00017000: 6c69 6620 6f72 6465 7220 3d3d 2022 4622  lif order == "F"
+00017010: 3a0a 2020 2020 2020 2020 2020 2020 6368  :.            ch
+00017020: 756e 6b73 203d 2028 0a20 2020 2020 2020  unks = (.       
+00017030: 2020 2020 2020 2020 2074 7570 6c65 2865           tuple(e
+00017040: 6e73 7572 655f 696e 7428 6320 2a20 6d75  nsure_int(c * mu
+00017050: 6c74 2920 666f 7220 6320 696e 2073 656c  lt) for c in sel
+00017060: 662e 6368 756e 6b73 5b30 5d29 2c0a 2020  f.chunks[0]),.  
+00017070: 2020 2020 2020 2020 2020 2920 2b20 7365            ) + se
+00017080: 6c66 2e63 6875 6e6b 735b 313a 5d0a 2020  lf.chunks[1:].  
+00017090: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000170a0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+000170b0: 6c75 6545 7272 6f72 2822 4f72 6465 7220  lueError("Order 
+000170c0: 6d75 7374 2062 6520 6f6e 6520 6f66 2027  must be one of '
+000170d0: 4327 206f 7220 2746 2722 290a 0a20 2020  C' or 'F'")..   
+000170e0: 2020 2020 2072 6574 7572 6e20 7365 6c66       return self
+000170f0: 2e6d 6170 5f62 6c6f 636b 7328 0a20 2020  .map_blocks(.   
+00017100: 2020 2020 2020 2020 2063 6875 6e6b 2e76           chunk.v
+00017110: 6965 772c 2064 7479 7065 2c20 6f72 6465  iew, dtype, orde
+00017120: 723d 6f72 6465 722c 2064 7479 7065 3d64  r=order, dtype=d
+00017130: 7479 7065 2c20 6368 756e 6b73 3d63 6875  type, chunks=chu
+00017140: 6e6b 730a 2020 2020 2020 2020 290a 0a20  nks.        ).. 
+00017150: 2020 2064 6566 2073 7761 7061 7865 7328     def swapaxes(
+00017160: 7365 6c66 2c20 6178 6973 312c 2061 7869  self, axis1, axi
+00017170: 7332 293a 0a20 2020 2020 2020 2022 2222  s2):.        """
+00017180: 5265 7475 726e 2061 2076 6965 7720 6f66  Return a view of
+00017190: 2074 6865 2061 7272 6179 2077 6974 6820   the array with 
+000171a0: 6060 6178 6973 3160 6020 616e 6420 6060  ``axis1`` and ``
+000171b0: 6178 6973 3260 6020 696e 7465 7263 6861  axis2`` intercha
+000171c0: 6e67 6564 2e0a 0a20 2020 2020 2020 2052  nged...        R
+000171d0: 6566 6572 2074 6f20 3a66 756e 633a 6064  efer to :func:`d
+000171e0: 6173 6b2e 6172 7261 792e 7377 6170 6178  ask.array.swapax
+000171f0: 6573 6020 666f 7220 6675 6c6c 2064 6f63  es` for full doc
+00017200: 756d 656e 7461 7469 6f6e 2e0a 0a20 2020  umentation...   
+00017210: 2020 2020 2053 6565 2041 6c73 6f0a 2020       See Also.  
+00017220: 2020 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20        --------. 
+00017230: 2020 2020 2020 2064 6173 6b2e 6172 7261         dask.arra
+00017240: 792e 7377 6170 6178 6573 203a 2065 7175  y.swapaxes : equ
+00017250: 6976 616c 656e 7420 6675 6e63 7469 6f6e  ivalent function
+00017260: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00017270: 2020 2020 2066 726f 6d20 6461 736b 2e61       from dask.a
+00017280: 7272 6179 2e72 6f75 7469 6e65 7320 696d  rray.routines im
+00017290: 706f 7274 2073 7761 7061 7865 730a 0a20  port swapaxes.. 
+000172a0: 2020 2020 2020 2072 6574 7572 6e20 7377         return sw
+000172b0: 6170 6178 6573 2873 656c 662c 2061 7869  apaxes(self, axi
+000172c0: 7331 2c20 6178 6973 3229 0a0a 2020 2020  s1, axis2)..    
+000172d0: 6465 6620 726f 756e 6428 7365 6c66 2c20  def round(self, 
+000172e0: 6465 6369 6d61 6c73 3d30 293a 0a20 2020  decimals=0):.   
+000172f0: 2020 2020 2022 2222 5265 7475 726e 2061       """Return a
+00017300: 7272 6179 2077 6974 6820 6561 6368 2065  rray with each e
+00017310: 6c65 6d65 6e74 2072 6f75 6e64 6564 2074  lement rounded t
+00017320: 6f20 7468 6520 6769 7665 6e20 6e75 6d62  o the given numb
+00017330: 6572 206f 6620 6465 6369 6d61 6c73 2e0a  er of decimals..
+00017340: 0a20 2020 2020 2020 2052 6566 6572 2074  .        Refer t
+00017350: 6f20 3a66 756e 633a 6064 6173 6b2e 6172  o :func:`dask.ar
+00017360: 7261 792e 726f 756e 6460 2066 6f72 2066  ray.round` for f
+00017370: 756c 6c20 646f 6375 6d65 6e74 6174 696f  ull documentatio
+00017380: 6e2e 0a0a 2020 2020 2020 2020 5365 6520  n...        See 
+00017390: 416c 736f 0a20 2020 2020 2020 202d 2d2d  Also.        ---
+000173a0: 2d2d 2d2d 2d0a 2020 2020 2020 2020 6461  -----.        da
+000173b0: 736b 2e61 7272 6179 2e72 6f75 6e64 203a  sk.array.round :
+000173c0: 2065 7175 6976 616c 656e 7420 6675 6e63   equivalent func
+000173d0: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
+000173e0: 0a20 2020 2020 2020 2066 726f 6d20 6461  .        from da
+000173f0: 736b 2e61 7272 6179 2e72 6f75 7469 6e65  sk.array.routine
+00017400: 7320 696d 706f 7274 2072 6f75 6e64 0a0a  s import round..
+00017410: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00017420: 6f75 6e64 2873 656c 662c 2064 6563 696d  ound(self, decim
+00017430: 616c 733d 6465 6369 6d61 6c73 290a 0a20  als=decimals).. 
+00017440: 2020 2064 6566 2063 6f70 7928 7365 6c66     def copy(self
+00017450: 293a 0a20 2020 2020 2020 2022 2222 0a20  ):.        """. 
+00017460: 2020 2020 2020 2043 6f70 7920 6172 7261         Copy arra
+00017470: 792e 2020 5468 6973 2069 7320 6120 6e6f  y.  This is a no
+00017480: 2d6f 7020 666f 7220 6461 736b 2e61 7272  -op for dask.arr
+00017490: 6179 732c 2077 6869 6368 2061 7265 2069  ays, which are i
+000174a0: 6d6d 7574 6162 6c65 0a20 2020 2020 2020  mmutable.       
+000174b0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
+000174c0: 7572 6e20 4172 7261 7928 7365 6c66 2e64  urn Array(self.d
+000174d0: 6173 6b2c 2073 656c 662e 6e61 6d65 2c20  ask, self.name, 
+000174e0: 7365 6c66 2e63 6875 6e6b 732c 206d 6574  self.chunks, met
+000174f0: 613d 7365 6c66 290a 0a20 2020 2064 6566  a=self)..    def
+00017500: 205f 5f64 6565 7063 6f70 795f 5f28 7365   __deepcopy__(se
+00017510: 6c66 2c20 6d65 6d6f 293a 0a20 2020 2020  lf, memo):.     
+00017520: 2020 2063 203d 2073 656c 662e 636f 7079     c = self.copy
+00017530: 2829 0a20 2020 2020 2020 206d 656d 6f5b  ().        memo[
+00017540: 6964 2873 656c 6629 5d20 3d20 630a 2020  id(self)] = c.  
+00017550: 2020 2020 2020 7265 7475 726e 2063 0a0a        return c..
+00017560: 2020 2020 6465 6620 746f 5f64 656c 6179      def to_delay
+00017570: 6564 2873 656c 662c 206f 7074 696d 697a  ed(self, optimiz
+00017580: 655f 6772 6170 683d 5472 7565 293a 0a20  e_graph=True):. 
+00017590: 2020 2020 2020 2022 2222 436f 6e76 6572         """Conver
+000175a0: 7420 696e 746f 2061 6e20 6172 7261 7920  t into an array 
+000175b0: 6f66 203a 636c 6173 733a 6064 6173 6b2e  of :class:`dask.
+000175c0: 6465 6c61 7965 642e 4465 6c61 7965 6460  delayed.Delayed`
+000175d0: 206f 626a 6563 7473 2c20 6f6e 6520 7065   objects, one pe
+000175e0: 7220 6368 756e 6b2e 0a0a 2020 2020 2020  r chunk...      
+000175f0: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00017600: 2020 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a       ----------.
+00017610: 2020 2020 2020 2020 6f70 7469 6d69 7a65          optimize
+00017620: 5f67 7261 7068 203a 2062 6f6f 6c2c 206f  _graph : bool, o
+00017630: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
+00017640: 2020 2020 4966 2054 7275 6520 5b64 6566      If True [def
+00017650: 6175 6c74 5d2c 2074 6865 2067 7261 7068  ault], the graph
+00017660: 2069 7320 6f70 7469 6d69 7a65 6420 6265   is optimized be
+00017670: 666f 7265 2063 6f6e 7665 7274 696e 6720  fore converting 
+00017680: 696e 746f 0a20 2020 2020 2020 2020 2020  into.           
+00017690: 203a 636c 6173 733a 6064 6173 6b2e 6465   :class:`dask.de
+000176a0: 6c61 7965 642e 4465 6c61 7965 6460 206f  layed.Delayed` o
+000176b0: 626a 6563 7473 2e0a 0a20 2020 2020 2020  bjects...       
+000176c0: 2053 6565 2041 6c73 6f0a 2020 2020 2020   See Also.      
+000176d0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+000176e0: 2020 2064 6173 6b2e 6172 7261 792e 6672     dask.array.fr
+000176f0: 6f6d 5f64 656c 6179 6564 0a20 2020 2020  om_delayed.     
+00017700: 2020 2022 2222 0a20 2020 2020 2020 206b     """.        k
+00017710: 6579 7320 3d20 7365 6c66 2e5f 5f64 6173  eys = self.__das
+00017720: 6b5f 6b65 7973 5f5f 2829 0a20 2020 2020  k_keys__().     
+00017730: 2020 2067 7261 7068 203d 2073 656c 662e     graph = self.
+00017740: 5f5f 6461 736b 5f67 7261 7068 5f5f 2829  __dask_graph__()
+00017750: 0a20 2020 2020 2020 206c 6179 6572 203d  .        layer =
+00017760: 2073 656c 662e 5f5f 6461 736b 5f6c 6179   self.__dask_lay
+00017770: 6572 735f 5f28 295b 305d 0a20 2020 2020  ers__()[0].     
+00017780: 2020 2069 6620 6f70 7469 6d69 7a65 5f67     if optimize_g
+00017790: 7261 7068 3a0a 2020 2020 2020 2020 2020  raph:.          
+000177a0: 2020 6772 6170 6820 3d20 7365 6c66 2e5f    graph = self._
+000177b0: 5f64 6173 6b5f 6f70 7469 6d69 7a65 5f5f  _dask_optimize__
+000177c0: 2867 7261 7068 2c20 6b65 7973 2920 2023  (graph, keys)  #
+000177d0: 2054 4f44 4f2c 2064 6f6e 2774 2063 6f6c   TODO, don't col
+000177e0: 6c61 7065 2067 7261 7068 0a20 2020 2020  lape graph.     
+000177f0: 2020 2020 2020 206c 6179 6572 203d 2022         layer = "
+00017800: 6465 6c61 7965 642d 2220 2b20 7365 6c66  delayed-" + self
+00017810: 2e6e 616d 650a 2020 2020 2020 2020 2020  .name.          
+00017820: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
+00017830: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
+00017840: 6c6c 6563 7469 6f6e 7328 6c61 7965 722c  llections(layer,
+00017850: 2067 7261 7068 2c20 6465 7065 6e64 656e   graph, dependen
+00017860: 6369 6573 3d28 2929 0a20 2020 2020 2020  cies=()).       
+00017870: 204c 203d 206e 6465 6570 6d61 7028 7365   L = ndeepmap(se
+00017880: 6c66 2e6e 6469 6d2c 206c 616d 6264 6120  lf.ndim, lambda 
+00017890: 6b3a 2044 656c 6179 6564 286b 2c20 6772  k: Delayed(k, gr
+000178a0: 6170 682c 206c 6179 6572 3d6c 6179 6572  aph, layer=layer
+000178b0: 292c 206b 6579 7329 0a20 2020 2020 2020  ), keys).       
+000178c0: 2072 6574 7572 6e20 6e70 2e61 7272 6179   return np.array
+000178d0: 284c 2c20 6474 7970 653d 6f62 6a65 6374  (L, dtype=object
+000178e0: 290a 0a20 2020 2064 6566 2072 6570 6561  )..    def repea
+000178f0: 7428 7365 6c66 2c20 7265 7065 6174 732c  t(self, repeats,
+00017900: 2061 7869 733d 4e6f 6e65 293a 0a20 2020   axis=None):.   
+00017910: 2020 2020 2022 2222 5265 7065 6174 2065       """Repeat e
+00017920: 6c65 6d65 6e74 7320 6f66 2061 6e20 6172  lements of an ar
+00017930: 7261 792e 0a0a 2020 2020 2020 2020 5265  ray...        Re
+00017940: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
+00017950: 736b 2e61 7272 6179 2e72 6570 6561 7460  sk.array.repeat`
+00017960: 2066 6f72 2066 756c 6c20 646f 6375 6d65   for full docume
+00017970: 6e74 6174 696f 6e2e 0a0a 2020 2020 2020  ntation...      
+00017980: 2020 5365 6520 416c 736f 0a20 2020 2020    See Also.     
+00017990: 2020 202d 2d2d 2d2d 2d2d 2d0a 2020 2020     --------.    
+000179a0: 2020 2020 6461 736b 2e61 7272 6179 2e72      dask.array.r
+000179b0: 6570 6561 7420 3a20 6571 7569 7661 6c65  epeat : equivale
+000179c0: 6e74 2066 756e 6374 696f 6e0a 2020 2020  nt function.    
+000179d0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000179e0: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
+000179f0: 6372 6561 7469 6f6e 2069 6d70 6f72 7420  creation import 
+00017a00: 7265 7065 6174 0a0a 2020 2020 2020 2020  repeat..        
+00017a10: 7265 7475 726e 2072 6570 6561 7428 7365  return repeat(se
+00017a20: 6c66 2c20 7265 7065 6174 732c 2061 7869  lf, repeats, axi
+00017a30: 733d 6178 6973 290a 0a20 2020 2064 6566  s=axis)..    def
+00017a40: 206e 6f6e 7a65 726f 2873 656c 6629 3a0a   nonzero(self):.
+00017a50: 2020 2020 2020 2020 2222 2252 6574 7572          """Retur
+00017a60: 6e20 7468 6520 696e 6469 6365 7320 6f66  n the indices of
+00017a70: 2074 6865 2065 6c65 6d65 6e74 7320 7468   the elements th
+00017a80: 6174 2061 7265 206e 6f6e 2d7a 6572 6f2e  at are non-zero.
+00017a90: 0a0a 2020 2020 2020 2020 5265 6665 7220  ..        Refer 
+00017aa0: 746f 203a 6675 6e63 3a60 6461 736b 2e61  to :func:`dask.a
+00017ab0: 7272 6179 2e6e 6f6e 7a65 726f 6020 666f  rray.nonzero` fo
+00017ac0: 7220 6675 6c6c 2064 6f63 756d 656e 7461  r full documenta
+00017ad0: 7469 6f6e 2e0a 0a20 2020 2020 2020 2053  tion...        S
+00017ae0: 6565 2041 6c73 6f0a 2020 2020 2020 2020  ee Also.        
+00017af0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020 2020  --------.       
+00017b00: 2064 6173 6b2e 6172 7261 792e 6e6f 6e7a   dask.array.nonz
+00017b10: 6572 6f20 3a20 6571 7569 7661 6c65 6e74  ero : equivalent
+00017b20: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+00017b30: 2020 2222 220a 2020 2020 2020 2020 6672    """.        fr
+00017b40: 6f6d 2064 6173 6b2e 6172 7261 792e 726f  om dask.array.ro
+00017b50: 7574 696e 6573 2069 6d70 6f72 7420 6e6f  utines import no
+00017b60: 6e7a 6572 6f0a 0a20 2020 2020 2020 2072  nzero..        r
+00017b70: 6574 7572 6e20 6e6f 6e7a 6572 6f28 7365  eturn nonzero(se
+00017b80: 6c66 290a 0a20 2020 2064 6566 2074 6f5f  lf)..    def to_
+00017b90: 7a61 7272 2873 656c 662c 202a 6172 6773  zarr(self, *args
+00017ba0: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
+00017bb0: 2020 2020 2022 2222 5361 7665 2061 7272       """Save arr
+00017bc0: 6179 2074 6f20 7468 6520 7a61 7272 2073  ay to the zarr s
+00017bd0: 746f 7261 6765 2066 6f72 6d61 740a 0a20  torage format.. 
+00017be0: 2020 2020 2020 2053 6565 2068 7474 7073         See https
+00017bf0: 3a2f 2f7a 6172 722e 7265 6164 7468 6564  ://zarr.readthed
+00017c00: 6f63 732e 696f 2066 6f72 2064 6574 6169  ocs.io for detai
+00017c10: 6c73 2061 626f 7574 2074 6865 2066 6f72  ls about the for
+00017c20: 6d61 742e 0a0a 2020 2020 2020 2020 5265  mat...        Re
+00017c30: 6665 7220 746f 203a 6675 6e63 3a60 6461  fer to :func:`da
+00017c40: 736b 2e61 7272 6179 2e74 6f5f 7a61 7272  sk.array.to_zarr
+00017c50: 6020 666f 7220 6675 6c6c 2064 6f63 756d  ` for full docum
+00017c60: 656e 7461 7469 6f6e 2e0a 0a20 2020 2020  entation...     
+00017c70: 2020 2053 6565 2061 6c73 6f0a 2020 2020     See also.    
+00017c80: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+00017c90: 2020 2020 2064 6173 6b2e 6172 7261 792e       dask.array.
+00017ca0: 746f 5f7a 6172 7220 3a20 6571 7569 7661  to_zarr : equiva
+00017cb0: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
+00017cc0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00017cd0: 2020 7265 7475 726e 2074 6f5f 7a61 7272    return to_zarr
+00017ce0: 2873 656c 662c 202a 6172 6773 2c20 2a2a  (self, *args, **
+00017cf0: 6b77 6172 6773 290a 0a20 2020 2064 6566  kwargs)..    def
+00017d00: 2074 6f5f 7469 6c65 6462 2873 656c 662c   to_tiledb(self,
+00017d10: 2075 7269 2c20 2a61 7267 732c 202a 2a6b   uri, *args, **k
+00017d20: 7761 7267 7329 3a0a 2020 2020 2020 2020  wargs):.        
+00017d30: 2222 2253 6176 6520 6172 7261 7920 746f  """Save array to
+00017d40: 2074 6865 2054 696c 6544 4220 7374 6f72   the TileDB stor
+00017d50: 6167 6520 6d61 6e61 6765 720a 0a20 2020  age manager..   
+00017d60: 2020 2020 2053 6565 2068 7474 7073 3a2f       See https:/
+00017d70: 2f64 6f63 732e 7469 6c65 6462 2e69 6f20  /docs.tiledb.io 
+00017d80: 666f 7220 6465 7461 696c 7320 6162 6f75  for details abou
+00017d90: 7420 7468 6520 666f 726d 6174 2061 6e64  t the format and
+00017da0: 2065 6e67 696e 652e 0a0a 2020 2020 2020   engine...      
+00017db0: 2020 5365 6520 6675 6e63 7469 6f6e 203a    See function :
+00017dc0: 6675 6e63 3a60 6461 736b 2e61 7272 6179  func:`dask.array
+00017dd0: 2e74 6f5f 7469 6c65 6462 6020 666f 7220  .to_tiledb` for 
+00017de0: 6172 6775 6d65 6e74 2064 6f63 756d 656e  argument documen
+00017df0: 7461 7469 6f6e 2e0a 0a20 2020 2020 2020  tation...       
+00017e00: 2053 6565 2061 6c73 6f0a 2020 2020 2020   See also.      
+00017e10: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2020    --------.     
+00017e20: 2020 2064 6173 6b2e 6172 7261 792e 746f     dask.array.to
+00017e30: 5f74 696c 6564 6220 3a20 6571 7569 7661  _tiledb : equiva
+00017e40: 6c65 6e74 2066 756e 6374 696f 6e0a 2020  lent function.  
+00017e50: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00017e60: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+00017e70: 792e 7469 6c65 6462 5f69 6f20 696d 706f  y.tiledb_io impo
+00017e80: 7274 2074 6f5f 7469 6c65 6462 0a0a 2020  rt to_tiledb..  
+00017e90: 2020 2020 2020 7265 7475 726e 2074 6f5f        return to_
+00017ea0: 7469 6c65 6462 2873 656c 662c 2075 7269  tiledb(self, uri
+00017eb0: 2c20 2a61 7267 732c 202a 2a6b 7761 7267  , *args, **kwarg
+00017ec0: 7329 0a0a 0a64 6566 2065 6e73 7572 655f  s)...def ensure_
+00017ed0: 696e 7428 6629 3a0a 2020 2020 6920 3d20  int(f):.    i = 
+00017ee0: 696e 7428 6629 0a20 2020 2069 6620 6920  int(f).    if i 
+00017ef0: 213d 2066 3a0a 2020 2020 2020 2020 7261  != f:.        ra
+00017f00: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+00017f10: 436f 756c 6420 6e6f 7420 636f 6572 6365  Could not coerce
+00017f20: 2025 6620 746f 2069 6e74 6567 6572 2220   %f to integer" 
+00017f30: 2520 6629 0a20 2020 2072 6574 7572 6e20  % f).    return 
+00017f40: 690a 0a0a 6465 6620 6e6f 726d 616c 697a  i...def normaliz
+00017f50: 655f 6368 756e 6b73 2863 6875 6e6b 732c  e_chunks(chunks,
+00017f60: 2073 6861 7065 3d4e 6f6e 652c 206c 696d   shape=None, lim
+00017f70: 6974 3d4e 6f6e 652c 2064 7479 7065 3d4e  it=None, dtype=N
+00017f80: 6f6e 652c 2070 7265 7669 6f75 735f 6368  one, previous_ch
+00017f90: 756e 6b73 3d4e 6f6e 6529 3a0a 2020 2020  unks=None):.    
+00017fa0: 2222 224e 6f72 6d61 6c69 7a65 2063 6875  """Normalize chu
+00017fb0: 6e6b 7320 746f 2074 7570 6c65 206f 6620  nks to tuple of 
+00017fc0: 7475 706c 6573 0a0a 2020 2020 5468 6973  tuples..    This
+00017fd0: 2074 616b 6573 2069 6e20 6120 7661 7269   takes in a vari
+00017fe0: 6574 7920 6f66 2069 6e70 7574 2074 7970  ety of input typ
+00017ff0: 6573 2061 6e64 2069 6e66 6f72 6d61 7469  es and informati
+00018000: 6f6e 2061 6e64 2070 726f 6475 6365 7320  on and produces 
+00018010: 6120 6675 6c6c 0a20 2020 2074 7570 6c65  a full.    tuple
+00018020: 2d6f 662d 7475 706c 6573 2072 6573 756c  -of-tuples resul
+00018030: 7420 666f 7220 6368 756e 6b73 2c20 7375  t for chunks, su
+00018040: 6974 6162 6c65 2074 6f20 6265 2070 6173  itable to be pas
+00018050: 7365 6420 746f 2041 7272 6179 206f 720a  sed to Array or.
+00018060: 2020 2020 7265 6368 756e 6b20 6f72 2061      rechunk or a
+00018070: 6e79 206f 7468 6572 206f 7065 7261 7469  ny other operati
+00018080: 6f6e 2074 6861 7420 6372 6561 7465 7320  on that creates 
+00018090: 6120 4461 736b 2061 7272 6179 2e0a 0a20  a Dask array... 
+000180a0: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+000180b0: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+000180c0: 2063 6875 6e6b 733a 2074 7570 6c65 2c20   chunks: tuple, 
+000180d0: 696e 742c 2064 6963 742c 206f 7220 7374  int, dict, or st
+000180e0: 7269 6e67 0a20 2020 2020 2020 2054 6865  ring.        The
+000180f0: 2063 6875 6e6b 7320 746f 2062 6520 6e6f   chunks to be no
+00018100: 726d 616c 697a 6564 2e20 2053 6565 2065  rmalized.  See e
+00018110: 7861 6d70 6c65 7320 6265 6c6f 7720 666f  xamples below fo
+00018120: 7220 6d6f 7265 2064 6574 6169 6c73 0a20  r more details. 
+00018130: 2020 2073 6861 7065 3a20 5475 706c 655b     shape: Tuple[
+00018140: 696e 745d 0a20 2020 2020 2020 2054 6865  int].        The
+00018150: 2073 6861 7065 206f 6620 7468 6520 6172   shape of the ar
+00018160: 7261 790a 2020 2020 6c69 6d69 743a 2069  ray.    limit: i
+00018170: 6e74 2028 6f70 7469 6f6e 616c 290a 2020  nt (optional).  
+00018180: 2020 2020 2020 5468 6520 6d61 7869 6d75        The maximu
+00018190: 6d20 626c 6f63 6b20 7369 7a65 2074 6f20  m block size to 
+000181a0: 7461 7267 6574 2069 6e20 6279 7465 732c  target in bytes,
+000181b0: 0a20 2020 2020 2020 2069 6620 6672 6565  .        if free
+000181c0: 646f 6d20 6973 2067 6976 656e 2074 6f20  dom is given to 
+000181d0: 6368 6f6f 7365 0a20 2020 2064 7479 7065  choose.    dtype
+000181e0: 3a20 6e70 2e64 7479 7065 0a20 2020 2070  : np.dtype.    p
+000181f0: 7265 7669 6f75 735f 6368 756e 6b73 3a20  revious_chunks: 
+00018200: 5475 706c 655b 5475 706c 655b 696e 745d  Tuple[Tuple[int]
+00018210: 5d20 6f70 7469 6f6e 616c 0a20 2020 2020  ] optional.     
+00018220: 2020 2043 6875 6e6b 7320 6672 6f6d 2061     Chunks from a
+00018230: 2070 7265 7669 6f75 7320 6172 7261 7920   previous array 
+00018240: 7468 6174 2077 6520 7368 6f75 6c64 2075  that we should u
+00018250: 7365 2066 6f72 2069 6e73 7069 7261 7469  se for inspirati
+00018260: 6f6e 2077 6865 6e0a 2020 2020 2020 2020  on when.        
+00018270: 7265 6368 756e 6b69 6e67 2061 7574 6f20  rechunking auto 
+00018280: 6469 6d65 6e73 696f 6e73 2e20 2049 6620  dimensions.  If 
+00018290: 6e6f 7420 7072 6f76 6964 6564 2062 7574  not provided but
+000182a0: 2061 7574 6f2d 6368 756e 6b69 6e67 2065   auto-chunking e
+000182b0: 7869 7374 730a 2020 2020 2020 2020 7468  xists.        th
+000182c0: 656e 2061 7574 6f2d 6469 6d65 6e73 696f  en auto-dimensio
+000182d0: 6e73 2077 696c 6c20 7072 6566 6572 2073  ns will prefer s
+000182e0: 7175 6172 652d 6c69 6b65 2063 6875 6e6b  quare-like chunk
+000182f0: 2073 6861 7065 732e 0a0a 2020 2020 4578   shapes...    Ex
+00018300: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
+00018310: 2d2d 2d0a 2020 2020 5370 6563 6966 7920  ---.    Specify 
+00018320: 756e 6966 6f72 6d20 6368 756e 6b20 7369  uniform chunk si
+00018330: 7a65 730a 0a20 2020 203e 3e3e 2066 726f  zes..    >>> fro
+00018340: 6d20 6461 736b 2e61 7272 6179 2e63 6f72  m dask.array.cor
+00018350: 6520 696d 706f 7274 206e 6f72 6d61 6c69  e import normali
+00018360: 7a65 5f63 6875 6e6b 730a 2020 2020 3e3e  ze_chunks.    >>
+00018370: 3e20 6e6f 726d 616c 697a 655f 6368 756e  > normalize_chun
+00018380: 6b73 2828 322c 2032 292c 2073 6861 7065  ks((2, 2), shape
+00018390: 3d28 352c 2036 2929 0a20 2020 2028 2832  =(5, 6)).    ((2
+000183a0: 2c20 322c 2031 292c 2028 322c 2032 2c20  , 2, 1), (2, 2, 
+000183b0: 3229 290a 0a20 2020 2041 6c73 6f20 7061  2))..    Also pa
+000183c0: 7373 6573 2074 6872 6f75 6768 2066 756c  sses through ful
+000183d0: 6c79 2065 7870 6c69 6369 7420 7475 706c  ly explicit tupl
+000183e0: 652d 6f66 2d74 7570 6c65 730a 0a20 2020  e-of-tuples..   
+000183f0: 203e 3e3e 206e 6f72 6d61 6c69 7a65 5f63   >>> normalize_c
+00018400: 6875 6e6b 7328 2828 322c 2032 2c20 3129  hunks(((2, 2, 1)
+00018410: 2c20 2832 2c20 322c 2032 2929 2c20 7368  , (2, 2, 2)), sh
+00018420: 6170 653d 2835 2c20 3629 290a 2020 2020  ape=(5, 6)).    
+00018430: 2828 322c 2032 2c20 3129 2c20 2832 2c20  ((2, 2, 1), (2, 
+00018440: 322c 2032 2929 0a0a 2020 2020 436c 6561  2, 2))..    Clea
+00018450: 6e73 2075 7020 6c69 7374 7320 746f 2074  ns up lists to t
+00018460: 7570 6c65 730a 0a20 2020 203e 3e3e 206e  uples..    >>> n
+00018470: 6f72 6d61 6c69 7a65 5f63 6875 6e6b 7328  ormalize_chunks(
+00018480: 5b5b 322c 2032 5d2c 205b 332c 2033 5d5d  [[2, 2], [3, 3]]
+00018490: 290a 2020 2020 2828 322c 2032 292c 2028  ).    ((2, 2), (
+000184a0: 332c 2033 2929 0a0a 2020 2020 4578 7061  3, 3))..    Expa
+000184b0: 6e64 7320 696e 7465 6765 7220 696e 7075  nds integer inpu
+000184c0: 7473 2031 3020 2d3e 2028 3130 2c20 3130  ts 10 -> (10, 10
+000184d0: 290a 0a20 2020 203e 3e3e 206e 6f72 6d61  )..    >>> norma
+000184e0: 6c69 7a65 5f63 6875 6e6b 7328 3130 2c20  lize_chunks(10, 
+000184f0: 7368 6170 653d 2833 302c 2035 2929 0a20  shape=(30, 5)). 
+00018500: 2020 2028 2831 302c 2031 302c 2031 3029     ((10, 10, 10)
+00018510: 2c20 2835 2c29 290a 0a20 2020 2045 7870  , (5,))..    Exp
+00018520: 616e 6473 2064 6963 7420 696e 7075 7473  ands dict inputs
+00018530: 0a0a 2020 2020 3e3e 3e20 6e6f 726d 616c  ..    >>> normal
+00018540: 697a 655f 6368 756e 6b73 287b 303a 2032  ize_chunks({0: 2
+00018550: 2c20 313a 2033 7d2c 2073 6861 7065 3d28  , 1: 3}, shape=(
+00018560: 362c 2036 2929 0a20 2020 2028 2832 2c20  6, 6)).    ((2, 
+00018570: 322c 2032 292c 2028 332c 2033 2929 0a0a  2, 2), (3, 3))..
+00018580: 2020 2020 5468 6520 7661 6c75 6573 202d      The values -
+00018590: 3120 616e 6420 4e6f 6e65 2067 6574 206d  1 and None get m
+000185a0: 6170 7065 6420 746f 2066 756c 6c20 7369  apped to full si
+000185b0: 7a65 0a0a 2020 2020 3e3e 3e20 6e6f 726d  ze..    >>> norm
+000185c0: 616c 697a 655f 6368 756e 6b73 2828 352c  alize_chunks((5,
+000185d0: 202d 3129 2c20 7368 6170 653d 2831 302c   -1), shape=(10,
+000185e0: 2031 3029 290a 2020 2020 2828 352c 2035   10)).    ((5, 5
+000185f0: 292c 2028 3130 2c29 290a 0a20 2020 2055  ), (10,))..    U
+00018600: 7365 2074 6865 2076 616c 7565 2022 6175  se the value "au
+00018610: 746f 2220 746f 2061 7574 6f6d 6174 6963  to" to automatic
+00018620: 616c 6c79 2064 6574 6572 6d69 6e65 2063  ally determine c
+00018630: 6875 6e6b 2073 697a 6573 2061 6c6f 6e67  hunk sizes along
+00018640: 2063 6572 7461 696e 0a20 2020 2064 696d   certain.    dim
+00018650: 656e 7369 6f6e 732e 2020 5468 6973 2075  ensions.  This u
+00018660: 7365 7320 7468 6520 6060 6c69 6d69 743d  ses the ``limit=
+00018670: 6060 2061 6e64 2060 6064 7479 7065 3d60  `` and ``dtype=`
+00018680: 6020 6b65 7977 6f72 6473 2074 6f0a 2020  ` keywords to.  
+00018690: 2020 6465 7465 726d 696e 6520 686f 7720    determine how 
+000186a0: 6c61 7267 6520 746f 206d 616b 6520 7468  large to make th
+000186b0: 6520 6368 756e 6b73 2e20 2054 6865 2074  e chunks.  The t
+000186c0: 6572 6d20 2261 7574 6f22 2063 616e 2062  erm "auto" can b
+000186d0: 6520 7573 6564 0a20 2020 2061 6e79 7768  e used.    anywh
+000186e0: 6572 6520 616e 2069 6e74 6567 6572 2063  ere an integer c
+000186f0: 616e 2062 6520 7573 6564 2e20 2053 6565  an be used.  See
+00018700: 2061 7272 6179 2063 6875 6e6b 696e 6720   array chunking 
+00018710: 646f 6375 6d65 6e74 6174 696f 6e20 666f  documentation fo
+00018720: 7220 6d6f 7265 0a20 2020 2069 6e66 6f72  r more.    infor
+00018730: 6d61 7469 6f6e 2e0a 0a20 2020 203e 3e3e  mation...    >>>
+00018740: 206e 6f72 6d61 6c69 7a65 5f63 6875 6e6b   normalize_chunk
+00018750: 7328 2822 6175 746f 222c 292c 2073 6861  s(("auto",), sha
+00018760: 7065 3d28 3230 2c29 2c20 6c69 6d69 743d  pe=(20,), limit=
+00018770: 352c 2064 7479 7065 3d27 7569 6e74 3827  5, dtype='uint8'
+00018780: 290a 2020 2020 2828 352c 2035 2c20 352c  ).    ((5, 5, 5,
+00018790: 2035 292c 290a 0a20 2020 2059 6f75 2063   5),)..    You c
+000187a0: 616e 2061 6c73 6f20 7573 6520 6279 7465  an also use byte
+000187b0: 2073 697a 6573 2028 7365 6520 3a66 756e   sizes (see :fun
+000187c0: 633a 6064 6173 6b2e 7574 696c 732e 7061  c:`dask.utils.pa
+000187d0: 7273 655f 6279 7465 7360 2920 696e 2070  rse_bytes`) in p
+000187e0: 6c61 6365 206f 660a 2020 2020 2261 7574  lace of.    "aut
+000187f0: 6f22 2074 6f20 6173 6b20 666f 7220 6120  o" to ask for a 
+00018800: 7061 7274 6963 756c 6172 2073 697a 650a  particular size.
+00018810: 0a20 2020 203e 3e3e 206e 6f72 6d61 6c69  .    >>> normali
+00018820: 7a65 5f63 6875 6e6b 7328 2231 6b69 4222  ze_chunks("1kiB"
+00018830: 2c20 7368 6170 653d 2832 3030 302c 292c  , shape=(2000,),
+00018840: 2064 7479 7065 3d27 666c 6f61 7433 3227   dtype='float32'
+00018850: 290a 2020 2020 2828 3235 362c 2032 3536  ).    ((256, 256
+00018860: 2c20 3235 362c 2032 3536 2c20 3235 362c  , 256, 256, 256,
+00018870: 2032 3536 2c20 3235 362c 2032 3038 292c   256, 256, 208),
+00018880: 290a 0a20 2020 2052 6573 7065 6374 7320  )..    Respects 
+00018890: 6e75 6c6c 2064 696d 656e 7369 6f6e 730a  null dimensions.
+000188a0: 0a20 2020 203e 3e3e 206e 6f72 6d61 6c69  .    >>> normali
+000188b0: 7a65 5f63 6875 6e6b 7328 2829 2c20 7368  ze_chunks((), sh
+000188c0: 6170 653d 2830 2c20 3029 290a 2020 2020  ape=(0, 0)).    
+000188d0: 2828 302c 292c 2028 302c 2929 0a20 2020  ((0,), (0,)).   
+000188e0: 2022 2222 0a20 2020 2069 6620 6474 7970   """.    if dtyp
+000188f0: 6520 616e 6420 6e6f 7420 6973 696e 7374  e and not isinst
+00018900: 616e 6365 2864 7479 7065 2c20 6e70 2e64  ance(dtype, np.d
+00018910: 7479 7065 293a 0a20 2020 2020 2020 2064  type):.        d
+00018920: 7479 7065 203d 206e 702e 6474 7970 6528  type = np.dtype(
+00018930: 6474 7970 6529 0a20 2020 2069 6620 6368  dtype).    if ch
+00018940: 756e 6b73 2069 7320 4e6f 6e65 3a0a 2020  unks is None:.  
+00018950: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00018960: 6545 7272 6f72 2843 4855 4e4b 535f 4e4f  eError(CHUNKS_NO
+00018970: 4e45 5f45 5252 4f52 5f4d 4553 5341 4745  NE_ERROR_MESSAGE
+00018980: 290a 2020 2020 6966 2069 7369 6e73 7461  ).    if isinsta
+00018990: 6e63 6528 6368 756e 6b73 2c20 6c69 7374  nce(chunks, list
+000189a0: 293a 0a20 2020 2020 2020 2063 6875 6e6b  ):.        chunk
+000189b0: 7320 3d20 7475 706c 6528 6368 756e 6b73  s = tuple(chunks
+000189c0: 290a 2020 2020 6966 2069 7369 6e73 7461  ).    if isinsta
+000189d0: 6e63 6528 6368 756e 6b73 2c20 284e 756d  nce(chunks, (Num
+000189e0: 6265 722c 2073 7472 2929 3a0a 2020 2020  ber, str)):.    
+000189f0: 2020 2020 6368 756e 6b73 203d 2028 6368      chunks = (ch
+00018a00: 756e 6b73 2c29 202a 206c 656e 2873 6861  unks,) * len(sha
+00018a10: 7065 290a 2020 2020 6966 2069 7369 6e73  pe).    if isins
+00018a20: 7461 6e63 6528 6368 756e 6b73 2c20 6469  tance(chunks, di
+00018a30: 6374 293a 0a20 2020 2020 2020 2063 6875  ct):.        chu
+00018a40: 6e6b 7320 3d20 7475 706c 6528 6368 756e  nks = tuple(chun
+00018a50: 6b73 2e67 6574 2869 2c20 4e6f 6e65 2920  ks.get(i, None) 
+00018a60: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+00018a70: 656e 2873 6861 7065 2929 290a 2020 2020  en(shape))).    
+00018a80: 6966 2069 7369 6e73 7461 6e63 6528 6368  if isinstance(ch
+00018a90: 756e 6b73 2c20 6e70 2e6e 6461 7272 6179  unks, np.ndarray
+00018aa0: 293a 0a20 2020 2020 2020 2063 6875 6e6b  ):.        chunk
+00018ab0: 7320 3d20 6368 756e 6b73 2e74 6f6c 6973  s = chunks.tolis
+00018ac0: 7428 290a 2020 2020 6966 206e 6f74 2063  t().    if not c
+00018ad0: 6875 6e6b 7320 616e 6420 7368 6170 6520  hunks and shape 
+00018ae0: 616e 6420 616c 6c28 7320 3d3d 2030 2066  and all(s == 0 f
+00018af0: 6f72 2073 2069 6e20 7368 6170 6529 3a0a  or s in shape):.
+00018b00: 2020 2020 2020 2020 6368 756e 6b73 203d          chunks =
+00018b10: 2028 2830 2c29 2c29 202a 206c 656e 2873   ((0,),) * len(s
+00018b20: 6861 7065 290a 0a20 2020 2069 6620 280a  hape)..    if (.
+00018b30: 2020 2020 2020 2020 7368 6170 650a 2020          shape.  
+00018b40: 2020 2020 2020 616e 6420 6c65 6e28 7368        and len(sh
+00018b50: 6170 6529 203d 3d20 310a 2020 2020 2020  ape) == 1.      
+00018b60: 2020 616e 6420 6c65 6e28 6368 756e 6b73    and len(chunks
+00018b70: 2920 3e20 310a 2020 2020 2020 2020 616e  ) > 1.        an
+00018b80: 6420 616c 6c28 6973 696e 7374 616e 6365  d all(isinstance
+00018b90: 2863 2c20 284e 756d 6265 722c 2073 7472  (c, (Number, str
+00018ba0: 2929 2066 6f72 2063 2069 6e20 6368 756e  )) for c in chun
+00018bb0: 6b73 290a 2020 2020 293a 0a20 2020 2020  ks).    ):.     
+00018bc0: 2020 2063 6875 6e6b 7320 3d20 2863 6875     chunks = (chu
+00018bd0: 6e6b 732c 290a 0a20 2020 2069 6620 7368  nks,)..    if sh
+00018be0: 6170 6520 616e 6420 6c65 6e28 6368 756e  ape and len(chun
+00018bf0: 6b73 2920 213d 206c 656e 2873 6861 7065  ks) != len(shape
+00018c00: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
+00018c10: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+00018c20: 2020 2020 2020 2020 2022 4368 756e 6b73           "Chunks
+00018c30: 2061 6e64 2073 6861 7065 206d 7573 7420   and shape must 
+00018c40: 6265 206f 6620 7468 6520 7361 6d65 206c  be of the same l
+00018c50: 656e 6774 682f 6469 6d65 6e73 696f 6e2e  ength/dimension.
+00018c60: 2022 0a20 2020 2020 2020 2020 2020 2022   ".            "
+00018c70: 476f 7420 6368 756e 6b73 3d25 732c 2073  Got chunks=%s, s
+00018c80: 6861 7065 3d25 7322 2025 2028 6368 756e  hape=%s" % (chun
+00018c90: 6b73 2c20 7368 6170 6529 0a20 2020 2020  ks, shape).     
+00018ca0: 2020 2029 0a20 2020 2069 6620 2d31 2069     ).    if -1 i
+00018cb0: 6e20 6368 756e 6b73 206f 7220 4e6f 6e65  n chunks or None
+00018cc0: 2069 6e20 6368 756e 6b73 3a0a 2020 2020   in chunks:.    
+00018cd0: 2020 2020 6368 756e 6b73 203d 2074 7570      chunks = tup
+00018ce0: 6c65 2873 2069 6620 6320 3d3d 202d 3120  le(s if c == -1 
+00018cf0: 6f72 2063 2069 7320 4e6f 6e65 2065 6c73  or c is None els
+00018d00: 6520 6320 666f 7220 632c 2073 2069 6e20  e c for c, s in 
+00018d10: 7a69 7028 6368 756e 6b73 2c20 7368 6170  zip(chunks, shap
+00018d20: 6529 290a 0a20 2020 2023 2049 6620 7370  e))..    # If sp
+00018d30: 6563 6966 7969 6e67 2063 6875 6e6b 2073  ecifying chunk s
+00018d40: 697a 6520 696e 2062 7974 6573 2c20 7573  ize in bytes, us
+00018d50: 6520 7468 6174 2076 616c 7565 2074 6f20  e that value to 
+00018d60: 7365 7420 7468 6520 6c69 6d69 742e 0a20  set the limit.. 
+00018d70: 2020 2023 2056 6572 6966 7920 7468 6572     # Verify ther
+00018d80: 6520 6973 206f 6e6c 7920 6f6e 6520 636f  e is only one co
+00018d90: 6e73 6973 7465 6e74 2076 616c 7565 206f  nsistent value o
+00018da0: 6620 6c69 6d69 7420 6f72 2063 6875 6e6b  f limit or chunk
+00018db0: 2d62 7974 6573 2075 7365 642e 0a20 2020  -bytes used..   
+00018dc0: 2066 6f72 2063 2069 6e20 6368 756e 6b73   for c in chunks
+00018dd0: 3a0a 2020 2020 2020 2020 6966 2069 7369  :.        if isi
+00018de0: 6e73 7461 6e63 6528 632c 2073 7472 2920  nstance(c, str) 
+00018df0: 616e 6420 6320 213d 2022 6175 746f 223a  and c != "auto":
+00018e00: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
+00018e10: 7365 6420 3d20 7061 7273 655f 6279 7465  sed = parse_byte
+00018e20: 7328 6329 0a20 2020 2020 2020 2020 2020  s(c).           
+00018e30: 2069 6620 6c69 6d69 7420 6973 204e 6f6e   if limit is Non
+00018e40: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00018e50: 2020 206c 696d 6974 203d 2070 6172 7365     limit = parse
+00018e60: 640a 2020 2020 2020 2020 2020 2020 656c  d.            el
+00018e70: 6966 2070 6172 7365 6420 213d 206c 696d  if parsed != lim
+00018e80: 6974 3a0a 2020 2020 2020 2020 2020 2020  it:.            
+00018e90: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00018ea0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00018eb0: 2020 2020 2020 2020 2020 224f 6e6c 7920            "Only 
+00018ec0: 6f6e 6520 636f 6e73 6973 7465 6e74 2076  one consistent v
+00018ed0: 616c 7565 206f 6620 6c69 6d69 7420 6f72  alue of limit or
+00018ee0: 2063 6875 6e6b 2069 7320 616c 6c6f 7765   chunk is allowe
+00018ef0: 642e 220a 2020 2020 2020 2020 2020 2020  d.".            
+00018f00: 2020 2020 2020 2020 2255 7365 6420 2573          "Used %s
+00018f10: 2021 3d20 2573 2220 2520 2870 6172 7365   != %s" % (parse
+00018f20: 642c 206c 696d 6974 290a 2020 2020 2020  d, limit).      
+00018f30: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00018f40: 2320 5375 6273 7469 7475 7465 2062 7974  # Substitute byt
+00018f50: 6520 6c69 6d69 7473 2077 6974 6820 2761  e limits with 'a
+00018f60: 7574 6f27 206e 6f77 2074 6861 7420 6c69  uto' now that li
+00018f70: 6d69 7420 6973 2073 6574 2e0a 2020 2020  mit is set..    
+00018f80: 6368 756e 6b73 203d 2074 7570 6c65 2822  chunks = tuple("
+00018f90: 6175 746f 2220 6966 2069 7369 6e73 7461  auto" if isinsta
+00018fa0: 6e63 6528 632c 2073 7472 2920 616e 6420  nce(c, str) and 
+00018fb0: 6320 213d 2022 6175 746f 2220 656c 7365  c != "auto" else
+00018fc0: 2063 2066 6f72 2063 2069 6e20 6368 756e   c for c in chun
+00018fd0: 6b73 290a 0a20 2020 2069 6620 616e 7928  ks)..    if any(
+00018fe0: 6320 3d3d 2022 6175 746f 2220 666f 7220  c == "auto" for 
+00018ff0: 6320 696e 2063 6875 6e6b 7329 3a0a 2020  c in chunks):.  
+00019000: 2020 2020 2020 6368 756e 6b73 203d 2061        chunks = a
+00019010: 7574 6f5f 6368 756e 6b73 2863 6875 6e6b  uto_chunks(chunk
+00019020: 732c 2073 6861 7065 2c20 6c69 6d69 742c  s, shape, limit,
+00019030: 2064 7479 7065 2c20 7072 6576 696f 7573   dtype, previous
+00019040: 5f63 6875 6e6b 7329 0a0a 2020 2020 6966  _chunks)..    if
+00019050: 2073 6861 7065 2069 7320 6e6f 7420 4e6f   shape is not No
+00019060: 6e65 3a0a 2020 2020 2020 2020 6368 756e  ne:.        chun
+00019070: 6b73 203d 2074 7570 6c65 2863 2069 6620  ks = tuple(c if 
+00019080: 6320 6e6f 7420 696e 207b 4e6f 6e65 2c20  c not in {None, 
+00019090: 2d31 7d20 656c 7365 2073 2066 6f72 2063  -1} else s for c
+000190a0: 2c20 7320 696e 207a 6970 2863 6875 6e6b  , s in zip(chunk
+000190b0: 732c 2073 6861 7065 2929 0a0a 2020 2020  s, shape))..    
+000190c0: 616c 6c69 6e74 7320 3d20 4e6f 6e65 0a20  allints = None. 
+000190d0: 2020 2069 6620 6368 756e 6b73 2061 6e64     if chunks and
+000190e0: 2073 6861 7065 2069 7320 6e6f 7420 4e6f   shape is not No
+000190f0: 6e65 3a0a 2020 2020 2020 2020 2320 616c  ne:.        # al
+00019100: 6c69 6e74 733a 2064 6964 2077 6520 7374  lints: did we st
+00019110: 6172 7420 7769 7468 2063 6875 6e6b 7320  art with chunks 
+00019120: 6173 2061 2073 696d 706c 6520 7475 706c  as a simple tupl
+00019130: 6520 6f66 2069 6e74 733f 0a20 2020 2020  e of ints?.     
+00019140: 2020 2061 6c6c 696e 7473 203d 2061 6c6c     allints = all
+00019150: 2869 7369 6e73 7461 6e63 6528 632c 2069  (isinstance(c, i
+00019160: 6e74 2920 666f 7220 6320 696e 2063 6875  nt) for c in chu
+00019170: 6e6b 7329 0a20 2020 2020 2020 2063 6875  nks).        chu
+00019180: 6e6b 7320 3d20 7375 6d28 0a20 2020 2020  nks = sum(.     
+00019190: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+000191a0: 2020 2020 2020 2020 2062 6c6f 636b 6469           blockdi
+000191b0: 6d73 5f66 726f 6d5f 626c 6f63 6b73 6861  ms_from_blocksha
+000191c0: 7065 2828 732c 292c 2028 632c 2929 0a20  pe((s,), (c,)). 
+000191d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000191e0: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
+000191f0: 2863 2c20 2874 7570 6c65 2c20 6c69 7374  (c, (tuple, list
+00019200: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+00019210: 2020 2065 6c73 6520 2863 2c29 0a20 2020     else (c,).   
+00019220: 2020 2020 2020 2020 2020 2020 2066 6f72               for
+00019230: 2073 2c20 6320 696e 207a 6970 2873 6861   s, c in zip(sha
+00019240: 7065 2c20 6368 756e 6b73 290a 2020 2020  pe, chunks).    
+00019250: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
+00019260: 2020 2020 2020 2028 292c 0a20 2020 2020         (),.     
+00019270: 2020 2029 0a20 2020 2066 6f72 2063 2069     ).    for c i
+00019280: 6e20 6368 756e 6b73 3a0a 2020 2020 2020  n chunks:.      
+00019290: 2020 6966 206e 6f74 2063 3a0a 2020 2020    if not c:.    
+000192a0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+000192b0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+000192c0: 2020 2020 2020 2020 2020 2245 6d70 7479            "Empty
+000192d0: 2074 7570 6c65 7320 6172 6520 6e6f 7420   tuples are not 
+000192e0: 616c 6c6f 7765 6420 696e 2063 6875 6e6b  allowed in chunk
+000192f0: 732e 2045 7870 7265 7373 2022 0a20 2020  s. Express ".   
+00019300: 2020 2020 2020 2020 2020 2020 2022 7a65               "ze
+00019310: 726f 206c 656e 6774 6820 6469 6d65 6e73  ro length dimens
+00019320: 696f 6e73 2077 6974 6820 3028 7329 2069  ions with 0(s) i
+00019330: 6e20 6368 756e 6b73 220a 2020 2020 2020  n chunks".      
+00019340: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
+00019350: 7368 6170 6520 6973 206e 6f74 204e 6f6e  shape is not Non
+00019360: 653a 0a20 2020 2020 2020 2069 6620 6c65  e:.        if le
+00019370: 6e28 6368 756e 6b73 2920 213d 206c 656e  n(chunks) != len
+00019380: 2873 6861 7065 293a 0a20 2020 2020 2020  (shape):.       
+00019390: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000193a0: 4572 726f 7228 0a20 2020 2020 2020 2020  Error(.         
+000193b0: 2020 2020 2020 2022 496e 7075 7420 6172         "Input ar
+000193c0: 7261 7920 6861 7320 2564 2064 696d 656e  ray has %d dimen
+000193d0: 7369 6f6e 7320 6275 7420 7468 6520 7375  sions but the su
+000193e0: 7070 6c69 6564 2022 0a20 2020 2020 2020  pplied ".       
+000193f0: 2020 2020 2020 2020 2022 6368 756e 6b73           "chunks
+00019400: 2068 6173 206f 6e6c 7920 2564 2064 696d   has only %d dim
+00019410: 656e 7369 6f6e 7322 2025 2028 6c65 6e28  ensions" % (len(
+00019420: 7368 6170 6529 2c20 6c65 6e28 6368 756e  shape), len(chun
+00019430: 6b73 2929 0a20 2020 2020 2020 2020 2020  ks)).           
+00019440: 2029 0a20 2020 2020 2020 2069 6620 6e6f   ).        if no
+00019450: 7420 616c 6c28 0a20 2020 2020 2020 2020  t all(.         
+00019460: 2020 2063 203d 3d20 7320 6f72 2028 6d61     c == s or (ma
+00019470: 7468 2e69 736e 616e 2863 2920 6f72 206d  th.isnan(c) or m
+00019480: 6174 682e 6973 6e61 6e28 7329 290a 2020  ath.isnan(s)).  
+00019490: 2020 2020 2020 2020 2020 666f 7220 632c            for c,
+000194a0: 2073 2069 6e20 7a69 7028 6d61 7028 7375   s in zip(map(su
+000194b0: 6d2c 2063 6875 6e6b 7329 2c20 7368 6170  m, chunks), shap
+000194c0: 6529 0a20 2020 2020 2020 2029 3a0a 2020  e).        ):.  
+000194d0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+000194e0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
+000194f0: 2020 2020 2020 2020 2020 2020 2243 6875              "Chu
+00019500: 6e6b 7320 646f 206e 6f74 2061 6464 2075  nks do not add u
+00019510: 7020 746f 2073 6861 7065 2e20 220a 2020  p to shape. ".  
+00019520: 2020 2020 2020 2020 2020 2020 2020 2247                "G
+00019530: 6f74 2063 6875 6e6b 733d 2573 2c20 7368  ot chunks=%s, sh
+00019540: 6170 653d 2573 2220 2520 2863 6875 6e6b  ape=%s" % (chunk
+00019550: 732c 2073 6861 7065 290a 2020 2020 2020  s, shape).      
+00019560: 2020 2020 2020 290a 2020 2020 6966 2061        ).    if a
+00019570: 6c6c 696e 7473 206f 7220 6973 696e 7374  llints or isinst
+00019580: 616e 6365 2873 756d 2873 756d 285f 2920  ance(sum(sum(_) 
+00019590: 666f 7220 5f20 696e 2063 6875 6e6b 7329  for _ in chunks)
+000195a0: 2c20 696e 7429 3a0a 2020 2020 2020 2020  , int):.        
+000195b0: 2320 4661 7374 7061 7468 2066 6f72 2077  # Fastpath for w
+000195c0: 6865 6e20 7765 2061 6c72 6561 6479 206b  hen we already k
+000195d0: 6e6f 7720 6368 756e 6b73 2063 6f6e 7461  now chunks conta
+000195e0: 696e 7320 6f6e 6c79 2069 6e74 6567 6572  ins only integer
+000195f0: 730a 2020 2020 2020 2020 7265 7475 726e  s.        return
+00019600: 2074 7570 6c65 2874 7570 6c65 2863 6829   tuple(tuple(ch)
+00019610: 2066 6f72 2063 6820 696e 2063 6875 6e6b   for ch in chunk
+00019620: 7329 0a20 2020 2072 6574 7572 6e20 7475  s).    return tu
+00019630: 706c 6528 0a20 2020 2020 2020 2074 7570  ple(.        tup
+00019640: 6c65 2869 6e74 2878 2920 6966 206e 6f74  le(int(x) if not
+00019650: 206d 6174 682e 6973 6e61 6e28 7829 2065   math.isnan(x) e
+00019660: 6c73 6520 6e70 2e6e 616e 2066 6f72 2078  lse np.nan for x
+00019670: 2069 6e20 6329 2066 6f72 2063 2069 6e20   in c) for c in 
+00019680: 6368 756e 6b73 0a20 2020 2029 0a0a 0a64  chunks.    )...d
+00019690: 6566 205f 636f 6d70 7574 655f 6d75 6c74  ef _compute_mult
+000196a0: 6970 6c69 6572 286c 696d 6974 3a20 696e  iplier(limit: in
+000196b0: 742c 2064 7479 7065 2c20 6c61 7267 6573  t, dtype, larges
+000196c0: 745f 626c 6f63 6b3a 2069 6e74 2c20 7265  t_block: int, re
+000196d0: 7375 6c74 293a 0a20 2020 2022 2222 0a20  sult):.    """. 
+000196e0: 2020 2055 7469 6c69 7479 2066 756e 6374     Utility funct
+000196f0: 696f 6e20 666f 7220 6175 746f 5f63 6875  ion for auto_chu
+00019700: 6e6b 2c20 746f 2066 696e 2068 6f77 206d  nk, to fin how m
+00019710: 7563 6820 6c61 7267 6572 206f 7220 736d  uch larger or sm
+00019720: 616c 6c65 7220 7468 6520 6964 6561 6c0a  aller the ideal.
+00019730: 2020 2020 6368 756e 6b20 7369 7a65 2069      chunk size i
+00019740: 7320 7265 6c61 7469 7665 2074 6f20 7768  s relative to wh
+00019750: 6174 2077 6520 6861 7665 206e 6f77 2e0a  at we have now..
+00019760: 2020 2020 2222 220a 2020 2020 7265 7475      """.    retu
+00019770: 726e 2028 0a20 2020 2020 2020 206c 696d  rn (.        lim
+00019780: 6974 0a20 2020 2020 2020 202f 2064 7479  it.        / dty
+00019790: 7065 2e69 7465 6d73 697a 650a 2020 2020  pe.itemsize.    
+000197a0: 2020 2020 2f20 6c61 7267 6573 745f 626c      / largest_bl
+000197b0: 6f63 6b0a 2020 2020 2020 2020 2f20 6d61  ock.        / ma
+000197c0: 7468 2e70 726f 6428 7220 666f 7220 7220  th.prod(r for r 
+000197d0: 696e 2072 6573 756c 742e 7661 6c75 6573  in result.values
+000197e0: 2829 2069 6620 7229 0a20 2020 2029 0a0a  () if r).    )..
+000197f0: 0a64 6566 2061 7574 6f5f 6368 756e 6b73  .def auto_chunks
+00019800: 2863 6875 6e6b 732c 2073 6861 7065 2c20  (chunks, shape, 
+00019810: 6c69 6d69 742c 2064 7479 7065 2c20 7072  limit, dtype, pr
+00019820: 6576 696f 7573 5f63 6875 6e6b 733d 4e6f  evious_chunks=No
+00019830: 6e65 293a 0a20 2020 2022 2222 4465 7465  ne):.    """Dete
+00019840: 726d 696e 6520 6175 746f 6d61 7469 6320  rmine automatic 
+00019850: 6368 756e 6b73 0a0a 2020 2020 5468 6973  chunks..    This
+00019860: 2074 616b 6573 2069 6e20 6120 6368 756e   takes in a chun
+00019870: 6b73 2076 616c 7565 2074 6861 7420 636f  ks value that co
+00019880: 6e74 6169 6e73 2060 6022 6175 746f 2260  ntains ``"auto"`
+00019890: 6020 7661 6c75 6573 2069 6e20 6365 7274  ` values in cert
+000198a0: 6169 6e0a 2020 2020 6469 6d65 6e73 696f  ain.    dimensio
+000198b0: 6e73 2061 6e64 2072 6570 6c61 6365 7320  ns and replaces 
+000198c0: 7468 6f73 6520 7661 6c75 6573 2077 6974  those values wit
+000198d0: 6820 636f 6e63 7265 7465 2064 696d 656e  h concrete dimen
+000198e0: 7369 6f6e 2073 697a 6573 2074 6861 7420  sion sizes that 
+000198f0: 7472 790a 2020 2020 746f 2067 6574 2063  try.    to get c
+00019900: 6875 6e6b 7320 746f 2062 6520 6f66 2061  hunks to be of a
+00019910: 2063 6572 7461 696e 2073 697a 6520 696e   certain size in
+00019920: 2062 7974 6573 2c20 7072 6f76 6964 6564   bytes, provided
+00019930: 2062 7920 7468 6520 6060 6c69 6d69 743d   by the ``limit=
+00019940: 6060 0a20 2020 206b 6579 776f 7264 2e20  ``.    keyword. 
+00019950: 2049 6620 6d75 6c74 6970 6c65 2064 696d   If multiple dim
+00019960: 656e 7369 6f6e 7320 6172 6520 6d61 726b  ensions are mark
+00019970: 6564 2061 7320 6060 2261 7574 6f22 6060  ed as ``"auto"``
+00019980: 2074 6865 6e20 7468 6579 2077 696c 6c0a   then they will.
+00019990: 2020 2020 616c 6c20 7265 7370 6f6e 6420      all respond 
+000199a0: 746f 206d 6565 7420 7468 6520 6465 7369  to meet the desi
+000199b0: 7265 6420 6279 7465 206c 696d 6974 2c20  red byte limit, 
+000199c0: 7472 7969 6e67 2074 6f20 7265 7370 6563  trying to respec
+000199d0: 7420 7468 6520 6173 7065 6374 0a20 2020  t the aspect.   
+000199e0: 2072 6174 696f 206f 6620 7468 6569 7220   ratio of their 
+000199f0: 6469 6d65 6e73 696f 6e73 2069 6e20 6060  dimensions in ``
+00019a00: 7072 6576 696f 7573 5f63 6875 6e6b 733d  previous_chunks=
+00019a10: 6060 2c20 6966 2067 6976 656e 2e0a 0a20  ``, if given... 
+00019a20: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+00019a30: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+00019a40: 2063 6875 6e6b 733a 2054 7570 6c65 0a20   chunks: Tuple. 
+00019a50: 2020 2020 2020 2041 2074 7570 6c65 206f         A tuple o
+00019a60: 6620 6569 7468 6572 2064 696d 656e 7369  f either dimensi
+00019a70: 6f6e 7320 6f72 2074 7570 6c65 7320 6f66  ons or tuples of
+00019a80: 2065 7870 6c69 6369 7420 6368 756e 6b20   explicit chunk 
+00019a90: 6469 6d65 6e73 696f 6e73 0a20 2020 2020  dimensions.     
+00019aa0: 2020 2053 6f6d 6520 656e 7472 6965 7320     Some entries 
+00019ab0: 7368 6f75 6c64 2062 6520 2261 7574 6f22  should be "auto"
+00019ac0: 0a20 2020 2073 6861 7065 3a20 5475 706c  .    shape: Tupl
+00019ad0: 655b 696e 745d 0a20 2020 206c 696d 6974  e[int].    limit
+00019ae0: 3a20 696e 742c 2073 7472 0a20 2020 2020  : int, str.     
+00019af0: 2020 2054 6865 206d 6178 696d 756d 2061     The maximum a
+00019b00: 6c6c 6f77 6162 6c65 2073 697a 6520 6f66  llowable size of
+00019b10: 2061 2063 6875 6e6b 2069 6e20 6279 7465   a chunk in byte
+00019b20: 730a 2020 2020 7072 6576 696f 7573 5f63  s.    previous_c
+00019b30: 6875 6e6b 733a 2054 7570 6c65 5b54 7570  hunks: Tuple[Tup
+00019b40: 6c65 5b69 6e74 5d5d 0a0a 2020 2020 5365  le[int]]..    Se
+00019b50: 6520 616c 736f 0a20 2020 202d 2d2d 2d2d  e also.    -----
+00019b60: 2d2d 2d0a 2020 2020 6e6f 726d 616c 697a  ---.    normaliz
+00019b70: 655f 6368 756e 6b73 3a20 666f 7220 6675  e_chunks: for fu
+00019b80: 6c6c 2064 6f63 7374 7269 6e67 2061 6e64  ll docstring and
+00019b90: 2070 6172 616d 6574 6572 730a 2020 2020   parameters.    
+00019ba0: 2222 220a 2020 2020 6966 2070 7265 7669  """.    if previ
+00019bb0: 6f75 735f 6368 756e 6b73 2069 7320 6e6f  ous_chunks is no
+00019bc0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
+00019bd0: 7072 6576 696f 7573 5f63 6875 6e6b 7320  previous_chunks 
+00019be0: 3d20 7475 706c 6528 0a20 2020 2020 2020  = tuple(.       
+00019bf0: 2020 2020 2063 2069 6620 6973 696e 7374       c if isinst
+00019c00: 616e 6365 2863 2c20 7475 706c 6529 2065  ance(c, tuple) e
+00019c10: 6c73 6520 2863 2c29 2066 6f72 2063 2069  lse (c,) for c i
+00019c20: 6e20 7072 6576 696f 7573 5f63 6875 6e6b  n previous_chunk
+00019c30: 730a 2020 2020 2020 2020 290a 2020 2020  s.        ).    
+00019c40: 6368 756e 6b73 203d 206c 6973 7428 6368  chunks = list(ch
+00019c50: 756e 6b73 290a 0a20 2020 2061 7574 6f73  unks)..    autos
+00019c60: 203d 207b 6920 666f 7220 692c 2063 2069   = {i for i, c i
+00019c70: 6e20 656e 756d 6572 6174 6528 6368 756e  n enumerate(chun
+00019c80: 6b73 2920 6966 2063 203d 3d20 2261 7574  ks) if c == "aut
+00019c90: 6f22 7d0a 2020 2020 6966 206e 6f74 2061  o"}.    if not a
+00019ca0: 7574 6f73 3a0a 2020 2020 2020 2020 7265  utos:.        re
+00019cb0: 7475 726e 2074 7570 6c65 2863 6875 6e6b  turn tuple(chunk
+00019cc0: 7329 0a0a 2020 2020 6966 206c 696d 6974  s)..    if limit
+00019cd0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00019ce0: 2020 6c69 6d69 7420 3d20 636f 6e66 6967    limit = config
+00019cf0: 2e67 6574 2822 6172 7261 792e 6368 756e  .get("array.chun
+00019d00: 6b2d 7369 7a65 2229 0a20 2020 2069 6620  k-size").    if 
+00019d10: 6973 696e 7374 616e 6365 286c 696d 6974  isinstance(limit
+00019d20: 2c20 7374 7229 3a0a 2020 2020 2020 2020  , str):.        
+00019d30: 6c69 6d69 7420 3d20 7061 7273 655f 6279  limit = parse_by
+00019d40: 7465 7328 6c69 6d69 7429 0a0a 2020 2020  tes(limit)..    
+00019d50: 6966 2064 7479 7065 2069 7320 4e6f 6e65  if dtype is None
+00019d60: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00019d70: 5479 7065 4572 726f 7228 2264 7479 7065  TypeError("dtype
+00019d80: 206d 7573 7420 6265 206b 6e6f 776e 2066   must be known f
+00019d90: 6f72 2061 7574 6f2d 6368 756e 6b69 6e67  or auto-chunking
+00019da0: 2229 0a0a 2020 2020 6966 2064 7479 7065  ")..    if dtype
+00019db0: 2e68 6173 6f62 6a65 6374 3a0a 2020 2020  .hasobject:.    
+00019dc0: 2020 2020 7261 6973 6520 4e6f 7449 6d70      raise NotImp
+00019dd0: 6c65 6d65 6e74 6564 4572 726f 7228 0a20  lementedError(. 
+00019de0: 2020 2020 2020 2020 2020 2022 4361 6e20             "Can 
+00019df0: 6e6f 7420 7573 6520 6175 746f 2072 6563  not use auto rec
+00019e00: 6875 6e6b 696e 6720 7769 7468 206f 626a  hunking with obj
+00019e10: 6563 7420 6474 7970 652e 2022 0a20 2020  ect dtype. ".   
+00019e20: 2020 2020 2020 2020 2022 5765 2061 7265           "We are
+00019e30: 2075 6e61 626c 6520 746f 2065 7374 696d   unable to estim
+00019e40: 6174 6520 7468 6520 7369 7a65 2069 6e20  ate the size in 
+00019e50: 6279 7465 7320 6f66 206f 626a 6563 7420  bytes of object 
+00019e60: 6461 7461 220a 2020 2020 2020 2020 290a  data".        ).
+00019e70: 0a20 2020 2066 6f72 2078 2069 6e20 7475  .    for x in tu
+00019e80: 706c 6528 6368 756e 6b73 2920 2b20 7475  ple(chunks) + tu
+00019e90: 706c 6528 7368 6170 6529 3a0a 2020 2020  ple(shape):.    
+00019ea0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00019eb0: 2020 2020 2069 7369 6e73 7461 6e63 6528       isinstance(
+00019ec0: 782c 204e 756d 6265 7229 0a20 2020 2020  x, Number).     
+00019ed0: 2020 2020 2020 2061 6e64 206e 702e 6973         and np.is
+00019ee0: 6e61 6e28 7829 0a20 2020 2020 2020 2020  nan(x).         
+00019ef0: 2020 206f 7220 6973 696e 7374 616e 6365     or isinstance
+00019f00: 2878 2c20 7475 706c 6529 0a20 2020 2020  (x, tuple).     
+00019f10: 2020 2020 2020 2061 6e64 206e 702e 6973         and np.is
+00019f20: 6e61 6e28 7829 2e61 6e79 2829 0a20 2020  nan(x).any().   
+00019f30: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00019f40: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00019f50: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00019f60: 2020 2020 2020 2243 616e 206e 6f74 2070        "Can not p
+00019f70: 6572 666f 726d 2061 7574 6f6d 6174 6963  erform automatic
+00019f80: 2072 6563 6875 6e6b 696e 6720 7769 7468   rechunking with
+00019f90: 2075 6e6b 6e6f 776e 2022 0a20 2020 2020   unknown ".     
+00019fa0: 2020 2020 2020 2020 2020 2022 286e 616e             "(nan
+00019fb0: 2920 6368 756e 6b20 7369 7a65 732e 2573  ) chunk sizes.%s
+00019fc0: 2220 2520 756e 6b6e 6f77 6e5f 6368 756e  " % unknown_chun
+00019fd0: 6b5f 6d65 7373 6167 650a 2020 2020 2020  k_message.      
+00019fe0: 2020 2020 2020 290a 0a20 2020 206c 696d        )..    lim
+00019ff0: 6974 203d 206d 6178 2831 2c20 6c69 6d69  it = max(1, limi
+0001a000: 7429 0a0a 2020 2020 6c61 7267 6573 745f  t)..    largest_
+0001a010: 626c 6f63 6b20 3d20 6d61 7468 2e70 726f  block = math.pro
+0001a020: 6428 0a20 2020 2020 2020 2063 7320 6966  d(.        cs if
+0001a030: 2069 7369 6e73 7461 6e63 6528 6373 2c20   isinstance(cs, 
+0001a040: 4e75 6d62 6572 2920 656c 7365 206d 6178  Number) else max
+0001a050: 2863 7329 2066 6f72 2063 7320 696e 2063  (cs) for cs in c
+0001a060: 6875 6e6b 7320 6966 2063 7320 213d 2022  hunks if cs != "
+0001a070: 6175 746f 220a 2020 2020 290a 0a20 2020  auto".    )..   
+0001a080: 2069 6620 7072 6576 696f 7573 5f63 6875   if previous_chu
+0001a090: 6e6b 733a 0a20 2020 2020 2020 2023 2042  nks:.        # B
+0001a0a0: 6173 6520 6964 6561 6c20 7261 7469 6f20  ase ideal ratio 
+0001a0b0: 6f6e 2074 6865 206d 6564 6961 6e20 6368  on the median ch
+0001a0c0: 756e 6b20 7369 7a65 206f 6620 7468 6520  unk size of the 
+0001a0d0: 7072 6576 696f 7573 2063 6875 6e6b 730a  previous chunks.
+0001a0e0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+0001a0f0: 207b 613a 206e 702e 6d65 6469 616e 2870   {a: np.median(p
+0001a100: 7265 7669 6f75 735f 6368 756e 6b73 5b61  revious_chunks[a
+0001a110: 5d29 2066 6f72 2061 2069 6e20 6175 746f  ]) for a in auto
+0001a120: 737d 0a0a 2020 2020 2020 2020 6964 6561  s}..        idea
+0001a130: 6c5f 7368 6170 6520 3d20 5b5d 0a20 2020  l_shape = [].   
+0001a140: 2020 2020 2066 6f72 2069 2c20 7320 696e       for i, s in
+0001a150: 2065 6e75 6d65 7261 7465 2873 6861 7065   enumerate(shape
+0001a160: 293a 0a20 2020 2020 2020 2020 2020 2063  ):.            c
+0001a170: 6875 6e6b 5f66 7265 7175 656e 6369 6573  hunk_frequencies
+0001a180: 203d 2066 7265 7175 656e 6369 6573 2870   = frequencies(p
+0001a190: 7265 7669 6f75 735f 6368 756e 6b73 5b69  revious_chunks[i
+0001a1a0: 5d29 0a20 2020 2020 2020 2020 2020 206d  ]).            m
+0001a1b0: 6f64 652c 2063 6f75 6e74 203d 206d 6178  ode, count = max
+0001a1c0: 2863 6875 6e6b 5f66 7265 7175 656e 6369  (chunk_frequenci
+0001a1d0: 6573 2e69 7465 6d73 2829 2c20 6b65 793d  es.items(), key=
+0001a1e0: 6c61 6d62 6461 206b 763a 206b 765b 315d  lambda kv: kv[1]
+0001a1f0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0001a200: 206d 6f64 6520 3e20 3120 616e 6420 636f   mode > 1 and co
+0001a210: 756e 7420 3e3d 206c 656e 2870 7265 7669  unt >= len(previ
+0001a220: 6f75 735f 6368 756e 6b73 5b69 5d29 202f  ous_chunks[i]) /
+0001a230: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+0001a240: 2020 2020 6964 6561 6c5f 7368 6170 652e      ideal_shape.
+0001a250: 6170 7065 6e64 286d 6f64 6529 0a20 2020  append(mode).   
+0001a260: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001a270: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001a280: 6465 616c 5f73 6861 7065 2e61 7070 656e  deal_shape.appen
+0001a290: 6428 7329 0a0a 2020 2020 2020 2020 2320  d(s)..        # 
+0001a2a0: 486f 7720 6d75 6368 206c 6172 6765 7220  How much larger 
+0001a2b0: 6f72 2073 6d61 6c6c 6572 2074 6865 2069  or smaller the i
+0001a2c0: 6465 616c 2063 6875 6e6b 2073 697a 6520  deal chunk size 
+0001a2d0: 6973 2072 656c 6174 6976 6520 746f 2077  is relative to w
+0001a2e0: 6861 7420 7765 2068 6176 6520 6e6f 770a  hat we have now.
+0001a2f0: 2020 2020 2020 2020 6d75 6c74 6970 6c69          multipli
+0001a300: 6572 203d 205f 636f 6d70 7574 655f 6d75  er = _compute_mu
+0001a310: 6c74 6970 6c69 6572 286c 696d 6974 2c20  ltiplier(limit, 
+0001a320: 6474 7970 652c 206c 6172 6765 7374 5f62  dtype, largest_b
+0001a330: 6c6f 636b 2c20 7265 7375 6c74 290a 0a20  lock, result).. 
+0001a340: 2020 2020 2020 206c 6173 745f 6d75 6c74         last_mult
+0001a350: 6970 6c69 6572 203d 2030 0a20 2020 2020  iplier = 0.     
+0001a360: 2020 206c 6173 745f 6175 746f 7320 3d20     last_autos = 
+0001a370: 7365 7428 290a 2020 2020 2020 2020 7768  set().        wh
+0001a380: 696c 6520 280a 2020 2020 2020 2020 2020  ile (.          
+0001a390: 2020 6d75 6c74 6970 6c69 6572 2021 3d20    multiplier != 
+0001a3a0: 6c61 7374 5f6d 756c 7469 706c 6965 7220  last_multiplier 
+0001a3b0: 6f72 2061 7574 6f73 2021 3d20 6c61 7374  or autos != last
+0001a3c0: 5f61 7574 6f73 0a20 2020 2020 2020 2029  _autos.        )
+0001a3d0: 3a20 2023 2077 6869 6c65 2074 6869 6e67  :  # while thing
+0001a3e0: 7320 6368 616e 6765 0a20 2020 2020 2020  s change.       
+0001a3f0: 2020 2020 206c 6173 745f 6d75 6c74 6970       last_multip
+0001a400: 6c69 6572 203d 206d 756c 7469 706c 6965  lier = multiplie
+0001a410: 7220 2023 2072 6563 6f72 6420 7072 6576  r  # record prev
+0001a420: 696f 7573 2076 616c 7565 730a 2020 2020  ious values.    
+0001a430: 2020 2020 2020 2020 6c61 7374 5f61 7574          last_aut
+0001a440: 6f73 203d 2073 6574 2861 7574 6f73 2920  os = set(autos) 
+0001a450: 2023 2072 6563 6f72 6420 7072 6576 696f   # record previo
+0001a460: 7573 2076 616c 7565 730a 0a20 2020 2020  us values..     
+0001a470: 2020 2020 2020 2023 2045 7870 616e 6420         # Expand 
+0001a480: 6f72 2063 6f6e 7472 6163 7420 6561 6368  or contract each
+0001a490: 206f 6620 7468 6520 6469 6d65 6e73 696f   of the dimensio
+0001a4a0: 6e73 2061 7070 726f 7072 6961 7465 6c79  ns appropriately
+0001a4b0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001a4c0: 2061 2069 6e20 736f 7274 6564 2861 7574   a in sorted(aut
+0001a4d0: 6f73 293a 0a20 2020 2020 2020 2020 2020  os):.           
+0001a4e0: 2020 2020 2069 6620 6964 6561 6c5f 7368       if ideal_sh
+0001a4f0: 6170 655b 615d 203d 3d20 303a 0a20 2020  ape[a] == 0:.   
+0001a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a510: 2072 6573 756c 745b 615d 203d 2030 0a20   result[a] = 0. 
 0001a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a530: 7265 7375 6c74 5b61 5d20 3d20 300a 2020  result[a] = 0.  
-0001a540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a550: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-0001a560: 2020 2020 2020 2020 2020 2070 726f 706f             propo
-0001a570: 7365 6420 3d20 7265 7375 6c74 5b61 5d20  sed = result[a] 
-0001a580: 2a20 6d75 6c74 6970 6c69 6572 202a 2a20  * multiplier ** 
-0001a590: 2831 202f 206c 656e 2861 7574 6f73 2929  (1 / len(autos))
-0001a5a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001a5b0: 2069 6620 7072 6f70 6f73 6564 203e 2073   if proposed > s
-0001a5c0: 6861 7065 5b61 5d3a 2020 2320 7765 2776  hape[a]:  # we'v
-0001a5d0: 6520 6869 7420 7468 6520 7368 6170 6520  e hit the shape 
-0001a5e0: 626f 756e 6461 7279 0a20 2020 2020 2020  boundary.       
-0001a5f0: 2020 2020 2020 2020 2020 2020 2061 7574               aut
-0001a600: 6f73 2e72 656d 6f76 6528 6129 0a20 2020  os.remove(a).   
-0001a610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a620: 206c 6172 6765 7374 5f62 6c6f 636b 202a   largest_block *
-0001a630: 3d20 7368 6170 655b 615d 0a20 2020 2020  = shape[a].     
-0001a640: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-0001a650: 6875 6e6b 735b 615d 203d 2073 6861 7065  hunks[a] = shape
-0001a660: 5b61 5d0a 2020 2020 2020 2020 2020 2020  [a].            
-0001a670: 2020 2020 2020 2020 6465 6c20 7265 7375          del resu
-0001a680: 6c74 5b61 5d0a 2020 2020 2020 2020 2020  lt[a].          
-0001a690: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001a6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a6b0: 7265 7375 6c74 5b61 5d20 3d20 726f 756e  result[a] = roun
-0001a6c0: 645f 746f 2870 726f 706f 7365 642c 2069  d_to(proposed, i
-0001a6d0: 6465 616c 5f73 6861 7065 5b61 5d29 0a0a  deal_shape[a])..
-0001a6e0: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-0001a6f0: 636f 6d70 7574 6520 686f 7720 6d75 6368  compute how much
-0001a700: 206d 756c 7469 706c 6965 7220 7765 2068   multiplier we h
-0001a710: 6176 6520 6c65 6674 2c20 7265 7065 6174  ave left, repeat
-0001a720: 0a20 2020 2020 2020 2020 2020 206d 756c  .            mul
-0001a730: 7469 706c 6965 7220 3d20 5f63 6f6d 7075  tiplier = _compu
-0001a740: 7465 5f6d 756c 7469 706c 6965 7228 6c69  te_multiplier(li
-0001a750: 6d69 742c 2064 7479 7065 2c20 6c61 7267  mit, dtype, larg
-0001a760: 6573 745f 626c 6f63 6b2c 2072 6573 756c  est_block, resul
-0001a770: 7429 0a0a 2020 2020 2020 2020 666f 7220  t)..        for 
-0001a780: 6b2c 2076 2069 6e20 7265 7375 6c74 2e69  k, v in result.i
-0001a790: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-0001a7a0: 2020 2020 6368 756e 6b73 5b6b 5d20 3d20      chunks[k] = 
-0001a7b0: 760a 2020 2020 2020 2020 7265 7475 726e  v.        return
-0001a7c0: 2074 7570 6c65 2863 6875 6e6b 7329 0a0a   tuple(chunks)..
-0001a7d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001a7e0: 2020 2320 4368 6563 6b20 6966 2064 7479    # Check if dty
-0001a7f0: 7065 2e69 7465 6d73 697a 6520 6973 2067  pe.itemsize is g
-0001a800: 7265 6174 6572 2074 6861 6e20 300a 2020  reater than 0.  
-0001a810: 2020 2020 2020 6966 2064 7479 7065 2e69        if dtype.i
-0001a820: 7465 6d73 697a 6520 3d3d 2030 3a0a 2020  temsize == 0:.  
-0001a830: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001a840: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-0001a850: 2020 2020 2020 2020 2020 2020 2261 7574              "aut
-0001a860: 6f2d 6368 756e 6b69 6e67 2077 6974 6820  o-chunking with 
-0001a870: 6474 7970 652e 6974 656d 7369 7a65 203d  dtype.itemsize =
-0001a880: 3d20 3020 6973 206e 6f74 2073 7570 706f  = 0 is not suppo
-0001a890: 7274 6564 2c20 706c 6561 7365 2070 6173  rted, please pas
-0001a8a0: 7320 696e 2060 6368 756e 6b73 6020 6578  s in `chunks` ex
-0001a8b0: 706c 6963 6974 6c79 220a 2020 2020 2020  plicitly".      
-0001a8c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0001a8d0: 7369 7a65 203d 2028 6c69 6d69 7420 2f20  size = (limit / 
-0001a8e0: 6474 7970 652e 6974 656d 7369 7a65 202f  dtype.itemsize /
-0001a8f0: 206c 6172 6765 7374 5f62 6c6f 636b 2920   largest_block) 
-0001a900: 2a2a 2028 3120 2f20 6c65 6e28 6175 746f  ** (1 / len(auto
-0001a910: 7329 290a 2020 2020 2020 2020 736d 616c  s)).        smal
-0001a920: 6c20 3d20 5b69 2066 6f72 2069 2069 6e20  l = [i for i in 
-0001a930: 6175 746f 7320 6966 2073 6861 7065 5b69  autos if shape[i
-0001a940: 5d20 3c20 7369 7a65 5d0a 2020 2020 2020  ] < size].      
-0001a950: 2020 6966 2073 6d61 6c6c 3a0a 2020 2020    if small:.    
-0001a960: 2020 2020 2020 2020 666f 7220 6920 696e          for i in
-0001a970: 2073 6d61 6c6c 3a0a 2020 2020 2020 2020   small:.        
-0001a980: 2020 2020 2020 2020 6368 756e 6b73 5b69          chunks[i
-0001a990: 5d20 3d20 2873 6861 7065 5b69 5d2c 290a  ] = (shape[i],).
-0001a9a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001a9b0: 726e 2061 7574 6f5f 6368 756e 6b73 2863  rn auto_chunks(c
-0001a9c0: 6875 6e6b 732c 2073 6861 7065 2c20 6c69  hunks, shape, li
-0001a9d0: 6d69 742c 2064 7479 7065 290a 0a20 2020  mit, dtype)..   
-0001a9e0: 2020 2020 2066 6f72 2069 2069 6e20 6175       for i in au
-0001a9f0: 746f 733a 0a20 2020 2020 2020 2020 2020  tos:.           
-0001aa00: 2063 6875 6e6b 735b 695d 203d 2072 6f75   chunks[i] = rou
-0001aa10: 6e64 5f74 6f28 7369 7a65 2c20 7368 6170  nd_to(size, shap
-0001aa20: 655b 695d 290a 0a20 2020 2020 2020 2072  e[i])..        r
-0001aa30: 6574 7572 6e20 7475 706c 6528 6368 756e  eturn tuple(chun
-0001aa40: 6b73 290a 0a0a 6465 6620 726f 756e 645f  ks)...def round_
-0001aa50: 746f 2863 2c20 7329 3a0a 2020 2020 2222  to(c, s):.    ""
-0001aa60: 2252 6574 7572 6e20 6120 6368 756e 6b20  "Return a chunk 
-0001aa70: 6469 6d65 6e73 696f 6e20 7468 6174 2069  dimension that i
-0001aa80: 7320 636c 6f73 6520 746f 2061 6e20 6576  s close to an ev
-0001aa90: 656e 206d 756c 7469 706c 6520 6f72 2066  en multiple or f
-0001aaa0: 6163 746f 720a 0a20 2020 2057 6520 7761  actor..    We wa
-0001aab0: 6e74 2076 616c 7565 7320 666f 7220 6320  nt values for c 
-0001aac0: 7468 6174 2061 7265 206e 6963 656c 7920  that are nicely 
-0001aad0: 616c 6967 6e65 6420 7769 7468 2073 2e0a  aligned with s..
-0001aae0: 0a20 2020 2049 6620 6320 6973 2073 6d61  .    If c is sma
-0001aaf0: 6c6c 6572 2074 6861 6e20 7320 7765 2075  ller than s we u
-0001ab00: 7365 2074 6865 206f 7269 6769 6e61 6c20  se the original 
-0001ab10: 6368 756e 6b20 7369 7a65 2061 6e64 2061  chunk size and a
-0001ab20: 6363 6570 7420 616e 0a20 2020 2075 6e65  ccept an.    une
-0001ab30: 7665 6e20 6368 756e 6b20 6174 2074 6865  ven chunk at the
-0001ab40: 2065 6e64 2e0a 0a20 2020 2049 6620 6320   end...    If c 
-0001ab50: 6973 206c 6172 6765 7220 7468 616e 2073  is larger than s
-0001ab60: 2074 6865 6e20 7765 2077 616e 7420 7468   then we want th
-0001ab70: 6520 6c61 7267 6573 7420 6d75 6c74 6970  e largest multip
-0001ab80: 6c65 206f 6620 7320 7468 6174 2069 7320  le of s that is 
-0001ab90: 7374 696c 6c0a 2020 2020 736d 616c 6c65  still.    smalle
-0001aba0: 7220 7468 616e 2063 2e0a 2020 2020 2222  r than c..    ""
-0001abb0: 220a 2020 2020 6966 2063 203c 3d20 733a  ".    if c <= s:
-0001abc0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001abd0: 6d61 7828 312c 2069 6e74 2863 2929 0a20  max(1, int(c)). 
-0001abe0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0001abf0: 2072 6574 7572 6e20 6320 2f2f 2073 202a   return c // s *
-0001ac00: 2073 0a0a 0a64 6566 205f 6765 745f 6368   s...def _get_ch
-0001ac10: 756e 6b5f 7368 6170 6528 6129 3a0a 2020  unk_shape(a):.  
-0001ac20: 2020 7320 3d20 6e70 2e61 7361 7272 6179    s = np.asarray
-0001ac30: 2861 2e73 6861 7065 2c20 6474 7970 653d  (a.shape, dtype=
-0001ac40: 696e 7429 0a20 2020 2072 6574 7572 6e20  int).    return 
-0001ac50: 735b 6c65 6e28 7329 202a 2028 4e6f 6e65  s[len(s) * (None
-0001ac60: 2c29 202b 2028 736c 6963 6528 4e6f 6e65  ,) + (slice(None
-0001ac70: 292c 295d 0a0a 0a64 6566 2066 726f 6d5f  ),)]...def from_
-0001ac80: 6172 7261 7928 0a20 2020 2078 2c0a 2020  array(.    x,.  
-0001ac90: 2020 6368 756e 6b73 3d22 6175 746f 222c    chunks="auto",
-0001aca0: 0a20 2020 206e 616d 653d 4e6f 6e65 2c0a  .    name=None,.
-0001acb0: 2020 2020 6c6f 636b 3d46 616c 7365 2c0a      lock=False,.
-0001acc0: 2020 2020 6173 6172 7261 793d 4e6f 6e65      asarray=None
-0001acd0: 2c0a 2020 2020 6661 6e63 793d 5472 7565  ,.    fancy=True
-0001ace0: 2c0a 2020 2020 6765 7469 7465 6d3d 4e6f  ,.    getitem=No
-0001acf0: 6e65 2c0a 2020 2020 6d65 7461 3d4e 6f6e  ne,.    meta=Non
-0001ad00: 652c 0a20 2020 2069 6e6c 696e 655f 6172  e,.    inline_ar
-0001ad10: 7261 793d 4661 6c73 652c 0a29 3a0a 2020  ray=False,.):.  
-0001ad20: 2020 2222 2243 7265 6174 6520 6461 736b    """Create dask
-0001ad30: 2061 7272 6179 2066 726f 6d20 736f 6d65   array from some
-0001ad40: 7468 696e 6720 7468 6174 206c 6f6f 6b73  thing that looks
-0001ad50: 206c 696b 6520 616e 2061 7272 6179 2e0a   like an array..
-0001ad60: 0a20 2020 2049 6e70 7574 206d 7573 7420  .    Input must 
-0001ad70: 6861 7665 2061 2060 602e 7368 6170 6560  have a ``.shape`
-0001ad80: 602c 2060 602e 6e64 696d 6060 2c20 6060  `, ``.ndim``, ``
-0001ad90: 2e64 7479 7065 6060 2061 6e64 2073 7570  .dtype`` and sup
-0001ada0: 706f 7274 206e 756d 7079 2d73 7479 6c65  port numpy-style
-0001adb0: 2073 6c69 6369 6e67 2e0a 0a20 2020 2050   slicing...    P
-0001adc0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-0001add0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2078 203a  --------.    x :
-0001ade0: 2061 7272 6179 5f6c 696b 650a 2020 2020   array_like.    
-0001adf0: 6368 756e 6b73 203a 2069 6e74 2c20 7475  chunks : int, tu
-0001ae00: 706c 650a 2020 2020 2020 2020 486f 7720  ple.        How 
-0001ae10: 746f 2063 6875 6e6b 2074 6865 2061 7272  to chunk the arr
-0001ae20: 6179 2e20 4d75 7374 2062 6520 6f6e 6520  ay. Must be one 
-0001ae30: 6f66 2074 6865 2066 6f6c 6c6f 7769 6e67  of the following
-0001ae40: 2066 6f72 6d73 3a0a 0a20 2020 2020 2020   forms:..       
-0001ae50: 202d 2041 2062 6c6f 636b 7369 7a65 206c   - A blocksize l
-0001ae60: 696b 6520 3130 3030 2e0a 2020 2020 2020  ike 1000..      
-0001ae70: 2020 2d20 4120 626c 6f63 6b73 6861 7065    - A blockshape
-0001ae80: 206c 696b 6520 2831 3030 302c 2031 3030   like (1000, 100
-0001ae90: 3029 2e0a 2020 2020 2020 2020 2d20 4578  0)..        - Ex
-0001aea0: 706c 6963 6974 2073 697a 6573 206f 6620  plicit sizes of 
-0001aeb0: 616c 6c20 626c 6f63 6b73 2061 6c6f 6e67  all blocks along
-0001aec0: 2061 6c6c 2064 696d 656e 7369 6f6e 7320   all dimensions 
-0001aed0: 6c69 6b65 0a20 2020 2020 2020 2020 2028  like.          (
-0001aee0: 2831 3030 302c 2031 3030 302c 2035 3030  (1000, 1000, 500
-0001aef0: 292c 2028 3430 302c 2034 3030 2929 2e0a  ), (400, 400))..
-0001af00: 2020 2020 2020 2020 2d20 4120 7369 7a65          - A size
-0001af10: 2069 6e20 6279 7465 732c 206c 696b 6520   in bytes, like 
-0001af20: 2231 3030 204d 6942 2220 7768 6963 6820  "100 MiB" which 
-0001af30: 7769 6c6c 2063 686f 6f73 6520 6120 756e  will choose a un
-0001af40: 6966 6f72 6d0a 2020 2020 2020 2020 2020  iform.          
-0001af50: 626c 6f63 6b2d 6c69 6b65 2073 6861 7065  block-like shape
-0001af60: 0a20 2020 2020 2020 202d 2054 6865 2077  .        - The w
-0001af70: 6f72 6420 2261 7574 6f22 2077 6869 6368  ord "auto" which
-0001af80: 2061 6374 7320 6c69 6b65 2074 6865 2061   acts like the a
-0001af90: 626f 7665 2c20 6275 7420 7573 6573 2061  bove, but uses a
-0001afa0: 2063 6f6e 6669 6775 7261 7469 6f6e 0a20   configuration. 
-0001afb0: 2020 2020 2020 2020 2076 616c 7565 2060           value `
-0001afc0: 6061 7272 6179 2e63 6875 6e6b 2d73 697a  `array.chunk-siz
-0001afd0: 6560 6020 666f 7220 7468 6520 6368 756e  e`` for the chun
-0001afe0: 6b20 7369 7a65 0a0a 2020 2020 2020 2020  k size..        
-0001aff0: 2d31 206f 7220 4e6f 6e65 2061 7320 6120  -1 or None as a 
-0001b000: 626c 6f63 6b73 697a 6520 696e 6469 6361  blocksize indica
-0001b010: 7465 2074 6865 2073 697a 6520 6f66 2074  te the size of t
-0001b020: 6865 2063 6f72 7265 7370 6f6e 6469 6e67  he corresponding
-0001b030: 0a20 2020 2020 2020 2064 696d 656e 7369  .        dimensi
-0001b040: 6f6e 2e0a 2020 2020 6e61 6d65 203a 2073  on..    name : s
-0001b050: 7472 206f 7220 626f 6f6c 2c20 6f70 7469  tr or bool, opti
-0001b060: 6f6e 616c 0a20 2020 2020 2020 2054 6865  onal.        The
-0001b070: 206b 6579 206e 616d 6520 746f 2075 7365   key name to use
-0001b080: 2066 6f72 2074 6865 2061 7272 6179 2e20   for the array. 
-0001b090: 4465 6661 756c 7473 2074 6f20 6120 6861  Defaults to a ha
-0001b0a0: 7368 206f 6620 6060 7860 602e 0a0a 2020  sh of ``x``...  
-0001b0b0: 2020 2020 2020 4861 7368 696e 6720 6973        Hashing is
-0001b0c0: 2075 7365 6675 6c20 6966 2074 6865 2073   useful if the s
-0001b0d0: 616d 6520 7661 6c75 6520 6f66 2060 6078  ame value of ``x
-0001b0e0: 6060 2069 7320 7573 6564 2074 6f20 6372  `` is used to cr
-0001b0f0: 6561 7465 206d 756c 7469 706c 650a 2020  eate multiple.  
-0001b100: 2020 2020 2020 6172 7261 7973 2c20 6173        arrays, as
-0001b110: 2044 6173 6b20 6361 6e20 7468 656e 2072   Dask can then r
-0001b120: 6563 6f67 6e69 7365 2074 6861 7420 7468  ecognise that th
-0001b130: 6579 2772 6520 7468 6520 7361 6d65 2061  ey're the same a
-0001b140: 6e64 0a20 2020 2020 2020 2061 766f 6964  nd.        avoid
-0001b150: 2064 7570 6c69 6361 7465 2063 6f6d 7075   duplicate compu
-0001b160: 7461 7469 6f6e 732e 2048 6f77 6576 6572  tations. However
-0001b170: 2c20 6974 2063 616e 2061 6c73 6f20 6265  , it can also be
-0001b180: 2073 6c6f 772c 2061 6e64 2069 6620 7468   slow, and if th
-0001b190: 650a 2020 2020 2020 2020 6172 7261 7920  e.        array 
-0001b1a0: 6973 206e 6f74 2063 6f6e 7469 6775 6f75  is not contiguou
-0001b1b0: 7320 6974 2069 7320 636f 7069 6564 2066  s it is copied f
-0001b1c0: 6f72 2068 6173 6869 6e67 2e20 4966 2074  or hashing. If t
-0001b1d0: 6865 2061 7272 6179 2075 7365 730a 2020  he array uses.  
-0001b1e0: 2020 2020 2020 7374 7269 6465 2074 7269        stride tri
-0001b1f0: 636b 7320 2873 7563 6820 6173 203a 6675  cks (such as :fu
-0001b200: 6e63 3a60 6e75 6d70 792e 6272 6f61 6463  nc:`numpy.broadc
-0001b210: 6173 745f 746f 6020 6f72 0a20 2020 2020  ast_to` or.     
-0001b220: 2020 203a 6675 6e63 3a60 736b 696d 6167     :func:`skimag
-0001b230: 652e 7574 696c 2e76 6965 775f 6173 5f77  e.util.view_as_w
-0001b240: 696e 646f 7773 6029 2074 6f20 6861 7665  indows`) to have
-0001b250: 2061 206c 6172 6765 7220 6c6f 6769 6361   a larger logica
-0001b260: 6c0a 2020 2020 2020 2020 7468 616e 2070  l.        than p
-0001b270: 6879 7369 6361 6c20 7369 7a65 2c20 7468  hysical size, th
-0001b280: 6973 2063 6f70 7920 6361 6e20 6361 7573  is copy can caus
-0001b290: 6520 6578 6365 7373 6976 6520 6d65 6d6f  e excessive memo
-0001b2a0: 7279 2075 7361 6765 2e0a 0a20 2020 2020  ry usage...     
-0001b2b0: 2020 2049 6620 796f 7520 646f 6e27 7420     If you don't 
-0001b2c0: 6e65 6564 2074 6865 2064 6564 7570 6c69  need the dedupli
-0001b2d0: 6361 7469 6f6e 2070 726f 7669 6465 6420  cation provided 
-0001b2e0: 6279 2068 6173 6869 6e67 2c20 7573 650a  by hashing, use.
-0001b2f0: 2020 2020 2020 2020 6060 6e61 6d65 3d46          ``name=F
-0001b300: 616c 7365 6060 2074 6f20 6765 6e65 7261  alse`` to genera
-0001b310: 7465 2061 2072 616e 646f 6d20 6e61 6d65  te a random name
-0001b320: 2069 6e73 7465 6164 206f 6620 6861 7368   instead of hash
-0001b330: 696e 672c 2077 6869 6368 0a20 2020 2020  ing, which.     
-0001b340: 2020 2061 766f 6964 7320 7468 6520 7069     avoids the pi
-0001b350: 7466 616c 6c73 2064 6573 6372 6962 6564  tfalls described
-0001b360: 2061 626f 7665 2e20 5573 696e 6720 6060   above. Using ``
-0001b370: 6e61 6d65 3d54 7275 6560 6020 6973 0a20  name=True`` is. 
-0001b380: 2020 2020 2020 2065 7175 6976 616c 656e         equivalen
-0001b390: 7420 746f 2074 6865 2064 6566 6175 6c74  t to the default
-0001b3a0: 2e0a 0a20 2020 2020 2020 2042 7920 6465  ...        By de
-0001b3b0: 6661 756c 742c 2068 6173 6869 6e67 2075  fault, hashing u
-0001b3c0: 7365 7320 7079 7468 6f6e 2773 2073 7461  ses python's sta
-0001b3d0: 6e64 6172 6420 7368 6131 2e20 5468 6973  ndard sha1. This
-0001b3e0: 2062 6568 6176 696f 7572 2063 616e 2062   behaviour can b
-0001b3f0: 650a 2020 2020 2020 2020 6368 616e 6765  e.        change
-0001b400: 6420 6279 2069 6e73 7461 6c6c 696e 6720  d by installing 
-0001b410: 6369 7479 6861 7368 2c20 7878 6861 7368  cityhash, xxhash
-0001b420: 206f 7220 6d75 726d 7572 6861 7368 2e20   or murmurhash. 
-0001b430: 4966 2069 6e73 7461 6c6c 6564 2c0a 2020  If installed,.  
-0001b440: 2020 2020 2020 6120 6c61 7267 652d 6661        a large-fa
-0001b450: 6374 6f72 2073 7065 6564 7570 2063 616e  ctor speedup can
-0001b460: 2062 6520 6f62 7461 696e 6564 2069 6e20   be obtained in 
-0001b470: 7468 6520 746f 6b65 6e69 7361 7469 6f6e  the tokenisation
-0001b480: 2073 7465 702e 0a0a 2020 2020 2020 2020   step...        
-0001b490: 2e2e 206e 6f74 653a 3a0a 0a20 2020 2020  .. note::..     
-0001b4a0: 2020 2020 2020 4265 6361 7573 6520 7468        Because th
-0001b4b0: 6973 2060 606e 616d 6560 6020 6973 2075  is ``name`` is u
-0001b4c0: 7365 6420 6173 2074 6865 206b 6579 2069  sed as the key i
-0001b4d0: 6e20 7461 736b 2067 7261 7068 732c 2079  n task graphs, y
-0001b4e0: 6f75 2073 686f 756c 640a 2020 2020 2020  ou should.      
-0001b4f0: 2020 2020 2065 6e73 7572 6520 7468 6174       ensure that
-0001b500: 2069 7420 756e 6971 7565 6c79 2069 6465   it uniquely ide
-0001b510: 6e74 6966 6965 7320 7468 6520 6461 7461  ntifies the data
-0001b520: 2063 6f6e 7461 696e 6564 2077 6974 6869   contained withi
-0001b530: 6e2e 2049 660a 2020 2020 2020 2020 2020  n. If.          
-0001b540: 2079 6f75 2764 206c 696b 6520 746f 2070   you'd like to p
-0001b550: 726f 7669 6465 2061 2064 6573 6372 6970  rovide a descrip
-0001b560: 7469 7665 206e 616d 6520 7468 6174 2069  tive name that i
-0001b570: 7320 7374 696c 6c20 756e 6971 7565 2c20  s still unique, 
-0001b580: 636f 6d62 696e 650a 2020 2020 2020 2020  combine.        
-0001b590: 2020 2074 6865 2064 6573 6372 6970 7469     the descripti
-0001b5a0: 7665 206e 616d 6520 7769 7468 203a 6675  ve name with :fu
-0001b5b0: 6e63 3a60 6461 736b 2e62 6173 652e 746f  nc:`dask.base.to
-0001b5c0: 6b65 6e69 7a65 6020 6f66 2074 6865 0a20  kenize` of the. 
-0001b5d0: 2020 2020 2020 2020 2020 6060 6172 7261            ``arra
-0001b5e0: 795f 6c69 6b65 6060 2e20 5365 6520 3a72  y_like``. See :r
-0001b5f0: 6566 3a60 6772 6170 6873 6020 666f 7220  ef:`graphs` for 
-0001b600: 6d6f 7265 2e0a 0a20 2020 206c 6f63 6b20  more...    lock 
-0001b610: 3a20 626f 6f6c 206f 7220 4c6f 636b 2c20  : bool or Lock, 
-0001b620: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0001b630: 2049 6620 6060 7860 6020 646f 6573 6e27   If ``x`` doesn'
-0001b640: 7420 7375 7070 6f72 7420 636f 6e63 7572  t support concur
-0001b650: 7265 6e74 2072 6561 6473 2074 6865 6e20  rent reads then 
-0001b660: 7072 6f76 6964 6520 6120 6c6f 636b 2068  provide a lock h
-0001b670: 6572 652c 206f 720a 2020 2020 2020 2020  ere, or.        
-0001b680: 7061 7373 2069 6e20 5472 7565 2074 6f20  pass in True to 
-0001b690: 6861 7665 2064 6173 6b2e 6172 7261 7920  have dask.array 
-0001b6a0: 6372 6561 7465 206f 6e65 2066 6f72 2079  create one for y
-0001b6b0: 6f75 2e0a 2020 2020 6173 6172 7261 7920  ou..    asarray 
-0001b6c0: 3a20 626f 6f6c 2c20 6f70 7469 6f6e 616c  : bool, optional
-0001b6d0: 0a20 2020 2020 2020 2049 6620 5472 7565  .        If True
-0001b6e0: 2074 6865 6e20 6361 6c6c 206e 702e 6173   then call np.as
-0001b6f0: 6172 7261 7920 6f6e 2063 6875 6e6b 7320  array on chunks 
-0001b700: 746f 2063 6f6e 7665 7274 2074 6865 6d20  to convert them 
-0001b710: 746f 206e 756d 7079 2061 7272 6179 732e  to numpy arrays.
-0001b720: 0a20 2020 2020 2020 2049 6620 4661 6c73  .        If Fals
-0001b730: 6520 7468 656e 2063 6875 6e6b 7320 6172  e then chunks ar
-0001b740: 6520 7061 7373 6564 2074 6872 6f75 6768  e passed through
-0001b750: 2075 6e63 6861 6e67 6564 2e0a 2020 2020   unchanged..    
-0001b760: 2020 2020 4966 204e 6f6e 6520 2864 6566      If None (def
-0001b770: 6175 6c74 2920 7468 656e 2077 6520 7573  ault) then we us
-0001b780: 6520 5472 7565 2069 6620 7468 6520 6060  e True if the ``
-0001b790: 5f5f 6172 7261 795f 6675 6e63 7469 6f6e  __array_function
-0001b7a0: 5f5f 6060 206d 6574 686f 640a 2020 2020  __`` method.    
-0001b7b0: 2020 2020 6973 2075 6e64 6566 696e 6564      is undefined
-0001b7c0: 2e0a 0a20 2020 2020 2020 202e 2e20 6e6f  ...        .. no
-0001b7d0: 7465 3a3a 0a0a 2020 2020 2020 2020 2020  te::..          
-0001b7e0: 2020 4461 736b 2064 6f65 7320 6e6f 7420    Dask does not 
-0001b7f0: 7072 6573 6572 7665 2074 6865 206d 656d  preserve the mem
-0001b800: 6f72 7920 6c61 796f 7574 206f 6620 7468  ory layout of th
-0001b810: 6520 6f72 6967 696e 616c 2061 7272 6179  e original array
-0001b820: 2077 6865 6e0a 2020 2020 2020 2020 2020   when.          
-0001b830: 2020 7468 6520 6172 7261 7920 6973 2063    the array is c
-0001b840: 7265 6174 6564 2075 7369 6e67 2046 6f72  reated using For
-0001b850: 7472 616e 2072 6174 6865 7220 7468 616e  tran rather than
-0001b860: 2043 206f 7264 6572 696e 672e 0a0a 2020   C ordering...  
-0001b870: 2020 6661 6e63 7920 3a20 626f 6f6c 2c20    fancy : bool, 
-0001b880: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-0001b890: 2049 6620 6060 7860 6020 646f 6573 6e27   If ``x`` doesn'
-0001b8a0: 7420 7375 7070 6f72 7420 6661 6e63 7920  t support fancy 
-0001b8b0: 696e 6465 7869 6e67 2028 652e 672e 2069  indexing (e.g. i
-0001b8c0: 6e64 6578 696e 6720 7769 7468 206c 6973  ndexing with lis
-0001b8d0: 7473 206f 720a 2020 2020 2020 2020 6172  ts or.        ar
-0001b8e0: 7261 7973 2920 7468 656e 2073 6574 2074  rays) then set t
-0001b8f0: 6f20 4661 6c73 652e 2044 6566 6175 6c74  o False. Default
-0001b900: 2069 7320 5472 7565 2e0a 2020 2020 6d65   is True..    me
-0001b910: 7461 203a 2041 7272 6179 2d6c 696b 652c  ta : Array-like,
-0001b920: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
-0001b930: 2020 5468 6520 6d65 7461 6461 7461 2066    The metadata f
-0001b940: 6f72 2074 6865 2072 6573 756c 7469 6e67  or the resulting
-0001b950: 2064 6173 6b20 6172 7261 792e 2020 5468   dask array.  Th
-0001b960: 6973 2069 7320 7468 6520 6b69 6e64 206f  is is the kind o
-0001b970: 6620 6172 7261 790a 2020 2020 2020 2020  f array.        
-0001b980: 7468 6174 2077 696c 6c20 7265 7375 6c74  that will result
-0001b990: 2066 726f 6d20 736c 6963 696e 6720 7468   from slicing th
-0001b9a0: 6520 696e 7075 7420 6172 7261 792e 0a20  e input array.. 
-0001b9b0: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
-0001b9c0: 746f 2074 6865 2069 6e70 7574 2061 7272  to the input arr
-0001b9d0: 6179 2e0a 2020 2020 696e 6c69 6e65 5f61  ay..    inline_a
-0001b9e0: 7272 6179 203a 2062 6f6f 6c2c 2064 6566  rray : bool, def
-0001b9f0: 6175 6c74 2046 616c 7365 0a20 2020 2020  ault False.     
-0001ba00: 2020 2048 6f77 2074 6f20 696e 636c 7564     How to includ
-0001ba10: 6520 7468 6520 6172 7261 7920 696e 2074  e the array in t
-0001ba20: 6865 2074 6173 6b20 6772 6170 682e 2042  he task graph. B
-0001ba30: 7920 6465 6661 756c 740a 2020 2020 2020  y default.      
-0001ba40: 2020 2860 6069 6e6c 696e 655f 6172 7261    (``inline_arra
-0001ba50: 793d 4661 6c73 6560 6029 2074 6865 2061  y=False``) the a
-0001ba60: 7272 6179 2069 7320 696e 636c 7564 6564  rray is included
-0001ba70: 2069 6e20 6120 7461 736b 2062 7920 6974   in a task by it
-0001ba80: 7365 6c66 2c0a 2020 2020 2020 2020 616e  self,.        an
-0001ba90: 6420 6561 6368 2063 6875 6e6b 2072 6566  d each chunk ref
-0001baa0: 6572 7320 746f 2074 6861 7420 7461 736b  ers to that task
-0001bab0: 2062 7920 6974 7320 6b65 792e 0a0a 2020   by its key...  
-0001bac0: 2020 2020 2020 2e2e 2063 6f64 652d 626c        .. code-bl
-0001bad0: 6f63 6b3a 3a20 7079 7468 6f6e 0a0a 2020  ock:: python..  
-0001bae0: 2020 2020 2020 2020 203e 3e3e 2078 203d           >>> x =
-0001baf0: 2068 3570 792e 4669 6c65 2822 6461 7461   h5py.File("data
-0001bb00: 2e68 3522 295b 222f 7822 5d20 2023 2064  .h5")["/x"]  # d
-0001bb10: 6f63 7465 7374 3a20 2b53 4b49 500a 2020  octest: +SKIP.  
-0001bb20: 2020 2020 2020 2020 203e 3e3e 2061 203d           >>> a =
-0001bb30: 2064 612e 6672 6f6d 5f61 7272 6179 2878   da.from_array(x
-0001bb40: 2c20 6368 756e 6b73 3d35 3030 2920 2023  , chunks=500)  #
-0001bb50: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
-0001bb60: 2020 2020 2020 2020 2020 203e 3e3e 2064             >>> d
-0001bb70: 6963 7428 612e 6461 736b 2920 2023 2064  ict(a.dask)  # d
-0001bb80: 6f63 7465 7374 3a20 2b53 4b49 500a 2020  octest: +SKIP.  
-0001bb90: 2020 2020 2020 2020 207b 0a20 2020 2020           {.     
-0001bba0: 2020 2020 2020 2020 2027 6172 7261 792d           'array-
-0001bbb0: 6f72 6967 696e 616c 2d3c 6e61 6d65 3e27  original-<name>'
-0001bbc0: 3a20 3c48 4446 3520 6461 7461 7365 7420  : <HDF5 dataset 
-0001bbd0: 2e2e 2e3e 2c0a 2020 2020 2020 2020 2020  ...>,.          
-0001bbe0: 2020 2020 2827 6172 7261 792d 3c6e 616d      ('array-<nam
-0001bbf0: 653e 272c 2030 293a 2028 6765 7469 7465  e>', 0): (getite
-0001bc00: 6d2c 2022 6172 7261 792d 6f72 6967 696e  m, "array-origin
-0001bc10: 616c 2d3c 6e61 6d65 3e22 2c20 2e2e 2e29  al-<name>", ...)
-0001bc20: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001bc30: 2827 6172 7261 792d 3c6e 616d 653e 272c  ('array-<name>',
-0001bc40: 2031 293a 2028 6765 7469 7465 6d2c 2022   1): (getitem, "
-0001bc50: 6172 7261 792d 6f72 6967 696e 616c 2d3c  array-original-<
-0001bc60: 6e61 6d65 3e22 2c20 2e2e 2e29 0a20 2020  name>", ...).   
-0001bc70: 2020 2020 2020 2020 7d0a 0a20 2020 2020          }..     
-0001bc80: 2020 2057 6974 6820 6060 696e 6c69 6e65     With ``inline
-0001bc90: 5f61 7272 6179 3d54 7275 6560 602c 2044  _array=True``, D
-0001bca0: 6173 6b20 7769 6c6c 2069 6e73 7465 6164  ask will instead
-0001bcb0: 2069 6e6c 696e 6520 7468 6520 6172 7261   inline the arra
-0001bcc0: 7920 6469 7265 6374 6c79 0a20 2020 2020  y directly.     
-0001bcd0: 2020 2069 6e20 7468 6520 7661 6c75 6573     in the values
-0001bce0: 206f 6620 7468 6520 7461 736b 2067 7261   of the task gra
-0001bcf0: 7068 2e0a 0a20 2020 2020 2020 202e 2e20  ph...        .. 
-0001bd00: 636f 6465 2d62 6c6f 636b 3a3a 2070 7974  code-block:: pyt
-0001bd10: 686f 6e0a 0a20 2020 2020 2020 2020 2020  hon..           
-0001bd20: 3e3e 3e20 6120 3d20 6461 2e66 726f 6d5f  >>> a = da.from_
-0001bd30: 6172 7261 7928 782c 2063 6875 6e6b 733d  array(x, chunks=
-0001bd40: 3530 302c 2069 6e6c 696e 655f 6172 7261  500, inline_arra
-0001bd50: 793d 5472 7565 2920 2023 2064 6f63 7465  y=True)  # docte
-0001bd60: 7374 3a20 2b53 4b49 500a 2020 2020 2020  st: +SKIP.      
-0001bd70: 2020 2020 203e 3e3e 2064 6963 7428 612e       >>> dict(a.
-0001bd80: 6461 736b 2920 2023 2064 6f63 7465 7374  dask)  # doctest
-0001bd90: 3a20 2b53 4b49 500a 2020 2020 2020 2020  : +SKIP.        
-0001bda0: 2020 207b 0a20 2020 2020 2020 2020 2020     {.           
-0001bdb0: 2020 2028 2761 7272 6179 2d3c 6e61 6d65     ('array-<name
-0001bdc0: 3e27 2c20 3029 3a20 2867 6574 6974 656d  >', 0): (getitem
-0001bdd0: 2c20 3c48 4446 3520 6461 7461 7365 7420  , <HDF5 dataset 
-0001bde0: 2e2e 2e3e 2c20 2e2e 2e29 2c0a 2020 2020  ...>, ...),.    
-0001bdf0: 2020 2020 2020 2020 2020 2827 6172 7261            ('arra
-0001be00: 792d 3c6e 616d 653e 272c 2031 293a 2028  y-<name>', 1): (
-0001be10: 6765 7469 7465 6d2c 203c 4844 4635 2064  getitem, <HDF5 d
-0001be20: 6174 6173 6574 202e 2e2e 3e2c 202e 2e2e  ataset ...>, ...
-0001be30: 290a 2020 2020 2020 2020 2020 207d 0a0a  ).           }..
-0001be40: 2020 2020 2020 2020 4e6f 7465 2074 6861          Note tha
-0001be50: 7420 7468 6572 6527 7320 6e6f 206b 6579  t there's no key
-0001be60: 2069 6e20 7468 6520 7461 736b 2067 7261   in the task gra
-0001be70: 7068 2077 6974 6820 6a75 7374 2074 6865  ph with just the
-0001be80: 2061 7272 6179 2060 7860 0a20 2020 2020   array `x`.     
-0001be90: 2020 2061 6e79 6d6f 7265 2e20 496e 7374     anymore. Inst
-0001bea0: 6561 6420 6974 2773 2070 6c61 6365 6420  ead it's placed 
-0001beb0: 6469 7265 6374 6c79 2069 6e20 7468 6520  directly in the 
-0001bec0: 7661 6c75 6573 2e0a 0a20 2020 2020 2020  values...       
-0001bed0: 2054 6865 2072 6967 6874 2063 686f 6963   The right choic
-0001bee0: 6520 666f 7220 6060 696e 6c69 6e65 5f61  e for ``inline_a
-0001bef0: 7272 6179 6060 2064 6570 656e 6473 206f  rray`` depends o
-0001bf00: 6e20 7365 7665 7261 6c20 6661 6374 6f72  n several factor
-0001bf10: 732c 0a20 2020 2020 2020 2069 6e63 6c75  s,.        inclu
-0001bf20: 6469 6e67 2074 6865 2073 697a 6520 6f66  ding the size of
-0001bf30: 2060 6078 6060 2c20 686f 7720 6578 7065   ``x``, how expe
-0001bf40: 6e73 6976 6520 6974 2069 7320 746f 2063  nsive it is to c
-0001bf50: 7265 6174 652c 2077 6869 6368 0a20 2020  reate, which.   
-0001bf60: 2020 2020 2073 6368 6564 756c 6572 2079       scheduler y
-0001bf70: 6f75 2772 6520 7573 696e 672c 2061 6e64  ou're using, and
-0001bf80: 2074 6865 2070 6174 7465 726e 206f 6620   the pattern of 
-0001bf90: 646f 776e 7374 7265 616d 2063 6f6d 7075  downstream compu
-0001bfa0: 7461 7469 6f6e 732e 0a20 2020 2020 2020  tations..       
-0001bfb0: 2041 7320 6120 6865 7572 6973 7469 632c   As a heuristic,
-0001bfc0: 2060 6069 6e6c 696e 655f 6172 7261 793d   ``inline_array=
-0001bfd0: 5472 7565 6060 206d 6179 2062 6520 7468  True`` may be th
-0001bfe0: 6520 7269 6768 7420 6368 6f69 6365 2077  e right choice w
-0001bff0: 6865 6e0a 2020 2020 2020 2020 7468 6520  hen.        the 
-0001c000: 6172 7261 7920 6060 7860 6020 6973 2063  array ``x`` is c
-0001c010: 6865 6170 2074 6f20 7365 7269 616c 697a  heap to serializ
-0001c020: 6520 616e 6420 6465 7365 7269 616c 697a  e and deserializ
-0001c030: 6520 2873 696e 6365 2069 7427 730a 2020  e (since it's.  
-0001c040: 2020 2020 2020 696e 636c 7564 6564 2069        included i
-0001c050: 6e20 7468 6520 6772 6170 6820 6d61 6e79  n the graph many
-0001c060: 2074 696d 6573 2920 616e 6420 6966 2079   times) and if y
-0001c070: 6f75 2772 6520 6578 7065 7269 656e 6369  ou're experienci
-0001c080: 6e67 206f 7264 6572 696e 670a 2020 2020  ng ordering.    
-0001c090: 2020 2020 6973 7375 6573 2028 7365 6520      issues (see 
-0001c0a0: 3a72 6566 3a60 6f72 6465 7260 2066 6f72  :ref:`order` for
-0001c0b0: 206d 6f72 6529 2e0a 0a20 2020 2020 2020   more)...       
-0001c0c0: 2054 6869 7320 6861 7320 6e6f 2065 6666   This has no eff
-0001c0d0: 6563 7420 7768 656e 2060 6078 6060 2069  ect when ``x`` i
-0001c0e0: 7320 6120 4e75 6d50 7920 6172 7261 792e  s a NumPy array.
-0001c0f0: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-0001c100: 2020 202d 2d2d 2d2d 2d2d 2d0a 0a20 2020     --------..   
-0001c110: 203e 3e3e 2078 203d 2068 3570 792e 4669   >>> x = h5py.Fi
-0001c120: 6c65 2827 2e2e 2e27 295b 272f 6461 7461  le('...')['/data
-0001c130: 2f70 6174 6827 5d20 2023 2064 6f63 7465  /path']  # docte
-0001c140: 7374 3a20 2b53 4b49 500a 2020 2020 3e3e  st: +SKIP.    >>
-0001c150: 3e20 6120 3d20 6461 2e66 726f 6d5f 6172  > a = da.from_ar
-0001c160: 7261 7928 782c 2063 6875 6e6b 733d 2831  ray(x, chunks=(1
-0001c170: 3030 302c 2031 3030 3029 2920 2023 2064  000, 1000))  # d
-0001c180: 6f63 7465 7374 3a20 2b53 4b49 500a 0a20  octest: +SKIP.. 
-0001c190: 2020 2049 6620 796f 7572 2075 6e64 6572     If your under
-0001c1a0: 6c79 696e 6720 6461 7461 7374 6f72 6520  lying datastore 
-0001c1b0: 646f 6573 206e 6f74 2073 7570 706f 7274  does not support
-0001c1c0: 2063 6f6e 6375 7272 656e 7420 7265 6164   concurrent read
-0001c1d0: 7320 7468 656e 2069 6e63 6c75 6465 0a20  s then include. 
-0001c1e0: 2020 2074 6865 2060 606c 6f63 6b3d 5472     the ``lock=Tr
-0001c1f0: 7565 6060 206b 6579 776f 7264 2061 7267  ue`` keyword arg
-0001c200: 756d 656e 7420 6f72 2060 606c 6f63 6b3d  ument or ``lock=
-0001c210: 6d79 6c6f 636b 6060 2069 6620 796f 7520  mylock`` if you 
-0001c220: 7761 6e74 206d 756c 7469 706c 650a 2020  want multiple.  
-0001c230: 2020 6172 7261 7973 2074 6f20 636f 6f72    arrays to coor
-0001c240: 6469 6e61 7465 2061 726f 756e 6420 7468  dinate around th
-0001c250: 6520 7361 6d65 206c 6f63 6b2e 0a0a 2020  e same lock...  
-0001c260: 2020 3e3e 3e20 6120 3d20 6461 2e66 726f    >>> a = da.fro
-0001c270: 6d5f 6172 7261 7928 782c 2063 6875 6e6b  m_array(x, chunk
-0001c280: 733d 2831 3030 302c 2031 3030 3029 2c20  s=(1000, 1000), 
-0001c290: 6c6f 636b 3d54 7275 6529 2020 2320 646f  lock=True)  # do
-0001c2a0: 6374 6573 743a 202b 534b 4950 0a0a 2020  ctest: +SKIP..  
-0001c2b0: 2020 4966 2079 6f75 7220 756e 6465 726c    If your underl
-0001c2c0: 7969 6e67 2064 6174 6173 746f 7265 2068  ying datastore h
-0001c2d0: 6173 2061 2060 602e 6368 756e 6b73 6060  as a ``.chunks``
-0001c2e0: 2061 7474 7269 6275 7465 2028 6173 2068   attribute (as h
-0001c2f0: 3570 7920 616e 6420 7a61 7272 0a20 2020  5py and zarr.   
-0001c300: 2064 6174 6173 6574 7320 646f 2920 7468   datasets do) th
-0001c310: 656e 2061 206d 756c 7469 706c 6520 6f66  en a multiple of
-0001c320: 2074 6861 7420 6368 756e 6b20 7368 6170   that chunk shap
-0001c330: 6520 7769 6c6c 2062 6520 7573 6564 2069  e will be used i
-0001c340: 6620 796f 750a 2020 2020 646f 206e 6f74  f you.    do not
-0001c350: 2070 726f 7669 6465 2061 2063 6875 6e6b   provide a chunk
-0001c360: 2073 6861 7065 2e0a 0a20 2020 203e 3e3e   shape...    >>>
-0001c370: 2061 203d 2064 612e 6672 6f6d 5f61 7272   a = da.from_arr
-0001c380: 6179 2878 2c20 6368 756e 6b73 3d27 6175  ay(x, chunks='au
-0001c390: 746f 2729 2020 2320 646f 6374 6573 743a  to')  # doctest:
-0001c3a0: 202b 534b 4950 0a20 2020 203e 3e3e 2061   +SKIP.    >>> a
-0001c3b0: 203d 2064 612e 6672 6f6d 5f61 7272 6179   = da.from_array
-0001c3c0: 2878 2c20 6368 756e 6b73 3d27 3130 3020  (x, chunks='100 
-0001c3d0: 4d69 4227 2920 2023 2064 6f63 7465 7374  MiB')  # doctest
-0001c3e0: 3a20 2b53 4b49 500a 2020 2020 3e3e 3e20  : +SKIP.    >>> 
-0001c3f0: 6120 3d20 6461 2e66 726f 6d5f 6172 7261  a = da.from_arra
-0001c400: 7928 7829 2020 2320 646f 6374 6573 743a  y(x)  # doctest:
-0001c410: 202b 534b 4950 0a0a 2020 2020 4966 2070   +SKIP..    If p
-0001c420: 726f 7669 6469 6e67 2061 206e 616d 652c  roviding a name,
-0001c430: 2065 6e73 7572 6520 7468 6174 2069 7420   ensure that it 
-0001c440: 6973 2075 6e69 7175 650a 0a20 2020 203e  is unique..    >
-0001c450: 3e3e 2069 6d70 6f72 7420 6461 736b 2e62  >> import dask.b
-0001c460: 6173 650a 2020 2020 3e3e 3e20 746f 6b65  ase.    >>> toke
-0001c470: 6e20 3d20 6461 736b 2e62 6173 652e 746f  n = dask.base.to
-0001c480: 6b65 6e69 7a65 2878 2920 2023 2064 6f63  kenize(x)  # doc
-0001c490: 7465 7374 3a20 2b53 4b49 500a 2020 2020  test: +SKIP.    
-0001c4a0: 3e3e 3e20 6120 3d20 6461 2e66 726f 6d5f  >>> a = da.from_
-0001c4b0: 6172 7261 7928 276d 7961 7272 6179 2d27  array('myarray-'
-0001c4c0: 202b 2074 6f6b 656e 2920 2023 2064 6f63   + token)  # doc
-0001c4d0: 7465 7374 3a20 2b53 4b49 500a 0a20 2020  test: +SKIP..   
-0001c4e0: 204e 756d 5079 206e 6461 7272 6179 7320   NumPy ndarrays 
-0001c4f0: 6172 6520 6561 6765 726c 7920 736c 6963  are eagerly slic
-0001c500: 6564 2061 6e64 2074 6865 6e20 656d 6265  ed and then embe
-0001c510: 6464 6564 2069 6e20 7468 6520 6772 6170  dded in the grap
-0001c520: 682e 0a0a 2020 2020 3e3e 3e20 696d 706f  h...    >>> impo
-0001c530: 7274 2064 6173 6b2e 6172 7261 790a 2020  rt dask.array.  
-0001c540: 2020 3e3e 3e20 6120 3d20 6461 736b 2e61    >>> a = dask.a
-0001c550: 7272 6179 2e66 726f 6d5f 6172 7261 7928  rray.from_array(
-0001c560: 6e70 2e61 7272 6179 285b 5b31 2c20 325d  np.array([[1, 2]
-0001c570: 2c20 5b33 2c20 345d 5d29 2c20 6368 756e  , [3, 4]]), chun
-0001c580: 6b73 3d28 312c 3129 290a 2020 2020 3e3e  ks=(1,1)).    >>
-0001c590: 3e20 612e 6461 736b 5b61 2e6e 616d 652c  > a.dask[a.name,
-0001c5a0: 2030 2c20 305d 5b30 5d0a 2020 2020 6172   0, 0][0].    ar
-0001c5b0: 7261 7928 5b31 5d29 0a0a 2020 2020 4368  ray([1])..    Ch
-0001c5c0: 756e 6b73 2077 6974 6820 6578 6163 746c  unks with exactl
-0001c5d0: 792d 7370 6563 6966 6965 642c 2064 6966  y-specified, dif
-0001c5e0: 6665 7265 6e74 2073 697a 6573 2063 616e  ferent sizes can
-0001c5f0: 2062 6520 6372 6561 7465 642e 0a0a 2020   be created...  
-0001c600: 2020 3e3e 3e20 696d 706f 7274 206e 756d    >>> import num
-0001c610: 7079 2061 7320 6e70 0a20 2020 203e 3e3e  py as np.    >>>
-0001c620: 2069 6d70 6f72 7420 6461 736b 2e61 7272   import dask.arr
-0001c630: 6179 2061 7320 6461 0a20 2020 203e 3e3e  ay as da.    >>>
-0001c640: 2072 6e67 203d 206e 702e 7261 6e64 6f6d   rng = np.random
-0001c650: 2e64 6566 6175 6c74 5f72 6e67 2829 0a20  .default_rng(). 
-0001c660: 2020 203e 3e3e 2078 203d 2072 6e67 2e72     >>> x = rng.r
-0001c670: 616e 646f 6d28 2831 3030 2c20 3629 290a  andom((100, 6)).
-0001c680: 2020 2020 3e3e 3e20 6120 3d20 6461 2e66      >>> a = da.f
-0001c690: 726f 6d5f 6172 7261 7928 782c 2063 6875  rom_array(x, chu
-0001c6a0: 6e6b 733d 2828 3637 2c20 3333 292c 2028  nks=((67, 33), (
-0001c6b0: 362c 2929 290a 2020 2020 2222 220a 2020  6,))).    """.  
-0001c6c0: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
-0001c6d0: 782c 2041 7272 6179 293a 0a20 2020 2020  x, Array):.     
-0001c6e0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-0001c6f0: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-0001c700: 2022 4172 7261 7920 6973 2061 6c72 6561   "Array is alrea
-0001c710: 6479 2061 2064 6173 6b20 6172 7261 792e  dy a dask array.
-0001c720: 2055 7365 2027 6173 6172 7261 7927 206f   Use 'asarray' o
-0001c730: 7220 2220 2227 7265 6368 756e 6b27 2069  r " "'rechunk' i
-0001c740: 6e73 7465 6164 2e22 0a20 2020 2020 2020  nstead.".       
-0001c750: 2029 0a20 2020 2065 6c69 6620 6973 5f64   ).    elif is_d
-0001c760: 6173 6b5f 636f 6c6c 6563 7469 6f6e 2878  ask_collection(x
-0001c770: 293a 0a20 2020 2020 2020 2077 6172 6e69  ):.        warni
-0001c780: 6e67 732e 7761 726e 280a 2020 2020 2020  ngs.warn(.      
-0001c790: 2020 2020 2020 2250 6173 7369 6e67 2061        "Passing a
-0001c7a0: 6e20 6f62 6a65 6374 2074 6f20 6461 736b  n object to dask
-0001c7b0: 2e61 7272 6179 2e66 726f 6d5f 6172 7261  .array.from_arra
-0001c7c0: 7920 7768 6963 6820 6973 2061 6c72 6561  y which is alrea
-0001c7d0: 6479 2061 2022 0a20 2020 2020 2020 2020  dy a ".         
-0001c7e0: 2020 2022 4461 736b 2063 6f6c 6c65 6374     "Dask collect
-0001c7f0: 696f 6e2e 2054 6869 7320 6361 6e20 6c65  ion. This can le
-0001c800: 6164 2074 6f20 756e 6578 7065 6374 6564  ad to unexpected
-0001c810: 2062 6568 6176 696f 722e 220a 2020 2020   behavior.".    
-0001c820: 2020 2020 290a 0a20 2020 2069 6620 6973      )..    if is
-0001c830: 696e 7374 616e 6365 2878 2c20 286c 6973  instance(x, (lis
-0001c840: 742c 2074 7570 6c65 2c20 6d65 6d6f 7279  t, tuple, memory
-0001c850: 7669 6577 2920 2b20 6e70 2e53 6361 6c61  view) + np.Scala
-0001c860: 7254 7970 6529 3a0a 2020 2020 2020 2020  rType):.        
-0001c870: 7820 3d20 6e70 2e61 7272 6179 2878 290a  x = np.array(x).
-0001c880: 0a20 2020 2069 6620 6173 6172 7261 7920  .    if asarray 
-0001c890: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-0001c8a0: 2061 7361 7272 6179 203d 206e 6f74 2068   asarray = not h
-0001c8b0: 6173 6174 7472 2878 2c20 225f 5f61 7272  asattr(x, "__arr
-0001c8c0: 6179 5f66 756e 6374 696f 6e5f 5f22 290a  ay_function__").
-0001c8d0: 0a20 2020 2070 7265 7669 6f75 735f 6368  .    previous_ch
-0001c8e0: 756e 6b73 203d 2067 6574 6174 7472 2878  unks = getattr(x
-0001c8f0: 2c20 2263 6875 6e6b 7322 2c20 4e6f 6e65  , "chunks", None
-0001c900: 290a 0a20 2020 2063 6875 6e6b 7320 3d20  )..    chunks = 
-0001c910: 6e6f 726d 616c 697a 655f 6368 756e 6b73  normalize_chunks
-0001c920: 280a 2020 2020 2020 2020 6368 756e 6b73  (.        chunks
-0001c930: 2c20 782e 7368 6170 652c 2064 7479 7065  , x.shape, dtype
-0001c940: 3d78 2e64 7479 7065 2c20 7072 6576 696f  =x.dtype, previo
-0001c950: 7573 5f63 6875 6e6b 733d 7072 6576 696f  us_chunks=previo
-0001c960: 7573 5f63 6875 6e6b 730a 2020 2020 290a  us_chunks.    ).
-0001c970: 0a20 2020 2069 6620 6e61 6d65 2069 6e20  .    if name in 
-0001c980: 284e 6f6e 652c 2054 7275 6529 3a0a 2020  (None, True):.  
-0001c990: 2020 2020 2020 746f 6b65 6e20 3d20 746f        token = to
-0001c9a0: 6b65 6e69 7a65 2878 2c20 6368 756e 6b73  kenize(x, chunks
-0001c9b0: 2c20 6c6f 636b 2c20 6173 6172 7261 792c  , lock, asarray,
-0001c9c0: 2066 616e 6379 2c20 6765 7469 7465 6d2c   fancy, getitem,
-0001c9d0: 2069 6e6c 696e 655f 6172 7261 7929 0a20   inline_array). 
-0001c9e0: 2020 2020 2020 206e 616d 6520 3d20 6e61         name = na
-0001c9f0: 6d65 206f 7220 2261 7272 6179 2d22 202b  me or "array-" +
-0001ca00: 2074 6f6b 656e 0a20 2020 2065 6c69 6620   token.    elif 
-0001ca10: 6e61 6d65 2069 7320 4661 6c73 653a 0a20  name is False:. 
-0001ca20: 2020 2020 2020 206e 616d 6520 3d20 2261         name = "a
-0001ca30: 7272 6179 2d22 202b 2073 7472 2875 7569  rray-" + str(uui
-0001ca40: 642e 7575 6964 3128 2929 0a0a 2020 2020  d.uuid1())..    
-0001ca50: 6966 206c 6f63 6b20 6973 2054 7275 653a  if lock is True:
-0001ca60: 0a20 2020 2020 2020 206c 6f63 6b20 3d20  .        lock = 
-0001ca70: 5365 7269 616c 697a 6162 6c65 4c6f 636b  SerializableLock
-0001ca80: 2829 0a0a 2020 2020 6973 5f6e 6461 7272  ()..    is_ndarr
-0001ca90: 6179 203d 2074 7970 6528 7829 2069 6e20  ay = type(x) in 
-0001caa0: 286e 702e 6e64 6172 7261 792c 206e 702e  (np.ndarray, np.
-0001cab0: 6d61 2e63 6f72 652e 4d61 736b 6564 4172  ma.core.MaskedAr
-0001cac0: 7261 7929 0a20 2020 2069 735f 7369 6e67  ray).    is_sing
-0001cad0: 6c65 5f62 6c6f 636b 203d 2061 6c6c 286c  le_block = all(l
-0001cae0: 656e 2863 2920 3d3d 2031 2066 6f72 2063  en(c) == 1 for c
-0001caf0: 2069 6e20 6368 756e 6b73 290a 2020 2020   in chunks).    
-0001cb00: 2320 416c 7761 7973 2075 7365 2074 6865  # Always use the
-0001cb10: 2067 6574 7465 7220 666f 7220 6835 7079   getter for h5py
-0001cb20: 2065 7463 2e20 4e6f 7420 7573 696e 6720   etc. Not using 
-0001cb30: 6973 696e 7374 616e 6365 2878 2c20 6e70  isinstance(x, np
-0001cb40: 2e6e 6461 7272 6179 290a 2020 2020 2320  .ndarray).    # 
-0001cb50: 6265 6361 7573 6520 6e70 2e6d 6174 7269  because np.matri
-0001cb60: 7820 6973 2061 2073 7562 636c 6173 7320  x is a subclass 
-0001cb70: 6f66 206e 702e 6e64 6172 7261 792e 0a20  of np.ndarray.. 
-0001cb80: 2020 2069 6620 6973 5f6e 6461 7272 6179     if is_ndarray
-0001cb90: 2061 6e64 206e 6f74 2069 735f 7369 6e67   and not is_sing
-0001cba0: 6c65 5f62 6c6f 636b 2061 6e64 206e 6f74  le_block and not
-0001cbb0: 206c 6f63 6b3a 0a20 2020 2020 2020 2023   lock:.        #
-0001cbc0: 2065 6167 6572 6c79 2073 6c69 6365 206e   eagerly slice n
-0001cbd0: 756d 7079 2061 7272 6179 7320 746f 2070  umpy arrays to p
-0001cbe0: 7265 7665 6e74 206d 656d 6f72 7920 626c  revent memory bl
-0001cbf0: 6f77 7570 0a20 2020 2020 2020 2023 2047  owup.        # G
-0001cc00: 4835 3336 372c 2047 4835 3630 310a 2020  H5367, GH5601.  
-0001cc10: 2020 2020 2020 736c 6963 6573 203d 2073        slices = s
-0001cc20: 6c69 6365 735f 6672 6f6d 5f63 6875 6e6b  lices_from_chunk
-0001cc30: 7328 6368 756e 6b73 290a 2020 2020 2020  s(chunks).      
-0001cc40: 2020 6b65 7973 203d 2070 726f 6475 6374    keys = product
-0001cc50: 285b 6e61 6d65 5d2c 202a 2872 616e 6765  ([name], *(range
-0001cc60: 286c 656e 2862 6473 2929 2066 6f72 2062  (len(bds)) for b
-0001cc70: 6473 2069 6e20 6368 756e 6b73 2929 0a20  ds in chunks)). 
-0001cc80: 2020 2020 2020 2076 616c 7565 7320 3d20         values = 
-0001cc90: 5b78 5b73 6c63 5d20 666f 7220 736c 6320  [x[slc] for slc 
-0001cca0: 696e 2073 6c69 6365 735d 0a20 2020 2020  in slices].     
-0001ccb0: 2020 2064 736b 203d 2064 6963 7428 7a69     dsk = dict(zi
-0001ccc0: 7028 6b65 7973 2c20 7661 6c75 6573 2929  p(keys, values))
-0001ccd0: 0a0a 2020 2020 656c 6966 2069 735f 6e64  ..    elif is_nd
-0001cce0: 6172 7261 7920 616e 6420 6973 5f73 696e  array and is_sin
-0001ccf0: 676c 655f 626c 6f63 6b3a 0a20 2020 2020  gle_block:.     
-0001cd00: 2020 2023 204e 6f20 736c 6963 696e 6720     # No slicing 
-0001cd10: 6e65 6564 6564 0a20 2020 2020 2020 2064  needed.        d
-0001cd20: 736b 203d 207b 286e 616d 652c 2920 2b20  sk = {(name,) + 
-0001cd30: 2830 2c29 202a 2078 2e6e 6469 6d3a 2078  (0,) * x.ndim: x
-0001cd40: 7d0a 2020 2020 656c 7365 3a0a 2020 2020  }.    else:.    
-0001cd50: 2020 2020 6966 2067 6574 6974 656d 2069      if getitem i
-0001cd60: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0001cd70: 2020 2020 6966 2066 616e 6379 3a0a 2020      if fancy:.  
-0001cd80: 2020 2020 2020 2020 2020 2020 2020 6765                ge
-0001cd90: 7469 7465 6d20 3d20 6765 7474 6572 0a20  titem = getter. 
-0001cda0: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0001cdb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001cdc0: 2067 6574 6974 656d 203d 2067 6574 7465   getitem = gette
-0001cdd0: 725f 6e6f 6661 6e63 790a 0a20 2020 2020  r_nofancy..     
-0001cde0: 2020 2064 736b 203d 2067 7261 7068 5f66     dsk = graph_f
-0001cdf0: 726f 6d5f 6172 7261 796c 696b 6528 0a20  rom_arraylike(. 
-0001ce00: 2020 2020 2020 2020 2020 2078 2c0a 2020             x,.  
-0001ce10: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
-0001ce20: 2c0a 2020 2020 2020 2020 2020 2020 782e  ,.            x.
-0001ce30: 7368 6170 652c 0a20 2020 2020 2020 2020  shape,.         
-0001ce40: 2020 206e 616d 652c 0a20 2020 2020 2020     name,.       
-0001ce50: 2020 2020 2067 6574 6974 656d 3d67 6574       getitem=get
-0001ce60: 6974 656d 2c0a 2020 2020 2020 2020 2020  item,.          
-0001ce70: 2020 6c6f 636b 3d6c 6f63 6b2c 0a20 2020    lock=lock,.   
-0001ce80: 2020 2020 2020 2020 2061 7361 7272 6179           asarray
-0001ce90: 3d61 7361 7272 6179 2c0a 2020 2020 2020  =asarray,.      
-0001cea0: 2020 2020 2020 6474 7970 653d 782e 6474        dtype=x.dt
-0001ceb0: 7970 652c 0a20 2020 2020 2020 2020 2020  ype,.           
-0001cec0: 2069 6e6c 696e 655f 6172 7261 793d 696e   inline_array=in
-0001ced0: 6c69 6e65 5f61 7272 6179 2c0a 2020 2020  line_array,.    
-0001cee0: 2020 2020 290a 0a20 2020 2023 2057 6f72      )..    # Wor
-0001cef0: 6b61 726f 756e 6420 666f 7220 5469 6c65  karound for Tile
-0001cf00: 4442 2c20 6974 7320 696e 6465 7869 6e67  DB, its indexing
-0001cf10: 2069 7320 312d 6261 7365 642c 0a20 2020   is 1-based,.   
-0001cf20: 2023 2061 6e64 2064 6f65 736e 2774 2073   # and doesn't s
-0001cf30: 6565 6d73 2074 6f20 7375 7070 6f72 7420  eems to support 
-0001cf40: 302d 6c65 6e67 7468 2073 6c69 6369 6e67  0-length slicing
-0001cf50: 0a20 2020 2069 6620 782e 5f5f 636c 6173  .    if x.__clas
-0001cf60: 735f 5f2e 5f5f 6d6f 6475 6c65 5f5f 2e73  s__.__module__.s
-0001cf70: 706c 6974 2822 2e22 295b 305d 203d 3d20  plit(".")[0] == 
-0001cf80: 2274 696c 6564 6222 2061 6e64 2068 6173  "tiledb" and has
-0001cf90: 6174 7472 2878 2c20 225f 6374 785f 2229  attr(x, "_ctx_")
-0001cfa0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
-0001cfb0: 2041 7272 6179 2864 736b 2c20 6e61 6d65   Array(dsk, name
-0001cfc0: 2c20 6368 756e 6b73 2c20 6474 7970 653d  , chunks, dtype=
-0001cfd0: 782e 6474 7970 6529 0a0a 2020 2020 6966  x.dtype)..    if
-0001cfe0: 206d 6574 6120 6973 204e 6f6e 653a 0a20   meta is None:. 
-0001cff0: 2020 2020 2020 206d 6574 6120 3d20 780a         meta = x.
-0001d000: 0a20 2020 2072 6574 7572 6e20 4172 7261  .    return Arra
-0001d010: 7928 6473 6b2c 206e 616d 652c 2063 6875  y(dsk, name, chu
-0001d020: 6e6b 732c 206d 6574 613d 6d65 7461 2c20  nks, meta=meta, 
-0001d030: 6474 7970 653d 6765 7461 7474 7228 782c  dtype=getattr(x,
-0001d040: 2022 6474 7970 6522 2c20 4e6f 6e65 2929   "dtype", None))
-0001d050: 0a0a 0a64 6566 2066 726f 6d5f 7a61 7272  ...def from_zarr
-0001d060: 280a 2020 2020 7572 6c2c 0a20 2020 2063  (.    url,.    c
-0001d070: 6f6d 706f 6e65 6e74 3d4e 6f6e 652c 0a20  omponent=None,. 
-0001d080: 2020 2073 746f 7261 6765 5f6f 7074 696f     storage_optio
-0001d090: 6e73 3d4e 6f6e 652c 0a20 2020 2063 6875  ns=None,.    chu
-0001d0a0: 6e6b 733d 4e6f 6e65 2c0a 2020 2020 6e61  nks=None,.    na
-0001d0b0: 6d65 3d4e 6f6e 652c 0a20 2020 2069 6e6c  me=None,.    inl
-0001d0c0: 696e 655f 6172 7261 793d 4661 6c73 652c  ine_array=False,
-0001d0d0: 0a20 2020 202a 2a6b 7761 7267 732c 0a29  .    **kwargs,.)
-0001d0e0: 3a0a 2020 2020 2222 224c 6f61 6420 6172  :.    """Load ar
-0001d0f0: 7261 7920 6672 6f6d 2074 6865 207a 6172  ray from the zar
-0001d100: 7220 7374 6f72 6167 6520 666f 726d 6174  r storage format
-0001d110: 0a0a 2020 2020 5365 6520 6874 7470 733a  ..    See https:
-0001d120: 2f2f 7a61 7272 2e72 6561 6474 6865 646f  //zarr.readthedo
-0001d130: 6373 2e69 6f20 666f 7220 6465 7461 696c  cs.io for detail
-0001d140: 7320 6162 6f75 7420 7468 6520 666f 726d  s about the form
-0001d150: 6174 2e0a 0a20 2020 2050 6172 616d 6574  at...    Paramet
-0001d160: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-0001d170: 2d2d 0a20 2020 2075 726c 3a20 5a61 7272  --.    url: Zarr
-0001d180: 2041 7272 6179 206f 7220 7374 7220 6f72   Array or str or
-0001d190: 204d 7574 6162 6c65 4d61 7070 696e 670a   MutableMapping.
-0001d1a0: 2020 2020 2020 2020 4c6f 6361 7469 6f6e          Location
-0001d1b0: 206f 6620 7468 6520 6461 7461 2e20 4120   of the data. A 
-0001d1c0: 5552 4c20 6361 6e20 696e 636c 7564 6520  URL can include 
-0001d1d0: 6120 7072 6f74 6f63 6f6c 2073 7065 6369  a protocol speci
-0001d1e0: 6669 6572 206c 696b 6520 7333 3a2f 2f0a  fier like s3://.
-0001d1f0: 2020 2020 2020 2020 666f 7220 7265 6d6f          for remo
-0001d200: 7465 2064 6174 612e 2043 616e 2061 6c73  te data. Can als
-0001d210: 6f20 6265 2061 6e79 204d 7574 6162 6c65  o be any Mutable
-0001d220: 4d61 7070 696e 6720 696e 7374 616e 6365  Mapping instance
-0001d230: 2c20 7768 6963 6820 7368 6f75 6c64 0a20  , which should. 
-0001d240: 2020 2020 2020 2062 6520 7365 7269 616c         be serial
-0001d250: 697a 6162 6c65 2069 6620 7573 6564 2069  izable if used i
-0001d260: 6e20 6d75 6c74 6970 6c65 2070 726f 6365  n multiple proce
-0001d270: 7373 6573 2e0a 2020 2020 636f 6d70 6f6e  sses..    compon
-0001d280: 656e 743a 2073 7472 206f 7220 4e6f 6e65  ent: str or None
-0001d290: 0a20 2020 2020 2020 2049 6620 7468 6520  .        If the 
-0001d2a0: 6c6f 6361 7469 6f6e 2069 7320 6120 7a61  location is a za
-0001d2b0: 7272 2067 726f 7570 2072 6174 6865 7220  rr group rather 
-0001d2c0: 7468 616e 2061 6e20 6172 7261 792c 2074  than an array, t
-0001d2d0: 6869 7320 6973 2074 6865 0a20 2020 2020  his is the.     
-0001d2e0: 2020 2073 7562 636f 6d70 6f6e 656e 7420     subcomponent 
-0001d2f0: 7468 6174 2073 686f 756c 6420 6265 206c  that should be l
-0001d300: 6f61 6465 642c 2073 6f6d 6574 6869 6e67  oaded, something
-0001d310: 206c 696b 6520 6060 2766 6f6f 2f62 6172   like ``'foo/bar
-0001d320: 2760 602e 0a20 2020 2073 746f 7261 6765  '``..    storage
-0001d330: 5f6f 7074 696f 6e73 3a20 6469 6374 0a20  _options: dict. 
-0001d340: 2020 2020 2020 2041 6e79 2061 6464 6974         Any addit
-0001d350: 696f 6e61 6c20 7061 7261 6d65 7465 7273  ional parameters
-0001d360: 2066 6f72 2074 6865 2073 746f 7261 6765   for the storage
-0001d370: 2062 6163 6b65 6e64 2028 6967 6e6f 7265   backend (ignore
-0001d380: 6420 666f 7220 6c6f 6361 6c0a 2020 2020  d for local.    
-0001d390: 2020 2020 7061 7468 7329 0a20 2020 2063      paths).    c
-0001d3a0: 6875 6e6b 733a 2074 7570 6c65 206f 6620  hunks: tuple of 
-0001d3b0: 696e 7473 206f 7220 7475 706c 6573 206f  ints or tuples o
-0001d3c0: 6620 696e 7473 0a20 2020 2020 2020 2050  f ints.        P
-0001d3d0: 6173 7365 6420 746f 203a 6675 6e63 3a60  assed to :func:`
-0001d3e0: 6461 736b 2e61 7272 6179 2e66 726f 6d5f  dask.array.from_
-0001d3f0: 6172 7261 7960 2c20 616c 6c6f 7773 2073  array`, allows s
-0001d400: 6574 7469 6e67 2074 6865 2063 6875 6e6b  etting the chunk
-0001d410: 7320 6f6e 0a20 2020 2020 2020 2069 6e69  s on.        ini
-0001d420: 7469 616c 6973 6174 696f 6e2c 2069 6620  tialisation, if 
-0001d430: 7468 6520 6368 756e 6b69 6e67 2073 6368  the chunking sch
-0001d440: 656d 6520 696e 2074 6865 206f 6e2d 6469  eme in the on-di
-0001d450: 7363 2064 6174 6173 6574 2069 7320 6e6f  sc dataset is no
-0001d460: 740a 2020 2020 2020 2020 6f70 7469 6d61  t.        optima
-0001d470: 6c20 666f 7220 7468 6520 6361 6c63 756c  l for the calcul
-0001d480: 6174 696f 6e73 2074 6f20 666f 6c6c 6f77  ations to follow
-0001d490: 2e0a 2020 2020 6e61 6d65 203a 2073 7472  ..    name : str
-0001d4a0: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
-0001d4b0: 2020 2020 416e 206f 7074 696f 6e61 6c20      An optional 
-0001d4c0: 6b65 796e 616d 6520 666f 7220 7468 6520  keyname for the 
-0001d4d0: 6172 7261 792e 2020 4465 6661 756c 7473  array.  Defaults
-0001d4e0: 2074 6f20 6861 7368 696e 6720 7468 6520   to hashing the 
-0001d4f0: 696e 7075 740a 2020 2020 6b77 6172 6773  input.    kwargs
-0001d500: 3a0a 2020 2020 2020 2020 5061 7373 6564  :.        Passed
-0001d510: 2074 6f20 3a63 6c61 7373 3a60 7a61 7272   to :class:`zarr
-0001d520: 2e63 6f72 652e 4172 7261 7960 2e0a 2020  .core.Array`..  
-0001d530: 2020 696e 6c69 6e65 5f61 7272 6179 203a    inline_array :
-0001d540: 2062 6f6f 6c2c 2064 6566 6175 6c74 2046   bool, default F
-0001d550: 616c 7365 0a20 2020 2020 2020 2057 6865  alse.        Whe
-0001d560: 7468 6572 2074 6f20 696e 6c69 6e65 2074  ther to inline t
-0001d570: 6865 207a 6172 7220 4172 7261 7920 696e  he zarr Array in
-0001d580: 2074 6865 2076 616c 7565 7320 6f66 2074   the values of t
-0001d590: 6865 2074 6173 6b20 6772 6170 682e 0a20  he task graph.. 
-0001d5a0: 2020 2020 2020 2053 6565 203a 6d65 7468         See :meth
-0001d5b0: 3a60 6461 736b 2e61 7272 6179 2e66 726f  :`dask.array.fro
-0001d5c0: 6d5f 6172 7261 7960 2066 6f72 2061 6e20  m_array` for an 
-0001d5d0: 6578 706c 616e 6174 696f 6e2e 0a0a 2020  explanation...  
-0001d5e0: 2020 5365 6520 416c 736f 0a20 2020 202d    See Also.    -
-0001d5f0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6672 6f6d  -------.    from
-0001d600: 5f61 7272 6179 0a20 2020 2022 2222 0a20  _array.    """. 
-0001d610: 2020 2069 6d70 6f72 7420 7a61 7272 0a0a     import zarr..
-0001d620: 2020 2020 7374 6f72 6167 655f 6f70 7469      storage_opti
-0001d630: 6f6e 7320 3d20 7374 6f72 6167 655f 6f70  ons = storage_op
-0001d640: 7469 6f6e 7320 6f72 207b 7d0a 2020 2020  tions or {}.    
-0001d650: 6966 2069 7369 6e73 7461 6e63 6528 7572  if isinstance(ur
-0001d660: 6c2c 207a 6172 722e 4172 7261 7929 3a0a  l, zarr.Array):.
-0001d670: 2020 2020 2020 2020 7a20 3d20 7572 6c0a          z = url.
-0001d680: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-0001d690: 6e63 6528 7572 6c2c 2028 7374 722c 206f  nce(url, (str, o
-0001d6a0: 732e 5061 7468 4c69 6b65 2929 3a0a 2020  s.PathLike)):.  
-0001d6b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-0001d6c0: 6e63 6528 7572 6c2c 206f 732e 5061 7468  nce(url, os.Path
-0001d6d0: 4c69 6b65 293a 0a20 2020 2020 2020 2020  Like):.         
-0001d6e0: 2020 2075 726c 203d 206f 732e 6673 7061     url = os.fspa
-0001d6f0: 7468 2875 726c 290a 2020 2020 2020 2020  th(url).        
-0001d700: 6966 2073 746f 7261 6765 5f6f 7074 696f  if storage_optio
-0001d710: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-0001d720: 7374 6f72 6520 3d20 7a61 7272 2e73 746f  store = zarr.sto
-0001d730: 7261 6765 2e46 5353 746f 7265 2875 726c  rage.FSStore(url
-0001d740: 2c20 2a2a 7374 6f72 6167 655f 6f70 7469  , **storage_opti
-0001d750: 6f6e 7329 0a20 2020 2020 2020 2065 6c73  ons).        els
-0001d760: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-0001d770: 746f 7265 203d 2075 726c 0a20 2020 2020  tore = url.     
-0001d780: 2020 207a 203d 207a 6172 722e 4172 7261     z = zarr.Arra
-0001d790: 7928 7374 6f72 652c 2072 6561 645f 6f6e  y(store, read_on
-0001d7a0: 6c79 3d54 7275 652c 2070 6174 683d 636f  ly=True, path=co
-0001d7b0: 6d70 6f6e 656e 742c 202a 2a6b 7761 7267  mponent, **kwarg
-0001d7c0: 7329 0a20 2020 2065 6c73 653a 0a20 2020  s).    else:.   
-0001d7d0: 2020 2020 207a 203d 207a 6172 722e 4172       z = zarr.Ar
-0001d7e0: 7261 7928 7572 6c2c 2072 6561 645f 6f6e  ray(url, read_on
-0001d7f0: 6c79 3d54 7275 652c 2070 6174 683d 636f  ly=True, path=co
-0001d800: 6d70 6f6e 656e 742c 202a 2a6b 7761 7267  mponent, **kwarg
-0001d810: 7329 0a20 2020 2063 6875 6e6b 7320 3d20  s).    chunks = 
-0001d820: 6368 756e 6b73 2069 6620 6368 756e 6b73  chunks if chunks
-0001d830: 2069 7320 6e6f 7420 4e6f 6e65 2065 6c73   is not None els
-0001d840: 6520 7a2e 6368 756e 6b73 0a20 2020 2069  e z.chunks.    i
-0001d850: 6620 6e61 6d65 2069 7320 4e6f 6e65 3a0a  f name is None:.
-0001d860: 2020 2020 2020 2020 6e61 6d65 203d 2022          name = "
-0001d870: 6672 6f6d 2d7a 6172 722d 2220 2b20 746f  from-zarr-" + to
-0001d880: 6b65 6e69 7a65 287a 2c20 636f 6d70 6f6e  kenize(z, compon
-0001d890: 656e 742c 2073 746f 7261 6765 5f6f 7074  ent, storage_opt
-0001d8a0: 696f 6e73 2c20 6368 756e 6b73 2c20 2a2a  ions, chunks, **
-0001d8b0: 6b77 6172 6773 290a 2020 2020 7265 7475  kwargs).    retu
-0001d8c0: 726e 2066 726f 6d5f 6172 7261 7928 7a2c  rn from_array(z,
-0001d8d0: 2063 6875 6e6b 732c 206e 616d 653d 6e61   chunks, name=na
-0001d8e0: 6d65 2c20 696e 6c69 6e65 5f61 7272 6179  me, inline_array
-0001d8f0: 3d69 6e6c 696e 655f 6172 7261 7929 0a0a  =inline_array)..
-0001d900: 0a64 6566 2074 6f5f 7a61 7272 280a 2020  .def to_zarr(.  
-0001d910: 2020 6172 722c 0a20 2020 2075 726c 2c0a    arr,.    url,.
-0001d920: 2020 2020 636f 6d70 6f6e 656e 743d 4e6f      component=No
-0001d930: 6e65 2c0a 2020 2020 7374 6f72 6167 655f  ne,.    storage_
-0001d940: 6f70 7469 6f6e 733d 4e6f 6e65 2c0a 2020  options=None,.  
-0001d950: 2020 6f76 6572 7772 6974 653d 4661 6c73    overwrite=Fals
-0001d960: 652c 0a20 2020 2072 6567 696f 6e3d 4e6f  e,.    region=No
-0001d970: 6e65 2c0a 2020 2020 636f 6d70 7574 653d  ne,.    compute=
-0001d980: 5472 7565 2c0a 2020 2020 7265 7475 726e  True,.    return
-0001d990: 5f73 746f 7265 643d 4661 6c73 652c 0a20  _stored=False,. 
-0001d9a0: 2020 202a 2a6b 7761 7267 732c 0a29 3a0a     **kwargs,.):.
-0001d9b0: 2020 2020 2222 2253 6176 6520 6172 7261      """Save arra
-0001d9c0: 7920 746f 2074 6865 207a 6172 7220 7374  y to the zarr st
-0001d9d0: 6f72 6167 6520 666f 726d 6174 0a0a 2020  orage format..  
-0001d9e0: 2020 5365 6520 6874 7470 733a 2f2f 7a61    See https://za
-0001d9f0: 7272 2e72 6561 6474 6865 646f 6373 2e69  rr.readthedocs.i
-0001da00: 6f20 666f 7220 6465 7461 696c 7320 6162  o for details ab
-0001da10: 6f75 7420 7468 6520 666f 726d 6174 2e0a  out the format..
-0001da20: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
-0001da30: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
-0001da40: 2020 2061 7272 3a20 6461 736b 2e61 7272     arr: dask.arr
-0001da50: 6179 0a20 2020 2020 2020 2044 6174 6120  ay.        Data 
-0001da60: 746f 2073 746f 7265 0a20 2020 2075 726c  to store.    url
-0001da70: 3a20 5a61 7272 2041 7272 6179 206f 7220  : Zarr Array or 
-0001da80: 7374 7220 6f72 204d 7574 6162 6c65 4d61  str or MutableMa
-0001da90: 7070 696e 670a 2020 2020 2020 2020 4c6f  pping.        Lo
-0001daa0: 6361 7469 6f6e 206f 6620 7468 6520 6461  cation of the da
-0001dab0: 7461 2e20 4120 5552 4c20 6361 6e20 696e  ta. A URL can in
-0001dac0: 636c 7564 6520 6120 7072 6f74 6f63 6f6c  clude a protocol
-0001dad0: 2073 7065 6369 6669 6572 206c 696b 6520   specifier like 
-0001dae0: 7333 3a2f 2f0a 2020 2020 2020 2020 666f  s3://.        fo
-0001daf0: 7220 7265 6d6f 7465 2064 6174 612e 2043  r remote data. C
-0001db00: 616e 2061 6c73 6f20 6265 2061 6e79 204d  an also be any M
-0001db10: 7574 6162 6c65 4d61 7070 696e 6720 696e  utableMapping in
-0001db20: 7374 616e 6365 2c20 7768 6963 6820 7368  stance, which sh
-0001db30: 6f75 6c64 0a20 2020 2020 2020 2062 6520  ould.        be 
-0001db40: 7365 7269 616c 697a 6162 6c65 2069 6620  serializable if 
-0001db50: 7573 6564 2069 6e20 6d75 6c74 6970 6c65  used in multiple
-0001db60: 2070 726f 6365 7373 6573 2e0a 2020 2020   processes..    
-0001db70: 636f 6d70 6f6e 656e 743a 2073 7472 206f  component: str o
-0001db80: 7220 4e6f 6e65 0a20 2020 2020 2020 2049  r None.        I
-0001db90: 6620 7468 6520 6c6f 6361 7469 6f6e 2069  f the location i
-0001dba0: 7320 6120 7a61 7272 2067 726f 7570 2072  s a zarr group r
-0001dbb0: 6174 6865 7220 7468 616e 2061 6e20 6172  ather than an ar
-0001dbc0: 7261 792c 2074 6869 7320 6973 2074 6865  ray, this is the
-0001dbd0: 0a20 2020 2020 2020 2073 7562 636f 6d70  .        subcomp
-0001dbe0: 6f6e 656e 7420 7468 6174 2073 686f 756c  onent that shoul
-0001dbf0: 6420 6265 2063 7265 6174 6564 2f6f 7665  d be created/ove
-0001dc00: 722d 7772 6974 7465 6e2e 0a20 2020 2073  r-written..    s
-0001dc10: 746f 7261 6765 5f6f 7074 696f 6e73 3a20  torage_options: 
-0001dc20: 6469 6374 0a20 2020 2020 2020 2041 6e79  dict.        Any
-0001dc30: 2061 6464 6974 696f 6e61 6c20 7061 7261   additional para
-0001dc40: 6d65 7465 7273 2066 6f72 2074 6865 2073  meters for the s
-0001dc50: 746f 7261 6765 2062 6163 6b65 6e64 2028  torage backend (
-0001dc60: 6967 6e6f 7265 6420 666f 7220 6c6f 6361  ignored for loca
-0001dc70: 6c0a 2020 2020 2020 2020 7061 7468 7329  l.        paths)
-0001dc80: 0a20 2020 206f 7665 7277 7269 7465 3a20  .    overwrite: 
-0001dc90: 626f 6f6c 0a20 2020 2020 2020 2049 6620  bool.        If 
-0001dca0: 6769 7665 6e20 6172 7261 7920 616c 7265  given array alre
-0001dcb0: 6164 7920 6578 6973 7473 2c20 6f76 6572  ady exists, over
-0001dcc0: 7772 6974 653d 4661 6c73 6520 7769 6c6c  write=False will
-0001dcd0: 2063 6175 7365 2061 6e20 6572 726f 722c   cause an error,
-0001dce0: 0a20 2020 2020 2020 2077 6865 7265 206f  .        where o
-0001dcf0: 7665 7277 7269 7465 3d54 7275 6520 7769  verwrite=True wi
-0001dd00: 6c6c 2072 6570 6c61 6365 2074 6865 2065  ll replace the e
-0001dd10: 7869 7374 696e 6720 6461 7461 2e0a 2020  xisting data..  
-0001dd20: 2020 7265 6769 6f6e 3a20 7475 706c 6520    region: tuple 
-0001dd30: 6f66 2073 6c69 6365 7320 6f72 204e 6f6e  of slices or Non
-0001dd40: 650a 2020 2020 2020 2020 5468 6520 7265  e.        The re
-0001dd50: 6769 6f6e 206f 6620 6461 7461 2074 6861  gion of data tha
-0001dd60: 7420 7368 6f75 6c64 2062 6520 7772 6974  t should be writ
-0001dd70: 7465 6e20 6966 2060 6075 726c 6060 2069  ten if ``url`` i
-0001dd80: 7320 6120 7a61 7272 2e41 7272 6179 2e0a  s a zarr.Array..
-0001dd90: 2020 2020 2020 2020 4e6f 7420 746f 2062          Not to b
-0001dda0: 6520 7573 6564 2077 6974 6820 6f74 6865  e used with othe
-0001ddb0: 7220 7479 7065 7320 6f66 2060 6075 726c  r types of ``url
-0001ddc0: 6060 2e0a 2020 2020 636f 6d70 7574 653a  ``..    compute:
-0001ddd0: 2062 6f6f 6c0a 2020 2020 2020 2020 5365   bool.        Se
-0001dde0: 6520 3a66 756e 633a 607e 6461 736b 2e61  e :func:`~dask.a
-0001ddf0: 7272 6179 2e73 746f 7265 6020 666f 7220  rray.store` for 
-0001de00: 6d6f 7265 2064 6574 6169 6c73 2e0a 2020  more details..  
-0001de10: 2020 7265 7475 726e 5f73 746f 7265 643a    return_stored:
-0001de20: 2062 6f6f 6c0a 2020 2020 2020 2020 5365   bool.        Se
-0001de30: 6520 3a66 756e 633a 607e 6461 736b 2e61  e :func:`~dask.a
-0001de40: 7272 6179 2e73 746f 7265 6020 666f 7220  rray.store` for 
-0001de50: 6d6f 7265 2064 6574 6169 6c73 2e0a 2020  more details..  
-0001de60: 2020 2a2a 6b77 6172 6773 3a0a 2020 2020    **kwargs:.    
-0001de70: 2020 2020 5061 7373 6564 2074 6f20 7468      Passed to th
-0001de80: 6520 3a66 756e 633a 607a 6172 722e 6372  e :func:`zarr.cr
-0001de90: 6561 7469 6f6e 2e63 7265 6174 6560 2066  eation.create` f
-0001dea0: 756e 6374 696f 6e2c 2065 2e67 2e2c 2063  unction, e.g., c
-0001deb0: 6f6d 7072 6573 7369 6f6e 206f 7074 696f  ompression optio
-0001dec0: 6e73 2e0a 0a20 2020 2052 6169 7365 730a  ns...    Raises.
-0001ded0: 2020 2020 2d2d 2d2d 2d2d 0a20 2020 2056      ------.    V
-0001dee0: 616c 7565 4572 726f 720a 2020 2020 2020  alueError.      
-0001def0: 2020 4966 2060 6061 7272 6060 2068 6173    If ``arr`` has
-0001df00: 2075 6e6b 6e6f 776e 2063 6875 6e6b 2073   unknown chunk s
-0001df10: 697a 6573 2c20 7768 6963 6820 6973 206e  izes, which is n
-0001df20: 6f74 2073 7570 706f 7274 6564 2062 7920  ot supported by 
-0001df30: 5a61 7272 2e0a 2020 2020 2020 2020 4966  Zarr..        If
-0001df40: 2060 6072 6567 696f 6e60 6020 6973 2073   ``region`` is s
-0001df50: 7065 6369 6669 6564 2061 6e64 2060 6075  pecified and ``u
-0001df60: 726c 6060 2069 7320 6e6f 7420 6120 7a61  rl`` is not a za
-0001df70: 7272 2e41 7272 6179 0a0a 2020 2020 5365  rr.Array..    Se
-0001df80: 6520 416c 736f 0a20 2020 202d 2d2d 2d2d  e Also.    -----
-0001df90: 2d2d 2d0a 2020 2020 6461 736b 2e61 7272  ---.    dask.arr
-0001dfa0: 6179 2e73 746f 7265 0a20 2020 2064 6173  ay.store.    das
-0001dfb0: 6b2e 6172 7261 792e 4172 7261 792e 636f  k.array.Array.co
-0001dfc0: 6d70 7574 655f 6368 756e 6b5f 7369 7a65  mpute_chunk_size
-0001dfd0: 730a 0a20 2020 2022 2222 0a20 2020 2069  s..    """.    i
-0001dfe0: 6d70 6f72 7420 7a61 7272 0a0a 2020 2020  mport zarr..    
-0001dff0: 6966 206e 702e 6973 6e61 6e28 6172 722e  if np.isnan(arr.
-0001e000: 7368 6170 6529 2e61 6e79 2829 3a0a 2020  shape).any():.  
-0001e010: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0001e020: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-0001e030: 2020 2020 2253 6176 696e 6720 6120 6461      "Saving a da
-0001e040: 736b 2061 7272 6179 2077 6974 6820 756e  sk array with un
-0001e050: 6b6e 6f77 6e20 6368 756e 6b20 7369 7a65  known chunk size
-0001e060: 7320 6973 206e 6f74 2022 0a20 2020 2020  s is not ".     
-0001e070: 2020 2020 2020 2022 6375 7272 656e 746c         "currentl
-0001e080: 7920 7375 7070 6f72 7465 6420 6279 205a  y supported by Z
-0001e090: 6172 722e 2573 2220 2520 756e 6b6e 6f77  arr.%s" % unknow
-0001e0a0: 6e5f 6368 756e 6b5f 6d65 7373 6167 650a  n_chunk_message.
-0001e0b0: 2020 2020 2020 2020 290a 0a20 2020 2069          )..    i
-0001e0c0: 6620 6973 696e 7374 616e 6365 2875 726c  f isinstance(url
-0001e0d0: 2c20 7a61 7272 2e41 7272 6179 293a 0a20  , zarr.Array):. 
-0001e0e0: 2020 2020 2020 207a 203d 2075 726c 0a20         z = url. 
-0001e0f0: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0001e100: 616e 6365 287a 2e73 746f 7265 2c20 2864  ance(z.store, (d
-0001e110: 6963 742c 204d 7574 6162 6c65 4d61 7070  ict, MutableMapp
-0001e120: 696e 6729 293a 0a20 2020 2020 2020 2020  ing)):.         
-0001e130: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001e140: 2020 2020 2020 2020 6672 6f6d 2064 6973          from dis
-0001e150: 7472 6962 7574 6564 2069 6d70 6f72 7420  tributed import 
-0001e160: 6465 6661 756c 745f 636c 6965 6e74 0a0a  default_client..
-0001e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e180: 6465 6661 756c 745f 636c 6965 6e74 2829  default_client()
-0001e190: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0001e1a0: 6570 7420 2849 6d70 6f72 7445 7272 6f72  ept (ImportError
-0001e1b0: 2c20 5661 6c75 6545 7272 6f72 293a 0a20  , ValueError):. 
-0001e1c0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001e1d0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-0001e1e0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0001e1f0: 2020 2020 2020 7261 6973 6520 5275 6e74        raise Runt
-0001e200: 696d 6545 7272 6f72 280a 2020 2020 2020  imeError(.      
-0001e210: 2020 2020 2020 2020 2020 2020 2020 2243                "C
-0001e220: 616e 6e6f 7420 7374 6f72 6520 696e 746f  annot store into
-0001e230: 2069 6e20 6d65 6d6f 7279 205a 6172 7220   in memory Zarr 
-0001e240: 4172 7261 7920 7573 696e 6720 220a 2020  Array using ".  
+0001a530: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
+0001a540: 2020 2020 2020 2020 2020 2020 7072 6f70              prop
+0001a550: 6f73 6564 203d 2072 6573 756c 745b 615d  osed = result[a]
+0001a560: 202a 206d 756c 7469 706c 6965 7220 2a2a   * multiplier **
+0001a570: 2028 3120 2f20 6c65 6e28 6175 746f 7329   (1 / len(autos)
+0001a580: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001a590: 2020 6966 2070 726f 706f 7365 6420 3e20    if proposed > 
+0001a5a0: 7368 6170 655b 615d 3a20 2023 2077 6527  shape[a]:  # we'
+0001a5b0: 7665 2068 6974 2074 6865 2073 6861 7065  ve hit the shape
+0001a5c0: 2062 6f75 6e64 6172 790a 2020 2020 2020   boundary.      
+0001a5d0: 2020 2020 2020 2020 2020 2020 2020 6175                au
+0001a5e0: 746f 732e 7265 6d6f 7665 2861 290a 2020  tos.remove(a).  
+0001a5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a600: 2020 6c61 7267 6573 745f 626c 6f63 6b20    largest_block 
+0001a610: 2a3d 2073 6861 7065 5b61 5d0a 2020 2020  *= shape[a].    
+0001a620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a630: 6368 756e 6b73 5b61 5d20 3d20 7368 6170  chunks[a] = shap
+0001a640: 655b 615d 0a20 2020 2020 2020 2020 2020  e[a].           
+0001a650: 2020 2020 2020 2020 2064 656c 2072 6573           del res
+0001a660: 756c 745b 615d 0a20 2020 2020 2020 2020  ult[a].         
+0001a670: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001a680: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a690: 2072 6573 756c 745b 615d 203d 2072 6f75   result[a] = rou
+0001a6a0: 6e64 5f74 6f28 7072 6f70 6f73 6564 2c20  nd_to(proposed, 
+0001a6b0: 6964 6561 6c5f 7368 6170 655b 615d 290a  ideal_shape[a]).
+0001a6c0: 0a20 2020 2020 2020 2020 2020 2023 2072  .            # r
+0001a6d0: 6563 6f6d 7075 7465 2068 6f77 206d 7563  ecompute how muc
+0001a6e0: 6820 6d75 6c74 6970 6c69 6572 2077 6520  h multiplier we 
+0001a6f0: 6861 7665 206c 6566 742c 2072 6570 6561  have left, repea
+0001a700: 740a 2020 2020 2020 2020 2020 2020 6d75  t.            mu
+0001a710: 6c74 6970 6c69 6572 203d 205f 636f 6d70  ltiplier = _comp
+0001a720: 7574 655f 6d75 6c74 6970 6c69 6572 286c  ute_multiplier(l
+0001a730: 696d 6974 2c20 6474 7970 652c 206c 6172  imit, dtype, lar
+0001a740: 6765 7374 5f62 6c6f 636b 2c20 7265 7375  gest_block, resu
+0001a750: 6c74 290a 0a20 2020 2020 2020 2066 6f72  lt)..        for
+0001a760: 206b 2c20 7620 696e 2072 6573 756c 742e   k, v in result.
+0001a770: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
+0001a780: 2020 2020 2063 6875 6e6b 735b 6b5d 203d       chunks[k] =
+0001a790: 2076 0a20 2020 2020 2020 2072 6574 7572   v.        retur
+0001a7a0: 6e20 7475 706c 6528 6368 756e 6b73 290a  n tuple(chunks).
+0001a7b0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0001a7c0: 2020 2023 2043 6865 636b 2069 6620 6474     # Check if dt
+0001a7d0: 7970 652e 6974 656d 7369 7a65 2069 7320  ype.itemsize is 
+0001a7e0: 6772 6561 7465 7220 7468 616e 2030 0a20  greater than 0. 
+0001a7f0: 2020 2020 2020 2069 6620 6474 7970 652e         if dtype.
+0001a800: 6974 656d 7369 7a65 203d 3d20 303a 0a20  itemsize == 0:. 
+0001a810: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001a820: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0001a830: 2020 2020 2020 2020 2020 2020 2022 6175               "au
+0001a840: 746f 2d63 6875 6e6b 696e 6720 7769 7468  to-chunking with
+0001a850: 2064 7479 7065 2e69 7465 6d73 697a 6520   dtype.itemsize 
+0001a860: 3d3d 2030 2069 7320 6e6f 7420 7375 7070  == 0 is not supp
+0001a870: 6f72 7465 642c 2070 6c65 6173 6520 7061  orted, please pa
+0001a880: 7373 2069 6e20 6063 6875 6e6b 7360 2065  ss in `chunks` e
+0001a890: 7870 6c69 6369 746c 7922 0a20 2020 2020  xplicitly".     
+0001a8a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001a8b0: 2073 697a 6520 3d20 286c 696d 6974 202f   size = (limit /
+0001a8c0: 2064 7479 7065 2e69 7465 6d73 697a 6520   dtype.itemsize 
+0001a8d0: 2f20 6c61 7267 6573 745f 626c 6f63 6b29  / largest_block)
+0001a8e0: 202a 2a20 2831 202f 206c 656e 2861 7574   ** (1 / len(aut
+0001a8f0: 6f73 2929 0a20 2020 2020 2020 2073 6d61  os)).        sma
+0001a900: 6c6c 203d 205b 6920 666f 7220 6920 696e  ll = [i for i in
+0001a910: 2061 7574 6f73 2069 6620 7368 6170 655b   autos if shape[
+0001a920: 695d 203c 2073 697a 655d 0a20 2020 2020  i] < size].     
+0001a930: 2020 2069 6620 736d 616c 6c3a 0a20 2020     if small:.   
+0001a940: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+0001a950: 6e20 736d 616c 6c3a 0a20 2020 2020 2020  n small:.       
+0001a960: 2020 2020 2020 2020 2063 6875 6e6b 735b           chunks[
+0001a970: 695d 203d 2028 7368 6170 655b 695d 2c29  i] = (shape[i],)
+0001a980: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001a990: 7572 6e20 6175 746f 5f63 6875 6e6b 7328  urn auto_chunks(
+0001a9a0: 6368 756e 6b73 2c20 7368 6170 652c 206c  chunks, shape, l
+0001a9b0: 696d 6974 2c20 6474 7970 6529 0a0a 2020  imit, dtype)..  
+0001a9c0: 2020 2020 2020 666f 7220 6920 696e 2061        for i in a
+0001a9d0: 7574 6f73 3a0a 2020 2020 2020 2020 2020  utos:.          
+0001a9e0: 2020 6368 756e 6b73 5b69 5d20 3d20 726f    chunks[i] = ro
+0001a9f0: 756e 645f 746f 2873 697a 652c 2073 6861  und_to(size, sha
+0001aa00: 7065 5b69 5d29 0a0a 2020 2020 2020 2020  pe[i])..        
+0001aa10: 7265 7475 726e 2074 7570 6c65 2863 6875  return tuple(chu
+0001aa20: 6e6b 7329 0a0a 0a64 6566 2072 6f75 6e64  nks)...def round
+0001aa30: 5f74 6f28 632c 2073 293a 0a20 2020 2022  _to(c, s):.    "
+0001aa40: 2222 5265 7475 726e 2061 2063 6875 6e6b  ""Return a chunk
+0001aa50: 2064 696d 656e 7369 6f6e 2074 6861 7420   dimension that 
+0001aa60: 6973 2063 6c6f 7365 2074 6f20 616e 2065  is close to an e
+0001aa70: 7665 6e20 6d75 6c74 6970 6c65 206f 7220  ven multiple or 
+0001aa80: 6661 6374 6f72 0a0a 2020 2020 5765 2077  factor..    We w
+0001aa90: 616e 7420 7661 6c75 6573 2066 6f72 2063  ant values for c
+0001aaa0: 2074 6861 7420 6172 6520 6e69 6365 6c79   that are nicely
+0001aab0: 2061 6c69 676e 6564 2077 6974 6820 732e   aligned with s.
+0001aac0: 0a0a 2020 2020 4966 2063 2069 7320 736d  ..    If c is sm
+0001aad0: 616c 6c65 7220 7468 616e 2073 2077 6520  aller than s we 
+0001aae0: 7573 6520 7468 6520 6f72 6967 696e 616c  use the original
+0001aaf0: 2063 6875 6e6b 2073 697a 6520 616e 6420   chunk size and 
+0001ab00: 6163 6365 7074 2061 6e0a 2020 2020 756e  accept an.    un
+0001ab10: 6576 656e 2063 6875 6e6b 2061 7420 7468  even chunk at th
+0001ab20: 6520 656e 642e 0a0a 2020 2020 4966 2063  e end...    If c
+0001ab30: 2069 7320 6c61 7267 6572 2074 6861 6e20   is larger than 
+0001ab40: 7320 7468 656e 2077 6520 7761 6e74 2074  s then we want t
+0001ab50: 6865 206c 6172 6765 7374 206d 756c 7469  he largest multi
+0001ab60: 706c 6520 6f66 2073 2074 6861 7420 6973  ple of s that is
+0001ab70: 2073 7469 6c6c 0a20 2020 2073 6d61 6c6c   still.    small
+0001ab80: 6572 2074 6861 6e20 632e 0a20 2020 2022  er than c..    "
+0001ab90: 2222 0a20 2020 2069 6620 6320 3c3d 2073  "".    if c <= s
+0001aba0: 3a0a 2020 2020 2020 2020 7265 7475 726e  :.        return
+0001abb0: 206d 6178 2831 2c20 696e 7428 6329 290a   max(1, int(c)).
+0001abc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001abd0: 2020 7265 7475 726e 2063 202f 2f20 7320    return c // s 
+0001abe0: 2a20 730a 0a0a 6465 6620 5f67 6574 5f63  * s...def _get_c
+0001abf0: 6875 6e6b 5f73 6861 7065 2861 293a 0a20  hunk_shape(a):. 
+0001ac00: 2020 2073 203d 206e 702e 6173 6172 7261     s = np.asarra
+0001ac10: 7928 612e 7368 6170 652c 2064 7479 7065  y(a.shape, dtype
+0001ac20: 3d69 6e74 290a 2020 2020 7265 7475 726e  =int).    return
+0001ac30: 2073 5b6c 656e 2873 2920 2a20 284e 6f6e   s[len(s) * (Non
+0001ac40: 652c 2920 2b20 2873 6c69 6365 284e 6f6e  e,) + (slice(Non
+0001ac50: 6529 2c29 5d0a 0a0a 6465 6620 6672 6f6d  e),)]...def from
+0001ac60: 5f61 7272 6179 280a 2020 2020 782c 0a20  _array(.    x,. 
+0001ac70: 2020 2063 6875 6e6b 733d 2261 7574 6f22     chunks="auto"
+0001ac80: 2c0a 2020 2020 6e61 6d65 3d4e 6f6e 652c  ,.    name=None,
+0001ac90: 0a20 2020 206c 6f63 6b3d 4661 6c73 652c  .    lock=False,
+0001aca0: 0a20 2020 2061 7361 7272 6179 3d4e 6f6e  .    asarray=Non
+0001acb0: 652c 0a20 2020 2066 616e 6379 3d54 7275  e,.    fancy=Tru
+0001acc0: 652c 0a20 2020 2067 6574 6974 656d 3d4e  e,.    getitem=N
+0001acd0: 6f6e 652c 0a20 2020 206d 6574 613d 4e6f  one,.    meta=No
+0001ace0: 6e65 2c0a 2020 2020 696e 6c69 6e65 5f61  ne,.    inline_a
+0001acf0: 7272 6179 3d46 616c 7365 2c0a 293a 0a20  rray=False,.):. 
+0001ad00: 2020 2022 2222 4372 6561 7465 2064 6173     """Create das
+0001ad10: 6b20 6172 7261 7920 6672 6f6d 2073 6f6d  k array from som
+0001ad20: 6574 6869 6e67 2074 6861 7420 6c6f 6f6b  ething that look
+0001ad30: 7320 6c69 6b65 2061 6e20 6172 7261 792e  s like an array.
+0001ad40: 0a0a 2020 2020 496e 7075 7420 6d75 7374  ..    Input must
+0001ad50: 2068 6176 6520 6120 6060 2e73 6861 7065   have a ``.shape
+0001ad60: 6060 2c20 6060 2e6e 6469 6d60 602c 2060  ``, ``.ndim``, `
+0001ad70: 602e 6474 7970 6560 6020 616e 6420 7375  `.dtype`` and su
+0001ad80: 7070 6f72 7420 6e75 6d70 792d 7374 796c  pport numpy-styl
+0001ad90: 6520 736c 6963 696e 672e 0a0a 2020 2020  e slicing...    
+0001ada0: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
+0001adb0: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 7820  ---------.    x 
+0001adc0: 3a20 6172 7261 795f 6c69 6b65 0a20 2020  : array_like.   
+0001add0: 2063 6875 6e6b 7320 3a20 696e 742c 2074   chunks : int, t
+0001ade0: 7570 6c65 0a20 2020 2020 2020 2048 6f77  uple.        How
+0001adf0: 2074 6f20 6368 756e 6b20 7468 6520 6172   to chunk the ar
+0001ae00: 7261 792e 204d 7573 7420 6265 206f 6e65  ray. Must be one
+0001ae10: 206f 6620 7468 6520 666f 6c6c 6f77 696e   of the followin
+0001ae20: 6720 666f 726d 733a 0a0a 2020 2020 2020  g forms:..      
+0001ae30: 2020 2d20 4120 626c 6f63 6b73 697a 6520    - A blocksize 
+0001ae40: 6c69 6b65 2031 3030 302e 0a20 2020 2020  like 1000..     
+0001ae50: 2020 202d 2041 2062 6c6f 636b 7368 6170     - A blockshap
+0001ae60: 6520 6c69 6b65 2028 3130 3030 2c20 3130  e like (1000, 10
+0001ae70: 3030 292e 0a20 2020 2020 2020 202d 2045  00)..        - E
+0001ae80: 7870 6c69 6369 7420 7369 7a65 7320 6f66  xplicit sizes of
+0001ae90: 2061 6c6c 2062 6c6f 636b 7320 616c 6f6e   all blocks alon
+0001aea0: 6720 616c 6c20 6469 6d65 6e73 696f 6e73  g all dimensions
+0001aeb0: 206c 696b 650a 2020 2020 2020 2020 2020   like.          
+0001aec0: 2828 3130 3030 2c20 3130 3030 2c20 3530  ((1000, 1000, 50
+0001aed0: 3029 2c20 2834 3030 2c20 3430 3029 292e  0), (400, 400)).
+0001aee0: 0a20 2020 2020 2020 202d 2041 2073 697a  .        - A siz
+0001aef0: 6520 696e 2062 7974 6573 2c20 6c69 6b65  e in bytes, like
+0001af00: 2022 3130 3020 4d69 4222 2077 6869 6368   "100 MiB" which
+0001af10: 2077 696c 6c20 6368 6f6f 7365 2061 2075   will choose a u
+0001af20: 6e69 666f 726d 0a20 2020 2020 2020 2020  niform.         
+0001af30: 2062 6c6f 636b 2d6c 696b 6520 7368 6170   block-like shap
+0001af40: 650a 2020 2020 2020 2020 2d20 5468 6520  e.        - The 
+0001af50: 776f 7264 2022 6175 746f 2220 7768 6963  word "auto" whic
+0001af60: 6820 6163 7473 206c 696b 6520 7468 6520  h acts like the 
+0001af70: 6162 6f76 652c 2062 7574 2075 7365 7320  above, but uses 
+0001af80: 6120 636f 6e66 6967 7572 6174 696f 6e0a  a configuration.
+0001af90: 2020 2020 2020 2020 2020 7661 6c75 6520            value 
+0001afa0: 6060 6172 7261 792e 6368 756e 6b2d 7369  ``array.chunk-si
+0001afb0: 7a65 6060 2066 6f72 2074 6865 2063 6875  ze`` for the chu
+0001afc0: 6e6b 2073 697a 650a 0a20 2020 2020 2020  nk size..       
+0001afd0: 202d 3120 6f72 204e 6f6e 6520 6173 2061   -1 or None as a
+0001afe0: 2062 6c6f 636b 7369 7a65 2069 6e64 6963   blocksize indic
+0001aff0: 6174 6520 7468 6520 7369 7a65 206f 6620  ate the size of 
+0001b000: 7468 6520 636f 7272 6573 706f 6e64 696e  the correspondin
+0001b010: 670a 2020 2020 2020 2020 6469 6d65 6e73  g.        dimens
+0001b020: 696f 6e2e 0a20 2020 206e 616d 6520 3a20  ion..    name : 
+0001b030: 7374 7220 6f72 2062 6f6f 6c2c 206f 7074  str or bool, opt
+0001b040: 696f 6e61 6c0a 2020 2020 2020 2020 5468  ional.        Th
+0001b050: 6520 6b65 7920 6e61 6d65 2074 6f20 7573  e key name to us
+0001b060: 6520 666f 7220 7468 6520 6172 7261 792e  e for the array.
+0001b070: 2044 6566 6175 6c74 7320 746f 2061 2068   Defaults to a h
+0001b080: 6173 6820 6f66 2060 6078 6060 2e0a 0a20  ash of ``x``... 
+0001b090: 2020 2020 2020 2048 6173 6869 6e67 2069         Hashing i
+0001b0a0: 7320 7573 6566 756c 2069 6620 7468 6520  s useful if the 
+0001b0b0: 7361 6d65 2076 616c 7565 206f 6620 6060  same value of ``
+0001b0c0: 7860 6020 6973 2075 7365 6420 746f 2063  x`` is used to c
+0001b0d0: 7265 6174 6520 6d75 6c74 6970 6c65 0a20  reate multiple. 
+0001b0e0: 2020 2020 2020 2061 7272 6179 732c 2061         arrays, a
+0001b0f0: 7320 4461 736b 2063 616e 2074 6865 6e20  s Dask can then 
+0001b100: 7265 636f 676e 6973 6520 7468 6174 2074  recognise that t
+0001b110: 6865 7927 7265 2074 6865 2073 616d 6520  hey're the same 
+0001b120: 616e 640a 2020 2020 2020 2020 6176 6f69  and.        avoi
+0001b130: 6420 6475 706c 6963 6174 6520 636f 6d70  d duplicate comp
+0001b140: 7574 6174 696f 6e73 2e20 486f 7765 7665  utations. Howeve
+0001b150: 722c 2069 7420 6361 6e20 616c 736f 2062  r, it can also b
+0001b160: 6520 736c 6f77 2c20 616e 6420 6966 2074  e slow, and if t
+0001b170: 6865 0a20 2020 2020 2020 2061 7272 6179  he.        array
+0001b180: 2069 7320 6e6f 7420 636f 6e74 6967 756f   is not contiguo
+0001b190: 7573 2069 7420 6973 2063 6f70 6965 6420  us it is copied 
+0001b1a0: 666f 7220 6861 7368 696e 672e 2049 6620  for hashing. If 
+0001b1b0: 7468 6520 6172 7261 7920 7573 6573 0a20  the array uses. 
+0001b1c0: 2020 2020 2020 2073 7472 6964 6520 7472         stride tr
+0001b1d0: 6963 6b73 2028 7375 6368 2061 7320 3a66  icks (such as :f
+0001b1e0: 756e 633a 606e 756d 7079 2e62 726f 6164  unc:`numpy.broad
+0001b1f0: 6361 7374 5f74 6f60 206f 720a 2020 2020  cast_to` or.    
+0001b200: 2020 2020 3a66 756e 633a 6073 6b69 6d61      :func:`skima
+0001b210: 6765 2e75 7469 6c2e 7669 6577 5f61 735f  ge.util.view_as_
+0001b220: 7769 6e64 6f77 7360 2920 746f 2068 6176  windows`) to hav
+0001b230: 6520 6120 6c61 7267 6572 206c 6f67 6963  e a larger logic
+0001b240: 616c 0a20 2020 2020 2020 2074 6861 6e20  al.        than 
+0001b250: 7068 7973 6963 616c 2073 697a 652c 2074  physical size, t
+0001b260: 6869 7320 636f 7079 2063 616e 2063 6175  his copy can cau
+0001b270: 7365 2065 7863 6573 7369 7665 206d 656d  se excessive mem
+0001b280: 6f72 7920 7573 6167 652e 0a0a 2020 2020  ory usage...    
+0001b290: 2020 2020 4966 2079 6f75 2064 6f6e 2774      If you don't
+0001b2a0: 206e 6565 6420 7468 6520 6465 6475 706c   need the dedupl
+0001b2b0: 6963 6174 696f 6e20 7072 6f76 6964 6564  ication provided
+0001b2c0: 2062 7920 6861 7368 696e 672c 2075 7365   by hashing, use
+0001b2d0: 0a20 2020 2020 2020 2060 606e 616d 653d  .        ``name=
+0001b2e0: 4661 6c73 6560 6020 746f 2067 656e 6572  False`` to gener
+0001b2f0: 6174 6520 6120 7261 6e64 6f6d 206e 616d  ate a random nam
+0001b300: 6520 696e 7374 6561 6420 6f66 2068 6173  e instead of has
+0001b310: 6869 6e67 2c20 7768 6963 680a 2020 2020  hing, which.    
+0001b320: 2020 2020 6176 6f69 6473 2074 6865 2070      avoids the p
+0001b330: 6974 6661 6c6c 7320 6465 7363 7269 6265  itfalls describe
+0001b340: 6420 6162 6f76 652e 2055 7369 6e67 2060  d above. Using `
+0001b350: 606e 616d 653d 5472 7565 6060 2069 730a  `name=True`` is.
+0001b360: 2020 2020 2020 2020 6571 7569 7661 6c65          equivale
+0001b370: 6e74 2074 6f20 7468 6520 6465 6661 756c  nt to the defaul
+0001b380: 742e 0a0a 2020 2020 2020 2020 4279 2064  t...        By d
+0001b390: 6566 6175 6c74 2c20 6861 7368 696e 6720  efault, hashing 
+0001b3a0: 7573 6573 2070 7974 686f 6e27 7320 7374  uses python's st
+0001b3b0: 616e 6461 7264 2073 6861 312e 2054 6869  andard sha1. Thi
+0001b3c0: 7320 6265 6861 7669 6f75 7220 6361 6e20  s behaviour can 
+0001b3d0: 6265 0a20 2020 2020 2020 2063 6861 6e67  be.        chang
+0001b3e0: 6564 2062 7920 696e 7374 616c 6c69 6e67  ed by installing
+0001b3f0: 2063 6974 7968 6173 682c 2078 7868 6173   cityhash, xxhas
+0001b400: 6820 6f72 206d 7572 6d75 7268 6173 682e  h or murmurhash.
+0001b410: 2049 6620 696e 7374 616c 6c65 642c 0a20   If installed,. 
+0001b420: 2020 2020 2020 2061 206c 6172 6765 2d66         a large-f
+0001b430: 6163 746f 7220 7370 6565 6475 7020 6361  actor speedup ca
+0001b440: 6e20 6265 206f 6274 6169 6e65 6420 696e  n be obtained in
+0001b450: 2074 6865 2074 6f6b 656e 6973 6174 696f   the tokenisatio
+0001b460: 6e20 7374 6570 2e0a 0a20 2020 2020 2020  n step...       
+0001b470: 202e 2e20 6e6f 7465 3a3a 0a0a 2020 2020   .. note::..    
+0001b480: 2020 2020 2020 2042 6563 6175 7365 2074         Because t
+0001b490: 6869 7320 6060 6e61 6d65 6060 2069 7320  his ``name`` is 
+0001b4a0: 7573 6564 2061 7320 7468 6520 6b65 7920  used as the key 
+0001b4b0: 696e 2074 6173 6b20 6772 6170 6873 2c20  in task graphs, 
+0001b4c0: 796f 7520 7368 6f75 6c64 0a20 2020 2020  you should.     
+0001b4d0: 2020 2020 2020 656e 7375 7265 2074 6861        ensure tha
+0001b4e0: 7420 6974 2075 6e69 7175 656c 7920 6964  t it uniquely id
+0001b4f0: 656e 7469 6669 6573 2074 6865 2064 6174  entifies the dat
+0001b500: 6120 636f 6e74 6169 6e65 6420 7769 7468  a contained with
+0001b510: 696e 2e20 4966 0a20 2020 2020 2020 2020  in. If.         
+0001b520: 2020 796f 7527 6420 6c69 6b65 2074 6f20    you'd like to 
+0001b530: 7072 6f76 6964 6520 6120 6465 7363 7269  provide a descri
+0001b540: 7074 6976 6520 6e61 6d65 2074 6861 7420  ptive name that 
+0001b550: 6973 2073 7469 6c6c 2075 6e69 7175 652c  is still unique,
+0001b560: 2063 6f6d 6269 6e65 0a20 2020 2020 2020   combine.       
+0001b570: 2020 2020 7468 6520 6465 7363 7269 7074      the descript
+0001b580: 6976 6520 6e61 6d65 2077 6974 6820 3a66  ive name with :f
+0001b590: 756e 633a 6064 6173 6b2e 6261 7365 2e74  unc:`dask.base.t
+0001b5a0: 6f6b 656e 697a 6560 206f 6620 7468 650a  okenize` of the.
+0001b5b0: 2020 2020 2020 2020 2020 2060 6061 7272             ``arr
+0001b5c0: 6179 5f6c 696b 6560 602e 2053 6565 203a  ay_like``. See :
+0001b5d0: 7265 663a 6067 7261 7068 7360 2066 6f72  ref:`graphs` for
+0001b5e0: 206d 6f72 652e 0a0a 2020 2020 6c6f 636b   more...    lock
+0001b5f0: 203a 2062 6f6f 6c20 6f72 204c 6f63 6b2c   : bool or Lock,
+0001b600: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0001b610: 2020 4966 2060 6078 6060 2064 6f65 736e    If ``x`` doesn
+0001b620: 2774 2073 7570 706f 7274 2063 6f6e 6375  't support concu
+0001b630: 7272 656e 7420 7265 6164 7320 7468 656e  rrent reads then
+0001b640: 2070 726f 7669 6465 2061 206c 6f63 6b20   provide a lock 
+0001b650: 6865 7265 2c20 6f72 0a20 2020 2020 2020  here, or.       
+0001b660: 2070 6173 7320 696e 2054 7275 6520 746f   pass in True to
+0001b670: 2068 6176 6520 6461 736b 2e61 7272 6179   have dask.array
+0001b680: 2063 7265 6174 6520 6f6e 6520 666f 7220   create one for 
+0001b690: 796f 752e 0a20 2020 2061 7361 7272 6179  you..    asarray
+0001b6a0: 203a 2062 6f6f 6c2c 206f 7074 696f 6e61   : bool, optiona
+0001b6b0: 6c0a 2020 2020 2020 2020 4966 2054 7275  l.        If Tru
+0001b6c0: 6520 7468 656e 2063 616c 6c20 6e70 2e61  e then call np.a
+0001b6d0: 7361 7272 6179 206f 6e20 6368 756e 6b73  sarray on chunks
+0001b6e0: 2074 6f20 636f 6e76 6572 7420 7468 656d   to convert them
+0001b6f0: 2074 6f20 6e75 6d70 7920 6172 7261 7973   to numpy arrays
+0001b700: 2e0a 2020 2020 2020 2020 4966 2046 616c  ..        If Fal
+0001b710: 7365 2074 6865 6e20 6368 756e 6b73 2061  se then chunks a
+0001b720: 7265 2070 6173 7365 6420 7468 726f 7567  re passed throug
+0001b730: 6820 756e 6368 616e 6765 642e 0a20 2020  h unchanged..   
+0001b740: 2020 2020 2049 6620 4e6f 6e65 2028 6465       If None (de
+0001b750: 6661 756c 7429 2074 6865 6e20 7765 2075  fault) then we u
+0001b760: 7365 2054 7275 6520 6966 2074 6865 2060  se True if the `
+0001b770: 605f 5f61 7272 6179 5f66 756e 6374 696f  `__array_functio
+0001b780: 6e5f 5f60 6020 6d65 7468 6f64 0a20 2020  n__`` method.   
+0001b790: 2020 2020 2069 7320 756e 6465 6669 6e65       is undefine
+0001b7a0: 642e 0a0a 2020 2020 2020 2020 2e2e 206e  d...        .. n
+0001b7b0: 6f74 653a 3a0a 0a20 2020 2020 2020 2020  ote::..         
+0001b7c0: 2020 2044 6173 6b20 646f 6573 206e 6f74     Dask does not
+0001b7d0: 2070 7265 7365 7276 6520 7468 6520 6d65   preserve the me
+0001b7e0: 6d6f 7279 206c 6179 6f75 7420 6f66 2074  mory layout of t
+0001b7f0: 6865 206f 7269 6769 6e61 6c20 6172 7261  he original arra
+0001b800: 7920 7768 656e 0a20 2020 2020 2020 2020  y when.         
+0001b810: 2020 2074 6865 2061 7272 6179 2069 7320     the array is 
+0001b820: 6372 6561 7465 6420 7573 696e 6720 466f  created using Fo
+0001b830: 7274 7261 6e20 7261 7468 6572 2074 6861  rtran rather tha
+0001b840: 6e20 4320 6f72 6465 7269 6e67 2e0a 0a20  n C ordering... 
+0001b850: 2020 2066 616e 6379 203a 2062 6f6f 6c2c     fancy : bool,
+0001b860: 206f 7074 696f 6e61 6c0a 2020 2020 2020   optional.      
+0001b870: 2020 4966 2060 6078 6060 2064 6f65 736e    If ``x`` doesn
+0001b880: 2774 2073 7570 706f 7274 2066 616e 6379  't support fancy
+0001b890: 2069 6e64 6578 696e 6720 2865 2e67 2e20   indexing (e.g. 
+0001b8a0: 696e 6465 7869 6e67 2077 6974 6820 6c69  indexing with li
+0001b8b0: 7374 7320 6f72 0a20 2020 2020 2020 2061  sts or.        a
+0001b8c0: 7272 6179 7329 2074 6865 6e20 7365 7420  rrays) then set 
+0001b8d0: 746f 2046 616c 7365 2e20 4465 6661 756c  to False. Defaul
+0001b8e0: 7420 6973 2054 7275 652e 0a20 2020 206d  t is True..    m
+0001b8f0: 6574 6120 3a20 4172 7261 792d 6c69 6b65  eta : Array-like
+0001b900: 2c20 6f70 7469 6f6e 616c 0a20 2020 2020  , optional.     
+0001b910: 2020 2054 6865 206d 6574 6164 6174 6120     The metadata 
+0001b920: 666f 7220 7468 6520 7265 7375 6c74 696e  for the resultin
+0001b930: 6720 6461 736b 2061 7272 6179 2e20 2054  g dask array.  T
+0001b940: 6869 7320 6973 2074 6865 206b 696e 6420  his is the kind 
+0001b950: 6f66 2061 7272 6179 0a20 2020 2020 2020  of array.       
+0001b960: 2074 6861 7420 7769 6c6c 2072 6573 756c   that will resul
+0001b970: 7420 6672 6f6d 2073 6c69 6369 6e67 2074  t from slicing t
+0001b980: 6865 2069 6e70 7574 2061 7272 6179 2e0a  he input array..
+0001b990: 2020 2020 2020 2020 4465 6661 756c 7473          Defaults
+0001b9a0: 2074 6f20 7468 6520 696e 7075 7420 6172   to the input ar
+0001b9b0: 7261 792e 0a20 2020 2069 6e6c 696e 655f  ray..    inline_
+0001b9c0: 6172 7261 7920 3a20 626f 6f6c 2c20 6465  array : bool, de
+0001b9d0: 6661 756c 7420 4661 6c73 650a 2020 2020  fault False.    
+0001b9e0: 2020 2020 486f 7720 746f 2069 6e63 6c75      How to inclu
+0001b9f0: 6465 2074 6865 2061 7272 6179 2069 6e20  de the array in 
+0001ba00: 7468 6520 7461 736b 2067 7261 7068 2e20  the task graph. 
+0001ba10: 4279 2064 6566 6175 6c74 0a20 2020 2020  By default.     
+0001ba20: 2020 2028 6060 696e 6c69 6e65 5f61 7272     (``inline_arr
+0001ba30: 6179 3d46 616c 7365 6060 2920 7468 6520  ay=False``) the 
+0001ba40: 6172 7261 7920 6973 2069 6e63 6c75 6465  array is include
+0001ba50: 6420 696e 2061 2074 6173 6b20 6279 2069  d in a task by i
+0001ba60: 7473 656c 662c 0a20 2020 2020 2020 2061  tself,.        a
+0001ba70: 6e64 2065 6163 6820 6368 756e 6b20 7265  nd each chunk re
+0001ba80: 6665 7273 2074 6f20 7468 6174 2074 6173  fers to that tas
+0001ba90: 6b20 6279 2069 7473 206b 6579 2e0a 0a20  k by its key... 
+0001baa0: 2020 2020 2020 202e 2e20 636f 6465 2d62         .. code-b
+0001bab0: 6c6f 636b 3a3a 2070 7974 686f 6e0a 0a20  lock:: python.. 
+0001bac0: 2020 2020 2020 2020 2020 3e3e 3e20 7820            >>> x 
+0001bad0: 3d20 6835 7079 2e46 696c 6528 2264 6174  = h5py.File("dat
+0001bae0: 612e 6835 2229 5b22 2f78 225d 2020 2320  a.h5")["/x"]  # 
+0001baf0: 646f 6374 6573 743a 202b 534b 4950 0a20  doctest: +SKIP. 
+0001bb00: 2020 2020 2020 2020 2020 3e3e 3e20 6120            >>> a 
+0001bb10: 3d20 6461 2e66 726f 6d5f 6172 7261 7928  = da.from_array(
+0001bb20: 782c 2063 6875 6e6b 733d 3530 3029 2020  x, chunks=500)  
+0001bb30: 2320 646f 6374 6573 743a 202b 534b 4950  # doctest: +SKIP
+0001bb40: 0a20 2020 2020 2020 2020 2020 3e3e 3e20  .           >>> 
+0001bb50: 6469 6374 2861 2e64 6173 6b29 2020 2320  dict(a.dask)  # 
+0001bb60: 646f 6374 6573 743a 202b 534b 4950 0a20  doctest: +SKIP. 
+0001bb70: 2020 2020 2020 2020 2020 7b0a 2020 2020            {.    
+0001bb80: 2020 2020 2020 2020 2020 2761 7272 6179            'array
+0001bb90: 2d6f 7269 6769 6e61 6c2d 3c6e 616d 653e  -original-<name>
+0001bba0: 273a 203c 4844 4635 2064 6174 6173 6574  ': <HDF5 dataset
+0001bbb0: 202e 2e2e 3e2c 0a20 2020 2020 2020 2020   ...>,.         
+0001bbc0: 2020 2020 2028 2761 7272 6179 2d3c 6e61       ('array-<na
+0001bbd0: 6d65 3e27 2c20 3029 3a20 2867 6574 6974  me>', 0): (getit
+0001bbe0: 656d 2c20 2261 7272 6179 2d6f 7269 6769  em, "array-origi
+0001bbf0: 6e61 6c2d 3c6e 616d 653e 222c 202e 2e2e  nal-<name>", ...
+0001bc00: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+0001bc10: 2028 2761 7272 6179 2d3c 6e61 6d65 3e27   ('array-<name>'
+0001bc20: 2c20 3129 3a20 2867 6574 6974 656d 2c20  , 1): (getitem, 
+0001bc30: 2261 7272 6179 2d6f 7269 6769 6e61 6c2d  "array-original-
+0001bc40: 3c6e 616d 653e 222c 202e 2e2e 290a 2020  <name>", ...).  
+0001bc50: 2020 2020 2020 2020 207d 0a0a 2020 2020           }..    
+0001bc60: 2020 2020 5769 7468 2060 6069 6e6c 696e      With ``inlin
+0001bc70: 655f 6172 7261 793d 5472 7565 6060 2c20  e_array=True``, 
+0001bc80: 4461 736b 2077 696c 6c20 696e 7374 6561  Dask will instea
+0001bc90: 6420 696e 6c69 6e65 2074 6865 2061 7272  d inline the arr
+0001bca0: 6179 2064 6972 6563 746c 790a 2020 2020  ay directly.    
+0001bcb0: 2020 2020 696e 2074 6865 2076 616c 7565      in the value
+0001bcc0: 7320 6f66 2074 6865 2074 6173 6b20 6772  s of the task gr
+0001bcd0: 6170 682e 0a0a 2020 2020 2020 2020 2e2e  aph...        ..
+0001bce0: 2063 6f64 652d 626c 6f63 6b3a 3a20 7079   code-block:: py
+0001bcf0: 7468 6f6e 0a0a 2020 2020 2020 2020 2020  thon..          
+0001bd00: 203e 3e3e 2061 203d 2064 612e 6672 6f6d   >>> a = da.from
+0001bd10: 5f61 7272 6179 2878 2c20 6368 756e 6b73  _array(x, chunks
+0001bd20: 3d35 3030 2c20 696e 6c69 6e65 5f61 7272  =500, inline_arr
+0001bd30: 6179 3d54 7275 6529 2020 2320 646f 6374  ay=True)  # doct
+0001bd40: 6573 743a 202b 534b 4950 0a20 2020 2020  est: +SKIP.     
+0001bd50: 2020 2020 2020 3e3e 3e20 6469 6374 2861        >>> dict(a
+0001bd60: 2e64 6173 6b29 2020 2320 646f 6374 6573  .dask)  # doctes
+0001bd70: 743a 202b 534b 4950 0a20 2020 2020 2020  t: +SKIP.       
+0001bd80: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+0001bd90: 2020 2020 2827 6172 7261 792d 3c6e 616d      ('array-<nam
+0001bda0: 653e 272c 2030 293a 2028 6765 7469 7465  e>', 0): (getite
+0001bdb0: 6d2c 203c 4844 4635 2064 6174 6173 6574  m, <HDF5 dataset
+0001bdc0: 202e 2e2e 3e2c 202e 2e2e 292c 0a20 2020   ...>, ...),.   
+0001bdd0: 2020 2020 2020 2020 2020 2028 2761 7272             ('arr
+0001bde0: 6179 2d3c 6e61 6d65 3e27 2c20 3129 3a20  ay-<name>', 1): 
+0001bdf0: 2867 6574 6974 656d 2c20 3c48 4446 3520  (getitem, <HDF5 
+0001be00: 6461 7461 7365 7420 2e2e 2e3e 2c20 2e2e  dataset ...>, ..
+0001be10: 2e29 0a20 2020 2020 2020 2020 2020 7d0a  .).           }.
+0001be20: 0a20 2020 2020 2020 204e 6f74 6520 7468  .        Note th
+0001be30: 6174 2074 6865 7265 2773 206e 6f20 6b65  at there's no ke
+0001be40: 7920 696e 2074 6865 2074 6173 6b20 6772  y in the task gr
+0001be50: 6170 6820 7769 7468 206a 7573 7420 7468  aph with just th
+0001be60: 6520 6172 7261 7920 6078 600a 2020 2020  e array `x`.    
+0001be70: 2020 2020 616e 796d 6f72 652e 2049 6e73      anymore. Ins
+0001be80: 7465 6164 2069 7427 7320 706c 6163 6564  tead it's placed
+0001be90: 2064 6972 6563 746c 7920 696e 2074 6865   directly in the
+0001bea0: 2076 616c 7565 732e 0a0a 2020 2020 2020   values...      
+0001beb0: 2020 5468 6520 7269 6768 7420 6368 6f69    The right choi
+0001bec0: 6365 2066 6f72 2060 6069 6e6c 696e 655f  ce for ``inline_
+0001bed0: 6172 7261 7960 6020 6465 7065 6e64 7320  array`` depends 
+0001bee0: 6f6e 2073 6576 6572 616c 2066 6163 746f  on several facto
+0001bef0: 7273 2c0a 2020 2020 2020 2020 696e 636c  rs,.        incl
+0001bf00: 7564 696e 6720 7468 6520 7369 7a65 206f  uding the size o
+0001bf10: 6620 6060 7860 602c 2068 6f77 2065 7870  f ``x``, how exp
+0001bf20: 656e 7369 7665 2069 7420 6973 2074 6f20  ensive it is to 
+0001bf30: 6372 6561 7465 2c20 7768 6963 680a 2020  create, which.  
+0001bf40: 2020 2020 2020 7363 6865 6475 6c65 7220        scheduler 
+0001bf50: 796f 7527 7265 2075 7369 6e67 2c20 616e  you're using, an
+0001bf60: 6420 7468 6520 7061 7474 6572 6e20 6f66  d the pattern of
+0001bf70: 2064 6f77 6e73 7472 6561 6d20 636f 6d70   downstream comp
+0001bf80: 7574 6174 696f 6e73 2e0a 2020 2020 2020  utations..      
+0001bf90: 2020 4173 2061 2068 6575 7269 7374 6963    As a heuristic
+0001bfa0: 2c20 6060 696e 6c69 6e65 5f61 7272 6179  , ``inline_array
+0001bfb0: 3d54 7275 6560 6020 6d61 7920 6265 2074  =True`` may be t
+0001bfc0: 6865 2072 6967 6874 2063 686f 6963 6520  he right choice 
+0001bfd0: 7768 656e 0a20 2020 2020 2020 2074 6865  when.        the
+0001bfe0: 2061 7272 6179 2060 6078 6060 2069 7320   array ``x`` is 
+0001bff0: 6368 6561 7020 746f 2073 6572 6961 6c69  cheap to seriali
+0001c000: 7a65 2061 6e64 2064 6573 6572 6961 6c69  ze and deseriali
+0001c010: 7a65 2028 7369 6e63 6520 6974 2773 0a20  ze (since it's. 
+0001c020: 2020 2020 2020 2069 6e63 6c75 6465 6420         included 
+0001c030: 696e 2074 6865 2067 7261 7068 206d 616e  in the graph man
+0001c040: 7920 7469 6d65 7329 2061 6e64 2069 6620  y times) and if 
+0001c050: 796f 7527 7265 2065 7870 6572 6965 6e63  you're experienc
+0001c060: 696e 6720 6f72 6465 7269 6e67 0a20 2020  ing ordering.   
+0001c070: 2020 2020 2069 7373 7565 7320 2873 6565       issues (see
+0001c080: 203a 7265 663a 606f 7264 6572 6020 666f   :ref:`order` fo
+0001c090: 7220 6d6f 7265 292e 0a0a 2020 2020 2020  r more)...      
+0001c0a0: 2020 5468 6973 2068 6173 206e 6f20 6566    This has no ef
+0001c0b0: 6665 6374 2077 6865 6e20 6060 7860 6020  fect when ``x`` 
+0001c0c0: 6973 2061 204e 756d 5079 2061 7272 6179  is a NumPy array
+0001c0d0: 2e0a 0a20 2020 2045 7861 6d70 6c65 730a  ...    Examples.
+0001c0e0: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a0a 2020      --------..  
+0001c0f0: 2020 3e3e 3e20 7820 3d20 6835 7079 2e46    >>> x = h5py.F
+0001c100: 696c 6528 272e 2e2e 2729 5b27 2f64 6174  ile('...')['/dat
+0001c110: 612f 7061 7468 275d 2020 2320 646f 6374  a/path']  # doct
+0001c120: 6573 743a 202b 534b 4950 0a20 2020 203e  est: +SKIP.    >
+0001c130: 3e3e 2061 203d 2064 612e 6672 6f6d 5f61  >> a = da.from_a
+0001c140: 7272 6179 2878 2c20 6368 756e 6b73 3d28  rray(x, chunks=(
+0001c150: 3130 3030 2c20 3130 3030 2929 2020 2320  1000, 1000))  # 
+0001c160: 646f 6374 6573 743a 202b 534b 4950 0a0a  doctest: +SKIP..
+0001c170: 2020 2020 4966 2079 6f75 7220 756e 6465      If your unde
+0001c180: 726c 7969 6e67 2064 6174 6173 746f 7265  rlying datastore
+0001c190: 2064 6f65 7320 6e6f 7420 7375 7070 6f72   does not suppor
+0001c1a0: 7420 636f 6e63 7572 7265 6e74 2072 6561  t concurrent rea
+0001c1b0: 6473 2074 6865 6e20 696e 636c 7564 650a  ds then include.
+0001c1c0: 2020 2020 7468 6520 6060 6c6f 636b 3d54      the ``lock=T
+0001c1d0: 7275 6560 6020 6b65 7977 6f72 6420 6172  rue`` keyword ar
+0001c1e0: 6775 6d65 6e74 206f 7220 6060 6c6f 636b  gument or ``lock
+0001c1f0: 3d6d 796c 6f63 6b60 6020 6966 2079 6f75  =mylock`` if you
+0001c200: 2077 616e 7420 6d75 6c74 6970 6c65 0a20   want multiple. 
+0001c210: 2020 2061 7272 6179 7320 746f 2063 6f6f     arrays to coo
+0001c220: 7264 696e 6174 6520 6172 6f75 6e64 2074  rdinate around t
+0001c230: 6865 2073 616d 6520 6c6f 636b 2e0a 0a20  he same lock... 
+0001c240: 2020 203e 3e3e 2061 203d 2064 612e 6672     >>> a = da.fr
+0001c250: 6f6d 5f61 7272 6179 2878 2c20 6368 756e  om_array(x, chun
+0001c260: 6b73 3d28 3130 3030 2c20 3130 3030 292c  ks=(1000, 1000),
+0001c270: 206c 6f63 6b3d 5472 7565 2920 2023 2064   lock=True)  # d
+0001c280: 6f63 7465 7374 3a20 2b53 4b49 500a 0a20  octest: +SKIP.. 
+0001c290: 2020 2049 6620 796f 7572 2075 6e64 6572     If your under
+0001c2a0: 6c79 696e 6720 6461 7461 7374 6f72 6520  lying datastore 
+0001c2b0: 6861 7320 6120 6060 2e63 6875 6e6b 7360  has a ``.chunks`
+0001c2c0: 6020 6174 7472 6962 7574 6520 2861 7320  ` attribute (as 
+0001c2d0: 6835 7079 2061 6e64 207a 6172 720a 2020  h5py and zarr.  
+0001c2e0: 2020 6461 7461 7365 7473 2064 6f29 2074    datasets do) t
+0001c2f0: 6865 6e20 6120 6d75 6c74 6970 6c65 206f  hen a multiple o
+0001c300: 6620 7468 6174 2063 6875 6e6b 2073 6861  f that chunk sha
+0001c310: 7065 2077 696c 6c20 6265 2075 7365 6420  pe will be used 
+0001c320: 6966 2079 6f75 0a20 2020 2064 6f20 6e6f  if you.    do no
+0001c330: 7420 7072 6f76 6964 6520 6120 6368 756e  t provide a chun
+0001c340: 6b20 7368 6170 652e 0a0a 2020 2020 3e3e  k shape...    >>
+0001c350: 3e20 6120 3d20 6461 2e66 726f 6d5f 6172  > a = da.from_ar
+0001c360: 7261 7928 782c 2063 6875 6e6b 733d 2761  ray(x, chunks='a
+0001c370: 7574 6f27 2920 2023 2064 6f63 7465 7374  uto')  # doctest
+0001c380: 3a20 2b53 4b49 500a 2020 2020 3e3e 3e20  : +SKIP.    >>> 
+0001c390: 6120 3d20 6461 2e66 726f 6d5f 6172 7261  a = da.from_arra
+0001c3a0: 7928 782c 2063 6875 6e6b 733d 2731 3030  y(x, chunks='100
+0001c3b0: 204d 6942 2729 2020 2320 646f 6374 6573   MiB')  # doctes
+0001c3c0: 743a 202b 534b 4950 0a20 2020 203e 3e3e  t: +SKIP.    >>>
+0001c3d0: 2061 203d 2064 612e 6672 6f6d 5f61 7272   a = da.from_arr
+0001c3e0: 6179 2878 2920 2023 2064 6f63 7465 7374  ay(x)  # doctest
+0001c3f0: 3a20 2b53 4b49 500a 0a20 2020 2049 6620  : +SKIP..    If 
+0001c400: 7072 6f76 6964 696e 6720 6120 6e61 6d65  providing a name
+0001c410: 2c20 656e 7375 7265 2074 6861 7420 6974  , ensure that it
+0001c420: 2069 7320 756e 6971 7565 0a0a 2020 2020   is unique..    
+0001c430: 3e3e 3e20 696d 706f 7274 2064 6173 6b2e  >>> import dask.
+0001c440: 6261 7365 0a20 2020 203e 3e3e 2074 6f6b  base.    >>> tok
+0001c450: 656e 203d 2064 6173 6b2e 6261 7365 2e74  en = dask.base.t
+0001c460: 6f6b 656e 697a 6528 7829 2020 2320 646f  okenize(x)  # do
+0001c470: 6374 6573 743a 202b 534b 4950 0a20 2020  ctest: +SKIP.   
+0001c480: 203e 3e3e 2061 203d 2064 612e 6672 6f6d   >>> a = da.from
+0001c490: 5f61 7272 6179 2827 6d79 6172 7261 792d  _array('myarray-
+0001c4a0: 2720 2b20 746f 6b65 6e29 2020 2320 646f  ' + token)  # do
+0001c4b0: 6374 6573 743a 202b 534b 4950 0a0a 2020  ctest: +SKIP..  
+0001c4c0: 2020 4e75 6d50 7920 6e64 6172 7261 7973    NumPy ndarrays
+0001c4d0: 2061 7265 2065 6167 6572 6c79 2073 6c69   are eagerly sli
+0001c4e0: 6365 6420 616e 6420 7468 656e 2065 6d62  ced and then emb
+0001c4f0: 6564 6465 6420 696e 2074 6865 2067 7261  edded in the gra
+0001c500: 7068 2e0a 0a20 2020 203e 3e3e 2069 6d70  ph...    >>> imp
+0001c510: 6f72 7420 6461 736b 2e61 7272 6179 0a20  ort dask.array. 
+0001c520: 2020 203e 3e3e 2061 203d 2064 6173 6b2e     >>> a = dask.
+0001c530: 6172 7261 792e 6672 6f6d 5f61 7272 6179  array.from_array
+0001c540: 286e 702e 6172 7261 7928 5b5b 312c 2032  (np.array([[1, 2
+0001c550: 5d2c 205b 332c 2034 5d5d 292c 2063 6875  ], [3, 4]]), chu
+0001c560: 6e6b 733d 2831 2c31 2929 0a20 2020 203e  nks=(1,1)).    >
+0001c570: 3e3e 2061 2e64 6173 6b5b 612e 6e61 6d65  >> a.dask[a.name
+0001c580: 2c20 302c 2030 5d5b 305d 0a20 2020 2061  , 0, 0][0].    a
+0001c590: 7272 6179 285b 315d 290a 0a20 2020 2043  rray([1])..    C
+0001c5a0: 6875 6e6b 7320 7769 7468 2065 7861 6374  hunks with exact
+0001c5b0: 6c79 2d73 7065 6369 6669 6564 2c20 6469  ly-specified, di
+0001c5c0: 6666 6572 656e 7420 7369 7a65 7320 6361  fferent sizes ca
+0001c5d0: 6e20 6265 2063 7265 6174 6564 2e0a 0a20  n be created... 
+0001c5e0: 2020 203e 3e3e 2069 6d70 6f72 7420 6e75     >>> import nu
+0001c5f0: 6d70 7920 6173 206e 700a 2020 2020 3e3e  mpy as np.    >>
+0001c600: 3e20 696d 706f 7274 2064 6173 6b2e 6172  > import dask.ar
+0001c610: 7261 7920 6173 2064 610a 2020 2020 3e3e  ray as da.    >>
+0001c620: 3e20 726e 6720 3d20 6e70 2e72 616e 646f  > rng = np.rando
+0001c630: 6d2e 6465 6661 756c 745f 726e 6728 290a  m.default_rng().
+0001c640: 2020 2020 3e3e 3e20 7820 3d20 726e 672e      >>> x = rng.
+0001c650: 7261 6e64 6f6d 2828 3130 302c 2036 2929  random((100, 6))
+0001c660: 0a20 2020 203e 3e3e 2061 203d 2064 612e  .    >>> a = da.
+0001c670: 6672 6f6d 5f61 7272 6179 2878 2c20 6368  from_array(x, ch
+0001c680: 756e 6b73 3d28 2836 372c 2033 3329 2c20  unks=((67, 33), 
+0001c690: 2836 2c29 2929 0a20 2020 2022 2222 0a20  (6,))).    """. 
+0001c6a0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0001c6b0: 2878 2c20 4172 7261 7929 3a0a 2020 2020  (x, Array):.    
+0001c6c0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0001c6d0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0001c6e0: 2020 2241 7272 6179 2069 7320 616c 7265    "Array is alre
+0001c6f0: 6164 7920 6120 6461 736b 2061 7272 6179  ady a dask array
+0001c700: 2e20 5573 6520 2761 7361 7272 6179 2720  . Use 'asarray' 
+0001c710: 6f72 2027 7265 6368 756e 6b27 2069 6e73  or 'rechunk' ins
+0001c720: 7465 6164 2e22 0a20 2020 2020 2020 2029  tead.".        )
+0001c730: 0a20 2020 2065 6c69 6620 6973 5f64 6173  .    elif is_das
+0001c740: 6b5f 636f 6c6c 6563 7469 6f6e 2878 293a  k_collection(x):
+0001c750: 0a20 2020 2020 2020 2077 6172 6e69 6e67  .        warning
+0001c760: 732e 7761 726e 280a 2020 2020 2020 2020  s.warn(.        
+0001c770: 2020 2020 2250 6173 7369 6e67 2061 6e20      "Passing an 
+0001c780: 6f62 6a65 6374 2074 6f20 6461 736b 2e61  object to dask.a
+0001c790: 7272 6179 2e66 726f 6d5f 6172 7261 7920  rray.from_array 
+0001c7a0: 7768 6963 6820 6973 2061 6c72 6561 6479  which is already
+0001c7b0: 2061 2022 0a20 2020 2020 2020 2020 2020   a ".           
+0001c7c0: 2022 4461 736b 2063 6f6c 6c65 6374 696f   "Dask collectio
+0001c7d0: 6e2e 2054 6869 7320 6361 6e20 6c65 6164  n. This can lead
+0001c7e0: 2074 6f20 756e 6578 7065 6374 6564 2062   to unexpected b
+0001c7f0: 6568 6176 696f 722e 220a 2020 2020 2020  ehavior.".      
+0001c800: 2020 290a 0a20 2020 2069 6620 6973 696e    )..    if isin
+0001c810: 7374 616e 6365 2878 2c20 286c 6973 742c  stance(x, (list,
+0001c820: 2074 7570 6c65 2c20 6d65 6d6f 7279 7669   tuple, memoryvi
+0001c830: 6577 2920 2b20 6e70 2e53 6361 6c61 7254  ew) + np.ScalarT
+0001c840: 7970 6529 3a0a 2020 2020 2020 2020 7820  ype):.        x 
+0001c850: 3d20 6e70 2e61 7272 6179 2878 290a 0a20  = np.array(x).. 
+0001c860: 2020 2069 6620 6173 6172 7261 7920 6973     if asarray is
+0001c870: 204e 6f6e 653a 0a20 2020 2020 2020 2061   None:.        a
+0001c880: 7361 7272 6179 203d 206e 6f74 2068 6173  sarray = not has
+0001c890: 6174 7472 2878 2c20 225f 5f61 7272 6179  attr(x, "__array
+0001c8a0: 5f66 756e 6374 696f 6e5f 5f22 290a 0a20  _function__").. 
+0001c8b0: 2020 2070 7265 7669 6f75 735f 6368 756e     previous_chun
+0001c8c0: 6b73 203d 2067 6574 6174 7472 2878 2c20  ks = getattr(x, 
+0001c8d0: 2263 6875 6e6b 7322 2c20 4e6f 6e65 290a  "chunks", None).
+0001c8e0: 0a20 2020 2063 6875 6e6b 7320 3d20 6e6f  .    chunks = no
+0001c8f0: 726d 616c 697a 655f 6368 756e 6b73 280a  rmalize_chunks(.
+0001c900: 2020 2020 2020 2020 6368 756e 6b73 2c20          chunks, 
+0001c910: 782e 7368 6170 652c 2064 7479 7065 3d78  x.shape, dtype=x
+0001c920: 2e64 7479 7065 2c20 7072 6576 696f 7573  .dtype, previous
+0001c930: 5f63 6875 6e6b 733d 7072 6576 696f 7573  _chunks=previous
+0001c940: 5f63 6875 6e6b 730a 2020 2020 290a 0a20  _chunks.    ).. 
+0001c950: 2020 2069 6620 6e61 6d65 2069 6e20 284e     if name in (N
+0001c960: 6f6e 652c 2054 7275 6529 3a0a 2020 2020  one, True):.    
+0001c970: 2020 2020 746f 6b65 6e20 3d20 746f 6b65      token = toke
+0001c980: 6e69 7a65 2878 2c20 6368 756e 6b73 2c20  nize(x, chunks, 
+0001c990: 6c6f 636b 2c20 6173 6172 7261 792c 2066  lock, asarray, f
+0001c9a0: 616e 6379 2c20 6765 7469 7465 6d2c 2069  ancy, getitem, i
+0001c9b0: 6e6c 696e 655f 6172 7261 7929 0a20 2020  nline_array).   
+0001c9c0: 2020 2020 206e 616d 6520 3d20 6e61 6d65       name = name
+0001c9d0: 206f 7220 2261 7272 6179 2d22 202b 2074   or "array-" + t
+0001c9e0: 6f6b 656e 0a20 2020 2065 6c69 6620 6e61  oken.    elif na
+0001c9f0: 6d65 2069 7320 4661 6c73 653a 0a20 2020  me is False:.   
+0001ca00: 2020 2020 206e 616d 6520 3d20 2261 7272       name = "arr
+0001ca10: 6179 2d22 202b 2073 7472 2875 7569 642e  ay-" + str(uuid.
+0001ca20: 7575 6964 3128 2929 0a0a 2020 2020 6966  uuid1())..    if
+0001ca30: 206c 6f63 6b20 6973 2054 7275 653a 0a20   lock is True:. 
+0001ca40: 2020 2020 2020 206c 6f63 6b20 3d20 5365         lock = Se
+0001ca50: 7269 616c 697a 6162 6c65 4c6f 636b 2829  rializableLock()
+0001ca60: 0a0a 2020 2020 6973 5f6e 6461 7272 6179  ..    is_ndarray
+0001ca70: 203d 2074 7970 6528 7829 2069 6e20 286e   = type(x) in (n
+0001ca80: 702e 6e64 6172 7261 792c 206e 702e 6d61  p.ndarray, np.ma
+0001ca90: 2e63 6f72 652e 4d61 736b 6564 4172 7261  .core.MaskedArra
+0001caa0: 7929 0a20 2020 2069 735f 7369 6e67 6c65  y).    is_single
+0001cab0: 5f62 6c6f 636b 203d 2061 6c6c 286c 656e  _block = all(len
+0001cac0: 2863 2920 3d3d 2031 2066 6f72 2063 2069  (c) == 1 for c i
+0001cad0: 6e20 6368 756e 6b73 290a 2020 2020 2320  n chunks).    # 
+0001cae0: 416c 7761 7973 2075 7365 2074 6865 2067  Always use the g
+0001caf0: 6574 7465 7220 666f 7220 6835 7079 2065  etter for h5py e
+0001cb00: 7463 2e20 4e6f 7420 7573 696e 6720 6973  tc. Not using is
+0001cb10: 696e 7374 616e 6365 2878 2c20 6e70 2e6e  instance(x, np.n
+0001cb20: 6461 7272 6179 290a 2020 2020 2320 6265  darray).    # be
+0001cb30: 6361 7573 6520 6e70 2e6d 6174 7269 7820  cause np.matrix 
+0001cb40: 6973 2061 2073 7562 636c 6173 7320 6f66  is a subclass of
+0001cb50: 206e 702e 6e64 6172 7261 792e 0a20 2020   np.ndarray..   
+0001cb60: 2069 6620 6973 5f6e 6461 7272 6179 2061   if is_ndarray a
+0001cb70: 6e64 206e 6f74 2069 735f 7369 6e67 6c65  nd not is_single
+0001cb80: 5f62 6c6f 636b 2061 6e64 206e 6f74 206c  _block and not l
+0001cb90: 6f63 6b3a 0a20 2020 2020 2020 2023 2065  ock:.        # e
+0001cba0: 6167 6572 6c79 2073 6c69 6365 206e 756d  agerly slice num
+0001cbb0: 7079 2061 7272 6179 7320 746f 2070 7265  py arrays to pre
+0001cbc0: 7665 6e74 206d 656d 6f72 7920 626c 6f77  vent memory blow
+0001cbd0: 7570 0a20 2020 2020 2020 2023 2047 4835  up.        # GH5
+0001cbe0: 3336 372c 2047 4835 3630 310a 2020 2020  367, GH5601.    
+0001cbf0: 2020 2020 736c 6963 6573 203d 2073 6c69      slices = sli
+0001cc00: 6365 735f 6672 6f6d 5f63 6875 6e6b 7328  ces_from_chunks(
+0001cc10: 6368 756e 6b73 290a 2020 2020 2020 2020  chunks).        
+0001cc20: 6b65 7973 203d 2070 726f 6475 6374 285b  keys = product([
+0001cc30: 6e61 6d65 5d2c 202a 2872 616e 6765 286c  name], *(range(l
+0001cc40: 656e 2862 6473 2929 2066 6f72 2062 6473  en(bds)) for bds
+0001cc50: 2069 6e20 6368 756e 6b73 2929 0a20 2020   in chunks)).   
+0001cc60: 2020 2020 2076 616c 7565 7320 3d20 5b78       values = [x
+0001cc70: 5b73 6c63 5d20 666f 7220 736c 6320 696e  [slc] for slc in
+0001cc80: 2073 6c69 6365 735d 0a20 2020 2020 2020   slices].       
+0001cc90: 2064 736b 203d 2064 6963 7428 7a69 7028   dsk = dict(zip(
+0001cca0: 6b65 7973 2c20 7661 6c75 6573 2929 0a0a  keys, values))..
+0001ccb0: 2020 2020 656c 6966 2069 735f 6e64 6172      elif is_ndar
+0001ccc0: 7261 7920 616e 6420 6973 5f73 696e 676c  ray and is_singl
+0001ccd0: 655f 626c 6f63 6b3a 0a20 2020 2020 2020  e_block:.       
+0001cce0: 2023 204e 6f20 736c 6963 696e 6720 6e65   # No slicing ne
+0001ccf0: 6564 6564 0a20 2020 2020 2020 2064 736b  eded.        dsk
+0001cd00: 203d 207b 286e 616d 652c 2920 2b20 2830   = {(name,) + (0
+0001cd10: 2c29 202a 2078 2e6e 6469 6d3a 2078 7d0a  ,) * x.ndim: x}.
+0001cd20: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0001cd30: 2020 6966 2067 6574 6974 656d 2069 7320    if getitem is 
+0001cd40: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+0001cd50: 2020 6966 2066 616e 6379 3a0a 2020 2020    if fancy:.    
+0001cd60: 2020 2020 2020 2020 2020 2020 6765 7469              geti
+0001cd70: 7465 6d20 3d20 6765 7474 6572 0a20 2020  tem = getter.   
+0001cd80: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001cd90: 2020 2020 2020 2020 2020 2020 2020 2067                 g
+0001cda0: 6574 6974 656d 203d 2067 6574 7465 725f  etitem = getter_
+0001cdb0: 6e6f 6661 6e63 790a 0a20 2020 2020 2020  nofancy..       
+0001cdc0: 2064 736b 203d 2067 7261 7068 5f66 726f   dsk = graph_fro
+0001cdd0: 6d5f 6172 7261 796c 696b 6528 0a20 2020  m_arraylike(.   
+0001cde0: 2020 2020 2020 2020 2078 2c0a 2020 2020           x,.    
+0001cdf0: 2020 2020 2020 2020 6368 756e 6b73 2c0a          chunks,.
+0001ce00: 2020 2020 2020 2020 2020 2020 782e 7368              x.sh
+0001ce10: 6170 652c 0a20 2020 2020 2020 2020 2020  ape,.           
+0001ce20: 206e 616d 652c 0a20 2020 2020 2020 2020   name,.         
+0001ce30: 2020 2067 6574 6974 656d 3d67 6574 6974     getitem=getit
+0001ce40: 656d 2c0a 2020 2020 2020 2020 2020 2020  em,.            
+0001ce50: 6c6f 636b 3d6c 6f63 6b2c 0a20 2020 2020  lock=lock,.     
+0001ce60: 2020 2020 2020 2061 7361 7272 6179 3d61         asarray=a
+0001ce70: 7361 7272 6179 2c0a 2020 2020 2020 2020  sarray,.        
+0001ce80: 2020 2020 6474 7970 653d 782e 6474 7970      dtype=x.dtyp
+0001ce90: 652c 0a20 2020 2020 2020 2020 2020 2069  e,.            i
+0001cea0: 6e6c 696e 655f 6172 7261 793d 696e 6c69  nline_array=inli
+0001ceb0: 6e65 5f61 7272 6179 2c0a 2020 2020 2020  ne_array,.      
+0001cec0: 2020 290a 0a20 2020 2023 2057 6f72 6b61    )..    # Worka
+0001ced0: 726f 756e 6420 666f 7220 5469 6c65 4442  round for TileDB
+0001cee0: 2c20 6974 7320 696e 6465 7869 6e67 2069  , its indexing i
+0001cef0: 7320 312d 6261 7365 642c 0a20 2020 2023  s 1-based,.    #
+0001cf00: 2061 6e64 2064 6f65 736e 2774 2073 6565   and doesn't see
+0001cf10: 6d73 2074 6f20 7375 7070 6f72 7420 302d  ms to support 0-
+0001cf20: 6c65 6e67 7468 2073 6c69 6369 6e67 0a20  length slicing. 
+0001cf30: 2020 2069 6620 782e 5f5f 636c 6173 735f     if x.__class_
+0001cf40: 5f2e 5f5f 6d6f 6475 6c65 5f5f 2e73 706c  _.__module__.spl
+0001cf50: 6974 2822 2e22 295b 305d 203d 3d20 2274  it(".")[0] == "t
+0001cf60: 696c 6564 6222 2061 6e64 2068 6173 6174  iledb" and hasat
+0001cf70: 7472 2878 2c20 225f 6374 785f 2229 3a0a  tr(x, "_ctx_"):.
+0001cf80: 2020 2020 2020 2020 7265 7475 726e 2041          return A
+0001cf90: 7272 6179 2864 736b 2c20 6e61 6d65 2c20  rray(dsk, name, 
+0001cfa0: 6368 756e 6b73 2c20 6474 7970 653d 782e  chunks, dtype=x.
+0001cfb0: 6474 7970 6529 0a0a 2020 2020 6966 206d  dtype)..    if m
+0001cfc0: 6574 6120 6973 204e 6f6e 653a 0a20 2020  eta is None:.   
+0001cfd0: 2020 2020 206d 6574 6120 3d20 780a 0a20       meta = x.. 
+0001cfe0: 2020 2072 6574 7572 6e20 4172 7261 7928     return Array(
+0001cff0: 6473 6b2c 206e 616d 652c 2063 6875 6e6b  dsk, name, chunk
+0001d000: 732c 206d 6574 613d 6d65 7461 2c20 6474  s, meta=meta, dt
+0001d010: 7970 653d 6765 7461 7474 7228 782c 2022  ype=getattr(x, "
+0001d020: 6474 7970 6522 2c20 4e6f 6e65 2929 0a0a  dtype", None))..
+0001d030: 0a64 6566 2066 726f 6d5f 7a61 7272 280a  .def from_zarr(.
+0001d040: 2020 2020 7572 6c2c 0a20 2020 2063 6f6d      url,.    com
+0001d050: 706f 6e65 6e74 3d4e 6f6e 652c 0a20 2020  ponent=None,.   
+0001d060: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
+0001d070: 3d4e 6f6e 652c 0a20 2020 2063 6875 6e6b  =None,.    chunk
+0001d080: 733d 4e6f 6e65 2c0a 2020 2020 6e61 6d65  s=None,.    name
+0001d090: 3d4e 6f6e 652c 0a20 2020 2069 6e6c 696e  =None,.    inlin
+0001d0a0: 655f 6172 7261 793d 4661 6c73 652c 0a20  e_array=False,. 
+0001d0b0: 2020 202a 2a6b 7761 7267 732c 0a29 3a0a     **kwargs,.):.
+0001d0c0: 2020 2020 2222 224c 6f61 6420 6172 7261      """Load arra
+0001d0d0: 7920 6672 6f6d 2074 6865 207a 6172 7220  y from the zarr 
+0001d0e0: 7374 6f72 6167 6520 666f 726d 6174 0a0a  storage format..
+0001d0f0: 2020 2020 5365 6520 6874 7470 733a 2f2f      See https://
+0001d100: 7a61 7272 2e72 6561 6474 6865 646f 6373  zarr.readthedocs
+0001d110: 2e69 6f20 666f 7220 6465 7461 696c 7320  .io for details 
+0001d120: 6162 6f75 7420 7468 6520 666f 726d 6174  about the format
+0001d130: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+0001d140: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+0001d150: 0a20 2020 2075 726c 3a20 5a61 7272 2041  .    url: Zarr A
+0001d160: 7272 6179 206f 7220 7374 7220 6f72 204d  rray or str or M
+0001d170: 7574 6162 6c65 4d61 7070 696e 670a 2020  utableMapping.  
+0001d180: 2020 2020 2020 4c6f 6361 7469 6f6e 206f        Location o
+0001d190: 6620 7468 6520 6461 7461 2e20 4120 5552  f the data. A UR
+0001d1a0: 4c20 6361 6e20 696e 636c 7564 6520 6120  L can include a 
+0001d1b0: 7072 6f74 6f63 6f6c 2073 7065 6369 6669  protocol specifi
+0001d1c0: 6572 206c 696b 6520 7333 3a2f 2f0a 2020  er like s3://.  
+0001d1d0: 2020 2020 2020 666f 7220 7265 6d6f 7465        for remote
+0001d1e0: 2064 6174 612e 2043 616e 2061 6c73 6f20   data. Can also 
+0001d1f0: 6265 2061 6e79 204d 7574 6162 6c65 4d61  be any MutableMa
+0001d200: 7070 696e 6720 696e 7374 616e 6365 2c20  pping instance, 
+0001d210: 7768 6963 6820 7368 6f75 6c64 0a20 2020  which should.   
+0001d220: 2020 2020 2062 6520 7365 7269 616c 697a       be serializ
+0001d230: 6162 6c65 2069 6620 7573 6564 2069 6e20  able if used in 
+0001d240: 6d75 6c74 6970 6c65 2070 726f 6365 7373  multiple process
+0001d250: 6573 2e0a 2020 2020 636f 6d70 6f6e 656e  es..    componen
+0001d260: 743a 2073 7472 206f 7220 4e6f 6e65 0a20  t: str or None. 
+0001d270: 2020 2020 2020 2049 6620 7468 6520 6c6f         If the lo
+0001d280: 6361 7469 6f6e 2069 7320 6120 7a61 7272  cation is a zarr
+0001d290: 2067 726f 7570 2072 6174 6865 7220 7468   group rather th
+0001d2a0: 616e 2061 6e20 6172 7261 792c 2074 6869  an an array, thi
+0001d2b0: 7320 6973 2074 6865 0a20 2020 2020 2020  s is the.       
+0001d2c0: 2073 7562 636f 6d70 6f6e 656e 7420 7468   subcomponent th
+0001d2d0: 6174 2073 686f 756c 6420 6265 206c 6f61  at should be loa
+0001d2e0: 6465 642c 2073 6f6d 6574 6869 6e67 206c  ded, something l
+0001d2f0: 696b 6520 6060 2766 6f6f 2f62 6172 2760  ike ``'foo/bar'`
+0001d300: 602e 0a20 2020 2073 746f 7261 6765 5f6f  `..    storage_o
+0001d310: 7074 696f 6e73 3a20 6469 6374 0a20 2020  ptions: dict.   
+0001d320: 2020 2020 2041 6e79 2061 6464 6974 696f       Any additio
+0001d330: 6e61 6c20 7061 7261 6d65 7465 7273 2066  nal parameters f
+0001d340: 6f72 2074 6865 2073 746f 7261 6765 2062  or the storage b
+0001d350: 6163 6b65 6e64 2028 6967 6e6f 7265 6420  ackend (ignored 
+0001d360: 666f 7220 6c6f 6361 6c0a 2020 2020 2020  for local.      
+0001d370: 2020 7061 7468 7329 0a20 2020 2063 6875    paths).    chu
+0001d380: 6e6b 733a 2074 7570 6c65 206f 6620 696e  nks: tuple of in
+0001d390: 7473 206f 7220 7475 706c 6573 206f 6620  ts or tuples of 
+0001d3a0: 696e 7473 0a20 2020 2020 2020 2050 6173  ints.        Pas
+0001d3b0: 7365 6420 746f 203a 6675 6e63 3a60 6461  sed to :func:`da
+0001d3c0: 736b 2e61 7272 6179 2e66 726f 6d5f 6172  sk.array.from_ar
+0001d3d0: 7261 7960 2c20 616c 6c6f 7773 2073 6574  ray`, allows set
+0001d3e0: 7469 6e67 2074 6865 2063 6875 6e6b 7320  ting the chunks 
+0001d3f0: 6f6e 0a20 2020 2020 2020 2069 6e69 7469  on.        initi
+0001d400: 616c 6973 6174 696f 6e2c 2069 6620 7468  alisation, if th
+0001d410: 6520 6368 756e 6b69 6e67 2073 6368 656d  e chunking schem
+0001d420: 6520 696e 2074 6865 206f 6e2d 6469 7363  e in the on-disc
+0001d430: 2064 6174 6173 6574 2069 7320 6e6f 740a   dataset is not.
+0001d440: 2020 2020 2020 2020 6f70 7469 6d61 6c20          optimal 
+0001d450: 666f 7220 7468 6520 6361 6c63 756c 6174  for the calculat
+0001d460: 696f 6e73 2074 6f20 666f 6c6c 6f77 2e0a  ions to follow..
+0001d470: 2020 2020 6e61 6d65 203a 2073 7472 2c20      name : str, 
+0001d480: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
+0001d490: 2020 416e 206f 7074 696f 6e61 6c20 6b65    An optional ke
+0001d4a0: 796e 616d 6520 666f 7220 7468 6520 6172  yname for the ar
+0001d4b0: 7261 792e 2020 4465 6661 756c 7473 2074  ray.  Defaults t
+0001d4c0: 6f20 6861 7368 696e 6720 7468 6520 696e  o hashing the in
+0001d4d0: 7075 740a 2020 2020 6b77 6172 6773 3a0a  put.    kwargs:.
+0001d4e0: 2020 2020 2020 2020 5061 7373 6564 2074          Passed t
+0001d4f0: 6f20 3a63 6c61 7373 3a60 7a61 7272 2e63  o :class:`zarr.c
+0001d500: 6f72 652e 4172 7261 7960 2e0a 2020 2020  ore.Array`..    
+0001d510: 696e 6c69 6e65 5f61 7272 6179 203a 2062  inline_array : b
+0001d520: 6f6f 6c2c 2064 6566 6175 6c74 2046 616c  ool, default Fal
+0001d530: 7365 0a20 2020 2020 2020 2057 6865 7468  se.        Wheth
+0001d540: 6572 2074 6f20 696e 6c69 6e65 2074 6865  er to inline the
+0001d550: 207a 6172 7220 4172 7261 7920 696e 2074   zarr Array in t
+0001d560: 6865 2076 616c 7565 7320 6f66 2074 6865  he values of the
+0001d570: 2074 6173 6b20 6772 6170 682e 0a20 2020   task graph..   
+0001d580: 2020 2020 2053 6565 203a 6d65 7468 3a60       See :meth:`
+0001d590: 6461 736b 2e61 7272 6179 2e66 726f 6d5f  dask.array.from_
+0001d5a0: 6172 7261 7960 2066 6f72 2061 6e20 6578  array` for an ex
+0001d5b0: 706c 616e 6174 696f 6e2e 0a0a 2020 2020  planation...    
+0001d5c0: 5365 6520 416c 736f 0a20 2020 202d 2d2d  See Also.    ---
+0001d5d0: 2d2d 2d2d 2d0a 2020 2020 6672 6f6d 5f61  -----.    from_a
+0001d5e0: 7272 6179 0a20 2020 2022 2222 0a20 2020  rray.    """.   
+0001d5f0: 2069 6d70 6f72 7420 7a61 7272 0a0a 2020   import zarr..  
+0001d600: 2020 7374 6f72 6167 655f 6f70 7469 6f6e    storage_option
+0001d610: 7320 3d20 7374 6f72 6167 655f 6f70 7469  s = storage_opti
+0001d620: 6f6e 7320 6f72 207b 7d0a 2020 2020 6966  ons or {}.    if
+0001d630: 2069 7369 6e73 7461 6e63 6528 7572 6c2c   isinstance(url,
+0001d640: 207a 6172 722e 4172 7261 7929 3a0a 2020   zarr.Array):.  
+0001d650: 2020 2020 2020 7a20 3d20 7572 6c0a 2020        z = url.  
+0001d660: 2020 656c 6966 2069 7369 6e73 7461 6e63    elif isinstanc
+0001d670: 6528 7572 6c2c 2028 7374 722c 206f 732e  e(url, (str, os.
+0001d680: 5061 7468 4c69 6b65 2929 3a0a 2020 2020  PathLike)):.    
+0001d690: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0001d6a0: 6528 7572 6c2c 206f 732e 5061 7468 4c69  e(url, os.PathLi
+0001d6b0: 6b65 293a 0a20 2020 2020 2020 2020 2020  ke):.           
+0001d6c0: 2075 726c 203d 206f 732e 6673 7061 7468   url = os.fspath
+0001d6d0: 2875 726c 290a 2020 2020 2020 2020 6966  (url).        if
+0001d6e0: 2073 746f 7261 6765 5f6f 7074 696f 6e73   storage_options
+0001d6f0: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
+0001d700: 6f72 6520 3d20 7a61 7272 2e73 746f 7261  ore = zarr.stora
+0001d710: 6765 2e46 5353 746f 7265 2875 726c 2c20  ge.FSStore(url, 
+0001d720: 2a2a 7374 6f72 6167 655f 6f70 7469 6f6e  **storage_option
+0001d730: 7329 0a20 2020 2020 2020 2065 6c73 653a  s).        else:
+0001d740: 0a20 2020 2020 2020 2020 2020 2073 746f  .            sto
+0001d750: 7265 203d 2075 726c 0a20 2020 2020 2020  re = url.       
+0001d760: 207a 203d 207a 6172 722e 4172 7261 7928   z = zarr.Array(
+0001d770: 7374 6f72 652c 2072 6561 645f 6f6e 6c79  store, read_only
+0001d780: 3d54 7275 652c 2070 6174 683d 636f 6d70  =True, path=comp
+0001d790: 6f6e 656e 742c 202a 2a6b 7761 7267 7329  onent, **kwargs)
+0001d7a0: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+0001d7b0: 2020 207a 203d 207a 6172 722e 4172 7261     z = zarr.Arra
+0001d7c0: 7928 7572 6c2c 2072 6561 645f 6f6e 6c79  y(url, read_only
+0001d7d0: 3d54 7275 652c 2070 6174 683d 636f 6d70  =True, path=comp
+0001d7e0: 6f6e 656e 742c 202a 2a6b 7761 7267 7329  onent, **kwargs)
+0001d7f0: 0a20 2020 2063 6875 6e6b 7320 3d20 6368  .    chunks = ch
+0001d800: 756e 6b73 2069 6620 6368 756e 6b73 2069  unks if chunks i
+0001d810: 7320 6e6f 7420 4e6f 6e65 2065 6c73 6520  s not None else 
+0001d820: 7a2e 6368 756e 6b73 0a20 2020 2069 6620  z.chunks.    if 
+0001d830: 6e61 6d65 2069 7320 4e6f 6e65 3a0a 2020  name is None:.  
+0001d840: 2020 2020 2020 6e61 6d65 203d 2022 6672        name = "fr
+0001d850: 6f6d 2d7a 6172 722d 2220 2b20 746f 6b65  om-zarr-" + toke
+0001d860: 6e69 7a65 287a 2c20 636f 6d70 6f6e 656e  nize(z, componen
+0001d870: 742c 2073 746f 7261 6765 5f6f 7074 696f  t, storage_optio
+0001d880: 6e73 2c20 6368 756e 6b73 2c20 2a2a 6b77  ns, chunks, **kw
+0001d890: 6172 6773 290a 2020 2020 7265 7475 726e  args).    return
+0001d8a0: 2066 726f 6d5f 6172 7261 7928 7a2c 2063   from_array(z, c
+0001d8b0: 6875 6e6b 732c 206e 616d 653d 6e61 6d65  hunks, name=name
+0001d8c0: 2c20 696e 6c69 6e65 5f61 7272 6179 3d69  , inline_array=i
+0001d8d0: 6e6c 696e 655f 6172 7261 7929 0a0a 0a64  nline_array)...d
+0001d8e0: 6566 2074 6f5f 7a61 7272 280a 2020 2020  ef to_zarr(.    
+0001d8f0: 6172 722c 0a20 2020 2075 726c 2c0a 2020  arr,.    url,.  
+0001d900: 2020 636f 6d70 6f6e 656e 743d 4e6f 6e65    component=None
+0001d910: 2c0a 2020 2020 7374 6f72 6167 655f 6f70  ,.    storage_op
+0001d920: 7469 6f6e 733d 4e6f 6e65 2c0a 2020 2020  tions=None,.    
+0001d930: 6f76 6572 7772 6974 653d 4661 6c73 652c  overwrite=False,
+0001d940: 0a20 2020 2072 6567 696f 6e3d 4e6f 6e65  .    region=None
+0001d950: 2c0a 2020 2020 636f 6d70 7574 653d 5472  ,.    compute=Tr
+0001d960: 7565 2c0a 2020 2020 7265 7475 726e 5f73  ue,.    return_s
+0001d970: 746f 7265 643d 4661 6c73 652c 0a20 2020  tored=False,.   
+0001d980: 202a 2a6b 7761 7267 732c 0a29 3a0a 2020   **kwargs,.):.  
+0001d990: 2020 2222 2253 6176 6520 6172 7261 7920    """Save array 
+0001d9a0: 746f 2074 6865 207a 6172 7220 7374 6f72  to the zarr stor
+0001d9b0: 6167 6520 666f 726d 6174 0a0a 2020 2020  age format..    
+0001d9c0: 5365 6520 6874 7470 733a 2f2f 7a61 7272  See https://zarr
+0001d9d0: 2e72 6561 6474 6865 646f 6373 2e69 6f20  .readthedocs.io 
+0001d9e0: 666f 7220 6465 7461 696c 7320 6162 6f75  for details abou
+0001d9f0: 7420 7468 6520 666f 726d 6174 2e0a 0a20  t the format... 
+0001da00: 2020 2050 6172 616d 6574 6572 730a 2020     Parameters.  
+0001da10: 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020    ----------.   
+0001da20: 2061 7272 3a20 6461 736b 2e61 7272 6179   arr: dask.array
+0001da30: 0a20 2020 2020 2020 2044 6174 6120 746f  .        Data to
+0001da40: 2073 746f 7265 0a20 2020 2075 726c 3a20   store.    url: 
+0001da50: 5a61 7272 2041 7272 6179 206f 7220 7374  Zarr Array or st
+0001da60: 7220 6f72 204d 7574 6162 6c65 4d61 7070  r or MutableMapp
+0001da70: 696e 670a 2020 2020 2020 2020 4c6f 6361  ing.        Loca
+0001da80: 7469 6f6e 206f 6620 7468 6520 6461 7461  tion of the data
+0001da90: 2e20 4120 5552 4c20 6361 6e20 696e 636c  . A URL can incl
+0001daa0: 7564 6520 6120 7072 6f74 6f63 6f6c 2073  ude a protocol s
+0001dab0: 7065 6369 6669 6572 206c 696b 6520 7333  pecifier like s3
+0001dac0: 3a2f 2f0a 2020 2020 2020 2020 666f 7220  ://.        for 
+0001dad0: 7265 6d6f 7465 2064 6174 612e 2043 616e  remote data. Can
+0001dae0: 2061 6c73 6f20 6265 2061 6e79 204d 7574   also be any Mut
+0001daf0: 6162 6c65 4d61 7070 696e 6720 696e 7374  ableMapping inst
+0001db00: 616e 6365 2c20 7768 6963 6820 7368 6f75  ance, which shou
+0001db10: 6c64 0a20 2020 2020 2020 2062 6520 7365  ld.        be se
+0001db20: 7269 616c 697a 6162 6c65 2069 6620 7573  rializable if us
+0001db30: 6564 2069 6e20 6d75 6c74 6970 6c65 2070  ed in multiple p
+0001db40: 726f 6365 7373 6573 2e0a 2020 2020 636f  rocesses..    co
+0001db50: 6d70 6f6e 656e 743a 2073 7472 206f 7220  mponent: str or 
+0001db60: 4e6f 6e65 0a20 2020 2020 2020 2049 6620  None.        If 
+0001db70: 7468 6520 6c6f 6361 7469 6f6e 2069 7320  the location is 
+0001db80: 6120 7a61 7272 2067 726f 7570 2072 6174  a zarr group rat
+0001db90: 6865 7220 7468 616e 2061 6e20 6172 7261  her than an arra
+0001dba0: 792c 2074 6869 7320 6973 2074 6865 0a20  y, this is the. 
+0001dbb0: 2020 2020 2020 2073 7562 636f 6d70 6f6e         subcompon
+0001dbc0: 656e 7420 7468 6174 2073 686f 756c 6420  ent that should 
+0001dbd0: 6265 2063 7265 6174 6564 2f6f 7665 722d  be created/over-
+0001dbe0: 7772 6974 7465 6e2e 0a20 2020 2073 746f  written..    sto
+0001dbf0: 7261 6765 5f6f 7074 696f 6e73 3a20 6469  rage_options: di
+0001dc00: 6374 0a20 2020 2020 2020 2041 6e79 2061  ct.        Any a
+0001dc10: 6464 6974 696f 6e61 6c20 7061 7261 6d65  dditional parame
+0001dc20: 7465 7273 2066 6f72 2074 6865 2073 746f  ters for the sto
+0001dc30: 7261 6765 2062 6163 6b65 6e64 2028 6967  rage backend (ig
+0001dc40: 6e6f 7265 6420 666f 7220 6c6f 6361 6c0a  nored for local.
+0001dc50: 2020 2020 2020 2020 7061 7468 7329 0a20          paths). 
+0001dc60: 2020 206f 7665 7277 7269 7465 3a20 626f     overwrite: bo
+0001dc70: 6f6c 0a20 2020 2020 2020 2049 6620 6769  ol.        If gi
+0001dc80: 7665 6e20 6172 7261 7920 616c 7265 6164  ven array alread
+0001dc90: 7920 6578 6973 7473 2c20 6f76 6572 7772  y exists, overwr
+0001dca0: 6974 653d 4661 6c73 6520 7769 6c6c 2063  ite=False will c
+0001dcb0: 6175 7365 2061 6e20 6572 726f 722c 0a20  ause an error,. 
+0001dcc0: 2020 2020 2020 2077 6865 7265 206f 7665         where ove
+0001dcd0: 7277 7269 7465 3d54 7275 6520 7769 6c6c  rwrite=True will
+0001dce0: 2072 6570 6c61 6365 2074 6865 2065 7869   replace the exi
+0001dcf0: 7374 696e 6720 6461 7461 2e0a 2020 2020  sting data..    
+0001dd00: 7265 6769 6f6e 3a20 7475 706c 6520 6f66  region: tuple of
+0001dd10: 2073 6c69 6365 7320 6f72 204e 6f6e 650a   slices or None.
+0001dd20: 2020 2020 2020 2020 5468 6520 7265 6769          The regi
+0001dd30: 6f6e 206f 6620 6461 7461 2074 6861 7420  on of data that 
+0001dd40: 7368 6f75 6c64 2062 6520 7772 6974 7465  should be writte
+0001dd50: 6e20 6966 2060 6075 726c 6060 2069 7320  n if ``url`` is 
+0001dd60: 6120 7a61 7272 2e41 7272 6179 2e0a 2020  a zarr.Array..  
+0001dd70: 2020 2020 2020 4e6f 7420 746f 2062 6520        Not to be 
+0001dd80: 7573 6564 2077 6974 6820 6f74 6865 7220  used with other 
+0001dd90: 7479 7065 7320 6f66 2060 6075 726c 6060  types of ``url``
+0001dda0: 2e0a 2020 2020 636f 6d70 7574 653a 2062  ..    compute: b
+0001ddb0: 6f6f 6c0a 2020 2020 2020 2020 5365 6520  ool.        See 
+0001ddc0: 3a66 756e 633a 607e 6461 736b 2e61 7272  :func:`~dask.arr
+0001ddd0: 6179 2e73 746f 7265 6020 666f 7220 6d6f  ay.store` for mo
+0001dde0: 7265 2064 6574 6169 6c73 2e0a 2020 2020  re details..    
+0001ddf0: 7265 7475 726e 5f73 746f 7265 643a 2062  return_stored: b
+0001de00: 6f6f 6c0a 2020 2020 2020 2020 5365 6520  ool.        See 
+0001de10: 3a66 756e 633a 607e 6461 736b 2e61 7272  :func:`~dask.arr
+0001de20: 6179 2e73 746f 7265 6020 666f 7220 6d6f  ay.store` for mo
+0001de30: 7265 2064 6574 6169 6c73 2e0a 2020 2020  re details..    
+0001de40: 2a2a 6b77 6172 6773 3a0a 2020 2020 2020  **kwargs:.      
+0001de50: 2020 5061 7373 6564 2074 6f20 7468 6520    Passed to the 
+0001de60: 3a66 756e 633a 607a 6172 722e 6372 6561  :func:`zarr.crea
+0001de70: 7469 6f6e 2e63 7265 6174 6560 2066 756e  tion.create` fun
+0001de80: 6374 696f 6e2c 2065 2e67 2e2c 2063 6f6d  ction, e.g., com
+0001de90: 7072 6573 7369 6f6e 206f 7074 696f 6e73  pression options
+0001dea0: 2e0a 0a20 2020 2052 6169 7365 730a 2020  ...    Raises.  
+0001deb0: 2020 2d2d 2d2d 2d2d 0a20 2020 2056 616c    ------.    Val
+0001dec0: 7565 4572 726f 720a 2020 2020 2020 2020  ueError.        
+0001ded0: 4966 2060 6061 7272 6060 2068 6173 2075  If ``arr`` has u
+0001dee0: 6e6b 6e6f 776e 2063 6875 6e6b 2073 697a  nknown chunk siz
+0001def0: 6573 2c20 7768 6963 6820 6973 206e 6f74  es, which is not
+0001df00: 2073 7570 706f 7274 6564 2062 7920 5a61   supported by Za
+0001df10: 7272 2e0a 2020 2020 2020 2020 4966 2060  rr..        If `
+0001df20: 6072 6567 696f 6e60 6020 6973 2073 7065  `region`` is spe
+0001df30: 6369 6669 6564 2061 6e64 2060 6075 726c  cified and ``url
+0001df40: 6060 2069 7320 6e6f 7420 6120 7a61 7272  `` is not a zarr
+0001df50: 2e41 7272 6179 0a0a 2020 2020 5365 6520  .Array..    See 
+0001df60: 416c 736f 0a20 2020 202d 2d2d 2d2d 2d2d  Also.    -------
+0001df70: 2d0a 2020 2020 6461 736b 2e61 7272 6179  -.    dask.array
+0001df80: 2e73 746f 7265 0a20 2020 2064 6173 6b2e  .store.    dask.
+0001df90: 6172 7261 792e 4172 7261 792e 636f 6d70  array.Array.comp
+0001dfa0: 7574 655f 6368 756e 6b5f 7369 7a65 730a  ute_chunk_sizes.
+0001dfb0: 0a20 2020 2022 2222 0a20 2020 2069 6d70  .    """.    imp
+0001dfc0: 6f72 7420 7a61 7272 0a0a 2020 2020 6966  ort zarr..    if
+0001dfd0: 206e 702e 6973 6e61 6e28 6172 722e 7368   np.isnan(arr.sh
+0001dfe0: 6170 6529 2e61 6e79 2829 3a0a 2020 2020  ape).any():.    
+0001dff0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0001e000: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+0001e010: 2020 2253 6176 696e 6720 6120 6461 736b    "Saving a dask
+0001e020: 2061 7272 6179 2077 6974 6820 756e 6b6e   array with unkn
+0001e030: 6f77 6e20 6368 756e 6b20 7369 7a65 7320  own chunk sizes 
+0001e040: 6973 206e 6f74 2022 0a20 2020 2020 2020  is not ".       
+0001e050: 2020 2020 2022 6375 7272 656e 746c 7920       "currently 
+0001e060: 7375 7070 6f72 7465 6420 6279 205a 6172  supported by Zar
+0001e070: 722e 2573 2220 2520 756e 6b6e 6f77 6e5f  r.%s" % unknown_
+0001e080: 6368 756e 6b5f 6d65 7373 6167 650a 2020  chunk_message.  
+0001e090: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
+0001e0a0: 6973 696e 7374 616e 6365 2875 726c 2c20  isinstance(url, 
+0001e0b0: 7a61 7272 2e41 7272 6179 293a 0a20 2020  zarr.Array):.   
+0001e0c0: 2020 2020 207a 203d 2075 726c 0a20 2020       z = url.   
+0001e0d0: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0001e0e0: 6365 287a 2e73 746f 7265 2c20 2864 6963  ce(z.store, (dic
+0001e0f0: 742c 207a 6172 722e 7374 6f72 6167 652e  t, zarr.storage.
+0001e100: 4d65 6d6f 7279 5374 6f72 652c 207a 6172  MemoryStore, zar
+0001e110: 722e 7374 6f72 6167 652e 4b56 5374 6f72  r.storage.KVStor
+0001e120: 6529 293a 0a20 2020 2020 2020 2020 2020  e)):.           
+0001e130: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0001e140: 2020 2020 2020 6672 6f6d 2064 6973 7472        from distr
+0001e150: 6962 7574 6564 2069 6d70 6f72 7420 6465  ibuted import de
+0001e160: 6661 756c 745f 636c 6965 6e74 0a0a 2020  fault_client..  
+0001e170: 2020 2020 2020 2020 2020 2020 2020 6465                de
+0001e180: 6661 756c 745f 636c 6965 6e74 2829 0a20  fault_client(). 
+0001e190: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0001e1a0: 7420 2849 6d70 6f72 7445 7272 6f72 2c20  t (ImportError, 
+0001e1b0: 5661 6c75 6545 7272 6f72 293a 0a20 2020  ValueError):.   
+0001e1c0: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+0001e1d0: 730a 2020 2020 2020 2020 2020 2020 656c  s.            el
+0001e1e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001e1f0: 2020 2020 7261 6973 6520 5275 6e74 696d      raise Runtim
+0001e200: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+0001e210: 2020 2020 2020 2020 2020 2020 2243 616e              "Can
+0001e220: 6e6f 7420 7374 6f72 6520 696e 746f 2069  not store into i
+0001e230: 6e20 6d65 6d6f 7279 205a 6172 7220 4172  n memory Zarr Ar
+0001e240: 7261 7920 7573 696e 6720 220a 2020 2020  ray using ".    
 0001e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e260: 2020 2274 6865 2064 6973 7472 6962 7574    "the distribut
-0001e270: 6564 2073 6368 6564 756c 6572 2e22 0a20  ed scheduler.". 
-0001e280: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001e290: 0a0a 2020 2020 2020 2020 6966 2072 6567  ..        if reg
-0001e2a0: 696f 6e20 6973 204e 6f6e 653a 0a20 2020  ion is None:.   
-0001e2b0: 2020 2020 2020 2020 2061 7272 203d 2061           arr = a
-0001e2c0: 7272 2e72 6563 6875 6e6b 287a 2e63 6875  rr.rechunk(z.chu
-0001e2d0: 6e6b 7329 0a20 2020 2020 2020 2020 2020  nks).           
-0001e2e0: 2072 6567 696f 6e73 203d 204e 6f6e 650a   regions = None.
-0001e2f0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0001e300: 2020 2020 2020 2020 2020 6672 6f6d 2064            from d
-0001e310: 6173 6b2e 6172 7261 792e 736c 6963 696e  ask.array.slicin
-0001e320: 6720 696d 706f 7274 206e 6577 5f62 6c6f  g import new_blo
-0001e330: 636b 6469 6d2c 206e 6f72 6d61 6c69 7a65  ckdim, normalize
-0001e340: 5f69 6e64 6578 0a0a 2020 2020 2020 2020  _index..        
-0001e350: 2020 2020 6f6c 645f 6368 756e 6b73 203d      old_chunks =
-0001e360: 206e 6f72 6d61 6c69 7a65 5f63 6875 6e6b   normalize_chunk
-0001e370: 7328 7a2e 6368 756e 6b73 2c20 7a2e 7368  s(z.chunks, z.sh
-0001e380: 6170 6529 0a20 2020 2020 2020 2020 2020  ape).           
-0001e390: 2069 6e64 6578 203d 206e 6f72 6d61 6c69   index = normali
-0001e3a0: 7a65 5f69 6e64 6578 2872 6567 696f 6e2c  ze_index(region,
-0001e3b0: 207a 2e73 6861 7065 290a 2020 2020 2020   z.shape).      
-0001e3c0: 2020 2020 2020 6368 756e 6b73 203d 2074        chunks = t
-0001e3d0: 7570 6c65 280a 2020 2020 2020 2020 2020  uple(.          
-0001e3e0: 2020 2020 2020 7475 706c 6528 6e65 775f        tuple(new_
-0001e3f0: 626c 6f63 6b64 696d 2873 2c20 632c 2072  blockdim(s, c, r
-0001e400: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0001e410: 2020 2066 6f72 2073 2c20 632c 2072 2069     for s, c, r i
-0001e420: 6e20 7a69 7028 7a2e 7368 6170 652c 206f  n zip(z.shape, o
-0001e430: 6c64 5f63 6875 6e6b 732c 2069 6e64 6578  ld_chunks, index
-0001e440: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0001e450: 2020 2020 2020 2020 2020 2020 6172 7220              arr 
-0001e460: 3d20 6172 722e 7265 6368 756e 6b28 6368  = arr.rechunk(ch
-0001e470: 756e 6b73 290a 2020 2020 2020 2020 2020  unks).          
-0001e480: 2020 7265 6769 6f6e 7320 3d20 5b72 6567    regions = [reg
-0001e490: 696f 6e5d 0a20 2020 2020 2020 2072 6574  ion].        ret
-0001e4a0: 7572 6e20 6172 722e 7374 6f72 6528 0a20  urn arr.store(. 
-0001e4b0: 2020 2020 2020 2020 2020 207a 2c20 6c6f             z, lo
-0001e4c0: 636b 3d46 616c 7365 2c20 7265 6769 6f6e  ck=False, region
-0001e4d0: 733d 7265 6769 6f6e 732c 2063 6f6d 7075  s=regions, compu
-0001e4e0: 7465 3d63 6f6d 7075 7465 2c20 7265 7475  te=compute, retu
-0001e4f0: 726e 5f73 746f 7265 643d 7265 7475 726e  rn_stored=return
-0001e500: 5f73 746f 7265 640a 2020 2020 2020 2020  _stored.        
-0001e510: 290a 0a20 2020 2069 6620 7265 6769 6f6e  )..    if region
-0001e520: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
-0001e530: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-0001e540: 6545 7272 6f72 2822 4361 6e6e 6f74 2075  eError("Cannot u
-0001e550: 7365 2060 7265 6769 6f6e 6020 6b65 7977  se `region` keyw
-0001e560: 6f72 6420 7768 656e 2075 726c 2069 7320  ord when url is 
-0001e570: 6e6f 7420 6120 607a 6172 722e 4172 7261  not a `zarr.Arra
-0001e580: 7960 2e22 290a 0a20 2020 2069 6620 6e6f  y`.")..    if no
-0001e590: 7420 5f63 6865 636b 5f72 6567 756c 6172  t _check_regular
-0001e5a0: 5f63 6875 6e6b 7328 6172 722e 6368 756e  _chunks(arr.chun
-0001e5b0: 6b73 293a 0a20 2020 2020 2020 2072 6169  ks):.        rai
-0001e5c0: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-0001e5d0: 2020 2020 2020 2020 2020 2022 4174 7465             "Atte
-0001e5e0: 6d70 7420 746f 2073 6176 6520 6172 7261  mpt to save arra
-0001e5f0: 7920 746f 207a 6172 7220 7769 7468 2069  y to zarr with i
-0001e600: 7272 6567 756c 6172 2022 0a20 2020 2020  rregular ".     
-0001e610: 2020 2020 2020 2022 6368 756e 6b69 6e67         "chunking
-0001e620: 2c20 706c 6561 7365 2063 616c 6c20 6061  , please call `a
-0001e630: 7272 2e72 6563 6875 6e6b 282e 2e2e 2960  rr.rechunk(...)`
-0001e640: 2066 6972 7374 2e22 0a20 2020 2020 2020   first.".       
-0001e650: 2029 0a0a 2020 2020 7374 6f72 6167 655f   )..    storage_
-0001e660: 6f70 7469 6f6e 7320 3d20 7374 6f72 6167  options = storag
-0001e670: 655f 6f70 7469 6f6e 7320 6f72 207b 7d0a  e_options or {}.
-0001e680: 0a20 2020 2069 6620 7374 6f72 6167 655f  .    if storage_
-0001e690: 6f70 7469 6f6e 733a 0a20 2020 2020 2020  options:.       
-0001e6a0: 2073 746f 7265 203d 207a 6172 722e 7374   store = zarr.st
-0001e6b0: 6f72 6167 652e 4653 5374 6f72 6528 7572  orage.FSStore(ur
-0001e6c0: 6c2c 202a 2a73 746f 7261 6765 5f6f 7074  l, **storage_opt
-0001e6d0: 696f 6e73 290a 2020 2020 656c 7365 3a0a  ions).    else:.
-0001e6e0: 2020 2020 2020 2020 7374 6f72 6520 3d20          store = 
-0001e6f0: 7572 6c0a 0a20 2020 2063 6875 6e6b 7320  url..    chunks 
-0001e700: 3d20 5b63 5b30 5d20 666f 7220 6320 696e  = [c[0] for c in
-0001e710: 2061 7272 2e63 6875 6e6b 735d 0a0a 2020   arr.chunks]..  
-0001e720: 2020 7a20 3d20 7a61 7272 2e63 7265 6174    z = zarr.creat
-0001e730: 6528 0a20 2020 2020 2020 2073 6861 7065  e(.        shape
-0001e740: 3d61 7272 2e73 6861 7065 2c0a 2020 2020  =arr.shape,.    
-0001e750: 2020 2020 6368 756e 6b73 3d63 6875 6e6b      chunks=chunk
-0001e760: 732c 0a20 2020 2020 2020 2064 7479 7065  s,.        dtype
-0001e770: 3d61 7272 2e64 7479 7065 2c0a 2020 2020  =arr.dtype,.    
-0001e780: 2020 2020 7374 6f72 653d 7374 6f72 652c      store=store,
-0001e790: 0a20 2020 2020 2020 2070 6174 683d 636f  .        path=co
-0001e7a0: 6d70 6f6e 656e 742c 0a20 2020 2020 2020  mponent,.       
-0001e7b0: 206f 7665 7277 7269 7465 3d6f 7665 7277   overwrite=overw
-0001e7c0: 7269 7465 2c0a 2020 2020 2020 2020 2a2a  rite,.        **
-0001e7d0: 6b77 6172 6773 2c0a 2020 2020 290a 2020  kwargs,.    ).  
-0001e7e0: 2020 7265 7475 726e 2061 7272 2e73 746f    return arr.sto
-0001e7f0: 7265 287a 2c20 6c6f 636b 3d46 616c 7365  re(z, lock=False
-0001e800: 2c20 636f 6d70 7574 653d 636f 6d70 7574  , compute=comput
-0001e810: 652c 2072 6574 7572 6e5f 7374 6f72 6564  e, return_stored
-0001e820: 3d72 6574 7572 6e5f 7374 6f72 6564 290a  =return_stored).
-0001e830: 0a0a 6465 6620 5f63 6865 636b 5f72 6567  ..def _check_reg
-0001e840: 756c 6172 5f63 6875 6e6b 7328 6368 756e  ular_chunks(chun
-0001e850: 6b73 6574 293a 0a20 2020 2022 2222 4368  kset):.    """Ch
-0001e860: 6563 6b20 6966 2074 6865 2063 6875 6e6b  eck if the chunk
-0001e870: 7320 6172 6520 7265 6775 6c61 720a 0a20  s are regular.. 
-0001e880: 2020 2022 5265 6775 6c61 7222 2069 6e20     "Regular" in 
-0001e890: 7468 6973 2063 6f6e 7465 7874 206d 6561  this context mea
-0001e8a0: 6e73 2074 6861 7420 616c 6f6e 6720 6576  ns that along ev
-0001e8b0: 6572 7920 6178 6973 2c20 7468 6520 6368  ery axis, the ch
-0001e8c0: 756e 6b73 2061 6c6c 0a20 2020 2068 6176  unks all.    hav
-0001e8d0: 6520 7468 6520 7361 6d65 2073 697a 652c  e the same size,
-0001e8e0: 2065 7863 6570 7420 7468 6520 6c61 7374   except the last
-0001e8f0: 206f 6e65 2c20 7768 6963 6820 6d61 7920   one, which may 
-0001e900: 6265 2073 6d61 6c6c 6572 0a0a 2020 2020  be smaller..    
-0001e910: 5061 7261 6d65 7465 7273 0a20 2020 202d  Parameters.    -
-0001e920: 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020 6368  ---------.    ch
-0001e930: 756e 6b73 6574 3a20 7475 706c 6520 6f66  unkset: tuple of
-0001e940: 2074 7570 6c65 7320 6f66 2069 6e74 730a   tuples of ints.
-0001e950: 2020 2020 2020 2020 4672 6f6d 2074 6865          From the
-0001e960: 2060 602e 6368 756e 6b73 6060 2061 7474   ``.chunks`` att
-0001e970: 7269 6275 7465 206f 6620 616e 2060 6041  ribute of an ``A
-0001e980: 7272 6179 6060 0a0a 2020 2020 5265 7475  rray``..    Retu
-0001e990: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-0001e9a0: 2020 2020 5472 7565 2069 6620 6368 756e      True if chun
-0001e9b0: 6b73 6574 2070 6173 7365 732c 2065 6c73  kset passes, els
-0001e9c0: 6520 4661 6c73 650a 0a20 2020 2045 7861  e False..    Exa
-0001e9d0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
-0001e9e0: 2d2d 0a20 2020 203e 3e3e 2069 6d70 6f72  --.    >>> impor
-0001e9f0: 7420 6461 736b 2e61 7272 6179 2061 7320  t dask.array as 
-0001ea00: 6461 0a20 2020 203e 3e3e 2061 7272 203d  da.    >>> arr =
-0001ea10: 2064 612e 7a65 726f 7328 3130 2c20 6368   da.zeros(10, ch
-0001ea20: 756e 6b73 3d28 352c 2029 290a 2020 2020  unks=(5, )).    
-0001ea30: 3e3e 3e20 5f63 6865 636b 5f72 6567 756c  >>> _check_regul
-0001ea40: 6172 5f63 6875 6e6b 7328 6172 722e 6368  ar_chunks(arr.ch
-0001ea50: 756e 6b73 290a 2020 2020 5472 7565 0a0a  unks).    True..
-0001ea60: 2020 2020 3e3e 3e20 6172 7220 3d20 6461      >>> arr = da
-0001ea70: 2e7a 6572 6f73 2831 302c 2063 6875 6e6b  .zeros(10, chunk
-0001ea80: 733d 2828 332c 2033 2c20 332c 2031 292c  s=((3, 3, 3, 1),
-0001ea90: 2029 290a 2020 2020 3e3e 3e20 5f63 6865   )).    >>> _che
-0001eaa0: 636b 5f72 6567 756c 6172 5f63 6875 6e6b  ck_regular_chunk
-0001eab0: 7328 6172 722e 6368 756e 6b73 290a 2020  s(arr.chunks).  
-0001eac0: 2020 5472 7565 0a0a 2020 2020 3e3e 3e20    True..    >>> 
-0001ead0: 6172 7220 3d20 6461 2e7a 6572 6f73 2831  arr = da.zeros(1
-0001eae0: 302c 2063 6875 6e6b 733d 2828 332c 2031  0, chunks=((3, 1
-0001eaf0: 2c20 332c 2033 292c 2029 290a 2020 2020  , 3, 3), )).    
-0001eb00: 3e3e 3e20 5f63 6865 636b 5f72 6567 756c  >>> _check_regul
-0001eb10: 6172 5f63 6875 6e6b 7328 6172 722e 6368  ar_chunks(arr.ch
-0001eb20: 756e 6b73 290a 2020 2020 4661 6c73 650a  unks).    False.
-0001eb30: 2020 2020 2222 220a 2020 2020 666f 7220      """.    for 
-0001eb40: 6368 756e 6b73 2069 6e20 6368 756e 6b73  chunks in chunks
-0001eb50: 6574 3a0a 2020 2020 2020 2020 6966 206c  et:.        if l
-0001eb60: 656e 2863 6875 6e6b 7329 203d 3d20 313a  en(chunks) == 1:
-0001eb70: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-0001eb80: 7469 6e75 650a 2020 2020 2020 2020 6966  tinue.        if
-0001eb90: 206c 656e 2873 6574 2863 6875 6e6b 735b   len(set(chunks[
-0001eba0: 3a2d 315d 2929 203e 2031 3a0a 2020 2020  :-1])) > 1:.    
-0001ebb0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-0001ebc0: 616c 7365 0a20 2020 2020 2020 2069 6620  alse.        if 
-0001ebd0: 6368 756e 6b73 5b2d 315d 203e 2063 6875  chunks[-1] > chu
-0001ebe0: 6e6b 735b 305d 3a0a 2020 2020 2020 2020  nks[0]:.        
-0001ebf0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001ec00: 0a20 2020 2072 6574 7572 6e20 5472 7565  .    return True
-0001ec10: 0a0a 0a64 6566 2066 726f 6d5f 6465 6c61  ...def from_dela
-0001ec20: 7965 6428 7661 6c75 652c 2073 6861 7065  yed(value, shape
-0001ec30: 2c20 6474 7970 653d 4e6f 6e65 2c20 6d65  , dtype=None, me
-0001ec40: 7461 3d4e 6f6e 652c 206e 616d 653d 4e6f  ta=None, name=No
-0001ec50: 6e65 293a 0a20 2020 2022 2222 4372 6561  ne):.    """Crea
-0001ec60: 7465 2061 2064 6173 6b20 6172 7261 7920  te a dask array 
-0001ec70: 6672 6f6d 2061 2064 6173 6b20 6465 6c61  from a dask dela
-0001ec80: 7965 6420 7661 6c75 650a 0a20 2020 2054  yed value..    T
-0001ec90: 6869 7320 726f 7574 696e 6520 6973 2075  his routine is u
-0001eca0: 7365 6675 6c20 666f 7220 636f 6e73 7472  seful for constr
-0001ecb0: 7563 7469 6e67 2064 6173 6b20 6172 7261  ucting dask arra
-0001ecc0: 7973 2069 6e20 616e 2061 642d 686f 6320  ys in an ad-hoc 
-0001ecd0: 6661 7368 696f 6e0a 2020 2020 7573 696e  fashion.    usin
-0001ece0: 6720 6461 736b 2064 656c 6179 6564 2c20  g dask delayed, 
-0001ecf0: 7061 7274 6963 756c 6172 6c79 2077 6865  particularly whe
-0001ed00: 6e20 636f 6d62 696e 6564 2077 6974 6820  n combined with 
-0001ed10: 7374 6163 6b20 616e 6420 636f 6e63 6174  stack and concat
-0001ed20: 656e 6174 652e 0a0a 2020 2020 5468 6520  enate...    The 
-0001ed30: 6461 736b 2061 7272 6179 2077 696c 6c20  dask array will 
-0001ed40: 636f 6e73 6973 7420 6f66 2061 2073 696e  consist of a sin
-0001ed50: 676c 6520 6368 756e 6b2e 0a0a 2020 2020  gle chunk...    
-0001ed60: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
-0001ed70: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 696d  -----.    >>> im
-0001ed80: 706f 7274 2064 6173 6b0a 2020 2020 3e3e  port dask.    >>
-0001ed90: 3e20 696d 706f 7274 2064 6173 6b2e 6172  > import dask.ar
-0001eda0: 7261 7920 6173 2064 610a 2020 2020 3e3e  ray as da.    >>
-0001edb0: 3e20 696d 706f 7274 206e 756d 7079 2061  > import numpy a
-0001edc0: 7320 6e70 0a20 2020 203e 3e3e 2076 616c  s np.    >>> val
-0001edd0: 7565 203d 2064 6173 6b2e 6465 6c61 7965  ue = dask.delaye
-0001ede0: 6428 6e70 2e6f 6e65 7329 2835 290a 2020  d(np.ones)(5).  
-0001edf0: 2020 3e3e 3e20 6172 7261 7920 3d20 6461    >>> array = da
-0001ee00: 2e66 726f 6d5f 6465 6c61 7965 6428 7661  .from_delayed(va
-0001ee10: 6c75 652c 2028 352c 292c 2064 7479 7065  lue, (5,), dtype
-0001ee20: 3d66 6c6f 6174 290a 2020 2020 3e3e 3e20  =float).    >>> 
-0001ee30: 6172 7261 790a 2020 2020 6461 736b 2e61  array.    dask.a
-0001ee40: 7272 6179 3c66 726f 6d2d 7661 6c75 652c  rray<from-value,
-0001ee50: 2073 6861 7065 3d28 352c 292c 2064 7479   shape=(5,), dty
-0001ee60: 7065 3d66 6c6f 6174 3634 2c20 6368 756e  pe=float64, chun
-0001ee70: 6b73 697a 653d 2835 2c29 2c20 6368 756e  ksize=(5,), chun
-0001ee80: 6b74 7970 653d 6e75 6d70 792e 6e64 6172  ktype=numpy.ndar
-0001ee90: 7261 793e 0a20 2020 203e 3e3e 2061 7272  ray>.    >>> arr
-0001eea0: 6179 2e63 6f6d 7075 7465 2829 0a20 2020  ay.compute().   
-0001eeb0: 2061 7272 6179 285b 312e 2c20 312e 2c20   array([1., 1., 
-0001eec0: 312e 2c20 312e 2c20 312e 5d29 0a20 2020  1., 1., 1.]).   
-0001eed0: 2022 2222 0a20 2020 2066 726f 6d20 6461   """.    from da
-0001eee0: 736b 2e64 656c 6179 6564 2069 6d70 6f72  sk.delayed impor
-0001eef0: 7420 4465 6c61 7965 642c 2064 656c 6179  t Delayed, delay
-0001ef00: 6564 0a0a 2020 2020 6966 206e 6f74 2069  ed..    if not i
-0001ef10: 7369 6e73 7461 6e63 6528 7661 6c75 652c  sinstance(value,
-0001ef20: 2044 656c 6179 6564 2920 616e 6420 6861   Delayed) and ha
-0001ef30: 7361 7474 7228 7661 6c75 652c 2022 6b65  sattr(value, "ke
-0001ef40: 7922 293a 0a20 2020 2020 2020 2076 616c  y"):.        val
-0001ef50: 7565 203d 2064 656c 6179 6564 2876 616c  ue = delayed(val
-0001ef60: 7565 290a 0a20 2020 206e 616d 6520 3d20  ue)..    name = 
-0001ef70: 6e61 6d65 206f 7220 2266 726f 6d2d 7661  name or "from-va
-0001ef80: 6c75 652d 2220 2b20 746f 6b65 6e69 7a65  lue-" + tokenize
-0001ef90: 2876 616c 7565 2c20 7368 6170 652c 2064  (value, shape, d
-0001efa0: 7479 7065 2c20 6d65 7461 290a 2020 2020  type, meta).    
-0001efb0: 6473 6b20 3d20 7b28 6e61 6d65 2c29 202b  dsk = {(name,) +
-0001efc0: 2028 302c 2920 2a20 6c65 6e28 7368 6170   (0,) * len(shap
-0001efd0: 6529 3a20 7661 6c75 652e 6b65 797d 0a20  e): value.key}. 
-0001efe0: 2020 2063 6875 6e6b 7320 3d20 7475 706c     chunks = tupl
-0001eff0: 6528 2864 2c29 2066 6f72 2064 2069 6e20  e((d,) for d in 
-0001f000: 7368 6170 6529 0a20 2020 2023 2054 4f44  shape).    # TOD
-0001f010: 4f3a 2076 616c 7565 2e5f 6b65 7920 6d61  O: value._key ma
-0001f020: 7920 6e6f 7420 6265 2074 6865 206e 616d  y not be the nam
-0001f030: 6520 6f66 2074 6865 206c 6179 6572 2069  e of the layer i
-0001f040: 6e20 7661 6c75 652e 6461 736b 0a20 2020  n value.dask.   
-0001f050: 2023 2054 6869 7320 7368 6f75 6c64 2062   # This should b
-0001f060: 6520 6669 7865 6420 6166 7465 7220 7765  e fixed after we
-0001f070: 2062 7569 6c64 2066 756c 6c20 6578 7072   build full expr
-0001f080: 6573 7369 6f6e 2067 7261 7068 730a 2020  ession graphs.  
-0001f090: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
-0001f0a0: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
-0001f0b0: 6c6c 6563 7469 6f6e 7328 6e61 6d65 2c20  llections(name, 
-0001f0c0: 6473 6b2c 2064 6570 656e 6465 6e63 6965  dsk, dependencie
-0001f0d0: 733d 5b76 616c 7565 5d29 0a20 2020 2072  s=[value]).    r
-0001f0e0: 6574 7572 6e20 4172 7261 7928 6772 6170  eturn Array(grap
-0001f0f0: 682c 206e 616d 652c 2063 6875 6e6b 732c  h, name, chunks,
-0001f100: 2064 7479 7065 3d64 7479 7065 2c20 6d65   dtype=dtype, me
-0001f110: 7461 3d6d 6574 6129 0a0a 0a64 6566 2066  ta=meta)...def f
-0001f120: 726f 6d5f 6675 6e63 2866 756e 632c 2073  rom_func(func, s
-0001f130: 6861 7065 2c20 6474 7970 653d 4e6f 6e65  hape, dtype=None
-0001f140: 2c20 6e61 6d65 3d4e 6f6e 652c 2061 7267  , name=None, arg
-0001f150: 733d 2829 2c20 6b77 6172 6773 3d4e 6f6e  s=(), kwargs=Non
-0001f160: 6529 3a0a 2020 2020 2222 2243 7265 6174  e):.    """Creat
-0001f170: 6520 6461 736b 2061 7272 6179 2069 6e20  e dask array in 
-0001f180: 6120 7369 6e67 6c65 2062 6c6f 636b 2062  a single block b
-0001f190: 7920 6361 6c6c 696e 6720 6120 6675 6e63  y calling a func
-0001f1a0: 7469 6f6e 0a0a 2020 2020 4361 6c6c 696e  tion..    Callin
-0001f1b0: 6720 7468 6520 7072 6f76 6964 6564 2066  g the provided f
-0001f1c0: 756e 6374 696f 6e20 7769 7468 2066 756e  unction with fun
-0001f1d0: 6328 2a61 7267 732c 202a 2a6b 7761 7267  c(*args, **kwarg
-0001f1e0: 7329 2073 686f 756c 6420 7265 7475 726e  s) should return
-0001f1f0: 2061 0a20 2020 204e 756d 5079 2061 7272   a.    NumPy arr
-0001f200: 6179 206f 6620 7468 6520 696e 6469 6361  ay of the indica
-0001f210: 7465 6420 7368 6170 6520 616e 6420 6474  ted shape and dt
-0001f220: 7970 652e 0a0a 2020 2020 4578 616d 706c  ype...    Exampl
-0001f230: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-0001f240: 0a20 2020 203e 3e3e 2061 203d 2066 726f  .    >>> a = fro
-0001f250: 6d5f 6675 6e63 286e 702e 6172 616e 6765  m_func(np.arange
-0001f260: 2c20 2833 2c29 2c20 6474 7970 653d 2769  , (3,), dtype='i
-0001f270: 3827 2c20 6172 6773 3d28 332c 2929 0a20  8', args=(3,)). 
-0001f280: 2020 203e 3e3e 2061 2e63 6f6d 7075 7465     >>> a.compute
-0001f290: 2829 0a20 2020 2061 7272 6179 285b 302c  ().    array([0,
-0001f2a0: 2031 2c20 325d 290a 0a20 2020 2054 6869   1, 2])..    Thi
-0001f2b0: 7320 776f 726b 7320 7061 7274 6963 756c  s works particul
-0001f2c0: 6172 6c79 2077 656c 6c20 7768 656e 2063  arly well when c
-0001f2d0: 6f75 706c 6564 2077 6974 6820 6461 736b  oupled with dask
-0001f2e0: 2e61 7272 6179 2066 756e 6374 696f 6e73  .array functions
-0001f2f0: 206c 696b 650a 2020 2020 636f 6e63 6174   like.    concat
-0001f300: 656e 6174 6520 616e 6420 7374 6163 6b3a  enate and stack:
-0001f310: 0a0a 2020 2020 3e3e 3e20 6172 7261 7973  ..    >>> arrays
-0001f320: 203d 205b 6672 6f6d 5f66 756e 6328 6e70   = [from_func(np
-0001f330: 2e61 7272 6179 2c20 2829 2c20 6474 7970  .array, (), dtyp
-0001f340: 653d 2769 3827 2c20 6172 6773 3d28 6e2c  e='i8', args=(n,
-0001f350: 2929 2066 6f72 206e 2069 6e20 7261 6e67  )) for n in rang
-0001f360: 6528 3529 5d0a 2020 2020 3e3e 3e20 7374  e(5)].    >>> st
-0001f370: 6163 6b28 6172 7261 7973 292e 636f 6d70  ack(arrays).comp
-0001f380: 7574 6528 290a 2020 2020 6172 7261 7928  ute().    array(
-0001f390: 5b30 2c20 312c 2032 2c20 332c 2034 5d29  [0, 1, 2, 3, 4])
-0001f3a0: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
-0001f3b0: 6b77 6172 6773 2069 7320 4e6f 6e65 3a0a  kwargs is None:.
-0001f3c0: 2020 2020 2020 2020 6b77 6172 6773 203d          kwargs =
-0001f3d0: 207b 7d0a 0a20 2020 206e 616d 6520 3d20   {}..    name = 
-0001f3e0: 6e61 6d65 206f 7220 2266 726f 6d5f 6675  name or "from_fu
-0001f3f0: 6e63 2d22 202b 2074 6f6b 656e 697a 6528  nc-" + tokenize(
-0001f400: 6675 6e63 2c20 7368 6170 652c 2064 7479  func, shape, dty
-0001f410: 7065 2c20 6172 6773 2c20 6b77 6172 6773  pe, args, kwargs
-0001f420: 290a 2020 2020 6966 2061 7267 7320 6f72  ).    if args or
-0001f430: 206b 7761 7267 733a 0a20 2020 2020 2020   kwargs:.       
-0001f440: 2066 756e 6320 3d20 7061 7274 6961 6c28   func = partial(
-0001f450: 6675 6e63 2c20 2a61 7267 732c 202a 2a6b  func, *args, **k
-0001f460: 7761 7267 7329 0a20 2020 2064 736b 203d  wargs).    dsk =
-0001f470: 207b 286e 616d 652c 2920 2b20 2830 2c29   {(name,) + (0,)
-0001f480: 202a 206c 656e 2873 6861 7065 293a 2028   * len(shape): (
-0001f490: 6675 6e63 2c29 7d0a 2020 2020 6368 756e  func,)}.    chun
-0001f4a0: 6b73 203d 2074 7570 6c65 2828 692c 2920  ks = tuple((i,) 
-0001f4b0: 666f 7220 6920 696e 2073 6861 7065 290a  for i in shape).
-0001f4c0: 2020 2020 7265 7475 726e 2041 7272 6179      return Array
-0001f4d0: 2864 736b 2c20 6e61 6d65 2c20 6368 756e  (dsk, name, chun
-0001f4e0: 6b73 2c20 6474 7970 6529 0a0a 0a64 6566  ks, dtype)...def
-0001f4f0: 2063 6f6d 6d6f 6e5f 626c 6f63 6b64 696d   common_blockdim
-0001f500: 2862 6c6f 636b 6469 6d73 293a 0a20 2020  (blockdims):.   
-0001f510: 2022 2222 4669 6e64 2074 6865 2063 6f6d   """Find the com
-0001f520: 6d6f 6e20 626c 6f63 6b20 6469 6d65 6e73  mon block dimens
-0001f530: 696f 6e73 2066 726f 6d20 7468 6520 6c69  ions from the li
-0001f540: 7374 206f 6620 626c 6f63 6b20 6469 6d65  st of block dime
-0001f550: 6e73 696f 6e73 0a0a 2020 2020 4375 7272  nsions..    Curr
-0001f560: 656e 746c 7920 6f6e 6c79 2069 6d70 6c65  ently only imple
-0001f570: 6d65 6e74 7320 7468 6520 7369 6d70 6c65  ments the simple
-0001f580: 7374 2070 6f73 7369 626c 6520 6865 7572  st possible heur
-0001f590: 6973 7469 633a 2074 6865 2063 6f6d 6d6f  istic: the commo
-0001f5a0: 6e0a 2020 2020 626c 6f63 6b2d 6469 6d65  n.    block-dime
-0001f5b0: 6e73 696f 6e20 6973 2074 6865 206f 6e6c  nsion is the onl
-0001f5c0: 7920 6f6e 6520 7468 6174 2064 6f65 7320  y one that does 
-0001f5d0: 6e6f 7420 7370 616e 2066 756c 6c79 2073  not span fully s
-0001f5e0: 7061 6e20 6120 6469 6d65 6e73 696f 6e2e  pan a dimension.
-0001f5f0: 0a20 2020 2054 6869 7320 6973 2061 2063  .    This is a c
-0001f600: 6f6e 7365 7276 6174 6976 6520 6368 6f69  onservative choi
-0001f610: 6365 2074 6861 7420 616c 6c6f 7773 2075  ce that allows u
-0001f620: 7320 746f 2061 766f 6964 2070 6f74 656e  s to avoid poten
-0001f630: 7469 616c 6c79 2076 6572 790a 2020 2020  tially very.    
-0001f640: 6578 7065 6e73 6976 6520 7265 6368 756e  expensive rechun
-0001f650: 6b69 6e67 2e0a 0a20 2020 2041 7373 756d  king...    Assum
-0001f660: 6573 2074 6861 7420 6561 6368 2065 6c65  es that each ele
-0001f670: 6d65 6e74 206f 6620 7468 6520 696e 7075  ment of the inpu
-0001f680: 7420 626c 6f63 6b20 6469 6d65 6e73 696f  t block dimensio
-0001f690: 6e73 2068 6173 2061 6c6c 2074 6865 2073  ns has all the s
-0001f6a0: 616d 650a 2020 2020 7375 6d20 2869 2e65  ame.    sum (i.e
-0001f6b0: 2e2c 2074 6861 7420 7468 6579 2063 6f72  ., that they cor
-0001f6c0: 7265 7370 6f6e 6420 746f 2064 696d 656e  respond to dimen
-0001f6d0: 7369 6f6e 7320 6f66 2074 6865 2073 616d  sions of the sam
-0001f6e0: 6520 7369 7a65 292e 0a0a 2020 2020 4578  e size)...    Ex
-0001f6f0: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
-0001f700: 2d2d 2d0a 2020 2020 3e3e 3e20 636f 6d6d  ---.    >>> comm
-0001f710: 6f6e 5f62 6c6f 636b 6469 6d28 5b28 332c  on_blockdim([(3,
-0001f720: 292c 2028 322c 2031 295d 290a 2020 2020  ), (2, 1)]).    
-0001f730: 2832 2c20 3129 0a20 2020 203e 3e3e 2063  (2, 1).    >>> c
-0001f740: 6f6d 6d6f 6e5f 626c 6f63 6b64 696d 285b  ommon_blockdim([
-0001f750: 2831 2c20 3229 2c20 2832 2c20 3129 5d29  (1, 2), (2, 1)])
-0001f760: 0a20 2020 2028 312c 2031 2c20 3129 0a20  .    (1, 1, 1). 
-0001f770: 2020 203e 3e3e 2063 6f6d 6d6f 6e5f 626c     >>> common_bl
-0001f780: 6f63 6b64 696d 285b 2832 2c20 3229 2c20  ockdim([(2, 2), 
-0001f790: 2833 2c20 3129 5d29 2020 2320 646f 6374  (3, 1)])  # doct
-0001f7a0: 6573 743a 202b 534b 4950 0a20 2020 2054  est: +SKIP.    T
-0001f7b0: 7261 6365 6261 636b 2028 6d6f 7374 2072  raceback (most r
-0001f7c0: 6563 656e 7420 6361 6c6c 206c 6173 7429  ecent call last)
-0001f7d0: 3a0a 2020 2020 2020 2020 2e2e 2e0a 2020  :.        ....  
-0001f7e0: 2020 5661 6c75 6545 7272 6f72 3a20 4368    ValueError: Ch
-0001f7f0: 756e 6b73 2064 6f20 6e6f 7420 616c 6967  unks do not alig
-0001f800: 6e0a 2020 2020 2222 220a 2020 2020 6966  n.    """.    if
-0001f810: 206e 6f74 2061 6e79 2862 6c6f 636b 6469   not any(blockdi
-0001f820: 6d73 293a 0a20 2020 2020 2020 2072 6574  ms):.        ret
-0001f830: 7572 6e20 2829 0a20 2020 206e 6f6e 5f74  urn ().    non_t
-0001f840: 7269 7669 616c 5f64 696d 7320 3d20 7b64  rivial_dims = {d
-0001f850: 2066 6f72 2064 2069 6e20 626c 6f63 6b64   for d in blockd
-0001f860: 696d 7320 6966 206c 656e 2864 2920 3e20  ims if len(d) > 
-0001f870: 317d 0a20 2020 2069 6620 6c65 6e28 6e6f  1}.    if len(no
-0001f880: 6e5f 7472 6976 6961 6c5f 6469 6d73 2920  n_trivial_dims) 
-0001f890: 3d3d 2031 3a0a 2020 2020 2020 2020 7265  == 1:.        re
-0001f8a0: 7475 726e 2066 6972 7374 286e 6f6e 5f74  turn first(non_t
-0001f8b0: 7269 7669 616c 5f64 696d 7329 0a20 2020  rivial_dims).   
-0001f8c0: 2069 6620 6c65 6e28 6e6f 6e5f 7472 6976   if len(non_triv
-0001f8d0: 6961 6c5f 6469 6d73 2920 3d3d 2030 3a0a  ial_dims) == 0:.
-0001f8e0: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0001f8f0: 6178 2862 6c6f 636b 6469 6d73 2c20 6b65  ax(blockdims, ke
-0001f900: 793d 6669 7273 7429 0a0a 2020 2020 6966  y=first)..    if
-0001f910: 206e 702e 6973 6e61 6e28 7375 6d28 6d61   np.isnan(sum(ma
-0001f920: 7028 7375 6d2c 2062 6c6f 636b 6469 6d73  p(sum, blockdims
-0001f930: 2929 293a 0a20 2020 2020 2020 2072 6169  ))):.        rai
-0001f940: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
-0001f950: 2020 2020 2020 2020 2020 2022 4172 7261             "Arra
-0001f960: 7973 2720 6368 756e 6b20 7369 7a65 7320  ys' chunk sizes 
-0001f970: 2825 7329 2061 7265 2075 6e6b 6e6f 776e  (%s) are unknown
-0001f980: 2e5c 6e5c 6e22 0a20 2020 2020 2020 2020  .\n\n".         
-0001f990: 2020 2022 4120 706f 7373 6962 6c65 2073     "A possible s
-0001f9a0: 6f6c 7574 696f 6e3a 5c6e 220a 2020 2020  olution:\n".    
-0001f9b0: 2020 2020 2020 2020 2220 2078 2e63 6f6d          "  x.com
-0001f9c0: 7075 7465 5f63 6875 6e6b 5f73 697a 6573  pute_chunk_sizes
-0001f9d0: 2829 2220 2520 626c 6f63 6b64 696d 730a  ()" % blockdims.
-0001f9e0: 2020 2020 2020 2020 290a 0a20 2020 2069          )..    i
-0001f9f0: 6620 6c65 6e28 7365 7428 6d61 7028 7375  f len(set(map(su
-0001fa00: 6d2c 206e 6f6e 5f74 7269 7669 616c 5f64  m, non_trivial_d
-0001fa10: 696d 7329 2929 203e 2031 3a0a 2020 2020  ims))) > 1:.    
-0001fa20: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0001fa30: 7272 6f72 2822 4368 756e 6b73 2064 6f20  rror("Chunks do 
-0001fa40: 6e6f 7420 6164 6420 7570 2074 6f20 7361  not add up to sa
-0001fa50: 6d65 2076 616c 7565 222c 2062 6c6f 636b  me value", block
-0001fa60: 6469 6d73 290a 0a20 2020 2023 2057 6520  dims)..    # We 
-0001fa70: 6861 7665 206d 756c 7469 706c 6520 6e6f  have multiple no
-0001fa80: 6e2d 7472 6976 6961 6c20 6368 756e 6b73  n-trivial chunks
-0001fa90: 206f 6e20 7468 6973 2061 7869 730a 2020   on this axis.  
-0001faa0: 2020 2320 652e 672e 2028 352c 2032 2920    # e.g. (5, 2) 
-0001fab0: 616e 6420 2834 2c20 3329 0a0a 2020 2020  and (4, 3)..    
-0001fac0: 2320 5765 2063 7265 6174 6520 6120 7369  # We create a si
-0001fad0: 6e67 6c65 2063 6875 6e6b 2074 7570 6c65  ngle chunk tuple
-0001fae0: 2077 6974 6820 7468 6520 7361 6d65 2074   with the same t
-0001faf0: 6f74 616c 206c 656e 6774 680a 2020 2020  otal length.    
-0001fb00: 2320 7468 6174 2065 7665 6e6c 7920 6469  # that evenly di
-0001fb10: 7669 6465 7320 626f 7468 2c20 652e 672e  vides both, e.g.
-0001fb20: 2028 342c 2031 2c20 3229 0a0a 2020 2020   (4, 1, 2)..    
-0001fb30: 2320 546f 2061 6363 6f6d 706c 6973 6820  # To accomplish 
-0001fb40: 7468 6973 2077 6520 7761 6c6b 2064 6f77  this we walk dow
-0001fb50: 6e20 616c 6c20 6368 756e 6b20 7475 706c  n all chunk tupl
-0001fb60: 6573 2074 6f67 6574 6865 722c 2066 696e  es together, fin
-0001fb70: 6469 6e67 2074 6865 0a20 2020 2023 2073  ding the.    # s
-0001fb80: 6d61 6c6c 6573 7420 656c 656d 656e 742c  mallest element,
-0001fb90: 2061 6464 696e 6720 6974 2074 6f20 7468   adding it to th
-0001fba0: 6520 6f75 7470 7574 2c20 616e 6420 7375  e output, and su
-0001fbb0: 6274 7261 6374 696e 6720 6974 2066 726f  btracting it fro
-0001fbc0: 6d20 616c 6c0a 2020 2020 2320 6f74 6865  m all.    # othe
-0001fbd0: 7220 656c 656d 656e 7473 2061 6e64 2072  r elements and r
-0001fbe0: 656d 6f76 6520 7468 6520 656c 656d 656e  emove the elemen
-0001fbf0: 7420 6974 7365 6c66 2e20 2057 6520 7374  t itself.  We st
-0001fc00: 6f70 206f 6e63 6520 7765 2068 6176 650a  op once we have.
-0001fc10: 2020 2020 2320 6275 726e 6564 2074 6872      # burned thr
-0001fc20: 6f75 6768 2061 6c6c 206f 6620 7468 6520  ough all of the 
-0001fc30: 6368 756e 6b20 7475 706c 6573 2e0a 2020  chunk tuples..  
-0001fc40: 2020 2320 466f 7220 6566 6669 6369 656e    # For efficien
-0001fc50: 6379 2773 2073 616b 6520 7765 2072 6576  cy's sake we rev
-0001fc60: 6572 7365 2074 6865 206c 6973 7473 2073  erse the lists s
-0001fc70: 6f20 7468 6174 2077 6520 6361 6e20 706f  o that we can po
-0001fc80: 7020 6f66 6620 7468 6520 656e 640a 2020  p off the end.  
-0001fc90: 2020 7263 6875 6e6b 7320 3d20 5b6c 6973    rchunks = [lis
-0001fca0: 7428 6e74 6429 5b3a 3a2d 315d 2066 6f72  t(ntd)[::-1] for
-0001fcb0: 206e 7464 2069 6e20 6e6f 6e5f 7472 6976   ntd in non_triv
-0001fcc0: 6961 6c5f 6469 6d73 5d0a 2020 2020 746f  ial_dims].    to
-0001fcd0: 7461 6c20 3d20 7375 6d28 6669 7273 7428  tal = sum(first(
-0001fce0: 6e6f 6e5f 7472 6976 6961 6c5f 6469 6d73  non_trivial_dims
-0001fcf0: 2929 0a20 2020 2069 203d 2030 0a0a 2020  )).    i = 0..  
-0001fd00: 2020 6f75 7420 3d20 5b5d 0a20 2020 2077    out = [].    w
-0001fd10: 6869 6c65 2069 203c 2074 6f74 616c 3a0a  hile i < total:.
-0001fd20: 2020 2020 2020 2020 6d20 3d20 6d69 6e28          m = min(
-0001fd30: 635b 2d31 5d20 666f 7220 6320 696e 2072  c[-1] for c in r
-0001fd40: 6368 756e 6b73 290a 2020 2020 2020 2020  chunks).        
-0001fd50: 6f75 742e 6170 7065 6e64 286d 290a 2020  out.append(m).  
-0001fd60: 2020 2020 2020 666f 7220 6320 696e 2072        for c in r
-0001fd70: 6368 756e 6b73 3a0a 2020 2020 2020 2020  chunks:.        
-0001fd80: 2020 2020 635b 2d31 5d20 2d3d 206d 0a20      c[-1] -= m. 
-0001fd90: 2020 2020 2020 2020 2020 2069 6620 635b             if c[
-0001fda0: 2d31 5d20 3d3d 2030 3a0a 2020 2020 2020  -1] == 0:.      
-0001fdb0: 2020 2020 2020 2020 2020 632e 706f 7028            c.pop(
-0001fdc0: 290a 2020 2020 2020 2020 6920 2b3d 206d  ).        i += m
-0001fdd0: 0a0a 2020 2020 7265 7475 726e 2074 7570  ..    return tup
-0001fde0: 6c65 286f 7574 290a 0a0a 6465 6620 756e  le(out)...def un
-0001fdf0: 6966 795f 6368 756e 6b73 282a 6172 6773  ify_chunks(*args
-0001fe00: 2c20 2a2a 6b77 6172 6773 293a 0a20 2020  , **kwargs):.   
-0001fe10: 2022 2222 0a20 2020 2055 6e69 6679 2063   """.    Unify c
-0001fe20: 6875 6e6b 7320 6163 726f 7373 2061 2073  hunks across a s
-0001fe30: 6571 7565 6e63 6520 6f66 2061 7272 6179  equence of array
-0001fe40: 730a 0a20 2020 2054 6869 7320 7574 696c  s..    This util
-0001fe50: 6974 7920 6675 6e63 7469 6f6e 2069 7320  ity function is 
-0001fe60: 7573 6564 2077 6974 6869 6e20 6f74 6865  used within othe
-0001fe70: 7220 636f 6d6d 6f6e 206f 7065 7261 7469  r common operati
-0001fe80: 6f6e 7320 6c69 6b65 0a20 2020 203a 6675  ons like.    :fu
-0001fe90: 6e63 3a60 6461 736b 2e61 7272 6179 2e63  nc:`dask.array.c
-0001fea0: 6f72 652e 6d61 705f 626c 6f63 6b73 6020  ore.map_blocks` 
-0001feb0: 616e 6420 3a66 756e 633a 6064 6173 6b2e  and :func:`dask.
-0001fec0: 6172 7261 792e 636f 7265 2e62 6c6f 636b  array.core.block
-0001fed0: 7769 7365 602e 0a20 2020 2049 7420 6973  wise`..    It is
-0001fee0: 206e 6f74 2063 6f6d 6d6f 6e6c 7920 7573   not commonly us
-0001fef0: 6564 2062 7920 656e 642d 7573 6572 7320  ed by end-users 
-0001ff00: 6469 7265 6374 6c79 2e0a 0a20 2020 2050  directly...    P
-0001ff10: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-0001ff20: 2d2d 2d2d 2d2d 2d2d 0a20 2020 202a 6172  --------.    *ar
-0001ff30: 6773 3a20 7365 7175 656e 6365 206f 6620  gs: sequence of 
-0001ff40: 4172 7261 792c 2069 6e64 6578 2070 6169  Array, index pai
-0001ff50: 7273 0a20 2020 2020 2020 2053 6571 7565  rs.        Seque
-0001ff60: 6e63 6520 6c69 6b65 2028 782c 2027 696a  nce like (x, 'ij
-0001ff70: 272c 2079 2c20 276a 6b27 2c20 7a2c 2027  ', y, 'jk', z, '
-0001ff80: 6927 290a 0a20 2020 2045 7861 6d70 6c65  i')..    Example
-0001ff90: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20  s.    --------. 
-0001ffa0: 2020 203e 3e3e 2069 6d70 6f72 7420 6461     >>> import da
-0001ffb0: 736b 2e61 7272 6179 2061 7320 6461 0a20  sk.array as da. 
-0001ffc0: 2020 203e 3e3e 2078 203d 2064 612e 6f6e     >>> x = da.on
-0001ffd0: 6573 2831 302c 2063 6875 6e6b 733d 2828  es(10, chunks=((
-0001ffe0: 352c 2032 2c20 3329 2c29 290a 2020 2020  5, 2, 3),)).    
-0001fff0: 3e3e 3e20 7920 3d20 6461 2e6f 6e65 7328  >>> y = da.ones(
-00020000: 3130 2c20 6368 756e 6b73 3d28 2832 2c20  10, chunks=((2, 
-00020010: 332c 2035 292c 2929 0a20 2020 203e 3e3e  3, 5),)).    >>>
-00020020: 2063 6875 6e6b 7373 2c20 6172 7261 7973   chunkss, arrays
-00020030: 203d 2075 6e69 6679 5f63 6875 6e6b 7328   = unify_chunks(
-00020040: 782c 2027 6927 2c20 792c 2027 6927 290a  x, 'i', y, 'i').
-00020050: 2020 2020 3e3e 3e20 6368 756e 6b73 730a      >>> chunkss.
-00020060: 2020 2020 7b27 6927 3a20 2832 2c20 332c      {'i': (2, 3,
-00020070: 2032 2c20 3329 7d0a 0a20 2020 203e 3e3e   2, 3)}..    >>>
-00020080: 2078 203d 2064 612e 6f6e 6573 2828 3130   x = da.ones((10
-00020090: 302c 2031 3029 2c20 6368 756e 6b73 3d28  0, 10), chunks=(
-000200a0: 3230 2c20 3529 290a 2020 2020 3e3e 3e20  20, 5)).    >>> 
-000200b0: 7920 3d20 6461 2e6f 6e65 7328 2831 302c  y = da.ones((10,
-000200c0: 2031 3030 292c 2063 6875 6e6b 733d 2834   100), chunks=(4
-000200d0: 2c20 3530 2929 0a20 2020 203e 3e3e 2063  , 50)).    >>> c
-000200e0: 6875 6e6b 7373 2c20 6172 7261 7973 203d  hunkss, arrays =
-000200f0: 2075 6e69 6679 5f63 6875 6e6b 7328 782c   unify_chunks(x,
-00020100: 2027 696a 272c 2079 2c20 276a 6b27 2c20   'ij', y, 'jk', 
-00020110: 2763 6f6e 7374 616e 7427 2c20 4e6f 6e65  'constant', None
-00020120: 290a 2020 2020 3e3e 3e20 6368 756e 6b73  ).    >>> chunks
-00020130: 7320 2023 2064 6f63 7465 7374 3a20 2b53  s  # doctest: +S
-00020140: 4b49 500a 2020 2020 7b27 6b27 3a20 2835  KIP.    {'k': (5
-00020150: 302c 2035 3029 2c20 2769 273a 2028 3230  0, 50), 'i': (20
-00020160: 2c20 3230 2c20 3230 2c20 3230 2c20 3230  , 20, 20, 20, 20
-00020170: 292c 2027 6a27 3a20 2834 2c20 312c 2033  ), 'j': (4, 1, 3
-00020180: 2c20 3229 7d0a 0a20 2020 203e 3e3e 2075  , 2)}..    >>> u
-00020190: 6e69 6679 5f63 6875 6e6b 7328 302c 204e  nify_chunks(0, N
-000201a0: 6f6e 6529 0a20 2020 2028 7b7d 2c20 5b30  one).    ({}, [0
-000201b0: 5d29 0a0a 2020 2020 5265 7475 726e 730a  ])..    Returns.
-000201c0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-000201d0: 6368 756e 6b73 7320 3a20 6469 6374 0a20  chunkss : dict. 
-000201e0: 2020 2020 2020 204d 6170 206c 696b 6520         Map like 
-000201f0: 7b69 6e64 6578 3a20 6368 756e 6b73 7d2e  {index: chunks}.
-00020200: 0a20 2020 2061 7272 6179 7320 3a20 6c69  .    arrays : li
-00020210: 7374 0a20 2020 2020 2020 204c 6973 7420  st.        List 
-00020220: 6f66 2072 6563 6875 6e6b 6564 2061 7272  of rechunked arr
-00020230: 6179 732e 0a0a 2020 2020 5365 6520 416c  ays...    See Al
-00020240: 736f 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  so.    --------.
-00020250: 2020 2020 636f 6d6d 6f6e 5f62 6c6f 636b      common_block
-00020260: 6469 6d0a 2020 2020 2222 220a 2020 2020  dim.    """.    
-00020270: 6966 206e 6f74 2061 7267 733a 0a20 2020  if not args:.   
-00020280: 2020 2020 2072 6574 7572 6e20 7b7d 2c20       return {}, 
-00020290: 5b5d 0a0a 2020 2020 6172 6769 6e64 7320  []..    arginds 
-000202a0: 3d20 5b0a 2020 2020 2020 2020 2861 7361  = [.        (asa
-000202b0: 6e79 6172 7261 7928 6129 2069 6620 696e  nyarray(a) if in
-000202c0: 6420 6973 206e 6f74 204e 6f6e 6520 656c  d is not None el
-000202d0: 7365 2061 2c20 696e 6429 2066 6f72 2061  se a, ind) for a
-000202e0: 2c20 696e 6420 696e 2070 6172 7469 7469  , ind in partiti
-000202f0: 6f6e 2832 2c20 6172 6773 290a 2020 2020  on(2, args).    
-00020300: 5d20 2023 205b 782c 2069 6a2c 2079 2c20  ]  # [x, ij, y, 
-00020310: 6a6b 5d0a 2020 2020 7761 726e 203d 206b  jk].    warn = k
-00020320: 7761 7267 732e 6765 7428 2277 6172 6e22  wargs.get("warn"
-00020330: 2c20 5472 7565 290a 0a20 2020 2061 7272  , True)..    arr
-00020340: 6179 732c 2069 6e64 7320 3d20 7a69 7028  ays, inds = zip(
-00020350: 2a61 7267 696e 6473 290a 2020 2020 6966  *arginds).    if
-00020360: 2061 6c6c 2869 6e64 2069 7320 4e6f 6e65   all(ind is None
-00020370: 2066 6f72 2069 6e64 2069 6e20 696e 6473   for ind in inds
-00020380: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00020390: 6e20 7b7d 2c20 6c69 7374 2861 7272 6179  n {}, list(array
-000203a0: 7329 0a20 2020 2069 6620 616c 6c28 696e  s).    if all(in
-000203b0: 6420 3d3d 2069 6e64 735b 305d 2066 6f72  d == inds[0] for
-000203c0: 2069 6e64 2069 6e20 696e 6473 2920 616e   ind in inds) an
-000203d0: 6420 616c 6c28 0a20 2020 2020 2020 2061  d all(.        a
-000203e0: 2e63 6875 6e6b 7320 3d3d 2061 7272 6179  .chunks == array
-000203f0: 735b 305d 2e63 6875 6e6b 7320 666f 7220  s[0].chunks for 
-00020400: 6120 696e 2061 7272 6179 730a 2020 2020  a in arrays.    
-00020410: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
-00020420: 6e20 6469 6374 287a 6970 2869 6e64 735b  n dict(zip(inds[
-00020430: 305d 2c20 6172 7261 7973 5b30 5d2e 6368  0], arrays[0].ch
-00020440: 756e 6b73 2929 2c20 6172 7261 7973 0a0a  unks)), arrays..
-00020450: 2020 2020 6e61 6d65 696e 6473 203d 205b      nameinds = [
-00020460: 5d0a 2020 2020 626c 6f63 6b64 696d 5f64  ].    blockdim_d
-00020470: 6963 7420 3d20 6469 6374 2829 0a20 2020  ict = dict().   
-00020480: 206d 6178 5f70 6172 7473 203d 2030 0a20   max_parts = 0. 
-00020490: 2020 2066 6f72 2061 2c20 696e 6420 696e     for a, ind in
-000204a0: 2061 7267 696e 6473 3a0a 2020 2020 2020   arginds:.      
-000204b0: 2020 6966 2069 6e64 2069 7320 6e6f 7420    if ind is not 
-000204c0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-000204d0: 2020 6e61 6d65 696e 6473 2e61 7070 656e    nameinds.appen
-000204e0: 6428 2861 2e6e 616d 652c 2069 6e64 2929  d((a.name, ind))
-000204f0: 0a20 2020 2020 2020 2020 2020 2062 6c6f  .            blo
-00020500: 636b 6469 6d5f 6469 6374 5b61 2e6e 616d  ckdim_dict[a.nam
-00020510: 655d 203d 2061 2e63 6875 6e6b 730a 2020  e] = a.chunks.  
-00020520: 2020 2020 2020 2020 2020 6d61 785f 7061            max_pa
-00020530: 7274 7320 3d20 6d61 7828 6d61 785f 7061  rts = max(max_pa
-00020540: 7274 732c 2061 2e6e 7061 7274 6974 696f  rts, a.npartitio
-00020550: 6e73 290a 2020 2020 2020 2020 656c 7365  ns).        else
-00020560: 3a0a 2020 2020 2020 2020 2020 2020 6e61  :.            na
-00020570: 6d65 696e 6473 2e61 7070 656e 6428 2861  meinds.append((a
-00020580: 2c20 696e 6429 290a 0a20 2020 2063 6875  , ind))..    chu
-00020590: 6e6b 7373 203d 2062 726f 6164 6361 7374  nkss = broadcast
-000205a0: 5f64 696d 656e 7369 6f6e 7328 6e61 6d65  _dimensions(name
-000205b0: 696e 6473 2c20 626c 6f63 6b64 696d 5f64  inds, blockdim_d
-000205c0: 6963 742c 2063 6f6e 736f 6c69 6461 7465  ict, consolidate
-000205d0: 3d63 6f6d 6d6f 6e5f 626c 6f63 6b64 696d  =common_blockdim
-000205e0: 290a 2020 2020 6e70 6172 7473 203d 206d  ).    nparts = m
-000205f0: 6174 682e 7072 6f64 286d 6170 286c 656e  ath.prod(map(len
-00020600: 2c20 6368 756e 6b73 732e 7661 6c75 6573  , chunkss.values
-00020610: 2829 2929 0a0a 2020 2020 6966 2077 6172  ()))..    if war
-00020620: 6e20 616e 6420 6e70 6172 7473 2061 6e64  n and nparts and
-00020630: 206e 7061 7274 7320 3e3d 206d 6178 5f70   nparts >= max_p
-00020640: 6172 7473 202a 2031 303a 0a20 2020 2020  arts * 10:.     
-00020650: 2020 2077 6172 6e69 6e67 732e 7761 726e     warnings.warn
-00020660: 280a 2020 2020 2020 2020 2020 2020 2249  (.            "I
-00020670: 6e63 7265 6173 696e 6720 6e75 6d62 6572  ncreasing number
-00020680: 206f 6620 6368 756e 6b73 2062 7920 6661   of chunks by fa
-00020690: 6374 6f72 206f 6620 2564 2220 2520 286e  ctor of %d" % (n
-000206a0: 7061 7274 7320 2f20 6d61 785f 7061 7274  parts / max_part
-000206b0: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
-000206c0: 5065 7266 6f72 6d61 6e63 6557 6172 6e69  PerformanceWarni
-000206d0: 6e67 2c0a 2020 2020 2020 2020 2020 2020  ng,.            
-000206e0: 7374 6163 6b6c 6576 656c 3d33 2c0a 2020  stacklevel=3,.  
-000206f0: 2020 2020 2020 290a 0a20 2020 2061 7272        )..    arr
-00020700: 6179 7320 3d20 5b5d 0a20 2020 2066 6f72  ays = [].    for
-00020710: 2061 2c20 6920 696e 2061 7267 696e 6473   a, i in arginds
-00020720: 3a0a 2020 2020 2020 2020 6966 2069 2069  :.        if i i
-00020730: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00020740: 2020 2020 6172 7261 7973 2e61 7070 656e      arrays.appen
-00020750: 6428 6129 0a20 2020 2020 2020 2065 6c73  d(a).        els
-00020760: 653a 0a20 2020 2020 2020 2020 2020 2063  e:.            c
-00020770: 6875 6e6b 7320 3d20 7475 706c 6528 0a20  hunks = tuple(. 
-00020780: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00020790: 6875 6e6b 7373 5b6a 5d0a 2020 2020 2020  hunkss[j].      
-000207a0: 2020 2020 2020 2020 2020 6966 2061 2e73            if a.s
-000207b0: 6861 7065 5b6e 5d20 3e20 310a 2020 2020  hape[n] > 1.    
-000207c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000207d0: 2061 2e73 6861 7065 5b6e 5d0a 2020 2020   a.shape[n].    
-000207e0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-000207f0: 6f74 206e 702e 6973 6e61 6e28 7375 6d28  ot np.isnan(sum(
-00020800: 6368 756e 6b73 735b 6a5d 2929 0a20 2020  chunkss[j])).   
-00020810: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00020820: 6520 4e6f 6e65 0a20 2020 2020 2020 2020  e None.         
-00020830: 2020 2020 2020 2066 6f72 206e 2c20 6a20         for n, j 
-00020840: 696e 2065 6e75 6d65 7261 7465 2869 290a  in enumerate(i).
-00020850: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00020860: 2020 2020 2020 2020 2020 6966 2063 6875            if chu
-00020870: 6e6b 7320 213d 2061 2e63 6875 6e6b 7320  nks != a.chunks 
-00020880: 616e 6420 616c 6c28 612e 6368 756e 6b73  and all(a.chunks
-00020890: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000208a0: 2020 2061 7272 6179 732e 6170 7065 6e64     arrays.append
-000208b0: 2861 2e72 6563 6875 6e6b 2863 6875 6e6b  (a.rechunk(chunk
-000208c0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
-000208d0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-000208e0: 2020 2020 2020 6172 7261 7973 2e61 7070        arrays.app
-000208f0: 656e 6428 6129 0a20 2020 2072 6574 7572  end(a).    retur
-00020900: 6e20 6368 756e 6b73 732c 2061 7272 6179  n chunkss, array
-00020910: 730a 0a0a 6465 6620 756e 7061 636b 5f73  s...def unpack_s
-00020920: 696e 676c 6574 6f6e 2878 293a 0a20 2020  ingleton(x):.   
-00020930: 2022 2222 0a0a 2020 2020 3e3e 3e20 756e   """..    >>> un
-00020940: 7061 636b 5f73 696e 676c 6574 6f6e 285b  pack_singleton([
-00020950: 5b5b 5b31 5d5d 5d5d 290a 2020 2020 310a  [[[1]]]]).    1.
-00020960: 2020 2020 3e3e 3e20 756e 7061 636b 5f73      >>> unpack_s
-00020970: 696e 676c 6574 6f6e 286e 702e 6172 7261  ingleton(np.arra
-00020980: 7928 6e70 2e64 6174 6574 696d 6536 3428  y(np.datetime64(
-00020990: 2732 3030 302d 3031 2d30 3127 2929 290a  '2000-01-01'))).
-000209a0: 2020 2020 6172 7261 7928 2732 3030 302d      array('2000-
-000209b0: 3031 2d30 3127 2c20 6474 7970 653d 2764  01-01', dtype='d
-000209c0: 6174 6574 696d 6536 345b 445d 2729 0a20  atetime64[D]'). 
-000209d0: 2020 2022 2222 0a20 2020 2077 6869 6c65     """.    while
-000209e0: 2069 7369 6e73 7461 6e63 6528 782c 2028   isinstance(x, (
-000209f0: 6c69 7374 2c20 7475 706c 6529 293a 0a20  list, tuple)):. 
-00020a00: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00020a10: 2020 2020 2020 2020 7820 3d20 785b 305d          x = x[0]
-00020a20: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-00020a30: 2849 6e64 6578 4572 726f 722c 2054 7970  (IndexError, Typ
-00020a40: 6545 7272 6f72 2c20 4b65 7945 7272 6f72  eError, KeyError
-00020a50: 293a 0a20 2020 2020 2020 2020 2020 2062  ):.            b
-00020a60: 7265 616b 0a20 2020 2072 6574 7572 6e20  reak.    return 
-00020a70: 780a 0a0a 6465 6620 626c 6f63 6b28 6172  x...def block(ar
-00020a80: 7261 7973 2c20 616c 6c6f 775f 756e 6b6e  rays, allow_unkn
-00020a90: 6f77 6e5f 6368 756e 6b73 697a 6573 3d46  own_chunksizes=F
-00020aa0: 616c 7365 293a 0a20 2020 2022 2222 0a20  alse):.    """. 
-00020ab0: 2020 2041 7373 656d 626c 6520 616e 206e     Assemble an n
-00020ac0: 642d 6172 7261 7920 6672 6f6d 206e 6573  d-array from nes
-00020ad0: 7465 6420 6c69 7374 7320 6f66 2062 6c6f  ted lists of blo
-00020ae0: 636b 732e 0a0a 2020 2020 426c 6f63 6b73  cks...    Blocks
-00020af0: 2069 6e20 7468 6520 696e 6e65 726d 6f73   in the innermos
-00020b00: 7420 6c69 7374 7320 6172 6520 636f 6e63  t lists are conc
-00020b10: 6174 656e 6174 6564 2061 6c6f 6e67 2074  atenated along t
-00020b20: 6865 206c 6173 740a 2020 2020 6469 6d65  he last.    dime
-00020b30: 6e73 696f 6e20 282d 3129 2c20 7468 656e  nsion (-1), then
-00020b40: 2074 6865 7365 2061 7265 2063 6f6e 6361   these are conca
-00020b50: 7465 6e61 7465 6420 616c 6f6e 6720 7468  tenated along th
-00020b60: 6520 7365 636f 6e64 2d6c 6173 740a 2020  e second-last.  
-00020b70: 2020 6469 6d65 6e73 696f 6e20 282d 3229    dimension (-2)
-00020b80: 2c20 616e 6420 736f 206f 6e20 756e 7469  , and so on unti
-00020b90: 6c20 7468 6520 6f75 7465 726d 6f73 7420  l the outermost 
-00020ba0: 6c69 7374 2069 7320 7265 6163 6865 640a  list is reached.
-00020bb0: 0a20 2020 2042 6c6f 636b 7320 6361 6e20  .    Blocks can 
-00020bc0: 6265 206f 6620 616e 7920 6469 6d65 6e73  be of any dimens
-00020bd0: 696f 6e2c 2062 7574 2077 696c 6c20 6e6f  ion, but will no
-00020be0: 7420 6265 2062 726f 6164 6361 7374 6564  t be broadcasted
-00020bf0: 2075 7369 6e67 2074 6865 206e 6f72 6d61   using the norma
-00020c00: 6c0a 2020 2020 7275 6c65 732e 2049 6e73  l.    rules. Ins
-00020c10: 7465 6164 2c20 6c65 6164 696e 6720 6178  tead, leading ax
-00020c20: 6573 206f 6620 7369 7a65 2031 2061 7265  es of size 1 are
-00020c30: 2069 6e73 6572 7465 642c 2074 6f20 6d61   inserted, to ma
-00020c40: 6b65 2060 6062 6c6f 636b 2e6e 6469 6d60  ke ``block.ndim`
-00020c50: 600a 2020 2020 7468 6520 7361 6d65 2066  `.    the same f
-00020c60: 6f72 2061 6c6c 2062 6c6f 636b 732e 2054  or all blocks. T
-00020c70: 6869 7320 6973 2070 7269 6d61 7269 6c79  his is primarily
-00020c80: 2075 7365 6675 6c20 666f 7220 776f 726b   useful for work
-00020c90: 696e 6720 7769 7468 2073 6361 6c61 7273  ing with scalars
-00020ca0: 2c0a 2020 2020 616e 6420 6d65 616e 7320  ,.    and means 
-00020cb0: 7468 6174 2063 6f64 6520 6c69 6b65 2060  that code like `
-00020cc0: 6062 6c6f 636b 285b 762c 2031 5d29 6060  `block([v, 1])``
-00020cd0: 2069 7320 7661 6c69 642c 2077 6865 7265   is valid, where
-00020ce0: 0a20 2020 2060 6076 2e6e 6469 6d20 3d3d  .    ``v.ndim ==
-00020cf0: 2031 6060 2e0a 0a20 2020 2057 6865 6e20   1``...    When 
-00020d00: 7468 6520 6e65 7374 6564 206c 6973 7420  the nested list 
-00020d10: 6973 2074 776f 206c 6576 656c 7320 6465  is two levels de
-00020d20: 6570 2c20 7468 6973 2061 6c6c 6f77 7320  ep, this allows 
-00020d30: 626c 6f63 6b20 6d61 7472 6963 6573 2074  block matrices t
-00020d40: 6f20 6265 0a20 2020 2063 6f6e 7374 7275  o be.    constru
-00020d50: 6374 6564 2066 726f 6d20 7468 6569 7220  cted from their 
-00020d60: 636f 6d70 6f6e 656e 7473 2e0a 0a20 2020  components...   
-00020d70: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-00020d80: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061  ----------.    a
-00020d90: 7272 6179 7320 3a20 6e65 7374 6564 206c  rrays : nested l
-00020da0: 6973 7420 6f66 2061 7272 6179 5f6c 696b  ist of array_lik
-00020db0: 6520 6f72 2073 6361 6c61 7273 2028 6275  e or scalars (bu
-00020dc0: 7420 6e6f 7420 7475 706c 6573 290a 2020  t not tuples).  
-00020dd0: 2020 2020 2020 4966 2070 6173 7365 6420        If passed 
-00020de0: 6120 7369 6e67 6c65 206e 6461 7272 6179  a single ndarray
-00020df0: 206f 7220 7363 616c 6172 2028 6120 6e65   or scalar (a ne
-00020e00: 7374 6564 206c 6973 7420 6f66 2064 6570  sted list of dep
-00020e10: 7468 2030 292c 2074 6869 730a 2020 2020  th 0), this.    
-00020e20: 2020 2020 6973 2072 6574 7572 6e65 6420      is returned 
-00020e30: 756e 6d6f 6469 6669 6564 2028 616e 6420  unmodified (and 
-00020e40: 6e6f 7420 636f 7069 6564 292e 0a0a 2020  not copied)...  
-00020e50: 2020 2020 2020 456c 656d 656e 7473 2073        Elements s
-00020e60: 6861 7065 7320 6d75 7374 206d 6174 6368  hapes must match
-00020e70: 2061 6c6f 6e67 2074 6865 2061 7070 726f   along the appro
-00020e80: 7072 6961 7465 2061 7865 7320 2877 6974  priate axes (wit
-00020e90: 686f 7574 0a20 2020 2020 2020 2062 726f  hout.        bro
-00020ea0: 6164 6361 7374 696e 6729 2c20 6275 7420  adcasting), but 
-00020eb0: 6c65 6164 696e 6720 3173 2077 696c 6c20  leading 1s will 
-00020ec0: 6265 2070 7265 7065 6e64 6564 2074 6f20  be prepended to 
-00020ed0: 7468 6520 7368 6170 6520 6173 0a20 2020  the shape as.   
-00020ee0: 2020 2020 206e 6563 6573 7361 7279 2074       necessary t
-00020ef0: 6f20 6d61 6b65 2074 6865 2064 696d 656e  o make the dimen
-00020f00: 7369 6f6e 7320 6d61 7463 682e 0a0a 2020  sions match...  
-00020f10: 2020 616c 6c6f 775f 756e 6b6e 6f77 6e5f    allow_unknown_
-00020f20: 6368 756e 6b73 697a 6573 3a20 626f 6f6c  chunksizes: bool
-00020f30: 0a20 2020 2020 2020 2041 6c6c 6f77 2075  .        Allow u
-00020f40: 6e6b 6e6f 776e 2063 6875 6e6b 7369 7a65  nknown chunksize
-00020f50: 732c 2073 7563 6820 6173 2063 6f6d 6520  s, such as come 
-00020f60: 6672 6f6d 2063 6f6e 7665 7274 696e 6720  from converting 
-00020f70: 6672 6f6d 2064 6173 6b0a 2020 2020 2020  from dask.      
-00020f80: 2020 6461 7461 6672 616d 6573 2e20 2044    dataframes.  D
-00020f90: 6173 6b2e 6172 7261 7920 6973 2075 6e61  ask.array is una
-00020fa0: 626c 6520 746f 2076 6572 6966 7920 7468  ble to verify th
-00020fb0: 6174 2063 6875 6e6b 7320 6c69 6e65 2075  at chunks line u
-00020fc0: 702e 2020 4966 0a20 2020 2020 2020 2064  p.  If.        d
-00020fd0: 6174 6120 636f 6d65 7320 6672 6f6d 2064  ata comes from d
-00020fe0: 6966 6665 7265 6e74 6c79 2061 6c69 676e  ifferently align
-00020ff0: 6564 2073 6f75 7263 6573 2074 6865 6e20  ed sources then 
-00021000: 7468 6973 2063 616e 2063 6175 7365 0a20  this can cause. 
-00021010: 2020 2020 2020 2075 6e65 7870 6563 7465         unexpecte
-00021020: 6420 7265 7375 6c74 732e 0a0a 2020 2020  d results...    
-00021030: 5265 7475 726e 730a 2020 2020 2d2d 2d2d  Returns.    ----
-00021040: 2d2d 2d0a 2020 2020 626c 6f63 6b5f 6172  ---.    block_ar
-00021050: 7261 7920 3a20 6e64 6172 7261 790a 2020  ray : ndarray.  
-00021060: 2020 2020 2020 5468 6520 6172 7261 7920        The array 
-00021070: 6173 7365 6d62 6c65 6420 6672 6f6d 2074  assembled from t
-00021080: 6865 2067 6976 656e 2062 6c6f 636b 732e  he given blocks.
-00021090: 0a0a 2020 2020 2020 2020 5468 6520 6469  ..        The di
-000210a0: 6d65 6e73 696f 6e61 6c69 7479 206f 6620  mensionality of 
-000210b0: 7468 6520 6f75 7470 7574 2069 7320 6571  the output is eq
-000210c0: 7561 6c20 746f 2074 6865 2067 7265 6174  ual to the great
-000210d0: 6573 7420 6f66 3a0a 2020 2020 2020 2020  est of:.        
-000210e0: 2a20 7468 6520 6469 6d65 6e73 696f 6e61  * the dimensiona
-000210f0: 6c69 7479 206f 6620 616c 6c20 7468 6520  lity of all the 
-00021100: 696e 7075 7473 0a20 2020 2020 2020 202a  inputs.        *
-00021110: 2074 6865 2064 6570 7468 2074 6f20 7768   the depth to wh
-00021120: 6963 6820 7468 6520 696e 7075 7420 6c69  ich the input li
-00021130: 7374 2069 7320 6e65 7374 6564 0a0a 2020  st is nested..  
-00021140: 2020 5261 6973 6573 0a20 2020 202d 2d2d    Raises.    ---
-00021150: 2d2d 2d0a 2020 2020 5661 6c75 6545 7272  ---.    ValueErr
-00021160: 6f72 0a20 2020 2020 2020 202a 2049 6620  or.        * If 
-00021170: 6c69 7374 2064 6570 7468 7320 6172 6520  list depths are 
-00021180: 6d69 736d 6174 6368 6564 202d 2066 6f72  mismatched - for
-00021190: 2069 6e73 7461 6e63 652c 2060 605b 5b61   instance, ``[[a
-000211a0: 2c20 625d 2c20 635d 6060 2069 730a 2020  , b], c]`` is.  
-000211b0: 2020 2020 2020 2020 696c 6c65 6761 6c2c          illegal,
-000211c0: 2061 6e64 2073 686f 756c 6420 6265 2073   and should be s
-000211d0: 7065 6c74 2060 605b 5b61 2c20 625d 2c20  pelt ``[[a, b], 
-000211e0: 5b63 5d5d 6060 0a20 2020 2020 2020 202a  [c]]``.        *
-000211f0: 2049 6620 6c69 7374 7320 6172 6520 656d   If lists are em
-00021200: 7074 7920 2d20 666f 7220 696e 7374 616e  pty - for instan
-00021210: 6365 2c20 6060 5b5b 612c 2062 5d2c 205b  ce, ``[[a, b], [
-00021220: 5d5d 6060 0a0a 2020 2020 5365 6520 416c  ]]``..    See Al
-00021230: 736f 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  so.    --------.
-00021240: 2020 2020 636f 6e63 6174 656e 6174 6520      concatenate 
-00021250: 3a20 4a6f 696e 2061 2073 6571 7565 6e63  : Join a sequenc
-00021260: 6520 6f66 2061 7272 6179 7320 746f 6765  e of arrays toge
-00021270: 7468 6572 2e0a 2020 2020 7374 6163 6b20  ther..    stack 
-00021280: 3a20 5374 6163 6b20 6172 7261 7973 2069  : Stack arrays i
-00021290: 6e20 7365 7175 656e 6365 2061 6c6f 6e67  n sequence along
-000212a0: 2061 206e 6577 2064 696d 656e 7369 6f6e   a new dimension
-000212b0: 2e0a 2020 2020 6873 7461 636b 203a 2053  ..    hstack : S
-000212c0: 7461 636b 2061 7272 6179 7320 696e 2073  tack arrays in s
-000212d0: 6571 7565 6e63 6520 686f 7269 7a6f 6e74  equence horizont
-000212e0: 616c 6c79 2028 636f 6c75 6d6e 2077 6973  ally (column wis
-000212f0: 6529 2e0a 2020 2020 7673 7461 636b 203a  e)..    vstack :
-00021300: 2053 7461 636b 2061 7272 6179 7320 696e   Stack arrays in
-00021310: 2073 6571 7565 6e63 6520 7665 7274 6963   sequence vertic
-00021320: 616c 6c79 2028 726f 7720 7769 7365 292e  ally (row wise).
-00021330: 0a20 2020 2064 7374 6163 6b20 3a20 5374  .    dstack : St
-00021340: 6163 6b20 6172 7261 7973 2069 6e20 7365  ack arrays in se
-00021350: 7175 656e 6365 2064 6570 7468 2077 6973  quence depth wis
-00021360: 6520 2861 6c6f 6e67 2074 6869 7264 2064  e (along third d
-00021370: 696d 656e 7369 6f6e 292e 0a20 2020 2076  imension)..    v
-00021380: 7370 6c69 7420 3a20 5370 6c69 7420 6172  split : Split ar
-00021390: 7261 7920 696e 746f 2061 206c 6973 7420  ray into a list 
-000213a0: 6f66 206d 756c 7469 706c 6520 7375 622d  of multiple sub-
-000213b0: 6172 7261 7973 2076 6572 7469 6361 6c6c  arrays verticall
-000213c0: 792e 0a0a 2020 2020 4e6f 7465 730a 2020  y...    Notes.  
-000213d0: 2020 2d2d 2d2d 2d0a 0a20 2020 2057 6865    -----..    Whe
-000213e0: 6e20 6361 6c6c 6564 2077 6974 6820 6f6e  n called with on
-000213f0: 6c79 2073 6361 6c61 7273 2c20 6060 626c  ly scalars, ``bl
-00021400: 6f63 6b60 6020 6973 2065 7175 6976 616c  ock`` is equival
-00021410: 656e 7420 746f 2061 6e20 6e64 6172 7261  ent to an ndarra
-00021420: 790a 2020 2020 6361 6c6c 2e20 536f 2060  y.    call. So `
-00021430: 6062 6c6f 636b 285b 5b31 2c20 325d 2c20  `block([[1, 2], 
-00021440: 5b33 2c20 345d 5d29 6060 2069 7320 6571  [3, 4]])`` is eq
-00021450: 7569 7661 6c65 6e74 2074 6f0a 2020 2020  uivalent to.    
-00021460: 6060 6172 7261 7928 5b5b 312c 2032 5d2c  ``array([[1, 2],
-00021470: 205b 332c 2034 5d5d 2960 602e 0a0a 2020   [3, 4]])``...  
-00021480: 2020 5468 6973 2066 756e 6374 696f 6e20    This function 
-00021490: 646f 6573 206e 6f74 2065 6e66 6f72 6365  does not enforce
-000214a0: 2074 6861 7420 7468 6520 626c 6f63 6b73   that the blocks
-000214b0: 206c 6965 206f 6e20 6120 6669 7865 6420   lie on a fixed 
-000214c0: 6772 6964 2e0a 2020 2020 6060 626c 6f63  grid..    ``bloc
-000214d0: 6b28 5b5b 612c 2062 5d2c 205b 632c 2064  k([[a, b], [c, d
-000214e0: 5d5d 2960 6020 6973 206e 6f74 2072 6573  ]])`` is not res
-000214f0: 7472 6963 7465 6420 746f 2061 7272 6179  tricted to array
-00021500: 7320 6f66 2074 6865 2066 6f72 6d3a 3a0a  s of the form::.
-00021510: 0a20 2020 2020 2020 2041 4141 6262 0a20  .        AAAbb. 
-00021520: 2020 2020 2020 2041 4141 6262 0a20 2020         AAAbb.   
-00021530: 2020 2020 2063 6363 4444 0a0a 2020 2020       cccDD..    
-00021540: 4275 7420 6973 2061 6c73 6f20 616c 6c6f  But is also allo
-00021550: 7765 6420 746f 2070 726f 6475 6365 2c20  wed to produce, 
-00021560: 666f 7220 736f 6d65 2060 6061 2c20 622c  for some ``a, b,
-00021570: 2063 2c20 6460 603a 3a0a 0a20 2020 2020   c, d``::..     
-00021580: 2020 2041 4141 6262 0a20 2020 2020 2020     AAAbb.       
-00021590: 2041 4141 6262 0a20 2020 2020 2020 2063   AAAbb.        c
-000215a0: 4444 4444 0a0a 2020 2020 5369 6e63 6520  DDDD..    Since 
-000215b0: 636f 6e63 6174 656e 6174 696f 6e20 6861  concatenation ha
-000215c0: 7070 656e 7320 616c 6f6e 6720 7468 6520  ppens along the 
-000215d0: 6c61 7374 2061 7869 7320 6669 7273 742c  last axis first,
-000215e0: 2060 626c 6f63 6b60 2069 7320 5f6e 6f74   `block` is _not
-000215f0: 5f0a 2020 2020 6361 7061 626c 6520 6f66  _.    capable of
-00021600: 2070 726f 6475 6369 6e67 2074 6865 2066   producing the f
-00021610: 6f6c 6c6f 7769 6e67 2064 6972 6563 746c  ollowing directl
-00021620: 793a 3a0a 0a20 2020 2020 2020 2041 4141  y::..        AAA
-00021630: 6262 0a20 2020 2020 2020 2063 6363 6262  bb.        cccbb
-00021640: 0a20 2020 2020 2020 2063 6363 4444 0a0a  .        cccDD..
-00021650: 2020 2020 4d61 746c 6162 2773 2022 7371      Matlab's "sq
-00021660: 7561 7265 2062 7261 636b 6574 2073 7461  uare bracket sta
-00021670: 636b 696e 6722 2c20 6060 5b41 2c20 422c  cking", ``[A, B,
-00021680: 202e 2e2e 3b20 702c 2071 2c20 2e2e 2e5d   ...; p, q, ...]
-00021690: 6060 2c20 6973 0a20 2020 2065 7175 6976  ``, is.    equiv
-000216a0: 616c 656e 7420 746f 2060 6062 6c6f 636b  alent to ``block
-000216b0: 285b 5b41 2c20 422c 202e 2e2e 5d2c 205b  ([[A, B, ...], [
-000216c0: 702c 2071 2c20 2e2e 2e5d 5d29 6060 2e0a  p, q, ...]])``..
-000216d0: 2020 2020 2222 220a 0a20 2020 2023 2054      """..    # T
-000216e0: 6869 7320 7761 7320 636f 7069 6564 2061  his was copied a
-000216f0: 6c6d 6f73 7420 7665 7262 6174 696d 2066  lmost verbatim f
-00021700: 726f 6d20 6e75 6d70 792e 636f 7265 2e73  rom numpy.core.s
-00021710: 6861 7065 5f62 6173 652e 626c 6f63 6b0a  hape_base.block.
-00021720: 2020 2020 2320 5365 6520 6e75 6d70 7920      # See numpy 
-00021730: 6c69 6365 6e73 6520 6174 2068 7474 7073  license at https
-00021740: 3a2f 2f67 6974 6875 622e 636f 6d2f 6e75  ://github.com/nu
-00021750: 6d70 792f 6e75 6d70 792f 626c 6f62 2f6d  mpy/numpy/blob/m
-00021760: 6173 7465 722f 4c49 4345 4e53 452e 7478  aster/LICENSE.tx
-00021770: 740a 2020 2020 2320 6f72 204e 554d 5059  t.    # or NUMPY
-00021780: 5f4c 4943 454e 5345 2e74 7874 2077 6974  _LICENSE.txt wit
-00021790: 6869 6e20 7468 6973 2064 6972 6563 746f  hin this directo
-000217a0: 7279 0a0a 2020 2020 6465 6620 6174 6c65  ry..    def atle
-000217b0: 6173 745f 6e64 2878 2c20 6e64 696d 293a  ast_nd(x, ndim):
-000217c0: 0a20 2020 2020 2020 2078 203d 2061 7361  .        x = asa
-000217d0: 6e79 6172 7261 7928 7829 0a20 2020 2020  nyarray(x).     
-000217e0: 2020 2064 6966 6620 3d20 6d61 7828 6e64     diff = max(nd
-000217f0: 696d 202d 2078 2e6e 6469 6d2c 2030 290a  im - x.ndim, 0).
-00021800: 2020 2020 2020 2020 6966 2064 6966 6620          if diff 
-00021810: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00021820: 2020 7265 7475 726e 2078 0a20 2020 2020    return x.     
-00021830: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00021840: 2020 2020 2072 6574 7572 6e20 785b 284e       return x[(N
-00021850: 6f6e 652c 2920 2a20 6469 6666 202b 2028  one,) * diff + (
-00021860: 456c 6c69 7073 6973 2c29 5d0a 0a20 2020  Ellipsis,)]..   
-00021870: 2064 6566 2066 6f72 6d61 745f 696e 6465   def format_inde
-00021880: 7828 696e 6465 7829 3a0a 2020 2020 2020  x(index):.      
-00021890: 2020 7265 7475 726e 2022 6172 7261 7973    return "arrays
-000218a0: 2220 2b20 2222 2e6a 6f69 6e28 6622 5b7b  " + "".join(f"[{
-000218b0: 697d 5d22 2066 6f72 2069 2069 6e20 696e  i}]" for i in in
-000218c0: 6465 7829 0a0a 2020 2020 7265 6320 3d20  dex)..    rec = 
-000218d0: 5f52 6563 7572 7365 7228 7265 6375 7273  _Recurser(recurs
-000218e0: 655f 6966 3d6c 616d 6264 6120 783a 2074  e_if=lambda x: t
-000218f0: 7970 6528 7829 2069 7320 6c69 7374 290a  ype(x) is list).
-00021900: 0a20 2020 2023 2065 6e73 7572 6520 7468  .    # ensure th
-00021910: 6174 2074 6865 206c 6973 7473 2061 7265  at the lists are
-00021920: 2061 6c6c 206d 6174 6368 6564 2069 6e20   all matched in 
-00021930: 6465 7074 680a 2020 2020 6c69 7374 5f6e  depth.    list_n
-00021940: 6469 6d20 3d20 4e6f 6e65 0a20 2020 2061  dim = None.    a
-00021950: 6e79 5f65 6d70 7479 203d 2046 616c 7365  ny_empty = False
-00021960: 0a20 2020 2066 6f72 2069 6e64 6578 2c20  .    for index, 
-00021970: 7661 6c75 652c 2065 6e74 6572 696e 6720  value, entering 
-00021980: 696e 2072 6563 2e77 616c 6b28 6172 7261  in rec.walk(arra
-00021990: 7973 293a 0a20 2020 2020 2020 2069 6620  ys):.        if 
-000219a0: 7479 7065 2876 616c 7565 2920 6973 2074  type(value) is t
-000219b0: 7570 6c65 3a0a 2020 2020 2020 2020 2020  uple:.          
-000219c0: 2020 2320 6e6f 7420 7374 7269 6374 6c79    # not strictly
-000219d0: 206e 6563 6573 7361 7279 2c20 6275 7420   necessary, but 
-000219e0: 7361 7665 7320 7573 2066 726f 6d3a 0a20  saves us from:. 
-000219f0: 2020 2020 2020 2020 2020 2023 2020 2d20             #  - 
-00021a00: 6d6f 7265 2074 6861 6e20 6f6e 6520 7761  more than one wa
-00021a10: 7920 746f 2064 6f20 7468 696e 6773 202d  y to do things -
-00021a20: 206e 6f20 706f 696e 7420 7472 6561 7469   no point treati
-00021a30: 6e67 2074 7570 6c65 7320 6c69 6b65 0a20  ng tuples like. 
-00021a40: 2020 2020 2020 2020 2020 2023 2020 2020             #    
-00021a50: 6c69 7374 730a 2020 2020 2020 2020 2020  lists.          
-00021a60: 2020 2320 202d 2068 6f72 7269 626c 7920    #  - horribly 
-00021a70: 636f 6e66 7573 696e 6720 6265 6861 7669  confusing behavi
-00021a80: 6f75 7220 7468 6174 2072 6573 756c 7473  our that results
-00021a90: 2077 6865 6e20 7475 706c 6573 2061 7265   when tuples are
-00021aa0: 0a20 2020 2020 2020 2020 2020 2023 2020  .            #  
-00021ab0: 2020 7472 6561 7465 6420 6c69 6b65 206e    treated like n
-00021ac0: 6461 7272 6179 0a20 2020 2020 2020 2020  darray.         
-00021ad0: 2020 2072 6169 7365 2054 7970 6545 7272     raise TypeErr
-00021ae0: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
-00021af0: 2020 2020 227b 7d20 6973 2061 2074 7570      "{} is a tup
-00021b00: 6c65 2e20 220a 2020 2020 2020 2020 2020  le. ".          
-00021b10: 2020 2020 2020 224f 6e6c 7920 6c69 7374        "Only list
-00021b20: 7320 6361 6e20 6265 2075 7365 6420 746f  s can be used to
-00021b30: 2061 7272 616e 6765 2062 6c6f 636b 732c   arrange blocks,
-00021b40: 2061 6e64 206e 702e 626c 6f63 6b20 646f   and np.block do
-00021b50: 6573 2022 0a20 2020 2020 2020 2020 2020  es ".           
-00021b60: 2020 2020 2022 6e6f 7420 616c 6c6f 7720       "not allow 
-00021b70: 696d 706c 6963 6974 2063 6f6e 7665 7273  implicit convers
-00021b80: 696f 6e20 6672 6f6d 2074 7570 6c65 2074  ion from tuple t
-00021b90: 6f20 6e64 6172 7261 792e 222e 666f 726d  o ndarray.".form
-00021ba0: 6174 280a 2020 2020 2020 2020 2020 2020  at(.            
-00021bb0: 2020 2020 2020 2020 666f 726d 6174 5f69          format_i
-00021bc0: 6e64 6578 2869 6e64 6578 290a 2020 2020  ndex(index).    
-00021bd0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00021be0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00021bf0: 2020 2020 6966 206e 6f74 2065 6e74 6572      if not enter
-00021c00: 696e 673a 0a20 2020 2020 2020 2020 2020  ing:.           
-00021c10: 2063 7572 725f 6465 7074 6820 3d20 6c65   curr_depth = le
-00021c20: 6e28 696e 6465 7829 0a20 2020 2020 2020  n(index).       
-00021c30: 2065 6c69 6620 6c65 6e28 7661 6c75 6529   elif len(value)
-00021c40: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00021c50: 2020 2063 7572 725f 6465 7074 6820 3d20     curr_depth = 
-00021c60: 6c65 6e28 696e 6465 7829 202b 2031 0a20  len(index) + 1. 
-00021c70: 2020 2020 2020 2020 2020 2061 6e79 5f65             any_e
-00021c80: 6d70 7479 203d 2054 7275 650a 2020 2020  mpty = True.    
-00021c90: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00021ca0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-00021cb0: 2020 2020 2020 2020 6966 206c 6973 745f          if list_
-00021cc0: 6e64 696d 2069 7320 6e6f 7420 4e6f 6e65  ndim is not None
-00021cd0: 2061 6e64 206c 6973 745f 6e64 696d 2021   and list_ndim !
-00021ce0: 3d20 6375 7272 5f64 6570 7468 3a0a 2020  = curr_depth:.  
-00021cf0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00021d00: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00021d10: 2020 2020 2020 2020 2020 2020 224c 6973              "Lis
-00021d20: 7420 6465 7074 6873 2061 7265 206d 6973  t depths are mis
-00021d30: 6d61 7463 6865 642e 2046 6972 7374 2065  matched. First e
-00021d40: 6c65 6d65 6e74 2077 6173 2061 7420 6465  lement was at de
-00021d50: 7074 6820 7b7d 2c20 220a 2020 2020 2020  pth {}, ".      
-00021d60: 2020 2020 2020 2020 2020 2262 7574 2074            "but t
-00021d70: 6865 7265 2069 7320 616e 2065 6c65 6d65  here is an eleme
-00021d80: 6e74 2061 7420 6465 7074 6820 7b7d 2028  nt at depth {} (
-00021d90: 7b7d 2922 2e66 6f72 6d61 7428 0a20 2020  {})".format(.   
-00021da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021db0: 206c 6973 745f 6e64 696d 2c20 6375 7272   list_ndim, curr
-00021dc0: 5f64 6570 7468 2c20 666f 726d 6174 5f69  _depth, format_i
-00021dd0: 6e64 6578 2869 6e64 6578 290a 2020 2020  ndex(index).    
-00021de0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00021df0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00021e00: 2020 2020 6c69 7374 5f6e 6469 6d20 3d20      list_ndim = 
-00021e10: 6375 7272 5f64 6570 7468 0a0a 2020 2020  curr_depth..    
-00021e20: 2320 646f 2074 6869 7320 6865 7265 2073  # do this here s
-00021e30: 6f20 7765 2063 6174 6368 2064 6570 7468  o we catch depth
-00021e40: 206d 6973 6d61 7463 6865 7320 6669 7273   mismatches firs
-00021e50: 740a 2020 2020 6966 2061 6e79 5f65 6d70  t.    if any_emp
-00021e60: 7479 3a0a 2020 2020 2020 2020 7261 6973  ty:.        rais
-00021e70: 6520 5661 6c75 6545 7272 6f72 2822 4c69  e ValueError("Li
-00021e80: 7374 7320 6361 6e6e 6f74 2062 6520 656d  sts cannot be em
-00021e90: 7074 7922 290a 0a20 2020 2023 2063 6f6e  pty")..    # con
-00021ea0: 7665 7274 2061 6c6c 2074 6865 2061 7272  vert all the arr
-00021eb0: 6179 7320 746f 206e 6461 7272 6179 730a  ays to ndarrays.
-00021ec0: 2020 2020 6172 7261 7973 203d 2072 6563      arrays = rec
-00021ed0: 2e6d 6170 5f72 6564 7563 6528 6172 7261  .map_reduce(arra
-00021ee0: 7973 2c20 665f 6d61 703d 6173 616e 7961  ys, f_map=asanya
-00021ef0: 7272 6179 2c20 665f 7265 6475 6365 3d6c  rray, f_reduce=l
-00021f00: 6973 7429 0a0a 2020 2020 2320 6465 7465  ist)..    # dete
-00021f10: 726d 696e 6520 7468 6520 6d61 7869 6d75  rmine the maximu
-00021f20: 6d20 6469 6d65 6e73 696f 6e20 6f66 2074  m dimension of t
-00021f30: 6865 2065 6c65 6d65 6e74 730a 2020 2020  he elements.    
-00021f40: 656c 656d 5f6e 6469 6d20 3d20 7265 632e  elem_ndim = rec.
-00021f50: 6d61 705f 7265 6475 6365 2861 7272 6179  map_reduce(array
-00021f60: 732c 2066 5f6d 6170 3d6c 616d 6264 6120  s, f_map=lambda 
-00021f70: 7869 3a20 7869 2e6e 6469 6d2c 2066 5f72  xi: xi.ndim, f_r
-00021f80: 6564 7563 653d 6d61 7829 0a20 2020 206e  educe=max).    n
-00021f90: 6469 6d20 3d20 6d61 7828 6c69 7374 5f6e  dim = max(list_n
-00021fa0: 6469 6d2c 2065 6c65 6d5f 6e64 696d 290a  dim, elem_ndim).
-00021fb0: 0a20 2020 2023 2066 6972 7374 2061 7869  .    # first axi
-00021fc0: 7320 746f 2063 6f6e 6361 7465 6e61 7465  s to concatenate
-00021fd0: 2061 6c6f 6e67 0a20 2020 2066 6972 7374   along.    first
-00021fe0: 5f61 7869 7320 3d20 6e64 696d 202d 206c  _axis = ndim - l
-00021ff0: 6973 745f 6e64 696d 0a0a 2020 2020 2320  ist_ndim..    # 
-00022000: 4d61 6b65 2061 6c6c 2074 6865 2065 6c65  Make all the ele
-00022010: 6d65 6e74 7320 7468 6520 7361 6d65 2064  ments the same d
-00022020: 696d 656e 7369 6f6e 0a20 2020 2061 7272  imension.    arr
-00022030: 6179 7320 3d20 7265 632e 6d61 705f 7265  ays = rec.map_re
-00022040: 6475 6365 280a 2020 2020 2020 2020 6172  duce(.        ar
-00022050: 7261 7973 2c20 665f 6d61 703d 6c61 6d62  rays, f_map=lamb
-00022060: 6461 2078 693a 2061 746c 6561 7374 5f6e  da xi: atleast_n
-00022070: 6428 7869 2c20 6e64 696d 292c 2066 5f72  d(xi, ndim), f_r
-00022080: 6564 7563 653d 6c69 7374 0a20 2020 2029  educe=list.    )
-00022090: 0a0a 2020 2020 2320 636f 6e63 6174 656e  ..    # concaten
-000220a0: 6174 6520 696e 6e65 726d 6f73 7420 6c69  ate innermost li
-000220b0: 7374 7320 6f6e 2074 6865 2072 6967 6874  sts on the right
-000220c0: 2c20 6f75 7465 726d 6f73 7420 6f6e 2074  , outermost on t
-000220d0: 6865 206c 6566 740a 2020 2020 7265 7475  he left.    retu
-000220e0: 726e 2072 6563 2e6d 6170 5f72 6564 7563  rn rec.map_reduc
-000220f0: 6528 0a20 2020 2020 2020 2061 7272 6179  e(.        array
-00022100: 732c 0a20 2020 2020 2020 2066 5f72 6564  s,.        f_red
-00022110: 7563 653d 6c61 6d62 6461 2078 732c 2061  uce=lambda xs, a
-00022120: 7869 733a 2063 6f6e 6361 7465 6e61 7465  xis: concatenate
-00022130: 280a 2020 2020 2020 2020 2020 2020 6c69  (.            li
-00022140: 7374 2878 7329 2c20 6178 6973 3d61 7869  st(xs), axis=axi
-00022150: 732c 2061 6c6c 6f77 5f75 6e6b 6e6f 776e  s, allow_unknown
-00022160: 5f63 6875 6e6b 7369 7a65 733d 616c 6c6f  _chunksizes=allo
-00022170: 775f 756e 6b6e 6f77 6e5f 6368 756e 6b73  w_unknown_chunks
-00022180: 697a 6573 0a20 2020 2020 2020 2029 2c0a  izes.        ),.
-00022190: 2020 2020 2020 2020 665f 6b77 6172 6773          f_kwargs
-000221a0: 3d6c 616d 6264 6120 6178 6973 3a20 6469  =lambda axis: di
-000221b0: 6374 2861 7869 733d 2861 7869 7320 2b20  ct(axis=(axis + 
-000221c0: 3129 292c 0a20 2020 2020 2020 2061 7869  1)),.        axi
-000221d0: 733d 6669 7273 745f 6178 6973 2c0a 2020  s=first_axis,.  
-000221e0: 2020 290a 0a0a 6465 6620 636f 6e63 6174    )...def concat
-000221f0: 656e 6174 6528 7365 712c 2061 7869 733d  enate(seq, axis=
-00022200: 302c 2061 6c6c 6f77 5f75 6e6b 6e6f 776e  0, allow_unknown
-00022210: 5f63 6875 6e6b 7369 7a65 733d 4661 6c73  _chunksizes=Fals
-00022220: 6529 3a0a 2020 2020 2222 220a 2020 2020  e):.    """.    
-00022230: 436f 6e63 6174 656e 6174 6520 6172 7261  Concatenate arra
-00022240: 7973 2061 6c6f 6e67 2061 6e20 6578 6973  ys along an exis
-00022250: 7469 6e67 2061 7869 730a 0a20 2020 2047  ting axis..    G
-00022260: 6976 656e 2061 2073 6571 7565 6e63 6520  iven a sequence 
-00022270: 6f66 2064 6173 6b20 4172 7261 7973 2066  of dask Arrays f
-00022280: 6f72 6d20 6120 6e65 7720 6461 736b 2041  orm a new dask A
-00022290: 7272 6179 2062 7920 7374 6163 6b69 6e67  rray by stacking
-000222a0: 2074 6865 6d0a 2020 2020 616c 6f6e 6720   them.    along 
-000222b0: 616e 2065 7869 7374 696e 6720 6469 6d65  an existing dime
-000222c0: 6e73 696f 6e20 2861 7869 733d 3020 6279  nsion (axis=0 by
-000222d0: 2064 6566 6175 6c74 290a 0a20 2020 2050   default)..    P
-000222e0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-000222f0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073 6571  --------.    seq
-00022300: 3a20 6c69 7374 206f 6620 6461 736b 2e61  : list of dask.a
-00022310: 7272 6179 730a 2020 2020 6178 6973 3a20  rrays.    axis: 
-00022320: 696e 740a 2020 2020 2020 2020 4469 6d65  int.        Dime
-00022330: 6e73 696f 6e20 616c 6f6e 6720 7768 6963  nsion along whic
-00022340: 6820 746f 2061 6c69 676e 2061 6c6c 206f  h to align all o
-00022350: 6620 7468 6520 6172 7261 7973 2e20 4966  f the arrays. If
-00022360: 2061 7869 7320 6973 204e 6f6e 652c 0a20   axis is None,. 
-00022370: 2020 2020 2020 2061 7272 6179 7320 6172         arrays ar
-00022380: 6520 666c 6174 7465 6e65 6420 6265 666f  e flattened befo
-00022390: 7265 2075 7365 2e0a 2020 2020 616c 6c6f  re use..    allo
-000223a0: 775f 756e 6b6e 6f77 6e5f 6368 756e 6b73  w_unknown_chunks
-000223b0: 697a 6573 3a20 626f 6f6c 0a20 2020 2020  izes: bool.     
-000223c0: 2020 2041 6c6c 6f77 2075 6e6b 6e6f 776e     Allow unknown
-000223d0: 2063 6875 6e6b 7369 7a65 732c 2073 7563   chunksizes, suc
-000223e0: 6820 6173 2063 6f6d 6520 6672 6f6d 2063  h as come from c
-000223f0: 6f6e 7665 7274 696e 6720 6672 6f6d 2064  onverting from d
-00022400: 6173 6b0a 2020 2020 2020 2020 6461 7461  ask.        data
-00022410: 6672 616d 6573 2e20 2044 6173 6b2e 6172  frames.  Dask.ar
-00022420: 7261 7920 6973 2075 6e61 626c 6520 746f  ray is unable to
-00022430: 2076 6572 6966 7920 7468 6174 2063 6875   verify that chu
-00022440: 6e6b 7320 6c69 6e65 2075 702e 2020 4966  nks line up.  If
-00022450: 0a20 2020 2020 2020 2064 6174 6120 636f  .        data co
-00022460: 6d65 7320 6672 6f6d 2064 6966 6665 7265  mes from differe
-00022470: 6e74 6c79 2061 6c69 676e 6564 2073 6f75  ntly aligned sou
-00022480: 7263 6573 2074 6865 6e20 7468 6973 2063  rces then this c
-00022490: 616e 2063 6175 7365 0a20 2020 2020 2020  an cause.       
-000224a0: 2075 6e65 7870 6563 7465 6420 7265 7375   unexpected resu
-000224b0: 6c74 732e 0a0a 2020 2020 4578 616d 706c  lts...    Exampl
-000224c0: 6573 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a  es.    --------.
-000224d0: 0a20 2020 2043 7265 6174 6520 736c 6963  .    Create slic
-000224e0: 6573 0a0a 2020 2020 3e3e 3e20 696d 706f  es..    >>> impo
-000224f0: 7274 2064 6173 6b2e 6172 7261 7920 6173  rt dask.array as
-00022500: 2064 610a 2020 2020 3e3e 3e20 696d 706f   da.    >>> impo
-00022510: 7274 206e 756d 7079 2061 7320 6e70 0a0a  rt numpy as np..
-00022520: 2020 2020 3e3e 3e20 6461 7461 203d 205b      >>> data = [
-00022530: 6461 2e66 726f 6d5f 6172 7261 7928 6e70  da.from_array(np
-00022540: 2e6f 6e65 7328 2834 2c20 3429 292c 2063  .ones((4, 4)), c
-00022550: 6875 6e6b 733d 2832 2c20 3229 290a 2020  hunks=(2, 2)).  
-00022560: 2020 2e2e 2e20 2020 2020 2020 2020 2066    ...          f
-00022570: 6f72 2069 2069 6e20 7261 6e67 6528 3329  or i in range(3)
-00022580: 5d0a 0a20 2020 203e 3e3e 2078 203d 2064  ]..    >>> x = d
-00022590: 612e 636f 6e63 6174 656e 6174 6528 6461  a.concatenate(da
-000225a0: 7461 2c20 6178 6973 3d30 290a 2020 2020  ta, axis=0).    
-000225b0: 3e3e 3e20 782e 7368 6170 650a 2020 2020  >>> x.shape.    
-000225c0: 2831 322c 2034 290a 0a20 2020 203e 3e3e  (12, 4)..    >>>
-000225d0: 2064 612e 636f 6e63 6174 656e 6174 6528   da.concatenate(
-000225e0: 6461 7461 2c20 6178 6973 3d31 292e 7368  data, axis=1).sh
-000225f0: 6170 650a 2020 2020 2834 2c20 3132 290a  ape.    (4, 12).
-00022600: 0a20 2020 2052 6573 756c 7420 6973 2061  .    Result is a
-00022610: 206e 6577 2064 6173 6b20 4172 7261 790a   new dask Array.
-00022620: 0a20 2020 2053 6565 2041 6c73 6f0a 2020  .    See Also.  
-00022630: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073    --------.    s
-00022640: 7461 636b 0a20 2020 2022 2222 0a20 2020  tack.    """.   
-00022650: 2066 726f 6d20 6461 736b 2e61 7272 6179   from dask.array
-00022660: 2069 6d70 6f72 7420 7772 6170 0a0a 2020   import wrap..  
-00022670: 2020 7365 7120 3d20 5b61 7361 7272 6179    seq = [asarray
-00022680: 2861 2c20 616c 6c6f 775f 756e 6b6e 6f77  (a, allow_unknow
-00022690: 6e5f 6368 756e 6b73 697a 6573 3d61 6c6c  n_chunksizes=all
-000226a0: 6f77 5f75 6e6b 6e6f 776e 5f63 6875 6e6b  ow_unknown_chunk
-000226b0: 7369 7a65 7329 2066 6f72 2061 2069 6e20  sizes) for a in 
-000226c0: 7365 715d 0a0a 2020 2020 6966 206e 6f74  seq]..    if not
-000226d0: 2073 6571 3a0a 2020 2020 2020 2020 7261   seq:.        ra
-000226e0: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
-000226f0: 4e65 6564 2061 7272 6179 2873 2920 746f  Need array(s) to
-00022700: 2063 6f6e 6361 7465 6e61 7465 2229 0a0a   concatenate")..
-00022710: 2020 2020 6966 2061 7869 7320 6973 204e      if axis is N
-00022720: 6f6e 653a 0a20 2020 2020 2020 2073 6571  one:.        seq
-00022730: 203d 205b 612e 666c 6174 7465 6e28 2920   = [a.flatten() 
-00022740: 666f 7220 6120 696e 2073 6571 5d0a 2020  for a in seq].  
-00022750: 2020 2020 2020 6178 6973 203d 2030 0a0a        axis = 0..
-00022760: 2020 2020 7365 715f 6d65 7461 7320 3d20      seq_metas = 
-00022770: 5b6d 6574 615f 6672 6f6d 5f61 7272 6179  [meta_from_array
-00022780: 2873 2920 666f 7220 7320 696e 2073 6571  (s) for s in seq
-00022790: 5d0a 2020 2020 5f63 6f6e 6361 7465 6e61  ].    _concatena
-000227a0: 7465 203d 2063 6f6e 6361 7465 6e61 7465  te = concatenate
-000227b0: 5f6c 6f6f 6b75 702e 6469 7370 6174 6368  _lookup.dispatch
-000227c0: 280a 2020 2020 2020 2020 7479 7065 286d  (.        type(m
-000227d0: 6178 2873 6571 5f6d 6574 6173 2c20 6b65  ax(seq_metas, ke
-000227e0: 793d 6c61 6d62 6461 2078 3a20 6765 7461  y=lambda x: geta
-000227f0: 7474 7228 782c 2022 5f5f 6172 7261 795f  ttr(x, "__array_
-00022800: 7072 696f 7269 7479 5f5f 222c 2030 2929  priority__", 0))
-00022810: 290a 2020 2020 290a 2020 2020 6d65 7461  ).    ).    meta
-00022820: 203d 205f 636f 6e63 6174 656e 6174 6528   = _concatenate(
-00022830: 7365 715f 6d65 7461 732c 2061 7869 733d  seq_metas, axis=
-00022840: 6178 6973 290a 0a20 2020 2023 2050 726f  axis)..    # Pro
-00022850: 6d6f 7465 2074 7970 6573 2074 6f20 6d61  mote types to ma
-00022860: 7463 6820 6d65 7461 0a20 2020 2073 6571  tch meta.    seq
-00022870: 203d 205b 612e 6173 7479 7065 286d 6574   = [a.astype(met
-00022880: 612e 6474 7970 6529 2066 6f72 2061 2069  a.dtype) for a i
-00022890: 6e20 7365 715d 0a0a 2020 2020 2320 4669  n seq]..    # Fi
-000228a0: 6e64 206f 7574 7075 7420 6172 7261 7920  nd output array 
-000228b0: 7368 6170 650a 2020 2020 6e64 696d 203d  shape.    ndim =
-000228c0: 206c 656e 2873 6571 5b30 5d2e 7368 6170   len(seq[0].shap
-000228d0: 6529 0a20 2020 2073 6861 7065 203d 2074  e).    shape = t
-000228e0: 7570 6c65 280a 2020 2020 2020 2020 7375  uple(.        su
-000228f0: 6d28 612e 7368 6170 655b 695d 2066 6f72  m(a.shape[i] for
-00022900: 2061 2069 6e20 7365 7129 2069 6620 6920   a in seq) if i 
-00022910: 3d3d 2061 7869 7320 656c 7365 2073 6571  == axis else seq
-00022920: 5b30 5d2e 7368 6170 655b 695d 0a20 2020  [0].shape[i].   
-00022930: 2020 2020 2066 6f72 2069 2069 6e20 7261       for i in ra
-00022940: 6e67 6528 6e64 696d 290a 2020 2020 290a  nge(ndim).    ).
-00022950: 0a20 2020 2023 2044 726f 7020 656d 7074  .    # Drop empt
-00022960: 7920 6172 7261 7973 0a20 2020 2073 6571  y arrays.    seq
-00022970: 3220 3d20 5b61 2066 6f72 2061 2069 6e20  2 = [a for a in 
-00022980: 7365 7120 6966 2061 2e73 697a 655d 0a20  seq if a.size]. 
-00022990: 2020 2069 6620 6e6f 7420 7365 7132 3a0a     if not seq2:.
-000229a0: 2020 2020 2020 2020 7365 7132 203d 2073          seq2 = s
-000229b0: 6571 0a0a 2020 2020 6966 2061 7869 7320  eq..    if axis 
-000229c0: 3c20 303a 0a20 2020 2020 2020 2061 7869  < 0:.        axi
-000229d0: 7320 3d20 6e64 696d 202b 2061 7869 730a  s = ndim + axis.
-000229e0: 2020 2020 6966 2061 7869 7320 3e3d 206e      if axis >= n
-000229f0: 6469 6d3a 0a20 2020 2020 2020 206d 7367  dim:.        msg
-00022a00: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00022a10: 2022 4178 6973 206d 7573 7420 6265 206c   "Axis must be l
-00022a20: 6573 7320 7468 616e 2074 6861 6e20 6e75  ess than than nu
-00022a30: 6d62 6572 206f 6620 6469 6d65 6e73 696f  mber of dimensio
-00022a40: 6e73 220a 2020 2020 2020 2020 2020 2020  ns".            
-00022a50: 225c 6e44 6174 6120 6861 7320 2564 2064  "\nData has %d d
-00022a60: 696d 656e 7369 6f6e 732c 2062 7574 2067  imensions, but g
-00022a70: 6f74 2061 7869 733d 2564 220a 2020 2020  ot axis=%d".    
-00022a80: 2020 2020 290a 2020 2020 2020 2020 7261      ).        ra
-00022a90: 6973 6520 5661 6c75 6545 7272 6f72 286d  ise ValueError(m
-00022aa0: 7367 2025 2028 6e64 696d 2c20 6178 6973  sg % (ndim, axis
-00022ab0: 2929 0a0a 2020 2020 6e20 3d20 6c65 6e28  ))..    n = len(
-00022ac0: 7365 7132 290a 2020 2020 6966 206e 203d  seq2).    if n =
-00022ad0: 3d20 303a 0a20 2020 2020 2020 2074 7279  = 0:.        try
-00022ae0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00022af0: 7475 726e 2077 7261 702e 656d 7074 795f  turn wrap.empty_
-00022b00: 6c69 6b65 286d 6574 612c 2073 6861 7065  like(meta, shape
-00022b10: 3d73 6861 7065 2c20 6368 756e 6b73 3d73  =shape, chunks=s
-00022b20: 6861 7065 2c20 6474 7970 653d 6d65 7461  hape, dtype=meta
-00022b30: 2e64 7479 7065 290a 2020 2020 2020 2020  .dtype).        
-00022b40: 6578 6365 7074 2054 7970 6545 7272 6f72  except TypeError
-00022b50: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-00022b60: 7475 726e 2077 7261 702e 656d 7074 7928  turn wrap.empty(
-00022b70: 7368 6170 652c 2063 6875 6e6b 733d 7368  shape, chunks=sh
-00022b80: 6170 652c 2064 7479 7065 3d6d 6574 612e  ape, dtype=meta.
-00022b90: 6474 7970 6529 0a20 2020 2065 6c69 6620  dtype).    elif 
-00022ba0: 6e20 3d3d 2031 3a0a 2020 2020 2020 2020  n == 1:.        
-00022bb0: 7265 7475 726e 2073 6571 325b 305d 0a0a  return seq2[0]..
-00022bc0: 2020 2020 6966 206e 6f74 2061 6c6c 6f77      if not allow
-00022bd0: 5f75 6e6b 6e6f 776e 5f63 6875 6e6b 7369  _unknown_chunksi
-00022be0: 7a65 7320 616e 6420 6e6f 7420 616c 6c28  zes and not all(
-00022bf0: 0a20 2020 2020 2020 2069 203d 3d20 6178  .        i == ax
-00022c00: 6973 206f 7220 616c 6c28 782e 7368 6170  is or all(x.shap
-00022c10: 655b 695d 203d 3d20 7365 7132 5b30 5d2e  e[i] == seq2[0].
-00022c20: 7368 6170 655b 695d 2066 6f72 2078 2069  shape[i] for x i
-00022c30: 6e20 7365 7132 290a 2020 2020 2020 2020  n seq2).        
-00022c40: 666f 7220 6920 696e 2072 616e 6765 286e  for i in range(n
-00022c50: 6469 6d29 0a20 2020 2029 3a0a 2020 2020  dim).    ):.    
-00022c60: 2020 2020 6966 2061 6e79 286d 6170 286e      if any(map(n
-00022c70: 702e 6973 6e61 6e2c 2073 6571 325b 305d  p.isnan, seq2[0]
-00022c80: 2e73 6861 7065 2929 3a0a 2020 2020 2020  .shape)):.      
-00022c90: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
-00022ca0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00022cb0: 2020 2020 2020 2020 2254 7269 6564 2074          "Tried t
-00022cc0: 6f20 636f 6e63 6174 656e 6174 6520 6172  o concatenate ar
-00022cd0: 7261 7973 2077 6974 6820 756e 6b6e 6f77  rays with unknow
-00022ce0: 6e22 0a20 2020 2020 2020 2020 2020 2020  n".             
-00022cf0: 2020 2022 2073 6861 7065 2025 732e 5c6e     " shape %s.\n
-00022d00: 5c6e 5477 6f20 736f 6c75 7469 6f6e 733a  \nTwo solutions:
-00022d10: 5c6e 220a 2020 2020 2020 2020 2020 2020  \n".            
-00022d20: 2020 2020 2220 2031 2e20 466f 7263 6520      "  1. Force 
-00022d30: 636f 6e63 6174 656e 6174 696f 6e20 7061  concatenation pa
-00022d40: 7373 220a 2020 2020 2020 2020 2020 2020  ss".            
-00022d50: 2020 2020 2220 616c 6c6f 775f 756e 6b6e      " allow_unkn
-00022d60: 6f77 6e5f 6368 756e 6b73 697a 6573 3d54  own_chunksizes=T
-00022d70: 7275 652e 5c6e 220a 2020 2020 2020 2020  rue.\n".        
-00022d80: 2020 2020 2020 2020 2220 2032 2e20 436f          "  2. Co
-00022d90: 6d70 7574 6520 7368 6170 6573 2077 6974  mpute shapes wit
-00022da0: 6820 220a 2020 2020 2020 2020 2020 2020  h ".            
-00022db0: 2020 2020 225b 782e 636f 6d70 7574 655f      "[x.compute_
-00022dc0: 6368 756e 6b5f 7369 7a65 7328 2920 666f  chunk_sizes() fo
-00022dd0: 7220 7820 696e 2073 6571 5d22 2025 2073  r x in seq]" % s
-00022de0: 7472 2873 6571 325b 305d 2e73 6861 7065  tr(seq2[0].shape
-00022df0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-00022e00: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00022e10: 6c75 6545 7272 6f72 2822 5368 6170 6573  lueError("Shapes
-00022e20: 2064 6f20 6e6f 7420 616c 6967 6e3a 2025   do not align: %
-00022e30: 7322 2c20 5b78 2e73 6861 7065 2066 6f72  s", [x.shape for
-00022e40: 2078 2069 6e20 7365 7132 5d29 0a0a 2020   x in seq2])..  
-00022e50: 2020 696e 6473 203d 205b 6c69 7374 2872    inds = [list(r
-00022e60: 616e 6765 286e 6469 6d29 2920 666f 7220  ange(ndim)) for 
-00022e70: 6920 696e 2072 616e 6765 286e 295d 0a20  i in range(n)]. 
-00022e80: 2020 2066 6f72 2069 2c20 696e 6420 696e     for i, ind in
-00022e90: 2065 6e75 6d65 7261 7465 2869 6e64 7329   enumerate(inds)
-00022ea0: 3a0a 2020 2020 2020 2020 696e 645b 6178  :.        ind[ax
-00022eb0: 6973 5d20 3d20 2d28 6920 2b20 3129 0a0a  is] = -(i + 1)..
-00022ec0: 2020 2020 7563 5f61 7267 7320 3d20 6c69      uc_args = li
-00022ed0: 7374 2863 6f6e 6361 7428 7a69 7028 7365  st(concat(zip(se
-00022ee0: 7132 2c20 696e 6473 2929 290a 2020 2020  q2, inds))).    
-00022ef0: 5f2c 2073 6571 3220 3d20 756e 6966 795f  _, seq2 = unify_
-00022f00: 6368 756e 6b73 282a 7563 5f61 7267 732c  chunks(*uc_args,
-00022f10: 2077 6172 6e3d 4661 6c73 6529 0a0a 2020   warn=False)..  
-00022f20: 2020 6264 7320 3d20 5b61 2e63 6875 6e6b    bds = [a.chunk
-00022f30: 7320 666f 7220 6120 696e 2073 6571 325d  s for a in seq2]
-00022f40: 0a0a 2020 2020 6368 756e 6b73 203d 2028  ..    chunks = (
-00022f50: 0a20 2020 2020 2020 2073 6571 325b 305d  .        seq2[0]
-00022f60: 2e63 6875 6e6b 735b 3a61 7869 735d 0a20  .chunks[:axis]. 
-00022f70: 2020 2020 2020 202b 2028 7375 6d28 2862         + (sum((b
-00022f80: 645b 6178 6973 5d20 666f 7220 6264 2069  d[axis] for bd i
-00022f90: 6e20 6264 7329 2c20 2829 292c 290a 2020  n bds), ()),).  
-00022fa0: 2020 2020 2020 2b20 7365 7132 5b30 5d2e        + seq2[0].
-00022fb0: 6368 756e 6b73 5b61 7869 7320 2b20 3120  chunks[axis + 1 
-00022fc0: 3a5d 0a20 2020 2029 0a0a 2020 2020 6375  :].    )..    cu
-00022fd0: 6d5f 6469 6d73 203d 205b 305d 202b 206c  m_dims = [0] + l
-00022fe0: 6973 7428 6163 6375 6d75 6c61 7465 2861  ist(accumulate(a
-00022ff0: 6464 2c20 5b6c 656e 2861 2e63 6875 6e6b  dd, [len(a.chunk
-00023000: 735b 6178 6973 5d29 2066 6f72 2061 2069  s[axis]) for a i
-00023010: 6e20 7365 7132 5d29 290a 0a20 2020 206e  n seq2]))..    n
-00023020: 616d 6573 203d 205b 612e 6e61 6d65 2066  ames = [a.name f
-00023030: 6f72 2061 2069 6e20 7365 7132 5d0a 0a20  or a in seq2].. 
-00023040: 2020 206e 616d 6520 3d20 2263 6f6e 6361     name = "conca
-00023050: 7465 6e61 7465 2d22 202b 2074 6f6b 656e  tenate-" + token
-00023060: 697a 6528 6e61 6d65 732c 2061 7869 7329  ize(names, axis)
-00023070: 0a20 2020 206b 6579 7320 3d20 6c69 7374  .    keys = list
-00023080: 2870 726f 6475 6374 285b 6e61 6d65 5d2c  (product([name],
-00023090: 202a 5b72 616e 6765 286c 656e 2862 6429   *[range(len(bd)
-000230a0: 2920 666f 7220 6264 2069 6e20 6368 756e  ) for bd in chun
-000230b0: 6b73 5d29 290a 0a20 2020 2076 616c 7565  ks]))..    value
-000230c0: 7320 3d20 5b0a 2020 2020 2020 2020 286e  s = [.        (n
-000230d0: 616d 6573 5b62 6973 6563 7428 6375 6d5f  ames[bisect(cum_
-000230e0: 6469 6d73 2c20 6b65 795b 6178 6973 202b  dims, key[axis +
-000230f0: 2031 5d29 202d 2031 5d2c 290a 2020 2020   1]) - 1],).    
-00023100: 2020 2020 2b20 6b65 795b 3120 3a20 6178      + key[1 : ax
-00023110: 6973 202b 2031 5d0a 2020 2020 2020 2020  is + 1].        
-00023120: 2b20 286b 6579 5b61 7869 7320 2b20 315d  + (key[axis + 1]
-00023130: 202d 2063 756d 5f64 696d 735b 6269 7365   - cum_dims[bise
-00023140: 6374 2863 756d 5f64 696d 732c 206b 6579  ct(cum_dims, key
-00023150: 5b61 7869 7320 2b20 315d 2920 2d20 315d  [axis + 1]) - 1]
-00023160: 2c29 0a20 2020 2020 2020 202b 206b 6579  ,).        + key
-00023170: 5b61 7869 7320 2b20 3220 3a5d 0a20 2020  [axis + 2 :].   
-00023180: 2020 2020 2066 6f72 206b 6579 2069 6e20       for key in 
-00023190: 6b65 7973 0a20 2020 205d 0a0a 2020 2020  keys.    ]..    
-000231a0: 6473 6b20 3d20 6469 6374 287a 6970 286b  dsk = dict(zip(k
-000231b0: 6579 732c 2076 616c 7565 7329 290a 2020  eys, values)).  
-000231c0: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
-000231d0: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
-000231e0: 6c6c 6563 7469 6f6e 7328 6e61 6d65 2c20  llections(name, 
-000231f0: 6473 6b2c 2064 6570 656e 6465 6e63 6965  dsk, dependencie
-00023200: 733d 7365 7132 290a 0a20 2020 2072 6574  s=seq2)..    ret
-00023210: 7572 6e20 4172 7261 7928 6772 6170 682c  urn Array(graph,
-00023220: 206e 616d 652c 2063 6875 6e6b 732c 206d   name, chunks, m
-00023230: 6574 613d 6d65 7461 290a 0a0a 6465 6620  eta=meta)...def 
-00023240: 6c6f 6164 5f73 746f 7265 5f63 6875 6e6b  load_store_chunk
-00023250: 280a 2020 2020 783a 2041 6e79 2c0a 2020  (.    x: Any,.  
-00023260: 2020 6f75 743a 2041 6e79 2c0a 2020 2020    out: Any,.    
-00023270: 696e 6465 783a 2073 6c69 6365 2c0a 2020  index: slice,.  
-00023280: 2020 6c6f 636b 3a20 416e 792c 0a20 2020    lock: Any,.   
-00023290: 2072 6574 7572 6e5f 7374 6f72 6564 3a20   return_stored: 
-000232a0: 626f 6f6c 2c0a 2020 2020 6c6f 6164 5f73  bool,.    load_s
-000232b0: 746f 7265 643a 2062 6f6f 6c2c 0a29 3a0a  tored: bool,.):.
-000232c0: 2020 2020 2222 220a 2020 2020 4120 6675      """.    A fu
-000232d0: 6e63 7469 6f6e 2069 6e73 6572 7465 6420  nction inserted 
-000232e0: 696e 2061 2044 6173 6b20 6772 6170 6820  in a Dask graph 
-000232f0: 666f 7220 7374 6f72 696e 6720 6120 6368  for storing a ch
-00023300: 756e 6b2e 0a0a 2020 2020 5061 7261 6d65  unk...    Parame
-00023310: 7465 7273 0a20 2020 202d 2d2d 2d2d 2d2d  ters.    -------
-00023320: 2d2d 2d0a 2020 2020 783a 2061 7272 6179  ---.    x: array
-00023330: 2d6c 696b 650a 2020 2020 2020 2020 416e  -like.        An
-00023340: 2061 7272 6179 2028 706f 7465 6e74 6961   array (potentia
-00023350: 6c6c 7920 6120 4e75 6d50 7920 6f6e 6529  lly a NumPy one)
-00023360: 0a20 2020 206f 7574 3a20 6172 7261 792d  .    out: array-
-00023370: 6c69 6b65 0a20 2020 2020 2020 2057 6865  like.        Whe
-00023380: 7265 2074 6f20 7374 6f72 6520 7265 7375  re to store resu
-00023390: 6c74 732e 0a20 2020 2069 6e64 6578 3a20  lts..    index: 
-000233a0: 736c 6963 652d 6c69 6b65 0a20 2020 2020  slice-like.     
-000233b0: 2020 2057 6865 7265 2074 6f20 7374 6f72     Where to stor
-000233c0: 6520 7265 7375 6c74 2066 726f 6d20 6060  e result from ``
-000233d0: 7860 6020 696e 2060 606f 7574 6060 2e0a  x`` in ``out``..
-000233e0: 2020 2020 6c6f 636b 3a20 4c6f 636b 2d6c      lock: Lock-l
-000233f0: 696b 6520 6f72 2046 616c 7365 0a20 2020  ike or False.   
-00023400: 2020 2020 204c 6f63 6b20 746f 2075 7365       Lock to use
-00023410: 2062 6566 6f72 6520 7772 6974 696e 6720   before writing 
-00023420: 746f 2060 606f 7574 6060 2e0a 2020 2020  to ``out``..    
-00023430: 7265 7475 726e 5f73 746f 7265 643a 2062  return_stored: b
-00023440: 6f6f 6c0a 2020 2020 2020 2020 5768 6574  ool.        Whet
-00023450: 6865 7220 746f 2072 6574 7572 6e20 6060  her to return ``
-00023460: 6f75 7460 602e 0a20 2020 206c 6f61 645f  out``..    load_
-00023470: 7374 6f72 6564 3a20 626f 6f6c 0a20 2020  stored: bool.   
-00023480: 2020 2020 2057 6865 7468 6572 2074 6f20       Whether to 
-00023490: 7265 7475 726e 2074 6865 2061 7272 6179  return the array
-000234a0: 2073 746f 7265 6420 696e 2060 606f 7574   stored in ``out
-000234b0: 6060 2e0a 2020 2020 2020 2020 4967 6e6f  ``..        Igno
-000234c0: 7265 6420 6966 2060 6072 6574 7572 6e5f  red if ``return_
-000234d0: 7374 6f72 6564 6060 2069 7320 6e6f 7420  stored`` is not 
-000234e0: 6060 5472 7565 6060 2e0a 0a20 2020 2052  ``True``...    R
-000234f0: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
-00023500: 2d2d 0a0a 2020 2020 4966 2072 6574 7572  --..    If retur
-00023510: 6e5f 7374 6f72 6564 3d54 7275 6520 616e  n_stored=True an
-00023520: 6420 6c6f 6164 5f73 746f 7265 643d 4661  d load_stored=Fa
-00023530: 6c73 650a 2020 2020 2020 2020 6f75 740a  lse.        out.
-00023540: 2020 2020 4966 2072 6574 7572 6e5f 7374      If return_st
-00023550: 6f72 6564 3d54 7275 6520 616e 6420 6c6f  ored=True and lo
-00023560: 6164 5f73 746f 7265 643d 5472 7565 0a20  ad_stored=True. 
-00023570: 2020 2020 2020 206f 7574 5b69 6e64 6578         out[index
-00023580: 5d0a 2020 2020 4966 2072 6574 7572 6e5f  ].    If return_
-00023590: 7374 6f72 6564 3d46 616c 7365 2061 6e64  stored=False and
-000235a0: 2063 6f6d 7075 7465 3d46 616c 7365 0a20   compute=False. 
-000235b0: 2020 2020 2020 204e 6f6e 650a 0a20 2020         None..   
-000235c0: 2045 7861 6d70 6c65 730a 2020 2020 2d2d   Examples.    --
-000235d0: 2d2d 2d2d 2d2d 0a0a 2020 2020 3e3e 3e20  ------..    >>> 
-000235e0: 6120 3d20 6e70 2e6f 6e65 7328 2835 2c20  a = np.ones((5, 
-000235f0: 3629 290a 2020 2020 3e3e 3e20 6220 3d20  6)).    >>> b = 
-00023600: 6e70 2e65 6d70 7479 2861 2e73 6861 7065  np.empty(a.shape
-00023610: 290a 2020 2020 3e3e 3e20 6c6f 6164 5f73  ).    >>> load_s
-00023620: 746f 7265 5f63 6875 6e6b 2861 2c20 622c  tore_chunk(a, b,
-00023630: 2028 736c 6963 6528 4e6f 6e65 292c 2073   (slice(None), s
-00023640: 6c69 6365 284e 6f6e 6529 292c 2046 616c  lice(None)), Fal
-00023650: 7365 2c20 4661 6c73 652c 2046 616c 7365  se, False, False
-00023660: 290a 2020 2020 2222 220a 2020 2020 6966  ).    """.    if
-00023670: 206c 6f63 6b3a 0a20 2020 2020 2020 206c   lock:.        l
-00023680: 6f63 6b2e 6163 7175 6972 6528 290a 2020  ock.acquire().  
-00023690: 2020 7472 793a 0a20 2020 2020 2020 2069    try:.        i
-000236a0: 6620 7820 6973 206e 6f74 204e 6f6e 6520  f x is not None 
-000236b0: 616e 6420 782e 7369 7a65 2021 3d20 303a  and x.size != 0:
-000236c0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000236d0: 6973 5f61 7272 6179 6c69 6b65 2878 293a  is_arraylike(x):
-000236e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000236f0: 206f 7574 5b69 6e64 6578 5d20 3d20 780a   out[index] = x.
-00023700: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00023710: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00023720: 2020 6f75 745b 696e 6465 785d 203d 206e    out[index] = n
-00023730: 702e 6173 616e 7961 7272 6179 2878 290a  p.asanyarray(x).
-00023740: 0a20 2020 2020 2020 2069 6620 7265 7475  .        if retu
-00023750: 726e 5f73 746f 7265 6420 616e 6420 6c6f  rn_stored and lo
-00023760: 6164 5f73 746f 7265 643a 0a20 2020 2020  ad_stored:.     
-00023770: 2020 2020 2020 2072 6574 7572 6e20 6f75         return ou
-00023780: 745b 696e 6465 785d 0a20 2020 2020 2020  t[index].       
-00023790: 2065 6c69 6620 7265 7475 726e 5f73 746f   elif return_sto
-000237a0: 7265 6420 616e 6420 6e6f 7420 6c6f 6164  red and not load
-000237b0: 5f73 746f 7265 643a 0a20 2020 2020 2020  _stored:.       
-000237c0: 2020 2020 2072 6574 7572 6e20 6f75 740a       return out.
-000237d0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000237e0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000237f0: 204e 6f6e 650a 2020 2020 6669 6e61 6c6c   None.    finall
-00023800: 793a 0a20 2020 2020 2020 2069 6620 6c6f  y:.        if lo
-00023810: 636b 3a0a 2020 2020 2020 2020 2020 2020  ck:.            
-00023820: 6c6f 636b 2e72 656c 6561 7365 2829 0a0a  lock.release()..
-00023830: 0a64 6566 2073 746f 7265 5f63 6875 6e6b  .def store_chunk
-00023840: 280a 2020 2020 783a 2041 7272 6179 4c69  (.    x: ArrayLi
-00023850: 6b65 2c20 6f75 743a 2041 7272 6179 4c69  ke, out: ArrayLi
-00023860: 6b65 2c20 696e 6465 783a 2073 6c69 6365  ke, index: slice
-00023870: 2c20 6c6f 636b 3a20 416e 792c 2072 6574  , lock: Any, ret
-00023880: 7572 6e5f 7374 6f72 6564 3a20 626f 6f6c  urn_stored: bool
-00023890: 0a29 3a0a 2020 2020 7265 7475 726e 206c  .):.    return l
-000238a0: 6f61 645f 7374 6f72 655f 6368 756e 6b28  oad_store_chunk(
-000238b0: 782c 206f 7574 2c20 696e 6465 782c 206c  x, out, index, l
-000238c0: 6f63 6b2c 2072 6574 7572 6e5f 7374 6f72  ock, return_stor
-000238d0: 6564 2c20 4661 6c73 6529 0a0a 0a41 203d  ed, False)...A =
-000238e0: 2054 7970 6556 6172 2822 4122 2c20 626f   TypeVar("A", bo
-000238f0: 756e 643d 4172 7261 794c 696b 6529 0a0a  und=ArrayLike)..
-00023900: 0a64 6566 206c 6f61 645f 6368 756e 6b28  .def load_chunk(
-00023910: 6f75 743a 2041 2c20 696e 6465 783a 2073  out: A, index: s
-00023920: 6c69 6365 2c20 6c6f 636b 3a20 416e 7929  lice, lock: Any)
-00023930: 202d 3e20 413a 0a20 2020 2072 6574 7572   -> A:.    retur
-00023940: 6e20 6c6f 6164 5f73 746f 7265 5f63 6875  n load_store_chu
-00023950: 6e6b 284e 6f6e 652c 206f 7574 2c20 696e  nk(None, out, in
-00023960: 6465 782c 206c 6f63 6b2c 2054 7275 652c  dex, lock, True,
-00023970: 2054 7275 6529 0a0a 0a64 6566 2069 6e73   True)...def ins
-00023980: 6572 745f 746f 5f6f 6f63 280a 2020 2020  ert_to_ooc(.    
-00023990: 6b65 7973 3a20 6c69 7374 2c0a 2020 2020  keys: list,.    
-000239a0: 6368 756e 6b73 3a20 7475 706c 655b 7475  chunks: tuple[tu
-000239b0: 706c 655b 696e 742c 202e 2e2e 5d2c 202e  ple[int, ...], .
-000239c0: 2e2e 5d2c 0a20 2020 206f 7574 3a20 4172  ..],.    out: Ar
-000239d0: 7261 794c 696b 652c 0a20 2020 206e 616d  rayLike,.    nam
-000239e0: 653a 2073 7472 2c0a 2020 2020 2a2c 0a20  e: str,.    *,. 
-000239f0: 2020 206c 6f63 6b3a 204c 6f63 6b20 7c20     lock: Lock | 
-00023a00: 626f 6f6c 203d 2054 7275 652c 0a20 2020  bool = True,.   
-00023a10: 2072 6567 696f 6e3a 2074 7570 6c65 5b73   region: tuple[s
-00023a20: 6c69 6365 2c20 2e2e 2e5d 207c 2073 6c69  lice, ...] | sli
-00023a30: 6365 207c 204e 6f6e 6520 3d20 4e6f 6e65  ce | None = None
-00023a40: 2c0a 2020 2020 7265 7475 726e 5f73 746f  ,.    return_sto
-00023a50: 7265 643a 2062 6f6f 6c20 3d20 4661 6c73  red: bool = Fals
-00023a60: 652c 0a20 2020 206c 6f61 645f 7374 6f72  e,.    load_stor
-00023a70: 6564 3a20 626f 6f6c 203d 2046 616c 7365  ed: bool = False
-00023a80: 2c0a 2920 2d3e 2064 6963 743a 0a20 2020  ,.) -> dict:.   
-00023a90: 2022 2222 0a20 2020 2043 7265 6174 6573   """.    Creates
-00023aa0: 2061 2044 6173 6b20 6772 6170 6820 666f   a Dask graph fo
-00023ab0: 7220 7374 6f72 696e 6720 6368 756e 6b73  r storing chunks
-00023ac0: 2066 726f 6d20 6060 6172 7260 6020 696e   from ``arr`` in
-00023ad0: 2060 606f 7574 6060 2e0a 0a20 2020 2050   ``out``...    P
-00023ae0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
-00023af0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 206b 6579  --------.    key
-00023b00: 733a 206c 6973 740a 2020 2020 2020 2020  s: list.        
-00023b10: 4461 736b 206b 6579 7320 6f66 2074 6865  Dask keys of the
-00023b20: 2069 6e70 7574 2061 7272 6179 0a20 2020   input array.   
-00023b30: 2063 6875 6e6b 733a 2074 7570 6c65 0a20   chunks: tuple. 
-00023b40: 2020 2020 2020 2044 6173 6b20 6368 756e         Dask chun
-00023b50: 6b73 206f 6620 7468 6520 696e 7075 7420  ks of the input 
-00023b60: 6172 7261 790a 2020 2020 6f75 743a 2061  array.    out: a
-00023b70: 7272 6179 2d6c 696b 650a 2020 2020 2020  rray-like.      
-00023b80: 2020 5768 6572 6520 746f 2073 746f 7265    Where to store
-00023b90: 2072 6573 756c 7473 2074 6f0a 2020 2020   results to.    
-00023ba0: 6e61 6d65 3a20 7374 720a 2020 2020 2020  name: str.      
-00023bb0: 2020 4669 7273 7420 656c 656d 656e 7420    First element 
-00023bc0: 6f66 2064 6173 6b20 6b65 7973 0a20 2020  of dask keys.   
-00023bd0: 206c 6f63 6b3a 204c 6f63 6b2d 6c69 6b65   lock: Lock-like
-00023be0: 206f 7220 626f 6f6c 2c20 6f70 7469 6f6e   or bool, option
-00023bf0: 616c 0a20 2020 2020 2020 2057 6865 7468  al.        Wheth
-00023c00: 6572 2074 6f20 6c6f 636b 206f 7220 7769  er to lock or wi
-00023c10: 7468 2077 6861 7420 2864 6566 6175 6c74  th what (default
-00023c20: 2069 7320 6060 5472 7565 6060 2c0a 2020   is ``True``,.  
-00023c30: 2020 2020 2020 7768 6963 6820 6d65 616e        which mean
-00023c40: 7320 6120 3a63 6c61 7373 3a60 7468 7265  s a :class:`thre
-00023c50: 6164 696e 672e 4c6f 636b 6020 696e 7374  ading.Lock` inst
-00023c60: 616e 6365 292e 0a20 2020 2072 6567 696f  ance)..    regio
-00023c70: 6e3a 2073 6c69 6365 2d6c 696b 652c 206f  n: slice-like, o
-00023c80: 7074 696f 6e61 6c0a 2020 2020 2020 2020  ptional.        
-00023c90: 5768 6572 6520 696e 2060 606f 7574 6060  Where in ``out``
-00023ca0: 2074 6f20 7374 6f72 6520 6060 6172 7260   to store ``arr`
-00023cb0: 6027 7320 7265 7375 6c74 730a 2020 2020  `'s results.    
-00023cc0: 2020 2020 2864 6566 6175 6c74 2069 7320      (default is 
-00023cd0: 6060 4e6f 6e65 6060 2c20 6d65 616e 696e  ``None``, meanin
-00023ce0: 6720 616c 6c20 6f66 2060 606f 7574 6060  g all of ``out``
-00023cf0: 292e 0a20 2020 2072 6574 7572 6e5f 7374  )..    return_st
-00023d00: 6f72 6564 3a20 626f 6f6c 2c20 6f70 7469  ored: bool, opti
-00023d10: 6f6e 616c 0a20 2020 2020 2020 2057 6865  onal.        Whe
-00023d20: 7468 6572 2074 6f20 7265 7475 726e 2060  ther to return `
-00023d30: 606f 7574 6060 0a20 2020 2020 2020 2028  `out``.        (
-00023d40: 6465 6661 756c 7420 6973 2060 6046 616c  default is ``Fal
-00023d50: 7365 6060 2c20 6d65 616e 696e 6720 6060  se``, meaning ``
-00023d60: 4e6f 6e65 6060 2069 7320 7265 7475 726e  None`` is return
-00023d70: 6564 292e 0a20 2020 206c 6f61 645f 7374  ed)..    load_st
-00023d80: 6f72 6564 3a20 626f 6f6c 2c20 6f70 7469  ored: bool, opti
-00023d90: 6f6e 616c 0a20 2020 2020 2020 2057 6865  onal.        Whe
-00023da0: 7468 6572 2074 6f20 6861 6e64 6c69 6e67  ther to handling
-00023db0: 206c 6f61 6469 6e67 2066 726f 6d20 6060   loading from ``
-00023dc0: 6f75 7460 6020 6174 2074 6865 2073 616d  out`` at the sam
-00023dd0: 6520 7469 6d65 2e0a 2020 2020 2020 2020  e time..        
-00023de0: 4967 6e6f 7265 6420 6966 2060 6072 6574  Ignored if ``ret
-00023df0: 7572 6e5f 7374 6f72 6564 6060 2069 7320  urn_stored`` is 
-00023e00: 6e6f 7420 6060 5472 7565 6060 2e0a 2020  not ``True``..  
-00023e10: 2020 2020 2020 2864 6566 6175 6c74 2069        (default i
-00023e20: 7320 6060 4661 6c73 6560 602c 206d 6561  s ``False``, mea
-00023e30: 6e69 6e67 2064 6566 6572 2074 6f20 6060  ning defer to ``
-00023e40: 7265 7475 726e 5f73 746f 7265 6460 6029  return_stored``)
-00023e50: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
-00023e60: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 2064     -------.    d
-00023e70: 6173 6b20 6772 6170 6820 6f66 2073 746f  ask graph of sto
-00023e80: 7265 206f 7065 7261 7469 6f6e 0a0a 2020  re operation..  
-00023e90: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
-00023ea0: 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20  -------.    >>> 
-00023eb0: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
-00023ec0: 7920 6173 2064 610a 2020 2020 3e3e 3e20  y as da.    >>> 
-00023ed0: 6420 3d20 6461 2e6f 6e65 7328 2835 2c20  d = da.ones((5, 
-00023ee0: 3629 2c20 6368 756e 6b73 3d28 322c 2033  6), chunks=(2, 3
-00023ef0: 2929 0a20 2020 203e 3e3e 2061 203d 206e  )).    >>> a = n
-00023f00: 702e 656d 7074 7928 642e 7368 6170 6529  p.empty(d.shape)
-00023f10: 0a20 2020 203e 3e3e 2069 6e73 6572 745f  .    >>> insert_
-00023f20: 746f 5f6f 6f63 2864 2e5f 5f64 6173 6b5f  to_ooc(d.__dask_
-00023f30: 6b65 7973 5f5f 2829 2c20 642e 6368 756e  keys__(), d.chun
-00023f40: 6b73 2c20 612c 2022 7374 6f72 652d 3132  ks, a, "store-12
-00023f50: 3322 2920 2023 2064 6f63 7465 7374 3a20  3")  # doctest: 
-00023f60: 2b53 4b49 500a 2020 2020 2222 220a 0a20  +SKIP.    """.. 
-00023f70: 2020 2069 6620 6c6f 636b 2069 7320 5472     if lock is Tr
-00023f80: 7565 3a0a 2020 2020 2020 2020 6c6f 636b  ue:.        lock
-00023f90: 203d 204c 6f63 6b28 290a 0a20 2020 2073   = Lock()..    s
-00023fa0: 6c69 6365 7320 3d20 736c 6963 6573 5f66  lices = slices_f
-00023fb0: 726f 6d5f 6368 756e 6b73 2863 6875 6e6b  rom_chunks(chunk
-00023fc0: 7329 0a20 2020 2069 6620 7265 6769 6f6e  s).    if region
-00023fd0: 3a0a 2020 2020 2020 2020 736c 6963 6573  :.        slices
-00023fe0: 203d 205b 6675 7365 5f73 6c69 6365 2872   = [fuse_slice(r
-00023ff0: 6567 696f 6e2c 2073 6c63 2920 666f 7220  egion, slc) for 
-00024000: 736c 6320 696e 2073 6c69 6365 735d 0a0a  slc in slices]..
-00024010: 2020 2020 6966 2072 6574 7572 6e5f 7374      if return_st
-00024020: 6f72 6564 2061 6e64 206c 6f61 645f 7374  ored and load_st
-00024030: 6f72 6564 3a0a 2020 2020 2020 2020 6675  ored:.        fu
-00024040: 6e63 203d 206c 6f61 645f 7374 6f72 655f  nc = load_store_
-00024050: 6368 756e 6b0a 2020 2020 2020 2020 6172  chunk.        ar
-00024060: 6773 203d 2028 6c6f 6164 5f73 746f 7265  gs = (load_store
-00024070: 642c 290a 2020 2020 656c 7365 3a0a 2020  d,).    else:.  
-00024080: 2020 2020 2020 6675 6e63 203d 2073 746f        func = sto
-00024090: 7265 5f63 6875 6e6b 2020 2320 7479 7065  re_chunk  # type
-000240a0: 3a20 6967 6e6f 7265 0a20 2020 2020 2020  : ignore.       
-000240b0: 2061 7267 7320 3d20 2829 2020 2320 7479   args = ()  # ty
-000240c0: 7065 3a20 6967 6e6f 7265 0a0a 2020 2020  pe: ignore..    
-000240d0: 6473 6b20 3d20 7b0a 2020 2020 2020 2020  dsk = {.        
-000240e0: 286e 616d 652c 2920 2b20 745b 313a 5d3a  (name,) + t[1:]:
-000240f0: 2028 6675 6e63 2c20 742c 206f 7574 2c20   (func, t, out, 
-00024100: 736c 632c 206c 6f63 6b2c 2072 6574 7572  slc, lock, retur
-00024110: 6e5f 7374 6f72 6564 2920 2b20 6172 6773  n_stored) + args
-00024120: 0a20 2020 2020 2020 2066 6f72 2074 2c20  .        for t, 
-00024130: 736c 6320 696e 207a 6970 2863 6f72 652e  slc in zip(core.
-00024140: 666c 6174 7465 6e28 6b65 7973 292c 2073  flatten(keys), s
-00024150: 6c69 6365 7329 0a20 2020 207d 0a20 2020  lices).    }.   
-00024160: 2072 6574 7572 6e20 6473 6b0a 0a0a 6465   return dsk...de
-00024170: 6620 7265 7472 6965 7665 5f66 726f 6d5f  f retrieve_from_
-00024180: 6f6f 6328 0a20 2020 206b 6579 733a 2043  ooc(.    keys: C
-00024190: 6f6c 6c65 6374 696f 6e5b 4b65 795d 2c20  ollection[Key], 
-000241a0: 6473 6b5f 7072 653a 2047 7261 7068 2c20  dsk_pre: Graph, 
-000241b0: 6473 6b5f 706f 7374 3a20 4772 6170 680a  dsk_post: Graph.
-000241c0: 2920 2d3e 2064 6963 745b 7475 706c 652c  ) -> dict[tuple,
-000241d0: 2041 6e79 5d3a 0a20 2020 2022 2222 0a20   Any]:.    """. 
-000241e0: 2020 2043 7265 6174 6573 2061 2044 6173     Creates a Das
-000241f0: 6b20 6772 6170 6820 666f 7220 6c6f 6164  k graph for load
-00024200: 696e 6720 7374 6f72 6564 2060 606b 6579  ing stored ``key
-00024210: 7360 6020 6672 6f6d 2060 6064 736b 6060  s`` from ``dsk``
-00024220: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-00024230: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-00024240: 0a20 2020 206b 6579 733a 2043 6f6c 6c65  .    keys: Colle
-00024250: 6374 696f 6e0a 2020 2020 2020 2020 4120  ction.        A 
-00024260: 7365 7175 656e 6365 2063 6f6e 7461 696e  sequence contain
-00024270: 696e 6720 4461 736b 2067 7261 7068 206b  ing Dask graph k
-00024280: 6579 7320 746f 206c 6f61 640a 2020 2020  eys to load.    
-00024290: 6473 6b5f 7072 653a 204d 6170 7069 6e67  dsk_pre: Mapping
-000242a0: 0a20 2020 2020 2020 2041 2044 6173 6b20  .        A Dask 
-000242b0: 6772 6170 6820 636f 7272 6573 706f 6e64  graph correspond
-000242c0: 696e 6720 746f 2061 2044 6173 6b20 4172  ing to a Dask Ar
-000242d0: 7261 7920 6265 666f 7265 2063 6f6d 7075  ray before compu
-000242e0: 7461 7469 6f6e 0a20 2020 2064 736b 5f70  tation.    dsk_p
-000242f0: 6f73 743a 204d 6170 7069 6e67 0a20 2020  ost: Mapping.   
-00024300: 2020 2020 2041 2044 6173 6b20 6772 6170       A Dask grap
-00024310: 6820 636f 7272 6573 706f 6e64 696e 6720  h corresponding 
-00024320: 746f 2061 2044 6173 6b20 4172 7261 7920  to a Dask Array 
-00024330: 6166 7465 7220 636f 6d70 7574 6174 696f  after computatio
-00024340: 6e0a 0a20 2020 2045 7861 6d70 6c65 730a  n..    Examples.
-00024350: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
-00024360: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
-00024370: 2e61 7272 6179 2061 7320 6461 0a20 2020  .array as da.   
-00024380: 203e 3e3e 2064 203d 2064 612e 6f6e 6573   >>> d = da.ones
-00024390: 2828 352c 2036 292c 2063 6875 6e6b 733d  ((5, 6), chunks=
-000243a0: 2832 2c20 3329 290a 2020 2020 3e3e 3e20  (2, 3)).    >>> 
-000243b0: 6120 3d20 6e70 2e65 6d70 7479 2864 2e73  a = np.empty(d.s
-000243c0: 6861 7065 290a 2020 2020 3e3e 3e20 6720  hape).    >>> g 
-000243d0: 3d20 696e 7365 7274 5f74 6f5f 6f6f 6328  = insert_to_ooc(
-000243e0: 642e 5f5f 6461 736b 5f6b 6579 735f 5f28  d.__dask_keys__(
-000243f0: 292c 2064 2e63 6875 6e6b 732c 2061 2c20  ), d.chunks, a, 
-00024400: 2273 746f 7265 2d31 3233 2229 0a20 2020  "store-123").   
-00024410: 203e 3e3e 2072 6574 7269 6576 655f 6672   >>> retrieve_fr
-00024420: 6f6d 5f6f 6f63 2867 2e6b 6579 7328 292c  om_ooc(g.keys(),
-00024430: 2067 2c20 7b6b 3a20 6b20 666f 7220 6b20   g, {k: k for k 
-00024440: 696e 2067 2e6b 6579 7328 297d 2920 2023  in g.keys()})  #
-00024450: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
-00024460: 2020 2020 2222 220a 2020 2020 6c6f 6164      """.    load
-00024470: 5f64 736b 203d 207b 0a20 2020 2020 2020  _dsk = {.       
-00024480: 2028 226c 6f61 642d 2220 2b20 6b5b 305d   ("load-" + k[0]
-00024490: 2c29 202b 206b 5b31 3a5d 3a20 286c 6f61  ,) + k[1:]: (loa
-000244a0: 645f 6368 756e 6b2c 2064 736b 5f70 6f73  d_chunk, dsk_pos
-000244b0: 745b 6b5d 2920 2b20 6473 6b5f 7072 655b  t[k]) + dsk_pre[
-000244c0: 6b5d 5b33 3a2d 315d 2020 2320 7479 7065  k][3:-1]  # type
-000244d0: 3a20 6967 6e6f 7265 0a20 2020 2020 2020  : ignore.       
-000244e0: 2066 6f72 206b 2069 6e20 6b65 7973 0a20   for k in keys. 
-000244f0: 2020 207d 0a0a 2020 2020 7265 7475 726e     }..    return
-00024500: 206c 6f61 645f 6473 6b0a 0a0a 6465 6620   load_dsk...def 
-00024510: 6173 6172 7261 7928 0a20 2020 2061 2c20  asarray(.    a, 
-00024520: 616c 6c6f 775f 756e 6b6e 6f77 6e5f 6368  allow_unknown_ch
-00024530: 756e 6b73 697a 6573 3d46 616c 7365 2c20  unksizes=False, 
-00024540: 6474 7970 653d 4e6f 6e65 2c20 6f72 6465  dtype=None, orde
-00024550: 723d 4e6f 6e65 2c20 2a2c 206c 696b 653d  r=None, *, like=
-00024560: 4e6f 6e65 2c20 2a2a 6b77 6172 6773 0a29  None, **kwargs.)
-00024570: 3a0a 2020 2020 2222 2243 6f6e 7665 7274  :.    """Convert
-00024580: 2074 6865 2069 6e70 7574 2074 6f20 6120   the input to a 
-00024590: 6461 736b 2061 7272 6179 2e0a 0a20 2020  dask array...   
-000245a0: 2050 6172 616d 6574 6572 730a 2020 2020   Parameters.    
-000245b0: 2d2d 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061  ----------.    a
-000245c0: 203a 2061 7272 6179 2d6c 696b 650a 2020   : array-like.  
-000245d0: 2020 2020 2020 496e 7075 7420 6461 7461        Input data
-000245e0: 2c20 696e 2061 6e79 2066 6f72 6d20 7468  , in any form th
-000245f0: 6174 2063 616e 2062 6520 636f 6e76 6572  at can be conver
-00024600: 7465 6420 746f 2061 2064 6173 6b20 6172  ted to a dask ar
-00024610: 7261 792e 2054 6869 730a 2020 2020 2020  ray. This.      
-00024620: 2020 696e 636c 7564 6573 206c 6973 7473    includes lists
-00024630: 2c20 6c69 7374 7320 6f66 2074 7570 6c65  , lists of tuple
-00024640: 732c 2074 7570 6c65 732c 2074 7570 6c65  s, tuples, tuple
-00024650: 7320 6f66 2074 7570 6c65 732c 2074 7570  s of tuples, tup
-00024660: 6c65 7320 6f66 0a20 2020 2020 2020 206c  les of.        l
-00024670: 6973 7473 2061 6e64 206e 6461 7272 6179  ists and ndarray
-00024680: 732e 0a20 2020 2061 6c6c 6f77 5f75 6e6b  s..    allow_unk
-00024690: 6e6f 776e 5f63 6875 6e6b 7369 7a65 733a  nown_chunksizes:
-000246a0: 2062 6f6f 6c0a 2020 2020 2020 2020 416c   bool.        Al
-000246b0: 6c6f 7720 756e 6b6e 6f77 6e20 6368 756e  low unknown chun
-000246c0: 6b73 697a 6573 2c20 7375 6368 2061 7320  ksizes, such as 
-000246d0: 636f 6d65 2066 726f 6d20 636f 6e76 6572  come from conver
-000246e0: 7469 6e67 2066 726f 6d20 6461 736b 0a20  ting from dask. 
-000246f0: 2020 2020 2020 2064 6174 6166 7261 6d65         dataframe
-00024700: 732e 2020 4461 736b 2e61 7272 6179 2069  s.  Dask.array i
-00024710: 7320 756e 6162 6c65 2074 6f20 7665 7269  s unable to veri
-00024720: 6679 2074 6861 7420 6368 756e 6b73 206c  fy that chunks l
-00024730: 696e 6520 7570 2e20 2049 660a 2020 2020  ine up.  If.    
-00024740: 2020 2020 6461 7461 2063 6f6d 6573 2066      data comes f
-00024750: 726f 6d20 6469 6666 6572 656e 746c 7920  rom differently 
-00024760: 616c 6967 6e65 6420 736f 7572 6365 7320  aligned sources 
-00024770: 7468 656e 2074 6869 7320 6361 6e20 6361  then this can ca
-00024780: 7573 650a 2020 2020 2020 2020 756e 6578  use.        unex
-00024790: 7065 6374 6564 2072 6573 756c 7473 2e0a  pected results..
-000247a0: 2020 2020 6474 7970 6520 3a20 6461 7461      dtype : data
-000247b0: 2d74 7970 652c 206f 7074 696f 6e61 6c0a  -type, optional.
-000247c0: 2020 2020 2020 2020 4279 2064 6566 6175          By defau
-000247d0: 6c74 2c20 7468 6520 6461 7461 2d74 7970  lt, the data-typ
-000247e0: 6520 6973 2069 6e66 6572 7265 6420 6672  e is inferred fr
-000247f0: 6f6d 2074 6865 2069 6e70 7574 2064 6174  om the input dat
-00024800: 612e 0a20 2020 206f 7264 6572 203a 207b  a..    order : {
-00024810: e280 9843 e280 992c 20e2 8098 46e2 8099  ...C..., ...F...
-00024820: 2c20 e280 9841 e280 992c 20e2 8098 4be2  , ...A..., ...K.
-00024830: 8099 7d2c 206f 7074 696f 6e61 6c0a 2020  ..}, optional.  
-00024840: 2020 2020 2020 4d65 6d6f 7279 206c 6179        Memory lay
-00024850: 6f75 742e 20e2 8098 41e2 8099 2061 6e64  out. ...A... and
-00024860: 20e2 8098 4be2 8099 2064 6570 656e 6420   ...K... depend 
-00024870: 6f6e 2074 6865 206f 7264 6572 206f 6620  on the order of 
-00024880: 696e 7075 7420 6172 7261 7920 612e 0a20  input array a.. 
-00024890: 2020 2020 2020 20e2 8098 43e2 8099 2072         ...C... r
-000248a0: 6f77 2d6d 616a 6f72 2028 432d 7374 796c  ow-major (C-styl
-000248b0: 6529 2c20 e280 9846 e280 9920 636f 6c75  e), ...F... colu
-000248c0: 6d6e 2d6d 616a 6f72 2028 466f 7274 7261  mn-major (Fortra
-000248d0: 6e2d 7374 796c 6529 206d 656d 6f72 790a  n-style) memory.
-000248e0: 2020 2020 2020 2020 7265 7072 6573 656e          represen
-000248f0: 7461 7469 6f6e 2e20 e280 9841 e280 9920  tation. ...A... 
-00024900: 2861 6e79 2920 6d65 616e 7320 e280 9846  (any) means ...F
-00024910: e280 9920 6966 2061 2069 7320 466f 7274  ... if a is Fort
-00024920: 7261 6e20 636f 6e74 6967 756f 7573 2c20  ran contiguous, 
-00024930: e280 9843 e280 990a 2020 2020 2020 2020  ...C....        
-00024940: 6f74 6865 7277 6973 6520 e280 984b e280  otherwise ...K..
-00024950: 9920 286b 6565 7029 2070 7265 7365 7276  . (keep) preserv
-00024960: 6520 696e 7075 7420 6f72 6465 722e 2044  e input order. D
-00024970: 6566 6175 6c74 7320 746f 20e2 8098 43e2  efaults to ...C.
-00024980: 8099 2e0a 2020 2020 6c69 6b65 3a20 6172  ....    like: ar
-00024990: 7261 792d 6c69 6b65 0a20 2020 2020 2020  ray-like.       
-000249a0: 2052 6566 6572 656e 6365 206f 626a 6563   Reference objec
-000249b0: 7420 746f 2061 6c6c 6f77 2074 6865 2063  t to allow the c
-000249c0: 7265 6174 696f 6e20 6f66 2044 6173 6b20  reation of Dask 
-000249d0: 6172 7261 7973 2077 6974 6820 6368 756e  arrays with chun
-000249e0: 6b73 0a20 2020 2020 2020 2074 6861 7420  ks.        that 
-000249f0: 6172 6520 6e6f 7420 4e75 6d50 7920 6172  are not NumPy ar
-00024a00: 7261 7973 2e20 4966 2061 6e20 6172 7261  rays. If an arra
-00024a10: 792d 6c69 6b65 2070 6173 7365 6420 696e  y-like passed in
-00024a20: 2061 7320 6060 6c69 6b65 6060 0a20 2020   as ``like``.   
-00024a30: 2020 2020 2073 7570 706f 7274 7320 7468       supports th
-00024a40: 6520 6060 5f5f 6172 7261 795f 6675 6e63  e ``__array_func
-00024a50: 7469 6f6e 5f5f 6060 2070 726f 746f 636f  tion__`` protoco
-00024a60: 6c2c 2074 6865 2063 6875 6e6b 2074 7970  l, the chunk typ
-00024a70: 6520 6f66 2074 6865 0a20 2020 2020 2020  e of the.       
-00024a80: 2072 6573 756c 7469 6e67 2061 7272 6179   resulting array
-00024a90: 2077 696c 6c20 6265 2064 6566 696e 6564   will be defined
-00024aa0: 2062 7920 6974 2e20 496e 2074 6869 7320   by it. In this 
-00024ab0: 6361 7365 2c20 6974 2065 6e73 7572 6573  case, it ensures
-00024ac0: 2074 6865 0a20 2020 2020 2020 2063 7265   the.        cre
-00024ad0: 6174 696f 6e20 6f66 2061 2044 6173 6b20  ation of a Dask 
-00024ae0: 6172 7261 7920 636f 6d70 6174 6962 6c65  array compatible
-00024af0: 2077 6974 6820 7468 6174 2070 6173 7365   with that passe
-00024b00: 6420 696e 2076 6961 2074 6869 730a 2020  d in via this.  
-00024b10: 2020 2020 2020 6172 6775 6d65 6e74 2e20        argument. 
-00024b20: 4966 2060 606c 696b 6560 6020 6973 2061  If ``like`` is a
-00024b30: 2044 6173 6b20 6172 7261 792c 2074 6865   Dask array, the
-00024b40: 2063 6875 6e6b 2074 7970 6520 6f66 2074   chunk type of t
-00024b50: 6865 0a20 2020 2020 2020 2072 6573 756c  he.        resul
-00024b60: 7469 6e67 2061 7272 6179 2077 696c 6c20  ting array will 
-00024b70: 6265 2064 6566 696e 6564 2062 7920 7468  be defined by th
-00024b80: 6520 6368 756e 6b20 7479 7065 206f 6620  e chunk type of 
-00024b90: 6060 6c69 6b65 6060 2e0a 2020 2020 2020  ``like``..      
-00024ba0: 2020 5265 7175 6972 6573 204e 756d 5079    Requires NumPy
-00024bb0: 2031 2e32 302e 3020 6f72 2068 6967 6865   1.20.0 or highe
-00024bc0: 722e 0a0a 2020 2020 5265 7475 726e 730a  r...    Returns.
-00024bd0: 2020 2020 2d2d 2d2d 2d2d 2d0a 2020 2020      -------.    
-00024be0: 6f75 7420 3a20 6461 736b 2061 7272 6179  out : dask array
-00024bf0: 0a20 2020 2020 2020 2044 6173 6b20 6172  .        Dask ar
-00024c00: 7261 7920 696e 7465 7270 7265 7461 7469  ray interpretati
-00024c10: 6f6e 206f 6620 612e 0a0a 2020 2020 4578  on of a...    Ex
-00024c20: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
-00024c30: 2d2d 2d0a 2020 2020 3e3e 3e20 696d 706f  ---.    >>> impo
-00024c40: 7274 2064 6173 6b2e 6172 7261 7920 6173  rt dask.array as
-00024c50: 2064 610a 2020 2020 3e3e 3e20 696d 706f   da.    >>> impo
-00024c60: 7274 206e 756d 7079 2061 7320 6e70 0a20  rt numpy as np. 
-00024c70: 2020 203e 3e3e 2078 203d 206e 702e 6172     >>> x = np.ar
-00024c80: 616e 6765 2833 290a 2020 2020 3e3e 3e20  ange(3).    >>> 
-00024c90: 6461 2e61 7361 7272 6179 2878 290a 2020  da.asarray(x).  
-00024ca0: 2020 6461 736b 2e61 7272 6179 3c61 7272    dask.array<arr
-00024cb0: 6179 2c20 7368 6170 653d 2833 2c29 2c20  ay, shape=(3,), 
-00024cc0: 6474 7970 653d 696e 7436 342c 2063 6875  dtype=int64, chu
-00024cd0: 6e6b 7369 7a65 3d28 332c 292c 2063 6875  nksize=(3,), chu
-00024ce0: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
-00024cf0: 7272 6179 3e0a 0a20 2020 203e 3e3e 2079  rray>..    >>> y
-00024d00: 203d 205b 5b31 2c20 322c 2033 5d2c 205b   = [[1, 2, 3], [
-00024d10: 342c 2035 2c20 365d 5d0a 2020 2020 3e3e  4, 5, 6]].    >>
-00024d20: 3e20 6461 2e61 7361 7272 6179 2879 290a  > da.asarray(y).
-00024d30: 2020 2020 6461 736b 2e61 7272 6179 3c61      dask.array<a
-00024d40: 7272 6179 2c20 7368 6170 653d 2832 2c20  rray, shape=(2, 
-00024d50: 3329 2c20 6474 7970 653d 696e 7436 342c  3), dtype=int64,
-00024d60: 2063 6875 6e6b 7369 7a65 3d28 322c 2033   chunksize=(2, 3
-00024d70: 292c 2063 6875 6e6b 7479 7065 3d6e 756d  ), chunktype=num
-00024d80: 7079 2e6e 6461 7272 6179 3e0a 2020 2020  py.ndarray>.    
-00024d90: 2222 220a 2020 2020 6966 206c 696b 6520  """.    if like 
-00024da0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
-00024db0: 2069 6620 6973 696e 7374 616e 6365 2861   if isinstance(a
-00024dc0: 2c20 4172 7261 7929 3a0a 2020 2020 2020  , Array):.      
-00024dd0: 2020 2020 2020 7265 7475 726e 2061 0a20        return a. 
-00024de0: 2020 2020 2020 2065 6c69 6620 6861 7361         elif hasa
-00024df0: 7474 7228 612c 2022 746f 5f64 6173 6b5f  ttr(a, "to_dask_
-00024e00: 6172 7261 7922 293a 0a20 2020 2020 2020  array"):.       
-00024e10: 2020 2020 2072 6574 7572 6e20 612e 746f       return a.to
-00024e20: 5f64 6173 6b5f 6172 7261 7928 290a 2020  _dask_array().  
-00024e30: 2020 2020 2020 656c 6966 2074 7970 6528        elif type(
-00024e40: 6129 2e5f 5f6d 6f64 756c 655f 5f2e 7370  a).__module__.sp
-00024e50: 6c69 7428 222e 2229 5b30 5d20 3d3d 2022  lit(".")[0] == "
-00024e60: 7861 7272 6179 2220 616e 6420 6861 7361  xarray" and hasa
-00024e70: 7474 7228 612c 2022 6461 7461 2229 3a0a  ttr(a, "data"):.
-00024e80: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00024e90: 726e 2061 7361 7272 6179 2861 2e64 6174  rn asarray(a.dat
-00024ea0: 6129 0a20 2020 2020 2020 2065 6c69 6620  a).        elif 
-00024eb0: 6973 696e 7374 616e 6365 2861 2c20 286c  isinstance(a, (l
-00024ec0: 6973 742c 2074 7570 6c65 2929 2061 6e64  ist, tuple)) and
-00024ed0: 2061 6e79 2869 7369 6e73 7461 6e63 6528   any(isinstance(
-00024ee0: 692c 2041 7272 6179 2920 666f 7220 6920  i, Array) for i 
-00024ef0: 696e 2061 293a 0a20 2020 2020 2020 2020  in a):.         
-00024f00: 2020 2072 6574 7572 6e20 7374 6163 6b28     return stack(
-00024f10: 612c 2061 6c6c 6f77 5f75 6e6b 6e6f 776e  a, allow_unknown
-00024f20: 5f63 6875 6e6b 7369 7a65 733d 616c 6c6f  _chunksizes=allo
-00024f30: 775f 756e 6b6e 6f77 6e5f 6368 756e 6b73  w_unknown_chunks
-00024f40: 697a 6573 290a 2020 2020 2020 2020 656c  izes).        el
-00024f50: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00024f60: 6528 6765 7461 7474 7228 612c 2022 7368  e(getattr(a, "sh
-00024f70: 6170 6522 2c20 4e6f 6e65 292c 2049 7465  ape", None), Ite
-00024f80: 7261 626c 6529 3a0a 2020 2020 2020 2020  rable):.        
-00024f90: 2020 2020 6120 3d20 6e70 2e61 7361 7272      a = np.asarr
-00024fa0: 6179 2861 2c20 6474 7970 653d 6474 7970  ay(a, dtype=dtyp
-00024fb0: 652c 206f 7264 6572 3d6f 7264 6572 290a  e, order=order).
-00024fc0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00024fd0: 2020 6c69 6b65 5f6d 6574 6120 3d20 6d65    like_meta = me
-00024fe0: 7461 5f66 726f 6d5f 6172 7261 7928 6c69  ta_from_array(li
-00024ff0: 6b65 290a 2020 2020 2020 2020 6966 2069  ke).        if i
-00025000: 7369 6e73 7461 6e63 6528 612c 2041 7272  sinstance(a, Arr
-00025010: 6179 293a 0a20 2020 2020 2020 2020 2020  ay):.           
-00025020: 2072 6574 7572 6e20 612e 6d61 705f 626c   return a.map_bl
-00025030: 6f63 6b73 286e 702e 6173 6172 7261 792c  ocks(np.asarray,
-00025040: 206c 696b 653d 6c69 6b65 5f6d 6574 612c   like=like_meta,
-00025050: 2064 7479 7065 3d64 7479 7065 2c20 6f72   dtype=dtype, or
-00025060: 6465 723d 6f72 6465 7229 0a20 2020 2020  der=order).     
-00025070: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00025080: 2020 2020 2061 203d 206e 702e 6173 6172       a = np.asar
-00025090: 7261 7928 612c 206c 696b 653d 6c69 6b65  ray(a, like=like
-000250a0: 5f6d 6574 612c 2064 7479 7065 3d64 7479  _meta, dtype=dty
-000250b0: 7065 2c20 6f72 6465 723d 6f72 6465 7229  pe, order=order)
-000250c0: 0a20 2020 2072 6574 7572 6e20 6672 6f6d  .    return from
-000250d0: 5f61 7272 6179 2861 2c20 6765 7469 7465  _array(a, getite
-000250e0: 6d3d 6765 7474 6572 5f69 6e6c 696e 652c  m=getter_inline,
-000250f0: 202a 2a6b 7761 7267 7329 0a0a 0a64 6566   **kwargs)...def
-00025100: 2061 7361 6e79 6172 7261 7928 612c 2064   asanyarray(a, d
-00025110: 7479 7065 3d4e 6f6e 652c 206f 7264 6572  type=None, order
-00025120: 3d4e 6f6e 652c 202a 2c20 6c69 6b65 3d4e  =None, *, like=N
-00025130: 6f6e 652c 2069 6e6c 696e 655f 6172 7261  one, inline_arra
-00025140: 793d 4661 6c73 6529 3a0a 2020 2020 2222  y=False):.    ""
-00025150: 2243 6f6e 7665 7274 2074 6865 2069 6e70  "Convert the inp
-00025160: 7574 2074 6f20 6120 6461 736b 2061 7272  ut to a dask arr
-00025170: 6179 2e0a 0a20 2020 2053 7562 636c 6173  ay...    Subclas
-00025180: 7365 7320 6f66 2060 606e 702e 6e64 6172  ses of ``np.ndar
-00025190: 7261 7960 6020 7769 6c6c 2062 6520 7061  ray`` will be pa
-000251a0: 7373 6564 2074 6872 6f75 6768 2061 7320  ssed through as 
-000251b0: 6368 756e 6b73 2075 6e63 6861 6e67 6564  chunks unchanged
-000251c0: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
-000251d0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
-000251e0: 0a20 2020 2061 203a 2061 7272 6179 2d6c  .    a : array-l
-000251f0: 696b 650a 2020 2020 2020 2020 496e 7075  ike.        Inpu
-00025200: 7420 6461 7461 2c20 696e 2061 6e79 2066  t data, in any f
-00025210: 6f72 6d20 7468 6174 2063 616e 2062 6520  orm that can be 
-00025220: 636f 6e76 6572 7465 6420 746f 2061 2064  converted to a d
-00025230: 6173 6b20 6172 7261 792e 2054 6869 730a  ask array. This.
-00025240: 2020 2020 2020 2020 696e 636c 7564 6573          includes
-00025250: 206c 6973 7473 2c20 6c69 7374 7320 6f66   lists, lists of
-00025260: 2074 7570 6c65 732c 2074 7570 6c65 732c   tuples, tuples,
-00025270: 2074 7570 6c65 7320 6f66 2074 7570 6c65   tuples of tuple
-00025280: 732c 2074 7570 6c65 7320 6f66 0a20 2020  s, tuples of.   
-00025290: 2020 2020 206c 6973 7473 2061 6e64 206e       lists and n
-000252a0: 6461 7272 6179 732e 0a20 2020 2064 7479  darrays..    dty
-000252b0: 7065 203a 2064 6174 612d 7479 7065 2c20  pe : data-type, 
-000252c0: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-000252d0: 2042 7920 6465 6661 756c 742c 2074 6865   By default, the
-000252e0: 2064 6174 612d 7479 7065 2069 7320 696e   data-type is in
-000252f0: 6665 7272 6564 2066 726f 6d20 7468 6520  ferred from the 
-00025300: 696e 7075 7420 6461 7461 2e0a 2020 2020  input data..    
-00025310: 6f72 6465 7220 3a20 7be2 8098 43e2 8099  order : {...C...
-00025320: 2c20 e280 9846 e280 992c 20e2 8098 41e2  , ...F..., ...A.
-00025330: 8099 2c20 e280 984b e280 997d 2c20 6f70  .., ...K...}, op
-00025340: 7469 6f6e 616c 0a20 2020 2020 2020 204d  tional.        M
-00025350: 656d 6f72 7920 6c61 796f 7574 2e20 e280  emory layout. ..
-00025360: 9841 e280 9920 616e 6420 e280 984b e280  .A... and ...K..
-00025370: 9920 6465 7065 6e64 206f 6e20 7468 6520  . depend on the 
-00025380: 6f72 6465 7220 6f66 2069 6e70 7574 2061  order of input a
-00025390: 7272 6179 2061 2e0a 2020 2020 2020 2020  rray a..        
-000253a0: e280 9843 e280 9920 726f 772d 6d61 6a6f  ...C... row-majo
-000253b0: 7220 2843 2d73 7479 6c65 292c 20e2 8098  r (C-style), ...
-000253c0: 46e2 8099 2063 6f6c 756d 6e2d 6d61 6a6f  F... column-majo
-000253d0: 7220 2846 6f72 7472 616e 2d73 7479 6c65  r (Fortran-style
-000253e0: 2920 6d65 6d6f 7279 0a20 2020 2020 2020  ) memory.       
-000253f0: 2072 6570 7265 7365 6e74 6174 696f 6e2e   representation.
-00025400: 20e2 8098 41e2 8099 2028 616e 7929 206d   ...A... (any) m
-00025410: 6561 6e73 20e2 8098 46e2 8099 2069 6620  eans ...F... if 
-00025420: 6120 6973 2046 6f72 7472 616e 2063 6f6e  a is Fortran con
-00025430: 7469 6775 6f75 732c 20e2 8098 43e2 8099  tiguous, ...C...
-00025440: 0a20 2020 2020 2020 206f 7468 6572 7769  .        otherwi
-00025450: 7365 20e2 8098 4be2 8099 2028 6b65 6570  se ...K... (keep
-00025460: 2920 7072 6573 6572 7665 2069 6e70 7574  ) preserve input
-00025470: 206f 7264 6572 2e20 4465 6661 756c 7473   order. Defaults
-00025480: 2074 6f20 e280 9843 e280 992e 0a20 2020   to ...C.....   
-00025490: 206c 696b 653a 2061 7272 6179 2d6c 696b   like: array-lik
-000254a0: 650a 2020 2020 2020 2020 5265 6665 7265  e.        Refere
-000254b0: 6e63 6520 6f62 6a65 6374 2074 6f20 616c  nce object to al
-000254c0: 6c6f 7720 7468 6520 6372 6561 7469 6f6e  low the creation
-000254d0: 206f 6620 4461 736b 2061 7272 6179 7320   of Dask arrays 
-000254e0: 7769 7468 2063 6875 6e6b 730a 2020 2020  with chunks.    
-000254f0: 2020 2020 7468 6174 2061 7265 206e 6f74      that are not
-00025500: 204e 756d 5079 2061 7272 6179 732e 2049   NumPy arrays. I
-00025510: 6620 616e 2061 7272 6179 2d6c 696b 6520  f an array-like 
-00025520: 7061 7373 6564 2069 6e20 6173 2060 606c  passed in as ``l
-00025530: 696b 6560 600a 2020 2020 2020 2020 7375  ike``.        su
-00025540: 7070 6f72 7473 2074 6865 2060 605f 5f61  pports the ``__a
-00025550: 7272 6179 5f66 756e 6374 696f 6e5f 5f60  rray_function__`
-00025560: 6020 7072 6f74 6f63 6f6c 2c20 7468 6520  ` protocol, the 
-00025570: 6368 756e 6b20 7479 7065 206f 6620 7468  chunk type of th
-00025580: 650a 2020 2020 2020 2020 7265 7375 6c74  e.        result
-00025590: 696e 6720 6172 7261 7920 7769 6c6c 2062  ing array will b
-000255a0: 6520 6465 6669 6e65 6420 6279 2069 742e  e defined by it.
-000255b0: 2049 6e20 7468 6973 2063 6173 652c 2069   In this case, i
-000255c0: 7420 656e 7375 7265 7320 7468 650a 2020  t ensures the.  
-000255d0: 2020 2020 2020 6372 6561 7469 6f6e 206f        creation o
-000255e0: 6620 6120 4461 736b 2061 7272 6179 2063  f a Dask array c
-000255f0: 6f6d 7061 7469 626c 6520 7769 7468 2074  ompatible with t
-00025600: 6861 7420 7061 7373 6564 2069 6e20 7669  hat passed in vi
-00025610: 6120 7468 6973 0a20 2020 2020 2020 2061  a this.        a
-00025620: 7267 756d 656e 742e 2049 6620 6060 6c69  rgument. If ``li
-00025630: 6b65 6060 2069 7320 6120 4461 736b 2061  ke`` is a Dask a
-00025640: 7272 6179 2c20 7468 6520 6368 756e 6b20  rray, the chunk 
-00025650: 7479 7065 206f 6620 7468 650a 2020 2020  type of the.    
-00025660: 2020 2020 7265 7375 6c74 696e 6720 6172      resulting ar
-00025670: 7261 7920 7769 6c6c 2062 6520 6465 6669  ray will be defi
-00025680: 6e65 6420 6279 2074 6865 2063 6875 6e6b  ned by the chunk
-00025690: 2074 7970 6520 6f66 2060 606c 696b 6560   type of ``like`
-000256a0: 602e 0a20 2020 2020 2020 2052 6571 7569  `..        Requi
-000256b0: 7265 7320 4e75 6d50 7920 312e 3230 2e30  res NumPy 1.20.0
-000256c0: 206f 7220 6869 6768 6572 2e0a 2020 2020   or higher..    
-000256d0: 696e 6c69 6e65 5f61 7272 6179 3a0a 2020  inline_array:.  
-000256e0: 2020 2020 2020 5768 6574 6865 7220 746f        Whether to
-000256f0: 2069 6e6c 696e 6520 7468 6520 6172 7261   inline the arra
-00025700: 7920 696e 2074 6865 2072 6573 756c 7469  y in the resulti
-00025710: 6e67 2064 6173 6b20 6772 6170 682e 2046  ng dask graph. F
-00025720: 6f72 206d 6f72 6520 696e 666f 726d 6174  or more informat
-00025730: 696f 6e2c 0a20 2020 2020 2020 2073 6565  ion,.        see
-00025740: 2074 6865 2064 6f63 756d 656e 7461 7469   the documentati
-00025750: 6f6e 2066 6f72 2060 6064 6173 6b2e 6172  on for ``dask.ar
-00025760: 7261 792e 6672 6f6d 5f61 7272 6179 2829  ray.from_array()
-00025770: 6060 2e0a 0a20 2020 2052 6574 7572 6e73  ``...    Returns
-00025780: 0a20 2020 202d 2d2d 2d2d 2d2d 0a20 2020  .    -------.   
-00025790: 206f 7574 203a 2064 6173 6b20 6172 7261   out : dask arra
-000257a0: 790a 2020 2020 2020 2020 4461 736b 2061  y.        Dask a
-000257b0: 7272 6179 2069 6e74 6572 7072 6574 6174  rray interpretat
-000257c0: 696f 6e20 6f66 2061 2e0a 0a20 2020 2045  ion of a...    E
-000257d0: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
-000257e0: 2d2d 2d2d 0a20 2020 203e 3e3e 2069 6d70  ----.    >>> imp
-000257f0: 6f72 7420 6461 736b 2e61 7272 6179 2061  ort dask.array a
-00025800: 7320 6461 0a20 2020 203e 3e3e 2069 6d70  s da.    >>> imp
-00025810: 6f72 7420 6e75 6d70 7920 6173 206e 700a  ort numpy as np.
-00025820: 2020 2020 3e3e 3e20 7820 3d20 6e70 2e61      >>> x = np.a
-00025830: 7261 6e67 6528 3329 0a20 2020 203e 3e3e  range(3).    >>>
-00025840: 2064 612e 6173 616e 7961 7272 6179 2878   da.asanyarray(x
-00025850: 290a 2020 2020 6461 736b 2e61 7272 6179  ).    dask.array
-00025860: 3c61 7272 6179 2c20 7368 6170 653d 2833  <array, shape=(3
-00025870: 2c29 2c20 6474 7970 653d 696e 7436 342c  ,), dtype=int64,
-00025880: 2063 6875 6e6b 7369 7a65 3d28 332c 292c   chunksize=(3,),
-00025890: 2063 6875 6e6b 7479 7065 3d6e 756d 7079   chunktype=numpy
-000258a0: 2e6e 6461 7272 6179 3e0a 0a20 2020 203e  .ndarray>..    >
-000258b0: 3e3e 2079 203d 205b 5b31 2c20 322c 2033  >> y = [[1, 2, 3
-000258c0: 5d2c 205b 342c 2035 2c20 365d 5d0a 2020  ], [4, 5, 6]].  
-000258d0: 2020 3e3e 3e20 6461 2e61 7361 6e79 6172    >>> da.asanyar
-000258e0: 7261 7928 7929 0a20 2020 2064 6173 6b2e  ray(y).    dask.
-000258f0: 6172 7261 793c 6172 7261 792c 2073 6861  array<array, sha
-00025900: 7065 3d28 322c 2033 292c 2064 7479 7065  pe=(2, 3), dtype
-00025910: 3d69 6e74 3634 2c20 6368 756e 6b73 697a  =int64, chunksiz
-00025920: 653d 2832 2c20 3329 2c20 6368 756e 6b74  e=(2, 3), chunkt
-00025930: 7970 653d 6e75 6d70 792e 6e64 6172 7261  ype=numpy.ndarra
-00025940: 793e 0a20 2020 2022 2222 0a20 2020 2069  y>.    """.    i
-00025950: 6620 6c69 6b65 2069 7320 4e6f 6e65 3a0a  f like is None:.
-00025960: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-00025970: 7461 6e63 6528 612c 2041 7272 6179 293a  tance(a, Array):
-00025980: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00025990: 7572 6e20 610a 2020 2020 2020 2020 656c  urn a.        el
-000259a0: 6966 2068 6173 6174 7472 2861 2c20 2274  if hasattr(a, "t
-000259b0: 6f5f 6461 736b 5f61 7272 6179 2229 3a0a  o_dask_array"):.
-000259c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000259d0: 726e 2061 2e74 6f5f 6461 736b 5f61 7272  rn a.to_dask_arr
-000259e0: 6179 2829 0a20 2020 2020 2020 2065 6c69  ay().        eli
-000259f0: 6620 7479 7065 2861 292e 5f5f 6d6f 6475  f type(a).__modu
-00025a00: 6c65 5f5f 2e73 706c 6974 2822 2e22 295b  le__.split(".")[
-00025a10: 305d 203d 3d20 2278 6172 7261 7922 2061  0] == "xarray" a
-00025a20: 6e64 2068 6173 6174 7472 2861 2c20 2264  nd hasattr(a, "d
-00025a30: 6174 6122 293a 0a20 2020 2020 2020 2020  ata"):.         
-00025a40: 2020 2072 6574 7572 6e20 6173 616e 7961     return asanya
-00025a50: 7272 6179 2861 2e64 6174 6129 0a20 2020  rray(a.data).   
-00025a60: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
-00025a70: 616e 6365 2861 2c20 286c 6973 742c 2074  ance(a, (list, t
-00025a80: 7570 6c65 2929 2061 6e64 2061 6e79 2869  uple)) and any(i
-00025a90: 7369 6e73 7461 6e63 6528 692c 2041 7272  sinstance(i, Arr
-00025aa0: 6179 2920 666f 7220 6920 696e 2061 293a  ay) for i in a):
-00025ab0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00025ac0: 7572 6e20 7374 6163 6b28 6129 0a20 2020  urn stack(a).   
-00025ad0: 2020 2020 2065 6c69 6620 6e6f 7420 6973       elif not is
-00025ae0: 696e 7374 616e 6365 2867 6574 6174 7472  instance(getattr
-00025af0: 2861 2c20 2273 6861 7065 222c 204e 6f6e  (a, "shape", Non
-00025b00: 6529 2c20 4974 6572 6162 6c65 293a 0a20  e), Iterable):. 
-00025b10: 2020 2020 2020 2020 2020 2061 203d 206e             a = n
-00025b20: 702e 6173 616e 7961 7272 6179 2861 2c20  p.asanyarray(a, 
-00025b30: 6474 7970 653d 6474 7970 652c 206f 7264  dtype=dtype, ord
-00025b40: 6572 3d6f 7264 6572 290a 2020 2020 656c  er=order).    el
-00025b50: 7365 3a0a 2020 2020 2020 2020 6c69 6b65  se:.        like
-00025b60: 5f6d 6574 6120 3d20 6d65 7461 5f66 726f  _meta = meta_fro
-00025b70: 6d5f 6172 7261 7928 6c69 6b65 290a 2020  m_array(like).  
-00025b80: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-00025b90: 6e63 6528 612c 2041 7272 6179 293a 0a20  nce(a, Array):. 
-00025ba0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00025bb0: 6e20 612e 6d61 705f 626c 6f63 6b73 286e  n a.map_blocks(n
-00025bc0: 702e 6173 616e 7961 7272 6179 2c20 6c69  p.asanyarray, li
-00025bd0: 6b65 3d6c 696b 655f 6d65 7461 2c20 6474  ke=like_meta, dt
-00025be0: 7970 653d 6474 7970 652c 206f 7264 6572  ype=dtype, order
-00025bf0: 3d6f 7264 6572 290a 2020 2020 2020 2020  =order).        
-00025c00: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00025c10: 2020 6120 3d20 6e70 2e61 7361 6e79 6172    a = np.asanyar
-00025c20: 7261 7928 612c 206c 696b 653d 6c69 6b65  ray(a, like=like
-00025c30: 5f6d 6574 612c 2064 7479 7065 3d64 7479  _meta, dtype=dty
-00025c40: 7065 2c20 6f72 6465 723d 6f72 6465 7229  pe, order=order)
-00025c50: 0a20 2020 2072 6574 7572 6e20 6672 6f6d  .    return from
-00025c60: 5f61 7272 6179 280a 2020 2020 2020 2020  _array(.        
-00025c70: 612c 0a20 2020 2020 2020 2063 6875 6e6b  a,.        chunk
-00025c80: 733d 612e 7368 6170 652c 0a20 2020 2020  s=a.shape,.     
-00025c90: 2020 2067 6574 6974 656d 3d67 6574 7465     getitem=gette
-00025ca0: 725f 696e 6c69 6e65 2c0a 2020 2020 2020  r_inline,.      
-00025cb0: 2020 6173 6172 7261 793d 4661 6c73 652c    asarray=False,
-00025cc0: 0a20 2020 2020 2020 2069 6e6c 696e 655f  .        inline_
-00025cd0: 6172 7261 793d 696e 6c69 6e65 5f61 7272  array=inline_arr
-00025ce0: 6179 2c0a 2020 2020 290a 0a0a 6465 6620  ay,.    )...def 
-00025cf0: 6973 5f73 6361 6c61 725f 666f 725f 656c  is_scalar_for_el
-00025d00: 656d 7769 7365 2861 7267 293a 0a20 2020  emwise(arg):.   
-00025d10: 2022 2222 0a0a 2020 2020 3e3e 3e20 6973   """..    >>> is
-00025d20: 5f73 6361 6c61 725f 666f 725f 656c 656d  _scalar_for_elem
-00025d30: 7769 7365 2834 3229 0a20 2020 2054 7275  wise(42).    Tru
-00025d40: 650a 2020 2020 3e3e 3e20 6973 5f73 6361  e.    >>> is_sca
-00025d50: 6c61 725f 666f 725f 656c 656d 7769 7365  lar_for_elemwise
-00025d60: 2827 666f 6f27 290a 2020 2020 5472 7565  ('foo').    True
-00025d70: 0a20 2020 203e 3e3e 2069 735f 7363 616c  .    >>> is_scal
-00025d80: 6172 5f66 6f72 5f65 6c65 6d77 6973 6528  ar_for_elemwise(
-00025d90: 5472 7565 290a 2020 2020 5472 7565 0a20  True).    True. 
-00025da0: 2020 203e 3e3e 2069 735f 7363 616c 6172     >>> is_scalar
-00025db0: 5f66 6f72 5f65 6c65 6d77 6973 6528 6e70  _for_elemwise(np
-00025dc0: 2e61 7272 6179 2834 3229 290a 2020 2020  .array(42)).    
-00025dd0: 5472 7565 0a20 2020 203e 3e3e 2069 735f  True.    >>> is_
-00025de0: 7363 616c 6172 5f66 6f72 5f65 6c65 6d77  scalar_for_elemw
-00025df0: 6973 6528 5b31 2c20 322c 2033 5d29 0a20  ise([1, 2, 3]). 
-00025e00: 2020 2054 7275 650a 2020 2020 3e3e 3e20     True.    >>> 
-00025e10: 6973 5f73 6361 6c61 725f 666f 725f 656c  is_scalar_for_el
-00025e20: 656d 7769 7365 286e 702e 6172 7261 7928  emwise(np.array(
-00025e30: 5b31 2c20 322c 2033 5d29 290a 2020 2020  [1, 2, 3])).    
-00025e40: 4661 6c73 650a 2020 2020 3e3e 3e20 6973  False.    >>> is
-00025e50: 5f73 6361 6c61 725f 666f 725f 656c 656d  _scalar_for_elem
-00025e60: 7769 7365 2866 726f 6d5f 6172 7261 7928  wise(from_array(
-00025e70: 6e70 2e61 7272 6179 2830 292c 2063 6875  np.array(0), chu
-00025e80: 6e6b 733d 2829 2929 0a20 2020 2046 616c  nks=())).    Fal
-00025e90: 7365 0a20 2020 203e 3e3e 2069 735f 7363  se.    >>> is_sc
-00025ea0: 616c 6172 5f66 6f72 5f65 6c65 6d77 6973  alar_for_elemwis
-00025eb0: 6528 6e70 2e64 7479 7065 2827 6934 2729  e(np.dtype('i4')
-00025ec0: 290a 2020 2020 5472 7565 0a20 2020 2022  ).    True.    "
-00025ed0: 2222 0a20 2020 2023 2074 6865 2073 6563  "".    # the sec
-00025ee0: 6f6e 6420 6861 6c66 206f 6620 7368 6170  ond half of shap
-00025ef0: 655f 636f 6e64 6974 696f 6e20 6973 2065  e_condition is e
-00025f00: 7373 656e 7469 616c 6c79 206a 7573 7420  ssentially just 
-00025f10: 746f 2065 6e73 7572 6520 7468 6174 0a20  to ensure that. 
-00025f20: 2020 2023 2064 6173 6b20 7365 7269 6573     # dask series
-00025f30: 202f 2066 7261 6d65 2061 7265 2074 7265   / frame are tre
-00025f40: 6174 6564 2061 7320 7363 616c 6172 7320  ated as scalars 
-00025f50: 696e 2065 6c65 6d77 6973 652e 0a20 2020  in elemwise..   
-00025f60: 206d 6179 6265 5f73 6861 7065 203d 2067   maybe_shape = g
-00025f70: 6574 6174 7472 2861 7267 2c20 2273 6861  etattr(arg, "sha
-00025f80: 7065 222c 204e 6f6e 6529 0a20 2020 2073  pe", None).    s
-00025f90: 6861 7065 5f63 6f6e 6469 7469 6f6e 203d  hape_condition =
-00025fa0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-00025fb0: 6d61 7962 655f 7368 6170 652c 2049 7465  maybe_shape, Ite
-00025fc0: 7261 626c 6529 206f 7220 616e 7928 0a20  rable) or any(. 
-00025fd0: 2020 2020 2020 2069 735f 6461 736b 5f63         is_dask_c
-00025fe0: 6f6c 6c65 6374 696f 6e28 7829 2066 6f72  ollection(x) for
-00025ff0: 2078 2069 6e20 6d61 7962 655f 7368 6170   x in maybe_shap
-00026000: 650a 2020 2020 290a 0a20 2020 2072 6574  e.    )..    ret
-00026010: 7572 6e20 280a 2020 2020 2020 2020 6e70  urn (.        np
-00026020: 2e69 7373 6361 6c61 7228 6172 6729 0a20  .isscalar(arg). 
-00026030: 2020 2020 2020 206f 7220 7368 6170 655f         or shape_
-00026040: 636f 6e64 6974 696f 6e0a 2020 2020 2020  condition.      
-00026050: 2020 6f72 2069 7369 6e73 7461 6e63 6528    or isinstance(
-00026060: 6172 672c 206e 702e 6474 7970 6529 0a20  arg, np.dtype). 
-00026070: 2020 2020 2020 206f 7220 2869 7369 6e73         or (isins
-00026080: 7461 6e63 6528 6172 672c 206e 702e 6e64  tance(arg, np.nd
-00026090: 6172 7261 7929 2061 6e64 2061 7267 2e6e  array) and arg.n
-000260a0: 6469 6d20 3d3d 2030 290a 2020 2020 290a  dim == 0).    ).
-000260b0: 0a0a 6465 6620 6272 6f61 6463 6173 745f  ..def broadcast_
-000260c0: 7368 6170 6573 282a 7368 6170 6573 293a  shapes(*shapes):
-000260d0: 0a20 2020 2022 2222 0a20 2020 2044 6574  .    """.    Det
-000260e0: 6572 6d69 6e65 7320 6f75 7470 7574 2073  ermines output s
-000260f0: 6861 7065 2066 726f 6d20 6272 6f61 6463  hape from broadc
-00026100: 6173 7469 6e67 2061 7272 6179 732e 0a0a  asting arrays...
-00026110: 2020 2020 5061 7261 6d65 7465 7273 0a20      Parameters. 
-00026120: 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020     ----------.  
-00026130: 2020 7368 6170 6573 203a 2074 7570 6c65    shapes : tuple
-00026140: 730a 2020 2020 2020 2020 5468 6520 7368  s.        The sh
-00026150: 6170 6573 206f 6620 7468 6520 6172 6775  apes of the argu
-00026160: 6d65 6e74 732e 0a0a 2020 2020 5265 7475  ments...    Retu
-00026170: 726e 730a 2020 2020 2d2d 2d2d 2d2d 2d0a  rns.    -------.
-00026180: 2020 2020 6f75 7470 7574 5f73 6861 7065      output_shape
-00026190: 203a 2074 7570 6c65 0a0a 2020 2020 5261   : tuple..    Ra
-000261a0: 6973 6573 0a20 2020 202d 2d2d 2d2d 2d0a  ises.    ------.
-000261b0: 2020 2020 5661 6c75 6545 7272 6f72 0a20      ValueError. 
-000261c0: 2020 2020 2020 2049 6620 7468 6520 696e         If the in
-000261d0: 7075 7420 7368 6170 6573 2063 616e 6e6f  put shapes canno
-000261e0: 7420 6265 2073 7563 6365 7373 6675 6c6c  t be successfull
-000261f0: 7920 6272 6f61 6463 6173 7420 746f 6765  y broadcast toge
-00026200: 7468 6572 2e0a 2020 2020 2222 220a 2020  ther..    """.  
-00026210: 2020 6966 206c 656e 2873 6861 7065 7329    if len(shapes)
-00026220: 203d 3d20 313a 0a20 2020 2020 2020 2072   == 1:.        r
-00026230: 6574 7572 6e20 7368 6170 6573 5b30 5d0a  eturn shapes[0].
-00026240: 2020 2020 6f75 7420 3d20 5b5d 0a20 2020      out = [].   
-00026250: 2066 6f72 2073 697a 6573 2069 6e20 7a69   for sizes in zi
-00026260: 705f 6c6f 6e67 6573 7428 2a6d 6170 2872  p_longest(*map(r
-00026270: 6576 6572 7365 642c 2073 6861 7065 7329  eversed, shapes)
-00026280: 2c20 6669 6c6c 7661 6c75 653d 2d31 293a  , fillvalue=-1):
-00026290: 0a20 2020 2020 2020 2069 6620 6e70 2e69  .        if np.i
-000262a0: 736e 616e 2873 697a 6573 292e 616e 7928  snan(sizes).any(
-000262b0: 293a 0a20 2020 2020 2020 2020 2020 2064  ):.            d
-000262c0: 696d 203d 206e 702e 6e61 6e0a 2020 2020  im = np.nan.    
-000262d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-000262e0: 2020 2020 2020 6469 6d20 3d20 3020 6966        dim = 0 if
-000262f0: 2030 2069 6e20 7369 7a65 7320 656c 7365   0 in sizes else
-00026300: 206e 702e 6d61 7828 7369 7a65 7329 0a20   np.max(sizes). 
-00026310: 2020 2020 2020 2069 6620 616e 7928 6920         if any(i 
-00026320: 6e6f 7420 696e 205b 2d31 2c20 302c 2031  not in [-1, 0, 1
-00026330: 2c20 6469 6d5d 2061 6e64 206e 6f74 206e  , dim] and not n
-00026340: 702e 6973 6e61 6e28 6929 2066 6f72 2069  p.isnan(i) for i
-00026350: 2069 6e20 7369 7a65 7329 3a0a 2020 2020   in sizes):.    
-00026360: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-00026370: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
-00026380: 2020 2020 2020 2020 2020 226f 7065 7261            "opera
-00026390: 6e64 7320 636f 756c 6420 6e6f 7420 6265  nds could not be
-000263a0: 2062 726f 6164 6361 7374 2074 6f67 6574   broadcast toget
-000263b0: 6865 7220 7769 7468 2022 0a20 2020 2020  her with ".     
-000263c0: 2020 2020 2020 2020 2020 2022 7368 6170             "shap
-000263d0: 6573 207b 7d22 2e66 6f72 6d61 7428 2220  es {}".format(" 
-000263e0: 222e 6a6f 696e 286d 6170 2873 7472 2c20  ".join(map(str, 
-000263f0: 7368 6170 6573 2929 290a 2020 2020 2020  shapes))).      
-00026400: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00026410: 6f75 742e 6170 7065 6e64 2864 696d 290a  out.append(dim).
-00026420: 2020 2020 7265 7475 726e 2074 7570 6c65      return tuple
-00026430: 2872 6576 6572 7365 6428 6f75 7429 290a  (reversed(out)).
-00026440: 0a0a 6465 6620 656c 656d 7769 7365 286f  ..def elemwise(o
-00026450: 702c 202a 6172 6773 2c20 6f75 743d 4e6f  p, *args, out=No
-00026460: 6e65 2c20 7768 6572 653d 5472 7565 2c20  ne, where=True, 
-00026470: 6474 7970 653d 4e6f 6e65 2c20 6e61 6d65  dtype=None, name
-00026480: 3d4e 6f6e 652c 202a 2a6b 7761 7267 7329  =None, **kwargs)
-00026490: 3a0a 2020 2020 2222 2241 7070 6c79 2061  :.    """Apply a
-000264a0: 6e20 656c 656d 656e 7477 6973 6520 7566  n elementwise uf
-000264b0: 756e 632d 6c69 6b65 2066 756e 6374 696f  unc-like functio
-000264c0: 6e20 626c 6f63 6b77 6973 6520 6163 726f  n blockwise acro
-000264d0: 7373 2061 7267 756d 656e 7473 2e0a 0a20  ss arguments... 
-000264e0: 2020 204c 696b 6520 6e75 6d70 7920 7566     Like numpy uf
-000264f0: 756e 6373 2c20 6272 6f61 6463 6173 7469  uncs, broadcasti
-00026500: 6e67 2072 756c 6573 2061 7265 2072 6573  ng rules are res
-00026510: 7065 6374 6564 2e0a 0a20 2020 2050 6172  pected...    Par
-00026520: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
-00026530: 2d2d 2d2d 2d2d 0a20 2020 206f 7020 3a20  ------.    op : 
-00026540: 6361 6c6c 6162 6c65 0a20 2020 2020 2020  callable.       
-00026550: 2054 6865 2066 756e 6374 696f 6e20 746f   The function to
-00026560: 2061 7070 6c79 2e20 5368 6f75 6c64 2062   apply. Should b
-00026570: 6520 6e75 6d70 7920 7566 756e 632d 6c69  e numpy ufunc-li
-00026580: 6b65 2069 6e20 7468 6520 7061 7261 6d65  ke in the parame
-00026590: 7465 7273 0a20 2020 2020 2020 2074 6861  ters.        tha
-000265a0: 7420 6974 2061 6363 6570 7473 2e0a 2020  t it accepts..  
-000265b0: 2020 2a61 7267 7320 3a20 416e 790a 2020    *args : Any.  
-000265c0: 2020 2020 2020 4172 6775 6d65 6e74 7320        Arguments 
-000265d0: 746f 2070 6173 7320 746f 2060 6f70 602e  to pass to `op`.
-000265e0: 204e 6f6e 2d64 6173 6b20 6172 7261 792d   Non-dask array-
-000265f0: 6c69 6b65 206f 626a 6563 7473 2061 7265  like objects are
-00026600: 2066 6972 7374 0a20 2020 2020 2020 2063   first.        c
-00026610: 6f6e 7665 7274 6564 2074 6f20 6461 736b  onverted to dask
-00026620: 2061 7272 6179 732c 2074 6865 6e20 616c   arrays, then al
-00026630: 6c20 6172 7261 7973 2061 7265 2062 726f  l arrays are bro
-00026640: 6164 6361 7374 2074 6f67 6574 6865 7220  adcast together 
-00026650: 6265 666f 7265 0a20 2020 2020 2020 2061  before.        a
-00026660: 7070 6c79 696e 6720 7468 6520 6675 6e63  pplying the func
-00026670: 7469 6f6e 2062 6c6f 636b 7769 7365 2061  tion blockwise a
-00026680: 6372 6f73 7320 616c 6c20 6172 6775 6d65  cross all argume
-00026690: 6e74 732e 2041 6e79 2073 6361 6c61 720a  nts. Any scalar.
-000266a0: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
-000266b0: 7320 6172 6520 7061 7373 6564 2061 732d  s are passed as-
-000266c0: 6973 2066 6f6c 6c6f 7769 6e67 206e 6f72  is following nor
-000266d0: 6d61 6c20 6e75 6d70 7920 7566 756e 6320  mal numpy ufunc 
-000266e0: 6265 6861 7669 6f72 2e0a 2020 2020 6f75  behavior..    ou
-000266f0: 7420 3a20 6461 736b 2061 7272 6179 2c20  t : dask array, 
-00026700: 6f70 7469 6f6e 616c 0a20 2020 2020 2020  optional.       
-00026710: 2049 6620 6f75 7420 6973 2061 2064 6173   If out is a das
-00026720: 6b2e 6172 7261 7920 7468 656e 2074 6869  k.array then thi
-00026730: 7320 6f76 6572 7772 6974 6573 2074 6865  s overwrites the
-00026740: 2063 6f6e 7465 6e74 7320 6f66 2074 6861   contents of tha
-00026750: 7420 6172 7261 790a 2020 2020 2020 2020  t array.        
-00026760: 7769 7468 2074 6865 2072 6573 756c 742e  with the result.
-00026770: 0a20 2020 2077 6865 7265 203a 2061 7272  .    where : arr
-00026780: 6179 5f6c 696b 652c 206f 7074 696f 6e61  ay_like, optiona
-00026790: 6c0a 2020 2020 2020 2020 416e 206f 7074  l.        An opt
-000267a0: 696f 6e61 6c20 626f 6f6c 6561 6e20 6d61  ional boolean ma
-000267b0: 736b 206d 6172 6b69 6e67 206c 6f63 6174  sk marking locat
-000267c0: 696f 6e73 2077 6865 7265 2074 6865 2075  ions where the u
-000267d0: 6675 6e63 2073 686f 756c 6420 6265 0a20  func should be. 
-000267e0: 2020 2020 2020 2061 7070 6c69 6564 2e20         applied. 
-000267f0: 4361 6e20 6265 2061 2073 6361 6c61 722c  Can be a scalar,
-00026800: 2064 6173 6b20 6172 7261 792c 206f 7220   dask array, or 
-00026810: 616e 7920 6f74 6865 7220 6172 7261 792d  any other array-
-00026820: 6c69 6b65 206f 626a 6563 742e 0a20 2020  like object..   
-00026830: 2020 2020 204d 6972 726f 7273 2074 6865       Mirrors the
-00026840: 2060 6077 6865 7265 6060 2061 7267 756d   ``where`` argum
-00026850: 656e 7420 746f 206e 756d 7079 2075 6675  ent to numpy ufu
-00026860: 6e63 732c 2073 6565 2065 2e67 2e20 6060  ncs, see e.g. ``
-00026870: 6e75 6d70 792e 6164 6460 600a 2020 2020  numpy.add``.    
-00026880: 2020 2020 666f 7220 6d6f 7265 2069 6e66      for more inf
-00026890: 6f72 6d61 7469 6f6e 2e0a 2020 2020 6474  ormation..    dt
-000268a0: 7970 6520 3a20 6474 7970 652c 206f 7074  ype : dtype, opt
-000268b0: 696f 6e61 6c0a 2020 2020 2020 2020 4966  ional.        If
-000268c0: 2070 726f 7669 6465 642c 206f 7665 7272   provided, overr
-000268d0: 6964 6573 2074 6865 206f 7574 7075 7420  ides the output 
-000268e0: 6172 7261 7920 6474 7970 652e 0a20 2020  array dtype..   
-000268f0: 206e 616d 6520 3a20 7374 722c 206f 7074   name : str, opt
-00026900: 696f 6e61 6c0a 2020 2020 2020 2020 4120  ional.        A 
-00026910: 756e 6971 7565 206b 6579 206e 616d 6520  unique key name 
-00026920: 746f 2075 7365 2077 6865 6e20 6275 696c  to use when buil
-00026930: 6469 6e67 2074 6865 2062 6163 6b69 6e67  ding the backing
-00026940: 2064 6173 6b20 6772 6170 682e 2049 6620   dask graph. If 
-00026950: 6e6f 740a 2020 2020 2020 2020 7072 6f76  not.        prov
-00026960: 6964 6564 2c20 6f6e 6520 7769 6c6c 2062  ided, one will b
-00026970: 6520 6175 746f 6d61 7469 6361 6c6c 7920  e automatically 
-00026980: 6765 6e65 7261 7465 6420 6261 7365 6420  generated based 
-00026990: 6f6e 2074 6865 2069 6e70 7574 0a20 2020  on the input.   
-000269a0: 2020 2020 2061 7267 756d 656e 7473 2e0a       arguments..
-000269b0: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
-000269c0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
-000269d0: 3e3e 2065 6c65 6d77 6973 6528 6164 642c  >> elemwise(add,
-000269e0: 2078 2c20 7929 2020 2320 646f 6374 6573   x, y)  # doctes
-000269f0: 743a 202b 534b 4950 0a20 2020 203e 3e3e  t: +SKIP.    >>>
-00026a00: 2065 6c65 6d77 6973 6528 7369 6e2c 2078   elemwise(sin, x
-00026a10: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-00026a20: 4b49 500a 2020 2020 3e3e 3e20 656c 656d  KIP.    >>> elem
-00026a30: 7769 7365 2873 696e 2c20 782c 206f 7574  wise(sin, x, out
-00026a40: 3d64 6173 6b5f 6172 7261 7929 2020 2320  =dask_array)  # 
-00026a50: 646f 6374 6573 743a 202b 534b 4950 0a0a  doctest: +SKIP..
-00026a60: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
-00026a70: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 626c   --------.    bl
-00026a80: 6f63 6b77 6973 650a 2020 2020 2222 220a  ockwise.    """.
-00026a90: 2020 2020 6966 206b 7761 7267 733a 0a20      if kwargs:. 
-00026aa0: 2020 2020 2020 2072 6169 7365 2054 7970         raise Typ
-00026ab0: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
-00026ac0: 2020 2020 6622 7b6f 702e 5f5f 6e61 6d65      f"{op.__name
-00026ad0: 5f5f 7d20 646f 6573 206e 6f74 2074 616b  __} does not tak
-00026ae0: 6520 7468 6520 666f 6c6c 6f77 696e 6720  e the following 
-00026af0: 6b65 7977 6f72 6420 6172 6775 6d65 6e74  keyword argument
-00026b00: 7320 220a 2020 2020 2020 2020 2020 2020  s ".            
-00026b10: 6622 7b73 6f72 7465 6428 6b77 6172 6773  f"{sorted(kwargs
-00026b20: 297d 220a 2020 2020 2020 2020 290a 0a20  )}".        ).. 
-00026b30: 2020 206f 7574 203d 205f 656c 656d 7769     out = _elemwi
-00026b40: 7365 5f6e 6f72 6d61 6c69 7a65 5f6f 7574  se_normalize_out
-00026b50: 286f 7574 290a 2020 2020 7768 6572 6520  (out).    where 
-00026b60: 3d20 5f65 6c65 6d77 6973 655f 6e6f 726d  = _elemwise_norm
-00026b70: 616c 697a 655f 7768 6572 6528 7768 6572  alize_where(wher
-00026b80: 6529 0a20 2020 2061 7267 7320 3d20 5b6e  e).    args = [n
-00026b90: 702e 6173 6172 7261 7928 6129 2069 6620  p.asarray(a) if 
-00026ba0: 6973 696e 7374 616e 6365 2861 2c20 286c  isinstance(a, (l
-00026bb0: 6973 742c 2074 7570 6c65 2929 2065 6c73  ist, tuple)) els
-00026bc0: 6520 6120 666f 7220 6120 696e 2061 7267  e a for a in arg
-00026bd0: 735d 0a0a 2020 2020 7368 6170 6573 203d  s]..    shapes =
-00026be0: 205b 5d0a 2020 2020 666f 7220 6172 6720   [].    for arg 
-00026bf0: 696e 2061 7267 733a 0a20 2020 2020 2020  in args:.       
-00026c00: 2073 6861 7065 203d 2067 6574 6174 7472   shape = getattr
-00026c10: 2861 7267 2c20 2273 6861 7065 222c 2028  (arg, "shape", (
-00026c20: 2929 0a20 2020 2020 2020 2069 6620 616e  )).        if an
-00026c30: 7928 6973 5f64 6173 6b5f 636f 6c6c 6563  y(is_dask_collec
-00026c40: 7469 6f6e 2878 2920 666f 7220 7820 696e  tion(x) for x in
-00026c50: 2073 6861 7065 293a 0a20 2020 2020 2020   shape):.       
-00026c60: 2020 2020 2023 2057 616e 7420 746f 2065       # Want to e
-00026c70: 7863 6c75 6465 2044 656c 6179 6564 2073  xclude Delayed s
-00026c80: 6861 7065 7320 616e 6420 6464 2e53 6361  hapes and dd.Sca
-00026c90: 6c61 720a 2020 2020 2020 2020 2020 2020  lar.            
-00026ca0: 7368 6170 6520 3d20 2829 0a20 2020 2020  shape = ().     
-00026cb0: 2020 2073 6861 7065 732e 6170 7065 6e64     shapes.append
-00026cc0: 2873 6861 7065 290a 2020 2020 6966 2069  (shape).    if i
-00026cd0: 7369 6e73 7461 6e63 6528 7768 6572 652c  sinstance(where,
-00026ce0: 2041 7272 6179 293a 0a20 2020 2020 2020   Array):.       
-00026cf0: 2073 6861 7065 732e 6170 7065 6e64 2877   shapes.append(w
-00026d00: 6865 7265 2e73 6861 7065 290a 2020 2020  here.shape).    
-00026d10: 6966 2069 7369 6e73 7461 6e63 6528 6f75  if isinstance(ou
-00026d20: 742c 2041 7272 6179 293a 0a20 2020 2020  t, Array):.     
-00026d30: 2020 2073 6861 7065 732e 6170 7065 6e64     shapes.append
-00026d40: 286f 7574 2e73 6861 7065 290a 0a20 2020  (out.shape)..   
-00026d50: 2073 6861 7065 7320 3d20 5b73 2069 6620   shapes = [s if 
-00026d60: 6973 696e 7374 616e 6365 2873 2c20 4974  isinstance(s, It
-00026d70: 6572 6162 6c65 2920 656c 7365 2028 2920  erable) else () 
-00026d80: 666f 7220 7320 696e 2073 6861 7065 735d  for s in shapes]
-00026d90: 0a20 2020 206f 7574 5f6e 6469 6d20 3d20  .    out_ndim = 
-00026da0: 6c65 6e28 0a20 2020 2020 2020 2062 726f  len(.        bro
-00026db0: 6164 6361 7374 5f73 6861 7065 7328 2a73  adcast_shapes(*s
-00026dc0: 6861 7065 7329 0a20 2020 2029 2020 2320  hapes).    )  # 
-00026dd0: 5261 6973 6573 2056 616c 7565 4572 726f  Raises ValueErro
-00026de0: 7220 6966 2064 696d 656e 7369 6f6e 7320  r if dimensions 
-00026df0: 6d69 736d 6174 6368 0a20 2020 2065 7870  mismatch.    exp
-00026e00: 725f 696e 6473 203d 2074 7570 6c65 2872  r_inds = tuple(r
-00026e10: 616e 6765 286f 7574 5f6e 6469 6d29 295b  ange(out_ndim))[
-00026e20: 3a3a 2d31 5d0a 0a20 2020 2069 6620 6474  ::-1]..    if dt
-00026e30: 7970 6520 6973 206e 6f74 204e 6f6e 653a  ype is not None:
-00026e40: 0a20 2020 2020 2020 206e 6565 645f 656e  .        need_en
-00026e50: 666f 7263 655f 6474 7970 6520 3d20 5472  force_dtype = Tr
-00026e60: 7565 0a20 2020 2065 6c73 653a 0a20 2020  ue.    else:.   
-00026e70: 2020 2020 2023 2057 6520 666f 6c6c 6f77       # We follow
-00026e80: 204e 756d 5079 2773 2072 756c 6573 2066   NumPy's rules f
-00026e90: 6f72 2064 7479 7065 2070 726f 6d6f 7469  or dtype promoti
-00026ea0: 6f6e 2c20 7768 6963 6820 7370 6563 6961  on, which specia
-00026eb0: 6c20 6361 7365 730a 2020 2020 2020 2020  l cases.        
-00026ec0: 2320 7363 616c 6172 7320 616e 6420 3064  # scalars and 0d
-00026ed0: 206e 6461 7272 6179 7320 2877 6869 6368   ndarrays (which
-00026ee0: 2069 7420 636f 6e73 6964 6572 7320 6571   it considers eq
-00026ef0: 7569 7661 6c65 6e74 2920 6279 2075 7369  uivalent) by usi
-00026f00: 6e67 0a20 2020 2020 2020 2023 2074 6865  ng.        # the
-00026f10: 6972 2076 616c 7565 7320 746f 2063 6f6d  ir values to com
-00026f20: 7075 7465 2074 6865 2072 6573 756c 7420  pute the result 
-00026f30: 6474 7970 653a 0a20 2020 2020 2020 2023  dtype:.        #
-00026f40: 2068 7474 7073 3a2f 2f67 6974 6875 622e   https://github.
-00026f50: 636f 6d2f 6e75 6d70 792f 6e75 6d70 792f  com/numpy/numpy/
-00026f60: 6973 7375 6573 2f36 3234 300a 2020 2020  issues/6240.    
-00026f70: 2020 2020 2320 5765 2064 6f6e 2774 2069      # We don't i
-00026f80: 6e73 7065 6374 2074 6865 2076 616c 7565  nspect the value
-00026f90: 7320 6f66 2030 6420 6461 736b 2061 7272  s of 0d dask arr
-00026fa0: 6179 732c 2062 6563 6175 7365 2074 6865  ays, because the
-00026fb0: 7365 2063 6f75 6c64 0a20 2020 2020 2020  se could.       
-00026fc0: 2023 2068 6f6c 6420 706f 7465 6e74 6961   # hold potentia
-00026fd0: 6c6c 7920 7665 7279 2065 7870 656e 7369  lly very expensi
-00026fe0: 7665 2063 616c 6375 6c61 7469 6f6e 732e  ve calculations.
-00026ff0: 2049 6e73 7465 6164 2c20 7765 2074 7265   Instead, we tre
-00027000: 6174 0a20 2020 2020 2020 2023 2074 6865  at.        # the
-00027010: 6d20 6a75 7374 206c 696b 6520 6f74 6865  m just like othe
-00027020: 7220 6172 7261 7973 2c20 616e 6420 6966  r arrays, and if
-00027030: 206e 6563 6573 7361 7279 2063 6173 7420   necessary cast 
-00027040: 7468 6520 7265 7375 6c74 206f 6620 6f70  the result of op
-00027050: 0a20 2020 2020 2020 2023 2074 6f20 6d61  .        # to ma
-00027060: 7463 682e 0a20 2020 2020 2020 2076 616c  tch..        val
-00027070: 7320 3d20 5b0a 2020 2020 2020 2020 2020  s = [.          
-00027080: 2020 6e70 2e65 6d70 7479 2828 312c 2920    np.empty((1,) 
-00027090: 2a20 6d61 7828 312c 2061 2e6e 6469 6d29  * max(1, a.ndim)
-000270a0: 2c20 6474 7970 653d 612e 6474 7970 6529  , dtype=a.dtype)
-000270b0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000270c0: 6e6f 7420 6973 5f73 6361 6c61 725f 666f  not is_scalar_fo
-000270d0: 725f 656c 656d 7769 7365 2861 290a 2020  r_elemwise(a).  
-000270e0: 2020 2020 2020 2020 2020 656c 7365 2061            else a
-000270f0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-00027100: 2061 2069 6e20 6172 6773 0a20 2020 2020   a in args.     
-00027110: 2020 205d 0a20 2020 2020 2020 2074 7279     ].        try
-00027120: 3a0a 2020 2020 2020 2020 2020 2020 6474  :.            dt
-00027130: 7970 6520 3d20 6170 706c 795f 696e 6665  ype = apply_infe
-00027140: 725f 6474 7970 6528 6f70 2c20 7661 6c73  r_dtype(op, vals
-00027150: 2c20 7b7d 2c20 2265 6c65 6d77 6973 6522  , {}, "elemwise"
-00027160: 2c20 7375 6767 6573 745f 6474 7970 653d  , suggest_dtype=
-00027170: 4661 6c73 6529 0a20 2020 2020 2020 2065  False).        e
-00027180: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00027190: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000271a0: 7572 6e20 4e6f 7449 6d70 6c65 6d65 6e74  urn NotImplement
-000271b0: 6564 0a20 2020 2020 2020 206e 6565 645f  ed.        need_
-000271c0: 656e 666f 7263 655f 6474 7970 6520 3d20  enforce_dtype = 
-000271d0: 616e 7928 0a20 2020 2020 2020 2020 2020  any(.           
-000271e0: 206e 6f74 2069 735f 7363 616c 6172 5f66   not is_scalar_f
-000271f0: 6f72 5f65 6c65 6d77 6973 6528 6129 2061  or_elemwise(a) a
-00027200: 6e64 2061 2e6e 6469 6d20 3d3d 2030 2066  nd a.ndim == 0 f
-00027210: 6f72 2061 2069 6e20 6172 6773 0a20 2020  or a in args.   
-00027220: 2020 2020 2029 0a0a 2020 2020 6966 206e       )..    if n
-00027230: 6f74 206e 616d 653a 0a20 2020 2020 2020  ot name:.       
-00027240: 206e 616d 6520 3d20 6622 7b66 756e 636e   name = f"{funcn
-00027250: 616d 6528 6f70 297d 2d7b 746f 6b65 6e69  ame(op)}-{tokeni
-00027260: 7a65 286f 702c 2064 7479 7065 2c20 2a61  ze(op, dtype, *a
-00027270: 7267 732c 2077 6865 7265 297d 220a 0a20  rgs, where)}".. 
-00027280: 2020 2062 6c6f 636b 7769 7365 5f6b 7761     blockwise_kwa
-00027290: 7267 7320 3d20 6469 6374 2864 7479 7065  rgs = dict(dtype
-000272a0: 3d64 7479 7065 2c20 6e61 6d65 3d6e 616d  =dtype, name=nam
-000272b0: 652c 2074 6f6b 656e 3d66 756e 636e 616d  e, token=funcnam
-000272c0: 6528 6f70 292e 7374 7269 7028 225f 2229  e(op).strip("_")
-000272d0: 290a 0a20 2020 2069 6620 7768 6572 6520  )..    if where 
-000272e0: 6973 206e 6f74 2054 7275 653a 0a20 2020  is not True:.   
-000272f0: 2020 2020 2062 6c6f 636b 7769 7365 5f6b       blockwise_k
-00027300: 7761 7267 735b 2265 6c65 6d77 6973 655f  wargs["elemwise_
-00027310: 7768 6572 655f 6675 6e63 7469 6f6e 225d  where_function"]
-00027320: 203d 206f 700a 2020 2020 2020 2020 6f70   = op.        op
-00027330: 203d 205f 656c 656d 7769 7365 5f68 616e   = _elemwise_han
-00027340: 646c 655f 7768 6572 650a 2020 2020 2020  dle_where.      
-00027350: 2020 6172 6773 2e65 7874 656e 6428 5b77    args.extend([w
-00027360: 6865 7265 2c20 6f75 745d 290a 0a20 2020  here, out])..   
-00027370: 2069 6620 6e65 6564 5f65 6e66 6f72 6365   if need_enforce
-00027380: 5f64 7479 7065 3a0a 2020 2020 2020 2020  _dtype:.        
-00027390: 626c 6f63 6b77 6973 655f 6b77 6172 6773  blockwise_kwargs
-000273a0: 5b22 656e 666f 7263 655f 6474 7970 6522  ["enforce_dtype"
-000273b0: 5d20 3d20 6474 7970 650a 2020 2020 2020  ] = dtype.      
-000273c0: 2020 626c 6f63 6b77 6973 655f 6b77 6172    blockwise_kwar
-000273d0: 6773 5b22 656e 666f 7263 655f 6474 7970  gs["enforce_dtyp
-000273e0: 655f 6675 6e63 7469 6f6e 225d 203d 206f  e_function"] = o
-000273f0: 700a 2020 2020 2020 2020 6f70 203d 205f  p.        op = _
-00027400: 656e 666f 7263 655f 6474 7970 650a 0a20  enforce_dtype.. 
-00027410: 2020 2072 6573 756c 7420 3d20 626c 6f63     result = bloc
-00027420: 6b77 6973 6528 0a20 2020 2020 2020 206f  kwise(.        o
-00027430: 702c 0a20 2020 2020 2020 2065 7870 725f  p,.        expr_
-00027440: 696e 6473 2c0a 2020 2020 2020 2020 2a63  inds,.        *c
-00027450: 6f6e 6361 7428 0a20 2020 2020 2020 2020  oncat(.         
-00027460: 2020 2028 612c 2074 7570 6c65 2872 616e     (a, tuple(ran
-00027470: 6765 2861 2e6e 6469 6d29 5b3a 3a2d 315d  ge(a.ndim)[::-1]
-00027480: 2920 6966 206e 6f74 2069 735f 7363 616c  ) if not is_scal
-00027490: 6172 5f66 6f72 5f65 6c65 6d77 6973 6528  ar_for_elemwise(
-000274a0: 6129 2065 6c73 6520 4e6f 6e65 290a 2020  a) else None).  
-000274b0: 2020 2020 2020 2020 2020 666f 7220 6120            for a 
-000274c0: 696e 2061 7267 730a 2020 2020 2020 2020  in args.        
-000274d0: 292c 0a20 2020 2020 2020 202a 2a62 6c6f  ),.        **blo
-000274e0: 636b 7769 7365 5f6b 7761 7267 732c 0a20  ckwise_kwargs,. 
-000274f0: 2020 2029 0a0a 2020 2020 7265 7475 726e     )..    return
-00027500: 2068 616e 646c 655f 6f75 7428 6f75 742c   handle_out(out,
-00027510: 2072 6573 756c 7429 0a0a 0a64 6566 205f   result)...def _
-00027520: 656c 656d 7769 7365 5f6e 6f72 6d61 6c69  elemwise_normali
-00027530: 7a65 5f77 6865 7265 2877 6865 7265 293a  ze_where(where):
-00027540: 0a20 2020 2069 6620 7768 6572 6520 6973  .    if where is
-00027550: 2054 7275 653a 0a20 2020 2020 2020 2072   True:.        r
-00027560: 6574 7572 6e20 5472 7565 0a20 2020 2065  eturn True.    e
-00027570: 6c69 6620 7768 6572 6520 6973 2046 616c  lif where is Fal
-00027580: 7365 206f 7220 7768 6572 6520 6973 204e  se or where is N
-00027590: 6f6e 653a 0a20 2020 2020 2020 2072 6574  one:.        ret
-000275a0: 7572 6e20 4661 6c73 650a 2020 2020 7265  urn False.    re
-000275b0: 7475 726e 2061 7361 7272 6179 2877 6865  turn asarray(whe
-000275c0: 7265 290a 0a0a 6465 6620 5f65 6c65 6d77  re)...def _elemw
-000275d0: 6973 655f 6861 6e64 6c65 5f77 6865 7265  ise_handle_where
-000275e0: 282a 6172 6773 2c20 2a2a 6b77 6172 6773  (*args, **kwargs
-000275f0: 293a 0a20 2020 2066 756e 6374 696f 6e20  ):.    function 
-00027600: 3d20 6b77 6172 6773 2e70 6f70 2822 656c  = kwargs.pop("el
-00027610: 656d 7769 7365 5f77 6865 7265 5f66 756e  emwise_where_fun
-00027620: 6374 696f 6e22 290a 2020 2020 2a61 7267  ction").    *arg
-00027630: 732c 2077 6865 7265 2c20 6f75 7420 3d20  s, where, out = 
-00027640: 6172 6773 0a20 2020 2069 6620 6861 7361  args.    if hasa
-00027650: 7474 7228 6f75 742c 2022 636f 7079 2229  ttr(out, "copy")
-00027660: 3a0a 2020 2020 2020 2020 6f75 7420 3d20  :.        out = 
-00027670: 6f75 742e 636f 7079 2829 0a20 2020 2072  out.copy().    r
-00027680: 6574 7572 6e20 6675 6e63 7469 6f6e 282a  eturn function(*
-00027690: 6172 6773 2c20 7768 6572 653d 7768 6572  args, where=wher
-000276a0: 652c 206f 7574 3d6f 7574 2c20 2a2a 6b77  e, out=out, **kw
-000276b0: 6172 6773 290a 0a0a 6465 6620 5f65 6c65  args)...def _ele
-000276c0: 6d77 6973 655f 6e6f 726d 616c 697a 655f  mwise_normalize_
-000276d0: 6f75 7428 6f75 7429 3a0a 2020 2020 6966  out(out):.    if
-000276e0: 2069 7369 6e73 7461 6e63 6528 6f75 742c   isinstance(out,
-000276f0: 2074 7570 6c65 293a 0a20 2020 2020 2020   tuple):.       
-00027700: 2069 6620 6c65 6e28 6f75 7429 203d 3d20   if len(out) == 
-00027710: 313a 0a20 2020 2020 2020 2020 2020 206f  1:.            o
-00027720: 7574 203d 206f 7574 5b30 5d0a 2020 2020  ut = out[0].    
-00027730: 2020 2020 656c 6966 206c 656e 286f 7574      elif len(out
-00027740: 2920 3e20 313a 0a20 2020 2020 2020 2020  ) > 1:.         
-00027750: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-00027760: 656d 656e 7465 6445 7272 6f72 2822 5468  ementedError("Th
-00027770: 6520 6f75 7420 7061 7261 6d65 7465 7220  e out parameter 
-00027780: 6973 206e 6f74 2066 756c 6c79 2073 7570  is not fully sup
-00027790: 706f 7274 6564 2229 0a20 2020 2020 2020  ported").       
-000277a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000277b0: 2020 206f 7574 203d 204e 6f6e 650a 2020     out = None.  
-000277c0: 2020 6966 206e 6f74 2028 6f75 7420 6973    if not (out is
-000277d0: 204e 6f6e 6520 6f72 2069 7369 6e73 7461   None or isinsta
-000277e0: 6e63 6528 6f75 742c 2041 7272 6179 2929  nce(out, Array))
-000277f0: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
-00027800: 4e6f 7449 6d70 6c65 6d65 6e74 6564 4572  NotImplementedEr
-00027810: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00027820: 2066 2254 6865 206f 7574 2070 6172 616d   f"The out param
-00027830: 6574 6572 2069 7320 6e6f 7420 6675 6c6c  eter is not full
-00027840: 7920 7375 7070 6f72 7465 642e 220a 2020  y supported.".  
-00027850: 2020 2020 2020 2020 2020 6622 2052 6563            f" Rec
-00027860: 6569 7665 6420 7479 7065 207b 7479 7065  eived type {type
-00027870: 286f 7574 292e 5f5f 6e61 6d65 5f5f 7d2c  (out).__name__},
-00027880: 2065 7870 6563 7465 6420 4461 736b 2041   expected Dask A
-00027890: 7272 6179 220a 2020 2020 2020 2020 290a  rray".        ).
-000278a0: 2020 2020 7265 7475 726e 206f 7574 0a0a      return out..
-000278b0: 0a64 6566 2068 616e 646c 655f 6f75 7428  .def handle_out(
-000278c0: 6f75 742c 2072 6573 756c 7429 3a0a 2020  out, result):.  
-000278d0: 2020 2222 2248 616e 646c 6520 6f75 7420    """Handle out 
-000278e0: 7061 7261 6d65 7465 7273 0a0a 2020 2020  parameters..    
-000278f0: 4966 206f 7574 2069 7320 6120 6461 736b  If out is a dask
-00027900: 2e61 7272 6179 2074 6865 6e20 7468 6973  .array then this
-00027910: 206f 7665 7277 7269 7465 7320 7468 6520   overwrites the 
-00027920: 636f 6e74 656e 7473 206f 6620 7468 6174  contents of that
-00027930: 2061 7272 6179 2077 6974 680a 2020 2020   array with.    
-00027940: 7468 6520 7265 7375 6c74 0a20 2020 2022  the result.    "
-00027950: 2222 0a20 2020 206f 7574 203d 205f 656c  "".    out = _el
-00027960: 656d 7769 7365 5f6e 6f72 6d61 6c69 7a65  emwise_normalize
-00027970: 5f6f 7574 286f 7574 290a 2020 2020 6966  _out(out).    if
-00027980: 2069 7369 6e73 7461 6e63 6528 6f75 742c   isinstance(out,
-00027990: 2041 7272 6179 293a 0a20 2020 2020 2020   Array):.       
-000279a0: 2069 6620 6f75 742e 7368 6170 6520 213d   if out.shape !=
-000279b0: 2072 6573 756c 742e 7368 6170 653a 0a20   result.shape:. 
-000279c0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-000279d0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
-000279e0: 2020 2020 2020 2020 2020 2020 2022 4d69               "Mi
-000279f0: 736d 6174 6368 6564 2073 6861 7065 7320  smatched shapes 
-00027a00: 6265 7477 6565 6e20 7265 7375 6c74 2061  between result a
-00027a10: 6e64 206f 7574 2070 6172 616d 6574 6572  nd out parameter
-00027a20: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
-00027a30: 2020 2020 226f 7574 3d25 732c 2072 6573      "out=%s, res
-00027a40: 756c 743d 2573 2220 2520 2873 7472 286f  ult=%s" % (str(o
-00027a50: 7574 2e73 6861 7065 292c 2073 7472 2872  ut.shape), str(r
-00027a60: 6573 756c 742e 7368 6170 6529 290a 2020  esult.shape)).  
-00027a70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00027a80: 2020 2020 6f75 742e 5f63 6875 6e6b 7320      out._chunks 
-00027a90: 3d20 7265 7375 6c74 2e63 6875 6e6b 730a  = result.chunks.
-00027aa0: 2020 2020 2020 2020 6f75 742e 6461 736b          out.dask
-00027ab0: 203d 2072 6573 756c 742e 6461 736b 0a20   = result.dask. 
-00027ac0: 2020 2020 2020 206f 7574 2e5f 6d65 7461         out._meta
-00027ad0: 203d 2072 6573 756c 742e 5f6d 6574 610a   = result._meta.
-00027ae0: 2020 2020 2020 2020 6f75 742e 5f6e 616d          out._nam
-00027af0: 6520 3d20 7265 7375 6c74 2e6e 616d 650a  e = result.name.
-00027b00: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-00027b10: 7574 0a20 2020 2065 6c73 653a 0a20 2020  ut.    else:.   
-00027b20: 2020 2020 2072 6574 7572 6e20 7265 7375       return resu
-00027b30: 6c74 0a0a 0a64 6566 205f 656e 666f 7263  lt...def _enforc
-00027b40: 655f 6474 7970 6528 2a61 7267 732c 202a  e_dtype(*args, *
-00027b50: 2a6b 7761 7267 7329 3a0a 2020 2020 2222  *kwargs):.    ""
-00027b60: 2243 616c 6c73 2061 2066 756e 6374 696f  "Calls a functio
-00027b70: 6e20 616e 6420 636f 6e76 6572 7473 2069  n and converts i
-00027b80: 7473 2072 6573 756c 7420 746f 2074 6865  ts result to the
-00027b90: 2067 6976 656e 2064 7479 7065 2e0a 0a20   given dtype... 
-00027ba0: 2020 2054 6865 2070 6172 616d 6574 6572     The parameter
-00027bb0: 7320 6861 7665 2064 656c 6962 6572 6174  s have deliberat
-00027bc0: 656c 7920 6265 656e 2067 6976 656e 2075  ely been given u
-00027bd0: 6e77 6965 6c64 7920 6e61 6d65 7320 746f  nwieldy names to
-00027be0: 2061 766f 6964 0a20 2020 2063 6c61 7368   avoid.    clash
-00027bf0: 6573 2077 6974 6820 6b65 7977 6f72 6420  es with keyword 
-00027c00: 6172 6775 6d65 6e74 7320 636f 6e73 756d  arguments consum
-00027c10: 6564 2062 7920 626c 6f63 6b77 6973 650a  ed by blockwise.
-00027c20: 0a20 2020 2041 2064 7479 7065 206f 6620  .    A dtype of 
-00027c30: 606f 626a 6563 7460 2069 7320 7472 6561  `object` is trea
-00027c40: 7465 6420 6173 2061 2073 7065 6369 616c  ted as a special
-00027c50: 2063 6173 6520 616e 6420 6e6f 7420 656e   case and not en
-00027c60: 666f 7263 6564 2c0a 2020 2020 6265 6361  forced,.    beca
-00027c70: 7573 6520 6974 2069 7320 7573 6564 2061  use it is used a
-00027c80: 7320 6120 6475 6d6d 7920 7661 6c75 6520  s a dummy value 
-00027c90: 696e 2073 6f6d 6520 706c 6163 6573 2077  in some places w
-00027ca0: 6865 6e20 7468 6520 7265 7375 6c74 2077  hen the result w
-00027cb0: 696c 6c0a 2020 2020 6e6f 7420 6265 2061  ill.    not be a
-00027cc0: 2062 6c6f 636b 2069 6e20 616e 2041 7272   block in an Arr
-00027cd0: 6179 2e0a 0a20 2020 2050 6172 616d 6574  ay...    Paramet
-00027ce0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
-00027cf0: 2d2d 0a20 2020 2065 6e66 6f72 6365 5f64  --.    enforce_d
-00027d00: 7479 7065 203a 2064 7479 7065 0a20 2020  type : dtype.   
-00027d10: 2020 2020 2052 6573 756c 7420 6474 7970       Result dtyp
-00027d20: 650a 2020 2020 656e 666f 7263 655f 6474  e.    enforce_dt
-00027d30: 7970 655f 6675 6e63 7469 6f6e 203a 2063  ype_function : c
-00027d40: 616c 6c61 626c 650a 2020 2020 2020 2020  allable.        
-00027d50: 5468 6520 7772 6170 7065 6420 6675 6e63  The wrapped func
-00027d60: 7469 6f6e 2c20 7768 6963 6820 7769 6c6c  tion, which will
-00027d70: 2062 6520 7061 7373 6564 2074 6865 2072   be passed the r
-00027d80: 656d 6169 6e69 6e67 2061 7267 756d 656e  emaining argumen
-00027d90: 7473 0a20 2020 2022 2222 0a20 2020 2064  ts.    """.    d
-00027da0: 7479 7065 203d 206b 7761 7267 732e 706f  type = kwargs.po
-00027db0: 7028 2265 6e66 6f72 6365 5f64 7479 7065  p("enforce_dtype
-00027dc0: 2229 0a20 2020 2066 756e 6374 696f 6e20  ").    function 
-00027dd0: 3d20 6b77 6172 6773 2e70 6f70 2822 656e  = kwargs.pop("en
-00027de0: 666f 7263 655f 6474 7970 655f 6675 6e63  force_dtype_func
-00027df0: 7469 6f6e 2229 0a0a 2020 2020 7265 7375  tion")..    resu
-00027e00: 6c74 203d 2066 756e 6374 696f 6e28 2a61  lt = function(*a
-00027e10: 7267 732c 202a 2a6b 7761 7267 7329 0a20  rgs, **kwargs). 
-00027e20: 2020 2069 6620 6861 7361 7474 7228 7265     if hasattr(re
-00027e30: 7375 6c74 2c20 2264 7479 7065 2229 2061  sult, "dtype") a
-00027e40: 6e64 2064 7479 7065 2021 3d20 7265 7375  nd dtype != resu
-00027e50: 6c74 2e64 7479 7065 2061 6e64 2064 7479  lt.dtype and dty
-00027e60: 7065 2021 3d20 6f62 6a65 6374 3a0a 2020  pe != object:.  
-00027e70: 2020 2020 2020 6966 206e 6f74 206e 702e        if not np.
-00027e80: 6361 6e5f 6361 7374 2872 6573 756c 742c  can_cast(result,
-00027e90: 2064 7479 7065 2c20 6361 7374 696e 673d   dtype, casting=
-00027ea0: 2273 616d 655f 6b69 6e64 2229 3a0a 2020  "same_kind"):.  
-00027eb0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00027ec0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-00027ed0: 2020 2020 2020 2020 2020 2020 2249 6e66              "Inf
-00027ee0: 6572 7265 6420 6474 7970 6520 6672 6f6d  erred dtype from
-00027ef0: 2066 756e 6374 696f 6e20 2572 2077 6173   function %r was
-00027f00: 2025 7220 220a 2020 2020 2020 2020 2020   %r ".          
-00027f10: 2020 2020 2020 2262 7574 2067 6f74 2025        "but got %
-00027f20: 722c 2077 6869 6368 2063 616e 2774 2062  r, which can't b
-00027f30: 6520 6361 7374 2075 7369 6e67 2022 0a20  e cast using ". 
-00027f40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00027f50: 6361 7374 696e 673d 2773 616d 655f 6b69  casting='same_ki
-00027f60: 6e64 2722 0a20 2020 2020 2020 2020 2020  nd'".           
-00027f70: 2020 2020 2025 2028 6675 6e63 6e61 6d65       % (funcname
-00027f80: 2866 756e 6374 696f 6e29 2c20 7374 7228  (function), str(
-00027f90: 6474 7970 6529 2c20 7374 7228 7265 7375  dtype), str(resu
-00027fa0: 6c74 2e64 7479 7065 2929 0a20 2020 2020  lt.dtype)).     
-00027fb0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00027fc0: 2069 6620 6e70 2e69 7373 6361 6c61 7228   if np.isscalar(
-00027fd0: 7265 7375 6c74 293a 0a20 2020 2020 2020  result):.       
-00027fe0: 2020 2020 2023 2073 6361 6c61 7220 6173       # scalar as
-00027ff0: 7479 7065 206d 6574 686f 6420 646f 6573  type method does
-00028000: 6e27 7420 7461 6b65 2074 6865 206b 6579  n't take the key
-00028010: 776f 7264 2061 7267 756d 656e 7473 2c20  word arguments, 
-00028020: 736f 0a20 2020 2020 2020 2020 2020 2023  so.            #
-00028030: 2068 6176 6520 746f 2063 6f6e 7665 7274   have to convert
-00028040: 2076 6961 2030 2d64 696d 656e 7369 6f6e   via 0-dimension
-00028050: 616c 2061 7272 6179 2061 6e64 2062 6163  al array and bac
-00028060: 6b2e 0a20 2020 2020 2020 2020 2020 2072  k..            r
-00028070: 6573 756c 7420 3d20 7265 7375 6c74 2e61  esult = result.a
-00028080: 7374 7970 6528 6474 7970 6529 0a20 2020  stype(dtype).   
-00028090: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000280a0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-000280b0: 2020 2020 2020 2020 2020 2020 7265 7375              resu
-000280c0: 6c74 203d 2072 6573 756c 742e 6173 7479  lt = result.asty
-000280d0: 7065 2864 7479 7065 2c20 636f 7079 3d46  pe(dtype, copy=F
-000280e0: 616c 7365 290a 2020 2020 2020 2020 2020  alse).          
-000280f0: 2020 6578 6365 7074 2054 7970 6545 7272    except TypeErr
-00028100: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-00028110: 2020 2020 2320 4d69 7373 696e 6720 636f      # Missing co
-00028120: 7079 206b 7761 7267 0a20 2020 2020 2020  py kwarg.       
-00028130: 2020 2020 2020 2020 2072 6573 756c 7420           result 
-00028140: 3d20 7265 7375 6c74 2e61 7374 7970 6528  = result.astype(
-00028150: 6474 7970 6529 0a20 2020 2072 6574 7572  dtype).    retur
-00028160: 6e20 7265 7375 6c74 0a0a 0a64 6566 2062  n result...def b
-00028170: 726f 6164 6361 7374 5f74 6f28 782c 2073  roadcast_to(x, s
-00028180: 6861 7065 2c20 6368 756e 6b73 3d4e 6f6e  hape, chunks=Non
-00028190: 652c 206d 6574 613d 4e6f 6e65 293a 0a20  e, meta=None):. 
-000281a0: 2020 2022 2222 4272 6f61 6463 6173 7420     """Broadcast 
-000281b0: 616e 2061 7272 6179 2074 6f20 6120 6e65  an array to a ne
-000281c0: 7720 7368 6170 652e 0a0a 2020 2020 5061  w shape...    Pa
-000281d0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
-000281e0: 2d2d 2d2d 2d2d 2d0a 2020 2020 7820 3a20  -------.    x : 
-000281f0: 6172 7261 795f 6c69 6b65 0a20 2020 2020  array_like.     
-00028200: 2020 2054 6865 2061 7272 6179 2074 6f20     The array to 
-00028210: 6272 6f61 6463 6173 742e 0a20 2020 2073  broadcast..    s
-00028220: 6861 7065 203a 2074 7570 6c65 0a20 2020  hape : tuple.   
-00028230: 2020 2020 2054 6865 2073 6861 7065 206f       The shape o
-00028240: 6620 7468 6520 6465 7369 7265 6420 6172  f the desired ar
-00028250: 7261 792e 0a20 2020 2063 6875 6e6b 7320  ray..    chunks 
-00028260: 3a20 7475 706c 652c 206f 7074 696f 6e61  : tuple, optiona
-00028270: 6c0a 2020 2020 2020 2020 4966 2070 726f  l.        If pro
-00028280: 7669 6465 642c 2074 6865 6e20 7468 6520  vided, then the 
-00028290: 7265 7375 6c74 2077 696c 6c20 7573 6520  result will use 
-000282a0: 7468 6573 6520 6368 756e 6b73 2069 6e73  these chunks ins
-000282b0: 7465 6164 206f 6620 7468 6520 7361 6d65  tead of the same
-000282c0: 0a20 2020 2020 2020 2063 6875 6e6b 7320  .        chunks 
-000282d0: 6173 2074 6865 2073 6f75 7263 6520 6172  as the source ar
-000282e0: 7261 792e 2053 6574 7469 6e67 2063 6875  ray. Setting chu
-000282f0: 6e6b 7320 6578 706c 6963 6974 6c79 2061  nks explicitly a
-00028300: 7320 7061 7274 206f 660a 2020 2020 2020  s part of.      
-00028310: 2020 6272 6f61 6463 6173 745f 746f 2069    broadcast_to i
-00028320: 7320 6d6f 7265 2065 6666 6963 6965 6e74  s more efficient
-00028330: 2074 6861 6e20 7265 6368 756e 6b69 6e67   than rechunking
-00028340: 2061 6674 6572 7761 7264 732e 2043 6875   afterwards. Chu
-00028350: 6e6b 7320 6172 650a 2020 2020 2020 2020  nks are.        
-00028360: 6f6e 6c79 2061 6c6c 6f77 6564 2074 6f20  only allowed to 
-00028370: 6469 6666 6572 2066 726f 6d20 7468 6520  differ from the 
-00028380: 6f72 6967 696e 616c 2073 6861 7065 2061  original shape a
-00028390: 6c6f 6e67 2064 696d 656e 7369 6f6e 7320  long dimensions 
-000283a0: 7468 6174 0a20 2020 2020 2020 2061 7265  that.        are
-000283b0: 206e 6577 206f 6e20 7468 6520 7265 7375   new on the resu
-000283c0: 6c74 206f 7220 6861 7665 2073 697a 6520  lt or have size 
-000283d0: 3120 7468 6520 696e 7075 7420 6172 7261  1 the input arra
-000283e0: 792e 0a20 2020 206d 6574 6120 3a20 656d  y..    meta : em
-000283f0: 7074 7920 6e64 6172 7261 790a 2020 2020  pty ndarray.    
-00028400: 2020 2020 656d 7074 7920 6e64 6172 7261      empty ndarra
-00028410: 7920 6372 6561 7465 6420 7769 7468 2073  y created with s
-00028420: 616d 6520 4e75 6d50 7920 6261 636b 656e  ame NumPy backen
-00028430: 642c 206e 6469 6d20 616e 6420 6474 7970  d, ndim and dtyp
-00028440: 6520 6173 2074 6865 0a20 2020 2020 2020  e as the.       
-00028450: 2044 6173 6b20 4172 7261 7920 6265 696e   Dask Array bein
-00028460: 6720 6372 6561 7465 6420 286f 7665 7272  g created (overr
-00028470: 6964 6573 2064 7479 7065 290a 0a20 2020  ides dtype)..   
-00028480: 2052 6574 7572 6e73 0a20 2020 202d 2d2d   Returns.    ---
-00028490: 2d2d 2d2d 0a20 2020 2062 726f 6164 6361  ----.    broadca
-000284a0: 7374 203a 2064 6173 6b20 6172 7261 790a  st : dask array.
-000284b0: 0a20 2020 2053 6565 2041 6c73 6f0a 2020  .    See Also.  
-000284c0: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203a    --------.    :
-000284d0: 6675 6e63 3a60 6e75 6d70 792e 6272 6f61  func:`numpy.broa
-000284e0: 6463 6173 745f 746f 600a 2020 2020 2222  dcast_to`.    ""
-000284f0: 220a 2020 2020 7820 3d20 6173 6172 7261  ".    x = asarra
-00028500: 7928 7829 0a20 2020 2073 6861 7065 203d  y(x).    shape =
-00028510: 2074 7570 6c65 2873 6861 7065 290a 0a20   tuple(shape).. 
-00028520: 2020 2069 6620 6d65 7461 2069 7320 4e6f     if meta is No
-00028530: 6e65 3a0a 2020 2020 2020 2020 6d65 7461  ne:.        meta
-00028540: 203d 206d 6574 615f 6672 6f6d 5f61 7272   = meta_from_arr
-00028550: 6179 2878 290a 0a20 2020 2069 6620 782e  ay(x)..    if x.
-00028560: 7368 6170 6520 3d3d 2073 6861 7065 2061  shape == shape a
-00028570: 6e64 2028 6368 756e 6b73 2069 7320 4e6f  nd (chunks is No
-00028580: 6e65 206f 7220 6368 756e 6b73 203d 3d20  ne or chunks == 
-00028590: 782e 6368 756e 6b73 293a 0a20 2020 2020  x.chunks):.     
-000285a0: 2020 2072 6574 7572 6e20 780a 0a20 2020     return x..   
-000285b0: 206e 6469 6d5f 6e65 7720 3d20 6c65 6e28   ndim_new = len(
-000285c0: 7368 6170 6529 202d 2078 2e6e 6469 6d0a  shape) - x.ndim.
-000285d0: 2020 2020 6966 206e 6469 6d5f 6e65 7720      if ndim_new 
-000285e0: 3c20 3020 6f72 2061 6e79 280a 2020 2020  < 0 or any(.    
-000285f0: 2020 2020 6e65 7720 213d 206f 6c64 2066      new != old f
-00028600: 6f72 206e 6577 2c20 6f6c 6420 696e 207a  or new, old in z
-00028610: 6970 2873 6861 7065 5b6e 6469 6d5f 6e65  ip(shape[ndim_ne
-00028620: 773a 5d2c 2078 2e73 6861 7065 2920 6966  w:], x.shape) if
-00028630: 206f 6c64 2021 3d20 310a 2020 2020 293a   old != 1.    ):
-00028640: 0a20 2020 2020 2020 2072 6169 7365 2056  .        raise V
-00028650: 616c 7565 4572 726f 7228 6622 6361 6e6e  alueError(f"cann
-00028660: 6f74 2062 726f 6164 6361 7374 2073 6861  ot broadcast sha
-00028670: 7065 207b 782e 7368 6170 657d 2074 6f20  pe {x.shape} to 
-00028680: 7368 6170 6520 7b73 6861 7065 7d22 290a  shape {shape}").
-00028690: 0a20 2020 2069 6620 6368 756e 6b73 2069  .    if chunks i
-000286a0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-000286b0: 6368 756e 6b73 203d 2074 7570 6c65 2828  chunks = tuple((
-000286c0: 732c 2920 666f 7220 7320 696e 2073 6861  s,) for s in sha
-000286d0: 7065 5b3a 6e64 696d 5f6e 6577 5d29 202b  pe[:ndim_new]) +
-000286e0: 2074 7570 6c65 280a 2020 2020 2020 2020   tuple(.        
-000286f0: 2020 2020 6264 2069 6620 6f6c 6420 3e20      bd if old > 
-00028700: 3120 656c 7365 2028 6e65 772c 290a 2020  1 else (new,).  
-00028710: 2020 2020 2020 2020 2020 666f 7220 6264            for bd
-00028720: 2c20 6f6c 642c 206e 6577 2069 6e20 7a69  , old, new in zi
-00028730: 7028 782e 6368 756e 6b73 2c20 782e 7368  p(x.chunks, x.sh
-00028740: 6170 652c 2073 6861 7065 5b6e 6469 6d5f  ape, shape[ndim_
-00028750: 6e65 773a 5d29 0a20 2020 2020 2020 2029  new:]).        )
-00028760: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
-00028770: 2020 2063 6875 6e6b 7320 3d20 6e6f 726d     chunks = norm
-00028780: 616c 697a 655f 6368 756e 6b73 280a 2020  alize_chunks(.  
-00028790: 2020 2020 2020 2020 2020 6368 756e 6b73            chunks
-000287a0: 2c20 7368 6170 652c 2064 7479 7065 3d78  , shape, dtype=x
-000287b0: 2e64 7479 7065 2c20 7072 6576 696f 7573  .dtype, previous
-000287c0: 5f63 6875 6e6b 733d 782e 6368 756e 6b73  _chunks=x.chunks
-000287d0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
-000287e0: 2020 2066 6f72 206f 6c64 5f62 642c 206e     for old_bd, n
-000287f0: 6577 5f62 6420 696e 207a 6970 2878 2e63  ew_bd in zip(x.c
-00028800: 6875 6e6b 732c 2063 6875 6e6b 735b 6e64  hunks, chunks[nd
-00028810: 696d 5f6e 6577 3a5d 293a 0a20 2020 2020  im_new:]):.     
-00028820: 2020 2020 2020 2069 6620 6f6c 645f 6264         if old_bd
-00028830: 2021 3d20 6e65 775f 6264 2061 6e64 206f   != new_bd and o
-00028840: 6c64 5f62 6420 213d 2028 312c 293a 0a20  ld_bd != (1,):. 
-00028850: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00028860: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-00028870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00028880: 2020 2020 2022 6361 6e6e 6f74 2062 726f       "cannot bro
-00028890: 6164 6361 7374 2063 6875 6e6b 7320 2573  adcast chunks %s
-000288a0: 2074 6f20 6368 756e 6b73 2025 733a 2022   to chunks %s: "
-000288b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000288c0: 2020 2020 2022 6e65 7720 6368 756e 6b73       "new chunks
-000288d0: 206d 7573 7420 6569 7468 6572 2062 6520   must either be 
-000288e0: 616c 6f6e 6720 6120 6e65 7720 220a 2020  along a new ".  
+0001e260: 2274 6865 2064 6973 7472 6962 7574 6564  "the distributed
+0001e270: 2073 6368 6564 756c 6572 2e22 0a20 2020   scheduler.".   
+0001e280: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+0001e290: 2020 2020 2020 2020 6966 2072 6567 696f          if regio
+0001e2a0: 6e20 6973 204e 6f6e 653a 0a20 2020 2020  n is None:.     
+0001e2b0: 2020 2020 2020 2061 7272 203d 2061 7272         arr = arr
+0001e2c0: 2e72 6563 6875 6e6b 287a 2e63 6875 6e6b  .rechunk(z.chunk
+0001e2d0: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
+0001e2e0: 6567 696f 6e73 203d 204e 6f6e 650a 2020  egions = None.  
+0001e2f0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0001e300: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+0001e310: 6b2e 6172 7261 792e 736c 6963 696e 6720  k.array.slicing 
+0001e320: 696d 706f 7274 206e 6577 5f62 6c6f 636b  import new_block
+0001e330: 6469 6d2c 206e 6f72 6d61 6c69 7a65 5f69  dim, normalize_i
+0001e340: 6e64 6578 0a0a 2020 2020 2020 2020 2020  ndex..          
+0001e350: 2020 6f6c 645f 6368 756e 6b73 203d 206e    old_chunks = n
+0001e360: 6f72 6d61 6c69 7a65 5f63 6875 6e6b 7328  ormalize_chunks(
+0001e370: 7a2e 6368 756e 6b73 2c20 7a2e 7368 6170  z.chunks, z.shap
+0001e380: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
+0001e390: 6e64 6578 203d 206e 6f72 6d61 6c69 7a65  ndex = normalize
+0001e3a0: 5f69 6e64 6578 2872 6567 696f 6e2c 207a  _index(region, z
+0001e3b0: 2e73 6861 7065 290a 2020 2020 2020 2020  .shape).        
+0001e3c0: 2020 2020 6368 756e 6b73 203d 2074 7570      chunks = tup
+0001e3d0: 6c65 280a 2020 2020 2020 2020 2020 2020  le(.            
+0001e3e0: 2020 2020 7475 706c 6528 6e65 775f 626c      tuple(new_bl
+0001e3f0: 6f63 6b64 696d 2873 2c20 632c 2072 2929  ockdim(s, c, r))
+0001e400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e410: 2066 6f72 2073 2c20 632c 2072 2069 6e20   for s, c, r in 
+0001e420: 7a69 7028 7a2e 7368 6170 652c 206f 6c64  zip(z.shape, old
+0001e430: 5f63 6875 6e6b 732c 2069 6e64 6578 290a  _chunks, index).
+0001e440: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001e450: 2020 2020 2020 2020 2020 6172 7220 3d20            arr = 
+0001e460: 6172 722e 7265 6368 756e 6b28 6368 756e  arr.rechunk(chun
+0001e470: 6b73 290a 2020 2020 2020 2020 2020 2020  ks).            
+0001e480: 7265 6769 6f6e 7320 3d20 5b72 6567 696f  regions = [regio
+0001e490: 6e5d 0a20 2020 2020 2020 2072 6574 7572  n].        retur
+0001e4a0: 6e20 6172 722e 7374 6f72 6528 0a20 2020  n arr.store(.   
+0001e4b0: 2020 2020 2020 2020 207a 2c20 6c6f 636b           z, lock
+0001e4c0: 3d46 616c 7365 2c20 7265 6769 6f6e 733d  =False, regions=
+0001e4d0: 7265 6769 6f6e 732c 2063 6f6d 7075 7465  regions, compute
+0001e4e0: 3d63 6f6d 7075 7465 2c20 7265 7475 726e  =compute, return
+0001e4f0: 5f73 746f 7265 643d 7265 7475 726e 5f73  _stored=return_s
+0001e500: 746f 7265 640a 2020 2020 2020 2020 290a  tored.        ).
+0001e510: 0a20 2020 2069 6620 7265 6769 6f6e 2069  .    if region i
+0001e520: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
+0001e530: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0001e540: 7272 6f72 2822 4361 6e6e 6f74 2075 7365  rror("Cannot use
+0001e550: 2060 7265 6769 6f6e 6020 6b65 7977 6f72   `region` keywor
+0001e560: 6420 7768 656e 2075 726c 2069 7320 6e6f  d when url is no
+0001e570: 7420 6120 607a 6172 722e 4172 7261 7960  t a `zarr.Array`
+0001e580: 2e22 290a 0a20 2020 2069 6620 6e6f 7420  .")..    if not 
+0001e590: 5f63 6865 636b 5f72 6567 756c 6172 5f63  _check_regular_c
+0001e5a0: 6875 6e6b 7328 6172 722e 6368 756e 6b73  hunks(arr.chunks
+0001e5b0: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
+0001e5c0: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0001e5d0: 2020 2020 2020 2020 2022 4174 7465 6d70           "Attemp
+0001e5e0: 7420 746f 2073 6176 6520 6172 7261 7920  t to save array 
+0001e5f0: 746f 207a 6172 7220 7769 7468 2069 7272  to zarr with irr
+0001e600: 6567 756c 6172 2022 0a20 2020 2020 2020  egular ".       
+0001e610: 2020 2020 2022 6368 756e 6b69 6e67 2c20       "chunking, 
+0001e620: 706c 6561 7365 2063 616c 6c20 6061 7272  please call `arr
+0001e630: 2e72 6563 6875 6e6b 282e 2e2e 2960 2066  .rechunk(...)` f
+0001e640: 6972 7374 2e22 0a20 2020 2020 2020 2029  irst.".        )
+0001e650: 0a0a 2020 2020 7374 6f72 6167 655f 6f70  ..    storage_op
+0001e660: 7469 6f6e 7320 3d20 7374 6f72 6167 655f  tions = storage_
+0001e670: 6f70 7469 6f6e 7320 6f72 207b 7d0a 0a20  options or {}.. 
+0001e680: 2020 2069 6620 7374 6f72 6167 655f 6f70     if storage_op
+0001e690: 7469 6f6e 733a 0a20 2020 2020 2020 2073  tions:.        s
+0001e6a0: 746f 7265 203d 207a 6172 722e 7374 6f72  tore = zarr.stor
+0001e6b0: 6167 652e 4653 5374 6f72 6528 7572 6c2c  age.FSStore(url,
+0001e6c0: 202a 2a73 746f 7261 6765 5f6f 7074 696f   **storage_optio
+0001e6d0: 6e73 290a 2020 2020 656c 7365 3a0a 2020  ns).    else:.  
+0001e6e0: 2020 2020 2020 7374 6f72 6520 3d20 7572        store = ur
+0001e6f0: 6c0a 0a20 2020 2063 6875 6e6b 7320 3d20  l..    chunks = 
+0001e700: 5b63 5b30 5d20 666f 7220 6320 696e 2061  [c[0] for c in a
+0001e710: 7272 2e63 6875 6e6b 735d 0a0a 2020 2020  rr.chunks]..    
+0001e720: 7a20 3d20 7a61 7272 2e63 7265 6174 6528  z = zarr.create(
+0001e730: 0a20 2020 2020 2020 2073 6861 7065 3d61  .        shape=a
+0001e740: 7272 2e73 6861 7065 2c0a 2020 2020 2020  rr.shape,.      
+0001e750: 2020 6368 756e 6b73 3d63 6875 6e6b 732c    chunks=chunks,
+0001e760: 0a20 2020 2020 2020 2064 7479 7065 3d61  .        dtype=a
+0001e770: 7272 2e64 7479 7065 2c0a 2020 2020 2020  rr.dtype,.      
+0001e780: 2020 7374 6f72 653d 7374 6f72 652c 0a20    store=store,. 
+0001e790: 2020 2020 2020 2070 6174 683d 636f 6d70         path=comp
+0001e7a0: 6f6e 656e 742c 0a20 2020 2020 2020 206f  onent,.        o
+0001e7b0: 7665 7277 7269 7465 3d6f 7665 7277 7269  verwrite=overwri
+0001e7c0: 7465 2c0a 2020 2020 2020 2020 2a2a 6b77  te,.        **kw
+0001e7d0: 6172 6773 2c0a 2020 2020 290a 2020 2020  args,.    ).    
+0001e7e0: 7265 7475 726e 2061 7272 2e73 746f 7265  return arr.store
+0001e7f0: 287a 2c20 6c6f 636b 3d46 616c 7365 2c20  (z, lock=False, 
+0001e800: 636f 6d70 7574 653d 636f 6d70 7574 652c  compute=compute,
+0001e810: 2072 6574 7572 6e5f 7374 6f72 6564 3d72   return_stored=r
+0001e820: 6574 7572 6e5f 7374 6f72 6564 290a 0a0a  eturn_stored)...
+0001e830: 6465 6620 5f63 6865 636b 5f72 6567 756c  def _check_regul
+0001e840: 6172 5f63 6875 6e6b 7328 6368 756e 6b73  ar_chunks(chunks
+0001e850: 6574 293a 0a20 2020 2022 2222 4368 6563  et):.    """Chec
+0001e860: 6b20 6966 2074 6865 2063 6875 6e6b 7320  k if the chunks 
+0001e870: 6172 6520 7265 6775 6c61 720a 0a20 2020  are regular..   
+0001e880: 2022 5265 6775 6c61 7222 2069 6e20 7468   "Regular" in th
+0001e890: 6973 2063 6f6e 7465 7874 206d 6561 6e73  is context means
+0001e8a0: 2074 6861 7420 616c 6f6e 6720 6576 6572   that along ever
+0001e8b0: 7920 6178 6973 2c20 7468 6520 6368 756e  y axis, the chun
+0001e8c0: 6b73 2061 6c6c 0a20 2020 2068 6176 6520  ks all.    have 
+0001e8d0: 7468 6520 7361 6d65 2073 697a 652c 2065  the same size, e
+0001e8e0: 7863 6570 7420 7468 6520 6c61 7374 206f  xcept the last o
+0001e8f0: 6e65 2c20 7768 6963 6820 6d61 7920 6265  ne, which may be
+0001e900: 2073 6d61 6c6c 6572 0a0a 2020 2020 5061   smaller..    Pa
+0001e910: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+0001e920: 2d2d 2d2d 2d2d 2d0a 2020 2020 6368 756e  -------.    chun
+0001e930: 6b73 6574 3a20 7475 706c 6520 6f66 2074  kset: tuple of t
+0001e940: 7570 6c65 7320 6f66 2069 6e74 730a 2020  uples of ints.  
+0001e950: 2020 2020 2020 4672 6f6d 2074 6865 2060        From the `
+0001e960: 602e 6368 756e 6b73 6060 2061 7474 7269  `.chunks`` attri
+0001e970: 6275 7465 206f 6620 616e 2060 6041 7272  bute of an ``Arr
+0001e980: 6179 6060 0a0a 2020 2020 5265 7475 726e  ay``..    Return
+0001e990: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+0001e9a0: 2020 5472 7565 2069 6620 6368 756e 6b73    True if chunks
+0001e9b0: 6574 2070 6173 7365 732c 2065 6c73 6520  et passes, else 
+0001e9c0: 4661 6c73 650a 0a20 2020 2045 7861 6d70  False..    Examp
+0001e9d0: 6c65 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  les.    --------
+0001e9e0: 0a20 2020 203e 3e3e 2069 6d70 6f72 7420  .    >>> import 
+0001e9f0: 6461 736b 2e61 7272 6179 2061 7320 6461  dask.array as da
+0001ea00: 0a20 2020 203e 3e3e 2061 7272 203d 2064  .    >>> arr = d
+0001ea10: 612e 7a65 726f 7328 3130 2c20 6368 756e  a.zeros(10, chun
+0001ea20: 6b73 3d28 352c 2029 290a 2020 2020 3e3e  ks=(5, )).    >>
+0001ea30: 3e20 5f63 6865 636b 5f72 6567 756c 6172  > _check_regular
+0001ea40: 5f63 6875 6e6b 7328 6172 722e 6368 756e  _chunks(arr.chun
+0001ea50: 6b73 290a 2020 2020 5472 7565 0a0a 2020  ks).    True..  
+0001ea60: 2020 3e3e 3e20 6172 7220 3d20 6461 2e7a    >>> arr = da.z
+0001ea70: 6572 6f73 2831 302c 2063 6875 6e6b 733d  eros(10, chunks=
+0001ea80: 2828 332c 2033 2c20 332c 2031 292c 2029  ((3, 3, 3, 1), )
+0001ea90: 290a 2020 2020 3e3e 3e20 5f63 6865 636b  ).    >>> _check
+0001eaa0: 5f72 6567 756c 6172 5f63 6875 6e6b 7328  _regular_chunks(
+0001eab0: 6172 722e 6368 756e 6b73 290a 2020 2020  arr.chunks).    
+0001eac0: 5472 7565 0a0a 2020 2020 3e3e 3e20 6172  True..    >>> ar
+0001ead0: 7220 3d20 6461 2e7a 6572 6f73 2831 302c  r = da.zeros(10,
+0001eae0: 2063 6875 6e6b 733d 2828 332c 2031 2c20   chunks=((3, 1, 
+0001eaf0: 332c 2033 292c 2029 290a 2020 2020 3e3e  3, 3), )).    >>
+0001eb00: 3e20 5f63 6865 636b 5f72 6567 756c 6172  > _check_regular
+0001eb10: 5f63 6875 6e6b 7328 6172 722e 6368 756e  _chunks(arr.chun
+0001eb20: 6b73 290a 2020 2020 4661 6c73 650a 2020  ks).    False.  
+0001eb30: 2020 2222 220a 2020 2020 666f 7220 6368    """.    for ch
+0001eb40: 756e 6b73 2069 6e20 6368 756e 6b73 6574  unks in chunkset
+0001eb50: 3a0a 2020 2020 2020 2020 6966 206c 656e  :.        if len
+0001eb60: 2863 6875 6e6b 7329 203d 3d20 313a 0a20  (chunks) == 1:. 
+0001eb70: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+0001eb80: 6e75 650a 2020 2020 2020 2020 6966 206c  nue.        if l
+0001eb90: 656e 2873 6574 2863 6875 6e6b 735b 3a2d  en(set(chunks[:-
+0001eba0: 315d 2929 203e 2031 3a0a 2020 2020 2020  1])) > 1:.      
+0001ebb0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+0001ebc0: 7365 0a20 2020 2020 2020 2069 6620 6368  se.        if ch
+0001ebd0: 756e 6b73 5b2d 315d 203e 2063 6875 6e6b  unks[-1] > chunk
+0001ebe0: 735b 305d 3a0a 2020 2020 2020 2020 2020  s[0]:.          
+0001ebf0: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+0001ec00: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
+0001ec10: 0a64 6566 2066 726f 6d5f 6465 6c61 7965  .def from_delaye
+0001ec20: 6428 7661 6c75 652c 2073 6861 7065 2c20  d(value, shape, 
+0001ec30: 6474 7970 653d 4e6f 6e65 2c20 6d65 7461  dtype=None, meta
+0001ec40: 3d4e 6f6e 652c 206e 616d 653d 4e6f 6e65  =None, name=None
+0001ec50: 293a 0a20 2020 2022 2222 4372 6561 7465  ):.    """Create
+0001ec60: 2061 2064 6173 6b20 6172 7261 7920 6672   a dask array fr
+0001ec70: 6f6d 2061 2064 6173 6b20 6465 6c61 7965  om a dask delaye
+0001ec80: 6420 7661 6c75 650a 0a20 2020 2054 6869  d value..    Thi
+0001ec90: 7320 726f 7574 696e 6520 6973 2075 7365  s routine is use
+0001eca0: 6675 6c20 666f 7220 636f 6e73 7472 7563  ful for construc
+0001ecb0: 7469 6e67 2064 6173 6b20 6172 7261 7973  ting dask arrays
+0001ecc0: 2069 6e20 616e 2061 642d 686f 6320 6661   in an ad-hoc fa
+0001ecd0: 7368 696f 6e0a 2020 2020 7573 696e 6720  shion.    using 
+0001ece0: 6461 736b 2064 656c 6179 6564 2c20 7061  dask delayed, pa
+0001ecf0: 7274 6963 756c 6172 6c79 2077 6865 6e20  rticularly when 
+0001ed00: 636f 6d62 696e 6564 2077 6974 6820 7374  combined with st
+0001ed10: 6163 6b20 616e 6420 636f 6e63 6174 656e  ack and concaten
+0001ed20: 6174 652e 0a0a 2020 2020 5468 6520 6461  ate...    The da
+0001ed30: 736b 2061 7272 6179 2077 696c 6c20 636f  sk array will co
+0001ed40: 6e73 6973 7420 6f66 2061 2073 696e 676c  nsist of a singl
+0001ed50: 6520 6368 756e 6b2e 0a0a 2020 2020 4578  e chunk...    Ex
+0001ed60: 616d 706c 6573 0a20 2020 202d 2d2d 2d2d  amples.    -----
+0001ed70: 2d2d 2d0a 2020 2020 3e3e 3e20 696d 706f  ---.    >>> impo
+0001ed80: 7274 2064 6173 6b0a 2020 2020 3e3e 3e20  rt dask.    >>> 
+0001ed90: 696d 706f 7274 2064 6173 6b2e 6172 7261  import dask.arra
+0001eda0: 7920 6173 2064 610a 2020 2020 3e3e 3e20  y as da.    >>> 
+0001edb0: 696d 706f 7274 206e 756d 7079 2061 7320  import numpy as 
+0001edc0: 6e70 0a20 2020 203e 3e3e 2076 616c 7565  np.    >>> value
+0001edd0: 203d 2064 6173 6b2e 6465 6c61 7965 6428   = dask.delayed(
+0001ede0: 6e70 2e6f 6e65 7329 2835 290a 2020 2020  np.ones)(5).    
+0001edf0: 3e3e 3e20 6172 7261 7920 3d20 6461 2e66  >>> array = da.f
+0001ee00: 726f 6d5f 6465 6c61 7965 6428 7661 6c75  rom_delayed(valu
+0001ee10: 652c 2028 352c 292c 2064 7479 7065 3d66  e, (5,), dtype=f
+0001ee20: 6c6f 6174 290a 2020 2020 3e3e 3e20 6172  loat).    >>> ar
+0001ee30: 7261 790a 2020 2020 6461 736b 2e61 7272  ray.    dask.arr
+0001ee40: 6179 3c66 726f 6d2d 7661 6c75 652c 2073  ay<from-value, s
+0001ee50: 6861 7065 3d28 352c 292c 2064 7479 7065  hape=(5,), dtype
+0001ee60: 3d66 6c6f 6174 3634 2c20 6368 756e 6b73  =float64, chunks
+0001ee70: 697a 653d 2835 2c29 2c20 6368 756e 6b74  ize=(5,), chunkt
+0001ee80: 7970 653d 6e75 6d70 792e 6e64 6172 7261  ype=numpy.ndarra
+0001ee90: 793e 0a20 2020 203e 3e3e 2061 7272 6179  y>.    >>> array
+0001eea0: 2e63 6f6d 7075 7465 2829 0a20 2020 2061  .compute().    a
+0001eeb0: 7272 6179 285b 312e 2c20 312e 2c20 312e  rray([1., 1., 1.
+0001eec0: 2c20 312e 2c20 312e 5d29 0a20 2020 2022  , 1., 1.]).    "
+0001eed0: 2222 0a20 2020 2066 726f 6d20 6461 736b  "".    from dask
+0001eee0: 2e64 656c 6179 6564 2069 6d70 6f72 7420  .delayed import 
+0001eef0: 4465 6c61 7965 642c 2064 656c 6179 6564  Delayed, delayed
+0001ef00: 0a0a 2020 2020 6966 206e 6f74 2069 7369  ..    if not isi
+0001ef10: 6e73 7461 6e63 6528 7661 6c75 652c 2044  nstance(value, D
+0001ef20: 656c 6179 6564 2920 616e 6420 6861 7361  elayed) and hasa
+0001ef30: 7474 7228 7661 6c75 652c 2022 6b65 7922  ttr(value, "key"
+0001ef40: 293a 0a20 2020 2020 2020 2076 616c 7565  ):.        value
+0001ef50: 203d 2064 656c 6179 6564 2876 616c 7565   = delayed(value
+0001ef60: 290a 0a20 2020 206e 616d 6520 3d20 6e61  )..    name = na
+0001ef70: 6d65 206f 7220 2266 726f 6d2d 7661 6c75  me or "from-valu
+0001ef80: 652d 2220 2b20 746f 6b65 6e69 7a65 2876  e-" + tokenize(v
+0001ef90: 616c 7565 2c20 7368 6170 652c 2064 7479  alue, shape, dty
+0001efa0: 7065 2c20 6d65 7461 290a 2020 2020 6473  pe, meta).    ds
+0001efb0: 6b20 3d20 7b28 6e61 6d65 2c29 202b 2028  k = {(name,) + (
+0001efc0: 302c 2920 2a20 6c65 6e28 7368 6170 6529  0,) * len(shape)
+0001efd0: 3a20 7661 6c75 652e 6b65 797d 0a20 2020  : value.key}.   
+0001efe0: 2063 6875 6e6b 7320 3d20 7475 706c 6528   chunks = tuple(
+0001eff0: 2864 2c29 2066 6f72 2064 2069 6e20 7368  (d,) for d in sh
+0001f000: 6170 6529 0a20 2020 2023 2054 4f44 4f3a  ape).    # TODO:
+0001f010: 2076 616c 7565 2e5f 6b65 7920 6d61 7920   value._key may 
+0001f020: 6e6f 7420 6265 2074 6865 206e 616d 6520  not be the name 
+0001f030: 6f66 2074 6865 206c 6179 6572 2069 6e20  of the layer in 
+0001f040: 7661 6c75 652e 6461 736b 0a20 2020 2023  value.dask.    #
+0001f050: 2054 6869 7320 7368 6f75 6c64 2062 6520   This should be 
+0001f060: 6669 7865 6420 6166 7465 7220 7765 2062  fixed after we b
+0001f070: 7569 6c64 2066 756c 6c20 6578 7072 6573  uild full expres
+0001f080: 7369 6f6e 2067 7261 7068 730a 2020 2020  sion graphs.    
+0001f090: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
+0001f0a0: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
+0001f0b0: 6563 7469 6f6e 7328 6e61 6d65 2c20 6473  ections(name, ds
+0001f0c0: 6b2c 2064 6570 656e 6465 6e63 6965 733d  k, dependencies=
+0001f0d0: 5b76 616c 7565 5d29 0a20 2020 2072 6574  [value]).    ret
+0001f0e0: 7572 6e20 4172 7261 7928 6772 6170 682c  urn Array(graph,
+0001f0f0: 206e 616d 652c 2063 6875 6e6b 732c 2064   name, chunks, d
+0001f100: 7479 7065 3d64 7479 7065 2c20 6d65 7461  type=dtype, meta
+0001f110: 3d6d 6574 6129 0a0a 0a64 6566 2066 726f  =meta)...def fro
+0001f120: 6d5f 6675 6e63 2866 756e 632c 2073 6861  m_func(func, sha
+0001f130: 7065 2c20 6474 7970 653d 4e6f 6e65 2c20  pe, dtype=None, 
+0001f140: 6e61 6d65 3d4e 6f6e 652c 2061 7267 733d  name=None, args=
+0001f150: 2829 2c20 6b77 6172 6773 3d4e 6f6e 6529  (), kwargs=None)
+0001f160: 3a0a 2020 2020 2222 2243 7265 6174 6520  :.    """Create 
+0001f170: 6461 736b 2061 7272 6179 2069 6e20 6120  dask array in a 
+0001f180: 7369 6e67 6c65 2062 6c6f 636b 2062 7920  single block by 
+0001f190: 6361 6c6c 696e 6720 6120 6675 6e63 7469  calling a functi
+0001f1a0: 6f6e 0a0a 2020 2020 4361 6c6c 696e 6720  on..    Calling 
+0001f1b0: 7468 6520 7072 6f76 6964 6564 2066 756e  the provided fun
+0001f1c0: 6374 696f 6e20 7769 7468 2066 756e 6328  ction with func(
+0001f1d0: 2a61 7267 732c 202a 2a6b 7761 7267 7329  *args, **kwargs)
+0001f1e0: 2073 686f 756c 6420 7265 7475 726e 2061   should return a
+0001f1f0: 0a20 2020 204e 756d 5079 2061 7272 6179  .    NumPy array
+0001f200: 206f 6620 7468 6520 696e 6469 6361 7465   of the indicate
+0001f210: 6420 7368 6170 6520 616e 6420 6474 7970  d shape and dtyp
+0001f220: 652e 0a0a 2020 2020 4578 616d 706c 6573  e...    Examples
+0001f230: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 0a20  .    --------.. 
+0001f240: 2020 203e 3e3e 2061 203d 2066 726f 6d5f     >>> a = from_
+0001f250: 6675 6e63 286e 702e 6172 616e 6765 2c20  func(np.arange, 
+0001f260: 2833 2c29 2c20 6474 7970 653d 2769 3827  (3,), dtype='i8'
+0001f270: 2c20 6172 6773 3d28 332c 2929 0a20 2020  , args=(3,)).   
+0001f280: 203e 3e3e 2061 2e63 6f6d 7075 7465 2829   >>> a.compute()
+0001f290: 0a20 2020 2061 7272 6179 285b 302c 2031  .    array([0, 1
+0001f2a0: 2c20 325d 290a 0a20 2020 2054 6869 7320  , 2])..    This 
+0001f2b0: 776f 726b 7320 7061 7274 6963 756c 6172  works particular
+0001f2c0: 6c79 2077 656c 6c20 7768 656e 2063 6f75  ly well when cou
+0001f2d0: 706c 6564 2077 6974 6820 6461 736b 2e61  pled with dask.a
+0001f2e0: 7272 6179 2066 756e 6374 696f 6e73 206c  rray functions l
+0001f2f0: 696b 650a 2020 2020 636f 6e63 6174 656e  ike.    concaten
+0001f300: 6174 6520 616e 6420 7374 6163 6b3a 0a0a  ate and stack:..
+0001f310: 2020 2020 3e3e 3e20 6172 7261 7973 203d      >>> arrays =
+0001f320: 205b 6672 6f6d 5f66 756e 6328 6e70 2e61   [from_func(np.a
+0001f330: 7272 6179 2c20 2829 2c20 6474 7970 653d  rray, (), dtype=
+0001f340: 2769 3827 2c20 6172 6773 3d28 6e2c 2929  'i8', args=(n,))
+0001f350: 2066 6f72 206e 2069 6e20 7261 6e67 6528   for n in range(
+0001f360: 3529 5d0a 2020 2020 3e3e 3e20 7374 6163  5)].    >>> stac
+0001f370: 6b28 6172 7261 7973 292e 636f 6d70 7574  k(arrays).comput
+0001f380: 6528 290a 2020 2020 6172 7261 7928 5b30  e().    array([0
+0001f390: 2c20 312c 2032 2c20 332c 2034 5d29 0a20  , 1, 2, 3, 4]). 
+0001f3a0: 2020 2022 2222 0a20 2020 2069 6620 6b77     """.    if kw
+0001f3b0: 6172 6773 2069 7320 4e6f 6e65 3a0a 2020  args is None:.  
+0001f3c0: 2020 2020 2020 6b77 6172 6773 203d 207b        kwargs = {
+0001f3d0: 7d0a 0a20 2020 206e 616d 6520 3d20 6e61  }..    name = na
+0001f3e0: 6d65 206f 7220 2266 726f 6d5f 6675 6e63  me or "from_func
+0001f3f0: 2d22 202b 2074 6f6b 656e 697a 6528 6675  -" + tokenize(fu
+0001f400: 6e63 2c20 7368 6170 652c 2064 7479 7065  nc, shape, dtype
+0001f410: 2c20 6172 6773 2c20 6b77 6172 6773 290a  , args, kwargs).
+0001f420: 2020 2020 6966 2061 7267 7320 6f72 206b      if args or k
+0001f430: 7761 7267 733a 0a20 2020 2020 2020 2066  wargs:.        f
+0001f440: 756e 6320 3d20 7061 7274 6961 6c28 6675  unc = partial(fu
+0001f450: 6e63 2c20 2a61 7267 732c 202a 2a6b 7761  nc, *args, **kwa
+0001f460: 7267 7329 0a20 2020 2064 736b 203d 207b  rgs).    dsk = {
+0001f470: 286e 616d 652c 2920 2b20 2830 2c29 202a  (name,) + (0,) *
+0001f480: 206c 656e 2873 6861 7065 293a 2028 6675   len(shape): (fu
+0001f490: 6e63 2c29 7d0a 2020 2020 6368 756e 6b73  nc,)}.    chunks
+0001f4a0: 203d 2074 7570 6c65 2828 692c 2920 666f   = tuple((i,) fo
+0001f4b0: 7220 6920 696e 2073 6861 7065 290a 2020  r i in shape).  
+0001f4c0: 2020 7265 7475 726e 2041 7272 6179 2864    return Array(d
+0001f4d0: 736b 2c20 6e61 6d65 2c20 6368 756e 6b73  sk, name, chunks
+0001f4e0: 2c20 6474 7970 6529 0a0a 0a64 6566 2063  , dtype)...def c
+0001f4f0: 6f6d 6d6f 6e5f 626c 6f63 6b64 696d 2862  ommon_blockdim(b
+0001f500: 6c6f 636b 6469 6d73 293a 0a20 2020 2022  lockdims):.    "
+0001f510: 2222 4669 6e64 2074 6865 2063 6f6d 6d6f  ""Find the commo
+0001f520: 6e20 626c 6f63 6b20 6469 6d65 6e73 696f  n block dimensio
+0001f530: 6e73 2066 726f 6d20 7468 6520 6c69 7374  ns from the list
+0001f540: 206f 6620 626c 6f63 6b20 6469 6d65 6e73   of block dimens
+0001f550: 696f 6e73 0a0a 2020 2020 4375 7272 656e  ions..    Curren
+0001f560: 746c 7920 6f6e 6c79 2069 6d70 6c65 6d65  tly only impleme
+0001f570: 6e74 7320 7468 6520 7369 6d70 6c65 7374  nts the simplest
+0001f580: 2070 6f73 7369 626c 6520 6865 7572 6973   possible heuris
+0001f590: 7469 633a 2074 6865 2063 6f6d 6d6f 6e0a  tic: the common.
+0001f5a0: 2020 2020 626c 6f63 6b2d 6469 6d65 6e73      block-dimens
+0001f5b0: 696f 6e20 6973 2074 6865 206f 6e6c 7920  ion is the only 
+0001f5c0: 6f6e 6520 7468 6174 2064 6f65 7320 6e6f  one that does no
+0001f5d0: 7420 7370 616e 2066 756c 6c79 2073 7061  t span fully spa
+0001f5e0: 6e20 6120 6469 6d65 6e73 696f 6e2e 0a20  n a dimension.. 
+0001f5f0: 2020 2054 6869 7320 6973 2061 2063 6f6e     This is a con
+0001f600: 7365 7276 6174 6976 6520 6368 6f69 6365  servative choice
+0001f610: 2074 6861 7420 616c 6c6f 7773 2075 7320   that allows us 
+0001f620: 746f 2061 766f 6964 2070 6f74 656e 7469  to avoid potenti
+0001f630: 616c 6c79 2076 6572 790a 2020 2020 6578  ally very.    ex
+0001f640: 7065 6e73 6976 6520 7265 6368 756e 6b69  pensive rechunki
+0001f650: 6e67 2e0a 0a20 2020 2041 7373 756d 6573  ng...    Assumes
+0001f660: 2074 6861 7420 6561 6368 2065 6c65 6d65   that each eleme
+0001f670: 6e74 206f 6620 7468 6520 696e 7075 7420  nt of the input 
+0001f680: 626c 6f63 6b20 6469 6d65 6e73 696f 6e73  block dimensions
+0001f690: 2068 6173 2061 6c6c 2074 6865 2073 616d   has all the sam
+0001f6a0: 650a 2020 2020 7375 6d20 2869 2e65 2e2c  e.    sum (i.e.,
+0001f6b0: 2074 6861 7420 7468 6579 2063 6f72 7265   that they corre
+0001f6c0: 7370 6f6e 6420 746f 2064 696d 656e 7369  spond to dimensi
+0001f6d0: 6f6e 7320 6f66 2074 6865 2073 616d 6520  ons of the same 
+0001f6e0: 7369 7a65 292e 0a0a 2020 2020 4578 616d  size)...    Exam
+0001f6f0: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
+0001f700: 2d0a 2020 2020 3e3e 3e20 636f 6d6d 6f6e  -.    >>> common
+0001f710: 5f62 6c6f 636b 6469 6d28 5b28 332c 292c  _blockdim([(3,),
+0001f720: 2028 322c 2031 295d 290a 2020 2020 2832   (2, 1)]).    (2
+0001f730: 2c20 3129 0a20 2020 203e 3e3e 2063 6f6d  , 1).    >>> com
+0001f740: 6d6f 6e5f 626c 6f63 6b64 696d 285b 2831  mon_blockdim([(1
+0001f750: 2c20 3229 2c20 2832 2c20 3129 5d29 0a20  , 2), (2, 1)]). 
+0001f760: 2020 2028 312c 2031 2c20 3129 0a20 2020     (1, 1, 1).   
+0001f770: 203e 3e3e 2063 6f6d 6d6f 6e5f 626c 6f63   >>> common_bloc
+0001f780: 6b64 696d 285b 2832 2c20 3229 2c20 2833  kdim([(2, 2), (3
+0001f790: 2c20 3129 5d29 2020 2320 646f 6374 6573  , 1)])  # doctes
+0001f7a0: 743a 202b 534b 4950 0a20 2020 2054 7261  t: +SKIP.    Tra
+0001f7b0: 6365 6261 636b 2028 6d6f 7374 2072 6563  ceback (most rec
+0001f7c0: 656e 7420 6361 6c6c 206c 6173 7429 3a0a  ent call last):.
+0001f7d0: 2020 2020 2020 2020 2e2e 2e0a 2020 2020          ....    
+0001f7e0: 5661 6c75 6545 7272 6f72 3a20 4368 756e  ValueError: Chun
+0001f7f0: 6b73 2064 6f20 6e6f 7420 616c 6967 6e0a  ks do not align.
+0001f800: 2020 2020 2222 220a 2020 2020 6966 206e      """.    if n
+0001f810: 6f74 2061 6e79 2862 6c6f 636b 6469 6d73  ot any(blockdims
+0001f820: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0001f830: 6e20 2829 0a20 2020 206e 6f6e 5f74 7269  n ().    non_tri
+0001f840: 7669 616c 5f64 696d 7320 3d20 7b64 2066  vial_dims = {d f
+0001f850: 6f72 2064 2069 6e20 626c 6f63 6b64 696d  or d in blockdim
+0001f860: 7320 6966 206c 656e 2864 2920 3e20 317d  s if len(d) > 1}
+0001f870: 0a20 2020 2069 6620 6c65 6e28 6e6f 6e5f  .    if len(non_
+0001f880: 7472 6976 6961 6c5f 6469 6d73 2920 3d3d  trivial_dims) ==
+0001f890: 2031 3a0a 2020 2020 2020 2020 7265 7475   1:.        retu
+0001f8a0: 726e 2066 6972 7374 286e 6f6e 5f74 7269  rn first(non_tri
+0001f8b0: 7669 616c 5f64 696d 7329 0a20 2020 2069  vial_dims).    i
+0001f8c0: 6620 6c65 6e28 6e6f 6e5f 7472 6976 6961  f len(non_trivia
+0001f8d0: 6c5f 6469 6d73 2920 3d3d 2030 3a0a 2020  l_dims) == 0:.  
+0001f8e0: 2020 2020 2020 7265 7475 726e 206d 6178        return max
+0001f8f0: 2862 6c6f 636b 6469 6d73 2c20 6b65 793d  (blockdims, key=
+0001f900: 6669 7273 7429 0a0a 2020 2020 6966 206e  first)..    if n
+0001f910: 702e 6973 6e61 6e28 7375 6d28 6d61 7028  p.isnan(sum(map(
+0001f920: 7375 6d2c 2062 6c6f 636b 6469 6d73 2929  sum, blockdims))
+0001f930: 293a 0a20 2020 2020 2020 2072 6169 7365  ):.        raise
+0001f940: 2056 616c 7565 4572 726f 7228 0a20 2020   ValueError(.   
+0001f950: 2020 2020 2020 2020 2022 4172 7261 7973           "Arrays
+0001f960: 2720 6368 756e 6b20 7369 7a65 7320 2825  ' chunk sizes (%
+0001f970: 7329 2061 7265 2075 6e6b 6e6f 776e 2e5c  s) are unknown.\
+0001f980: 6e5c 6e22 0a20 2020 2020 2020 2020 2020  n\n".           
+0001f990: 2022 4120 706f 7373 6962 6c65 2073 6f6c   "A possible sol
+0001f9a0: 7574 696f 6e3a 5c6e 220a 2020 2020 2020  ution:\n".      
+0001f9b0: 2020 2020 2020 2220 2078 2e63 6f6d 7075        "  x.compu
+0001f9c0: 7465 5f63 6875 6e6b 5f73 697a 6573 2829  te_chunk_sizes()
+0001f9d0: 2220 2520 626c 6f63 6b64 696d 730a 2020  " % blockdims.  
+0001f9e0: 2020 2020 2020 290a 0a20 2020 2069 6620        )..    if 
+0001f9f0: 6c65 6e28 7365 7428 6d61 7028 7375 6d2c  len(set(map(sum,
+0001fa00: 206e 6f6e 5f74 7269 7669 616c 5f64 696d   non_trivial_dim
+0001fa10: 7329 2929 203e 2031 3a0a 2020 2020 2020  s))) > 1:.      
+0001fa20: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
+0001fa30: 6f72 2822 4368 756e 6b73 2064 6f20 6e6f  or("Chunks do no
+0001fa40: 7420 6164 6420 7570 2074 6f20 7361 6d65  t add up to same
+0001fa50: 2076 616c 7565 222c 2062 6c6f 636b 6469   value", blockdi
+0001fa60: 6d73 290a 0a20 2020 2023 2057 6520 6861  ms)..    # We ha
+0001fa70: 7665 206d 756c 7469 706c 6520 6e6f 6e2d  ve multiple non-
+0001fa80: 7472 6976 6961 6c20 6368 756e 6b73 206f  trivial chunks o
+0001fa90: 6e20 7468 6973 2061 7869 730a 2020 2020  n this axis.    
+0001faa0: 2320 652e 672e 2028 352c 2032 2920 616e  # e.g. (5, 2) an
+0001fab0: 6420 2834 2c20 3329 0a0a 2020 2020 2320  d (4, 3)..    # 
+0001fac0: 5765 2063 7265 6174 6520 6120 7369 6e67  We create a sing
+0001fad0: 6c65 2063 6875 6e6b 2074 7570 6c65 2077  le chunk tuple w
+0001fae0: 6974 6820 7468 6520 7361 6d65 2074 6f74  ith the same tot
+0001faf0: 616c 206c 656e 6774 680a 2020 2020 2320  al length.    # 
+0001fb00: 7468 6174 2065 7665 6e6c 7920 6469 7669  that evenly divi
+0001fb10: 6465 7320 626f 7468 2c20 652e 672e 2028  des both, e.g. (
+0001fb20: 342c 2031 2c20 3229 0a0a 2020 2020 2320  4, 1, 2)..    # 
+0001fb30: 546f 2061 6363 6f6d 706c 6973 6820 7468  To accomplish th
+0001fb40: 6973 2077 6520 7761 6c6b 2064 6f77 6e20  is we walk down 
+0001fb50: 616c 6c20 6368 756e 6b20 7475 706c 6573  all chunk tuples
+0001fb60: 2074 6f67 6574 6865 722c 2066 696e 6469   together, findi
+0001fb70: 6e67 2074 6865 0a20 2020 2023 2073 6d61  ng the.    # sma
+0001fb80: 6c6c 6573 7420 656c 656d 656e 742c 2061  llest element, a
+0001fb90: 6464 696e 6720 6974 2074 6f20 7468 6520  dding it to the 
+0001fba0: 6f75 7470 7574 2c20 616e 6420 7375 6274  output, and subt
+0001fbb0: 7261 6374 696e 6720 6974 2066 726f 6d20  racting it from 
+0001fbc0: 616c 6c0a 2020 2020 2320 6f74 6865 7220  all.    # other 
+0001fbd0: 656c 656d 656e 7473 2061 6e64 2072 656d  elements and rem
+0001fbe0: 6f76 6520 7468 6520 656c 656d 656e 7420  ove the element 
+0001fbf0: 6974 7365 6c66 2e20 2057 6520 7374 6f70  itself.  We stop
+0001fc00: 206f 6e63 6520 7765 2068 6176 650a 2020   once we have.  
+0001fc10: 2020 2320 6275 726e 6564 2074 6872 6f75    # burned throu
+0001fc20: 6768 2061 6c6c 206f 6620 7468 6520 6368  gh all of the ch
+0001fc30: 756e 6b20 7475 706c 6573 2e0a 2020 2020  unk tuples..    
+0001fc40: 2320 466f 7220 6566 6669 6369 656e 6379  # For efficiency
+0001fc50: 2773 2073 616b 6520 7765 2072 6576 6572  's sake we rever
+0001fc60: 7365 2074 6865 206c 6973 7473 2073 6f20  se the lists so 
+0001fc70: 7468 6174 2077 6520 6361 6e20 706f 7020  that we can pop 
+0001fc80: 6f66 6620 7468 6520 656e 640a 2020 2020  off the end.    
+0001fc90: 7263 6875 6e6b 7320 3d20 5b6c 6973 7428  rchunks = [list(
+0001fca0: 6e74 6429 5b3a 3a2d 315d 2066 6f72 206e  ntd)[::-1] for n
+0001fcb0: 7464 2069 6e20 6e6f 6e5f 7472 6976 6961  td in non_trivia
+0001fcc0: 6c5f 6469 6d73 5d0a 2020 2020 746f 7461  l_dims].    tota
+0001fcd0: 6c20 3d20 7375 6d28 6669 7273 7428 6e6f  l = sum(first(no
+0001fce0: 6e5f 7472 6976 6961 6c5f 6469 6d73 2929  n_trivial_dims))
+0001fcf0: 0a20 2020 2069 203d 2030 0a0a 2020 2020  .    i = 0..    
+0001fd00: 6f75 7420 3d20 5b5d 0a20 2020 2077 6869  out = [].    whi
+0001fd10: 6c65 2069 203c 2074 6f74 616c 3a0a 2020  le i < total:.  
+0001fd20: 2020 2020 2020 6d20 3d20 6d69 6e28 635b        m = min(c[
+0001fd30: 2d31 5d20 666f 7220 6320 696e 2072 6368  -1] for c in rch
+0001fd40: 756e 6b73 290a 2020 2020 2020 2020 6f75  unks).        ou
+0001fd50: 742e 6170 7065 6e64 286d 290a 2020 2020  t.append(m).    
+0001fd60: 2020 2020 666f 7220 6320 696e 2072 6368      for c in rch
+0001fd70: 756e 6b73 3a0a 2020 2020 2020 2020 2020  unks:.          
+0001fd80: 2020 635b 2d31 5d20 2d3d 206d 0a20 2020    c[-1] -= m.   
+0001fd90: 2020 2020 2020 2020 2069 6620 635b 2d31           if c[-1
+0001fda0: 5d20 3d3d 2030 3a0a 2020 2020 2020 2020  ] == 0:.        
+0001fdb0: 2020 2020 2020 2020 632e 706f 7028 290a          c.pop().
+0001fdc0: 2020 2020 2020 2020 6920 2b3d 206d 0a0a          i += m..
+0001fdd0: 2020 2020 7265 7475 726e 2074 7570 6c65      return tuple
+0001fde0: 286f 7574 290a 0a0a 6465 6620 756e 6966  (out)...def unif
+0001fdf0: 795f 6368 756e 6b73 282a 6172 6773 2c20  y_chunks(*args, 
+0001fe00: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
+0001fe10: 2222 0a20 2020 2055 6e69 6679 2063 6875  "".    Unify chu
+0001fe20: 6e6b 7320 6163 726f 7373 2061 2073 6571  nks across a seq
+0001fe30: 7565 6e63 6520 6f66 2061 7272 6179 730a  uence of arrays.
+0001fe40: 0a20 2020 2054 6869 7320 7574 696c 6974  .    This utilit
+0001fe50: 7920 6675 6e63 7469 6f6e 2069 7320 7573  y function is us
+0001fe60: 6564 2077 6974 6869 6e20 6f74 6865 7220  ed within other 
+0001fe70: 636f 6d6d 6f6e 206f 7065 7261 7469 6f6e  common operation
+0001fe80: 7320 6c69 6b65 0a20 2020 203a 6675 6e63  s like.    :func
+0001fe90: 3a60 6461 736b 2e61 7272 6179 2e63 6f72  :`dask.array.cor
+0001fea0: 652e 6d61 705f 626c 6f63 6b73 6020 616e  e.map_blocks` an
+0001feb0: 6420 3a66 756e 633a 6064 6173 6b2e 6172  d :func:`dask.ar
+0001fec0: 7261 792e 636f 7265 2e62 6c6f 636b 7769  ray.core.blockwi
+0001fed0: 7365 602e 0a20 2020 2049 7420 6973 206e  se`..    It is n
+0001fee0: 6f74 2063 6f6d 6d6f 6e6c 7920 7573 6564  ot commonly used
+0001fef0: 2062 7920 656e 642d 7573 6572 7320 6469   by end-users di
+0001ff00: 7265 6374 6c79 2e0a 0a20 2020 2050 6172  rectly...    Par
+0001ff10: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+0001ff20: 2d2d 2d2d 2d2d 0a20 2020 202a 6172 6773  ------.    *args
+0001ff30: 3a20 7365 7175 656e 6365 206f 6620 4172  : sequence of Ar
+0001ff40: 7261 792c 2069 6e64 6578 2070 6169 7273  ray, index pairs
+0001ff50: 0a20 2020 2020 2020 2053 6571 7565 6e63  .        Sequenc
+0001ff60: 6520 6c69 6b65 2028 782c 2027 696a 272c  e like (x, 'ij',
+0001ff70: 2079 2c20 276a 6b27 2c20 7a2c 2027 6927   y, 'jk', z, 'i'
+0001ff80: 290a 0a20 2020 2045 7861 6d70 6c65 730a  )..    Examples.
+0001ff90: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0001ffa0: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
+0001ffb0: 2e61 7272 6179 2061 7320 6461 0a20 2020  .array as da.   
+0001ffc0: 203e 3e3e 2078 203d 2064 612e 6f6e 6573   >>> x = da.ones
+0001ffd0: 2831 302c 2063 6875 6e6b 733d 2828 352c  (10, chunks=((5,
+0001ffe0: 2032 2c20 3329 2c29 290a 2020 2020 3e3e   2, 3),)).    >>
+0001fff0: 3e20 7920 3d20 6461 2e6f 6e65 7328 3130  > y = da.ones(10
+00020000: 2c20 6368 756e 6b73 3d28 2832 2c20 332c  , chunks=((2, 3,
+00020010: 2035 292c 2929 0a20 2020 203e 3e3e 2063   5),)).    >>> c
+00020020: 6875 6e6b 7373 2c20 6172 7261 7973 203d  hunkss, arrays =
+00020030: 2075 6e69 6679 5f63 6875 6e6b 7328 782c   unify_chunks(x,
+00020040: 2027 6927 2c20 792c 2027 6927 290a 2020   'i', y, 'i').  
+00020050: 2020 3e3e 3e20 6368 756e 6b73 730a 2020    >>> chunkss.  
+00020060: 2020 7b27 6927 3a20 2832 2c20 332c 2032    {'i': (2, 3, 2
+00020070: 2c20 3329 7d0a 0a20 2020 203e 3e3e 2078  , 3)}..    >>> x
+00020080: 203d 2064 612e 6f6e 6573 2828 3130 302c   = da.ones((100,
+00020090: 2031 3029 2c20 6368 756e 6b73 3d28 3230   10), chunks=(20
+000200a0: 2c20 3529 290a 2020 2020 3e3e 3e20 7920  , 5)).    >>> y 
+000200b0: 3d20 6461 2e6f 6e65 7328 2831 302c 2031  = da.ones((10, 1
+000200c0: 3030 292c 2063 6875 6e6b 733d 2834 2c20  00), chunks=(4, 
+000200d0: 3530 2929 0a20 2020 203e 3e3e 2063 6875  50)).    >>> chu
+000200e0: 6e6b 7373 2c20 6172 7261 7973 203d 2075  nkss, arrays = u
+000200f0: 6e69 6679 5f63 6875 6e6b 7328 782c 2027  nify_chunks(x, '
+00020100: 696a 272c 2079 2c20 276a 6b27 2c20 2763  ij', y, 'jk', 'c
+00020110: 6f6e 7374 616e 7427 2c20 4e6f 6e65 290a  onstant', None).
+00020120: 2020 2020 3e3e 3e20 6368 756e 6b73 7320      >>> chunkss 
+00020130: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+00020140: 500a 2020 2020 7b27 6b27 3a20 2835 302c  P.    {'k': (50,
+00020150: 2035 3029 2c20 2769 273a 2028 3230 2c20   50), 'i': (20, 
+00020160: 3230 2c20 3230 2c20 3230 2c20 3230 292c  20, 20, 20, 20),
+00020170: 2027 6a27 3a20 2834 2c20 312c 2033 2c20   'j': (4, 1, 3, 
+00020180: 3229 7d0a 0a20 2020 203e 3e3e 2075 6e69  2)}..    >>> uni
+00020190: 6679 5f63 6875 6e6b 7328 302c 204e 6f6e  fy_chunks(0, Non
+000201a0: 6529 0a20 2020 2028 7b7d 2c20 5b30 5d29  e).    ({}, [0])
+000201b0: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
+000201c0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 6368    -------.    ch
+000201d0: 756e 6b73 7320 3a20 6469 6374 0a20 2020  unkss : dict.   
+000201e0: 2020 2020 204d 6170 206c 696b 6520 7b69       Map like {i
+000201f0: 6e64 6578 3a20 6368 756e 6b73 7d2e 0a20  ndex: chunks}.. 
+00020200: 2020 2061 7272 6179 7320 3a20 6c69 7374     arrays : list
+00020210: 0a20 2020 2020 2020 204c 6973 7420 6f66  .        List of
+00020220: 2072 6563 6875 6e6b 6564 2061 7272 6179   rechunked array
+00020230: 732e 0a0a 2020 2020 5365 6520 416c 736f  s...    See Also
+00020240: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+00020250: 2020 636f 6d6d 6f6e 5f62 6c6f 636b 6469    common_blockdi
+00020260: 6d0a 2020 2020 2222 220a 2020 2020 6966  m.    """.    if
+00020270: 206e 6f74 2061 7267 733a 0a20 2020 2020   not args:.     
+00020280: 2020 2072 6574 7572 6e20 7b7d 2c20 5b5d     return {}, []
+00020290: 0a0a 2020 2020 6172 6769 6e64 7320 3d20  ..    arginds = 
+000202a0: 5b0a 2020 2020 2020 2020 2861 7361 6e79  [.        (asany
+000202b0: 6172 7261 7928 6129 2069 6620 696e 6420  array(a) if ind 
+000202c0: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
+000202d0: 2061 2c20 696e 6429 2066 6f72 2061 2c20   a, ind) for a, 
+000202e0: 696e 6420 696e 2070 6172 7469 7469 6f6e  ind in partition
+000202f0: 2832 2c20 6172 6773 290a 2020 2020 5d20  (2, args).    ] 
+00020300: 2023 205b 782c 2069 6a2c 2079 2c20 6a6b   # [x, ij, y, jk
+00020310: 5d0a 2020 2020 7761 726e 203d 206b 7761  ].    warn = kwa
+00020320: 7267 732e 6765 7428 2277 6172 6e22 2c20  rgs.get("warn", 
+00020330: 5472 7565 290a 0a20 2020 2061 7272 6179  True)..    array
+00020340: 732c 2069 6e64 7320 3d20 7a69 7028 2a61  s, inds = zip(*a
+00020350: 7267 696e 6473 290a 2020 2020 6966 2061  rginds).    if a
+00020360: 6c6c 2869 6e64 2069 7320 4e6f 6e65 2066  ll(ind is None f
+00020370: 6f72 2069 6e64 2069 6e20 696e 6473 293a  or ind in inds):
+00020380: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00020390: 7b7d 2c20 6c69 7374 2861 7272 6179 7329  {}, list(arrays)
+000203a0: 0a20 2020 2069 6620 616c 6c28 696e 6420  .    if all(ind 
+000203b0: 3d3d 2069 6e64 735b 305d 2066 6f72 2069  == inds[0] for i
+000203c0: 6e64 2069 6e20 696e 6473 2920 616e 6420  nd in inds) and 
+000203d0: 616c 6c28 0a20 2020 2020 2020 2061 2e63  all(.        a.c
+000203e0: 6875 6e6b 7320 3d3d 2061 7272 6179 735b  hunks == arrays[
+000203f0: 305d 2e63 6875 6e6b 7320 666f 7220 6120  0].chunks for a 
+00020400: 696e 2061 7272 6179 730a 2020 2020 293a  in arrays.    ):
+00020410: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00020420: 6469 6374 287a 6970 2869 6e64 735b 305d  dict(zip(inds[0]
+00020430: 2c20 6172 7261 7973 5b30 5d2e 6368 756e  , arrays[0].chun
+00020440: 6b73 2929 2c20 6172 7261 7973 0a0a 2020  ks)), arrays..  
+00020450: 2020 6e61 6d65 696e 6473 203d 205b 5d0a    nameinds = [].
+00020460: 2020 2020 626c 6f63 6b64 696d 5f64 6963      blockdim_dic
+00020470: 7420 3d20 6469 6374 2829 0a20 2020 206d  t = dict().    m
+00020480: 6178 5f70 6172 7473 203d 2030 0a20 2020  ax_parts = 0.   
+00020490: 2066 6f72 2061 2c20 696e 6420 696e 2061   for a, ind in a
+000204a0: 7267 696e 6473 3a0a 2020 2020 2020 2020  rginds:.        
+000204b0: 6966 2069 6e64 2069 7320 6e6f 7420 4e6f  if ind is not No
+000204c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000204d0: 6e61 6d65 696e 6473 2e61 7070 656e 6428  nameinds.append(
+000204e0: 2861 2e6e 616d 652c 2069 6e64 2929 0a20  (a.name, ind)). 
+000204f0: 2020 2020 2020 2020 2020 2062 6c6f 636b             block
+00020500: 6469 6d5f 6469 6374 5b61 2e6e 616d 655d  dim_dict[a.name]
+00020510: 203d 2061 2e63 6875 6e6b 730a 2020 2020   = a.chunks.    
+00020520: 2020 2020 2020 2020 6d61 785f 7061 7274          max_part
+00020530: 7320 3d20 6d61 7828 6d61 785f 7061 7274  s = max(max_part
+00020540: 732c 2061 2e6e 7061 7274 6974 696f 6e73  s, a.npartitions
+00020550: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
+00020560: 2020 2020 2020 2020 2020 2020 6e61 6d65              name
+00020570: 696e 6473 2e61 7070 656e 6428 2861 2c20  inds.append((a, 
+00020580: 696e 6429 290a 0a20 2020 2063 6875 6e6b  ind))..    chunk
+00020590: 7373 203d 2062 726f 6164 6361 7374 5f64  ss = broadcast_d
+000205a0: 696d 656e 7369 6f6e 7328 6e61 6d65 696e  imensions(namein
+000205b0: 6473 2c20 626c 6f63 6b64 696d 5f64 6963  ds, blockdim_dic
+000205c0: 742c 2063 6f6e 736f 6c69 6461 7465 3d63  t, consolidate=c
+000205d0: 6f6d 6d6f 6e5f 626c 6f63 6b64 696d 290a  ommon_blockdim).
+000205e0: 2020 2020 6e70 6172 7473 203d 206d 6174      nparts = mat
+000205f0: 682e 7072 6f64 286d 6170 286c 656e 2c20  h.prod(map(len, 
+00020600: 6368 756e 6b73 732e 7661 6c75 6573 2829  chunkss.values()
+00020610: 2929 0a0a 2020 2020 6966 2077 6172 6e20  ))..    if warn 
+00020620: 616e 6420 6e70 6172 7473 2061 6e64 206e  and nparts and n
+00020630: 7061 7274 7320 3e3d 206d 6178 5f70 6172  parts >= max_par
+00020640: 7473 202a 2031 303a 0a20 2020 2020 2020  ts * 10:.       
+00020650: 2077 6172 6e69 6e67 732e 7761 726e 280a   warnings.warn(.
+00020660: 2020 2020 2020 2020 2020 2020 2249 6e63              "Inc
+00020670: 7265 6173 696e 6720 6e75 6d62 6572 206f  reasing number o
+00020680: 6620 6368 756e 6b73 2062 7920 6661 6374  f chunks by fact
+00020690: 6f72 206f 6620 2564 2220 2520 286e 7061  or of %d" % (npa
+000206a0: 7274 7320 2f20 6d61 785f 7061 7274 7329  rts / max_parts)
+000206b0: 2c0a 2020 2020 2020 2020 2020 2020 5065  ,.            Pe
+000206c0: 7266 6f72 6d61 6e63 6557 6172 6e69 6e67  rformanceWarning
+000206d0: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+000206e0: 6163 6b6c 6576 656c 3d33 2c0a 2020 2020  acklevel=3,.    
+000206f0: 2020 2020 290a 0a20 2020 2061 7272 6179      )..    array
+00020700: 7320 3d20 5b5d 0a20 2020 2066 6f72 2061  s = [].    for a
+00020710: 2c20 6920 696e 2061 7267 696e 6473 3a0a  , i in arginds:.
+00020720: 2020 2020 2020 2020 6966 2069 2069 7320          if i is 
+00020730: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00020740: 2020 6172 7261 7973 2e61 7070 656e 6428    arrays.append(
+00020750: 6129 0a20 2020 2020 2020 2065 6c73 653a  a).        else:
+00020760: 0a20 2020 2020 2020 2020 2020 2063 6875  .            chu
+00020770: 6e6b 7320 3d20 7475 706c 6528 0a20 2020  nks = tuple(.   
+00020780: 2020 2020 2020 2020 2020 2020 2063 6875               chu
+00020790: 6e6b 7373 5b6a 5d0a 2020 2020 2020 2020  nkss[j].        
+000207a0: 2020 2020 2020 2020 6966 2061 2e73 6861          if a.sha
+000207b0: 7065 5b6e 5d20 3e20 310a 2020 2020 2020  pe[n] > 1.      
+000207c0: 2020 2020 2020 2020 2020 656c 7365 2061            else a
+000207d0: 2e73 6861 7065 5b6e 5d0a 2020 2020 2020  .shape[n].      
+000207e0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+000207f0: 206e 702e 6973 6e61 6e28 7375 6d28 6368   np.isnan(sum(ch
+00020800: 756e 6b73 735b 6a5d 2929 0a20 2020 2020  unkss[j])).     
+00020810: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+00020820: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00020830: 2020 2020 2066 6f72 206e 2c20 6a20 696e       for n, j in
+00020840: 2065 6e75 6d65 7261 7465 2869 290a 2020   enumerate(i).  
+00020850: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00020860: 2020 2020 2020 2020 6966 2063 6875 6e6b          if chunk
+00020870: 7320 213d 2061 2e63 6875 6e6b 7320 616e  s != a.chunks an
+00020880: 6420 616c 6c28 612e 6368 756e 6b73 293a  d all(a.chunks):
+00020890: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000208a0: 2061 7272 6179 732e 6170 7065 6e64 2861   arrays.append(a
+000208b0: 2e72 6563 6875 6e6b 2863 6875 6e6b 7329  .rechunk(chunks)
+000208c0: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
+000208d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000208e0: 2020 2020 6172 7261 7973 2e61 7070 656e      arrays.appen
+000208f0: 6428 6129 0a20 2020 2072 6574 7572 6e20  d(a).    return 
+00020900: 6368 756e 6b73 732c 2061 7272 6179 730a  chunkss, arrays.
+00020910: 0a0a 6465 6620 756e 7061 636b 5f73 696e  ..def unpack_sin
+00020920: 676c 6574 6f6e 2878 293a 0a20 2020 2022  gleton(x):.    "
+00020930: 2222 0a0a 2020 2020 3e3e 3e20 756e 7061  ""..    >>> unpa
+00020940: 636b 5f73 696e 676c 6574 6f6e 285b 5b5b  ck_singleton([[[
+00020950: 5b31 5d5d 5d5d 290a 2020 2020 310a 2020  [1]]]]).    1.  
+00020960: 2020 3e3e 3e20 756e 7061 636b 5f73 696e    >>> unpack_sin
+00020970: 676c 6574 6f6e 286e 702e 6172 7261 7928  gleton(np.array(
+00020980: 6e70 2e64 6174 6574 696d 6536 3428 2732  np.datetime64('2
+00020990: 3030 302d 3031 2d30 3127 2929 290a 2020  000-01-01'))).  
+000209a0: 2020 6172 7261 7928 2732 3030 302d 3031    array('2000-01
+000209b0: 2d30 3127 2c20 6474 7970 653d 2764 6174  -01', dtype='dat
+000209c0: 6574 696d 6536 345b 445d 2729 0a20 2020  etime64[D]').   
+000209d0: 2022 2222 0a20 2020 2077 6869 6c65 2069   """.    while i
+000209e0: 7369 6e73 7461 6e63 6528 782c 2028 6c69  sinstance(x, (li
+000209f0: 7374 2c20 7475 706c 6529 293a 0a20 2020  st, tuple)):.   
+00020a00: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00020a10: 2020 2020 2020 7820 3d20 785b 305d 0a20        x = x[0]. 
+00020a20: 2020 2020 2020 2065 7863 6570 7420 2849         except (I
+00020a30: 6e64 6578 4572 726f 722c 2054 7970 6545  ndexError, TypeE
+00020a40: 7272 6f72 2c20 4b65 7945 7272 6f72 293a  rror, KeyError):
+00020a50: 0a20 2020 2020 2020 2020 2020 2062 7265  .            bre
+00020a60: 616b 0a20 2020 2072 6574 7572 6e20 780a  ak.    return x.
+00020a70: 0a0a 6465 6620 626c 6f63 6b28 6172 7261  ..def block(arra
+00020a80: 7973 2c20 616c 6c6f 775f 756e 6b6e 6f77  ys, allow_unknow
+00020a90: 6e5f 6368 756e 6b73 697a 6573 3d46 616c  n_chunksizes=Fal
+00020aa0: 7365 293a 0a20 2020 2022 2222 0a20 2020  se):.    """.   
+00020ab0: 2041 7373 656d 626c 6520 616e 206e 642d   Assemble an nd-
+00020ac0: 6172 7261 7920 6672 6f6d 206e 6573 7465  array from neste
+00020ad0: 6420 6c69 7374 7320 6f66 2062 6c6f 636b  d lists of block
+00020ae0: 732e 0a0a 2020 2020 426c 6f63 6b73 2069  s...    Blocks i
+00020af0: 6e20 7468 6520 696e 6e65 726d 6f73 7420  n the innermost 
+00020b00: 6c69 7374 7320 6172 6520 636f 6e63 6174  lists are concat
+00020b10: 656e 6174 6564 2061 6c6f 6e67 2074 6865  enated along the
+00020b20: 206c 6173 740a 2020 2020 6469 6d65 6e73   last.    dimens
+00020b30: 696f 6e20 282d 3129 2c20 7468 656e 2074  ion (-1), then t
+00020b40: 6865 7365 2061 7265 2063 6f6e 6361 7465  hese are concate
+00020b50: 6e61 7465 6420 616c 6f6e 6720 7468 6520  nated along the 
+00020b60: 7365 636f 6e64 2d6c 6173 740a 2020 2020  second-last.    
+00020b70: 6469 6d65 6e73 696f 6e20 282d 3229 2c20  dimension (-2), 
+00020b80: 616e 6420 736f 206f 6e20 756e 7469 6c20  and so on until 
+00020b90: 7468 6520 6f75 7465 726d 6f73 7420 6c69  the outermost li
+00020ba0: 7374 2069 7320 7265 6163 6865 640a 0a20  st is reached.. 
+00020bb0: 2020 2042 6c6f 636b 7320 6361 6e20 6265     Blocks can be
+00020bc0: 206f 6620 616e 7920 6469 6d65 6e73 696f   of any dimensio
+00020bd0: 6e2c 2062 7574 2077 696c 6c20 6e6f 7420  n, but will not 
+00020be0: 6265 2062 726f 6164 6361 7374 6564 2075  be broadcasted u
+00020bf0: 7369 6e67 2074 6865 206e 6f72 6d61 6c0a  sing the normal.
+00020c00: 2020 2020 7275 6c65 732e 2049 6e73 7465      rules. Inste
+00020c10: 6164 2c20 6c65 6164 696e 6720 6178 6573  ad, leading axes
+00020c20: 206f 6620 7369 7a65 2031 2061 7265 2069   of size 1 are i
+00020c30: 6e73 6572 7465 642c 2074 6f20 6d61 6b65  nserted, to make
+00020c40: 2060 6062 6c6f 636b 2e6e 6469 6d60 600a   ``block.ndim``.
+00020c50: 2020 2020 7468 6520 7361 6d65 2066 6f72      the same for
+00020c60: 2061 6c6c 2062 6c6f 636b 732e 2054 6869   all blocks. Thi
+00020c70: 7320 6973 2070 7269 6d61 7269 6c79 2075  s is primarily u
+00020c80: 7365 6675 6c20 666f 7220 776f 726b 696e  seful for workin
+00020c90: 6720 7769 7468 2073 6361 6c61 7273 2c0a  g with scalars,.
+00020ca0: 2020 2020 616e 6420 6d65 616e 7320 7468      and means th
+00020cb0: 6174 2063 6f64 6520 6c69 6b65 2060 6062  at code like ``b
+00020cc0: 6c6f 636b 285b 762c 2031 5d29 6060 2069  lock([v, 1])`` i
+00020cd0: 7320 7661 6c69 642c 2077 6865 7265 0a20  s valid, where. 
+00020ce0: 2020 2060 6076 2e6e 6469 6d20 3d3d 2031     ``v.ndim == 1
+00020cf0: 6060 2e0a 0a20 2020 2057 6865 6e20 7468  ``...    When th
+00020d00: 6520 6e65 7374 6564 206c 6973 7420 6973  e nested list is
+00020d10: 2074 776f 206c 6576 656c 7320 6465 6570   two levels deep
+00020d20: 2c20 7468 6973 2061 6c6c 6f77 7320 626c  , this allows bl
+00020d30: 6f63 6b20 6d61 7472 6963 6573 2074 6f20  ock matrices to 
+00020d40: 6265 0a20 2020 2063 6f6e 7374 7275 6374  be.    construct
+00020d50: 6564 2066 726f 6d20 7468 6569 7220 636f  ed from their co
+00020d60: 6d70 6f6e 656e 7473 2e0a 0a20 2020 2050  mponents...    P
+00020d70: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+00020d80: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061 7272  --------.    arr
+00020d90: 6179 7320 3a20 6e65 7374 6564 206c 6973  ays : nested lis
+00020da0: 7420 6f66 2061 7272 6179 5f6c 696b 6520  t of array_like 
+00020db0: 6f72 2073 6361 6c61 7273 2028 6275 7420  or scalars (but 
+00020dc0: 6e6f 7420 7475 706c 6573 290a 2020 2020  not tuples).    
+00020dd0: 2020 2020 4966 2070 6173 7365 6420 6120      If passed a 
+00020de0: 7369 6e67 6c65 206e 6461 7272 6179 206f  single ndarray o
+00020df0: 7220 7363 616c 6172 2028 6120 6e65 7374  r scalar (a nest
+00020e00: 6564 206c 6973 7420 6f66 2064 6570 7468  ed list of depth
+00020e10: 2030 292c 2074 6869 730a 2020 2020 2020   0), this.      
+00020e20: 2020 6973 2072 6574 7572 6e65 6420 756e    is returned un
+00020e30: 6d6f 6469 6669 6564 2028 616e 6420 6e6f  modified (and no
+00020e40: 7420 636f 7069 6564 292e 0a0a 2020 2020  t copied)...    
+00020e50: 2020 2020 456c 656d 656e 7473 2073 6861      Elements sha
+00020e60: 7065 7320 6d75 7374 206d 6174 6368 2061  pes must match a
+00020e70: 6c6f 6e67 2074 6865 2061 7070 726f 7072  long the appropr
+00020e80: 6961 7465 2061 7865 7320 2877 6974 686f  iate axes (witho
+00020e90: 7574 0a20 2020 2020 2020 2062 726f 6164  ut.        broad
+00020ea0: 6361 7374 696e 6729 2c20 6275 7420 6c65  casting), but le
+00020eb0: 6164 696e 6720 3173 2077 696c 6c20 6265  ading 1s will be
+00020ec0: 2070 7265 7065 6e64 6564 2074 6f20 7468   prepended to th
+00020ed0: 6520 7368 6170 6520 6173 0a20 2020 2020  e shape as.     
+00020ee0: 2020 206e 6563 6573 7361 7279 2074 6f20     necessary to 
+00020ef0: 6d61 6b65 2074 6865 2064 696d 656e 7369  make the dimensi
+00020f00: 6f6e 7320 6d61 7463 682e 0a0a 2020 2020  ons match...    
+00020f10: 616c 6c6f 775f 756e 6b6e 6f77 6e5f 6368  allow_unknown_ch
+00020f20: 756e 6b73 697a 6573 3a20 626f 6f6c 0a20  unksizes: bool. 
+00020f30: 2020 2020 2020 2041 6c6c 6f77 2075 6e6b         Allow unk
+00020f40: 6e6f 776e 2063 6875 6e6b 7369 7a65 732c  nown chunksizes,
+00020f50: 2073 7563 6820 6173 2063 6f6d 6520 6672   such as come fr
+00020f60: 6f6d 2063 6f6e 7665 7274 696e 6720 6672  om converting fr
+00020f70: 6f6d 2064 6173 6b0a 2020 2020 2020 2020  om dask.        
+00020f80: 6461 7461 6672 616d 6573 2e20 2044 6173  dataframes.  Das
+00020f90: 6b2e 6172 7261 7920 6973 2075 6e61 626c  k.array is unabl
+00020fa0: 6520 746f 2076 6572 6966 7920 7468 6174  e to verify that
+00020fb0: 2063 6875 6e6b 7320 6c69 6e65 2075 702e   chunks line up.
+00020fc0: 2020 4966 0a20 2020 2020 2020 2064 6174    If.        dat
+00020fd0: 6120 636f 6d65 7320 6672 6f6d 2064 6966  a comes from dif
+00020fe0: 6665 7265 6e74 6c79 2061 6c69 676e 6564  ferently aligned
+00020ff0: 2073 6f75 7263 6573 2074 6865 6e20 7468   sources then th
+00021000: 6973 2063 616e 2063 6175 7365 0a20 2020  is can cause.   
+00021010: 2020 2020 2075 6e65 7870 6563 7465 6420       unexpected 
+00021020: 7265 7375 6c74 732e 0a0a 2020 2020 5265  results...    Re
+00021030: 7475 726e 730a 2020 2020 2d2d 2d2d 2d2d  turns.    ------
+00021040: 2d0a 2020 2020 626c 6f63 6b5f 6172 7261  -.    block_arra
+00021050: 7920 3a20 6e64 6172 7261 790a 2020 2020  y : ndarray.    
+00021060: 2020 2020 5468 6520 6172 7261 7920 6173      The array as
+00021070: 7365 6d62 6c65 6420 6672 6f6d 2074 6865  sembled from the
+00021080: 2067 6976 656e 2062 6c6f 636b 732e 0a0a   given blocks...
+00021090: 2020 2020 2020 2020 5468 6520 6469 6d65          The dime
+000210a0: 6e73 696f 6e61 6c69 7479 206f 6620 7468  nsionality of th
+000210b0: 6520 6f75 7470 7574 2069 7320 6571 7561  e output is equa
+000210c0: 6c20 746f 2074 6865 2067 7265 6174 6573  l to the greates
+000210d0: 7420 6f66 3a0a 2020 2020 2020 2020 2a20  t of:.        * 
+000210e0: 7468 6520 6469 6d65 6e73 696f 6e61 6c69  the dimensionali
+000210f0: 7479 206f 6620 616c 6c20 7468 6520 696e  ty of all the in
+00021100: 7075 7473 0a20 2020 2020 2020 202a 2074  puts.        * t
+00021110: 6865 2064 6570 7468 2074 6f20 7768 6963  he depth to whic
+00021120: 6820 7468 6520 696e 7075 7420 6c69 7374  h the input list
+00021130: 2069 7320 6e65 7374 6564 0a0a 2020 2020   is nested..    
+00021140: 5261 6973 6573 0a20 2020 202d 2d2d 2d2d  Raises.    -----
+00021150: 2d0a 2020 2020 5661 6c75 6545 7272 6f72  -.    ValueError
+00021160: 0a20 2020 2020 2020 202a 2049 6620 6c69  .        * If li
+00021170: 7374 2064 6570 7468 7320 6172 6520 6d69  st depths are mi
+00021180: 736d 6174 6368 6564 202d 2066 6f72 2069  smatched - for i
+00021190: 6e73 7461 6e63 652c 2060 605b 5b61 2c20  nstance, ``[[a, 
+000211a0: 625d 2c20 635d 6060 2069 730a 2020 2020  b], c]`` is.    
+000211b0: 2020 2020 2020 696c 6c65 6761 6c2c 2061        illegal, a
+000211c0: 6e64 2073 686f 756c 6420 6265 2073 7065  nd should be spe
+000211d0: 6c74 2060 605b 5b61 2c20 625d 2c20 5b63  lt ``[[a, b], [c
+000211e0: 5d5d 6060 0a20 2020 2020 2020 202a 2049  ]]``.        * I
+000211f0: 6620 6c69 7374 7320 6172 6520 656d 7074  f lists are empt
+00021200: 7920 2d20 666f 7220 696e 7374 616e 6365  y - for instance
+00021210: 2c20 6060 5b5b 612c 2062 5d2c 205b 5d5d  , ``[[a, b], []]
+00021220: 6060 0a0a 2020 2020 5365 6520 416c 736f  ``..    See Also
+00021230: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
+00021240: 2020 636f 6e63 6174 656e 6174 6520 3a20    concatenate : 
+00021250: 4a6f 696e 2061 2073 6571 7565 6e63 6520  Join a sequence 
+00021260: 6f66 2061 7272 6179 7320 746f 6765 7468  of arrays togeth
+00021270: 6572 2e0a 2020 2020 7374 6163 6b20 3a20  er..    stack : 
+00021280: 5374 6163 6b20 6172 7261 7973 2069 6e20  Stack arrays in 
+00021290: 7365 7175 656e 6365 2061 6c6f 6e67 2061  sequence along a
+000212a0: 206e 6577 2064 696d 656e 7369 6f6e 2e0a   new dimension..
+000212b0: 2020 2020 6873 7461 636b 203a 2053 7461      hstack : Sta
+000212c0: 636b 2061 7272 6179 7320 696e 2073 6571  ck arrays in seq
+000212d0: 7565 6e63 6520 686f 7269 7a6f 6e74 616c  uence horizontal
+000212e0: 6c79 2028 636f 6c75 6d6e 2077 6973 6529  ly (column wise)
+000212f0: 2e0a 2020 2020 7673 7461 636b 203a 2053  ..    vstack : S
+00021300: 7461 636b 2061 7272 6179 7320 696e 2073  tack arrays in s
+00021310: 6571 7565 6e63 6520 7665 7274 6963 616c  equence vertical
+00021320: 6c79 2028 726f 7720 7769 7365 292e 0a20  ly (row wise).. 
+00021330: 2020 2064 7374 6163 6b20 3a20 5374 6163     dstack : Stac
+00021340: 6b20 6172 7261 7973 2069 6e20 7365 7175  k arrays in sequ
+00021350: 656e 6365 2064 6570 7468 2077 6973 6520  ence depth wise 
+00021360: 2861 6c6f 6e67 2074 6869 7264 2064 696d  (along third dim
+00021370: 656e 7369 6f6e 292e 0a20 2020 2076 7370  ension)..    vsp
+00021380: 6c69 7420 3a20 5370 6c69 7420 6172 7261  lit : Split arra
+00021390: 7920 696e 746f 2061 206c 6973 7420 6f66  y into a list of
+000213a0: 206d 756c 7469 706c 6520 7375 622d 6172   multiple sub-ar
+000213b0: 7261 7973 2076 6572 7469 6361 6c6c 792e  rays vertically.
+000213c0: 0a0a 2020 2020 4e6f 7465 730a 2020 2020  ..    Notes.    
+000213d0: 2d2d 2d2d 2d0a 0a20 2020 2057 6865 6e20  -----..    When 
+000213e0: 6361 6c6c 6564 2077 6974 6820 6f6e 6c79  called with only
+000213f0: 2073 6361 6c61 7273 2c20 6060 626c 6f63   scalars, ``bloc
+00021400: 6b60 6020 6973 2065 7175 6976 616c 656e  k`` is equivalen
+00021410: 7420 746f 2061 6e20 6e64 6172 7261 790a  t to an ndarray.
+00021420: 2020 2020 6361 6c6c 2e20 536f 2060 6062      call. So ``b
+00021430: 6c6f 636b 285b 5b31 2c20 325d 2c20 5b33  lock([[1, 2], [3
+00021440: 2c20 345d 5d29 6060 2069 7320 6571 7569  , 4]])`` is equi
+00021450: 7661 6c65 6e74 2074 6f0a 2020 2020 6060  valent to.    ``
+00021460: 6172 7261 7928 5b5b 312c 2032 5d2c 205b  array([[1, 2], [
+00021470: 332c 2034 5d5d 2960 602e 0a0a 2020 2020  3, 4]])``...    
+00021480: 5468 6973 2066 756e 6374 696f 6e20 646f  This function do
+00021490: 6573 206e 6f74 2065 6e66 6f72 6365 2074  es not enforce t
+000214a0: 6861 7420 7468 6520 626c 6f63 6b73 206c  hat the blocks l
+000214b0: 6965 206f 6e20 6120 6669 7865 6420 6772  ie on a fixed gr
+000214c0: 6964 2e0a 2020 2020 6060 626c 6f63 6b28  id..    ``block(
+000214d0: 5b5b 612c 2062 5d2c 205b 632c 2064 5d5d  [[a, b], [c, d]]
+000214e0: 2960 6020 6973 206e 6f74 2072 6573 7472  )`` is not restr
+000214f0: 6963 7465 6420 746f 2061 7272 6179 7320  icted to arrays 
+00021500: 6f66 2074 6865 2066 6f72 6d3a 3a0a 0a20  of the form::.. 
+00021510: 2020 2020 2020 2041 4141 6262 0a20 2020         AAAbb.   
+00021520: 2020 2020 2041 4141 6262 0a20 2020 2020       AAAbb.     
+00021530: 2020 2063 6363 4444 0a0a 2020 2020 4275     cccDD..    Bu
+00021540: 7420 6973 2061 6c73 6f20 616c 6c6f 7765  t is also allowe
+00021550: 6420 746f 2070 726f 6475 6365 2c20 666f  d to produce, fo
+00021560: 7220 736f 6d65 2060 6061 2c20 622c 2063  r some ``a, b, c
+00021570: 2c20 6460 603a 3a0a 0a20 2020 2020 2020  , d``::..       
+00021580: 2041 4141 6262 0a20 2020 2020 2020 2041   AAAbb.        A
+00021590: 4141 6262 0a20 2020 2020 2020 2063 4444  AAbb.        cDD
+000215a0: 4444 0a0a 2020 2020 5369 6e63 6520 636f  DD..    Since co
+000215b0: 6e63 6174 656e 6174 696f 6e20 6861 7070  ncatenation happ
+000215c0: 656e 7320 616c 6f6e 6720 7468 6520 6c61  ens along the la
+000215d0: 7374 2061 7869 7320 6669 7273 742c 2060  st axis first, `
+000215e0: 626c 6f63 6b60 2069 7320 5f6e 6f74 5f0a  block` is _not_.
+000215f0: 2020 2020 6361 7061 626c 6520 6f66 2070      capable of p
+00021600: 726f 6475 6369 6e67 2074 6865 2066 6f6c  roducing the fol
+00021610: 6c6f 7769 6e67 2064 6972 6563 746c 793a  lowing directly:
+00021620: 3a0a 0a20 2020 2020 2020 2041 4141 6262  :..        AAAbb
+00021630: 0a20 2020 2020 2020 2063 6363 6262 0a20  .        cccbb. 
+00021640: 2020 2020 2020 2063 6363 4444 0a0a 2020         cccDD..  
+00021650: 2020 4d61 746c 6162 2773 2022 7371 7561    Matlab's "squa
+00021660: 7265 2062 7261 636b 6574 2073 7461 636b  re bracket stack
+00021670: 696e 6722 2c20 6060 5b41 2c20 422c 202e  ing", ``[A, B, .
+00021680: 2e2e 3b20 702c 2071 2c20 2e2e 2e5d 6060  ..; p, q, ...]``
+00021690: 2c20 6973 0a20 2020 2065 7175 6976 616c  , is.    equival
+000216a0: 656e 7420 746f 2060 6062 6c6f 636b 285b  ent to ``block([
+000216b0: 5b41 2c20 422c 202e 2e2e 5d2c 205b 702c  [A, B, ...], [p,
+000216c0: 2071 2c20 2e2e 2e5d 5d29 6060 2e0a 2020   q, ...]])``..  
+000216d0: 2020 2222 220a 0a20 2020 2023 2054 6869    """..    # Thi
+000216e0: 7320 7761 7320 636f 7069 6564 2061 6c6d  s was copied alm
+000216f0: 6f73 7420 7665 7262 6174 696d 2066 726f  ost verbatim fro
+00021700: 6d20 6e75 6d70 792e 636f 7265 2e73 6861  m numpy.core.sha
+00021710: 7065 5f62 6173 652e 626c 6f63 6b0a 2020  pe_base.block.  
+00021720: 2020 2320 5365 6520 6e75 6d70 7920 6c69    # See numpy li
+00021730: 6365 6e73 6520 6174 2068 7474 7073 3a2f  cense at https:/
+00021740: 2f67 6974 6875 622e 636f 6d2f 6e75 6d70  /github.com/nump
+00021750: 792f 6e75 6d70 792f 626c 6f62 2f6d 6173  y/numpy/blob/mas
+00021760: 7465 722f 4c49 4345 4e53 452e 7478 740a  ter/LICENSE.txt.
+00021770: 2020 2020 2320 6f72 204e 554d 5059 5f4c      # or NUMPY_L
+00021780: 4943 454e 5345 2e74 7874 2077 6974 6869  ICENSE.txt withi
+00021790: 6e20 7468 6973 2064 6972 6563 746f 7279  n this directory
+000217a0: 0a0a 2020 2020 6465 6620 6174 6c65 6173  ..    def atleas
+000217b0: 745f 6e64 2878 2c20 6e64 696d 293a 0a20  t_nd(x, ndim):. 
+000217c0: 2020 2020 2020 2078 203d 2061 7361 6e79         x = asany
+000217d0: 6172 7261 7928 7829 0a20 2020 2020 2020  array(x).       
+000217e0: 2064 6966 6620 3d20 6d61 7828 6e64 696d   diff = max(ndim
+000217f0: 202d 2078 2e6e 6469 6d2c 2030 290a 2020   - x.ndim, 0).  
+00021800: 2020 2020 2020 6966 2064 6966 6620 3d3d        if diff ==
+00021810: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00021820: 7265 7475 726e 2078 0a20 2020 2020 2020  return x.       
+00021830: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00021840: 2020 2072 6574 7572 6e20 785b 284e 6f6e     return x[(Non
+00021850: 652c 2920 2a20 6469 6666 202b 2028 456c  e,) * diff + (El
+00021860: 6c69 7073 6973 2c29 5d0a 0a20 2020 2064  lipsis,)]..    d
+00021870: 6566 2066 6f72 6d61 745f 696e 6465 7828  ef format_index(
+00021880: 696e 6465 7829 3a0a 2020 2020 2020 2020  index):.        
+00021890: 7265 7475 726e 2022 6172 7261 7973 2220  return "arrays" 
+000218a0: 2b20 2222 2e6a 6f69 6e28 6622 5b7b 697d  + "".join(f"[{i}
+000218b0: 5d22 2066 6f72 2069 2069 6e20 696e 6465  ]" for i in inde
+000218c0: 7829 0a0a 2020 2020 7265 6320 3d20 5f52  x)..    rec = _R
+000218d0: 6563 7572 7365 7228 7265 6375 7273 655f  ecurser(recurse_
+000218e0: 6966 3d6c 616d 6264 6120 783a 2074 7970  if=lambda x: typ
+000218f0: 6528 7829 2069 7320 6c69 7374 290a 0a20  e(x) is list).. 
+00021900: 2020 2023 2065 6e73 7572 6520 7468 6174     # ensure that
+00021910: 2074 6865 206c 6973 7473 2061 7265 2061   the lists are a
+00021920: 6c6c 206d 6174 6368 6564 2069 6e20 6465  ll matched in de
+00021930: 7074 680a 2020 2020 6c69 7374 5f6e 6469  pth.    list_ndi
+00021940: 6d20 3d20 4e6f 6e65 0a20 2020 2061 6e79  m = None.    any
+00021950: 5f65 6d70 7479 203d 2046 616c 7365 0a20  _empty = False. 
+00021960: 2020 2066 6f72 2069 6e64 6578 2c20 7661     for index, va
+00021970: 6c75 652c 2065 6e74 6572 696e 6720 696e  lue, entering in
+00021980: 2072 6563 2e77 616c 6b28 6172 7261 7973   rec.walk(arrays
+00021990: 293a 0a20 2020 2020 2020 2069 6620 7479  ):.        if ty
+000219a0: 7065 2876 616c 7565 2920 6973 2074 7570  pe(value) is tup
+000219b0: 6c65 3a0a 2020 2020 2020 2020 2020 2020  le:.            
+000219c0: 2320 6e6f 7420 7374 7269 6374 6c79 206e  # not strictly n
+000219d0: 6563 6573 7361 7279 2c20 6275 7420 7361  ecessary, but sa
+000219e0: 7665 7320 7573 2066 726f 6d3a 0a20 2020  ves us from:.   
+000219f0: 2020 2020 2020 2020 2023 2020 2d20 6d6f           #  - mo
+00021a00: 7265 2074 6861 6e20 6f6e 6520 7761 7920  re than one way 
+00021a10: 746f 2064 6f20 7468 696e 6773 202d 206e  to do things - n
+00021a20: 6f20 706f 696e 7420 7472 6561 7469 6e67  o point treating
+00021a30: 2074 7570 6c65 7320 6c69 6b65 0a20 2020   tuples like.   
+00021a40: 2020 2020 2020 2020 2023 2020 2020 6c69           #    li
+00021a50: 7374 730a 2020 2020 2020 2020 2020 2020  sts.            
+00021a60: 2320 202d 2068 6f72 7269 626c 7920 636f  #  - horribly co
+00021a70: 6e66 7573 696e 6720 6265 6861 7669 6f75  nfusing behaviou
+00021a80: 7220 7468 6174 2072 6573 756c 7473 2077  r that results w
+00021a90: 6865 6e20 7475 706c 6573 2061 7265 0a20  hen tuples are. 
+00021aa0: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+00021ab0: 7472 6561 7465 6420 6c69 6b65 206e 6461  treated like nda
+00021ac0: 7272 6179 0a20 2020 2020 2020 2020 2020  rray.           
+00021ad0: 2072 6169 7365 2054 7970 6545 7272 6f72   raise TypeError
+00021ae0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00021af0: 2020 227b 7d20 6973 2061 2074 7570 6c65    "{} is a tuple
+00021b00: 2e20 220a 2020 2020 2020 2020 2020 2020  . ".            
+00021b10: 2020 2020 224f 6e6c 7920 6c69 7374 7320      "Only lists 
+00021b20: 6361 6e20 6265 2075 7365 6420 746f 2061  can be used to a
+00021b30: 7272 616e 6765 2062 6c6f 636b 732c 2061  rrange blocks, a
+00021b40: 6e64 206e 702e 626c 6f63 6b20 646f 6573  nd np.block does
+00021b50: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00021b60: 2020 2022 6e6f 7420 616c 6c6f 7720 696d     "not allow im
+00021b70: 706c 6963 6974 2063 6f6e 7665 7273 696f  plicit conversio
+00021b80: 6e20 6672 6f6d 2074 7570 6c65 2074 6f20  n from tuple to 
+00021b90: 6e64 6172 7261 792e 222e 666f 726d 6174  ndarray.".format
+00021ba0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00021bb0: 2020 2020 2020 666f 726d 6174 5f69 6e64        format_ind
+00021bc0: 6578 2869 6e64 6578 290a 2020 2020 2020  ex(index).      
+00021bd0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00021be0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00021bf0: 2020 6966 206e 6f74 2065 6e74 6572 696e    if not enterin
+00021c00: 673a 0a20 2020 2020 2020 2020 2020 2063  g:.            c
+00021c10: 7572 725f 6465 7074 6820 3d20 6c65 6e28  urr_depth = len(
+00021c20: 696e 6465 7829 0a20 2020 2020 2020 2065  index).        e
+00021c30: 6c69 6620 6c65 6e28 7661 6c75 6529 203d  lif len(value) =
+00021c40: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00021c50: 2063 7572 725f 6465 7074 6820 3d20 6c65   curr_depth = le
+00021c60: 6e28 696e 6465 7829 202b 2031 0a20 2020  n(index) + 1.   
+00021c70: 2020 2020 2020 2020 2061 6e79 5f65 6d70           any_emp
+00021c80: 7479 203d 2054 7275 650a 2020 2020 2020  ty = True.      
+00021c90: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00021ca0: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+00021cb0: 2020 2020 2020 6966 206c 6973 745f 6e64        if list_nd
+00021cc0: 696d 2069 7320 6e6f 7420 4e6f 6e65 2061  im is not None a
+00021cd0: 6e64 206c 6973 745f 6e64 696d 2021 3d20  nd list_ndim != 
+00021ce0: 6375 7272 5f64 6570 7468 3a0a 2020 2020  curr_depth:.    
+00021cf0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00021d00: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00021d10: 2020 2020 2020 2020 2020 224c 6973 7420            "List 
+00021d20: 6465 7074 6873 2061 7265 206d 6973 6d61  depths are misma
+00021d30: 7463 6865 642e 2046 6972 7374 2065 6c65  tched. First ele
+00021d40: 6d65 6e74 2077 6173 2061 7420 6465 7074  ment was at dept
+00021d50: 6820 7b7d 2c20 220a 2020 2020 2020 2020  h {}, ".        
+00021d60: 2020 2020 2020 2020 2262 7574 2074 6865          "but the
+00021d70: 7265 2069 7320 616e 2065 6c65 6d65 6e74  re is an element
+00021d80: 2061 7420 6465 7074 6820 7b7d 2028 7b7d   at depth {} ({}
+00021d90: 2922 2e66 6f72 6d61 7428 0a20 2020 2020  )".format(.     
+00021da0: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00021db0: 6973 745f 6e64 696d 2c20 6375 7272 5f64  ist_ndim, curr_d
+00021dc0: 6570 7468 2c20 666f 726d 6174 5f69 6e64  epth, format_ind
+00021dd0: 6578 2869 6e64 6578 290a 2020 2020 2020  ex(index).      
+00021de0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00021df0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00021e00: 2020 6c69 7374 5f6e 6469 6d20 3d20 6375    list_ndim = cu
+00021e10: 7272 5f64 6570 7468 0a0a 2020 2020 2320  rr_depth..    # 
+00021e20: 646f 2074 6869 7320 6865 7265 2073 6f20  do this here so 
+00021e30: 7765 2063 6174 6368 2064 6570 7468 206d  we catch depth m
+00021e40: 6973 6d61 7463 6865 7320 6669 7273 740a  ismatches first.
+00021e50: 2020 2020 6966 2061 6e79 5f65 6d70 7479      if any_empty
+00021e60: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00021e70: 5661 6c75 6545 7272 6f72 2822 4c69 7374  ValueError("List
+00021e80: 7320 6361 6e6e 6f74 2062 6520 656d 7074  s cannot be empt
+00021e90: 7922 290a 0a20 2020 2023 2063 6f6e 7665  y")..    # conve
+00021ea0: 7274 2061 6c6c 2074 6865 2061 7272 6179  rt all the array
+00021eb0: 7320 746f 206e 6461 7272 6179 730a 2020  s to ndarrays.  
+00021ec0: 2020 6172 7261 7973 203d 2072 6563 2e6d    arrays = rec.m
+00021ed0: 6170 5f72 6564 7563 6528 6172 7261 7973  ap_reduce(arrays
+00021ee0: 2c20 665f 6d61 703d 6173 616e 7961 7272  , f_map=asanyarr
+00021ef0: 6179 2c20 665f 7265 6475 6365 3d6c 6973  ay, f_reduce=lis
+00021f00: 7429 0a0a 2020 2020 2320 6465 7465 726d  t)..    # determ
+00021f10: 696e 6520 7468 6520 6d61 7869 6d75 6d20  ine the maximum 
+00021f20: 6469 6d65 6e73 696f 6e20 6f66 2074 6865  dimension of the
+00021f30: 2065 6c65 6d65 6e74 730a 2020 2020 656c   elements.    el
+00021f40: 656d 5f6e 6469 6d20 3d20 7265 632e 6d61  em_ndim = rec.ma
+00021f50: 705f 7265 6475 6365 2861 7272 6179 732c  p_reduce(arrays,
+00021f60: 2066 5f6d 6170 3d6c 616d 6264 6120 7869   f_map=lambda xi
+00021f70: 3a20 7869 2e6e 6469 6d2c 2066 5f72 6564  : xi.ndim, f_red
+00021f80: 7563 653d 6d61 7829 0a20 2020 206e 6469  uce=max).    ndi
+00021f90: 6d20 3d20 6d61 7828 6c69 7374 5f6e 6469  m = max(list_ndi
+00021fa0: 6d2c 2065 6c65 6d5f 6e64 696d 290a 0a20  m, elem_ndim).. 
+00021fb0: 2020 2023 2066 6972 7374 2061 7869 7320     # first axis 
+00021fc0: 746f 2063 6f6e 6361 7465 6e61 7465 2061  to concatenate a
+00021fd0: 6c6f 6e67 0a20 2020 2066 6972 7374 5f61  long.    first_a
+00021fe0: 7869 7320 3d20 6e64 696d 202d 206c 6973  xis = ndim - lis
+00021ff0: 745f 6e64 696d 0a0a 2020 2020 2320 4d61  t_ndim..    # Ma
+00022000: 6b65 2061 6c6c 2074 6865 2065 6c65 6d65  ke all the eleme
+00022010: 6e74 7320 7468 6520 7361 6d65 2064 696d  nts the same dim
+00022020: 656e 7369 6f6e 0a20 2020 2061 7272 6179  ension.    array
+00022030: 7320 3d20 7265 632e 6d61 705f 7265 6475  s = rec.map_redu
+00022040: 6365 280a 2020 2020 2020 2020 6172 7261  ce(.        arra
+00022050: 7973 2c20 665f 6d61 703d 6c61 6d62 6461  ys, f_map=lambda
+00022060: 2078 693a 2061 746c 6561 7374 5f6e 6428   xi: atleast_nd(
+00022070: 7869 2c20 6e64 696d 292c 2066 5f72 6564  xi, ndim), f_red
+00022080: 7563 653d 6c69 7374 0a20 2020 2029 0a0a  uce=list.    )..
+00022090: 2020 2020 2320 636f 6e63 6174 656e 6174      # concatenat
+000220a0: 6520 696e 6e65 726d 6f73 7420 6c69 7374  e innermost list
+000220b0: 7320 6f6e 2074 6865 2072 6967 6874 2c20  s on the right, 
+000220c0: 6f75 7465 726d 6f73 7420 6f6e 2074 6865  outermost on the
+000220d0: 206c 6566 740a 2020 2020 7265 7475 726e   left.    return
+000220e0: 2072 6563 2e6d 6170 5f72 6564 7563 6528   rec.map_reduce(
+000220f0: 0a20 2020 2020 2020 2061 7272 6179 732c  .        arrays,
+00022100: 0a20 2020 2020 2020 2066 5f72 6564 7563  .        f_reduc
+00022110: 653d 6c61 6d62 6461 2078 732c 2061 7869  e=lambda xs, axi
+00022120: 733a 2063 6f6e 6361 7465 6e61 7465 280a  s: concatenate(.
+00022130: 2020 2020 2020 2020 2020 2020 6c69 7374              list
+00022140: 2878 7329 2c20 6178 6973 3d61 7869 732c  (xs), axis=axis,
+00022150: 2061 6c6c 6f77 5f75 6e6b 6e6f 776e 5f63   allow_unknown_c
+00022160: 6875 6e6b 7369 7a65 733d 616c 6c6f 775f  hunksizes=allow_
+00022170: 756e 6b6e 6f77 6e5f 6368 756e 6b73 697a  unknown_chunksiz
+00022180: 6573 0a20 2020 2020 2020 2029 2c0a 2020  es.        ),.  
+00022190: 2020 2020 2020 665f 6b77 6172 6773 3d6c        f_kwargs=l
+000221a0: 616d 6264 6120 6178 6973 3a20 6469 6374  ambda axis: dict
+000221b0: 2861 7869 733d 2861 7869 7320 2b20 3129  (axis=(axis + 1)
+000221c0: 292c 0a20 2020 2020 2020 2061 7869 733d  ),.        axis=
+000221d0: 6669 7273 745f 6178 6973 2c0a 2020 2020  first_axis,.    
+000221e0: 290a 0a0a 6465 6620 636f 6e63 6174 656e  )...def concaten
+000221f0: 6174 6528 7365 712c 2061 7869 733d 302c  ate(seq, axis=0,
+00022200: 2061 6c6c 6f77 5f75 6e6b 6e6f 776e 5f63   allow_unknown_c
+00022210: 6875 6e6b 7369 7a65 733d 4661 6c73 6529  hunksizes=False)
+00022220: 3a0a 2020 2020 2222 220a 2020 2020 436f  :.    """.    Co
+00022230: 6e63 6174 656e 6174 6520 6172 7261 7973  ncatenate arrays
+00022240: 2061 6c6f 6e67 2061 6e20 6578 6973 7469   along an existi
+00022250: 6e67 2061 7869 730a 0a20 2020 2047 6976  ng axis..    Giv
+00022260: 656e 2061 2073 6571 7565 6e63 6520 6f66  en a sequence of
+00022270: 2064 6173 6b20 4172 7261 7973 2066 6f72   dask Arrays for
+00022280: 6d20 6120 6e65 7720 6461 736b 2041 7272  m a new dask Arr
+00022290: 6179 2062 7920 7374 6163 6b69 6e67 2074  ay by stacking t
+000222a0: 6865 6d0a 2020 2020 616c 6f6e 6720 616e  hem.    along an
+000222b0: 2065 7869 7374 696e 6720 6469 6d65 6e73   existing dimens
+000222c0: 696f 6e20 2861 7869 733d 3020 6279 2064  ion (axis=0 by d
+000222d0: 6566 6175 6c74 290a 0a20 2020 2050 6172  efault)..    Par
+000222e0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+000222f0: 2d2d 2d2d 2d2d 0a20 2020 2073 6571 3a20  ------.    seq: 
+00022300: 6c69 7374 206f 6620 6461 736b 2e61 7272  list of dask.arr
+00022310: 6179 730a 2020 2020 6178 6973 3a20 696e  ays.    axis: in
+00022320: 740a 2020 2020 2020 2020 4469 6d65 6e73  t.        Dimens
+00022330: 696f 6e20 616c 6f6e 6720 7768 6963 6820  ion along which 
+00022340: 746f 2061 6c69 676e 2061 6c6c 206f 6620  to align all of 
+00022350: 7468 6520 6172 7261 7973 2e20 4966 2061  the arrays. If a
+00022360: 7869 7320 6973 204e 6f6e 652c 0a20 2020  xis is None,.   
+00022370: 2020 2020 2061 7272 6179 7320 6172 6520       arrays are 
+00022380: 666c 6174 7465 6e65 6420 6265 666f 7265  flattened before
+00022390: 2075 7365 2e0a 2020 2020 616c 6c6f 775f   use..    allow_
+000223a0: 756e 6b6e 6f77 6e5f 6368 756e 6b73 697a  unknown_chunksiz
+000223b0: 6573 3a20 626f 6f6c 0a20 2020 2020 2020  es: bool.       
+000223c0: 2041 6c6c 6f77 2075 6e6b 6e6f 776e 2063   Allow unknown c
+000223d0: 6875 6e6b 7369 7a65 732c 2073 7563 6820  hunksizes, such 
+000223e0: 6173 2063 6f6d 6520 6672 6f6d 2063 6f6e  as come from con
+000223f0: 7665 7274 696e 6720 6672 6f6d 2064 6173  verting from das
+00022400: 6b0a 2020 2020 2020 2020 6461 7461 6672  k.        datafr
+00022410: 616d 6573 2e20 2044 6173 6b2e 6172 7261  ames.  Dask.arra
+00022420: 7920 6973 2075 6e61 626c 6520 746f 2076  y is unable to v
+00022430: 6572 6966 7920 7468 6174 2063 6875 6e6b  erify that chunk
+00022440: 7320 6c69 6e65 2075 702e 2020 4966 0a20  s line up.  If. 
+00022450: 2020 2020 2020 2064 6174 6120 636f 6d65         data come
+00022460: 7320 6672 6f6d 2064 6966 6665 7265 6e74  s from different
+00022470: 6c79 2061 6c69 676e 6564 2073 6f75 7263  ly aligned sourc
+00022480: 6573 2074 6865 6e20 7468 6973 2063 616e  es then this can
+00022490: 2063 6175 7365 0a20 2020 2020 2020 2075   cause.        u
+000224a0: 6e65 7870 6563 7465 6420 7265 7375 6c74  nexpected result
+000224b0: 732e 0a0a 2020 2020 4578 616d 706c 6573  s...    Examples
+000224c0: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 0a20  .    --------.. 
+000224d0: 2020 2043 7265 6174 6520 736c 6963 6573     Create slices
+000224e0: 0a0a 2020 2020 3e3e 3e20 696d 706f 7274  ..    >>> import
+000224f0: 2064 6173 6b2e 6172 7261 7920 6173 2064   dask.array as d
+00022500: 610a 2020 2020 3e3e 3e20 696d 706f 7274  a.    >>> import
+00022510: 206e 756d 7079 2061 7320 6e70 0a0a 2020   numpy as np..  
+00022520: 2020 3e3e 3e20 6461 7461 203d 205b 6461    >>> data = [da
+00022530: 2e66 726f 6d5f 6172 7261 7928 6e70 2e6f  .from_array(np.o
+00022540: 6e65 7328 2834 2c20 3429 292c 2063 6875  nes((4, 4)), chu
+00022550: 6e6b 733d 2832 2c20 3229 290a 2020 2020  nks=(2, 2)).    
+00022560: 2e2e 2e20 2020 2020 2020 2020 2066 6f72  ...          for
+00022570: 2069 2069 6e20 7261 6e67 6528 3329 5d0a   i in range(3)].
+00022580: 0a20 2020 203e 3e3e 2078 203d 2064 612e  .    >>> x = da.
+00022590: 636f 6e63 6174 656e 6174 6528 6461 7461  concatenate(data
+000225a0: 2c20 6178 6973 3d30 290a 2020 2020 3e3e  , axis=0).    >>
+000225b0: 3e20 782e 7368 6170 650a 2020 2020 2831  > x.shape.    (1
+000225c0: 322c 2034 290a 0a20 2020 203e 3e3e 2064  2, 4)..    >>> d
+000225d0: 612e 636f 6e63 6174 656e 6174 6528 6461  a.concatenate(da
+000225e0: 7461 2c20 6178 6973 3d31 292e 7368 6170  ta, axis=1).shap
+000225f0: 650a 2020 2020 2834 2c20 3132 290a 0a20  e.    (4, 12).. 
+00022600: 2020 2052 6573 756c 7420 6973 2061 206e     Result is a n
+00022610: 6577 2064 6173 6b20 4172 7261 790a 0a20  ew dask Array.. 
+00022620: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+00022630: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2073 7461  --------.    sta
+00022640: 636b 0a20 2020 2022 2222 0a20 2020 2066  ck.    """.    f
+00022650: 726f 6d20 6461 736b 2e61 7272 6179 2069  rom dask.array i
+00022660: 6d70 6f72 7420 7772 6170 0a0a 2020 2020  mport wrap..    
+00022670: 7365 7120 3d20 5b61 7361 7272 6179 2861  seq = [asarray(a
+00022680: 2c20 616c 6c6f 775f 756e 6b6e 6f77 6e5f  , allow_unknown_
+00022690: 6368 756e 6b73 697a 6573 3d61 6c6c 6f77  chunksizes=allow
+000226a0: 5f75 6e6b 6e6f 776e 5f63 6875 6e6b 7369  _unknown_chunksi
+000226b0: 7a65 7329 2066 6f72 2061 2069 6e20 7365  zes) for a in se
+000226c0: 715d 0a0a 2020 2020 6966 206e 6f74 2073  q]..    if not s
+000226d0: 6571 3a0a 2020 2020 2020 2020 7261 6973  eq:.        rais
+000226e0: 6520 5661 6c75 6545 7272 6f72 2822 4e65  e ValueError("Ne
+000226f0: 6564 2061 7272 6179 2873 2920 746f 2063  ed array(s) to c
+00022700: 6f6e 6361 7465 6e61 7465 2229 0a0a 2020  oncatenate")..  
+00022710: 2020 6966 2061 7869 7320 6973 204e 6f6e    if axis is Non
+00022720: 653a 0a20 2020 2020 2020 2073 6571 203d  e:.        seq =
+00022730: 205b 612e 666c 6174 7465 6e28 2920 666f   [a.flatten() fo
+00022740: 7220 6120 696e 2073 6571 5d0a 2020 2020  r a in seq].    
+00022750: 2020 2020 6178 6973 203d 2030 0a0a 2020      axis = 0..  
+00022760: 2020 7365 715f 6d65 7461 7320 3d20 5b6d    seq_metas = [m
+00022770: 6574 615f 6672 6f6d 5f61 7272 6179 2873  eta_from_array(s
+00022780: 2920 666f 7220 7320 696e 2073 6571 5d0a  ) for s in seq].
+00022790: 2020 2020 5f63 6f6e 6361 7465 6e61 7465      _concatenate
+000227a0: 203d 2063 6f6e 6361 7465 6e61 7465 5f6c   = concatenate_l
+000227b0: 6f6f 6b75 702e 6469 7370 6174 6368 280a  ookup.dispatch(.
+000227c0: 2020 2020 2020 2020 7479 7065 286d 6178          type(max
+000227d0: 2873 6571 5f6d 6574 6173 2c20 6b65 793d  (seq_metas, key=
+000227e0: 6c61 6d62 6461 2078 3a20 6765 7461 7474  lambda x: getatt
+000227f0: 7228 782c 2022 5f5f 6172 7261 795f 7072  r(x, "__array_pr
+00022800: 696f 7269 7479 5f5f 222c 2030 2929 290a  iority__", 0))).
+00022810: 2020 2020 290a 2020 2020 6d65 7461 203d      ).    meta =
+00022820: 205f 636f 6e63 6174 656e 6174 6528 7365   _concatenate(se
+00022830: 715f 6d65 7461 732c 2061 7869 733d 6178  q_metas, axis=ax
+00022840: 6973 290a 0a20 2020 2023 2050 726f 6d6f  is)..    # Promo
+00022850: 7465 2074 7970 6573 2074 6f20 6d61 7463  te types to matc
+00022860: 6820 6d65 7461 0a20 2020 2073 6571 203d  h meta.    seq =
+00022870: 205b 612e 6173 7479 7065 286d 6574 612e   [a.astype(meta.
+00022880: 6474 7970 6529 2066 6f72 2061 2069 6e20  dtype) for a in 
+00022890: 7365 715d 0a0a 2020 2020 2320 4669 6e64  seq]..    # Find
+000228a0: 206f 7574 7075 7420 6172 7261 7920 7368   output array sh
+000228b0: 6170 650a 2020 2020 6e64 696d 203d 206c  ape.    ndim = l
+000228c0: 656e 2873 6571 5b30 5d2e 7368 6170 6529  en(seq[0].shape)
+000228d0: 0a20 2020 2073 6861 7065 203d 2074 7570  .    shape = tup
+000228e0: 6c65 280a 2020 2020 2020 2020 7375 6d28  le(.        sum(
+000228f0: 612e 7368 6170 655b 695d 2066 6f72 2061  a.shape[i] for a
+00022900: 2069 6e20 7365 7129 2069 6620 6920 3d3d   in seq) if i ==
+00022910: 2061 7869 7320 656c 7365 2073 6571 5b30   axis else seq[0
+00022920: 5d2e 7368 6170 655b 695d 0a20 2020 2020  ].shape[i].     
+00022930: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
+00022940: 6528 6e64 696d 290a 2020 2020 290a 0a20  e(ndim).    ).. 
+00022950: 2020 2023 2044 726f 7020 656d 7074 7920     # Drop empty 
+00022960: 6172 7261 7973 0a20 2020 2073 6571 3220  arrays.    seq2 
+00022970: 3d20 5b61 2066 6f72 2061 2069 6e20 7365  = [a for a in se
+00022980: 7120 6966 2061 2e73 697a 655d 0a20 2020  q if a.size].   
+00022990: 2069 6620 6e6f 7420 7365 7132 3a0a 2020   if not seq2:.  
+000229a0: 2020 2020 2020 7365 7132 203d 2073 6571        seq2 = seq
+000229b0: 0a0a 2020 2020 6966 2061 7869 7320 3c20  ..    if axis < 
+000229c0: 303a 0a20 2020 2020 2020 2061 7869 7320  0:.        axis 
+000229d0: 3d20 6e64 696d 202b 2061 7869 730a 2020  = ndim + axis.  
+000229e0: 2020 6966 2061 7869 7320 3e3d 206e 6469    if axis >= ndi
+000229f0: 6d3a 0a20 2020 2020 2020 206d 7367 203d  m:.        msg =
+00022a00: 2028 0a20 2020 2020 2020 2020 2020 2022   (.            "
+00022a10: 4178 6973 206d 7573 7420 6265 206c 6573  Axis must be les
+00022a20: 7320 7468 616e 2074 6861 6e20 6e75 6d62  s than than numb
+00022a30: 6572 206f 6620 6469 6d65 6e73 696f 6e73  er of dimensions
+00022a40: 220a 2020 2020 2020 2020 2020 2020 225c  ".            "\
+00022a50: 6e44 6174 6120 6861 7320 2564 2064 696d  nData has %d dim
+00022a60: 656e 7369 6f6e 732c 2062 7574 2067 6f74  ensions, but got
+00022a70: 2061 7869 733d 2564 220a 2020 2020 2020   axis=%d".      
+00022a80: 2020 290a 2020 2020 2020 2020 7261 6973    ).        rais
+00022a90: 6520 5661 6c75 6545 7272 6f72 286d 7367  e ValueError(msg
+00022aa0: 2025 2028 6e64 696d 2c20 6178 6973 2929   % (ndim, axis))
+00022ab0: 0a0a 2020 2020 6e20 3d20 6c65 6e28 7365  ..    n = len(se
+00022ac0: 7132 290a 2020 2020 6966 206e 203d 3d20  q2).    if n == 
+00022ad0: 303a 0a20 2020 2020 2020 2074 7279 3a0a  0:.        try:.
+00022ae0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00022af0: 726e 2077 7261 702e 656d 7074 795f 6c69  rn wrap.empty_li
+00022b00: 6b65 286d 6574 612c 2073 6861 7065 3d73  ke(meta, shape=s
+00022b10: 6861 7065 2c20 6368 756e 6b73 3d73 6861  hape, chunks=sha
+00022b20: 7065 2c20 6474 7970 653d 6d65 7461 2e64  pe, dtype=meta.d
+00022b30: 7479 7065 290a 2020 2020 2020 2020 6578  type).        ex
+00022b40: 6365 7074 2054 7970 6545 7272 6f72 3a0a  cept TypeError:.
+00022b50: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00022b60: 726e 2077 7261 702e 656d 7074 7928 7368  rn wrap.empty(sh
+00022b70: 6170 652c 2063 6875 6e6b 733d 7368 6170  ape, chunks=shap
+00022b80: 652c 2064 7479 7065 3d6d 6574 612e 6474  e, dtype=meta.dt
+00022b90: 7970 6529 0a20 2020 2065 6c69 6620 6e20  ype).    elif n 
+00022ba0: 3d3d 2031 3a0a 2020 2020 2020 2020 7265  == 1:.        re
+00022bb0: 7475 726e 2073 6571 325b 305d 0a0a 2020  turn seq2[0]..  
+00022bc0: 2020 6966 206e 6f74 2061 6c6c 6f77 5f75    if not allow_u
+00022bd0: 6e6b 6e6f 776e 5f63 6875 6e6b 7369 7a65  nknown_chunksize
+00022be0: 7320 616e 6420 6e6f 7420 616c 6c28 0a20  s and not all(. 
+00022bf0: 2020 2020 2020 2069 203d 3d20 6178 6973         i == axis
+00022c00: 206f 7220 616c 6c28 782e 7368 6170 655b   or all(x.shape[
+00022c10: 695d 203d 3d20 7365 7132 5b30 5d2e 7368  i] == seq2[0].sh
+00022c20: 6170 655b 695d 2066 6f72 2078 2069 6e20  ape[i] for x in 
+00022c30: 7365 7132 290a 2020 2020 2020 2020 666f  seq2).        fo
+00022c40: 7220 6920 696e 2072 616e 6765 286e 6469  r i in range(ndi
+00022c50: 6d29 0a20 2020 2029 3a0a 2020 2020 2020  m).    ):.      
+00022c60: 2020 6966 2061 6e79 286d 6170 286e 702e    if any(map(np.
+00022c70: 6973 6e61 6e2c 2073 6571 325b 305d 2e73  isnan, seq2[0].s
+00022c80: 6861 7065 2929 3a0a 2020 2020 2020 2020  hape)):.        
+00022c90: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+00022ca0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00022cb0: 2020 2020 2020 2254 7269 6564 2074 6f20        "Tried to 
+00022cc0: 636f 6e63 6174 656e 6174 6520 6172 7261  concatenate arra
+00022cd0: 7973 2077 6974 6820 756e 6b6e 6f77 6e22  ys with unknown"
+00022ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00022cf0: 2022 2073 6861 7065 2025 732e 5c6e 5c6e   " shape %s.\n\n
+00022d00: 5477 6f20 736f 6c75 7469 6f6e 733a 5c6e  Two solutions:\n
+00022d10: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00022d20: 2020 2220 2031 2e20 466f 7263 6520 636f    "  1. Force co
+00022d30: 6e63 6174 656e 6174 696f 6e20 7061 7373  ncatenation pass
+00022d40: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00022d50: 2020 2220 616c 6c6f 775f 756e 6b6e 6f77    " allow_unknow
+00022d60: 6e5f 6368 756e 6b73 697a 6573 3d54 7275  n_chunksizes=Tru
+00022d70: 652e 5c6e 220a 2020 2020 2020 2020 2020  e.\n".          
+00022d80: 2020 2020 2020 2220 2032 2e20 436f 6d70        "  2. Comp
+00022d90: 7574 6520 7368 6170 6573 2077 6974 6820  ute shapes with 
+00022da0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00022db0: 2020 225b 782e 636f 6d70 7574 655f 6368    "[x.compute_ch
+00022dc0: 756e 6b5f 7369 7a65 7328 2920 666f 7220  unk_sizes() for 
+00022dd0: 7820 696e 2073 6571 5d22 2025 2073 7472  x in seq]" % str
+00022de0: 2873 6571 325b 305d 2e73 6861 7065 290a  (seq2[0].shape).
+00022df0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00022e00: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00022e10: 6545 7272 6f72 2822 5368 6170 6573 2064  eError("Shapes d
+00022e20: 6f20 6e6f 7420 616c 6967 6e3a 2025 7322  o not align: %s"
+00022e30: 2c20 5b78 2e73 6861 7065 2066 6f72 2078  , [x.shape for x
+00022e40: 2069 6e20 7365 7132 5d29 0a0a 2020 2020   in seq2])..    
+00022e50: 696e 6473 203d 205b 6c69 7374 2872 616e  inds = [list(ran
+00022e60: 6765 286e 6469 6d29 2920 666f 7220 6920  ge(ndim)) for i 
+00022e70: 696e 2072 616e 6765 286e 295d 0a20 2020  in range(n)].   
+00022e80: 2066 6f72 2069 2c20 696e 6420 696e 2065   for i, ind in e
+00022e90: 6e75 6d65 7261 7465 2869 6e64 7329 3a0a  numerate(inds):.
+00022ea0: 2020 2020 2020 2020 696e 645b 6178 6973          ind[axis
+00022eb0: 5d20 3d20 2d28 6920 2b20 3129 0a0a 2020  ] = -(i + 1)..  
+00022ec0: 2020 7563 5f61 7267 7320 3d20 6c69 7374    uc_args = list
+00022ed0: 2863 6f6e 6361 7428 7a69 7028 7365 7132  (concat(zip(seq2
+00022ee0: 2c20 696e 6473 2929 290a 2020 2020 5f2c  , inds))).    _,
+00022ef0: 2073 6571 3220 3d20 756e 6966 795f 6368   seq2 = unify_ch
+00022f00: 756e 6b73 282a 7563 5f61 7267 732c 2077  unks(*uc_args, w
+00022f10: 6172 6e3d 4661 6c73 6529 0a0a 2020 2020  arn=False)..    
+00022f20: 6264 7320 3d20 5b61 2e63 6875 6e6b 7320  bds = [a.chunks 
+00022f30: 666f 7220 6120 696e 2073 6571 325d 0a0a  for a in seq2]..
+00022f40: 2020 2020 6368 756e 6b73 203d 2028 0a20      chunks = (. 
+00022f50: 2020 2020 2020 2073 6571 325b 305d 2e63         seq2[0].c
+00022f60: 6875 6e6b 735b 3a61 7869 735d 0a20 2020  hunks[:axis].   
+00022f70: 2020 2020 202b 2028 7375 6d28 2862 645b       + (sum((bd[
+00022f80: 6178 6973 5d20 666f 7220 6264 2069 6e20  axis] for bd in 
+00022f90: 6264 7329 2c20 2829 292c 290a 2020 2020  bds), ()),).    
+00022fa0: 2020 2020 2b20 7365 7132 5b30 5d2e 6368      + seq2[0].ch
+00022fb0: 756e 6b73 5b61 7869 7320 2b20 3120 3a5d  unks[axis + 1 :]
+00022fc0: 0a20 2020 2029 0a0a 2020 2020 6375 6d5f  .    )..    cum_
+00022fd0: 6469 6d73 203d 205b 305d 202b 206c 6973  dims = [0] + lis
+00022fe0: 7428 6163 6375 6d75 6c61 7465 2861 6464  t(accumulate(add
+00022ff0: 2c20 5b6c 656e 2861 2e63 6875 6e6b 735b  , [len(a.chunks[
+00023000: 6178 6973 5d29 2066 6f72 2061 2069 6e20  axis]) for a in 
+00023010: 7365 7132 5d29 290a 0a20 2020 206e 616d  seq2]))..    nam
+00023020: 6573 203d 205b 612e 6e61 6d65 2066 6f72  es = [a.name for
+00023030: 2061 2069 6e20 7365 7132 5d0a 0a20 2020   a in seq2]..   
+00023040: 206e 616d 6520 3d20 2263 6f6e 6361 7465   name = "concate
+00023050: 6e61 7465 2d22 202b 2074 6f6b 656e 697a  nate-" + tokeniz
+00023060: 6528 6e61 6d65 732c 2061 7869 7329 0a20  e(names, axis). 
+00023070: 2020 206b 6579 7320 3d20 6c69 7374 2870     keys = list(p
+00023080: 726f 6475 6374 285b 6e61 6d65 5d2c 202a  roduct([name], *
+00023090: 5b72 616e 6765 286c 656e 2862 6429 2920  [range(len(bd)) 
+000230a0: 666f 7220 6264 2069 6e20 6368 756e 6b73  for bd in chunks
+000230b0: 5d29 290a 0a20 2020 2076 616c 7565 7320  ]))..    values 
+000230c0: 3d20 5b0a 2020 2020 2020 2020 286e 616d  = [.        (nam
+000230d0: 6573 5b62 6973 6563 7428 6375 6d5f 6469  es[bisect(cum_di
+000230e0: 6d73 2c20 6b65 795b 6178 6973 202b 2031  ms, key[axis + 1
+000230f0: 5d29 202d 2031 5d2c 290a 2020 2020 2020  ]) - 1],).      
+00023100: 2020 2b20 6b65 795b 3120 3a20 6178 6973    + key[1 : axis
+00023110: 202b 2031 5d0a 2020 2020 2020 2020 2b20   + 1].        + 
+00023120: 286b 6579 5b61 7869 7320 2b20 315d 202d  (key[axis + 1] -
+00023130: 2063 756d 5f64 696d 735b 6269 7365 6374   cum_dims[bisect
+00023140: 2863 756d 5f64 696d 732c 206b 6579 5b61  (cum_dims, key[a
+00023150: 7869 7320 2b20 315d 2920 2d20 315d 2c29  xis + 1]) - 1],)
+00023160: 0a20 2020 2020 2020 202b 206b 6579 5b61  .        + key[a
+00023170: 7869 7320 2b20 3220 3a5d 0a20 2020 2020  xis + 2 :].     
+00023180: 2020 2066 6f72 206b 6579 2069 6e20 6b65     for key in ke
+00023190: 7973 0a20 2020 205d 0a0a 2020 2020 6473  ys.    ]..    ds
+000231a0: 6b20 3d20 6469 6374 287a 6970 286b 6579  k = dict(zip(key
+000231b0: 732c 2076 616c 7565 7329 290a 2020 2020  s, values)).    
+000231c0: 6772 6170 6820 3d20 4869 6768 4c65 7665  graph = HighLeve
+000231d0: 6c47 7261 7068 2e66 726f 6d5f 636f 6c6c  lGraph.from_coll
+000231e0: 6563 7469 6f6e 7328 6e61 6d65 2c20 6473  ections(name, ds
+000231f0: 6b2c 2064 6570 656e 6465 6e63 6965 733d  k, dependencies=
+00023200: 7365 7132 290a 0a20 2020 2072 6574 7572  seq2)..    retur
+00023210: 6e20 4172 7261 7928 6772 6170 682c 206e  n Array(graph, n
+00023220: 616d 652c 2063 6875 6e6b 732c 206d 6574  ame, chunks, met
+00023230: 613d 6d65 7461 290a 0a0a 6465 6620 6c6f  a=meta)...def lo
+00023240: 6164 5f73 746f 7265 5f63 6875 6e6b 280a  ad_store_chunk(.
+00023250: 2020 2020 783a 2041 6e79 2c0a 2020 2020      x: Any,.    
+00023260: 6f75 743a 2041 6e79 2c0a 2020 2020 696e  out: Any,.    in
+00023270: 6465 783a 2073 6c69 6365 2c0a 2020 2020  dex: slice,.    
+00023280: 6c6f 636b 3a20 416e 792c 0a20 2020 2072  lock: Any,.    r
+00023290: 6574 7572 6e5f 7374 6f72 6564 3a20 626f  eturn_stored: bo
+000232a0: 6f6c 2c0a 2020 2020 6c6f 6164 5f73 746f  ol,.    load_sto
+000232b0: 7265 643a 2062 6f6f 6c2c 0a29 3a0a 2020  red: bool,.):.  
+000232c0: 2020 2222 220a 2020 2020 4120 6675 6e63    """.    A func
+000232d0: 7469 6f6e 2069 6e73 6572 7465 6420 696e  tion inserted in
+000232e0: 2061 2044 6173 6b20 6772 6170 6820 666f   a Dask graph fo
+000232f0: 7220 7374 6f72 696e 6720 6120 6368 756e  r storing a chun
+00023300: 6b2e 0a0a 2020 2020 5061 7261 6d65 7465  k...    Paramete
+00023310: 7273 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d  rs.    ---------
+00023320: 2d0a 2020 2020 783a 2061 7272 6179 2d6c  -.    x: array-l
+00023330: 696b 650a 2020 2020 2020 2020 416e 2061  ike.        An a
+00023340: 7272 6179 2028 706f 7465 6e74 6961 6c6c  rray (potentiall
+00023350: 7920 6120 4e75 6d50 7920 6f6e 6529 0a20  y a NumPy one). 
+00023360: 2020 206f 7574 3a20 6172 7261 792d 6c69     out: array-li
+00023370: 6b65 0a20 2020 2020 2020 2057 6865 7265  ke.        Where
+00023380: 2074 6f20 7374 6f72 6520 7265 7375 6c74   to store result
+00023390: 732e 0a20 2020 2069 6e64 6578 3a20 736c  s..    index: sl
+000233a0: 6963 652d 6c69 6b65 0a20 2020 2020 2020  ice-like.       
+000233b0: 2057 6865 7265 2074 6f20 7374 6f72 6520   Where to store 
+000233c0: 7265 7375 6c74 2066 726f 6d20 6060 7860  result from ``x`
+000233d0: 6020 696e 2060 606f 7574 6060 2e0a 2020  ` in ``out``..  
+000233e0: 2020 6c6f 636b 3a20 4c6f 636b 2d6c 696b    lock: Lock-lik
+000233f0: 6520 6f72 2046 616c 7365 0a20 2020 2020  e or False.     
+00023400: 2020 204c 6f63 6b20 746f 2075 7365 2062     Lock to use b
+00023410: 6566 6f72 6520 7772 6974 696e 6720 746f  efore writing to
+00023420: 2060 606f 7574 6060 2e0a 2020 2020 7265   ``out``..    re
+00023430: 7475 726e 5f73 746f 7265 643a 2062 6f6f  turn_stored: boo
+00023440: 6c0a 2020 2020 2020 2020 5768 6574 6865  l.        Whethe
+00023450: 7220 746f 2072 6574 7572 6e20 6060 6f75  r to return ``ou
+00023460: 7460 602e 0a20 2020 206c 6f61 645f 7374  t``..    load_st
+00023470: 6f72 6564 3a20 626f 6f6c 0a20 2020 2020  ored: bool.     
+00023480: 2020 2057 6865 7468 6572 2074 6f20 7265     Whether to re
+00023490: 7475 726e 2074 6865 2061 7272 6179 2073  turn the array s
+000234a0: 746f 7265 6420 696e 2060 606f 7574 6060  tored in ``out``
+000234b0: 2e0a 2020 2020 2020 2020 4967 6e6f 7265  ..        Ignore
+000234c0: 6420 6966 2060 6072 6574 7572 6e5f 7374  d if ``return_st
+000234d0: 6f72 6564 6060 2069 7320 6e6f 7420 6060  ored`` is not ``
+000234e0: 5472 7565 6060 2e0a 0a20 2020 2052 6574  True``...    Ret
+000234f0: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+00023500: 0a0a 2020 2020 4966 2072 6574 7572 6e5f  ..    If return_
+00023510: 7374 6f72 6564 3d54 7275 6520 616e 6420  stored=True and 
+00023520: 6c6f 6164 5f73 746f 7265 643d 4661 6c73  load_stored=Fals
+00023530: 650a 2020 2020 2020 2020 6f75 740a 2020  e.        out.  
+00023540: 2020 4966 2072 6574 7572 6e5f 7374 6f72    If return_stor
+00023550: 6564 3d54 7275 6520 616e 6420 6c6f 6164  ed=True and load
+00023560: 5f73 746f 7265 643d 5472 7565 0a20 2020  _stored=True.   
+00023570: 2020 2020 206f 7574 5b69 6e64 6578 5d0a       out[index].
+00023580: 2020 2020 4966 2072 6574 7572 6e5f 7374      If return_st
+00023590: 6f72 6564 3d46 616c 7365 2061 6e64 2063  ored=False and c
+000235a0: 6f6d 7075 7465 3d46 616c 7365 0a20 2020  ompute=False.   
+000235b0: 2020 2020 204e 6f6e 650a 0a20 2020 2045       None..    E
+000235c0: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
+000235d0: 2d2d 2d2d 0a0a 2020 2020 3e3e 3e20 6120  ----..    >>> a 
+000235e0: 3d20 6e70 2e6f 6e65 7328 2835 2c20 3629  = np.ones((5, 6)
+000235f0: 290a 2020 2020 3e3e 3e20 6220 3d20 6e70  ).    >>> b = np
+00023600: 2e65 6d70 7479 2861 2e73 6861 7065 290a  .empty(a.shape).
+00023610: 2020 2020 3e3e 3e20 6c6f 6164 5f73 746f      >>> load_sto
+00023620: 7265 5f63 6875 6e6b 2861 2c20 622c 2028  re_chunk(a, b, (
+00023630: 736c 6963 6528 4e6f 6e65 292c 2073 6c69  slice(None), sli
+00023640: 6365 284e 6f6e 6529 292c 2046 616c 7365  ce(None)), False
+00023650: 2c20 4661 6c73 652c 2046 616c 7365 290a  , False, False).
+00023660: 2020 2020 2222 220a 2020 2020 6966 206c      """.    if l
+00023670: 6f63 6b3a 0a20 2020 2020 2020 206c 6f63  ock:.        loc
+00023680: 6b2e 6163 7175 6972 6528 290a 2020 2020  k.acquire().    
+00023690: 7472 793a 0a20 2020 2020 2020 2069 6620  try:.        if 
+000236a0: 7820 6973 206e 6f74 204e 6f6e 6520 616e  x is not None an
+000236b0: 6420 782e 7369 7a65 2021 3d20 303a 0a20  d x.size != 0:. 
+000236c0: 2020 2020 2020 2020 2020 2069 6620 6973             if is
+000236d0: 5f61 7272 6179 6c69 6b65 2878 293a 0a20  _arraylike(x):. 
+000236e0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+000236f0: 7574 5b69 6e64 6578 5d20 3d20 780a 2020  ut[index] = x.  
+00023700: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00023710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00023720: 6f75 745b 696e 6465 785d 203d 206e 702e  out[index] = np.
+00023730: 6173 616e 7961 7272 6179 2878 290a 0a20  asanyarray(x).. 
+00023740: 2020 2020 2020 2069 6620 7265 7475 726e         if return
+00023750: 5f73 746f 7265 6420 616e 6420 6c6f 6164  _stored and load
+00023760: 5f73 746f 7265 643a 0a20 2020 2020 2020  _stored:.       
+00023770: 2020 2020 2072 6574 7572 6e20 6f75 745b       return out[
+00023780: 696e 6465 785d 0a20 2020 2020 2020 2065  index].        e
+00023790: 6c69 6620 7265 7475 726e 5f73 746f 7265  lif return_store
+000237a0: 6420 616e 6420 6e6f 7420 6c6f 6164 5f73  d and not load_s
+000237b0: 746f 7265 643a 0a20 2020 2020 2020 2020  tored:.         
+000237c0: 2020 2072 6574 7572 6e20 6f75 740a 2020     return out.  
+000237d0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+000237e0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
+000237f0: 6f6e 650a 2020 2020 6669 6e61 6c6c 793a  one.    finally:
+00023800: 0a20 2020 2020 2020 2069 6620 6c6f 636b  .        if lock
+00023810: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
+00023820: 636b 2e72 656c 6561 7365 2829 0a0a 0a64  ck.release()...d
+00023830: 6566 2073 746f 7265 5f63 6875 6e6b 280a  ef store_chunk(.
+00023840: 2020 2020 783a 2041 7272 6179 4c69 6b65      x: ArrayLike
+00023850: 2c20 6f75 743a 2041 7272 6179 4c69 6b65  , out: ArrayLike
+00023860: 2c20 696e 6465 783a 2073 6c69 6365 2c20  , index: slice, 
+00023870: 6c6f 636b 3a20 416e 792c 2072 6574 7572  lock: Any, retur
+00023880: 6e5f 7374 6f72 6564 3a20 626f 6f6c 0a29  n_stored: bool.)
+00023890: 3a0a 2020 2020 7265 7475 726e 206c 6f61  :.    return loa
+000238a0: 645f 7374 6f72 655f 6368 756e 6b28 782c  d_store_chunk(x,
+000238b0: 206f 7574 2c20 696e 6465 782c 206c 6f63   out, index, loc
+000238c0: 6b2c 2072 6574 7572 6e5f 7374 6f72 6564  k, return_stored
+000238d0: 2c20 4661 6c73 6529 0a0a 0a41 203d 2054  , False)...A = T
+000238e0: 7970 6556 6172 2822 4122 2c20 626f 756e  ypeVar("A", boun
+000238f0: 643d 4172 7261 794c 696b 6529 0a0a 0a64  d=ArrayLike)...d
+00023900: 6566 206c 6f61 645f 6368 756e 6b28 6f75  ef load_chunk(ou
+00023910: 743a 2041 2c20 696e 6465 783a 2073 6c69  t: A, index: sli
+00023920: 6365 2c20 6c6f 636b 3a20 416e 7929 202d  ce, lock: Any) -
+00023930: 3e20 413a 0a20 2020 2072 6574 7572 6e20  > A:.    return 
+00023940: 6c6f 6164 5f73 746f 7265 5f63 6875 6e6b  load_store_chunk
+00023950: 284e 6f6e 652c 206f 7574 2c20 696e 6465  (None, out, inde
+00023960: 782c 206c 6f63 6b2c 2054 7275 652c 2054  x, lock, True, T
+00023970: 7275 6529 0a0a 0a64 6566 2069 6e73 6572  rue)...def inser
+00023980: 745f 746f 5f6f 6f63 280a 2020 2020 6b65  t_to_ooc(.    ke
+00023990: 7973 3a20 6c69 7374 2c0a 2020 2020 6368  ys: list,.    ch
+000239a0: 756e 6b73 3a20 7475 706c 655b 7475 706c  unks: tuple[tupl
+000239b0: 655b 696e 742c 202e 2e2e 5d2c 202e 2e2e  e[int, ...], ...
+000239c0: 5d2c 0a20 2020 206f 7574 3a20 4172 7261  ],.    out: Arra
+000239d0: 794c 696b 652c 0a20 2020 206e 616d 653a  yLike,.    name:
+000239e0: 2073 7472 2c0a 2020 2020 2a2c 0a20 2020   str,.    *,.   
+000239f0: 206c 6f63 6b3a 204c 6f63 6b20 7c20 626f   lock: Lock | bo
+00023a00: 6f6c 203d 2054 7275 652c 0a20 2020 2072  ol = True,.    r
+00023a10: 6567 696f 6e3a 2074 7570 6c65 5b73 6c69  egion: tuple[sli
+00023a20: 6365 2c20 2e2e 2e5d 207c 2073 6c69 6365  ce, ...] | slice
+00023a30: 207c 204e 6f6e 6520 3d20 4e6f 6e65 2c0a   | None = None,.
+00023a40: 2020 2020 7265 7475 726e 5f73 746f 7265      return_store
+00023a50: 643a 2062 6f6f 6c20 3d20 4661 6c73 652c  d: bool = False,
+00023a60: 0a20 2020 206c 6f61 645f 7374 6f72 6564  .    load_stored
+00023a70: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
+00023a80: 2920 2d3e 2064 6963 743a 0a20 2020 2022  ) -> dict:.    "
+00023a90: 2222 0a20 2020 2043 7265 6174 6573 2061  "".    Creates a
+00023aa0: 2044 6173 6b20 6772 6170 6820 666f 7220   Dask graph for 
+00023ab0: 7374 6f72 696e 6720 6368 756e 6b73 2066  storing chunks f
+00023ac0: 726f 6d20 6060 6172 7260 6020 696e 2060  rom ``arr`` in `
+00023ad0: 606f 7574 6060 2e0a 0a20 2020 2050 6172  `out``...    Par
+00023ae0: 616d 6574 6572 730a 2020 2020 2d2d 2d2d  ameters.    ----
+00023af0: 2d2d 2d2d 2d2d 0a20 2020 206b 6579 733a  ------.    keys:
+00023b00: 206c 6973 740a 2020 2020 2020 2020 4461   list.        Da
+00023b10: 736b 206b 6579 7320 6f66 2074 6865 2069  sk keys of the i
+00023b20: 6e70 7574 2061 7272 6179 0a20 2020 2063  nput array.    c
+00023b30: 6875 6e6b 733a 2074 7570 6c65 0a20 2020  hunks: tuple.   
+00023b40: 2020 2020 2044 6173 6b20 6368 756e 6b73       Dask chunks
+00023b50: 206f 6620 7468 6520 696e 7075 7420 6172   of the input ar
+00023b60: 7261 790a 2020 2020 6f75 743a 2061 7272  ray.    out: arr
+00023b70: 6179 2d6c 696b 650a 2020 2020 2020 2020  ay-like.        
+00023b80: 5768 6572 6520 746f 2073 746f 7265 2072  Where to store r
+00023b90: 6573 756c 7473 2074 6f0a 2020 2020 6e61  esults to.    na
+00023ba0: 6d65 3a20 7374 720a 2020 2020 2020 2020  me: str.        
+00023bb0: 4669 7273 7420 656c 656d 656e 7420 6f66  First element of
+00023bc0: 2064 6173 6b20 6b65 7973 0a20 2020 206c   dask keys.    l
+00023bd0: 6f63 6b3a 204c 6f63 6b2d 6c69 6b65 206f  ock: Lock-like o
+00023be0: 7220 626f 6f6c 2c20 6f70 7469 6f6e 616c  r bool, optional
+00023bf0: 0a20 2020 2020 2020 2057 6865 7468 6572  .        Whether
+00023c00: 2074 6f20 6c6f 636b 206f 7220 7769 7468   to lock or with
+00023c10: 2077 6861 7420 2864 6566 6175 6c74 2069   what (default i
+00023c20: 7320 6060 5472 7565 6060 2c0a 2020 2020  s ``True``,.    
+00023c30: 2020 2020 7768 6963 6820 6d65 616e 7320      which means 
+00023c40: 6120 3a63 6c61 7373 3a60 7468 7265 6164  a :class:`thread
+00023c50: 696e 672e 4c6f 636b 6020 696e 7374 616e  ing.Lock` instan
+00023c60: 6365 292e 0a20 2020 2072 6567 696f 6e3a  ce)..    region:
+00023c70: 2073 6c69 6365 2d6c 696b 652c 206f 7074   slice-like, opt
+00023c80: 696f 6e61 6c0a 2020 2020 2020 2020 5768  ional.        Wh
+00023c90: 6572 6520 696e 2060 606f 7574 6060 2074  ere in ``out`` t
+00023ca0: 6f20 7374 6f72 6520 6060 6172 7260 6027  o store ``arr``'
+00023cb0: 7320 7265 7375 6c74 730a 2020 2020 2020  s results.      
+00023cc0: 2020 2864 6566 6175 6c74 2069 7320 6060    (default is ``
+00023cd0: 4e6f 6e65 6060 2c20 6d65 616e 696e 6720  None``, meaning 
+00023ce0: 616c 6c20 6f66 2060 606f 7574 6060 292e  all of ``out``).
+00023cf0: 0a20 2020 2072 6574 7572 6e5f 7374 6f72  .    return_stor
+00023d00: 6564 3a20 626f 6f6c 2c20 6f70 7469 6f6e  ed: bool, option
+00023d10: 616c 0a20 2020 2020 2020 2057 6865 7468  al.        Wheth
+00023d20: 6572 2074 6f20 7265 7475 726e 2060 606f  er to return ``o
+00023d30: 7574 6060 0a20 2020 2020 2020 2028 6465  ut``.        (de
+00023d40: 6661 756c 7420 6973 2060 6046 616c 7365  fault is ``False
+00023d50: 6060 2c20 6d65 616e 696e 6720 6060 4e6f  ``, meaning ``No
+00023d60: 6e65 6060 2069 7320 7265 7475 726e 6564  ne`` is returned
+00023d70: 292e 0a20 2020 206c 6f61 645f 7374 6f72  )..    load_stor
+00023d80: 6564 3a20 626f 6f6c 2c20 6f70 7469 6f6e  ed: bool, option
+00023d90: 616c 0a20 2020 2020 2020 2057 6865 7468  al.        Wheth
+00023da0: 6572 2074 6f20 6861 6e64 6c69 6e67 206c  er to handling l
+00023db0: 6f61 6469 6e67 2066 726f 6d20 6060 6f75  oading from ``ou
+00023dc0: 7460 6020 6174 2074 6865 2073 616d 6520  t`` at the same 
+00023dd0: 7469 6d65 2e0a 2020 2020 2020 2020 4967  time..        Ig
+00023de0: 6e6f 7265 6420 6966 2060 6072 6574 7572  nored if ``retur
+00023df0: 6e5f 7374 6f72 6564 6060 2069 7320 6e6f  n_stored`` is no
+00023e00: 7420 6060 5472 7565 6060 2e0a 2020 2020  t ``True``..    
+00023e10: 2020 2020 2864 6566 6175 6c74 2069 7320      (default is 
+00023e20: 6060 4661 6c73 6560 602c 206d 6561 6e69  ``False``, meani
+00023e30: 6e67 2064 6566 6572 2074 6f20 6060 7265  ng defer to ``re
+00023e40: 7475 726e 5f73 746f 7265 6460 6029 2e0a  turn_stored``)..
+00023e50: 0a20 2020 2052 6574 7572 6e73 0a20 2020  .    Returns.   
+00023e60: 202d 2d2d 2d2d 2d2d 0a20 2020 2064 6173   -------.    das
+00023e70: 6b20 6772 6170 6820 6f66 2073 746f 7265  k graph of store
+00023e80: 206f 7065 7261 7469 6f6e 0a0a 2020 2020   operation..    
+00023e90: 4578 616d 706c 6573 0a20 2020 202d 2d2d  Examples.    ---
+00023ea0: 2d2d 2d2d 2d0a 2020 2020 3e3e 3e20 696d  -----.    >>> im
+00023eb0: 706f 7274 2064 6173 6b2e 6172 7261 7920  port dask.array 
+00023ec0: 6173 2064 610a 2020 2020 3e3e 3e20 6420  as da.    >>> d 
+00023ed0: 3d20 6461 2e6f 6e65 7328 2835 2c20 3629  = da.ones((5, 6)
+00023ee0: 2c20 6368 756e 6b73 3d28 322c 2033 2929  , chunks=(2, 3))
+00023ef0: 0a20 2020 203e 3e3e 2061 203d 206e 702e  .    >>> a = np.
+00023f00: 656d 7074 7928 642e 7368 6170 6529 0a20  empty(d.shape). 
+00023f10: 2020 203e 3e3e 2069 6e73 6572 745f 746f     >>> insert_to
+00023f20: 5f6f 6f63 2864 2e5f 5f64 6173 6b5f 6b65  _ooc(d.__dask_ke
+00023f30: 7973 5f5f 2829 2c20 642e 6368 756e 6b73  ys__(), d.chunks
+00023f40: 2c20 612c 2022 7374 6f72 652d 3132 3322  , a, "store-123"
+00023f50: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
+00023f60: 4b49 500a 2020 2020 2222 220a 0a20 2020  KIP.    """..   
+00023f70: 2069 6620 6c6f 636b 2069 7320 5472 7565   if lock is True
+00023f80: 3a0a 2020 2020 2020 2020 6c6f 636b 203d  :.        lock =
+00023f90: 204c 6f63 6b28 290a 0a20 2020 2073 6c69   Lock()..    sli
+00023fa0: 6365 7320 3d20 736c 6963 6573 5f66 726f  ces = slices_fro
+00023fb0: 6d5f 6368 756e 6b73 2863 6875 6e6b 7329  m_chunks(chunks)
+00023fc0: 0a20 2020 2069 6620 7265 6769 6f6e 3a0a  .    if region:.
+00023fd0: 2020 2020 2020 2020 736c 6963 6573 203d          slices =
+00023fe0: 205b 6675 7365 5f73 6c69 6365 2872 6567   [fuse_slice(reg
+00023ff0: 696f 6e2c 2073 6c63 2920 666f 7220 736c  ion, slc) for sl
+00024000: 6320 696e 2073 6c69 6365 735d 0a0a 2020  c in slices]..  
+00024010: 2020 6966 2072 6574 7572 6e5f 7374 6f72    if return_stor
+00024020: 6564 2061 6e64 206c 6f61 645f 7374 6f72  ed and load_stor
+00024030: 6564 3a0a 2020 2020 2020 2020 6675 6e63  ed:.        func
+00024040: 203d 206c 6f61 645f 7374 6f72 655f 6368   = load_store_ch
+00024050: 756e 6b0a 2020 2020 2020 2020 6172 6773  unk.        args
+00024060: 203d 2028 6c6f 6164 5f73 746f 7265 642c   = (load_stored,
+00024070: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+00024080: 2020 2020 6675 6e63 203d 2073 746f 7265      func = store
+00024090: 5f63 6875 6e6b 2020 2320 7479 7065 3a20  _chunk  # type: 
+000240a0: 6967 6e6f 7265 0a20 2020 2020 2020 2061  ignore.        a
+000240b0: 7267 7320 3d20 2829 2020 2320 7479 7065  rgs = ()  # type
+000240c0: 3a20 6967 6e6f 7265 0a0a 2020 2020 6473  : ignore..    ds
+000240d0: 6b20 3d20 7b0a 2020 2020 2020 2020 286e  k = {.        (n
+000240e0: 616d 652c 2920 2b20 745b 313a 5d3a 2028  ame,) + t[1:]: (
+000240f0: 6675 6e63 2c20 742c 206f 7574 2c20 736c  func, t, out, sl
+00024100: 632c 206c 6f63 6b2c 2072 6574 7572 6e5f  c, lock, return_
+00024110: 7374 6f72 6564 2920 2b20 6172 6773 0a20  stored) + args. 
+00024120: 2020 2020 2020 2066 6f72 2074 2c20 736c         for t, sl
+00024130: 6320 696e 207a 6970 2863 6f72 652e 666c  c in zip(core.fl
+00024140: 6174 7465 6e28 6b65 7973 292c 2073 6c69  atten(keys), sli
+00024150: 6365 7329 0a20 2020 207d 0a20 2020 2072  ces).    }.    r
+00024160: 6574 7572 6e20 6473 6b0a 0a0a 6465 6620  eturn dsk...def 
+00024170: 7265 7472 6965 7665 5f66 726f 6d5f 6f6f  retrieve_from_oo
+00024180: 6328 0a20 2020 206b 6579 733a 2043 6f6c  c(.    keys: Col
+00024190: 6c65 6374 696f 6e5b 4b65 795d 2c20 6473  lection[Key], ds
+000241a0: 6b5f 7072 653a 2047 7261 7068 2c20 6473  k_pre: Graph, ds
+000241b0: 6b5f 706f 7374 3a20 4772 6170 680a 2920  k_post: Graph.) 
+000241c0: 2d3e 2064 6963 745b 7475 706c 652c 2041  -> dict[tuple, A
+000241d0: 6e79 5d3a 0a20 2020 2022 2222 0a20 2020  ny]:.    """.   
+000241e0: 2043 7265 6174 6573 2061 2044 6173 6b20   Creates a Dask 
+000241f0: 6772 6170 6820 666f 7220 6c6f 6164 696e  graph for loadin
+00024200: 6720 7374 6f72 6564 2060 606b 6579 7360  g stored ``keys`
+00024210: 6020 6672 6f6d 2060 6064 736b 6060 2e0a  ` from ``dsk``..
+00024220: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+00024230: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+00024240: 2020 206b 6579 733a 2043 6f6c 6c65 6374     keys: Collect
+00024250: 696f 6e0a 2020 2020 2020 2020 4120 7365  ion.        A se
+00024260: 7175 656e 6365 2063 6f6e 7461 696e 696e  quence containin
+00024270: 6720 4461 736b 2067 7261 7068 206b 6579  g Dask graph key
+00024280: 7320 746f 206c 6f61 640a 2020 2020 6473  s to load.    ds
+00024290: 6b5f 7072 653a 204d 6170 7069 6e67 0a20  k_pre: Mapping. 
+000242a0: 2020 2020 2020 2041 2044 6173 6b20 6772         A Dask gr
+000242b0: 6170 6820 636f 7272 6573 706f 6e64 696e  aph correspondin
+000242c0: 6720 746f 2061 2044 6173 6b20 4172 7261  g to a Dask Arra
+000242d0: 7920 6265 666f 7265 2063 6f6d 7075 7461  y before computa
+000242e0: 7469 6f6e 0a20 2020 2064 736b 5f70 6f73  tion.    dsk_pos
+000242f0: 743a 204d 6170 7069 6e67 0a20 2020 2020  t: Mapping.     
+00024300: 2020 2041 2044 6173 6b20 6772 6170 6820     A Dask graph 
+00024310: 636f 7272 6573 706f 6e64 696e 6720 746f  corresponding to
+00024320: 2061 2044 6173 6b20 4172 7261 7920 6166   a Dask Array af
+00024330: 7465 7220 636f 6d70 7574 6174 696f 6e0a  ter computation.
+00024340: 0a20 2020 2045 7861 6d70 6c65 730a 2020  .    Examples.  
+00024350: 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e    --------.    >
+00024360: 3e3e 2069 6d70 6f72 7420 6461 736b 2e61  >> import dask.a
+00024370: 7272 6179 2061 7320 6461 0a20 2020 203e  rray as da.    >
+00024380: 3e3e 2064 203d 2064 612e 6f6e 6573 2828  >> d = da.ones((
+00024390: 352c 2036 292c 2063 6875 6e6b 733d 2832  5, 6), chunks=(2
+000243a0: 2c20 3329 290a 2020 2020 3e3e 3e20 6120  , 3)).    >>> a 
+000243b0: 3d20 6e70 2e65 6d70 7479 2864 2e73 6861  = np.empty(d.sha
+000243c0: 7065 290a 2020 2020 3e3e 3e20 6720 3d20  pe).    >>> g = 
+000243d0: 696e 7365 7274 5f74 6f5f 6f6f 6328 642e  insert_to_ooc(d.
+000243e0: 5f5f 6461 736b 5f6b 6579 735f 5f28 292c  __dask_keys__(),
+000243f0: 2064 2e63 6875 6e6b 732c 2061 2c20 2273   d.chunks, a, "s
+00024400: 746f 7265 2d31 3233 2229 0a20 2020 203e  tore-123").    >
+00024410: 3e3e 2072 6574 7269 6576 655f 6672 6f6d  >> retrieve_from
+00024420: 5f6f 6f63 2867 2e6b 6579 7328 292c 2067  _ooc(g.keys(), g
+00024430: 2c20 7b6b 3a20 6b20 666f 7220 6b20 696e  , {k: k for k in
+00024440: 2067 2e6b 6579 7328 297d 2920 2023 2064   g.keys()})  # d
+00024450: 6f63 7465 7374 3a20 2b53 4b49 500a 2020  octest: +SKIP.  
+00024460: 2020 2222 220a 2020 2020 6c6f 6164 5f64    """.    load_d
+00024470: 736b 203d 207b 0a20 2020 2020 2020 2028  sk = {.        (
+00024480: 226c 6f61 642d 2220 2b20 6b5b 305d 2c29  "load-" + k[0],)
+00024490: 202b 206b 5b31 3a5d 3a20 286c 6f61 645f   + k[1:]: (load_
+000244a0: 6368 756e 6b2c 2064 736b 5f70 6f73 745b  chunk, dsk_post[
+000244b0: 6b5d 2920 2b20 6473 6b5f 7072 655b 6b5d  k]) + dsk_pre[k]
+000244c0: 5b33 3a2d 315d 2020 2320 7479 7065 3a20  [3:-1]  # type: 
+000244d0: 6967 6e6f 7265 0a20 2020 2020 2020 2066  ignore.        f
+000244e0: 6f72 206b 2069 6e20 6b65 7973 0a20 2020  or k in keys.   
+000244f0: 207d 0a0a 2020 2020 7265 7475 726e 206c   }..    return l
+00024500: 6f61 645f 6473 6b0a 0a0a 6465 6620 6173  oad_dsk...def as
+00024510: 6172 7261 7928 0a20 2020 2061 2c20 616c  array(.    a, al
+00024520: 6c6f 775f 756e 6b6e 6f77 6e5f 6368 756e  low_unknown_chun
+00024530: 6b73 697a 6573 3d46 616c 7365 2c20 6474  ksizes=False, dt
+00024540: 7970 653d 4e6f 6e65 2c20 6f72 6465 723d  ype=None, order=
+00024550: 4e6f 6e65 2c20 2a2c 206c 696b 653d 4e6f  None, *, like=No
+00024560: 6e65 2c20 2a2a 6b77 6172 6773 0a29 3a0a  ne, **kwargs.):.
+00024570: 2020 2020 2222 2243 6f6e 7665 7274 2074      """Convert t
+00024580: 6865 2069 6e70 7574 2074 6f20 6120 6461  he input to a da
+00024590: 736b 2061 7272 6179 2e0a 0a20 2020 2050  sk array...    P
+000245a0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+000245b0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2061 203a  --------.    a :
+000245c0: 2061 7272 6179 2d6c 696b 650a 2020 2020   array-like.    
+000245d0: 2020 2020 496e 7075 7420 6461 7461 2c20      Input data, 
+000245e0: 696e 2061 6e79 2066 6f72 6d20 7468 6174  in any form that
+000245f0: 2063 616e 2062 6520 636f 6e76 6572 7465   can be converte
+00024600: 6420 746f 2061 2064 6173 6b20 6172 7261  d to a dask arra
+00024610: 792e 2054 6869 730a 2020 2020 2020 2020  y. This.        
+00024620: 696e 636c 7564 6573 206c 6973 7473 2c20  includes lists, 
+00024630: 6c69 7374 7320 6f66 2074 7570 6c65 732c  lists of tuples,
+00024640: 2074 7570 6c65 732c 2074 7570 6c65 7320   tuples, tuples 
+00024650: 6f66 2074 7570 6c65 732c 2074 7570 6c65  of tuples, tuple
+00024660: 7320 6f66 0a20 2020 2020 2020 206c 6973  s of.        lis
+00024670: 7473 2061 6e64 206e 6461 7272 6179 732e  ts and ndarrays.
+00024680: 0a20 2020 2061 6c6c 6f77 5f75 6e6b 6e6f  .    allow_unkno
+00024690: 776e 5f63 6875 6e6b 7369 7a65 733a 2062  wn_chunksizes: b
+000246a0: 6f6f 6c0a 2020 2020 2020 2020 416c 6c6f  ool.        Allo
+000246b0: 7720 756e 6b6e 6f77 6e20 6368 756e 6b73  w unknown chunks
+000246c0: 697a 6573 2c20 7375 6368 2061 7320 636f  izes, such as co
+000246d0: 6d65 2066 726f 6d20 636f 6e76 6572 7469  me from converti
+000246e0: 6e67 2066 726f 6d20 6461 736b 0a20 2020  ng from dask.   
+000246f0: 2020 2020 2064 6174 6166 7261 6d65 732e       dataframes.
+00024700: 2020 4461 736b 2e61 7272 6179 2069 7320    Dask.array is 
+00024710: 756e 6162 6c65 2074 6f20 7665 7269 6679  unable to verify
+00024720: 2074 6861 7420 6368 756e 6b73 206c 696e   that chunks lin
+00024730: 6520 7570 2e20 2049 660a 2020 2020 2020  e up.  If.      
+00024740: 2020 6461 7461 2063 6f6d 6573 2066 726f    data comes fro
+00024750: 6d20 6469 6666 6572 656e 746c 7920 616c  m differently al
+00024760: 6967 6e65 6420 736f 7572 6365 7320 7468  igned sources th
+00024770: 656e 2074 6869 7320 6361 6e20 6361 7573  en this can caus
+00024780: 650a 2020 2020 2020 2020 756e 6578 7065  e.        unexpe
+00024790: 6374 6564 2072 6573 756c 7473 2e0a 2020  cted results..  
+000247a0: 2020 6474 7970 6520 3a20 6461 7461 2d74    dtype : data-t
+000247b0: 7970 652c 206f 7074 696f 6e61 6c0a 2020  ype, optional.  
+000247c0: 2020 2020 2020 4279 2064 6566 6175 6c74        By default
+000247d0: 2c20 7468 6520 6461 7461 2d74 7970 6520  , the data-type 
+000247e0: 6973 2069 6e66 6572 7265 6420 6672 6f6d  is inferred from
+000247f0: 2074 6865 2069 6e70 7574 2064 6174 612e   the input data.
+00024800: 0a20 2020 206f 7264 6572 203a 207b e280  .    order : {..
+00024810: 9843 e280 992c 20e2 8098 46e2 8099 2c20  .C..., ...F..., 
+00024820: e280 9841 e280 992c 20e2 8098 4be2 8099  ...A..., ...K...
+00024830: 7d2c 206f 7074 696f 6e61 6c0a 2020 2020  }, optional.    
+00024840: 2020 2020 4d65 6d6f 7279 206c 6179 6f75      Memory layou
+00024850: 742e 20e2 8098 41e2 8099 2061 6e64 20e2  t. ...A... and .
+00024860: 8098 4be2 8099 2064 6570 656e 6420 6f6e  ..K... depend on
+00024870: 2074 6865 206f 7264 6572 206f 6620 696e   the order of in
+00024880: 7075 7420 6172 7261 7920 612e 0a20 2020  put array a..   
+00024890: 2020 2020 20e2 8098 43e2 8099 2072 6f77       ...C... row
+000248a0: 2d6d 616a 6f72 2028 432d 7374 796c 6529  -major (C-style)
+000248b0: 2c20 e280 9846 e280 9920 636f 6c75 6d6e  , ...F... column
+000248c0: 2d6d 616a 6f72 2028 466f 7274 7261 6e2d  -major (Fortran-
+000248d0: 7374 796c 6529 206d 656d 6f72 790a 2020  style) memory.  
+000248e0: 2020 2020 2020 7265 7072 6573 656e 7461        representa
+000248f0: 7469 6f6e 2e20 e280 9841 e280 9920 2861  tion. ...A... (a
+00024900: 6e79 2920 6d65 616e 7320 e280 9846 e280  ny) means ...F..
+00024910: 9920 6966 2061 2069 7320 466f 7274 7261  . if a is Fortra
+00024920: 6e20 636f 6e74 6967 756f 7573 2c20 e280  n contiguous, ..
+00024930: 9843 e280 990a 2020 2020 2020 2020 6f74  .C....        ot
+00024940: 6865 7277 6973 6520 e280 984b e280 9920  herwise ...K... 
+00024950: 286b 6565 7029 2070 7265 7365 7276 6520  (keep) preserve 
+00024960: 696e 7075 7420 6f72 6465 722e 2044 6566  input order. Def
+00024970: 6175 6c74 7320 746f 20e2 8098 43e2 8099  aults to ...C...
+00024980: 2e0a 2020 2020 6c69 6b65 3a20 6172 7261  ..    like: arra
+00024990: 792d 6c69 6b65 0a20 2020 2020 2020 2052  y-like.        R
+000249a0: 6566 6572 656e 6365 206f 626a 6563 7420  eference object 
+000249b0: 746f 2061 6c6c 6f77 2074 6865 2063 7265  to allow the cre
+000249c0: 6174 696f 6e20 6f66 2044 6173 6b20 6172  ation of Dask ar
+000249d0: 7261 7973 2077 6974 6820 6368 756e 6b73  rays with chunks
+000249e0: 0a20 2020 2020 2020 2074 6861 7420 6172  .        that ar
+000249f0: 6520 6e6f 7420 4e75 6d50 7920 6172 7261  e not NumPy arra
+00024a00: 7973 2e20 4966 2061 6e20 6172 7261 792d  ys. If an array-
+00024a10: 6c69 6b65 2070 6173 7365 6420 696e 2061  like passed in a
+00024a20: 7320 6060 6c69 6b65 6060 0a20 2020 2020  s ``like``.     
+00024a30: 2020 2073 7570 706f 7274 7320 7468 6520     supports the 
+00024a40: 6060 5f5f 6172 7261 795f 6675 6e63 7469  ``__array_functi
+00024a50: 6f6e 5f5f 6060 2070 726f 746f 636f 6c2c  on__`` protocol,
+00024a60: 2074 6865 2063 6875 6e6b 2074 7970 6520   the chunk type 
+00024a70: 6f66 2074 6865 0a20 2020 2020 2020 2072  of the.        r
+00024a80: 6573 756c 7469 6e67 2061 7272 6179 2077  esulting array w
+00024a90: 696c 6c20 6265 2064 6566 696e 6564 2062  ill be defined b
+00024aa0: 7920 6974 2e20 496e 2074 6869 7320 6361  y it. In this ca
+00024ab0: 7365 2c20 6974 2065 6e73 7572 6573 2074  se, it ensures t
+00024ac0: 6865 0a20 2020 2020 2020 2063 7265 6174  he.        creat
+00024ad0: 696f 6e20 6f66 2061 2044 6173 6b20 6172  ion of a Dask ar
+00024ae0: 7261 7920 636f 6d70 6174 6962 6c65 2077  ray compatible w
+00024af0: 6974 6820 7468 6174 2070 6173 7365 6420  ith that passed 
+00024b00: 696e 2076 6961 2074 6869 730a 2020 2020  in via this.    
+00024b10: 2020 2020 6172 6775 6d65 6e74 2e20 4966      argument. If
+00024b20: 2060 606c 696b 6560 6020 6973 2061 2044   ``like`` is a D
+00024b30: 6173 6b20 6172 7261 792c 2074 6865 2063  ask array, the c
+00024b40: 6875 6e6b 2074 7970 6520 6f66 2074 6865  hunk type of the
+00024b50: 0a20 2020 2020 2020 2072 6573 756c 7469  .        resulti
+00024b60: 6e67 2061 7272 6179 2077 696c 6c20 6265  ng array will be
+00024b70: 2064 6566 696e 6564 2062 7920 7468 6520   defined by the 
+00024b80: 6368 756e 6b20 7479 7065 206f 6620 6060  chunk type of ``
+00024b90: 6c69 6b65 6060 2e0a 2020 2020 2020 2020  like``..        
+00024ba0: 5265 7175 6972 6573 204e 756d 5079 2031  Requires NumPy 1
+00024bb0: 2e32 302e 3020 6f72 2068 6967 6865 722e  .20.0 or higher.
+00024bc0: 0a0a 2020 2020 5265 7475 726e 730a 2020  ..    Returns.  
+00024bd0: 2020 2d2d 2d2d 2d2d 2d0a 2020 2020 6f75    -------.    ou
+00024be0: 7420 3a20 6461 736b 2061 7272 6179 0a20  t : dask array. 
+00024bf0: 2020 2020 2020 2044 6173 6b20 6172 7261         Dask arra
+00024c00: 7920 696e 7465 7270 7265 7461 7469 6f6e  y interpretation
+00024c10: 206f 6620 612e 0a0a 2020 2020 4578 616d   of a...    Exam
+00024c20: 706c 6573 0a20 2020 202d 2d2d 2d2d 2d2d  ples.    -------
+00024c30: 2d0a 2020 2020 3e3e 3e20 696d 706f 7274  -.    >>> import
+00024c40: 2064 6173 6b2e 6172 7261 7920 6173 2064   dask.array as d
+00024c50: 610a 2020 2020 3e3e 3e20 696d 706f 7274  a.    >>> import
+00024c60: 206e 756d 7079 2061 7320 6e70 0a20 2020   numpy as np.   
+00024c70: 203e 3e3e 2078 203d 206e 702e 6172 616e   >>> x = np.aran
+00024c80: 6765 2833 290a 2020 2020 3e3e 3e20 6461  ge(3).    >>> da
+00024c90: 2e61 7361 7272 6179 2878 290a 2020 2020  .asarray(x).    
+00024ca0: 6461 736b 2e61 7272 6179 3c61 7272 6179  dask.array<array
+00024cb0: 2c20 7368 6170 653d 2833 2c29 2c20 6474  , shape=(3,), dt
+00024cc0: 7970 653d 696e 7436 342c 2063 6875 6e6b  ype=int64, chunk
+00024cd0: 7369 7a65 3d28 332c 292c 2063 6875 6e6b  size=(3,), chunk
+00024ce0: 7479 7065 3d6e 756d 7079 2e6e 6461 7272  type=numpy.ndarr
+00024cf0: 6179 3e0a 0a20 2020 203e 3e3e 2079 203d  ay>..    >>> y =
+00024d00: 205b 5b31 2c20 322c 2033 5d2c 205b 342c   [[1, 2, 3], [4,
+00024d10: 2035 2c20 365d 5d0a 2020 2020 3e3e 3e20   5, 6]].    >>> 
+00024d20: 6461 2e61 7361 7272 6179 2879 290a 2020  da.asarray(y).  
+00024d30: 2020 6461 736b 2e61 7272 6179 3c61 7272    dask.array<arr
+00024d40: 6179 2c20 7368 6170 653d 2832 2c20 3329  ay, shape=(2, 3)
+00024d50: 2c20 6474 7970 653d 696e 7436 342c 2063  , dtype=int64, c
+00024d60: 6875 6e6b 7369 7a65 3d28 322c 2033 292c  hunksize=(2, 3),
+00024d70: 2063 6875 6e6b 7479 7065 3d6e 756d 7079   chunktype=numpy
+00024d80: 2e6e 6461 7272 6179 3e0a 2020 2020 2222  .ndarray>.    ""
+00024d90: 220a 2020 2020 6966 206c 696b 6520 6973  ".    if like is
+00024da0: 204e 6f6e 653a 0a20 2020 2020 2020 2069   None:.        i
+00024db0: 6620 6973 696e 7374 616e 6365 2861 2c20  f isinstance(a, 
+00024dc0: 4172 7261 7929 3a0a 2020 2020 2020 2020  Array):.        
+00024dd0: 2020 2020 7265 7475 726e 2061 0a20 2020      return a.   
+00024de0: 2020 2020 2065 6c69 6620 6861 7361 7474       elif hasatt
+00024df0: 7228 612c 2022 746f 5f64 6173 6b5f 6172  r(a, "to_dask_ar
+00024e00: 7261 7922 293a 0a20 2020 2020 2020 2020  ray"):.         
+00024e10: 2020 2072 6574 7572 6e20 612e 746f 5f64     return a.to_d
+00024e20: 6173 6b5f 6172 7261 7928 290a 2020 2020  ask_array().    
+00024e30: 2020 2020 656c 6966 2074 7970 6528 6129      elif type(a)
+00024e40: 2e5f 5f6d 6f64 756c 655f 5f2e 7370 6c69  .__module__.spli
+00024e50: 7428 222e 2229 5b30 5d20 3d3d 2022 7861  t(".")[0] == "xa
+00024e60: 7272 6179 2220 616e 6420 6861 7361 7474  rray" and hasatt
+00024e70: 7228 612c 2022 6461 7461 2229 3a0a 2020  r(a, "data"):.  
+00024e80: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00024e90: 2061 7361 7272 6179 2861 2e64 6174 6129   asarray(a.data)
+00024ea0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00024eb0: 696e 7374 616e 6365 2861 2c20 286c 6973  instance(a, (lis
+00024ec0: 742c 2074 7570 6c65 2929 2061 6e64 2061  t, tuple)) and a
+00024ed0: 6e79 2869 7369 6e73 7461 6e63 6528 692c  ny(isinstance(i,
+00024ee0: 2041 7272 6179 2920 666f 7220 6920 696e   Array) for i in
+00024ef0: 2061 293a 0a20 2020 2020 2020 2020 2020   a):.           
+00024f00: 2072 6574 7572 6e20 7374 6163 6b28 612c   return stack(a,
+00024f10: 2061 6c6c 6f77 5f75 6e6b 6e6f 776e 5f63   allow_unknown_c
+00024f20: 6875 6e6b 7369 7a65 733d 616c 6c6f 775f  hunksizes=allow_
+00024f30: 756e 6b6e 6f77 6e5f 6368 756e 6b73 697a  unknown_chunksiz
+00024f40: 6573 290a 2020 2020 2020 2020 656c 6966  es).        elif
+00024f50: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00024f60: 6765 7461 7474 7228 612c 2022 7368 6170  getattr(a, "shap
+00024f70: 6522 2c20 4e6f 6e65 292c 2049 7465 7261  e", None), Itera
+00024f80: 626c 6529 3a0a 2020 2020 2020 2020 2020  ble):.          
+00024f90: 2020 6120 3d20 6e70 2e61 7361 7272 6179    a = np.asarray
+00024fa0: 2861 2c20 6474 7970 653d 6474 7970 652c  (a, dtype=dtype,
+00024fb0: 206f 7264 6572 3d6f 7264 6572 290a 2020   order=order).  
+00024fc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00024fd0: 6c69 6b65 5f6d 6574 6120 3d20 6d65 7461  like_meta = meta
+00024fe0: 5f66 726f 6d5f 6172 7261 7928 6c69 6b65  _from_array(like
+00024ff0: 290a 2020 2020 2020 2020 6966 2069 7369  ).        if isi
+00025000: 6e73 7461 6e63 6528 612c 2041 7272 6179  nstance(a, Array
+00025010: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+00025020: 6574 7572 6e20 612e 6d61 705f 626c 6f63  eturn a.map_bloc
+00025030: 6b73 286e 702e 6173 6172 7261 792c 206c  ks(np.asarray, l
+00025040: 696b 653d 6c69 6b65 5f6d 6574 612c 2064  ike=like_meta, d
+00025050: 7479 7065 3d64 7479 7065 2c20 6f72 6465  type=dtype, orde
+00025060: 723d 6f72 6465 7229 0a20 2020 2020 2020  r=order).       
+00025070: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00025080: 2020 2061 203d 206e 702e 6173 6172 7261     a = np.asarra
+00025090: 7928 612c 206c 696b 653d 6c69 6b65 5f6d  y(a, like=like_m
+000250a0: 6574 612c 2064 7479 7065 3d64 7479 7065  eta, dtype=dtype
+000250b0: 2c20 6f72 6465 723d 6f72 6465 7229 0a20  , order=order). 
+000250c0: 2020 2072 6574 7572 6e20 6672 6f6d 5f61     return from_a
+000250d0: 7272 6179 2861 2c20 6765 7469 7465 6d3d  rray(a, getitem=
+000250e0: 6765 7474 6572 5f69 6e6c 696e 652c 202a  getter_inline, *
+000250f0: 2a6b 7761 7267 7329 0a0a 0a64 6566 2061  *kwargs)...def a
+00025100: 7361 6e79 6172 7261 7928 612c 2064 7479  sanyarray(a, dty
+00025110: 7065 3d4e 6f6e 652c 206f 7264 6572 3d4e  pe=None, order=N
+00025120: 6f6e 652c 202a 2c20 6c69 6b65 3d4e 6f6e  one, *, like=Non
+00025130: 652c 2069 6e6c 696e 655f 6172 7261 793d  e, inline_array=
+00025140: 4661 6c73 6529 3a0a 2020 2020 2222 2243  False):.    """C
+00025150: 6f6e 7665 7274 2074 6865 2069 6e70 7574  onvert the input
+00025160: 2074 6f20 6120 6461 736b 2061 7272 6179   to a dask array
+00025170: 2e0a 0a20 2020 2053 7562 636c 6173 7365  ...    Subclasse
+00025180: 7320 6f66 2060 606e 702e 6e64 6172 7261  s of ``np.ndarra
+00025190: 7960 6020 7769 6c6c 2062 6520 7061 7373  y`` will be pass
+000251a0: 6564 2074 6872 6f75 6768 2061 7320 6368  ed through as ch
+000251b0: 756e 6b73 2075 6e63 6861 6e67 6564 2e0a  unks unchanged..
+000251c0: 0a20 2020 2050 6172 616d 6574 6572 730a  .    Parameters.
+000251d0: 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d 0a20      ----------. 
+000251e0: 2020 2061 203a 2061 7272 6179 2d6c 696b     a : array-lik
+000251f0: 650a 2020 2020 2020 2020 496e 7075 7420  e.        Input 
+00025200: 6461 7461 2c20 696e 2061 6e79 2066 6f72  data, in any for
+00025210: 6d20 7468 6174 2063 616e 2062 6520 636f  m that can be co
+00025220: 6e76 6572 7465 6420 746f 2061 2064 6173  nverted to a das
+00025230: 6b20 6172 7261 792e 2054 6869 730a 2020  k array. This.  
+00025240: 2020 2020 2020 696e 636c 7564 6573 206c        includes l
+00025250: 6973 7473 2c20 6c69 7374 7320 6f66 2074  ists, lists of t
+00025260: 7570 6c65 732c 2074 7570 6c65 732c 2074  uples, tuples, t
+00025270: 7570 6c65 7320 6f66 2074 7570 6c65 732c  uples of tuples,
+00025280: 2074 7570 6c65 7320 6f66 0a20 2020 2020   tuples of.     
+00025290: 2020 206c 6973 7473 2061 6e64 206e 6461     lists and nda
+000252a0: 7272 6179 732e 0a20 2020 2064 7479 7065  rrays..    dtype
+000252b0: 203a 2064 6174 612d 7479 7065 2c20 6f70   : data-type, op
+000252c0: 7469 6f6e 616c 0a20 2020 2020 2020 2042  tional.        B
+000252d0: 7920 6465 6661 756c 742c 2074 6865 2064  y default, the d
+000252e0: 6174 612d 7479 7065 2069 7320 696e 6665  ata-type is infe
+000252f0: 7272 6564 2066 726f 6d20 7468 6520 696e  rred from the in
+00025300: 7075 7420 6461 7461 2e0a 2020 2020 6f72  put data..    or
+00025310: 6465 7220 3a20 7be2 8098 43e2 8099 2c20  der : {...C..., 
+00025320: e280 9846 e280 992c 20e2 8098 41e2 8099  ...F..., ...A...
+00025330: 2c20 e280 984b e280 997d 2c20 6f70 7469  , ...K...}, opti
+00025340: 6f6e 616c 0a20 2020 2020 2020 204d 656d  onal.        Mem
+00025350: 6f72 7920 6c61 796f 7574 2e20 e280 9841  ory layout. ...A
+00025360: e280 9920 616e 6420 e280 984b e280 9920  ... and ...K... 
+00025370: 6465 7065 6e64 206f 6e20 7468 6520 6f72  depend on the or
+00025380: 6465 7220 6f66 2069 6e70 7574 2061 7272  der of input arr
+00025390: 6179 2061 2e0a 2020 2020 2020 2020 e280  ay a..        ..
+000253a0: 9843 e280 9920 726f 772d 6d61 6a6f 7220  .C... row-major 
+000253b0: 2843 2d73 7479 6c65 292c 20e2 8098 46e2  (C-style), ...F.
+000253c0: 8099 2063 6f6c 756d 6e2d 6d61 6a6f 7220  .. column-major 
+000253d0: 2846 6f72 7472 616e 2d73 7479 6c65 2920  (Fortran-style) 
+000253e0: 6d65 6d6f 7279 0a20 2020 2020 2020 2072  memory.        r
+000253f0: 6570 7265 7365 6e74 6174 696f 6e2e 20e2  epresentation. .
+00025400: 8098 41e2 8099 2028 616e 7929 206d 6561  ..A... (any) mea
+00025410: 6e73 20e2 8098 46e2 8099 2069 6620 6120  ns ...F... if a 
+00025420: 6973 2046 6f72 7472 616e 2063 6f6e 7469  is Fortran conti
+00025430: 6775 6f75 732c 20e2 8098 43e2 8099 0a20  guous, ...C.... 
+00025440: 2020 2020 2020 206f 7468 6572 7769 7365         otherwise
+00025450: 20e2 8098 4be2 8099 2028 6b65 6570 2920   ...K... (keep) 
+00025460: 7072 6573 6572 7665 2069 6e70 7574 206f  preserve input o
+00025470: 7264 6572 2e20 4465 6661 756c 7473 2074  rder. Defaults t
+00025480: 6f20 e280 9843 e280 992e 0a20 2020 206c  o ...C.....    l
+00025490: 696b 653a 2061 7272 6179 2d6c 696b 650a  ike: array-like.
+000254a0: 2020 2020 2020 2020 5265 6665 7265 6e63          Referenc
+000254b0: 6520 6f62 6a65 6374 2074 6f20 616c 6c6f  e object to allo
+000254c0: 7720 7468 6520 6372 6561 7469 6f6e 206f  w the creation o
+000254d0: 6620 4461 736b 2061 7272 6179 7320 7769  f Dask arrays wi
+000254e0: 7468 2063 6875 6e6b 730a 2020 2020 2020  th chunks.      
+000254f0: 2020 7468 6174 2061 7265 206e 6f74 204e    that are not N
+00025500: 756d 5079 2061 7272 6179 732e 2049 6620  umPy arrays. If 
+00025510: 616e 2061 7272 6179 2d6c 696b 6520 7061  an array-like pa
+00025520: 7373 6564 2069 6e20 6173 2060 606c 696b  ssed in as ``lik
+00025530: 6560 600a 2020 2020 2020 2020 7375 7070  e``.        supp
+00025540: 6f72 7473 2074 6865 2060 605f 5f61 7272  orts the ``__arr
+00025550: 6179 5f66 756e 6374 696f 6e5f 5f60 6020  ay_function__`` 
+00025560: 7072 6f74 6f63 6f6c 2c20 7468 6520 6368  protocol, the ch
+00025570: 756e 6b20 7479 7065 206f 6620 7468 650a  unk type of the.
+00025580: 2020 2020 2020 2020 7265 7375 6c74 696e          resultin
+00025590: 6720 6172 7261 7920 7769 6c6c 2062 6520  g array will be 
+000255a0: 6465 6669 6e65 6420 6279 2069 742e 2049  defined by it. I
+000255b0: 6e20 7468 6973 2063 6173 652c 2069 7420  n this case, it 
+000255c0: 656e 7375 7265 7320 7468 650a 2020 2020  ensures the.    
+000255d0: 2020 2020 6372 6561 7469 6f6e 206f 6620      creation of 
+000255e0: 6120 4461 736b 2061 7272 6179 2063 6f6d  a Dask array com
+000255f0: 7061 7469 626c 6520 7769 7468 2074 6861  patible with tha
+00025600: 7420 7061 7373 6564 2069 6e20 7669 6120  t passed in via 
+00025610: 7468 6973 0a20 2020 2020 2020 2061 7267  this.        arg
+00025620: 756d 656e 742e 2049 6620 6060 6c69 6b65  ument. If ``like
+00025630: 6060 2069 7320 6120 4461 736b 2061 7272  `` is a Dask arr
+00025640: 6179 2c20 7468 6520 6368 756e 6b20 7479  ay, the chunk ty
+00025650: 7065 206f 6620 7468 650a 2020 2020 2020  pe of the.      
+00025660: 2020 7265 7375 6c74 696e 6720 6172 7261    resulting arra
+00025670: 7920 7769 6c6c 2062 6520 6465 6669 6e65  y will be define
+00025680: 6420 6279 2074 6865 2063 6875 6e6b 2074  d by the chunk t
+00025690: 7970 6520 6f66 2060 606c 696b 6560 602e  ype of ``like``.
+000256a0: 0a20 2020 2020 2020 2052 6571 7569 7265  .        Require
+000256b0: 7320 4e75 6d50 7920 312e 3230 2e30 206f  s NumPy 1.20.0 o
+000256c0: 7220 6869 6768 6572 2e0a 2020 2020 696e  r higher..    in
+000256d0: 6c69 6e65 5f61 7272 6179 3a0a 2020 2020  line_array:.    
+000256e0: 2020 2020 5768 6574 6865 7220 746f 2069      Whether to i
+000256f0: 6e6c 696e 6520 7468 6520 6172 7261 7920  nline the array 
+00025700: 696e 2074 6865 2072 6573 756c 7469 6e67  in the resulting
+00025710: 2064 6173 6b20 6772 6170 682e 2046 6f72   dask graph. For
+00025720: 206d 6f72 6520 696e 666f 726d 6174 696f   more informatio
+00025730: 6e2c 0a20 2020 2020 2020 2073 6565 2074  n,.        see t
+00025740: 6865 2064 6f63 756d 656e 7461 7469 6f6e  he documentation
+00025750: 2066 6f72 2060 6064 6173 6b2e 6172 7261   for ``dask.arra
+00025760: 792e 6672 6f6d 5f61 7272 6179 2829 6060  y.from_array()``
+00025770: 2e0a 0a20 2020 2052 6574 7572 6e73 0a20  ...    Returns. 
+00025780: 2020 202d 2d2d 2d2d 2d2d 0a20 2020 206f     -------.    o
+00025790: 7574 203a 2064 6173 6b20 6172 7261 790a  ut : dask array.
+000257a0: 2020 2020 2020 2020 4461 736b 2061 7272          Dask arr
+000257b0: 6179 2069 6e74 6572 7072 6574 6174 696f  ay interpretatio
+000257c0: 6e20 6f66 2061 2e0a 0a20 2020 2045 7861  n of a...    Exa
+000257d0: 6d70 6c65 730a 2020 2020 2d2d 2d2d 2d2d  mples.    ------
+000257e0: 2d2d 0a20 2020 203e 3e3e 2069 6d70 6f72  --.    >>> impor
+000257f0: 7420 6461 736b 2e61 7272 6179 2061 7320  t dask.array as 
+00025800: 6461 0a20 2020 203e 3e3e 2069 6d70 6f72  da.    >>> impor
+00025810: 7420 6e75 6d70 7920 6173 206e 700a 2020  t numpy as np.  
+00025820: 2020 3e3e 3e20 7820 3d20 6e70 2e61 7261    >>> x = np.ara
+00025830: 6e67 6528 3329 0a20 2020 203e 3e3e 2064  nge(3).    >>> d
+00025840: 612e 6173 616e 7961 7272 6179 2878 290a  a.asanyarray(x).
+00025850: 2020 2020 6461 736b 2e61 7272 6179 3c61      dask.array<a
+00025860: 7272 6179 2c20 7368 6170 653d 2833 2c29  rray, shape=(3,)
+00025870: 2c20 6474 7970 653d 696e 7436 342c 2063  , dtype=int64, c
+00025880: 6875 6e6b 7369 7a65 3d28 332c 292c 2063  hunksize=(3,), c
+00025890: 6875 6e6b 7479 7065 3d6e 756d 7079 2e6e  hunktype=numpy.n
+000258a0: 6461 7272 6179 3e0a 0a20 2020 203e 3e3e  darray>..    >>>
+000258b0: 2079 203d 205b 5b31 2c20 322c 2033 5d2c   y = [[1, 2, 3],
+000258c0: 205b 342c 2035 2c20 365d 5d0a 2020 2020   [4, 5, 6]].    
+000258d0: 3e3e 3e20 6461 2e61 7361 6e79 6172 7261  >>> da.asanyarra
+000258e0: 7928 7929 0a20 2020 2064 6173 6b2e 6172  y(y).    dask.ar
+000258f0: 7261 793c 6172 7261 792c 2073 6861 7065  ray<array, shape
+00025900: 3d28 322c 2033 292c 2064 7479 7065 3d69  =(2, 3), dtype=i
+00025910: 6e74 3634 2c20 6368 756e 6b73 697a 653d  nt64, chunksize=
+00025920: 2832 2c20 3329 2c20 6368 756e 6b74 7970  (2, 3), chunktyp
+00025930: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
+00025940: 0a20 2020 2022 2222 0a20 2020 2069 6620  .    """.    if 
+00025950: 6c69 6b65 2069 7320 4e6f 6e65 3a0a 2020  like is None:.  
+00025960: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00025970: 6e63 6528 612c 2041 7272 6179 293a 0a20  nce(a, Array):. 
+00025980: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00025990: 6e20 610a 2020 2020 2020 2020 656c 6966  n a.        elif
+000259a0: 2068 6173 6174 7472 2861 2c20 2274 6f5f   hasattr(a, "to_
+000259b0: 6461 736b 5f61 7272 6179 2229 3a0a 2020  dask_array"):.  
+000259c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+000259d0: 2061 2e74 6f5f 6461 736b 5f61 7272 6179   a.to_dask_array
+000259e0: 2829 0a20 2020 2020 2020 2065 6c69 6620  ().        elif 
+000259f0: 7479 7065 2861 292e 5f5f 6d6f 6475 6c65  type(a).__module
+00025a00: 5f5f 2e73 706c 6974 2822 2e22 295b 305d  __.split(".")[0]
+00025a10: 203d 3d20 2278 6172 7261 7922 2061 6e64   == "xarray" and
+00025a20: 2068 6173 6174 7472 2861 2c20 2264 6174   hasattr(a, "dat
+00025a30: 6122 293a 0a20 2020 2020 2020 2020 2020  a"):.           
+00025a40: 2072 6574 7572 6e20 6173 616e 7961 7272   return asanyarr
+00025a50: 6179 2861 2e64 6174 6129 0a20 2020 2020  ay(a.data).     
+00025a60: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
+00025a70: 6365 2861 2c20 286c 6973 742c 2074 7570  ce(a, (list, tup
+00025a80: 6c65 2929 2061 6e64 2061 6e79 2869 7369  le)) and any(isi
+00025a90: 6e73 7461 6e63 6528 692c 2041 7272 6179  nstance(i, Array
+00025aa0: 2920 666f 7220 6920 696e 2061 293a 0a20  ) for i in a):. 
+00025ab0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00025ac0: 6e20 7374 6163 6b28 6129 0a20 2020 2020  n stack(a).     
+00025ad0: 2020 2065 6c69 6620 6e6f 7420 6973 696e     elif not isin
+00025ae0: 7374 616e 6365 2867 6574 6174 7472 2861  stance(getattr(a
+00025af0: 2c20 2273 6861 7065 222c 204e 6f6e 6529  , "shape", None)
+00025b00: 2c20 4974 6572 6162 6c65 293a 0a20 2020  , Iterable):.   
+00025b10: 2020 2020 2020 2020 2061 203d 206e 702e           a = np.
+00025b20: 6173 616e 7961 7272 6179 2861 2c20 6474  asanyarray(a, dt
+00025b30: 7970 653d 6474 7970 652c 206f 7264 6572  ype=dtype, order
+00025b40: 3d6f 7264 6572 290a 2020 2020 656c 7365  =order).    else
+00025b50: 3a0a 2020 2020 2020 2020 6c69 6b65 5f6d  :.        like_m
+00025b60: 6574 6120 3d20 6d65 7461 5f66 726f 6d5f  eta = meta_from_
+00025b70: 6172 7261 7928 6c69 6b65 290a 2020 2020  array(like).    
+00025b80: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+00025b90: 6528 612c 2041 7272 6179 293a 0a20 2020  e(a, Array):.   
+00025ba0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00025bb0: 612e 6d61 705f 626c 6f63 6b73 286e 702e  a.map_blocks(np.
+00025bc0: 6173 616e 7961 7272 6179 2c20 6c69 6b65  asanyarray, like
+00025bd0: 3d6c 696b 655f 6d65 7461 2c20 6474 7970  =like_meta, dtyp
+00025be0: 653d 6474 7970 652c 206f 7264 6572 3d6f  e=dtype, order=o
+00025bf0: 7264 6572 290a 2020 2020 2020 2020 656c  rder).        el
+00025c00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00025c10: 6120 3d20 6e70 2e61 7361 6e79 6172 7261  a = np.asanyarra
+00025c20: 7928 612c 206c 696b 653d 6c69 6b65 5f6d  y(a, like=like_m
+00025c30: 6574 612c 2064 7479 7065 3d64 7479 7065  eta, dtype=dtype
+00025c40: 2c20 6f72 6465 723d 6f72 6465 7229 0a20  , order=order). 
+00025c50: 2020 2072 6574 7572 6e20 6672 6f6d 5f61     return from_a
+00025c60: 7272 6179 280a 2020 2020 2020 2020 612c  rray(.        a,
+00025c70: 0a20 2020 2020 2020 2063 6875 6e6b 733d  .        chunks=
+00025c80: 612e 7368 6170 652c 0a20 2020 2020 2020  a.shape,.       
+00025c90: 2067 6574 6974 656d 3d67 6574 7465 725f   getitem=getter_
+00025ca0: 696e 6c69 6e65 2c0a 2020 2020 2020 2020  inline,.        
+00025cb0: 6173 6172 7261 793d 4661 6c73 652c 0a20  asarray=False,. 
+00025cc0: 2020 2020 2020 2069 6e6c 696e 655f 6172         inline_ar
+00025cd0: 7261 793d 696e 6c69 6e65 5f61 7272 6179  ray=inline_array
+00025ce0: 2c0a 2020 2020 290a 0a0a 6465 6620 6973  ,.    )...def is
+00025cf0: 5f73 6361 6c61 725f 666f 725f 656c 656d  _scalar_for_elem
+00025d00: 7769 7365 2861 7267 293a 0a20 2020 2022  wise(arg):.    "
+00025d10: 2222 0a0a 2020 2020 3e3e 3e20 6973 5f73  ""..    >>> is_s
+00025d20: 6361 6c61 725f 666f 725f 656c 656d 7769  calar_for_elemwi
+00025d30: 7365 2834 3229 0a20 2020 2054 7275 650a  se(42).    True.
+00025d40: 2020 2020 3e3e 3e20 6973 5f73 6361 6c61      >>> is_scala
+00025d50: 725f 666f 725f 656c 656d 7769 7365 2827  r_for_elemwise('
+00025d60: 666f 6f27 290a 2020 2020 5472 7565 0a20  foo').    True. 
+00025d70: 2020 203e 3e3e 2069 735f 7363 616c 6172     >>> is_scalar
+00025d80: 5f66 6f72 5f65 6c65 6d77 6973 6528 5472  _for_elemwise(Tr
+00025d90: 7565 290a 2020 2020 5472 7565 0a20 2020  ue).    True.   
+00025da0: 203e 3e3e 2069 735f 7363 616c 6172 5f66   >>> is_scalar_f
+00025db0: 6f72 5f65 6c65 6d77 6973 6528 6e70 2e61  or_elemwise(np.a
+00025dc0: 7272 6179 2834 3229 290a 2020 2020 5472  rray(42)).    Tr
+00025dd0: 7565 0a20 2020 203e 3e3e 2069 735f 7363  ue.    >>> is_sc
+00025de0: 616c 6172 5f66 6f72 5f65 6c65 6d77 6973  alar_for_elemwis
+00025df0: 6528 5b31 2c20 322c 2033 5d29 0a20 2020  e([1, 2, 3]).   
+00025e00: 2054 7275 650a 2020 2020 3e3e 3e20 6973   True.    >>> is
+00025e10: 5f73 6361 6c61 725f 666f 725f 656c 656d  _scalar_for_elem
+00025e20: 7769 7365 286e 702e 6172 7261 7928 5b31  wise(np.array([1
+00025e30: 2c20 322c 2033 5d29 290a 2020 2020 4661  , 2, 3])).    Fa
+00025e40: 6c73 650a 2020 2020 3e3e 3e20 6973 5f73  lse.    >>> is_s
+00025e50: 6361 6c61 725f 666f 725f 656c 656d 7769  calar_for_elemwi
+00025e60: 7365 2866 726f 6d5f 6172 7261 7928 6e70  se(from_array(np
+00025e70: 2e61 7272 6179 2830 292c 2063 6875 6e6b  .array(0), chunk
+00025e80: 733d 2829 2929 0a20 2020 2046 616c 7365  s=())).    False
+00025e90: 0a20 2020 203e 3e3e 2069 735f 7363 616c  .    >>> is_scal
+00025ea0: 6172 5f66 6f72 5f65 6c65 6d77 6973 6528  ar_for_elemwise(
+00025eb0: 6e70 2e64 7479 7065 2827 6934 2729 290a  np.dtype('i4')).
+00025ec0: 2020 2020 5472 7565 0a20 2020 2022 2222      True.    """
+00025ed0: 0a20 2020 2023 2074 6865 2073 6563 6f6e  .    # the secon
+00025ee0: 6420 6861 6c66 206f 6620 7368 6170 655f  d half of shape_
+00025ef0: 636f 6e64 6974 696f 6e20 6973 2065 7373  condition is ess
+00025f00: 656e 7469 616c 6c79 206a 7573 7420 746f  entially just to
+00025f10: 2065 6e73 7572 6520 7468 6174 0a20 2020   ensure that.   
+00025f20: 2023 2064 6173 6b20 7365 7269 6573 202f   # dask series /
+00025f30: 2066 7261 6d65 2061 7265 2074 7265 6174   frame are treat
+00025f40: 6564 2061 7320 7363 616c 6172 7320 696e  ed as scalars in
+00025f50: 2065 6c65 6d77 6973 652e 0a20 2020 206d   elemwise..    m
+00025f60: 6179 6265 5f73 6861 7065 203d 2067 6574  aybe_shape = get
+00025f70: 6174 7472 2861 7267 2c20 2273 6861 7065  attr(arg, "shape
+00025f80: 222c 204e 6f6e 6529 0a20 2020 2073 6861  ", None).    sha
+00025f90: 7065 5f63 6f6e 6469 7469 6f6e 203d 206e  pe_condition = n
+00025fa0: 6f74 2069 7369 6e73 7461 6e63 6528 6d61  ot isinstance(ma
+00025fb0: 7962 655f 7368 6170 652c 2049 7465 7261  ybe_shape, Itera
+00025fc0: 626c 6529 206f 7220 616e 7928 0a20 2020  ble) or any(.   
+00025fd0: 2020 2020 2069 735f 6461 736b 5f63 6f6c       is_dask_col
+00025fe0: 6c65 6374 696f 6e28 7829 2066 6f72 2078  lection(x) for x
+00025ff0: 2069 6e20 6d61 7962 655f 7368 6170 650a   in maybe_shape.
+00026000: 2020 2020 290a 0a20 2020 2072 6574 7572      )..    retur
+00026010: 6e20 280a 2020 2020 2020 2020 6e70 2e69  n (.        np.i
+00026020: 7373 6361 6c61 7228 6172 6729 0a20 2020  sscalar(arg).   
+00026030: 2020 2020 206f 7220 7368 6170 655f 636f       or shape_co
+00026040: 6e64 6974 696f 6e0a 2020 2020 2020 2020  ndition.        
+00026050: 6f72 2069 7369 6e73 7461 6e63 6528 6172  or isinstance(ar
+00026060: 672c 206e 702e 6474 7970 6529 0a20 2020  g, np.dtype).   
+00026070: 2020 2020 206f 7220 2869 7369 6e73 7461       or (isinsta
+00026080: 6e63 6528 6172 672c 206e 702e 6e64 6172  nce(arg, np.ndar
+00026090: 7261 7929 2061 6e64 2061 7267 2e6e 6469  ray) and arg.ndi
+000260a0: 6d20 3d3d 2030 290a 2020 2020 290a 0a0a  m == 0).    )...
+000260b0: 6465 6620 6272 6f61 6463 6173 745f 7368  def broadcast_sh
+000260c0: 6170 6573 282a 7368 6170 6573 293a 0a20  apes(*shapes):. 
+000260d0: 2020 2022 2222 0a20 2020 2044 6574 6572     """.    Deter
+000260e0: 6d69 6e65 7320 6f75 7470 7574 2073 6861  mines output sha
+000260f0: 7065 2066 726f 6d20 6272 6f61 6463 6173  pe from broadcas
+00026100: 7469 6e67 2061 7272 6179 732e 0a0a 2020  ting arrays...  
+00026110: 2020 5061 7261 6d65 7465 7273 0a20 2020    Parameters.   
+00026120: 202d 2d2d 2d2d 2d2d 2d2d 2d0a 2020 2020   ----------.    
+00026130: 7368 6170 6573 203a 2074 7570 6c65 730a  shapes : tuples.
+00026140: 2020 2020 2020 2020 5468 6520 7368 6170          The shap
+00026150: 6573 206f 6620 7468 6520 6172 6775 6d65  es of the argume
+00026160: 6e74 732e 0a0a 2020 2020 5265 7475 726e  nts...    Return
+00026170: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
+00026180: 2020 6f75 7470 7574 5f73 6861 7065 203a    output_shape :
+00026190: 2074 7570 6c65 0a0a 2020 2020 5261 6973   tuple..    Rais
+000261a0: 6573 0a20 2020 202d 2d2d 2d2d 2d0a 2020  es.    ------.  
+000261b0: 2020 5661 6c75 6545 7272 6f72 0a20 2020    ValueError.   
+000261c0: 2020 2020 2049 6620 7468 6520 696e 7075       If the inpu
+000261d0: 7420 7368 6170 6573 2063 616e 6e6f 7420  t shapes cannot 
+000261e0: 6265 2073 7563 6365 7373 6675 6c6c 7920  be successfully 
+000261f0: 6272 6f61 6463 6173 7420 746f 6765 7468  broadcast togeth
+00026200: 6572 2e0a 2020 2020 2222 220a 2020 2020  er..    """.    
+00026210: 6966 206c 656e 2873 6861 7065 7329 203d  if len(shapes) =
+00026220: 3d20 313a 0a20 2020 2020 2020 2072 6574  = 1:.        ret
+00026230: 7572 6e20 7368 6170 6573 5b30 5d0a 2020  urn shapes[0].  
+00026240: 2020 6f75 7420 3d20 5b5d 0a20 2020 2066    out = [].    f
+00026250: 6f72 2073 697a 6573 2069 6e20 7a69 705f  or sizes in zip_
+00026260: 6c6f 6e67 6573 7428 2a6d 6170 2872 6576  longest(*map(rev
+00026270: 6572 7365 642c 2073 6861 7065 7329 2c20  ersed, shapes), 
+00026280: 6669 6c6c 7661 6c75 653d 2d31 293a 0a20  fillvalue=-1):. 
+00026290: 2020 2020 2020 2069 6620 6e70 2e69 736e         if np.isn
+000262a0: 616e 2873 697a 6573 292e 616e 7928 293a  an(sizes).any():
+000262b0: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+000262c0: 203d 206e 702e 6e61 6e0a 2020 2020 2020   = np.nan.      
+000262d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+000262e0: 2020 2020 6469 6d20 3d20 3020 6966 2030      dim = 0 if 0
+000262f0: 2069 6e20 7369 7a65 7320 656c 7365 206e   in sizes else n
+00026300: 702e 6d61 7828 7369 7a65 7329 0a20 2020  p.max(sizes).   
+00026310: 2020 2020 2069 6620 616e 7928 6920 6e6f       if any(i no
+00026320: 7420 696e 205b 2d31 2c20 302c 2031 2c20  t in [-1, 0, 1, 
+00026330: 6469 6d5d 2061 6e64 206e 6f74 206e 702e  dim] and not np.
+00026340: 6973 6e61 6e28 6929 2066 6f72 2069 2069  isnan(i) for i i
+00026350: 6e20 7369 7a65 7329 3a0a 2020 2020 2020  n sizes):.      
+00026360: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00026370: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00026380: 2020 2020 2020 2020 226f 7065 7261 6e64          "operand
+00026390: 7320 636f 756c 6420 6e6f 7420 6265 2062  s could not be b
+000263a0: 726f 6164 6361 7374 2074 6f67 6574 6865  roadcast togethe
+000263b0: 7220 7769 7468 2022 0a20 2020 2020 2020  r with ".       
+000263c0: 2020 2020 2020 2020 2022 7368 6170 6573           "shapes
+000263d0: 207b 7d22 2e66 6f72 6d61 7428 2220 222e   {}".format(" ".
+000263e0: 6a6f 696e 286d 6170 2873 7472 2c20 7368  join(map(str, sh
+000263f0: 6170 6573 2929 290a 2020 2020 2020 2020  apes))).        
+00026400: 2020 2020 290a 2020 2020 2020 2020 6f75      ).        ou
+00026410: 742e 6170 7065 6e64 2864 696d 290a 2020  t.append(dim).  
+00026420: 2020 7265 7475 726e 2074 7570 6c65 2872    return tuple(r
+00026430: 6576 6572 7365 6428 6f75 7429 290a 0a0a  eversed(out))...
+00026440: 6465 6620 656c 656d 7769 7365 286f 702c  def elemwise(op,
+00026450: 202a 6172 6773 2c20 6f75 743d 4e6f 6e65   *args, out=None
+00026460: 2c20 7768 6572 653d 5472 7565 2c20 6474  , where=True, dt
+00026470: 7970 653d 4e6f 6e65 2c20 6e61 6d65 3d4e  ype=None, name=N
+00026480: 6f6e 652c 202a 2a6b 7761 7267 7329 3a0a  one, **kwargs):.
+00026490: 2020 2020 2222 2241 7070 6c79 2061 6e20      """Apply an 
+000264a0: 656c 656d 656e 7477 6973 6520 7566 756e  elementwise ufun
+000264b0: 632d 6c69 6b65 2066 756e 6374 696f 6e20  c-like function 
+000264c0: 626c 6f63 6b77 6973 6520 6163 726f 7373  blockwise across
+000264d0: 2061 7267 756d 656e 7473 2e0a 0a20 2020   arguments...   
+000264e0: 204c 696b 6520 6e75 6d70 7920 7566 756e   Like numpy ufun
+000264f0: 6373 2c20 6272 6f61 6463 6173 7469 6e67  cs, broadcasting
+00026500: 2072 756c 6573 2061 7265 2072 6573 7065   rules are respe
+00026510: 6374 6564 2e0a 0a20 2020 2050 6172 616d  cted...    Param
+00026520: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
+00026530: 2d2d 2d2d 0a20 2020 206f 7020 3a20 6361  ----.    op : ca
+00026540: 6c6c 6162 6c65 0a20 2020 2020 2020 2054  llable.        T
+00026550: 6865 2066 756e 6374 696f 6e20 746f 2061  he function to a
+00026560: 7070 6c79 2e20 5368 6f75 6c64 2062 6520  pply. Should be 
+00026570: 6e75 6d70 7920 7566 756e 632d 6c69 6b65  numpy ufunc-like
+00026580: 2069 6e20 7468 6520 7061 7261 6d65 7465   in the paramete
+00026590: 7273 0a20 2020 2020 2020 2074 6861 7420  rs.        that 
+000265a0: 6974 2061 6363 6570 7473 2e0a 2020 2020  it accepts..    
+000265b0: 2a61 7267 7320 3a20 416e 790a 2020 2020  *args : Any.    
+000265c0: 2020 2020 4172 6775 6d65 6e74 7320 746f      Arguments to
+000265d0: 2070 6173 7320 746f 2060 6f70 602e 204e   pass to `op`. N
+000265e0: 6f6e 2d64 6173 6b20 6172 7261 792d 6c69  on-dask array-li
+000265f0: 6b65 206f 626a 6563 7473 2061 7265 2066  ke objects are f
+00026600: 6972 7374 0a20 2020 2020 2020 2063 6f6e  irst.        con
+00026610: 7665 7274 6564 2074 6f20 6461 736b 2061  verted to dask a
+00026620: 7272 6179 732c 2074 6865 6e20 616c 6c20  rrays, then all 
+00026630: 6172 7261 7973 2061 7265 2062 726f 6164  arrays are broad
+00026640: 6361 7374 2074 6f67 6574 6865 7220 6265  cast together be
+00026650: 666f 7265 0a20 2020 2020 2020 2061 7070  fore.        app
+00026660: 6c79 696e 6720 7468 6520 6675 6e63 7469  lying the functi
+00026670: 6f6e 2062 6c6f 636b 7769 7365 2061 6372  on blockwise acr
+00026680: 6f73 7320 616c 6c20 6172 6775 6d65 6e74  oss all argument
+00026690: 732e 2041 6e79 2073 6361 6c61 720a 2020  s. Any scalar.  
+000266a0: 2020 2020 2020 6172 6775 6d65 6e74 7320        arguments 
+000266b0: 6172 6520 7061 7373 6564 2061 732d 6973  are passed as-is
+000266c0: 2066 6f6c 6c6f 7769 6e67 206e 6f72 6d61   following norma
+000266d0: 6c20 6e75 6d70 7920 7566 756e 6320 6265  l numpy ufunc be
+000266e0: 6861 7669 6f72 2e0a 2020 2020 6f75 7420  havior..    out 
+000266f0: 3a20 6461 736b 2061 7272 6179 2c20 6f70  : dask array, op
+00026700: 7469 6f6e 616c 0a20 2020 2020 2020 2049  tional.        I
+00026710: 6620 6f75 7420 6973 2061 2064 6173 6b2e  f out is a dask.
+00026720: 6172 7261 7920 7468 656e 2074 6869 7320  array then this 
+00026730: 6f76 6572 7772 6974 6573 2074 6865 2063  overwrites the c
+00026740: 6f6e 7465 6e74 7320 6f66 2074 6861 7420  ontents of that 
+00026750: 6172 7261 790a 2020 2020 2020 2020 7769  array.        wi
+00026760: 7468 2074 6865 2072 6573 756c 742e 0a20  th the result.. 
+00026770: 2020 2077 6865 7265 203a 2061 7272 6179     where : array
+00026780: 5f6c 696b 652c 206f 7074 696f 6e61 6c0a  _like, optional.
+00026790: 2020 2020 2020 2020 416e 206f 7074 696f          An optio
+000267a0: 6e61 6c20 626f 6f6c 6561 6e20 6d61 736b  nal boolean mask
+000267b0: 206d 6172 6b69 6e67 206c 6f63 6174 696f   marking locatio
+000267c0: 6e73 2077 6865 7265 2074 6865 2075 6675  ns where the ufu
+000267d0: 6e63 2073 686f 756c 6420 6265 0a20 2020  nc should be.   
+000267e0: 2020 2020 2061 7070 6c69 6564 2e20 4361       applied. Ca
+000267f0: 6e20 6265 2061 2073 6361 6c61 722c 2064  n be a scalar, d
+00026800: 6173 6b20 6172 7261 792c 206f 7220 616e  ask array, or an
+00026810: 7920 6f74 6865 7220 6172 7261 792d 6c69  y other array-li
+00026820: 6b65 206f 626a 6563 742e 0a20 2020 2020  ke object..     
+00026830: 2020 204d 6972 726f 7273 2074 6865 2060     Mirrors the `
+00026840: 6077 6865 7265 6060 2061 7267 756d 656e  `where`` argumen
+00026850: 7420 746f 206e 756d 7079 2075 6675 6e63  t to numpy ufunc
+00026860: 732c 2073 6565 2065 2e67 2e20 6060 6e75  s, see e.g. ``nu
+00026870: 6d70 792e 6164 6460 600a 2020 2020 2020  mpy.add``.      
+00026880: 2020 666f 7220 6d6f 7265 2069 6e66 6f72    for more infor
+00026890: 6d61 7469 6f6e 2e0a 2020 2020 6474 7970  mation..    dtyp
+000268a0: 6520 3a20 6474 7970 652c 206f 7074 696f  e : dtype, optio
+000268b0: 6e61 6c0a 2020 2020 2020 2020 4966 2070  nal.        If p
+000268c0: 726f 7669 6465 642c 206f 7665 7272 6964  rovided, overrid
+000268d0: 6573 2074 6865 206f 7574 7075 7420 6172  es the output ar
+000268e0: 7261 7920 6474 7970 652e 0a20 2020 206e  ray dtype..    n
+000268f0: 616d 6520 3a20 7374 722c 206f 7074 696f  ame : str, optio
+00026900: 6e61 6c0a 2020 2020 2020 2020 4120 756e  nal.        A un
+00026910: 6971 7565 206b 6579 206e 616d 6520 746f  ique key name to
+00026920: 2075 7365 2077 6865 6e20 6275 696c 6469   use when buildi
+00026930: 6e67 2074 6865 2062 6163 6b69 6e67 2064  ng the backing d
+00026940: 6173 6b20 6772 6170 682e 2049 6620 6e6f  ask graph. If no
+00026950: 740a 2020 2020 2020 2020 7072 6f76 6964  t.        provid
+00026960: 6564 2c20 6f6e 6520 7769 6c6c 2062 6520  ed, one will be 
+00026970: 6175 746f 6d61 7469 6361 6c6c 7920 6765  automatically ge
+00026980: 6e65 7261 7465 6420 6261 7365 6420 6f6e  nerated based on
+00026990: 2074 6865 2069 6e70 7574 0a20 2020 2020   the input.     
+000269a0: 2020 2061 7267 756d 656e 7473 2e0a 0a20     arguments... 
+000269b0: 2020 2045 7861 6d70 6c65 730a 2020 2020     Examples.    
+000269c0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203e 3e3e  --------.    >>>
+000269d0: 2065 6c65 6d77 6973 6528 6164 642c 2078   elemwise(add, x
+000269e0: 2c20 7929 2020 2320 646f 6374 6573 743a  , y)  # doctest:
+000269f0: 202b 534b 4950 0a20 2020 203e 3e3e 2065   +SKIP.    >>> e
+00026a00: 6c65 6d77 6973 6528 7369 6e2c 2078 2920  lemwise(sin, x) 
+00026a10: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+00026a20: 500a 2020 2020 3e3e 3e20 656c 656d 7769  P.    >>> elemwi
+00026a30: 7365 2873 696e 2c20 782c 206f 7574 3d64  se(sin, x, out=d
+00026a40: 6173 6b5f 6172 7261 7929 2020 2320 646f  ask_array)  # do
+00026a50: 6374 6573 743a 202b 534b 4950 0a0a 2020  ctest: +SKIP..  
+00026a60: 2020 5365 6520 416c 736f 0a20 2020 202d    See Also.    -
+00026a70: 2d2d 2d2d 2d2d 2d0a 2020 2020 626c 6f63  -------.    bloc
+00026a80: 6b77 6973 650a 2020 2020 2222 220a 2020  kwise.    """.  
+00026a90: 2020 6966 206b 7761 7267 733a 0a20 2020    if kwargs:.   
+00026aa0: 2020 2020 2072 6169 7365 2054 7970 6545       raise TypeE
+00026ab0: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
+00026ac0: 2020 6622 7b6f 702e 5f5f 6e61 6d65 5f5f    f"{op.__name__
+00026ad0: 7d20 646f 6573 206e 6f74 2074 616b 6520  } does not take 
+00026ae0: 7468 6520 666f 6c6c 6f77 696e 6720 6b65  the following ke
+00026af0: 7977 6f72 6420 6172 6775 6d65 6e74 7320  yword arguments 
+00026b00: 220a 2020 2020 2020 2020 2020 2020 6622  ".            f"
+00026b10: 7b73 6f72 7465 6428 6b77 6172 6773 297d  {sorted(kwargs)}
+00026b20: 220a 2020 2020 2020 2020 290a 0a20 2020  ".        )..   
+00026b30: 206f 7574 203d 205f 656c 656d 7769 7365   out = _elemwise
+00026b40: 5f6e 6f72 6d61 6c69 7a65 5f6f 7574 286f  _normalize_out(o
+00026b50: 7574 290a 2020 2020 7768 6572 6520 3d20  ut).    where = 
+00026b60: 5f65 6c65 6d77 6973 655f 6e6f 726d 616c  _elemwise_normal
+00026b70: 697a 655f 7768 6572 6528 7768 6572 6529  ize_where(where)
+00026b80: 0a20 2020 2061 7267 7320 3d20 5b6e 702e  .    args = [np.
+00026b90: 6173 6172 7261 7928 6129 2069 6620 6973  asarray(a) if is
+00026ba0: 696e 7374 616e 6365 2861 2c20 286c 6973  instance(a, (lis
+00026bb0: 742c 2074 7570 6c65 2929 2065 6c73 6520  t, tuple)) else 
+00026bc0: 6120 666f 7220 6120 696e 2061 7267 735d  a for a in args]
+00026bd0: 0a0a 2020 2020 7368 6170 6573 203d 205b  ..    shapes = [
+00026be0: 5d0a 2020 2020 666f 7220 6172 6720 696e  ].    for arg in
+00026bf0: 2061 7267 733a 0a20 2020 2020 2020 2073   args:.        s
+00026c00: 6861 7065 203d 2067 6574 6174 7472 2861  hape = getattr(a
+00026c10: 7267 2c20 2273 6861 7065 222c 2028 2929  rg, "shape", ())
+00026c20: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+00026c30: 6973 5f64 6173 6b5f 636f 6c6c 6563 7469  is_dask_collecti
+00026c40: 6f6e 2878 2920 666f 7220 7820 696e 2073  on(x) for x in s
+00026c50: 6861 7065 293a 0a20 2020 2020 2020 2020  hape):.         
+00026c60: 2020 2023 2057 616e 7420 746f 2065 7863     # Want to exc
+00026c70: 6c75 6465 2044 656c 6179 6564 2073 6861  lude Delayed sha
+00026c80: 7065 7320 616e 6420 6464 2e53 6361 6c61  pes and dd.Scala
+00026c90: 720a 2020 2020 2020 2020 2020 2020 7368  r.            sh
+00026ca0: 6170 6520 3d20 2829 0a20 2020 2020 2020  ape = ().       
+00026cb0: 2073 6861 7065 732e 6170 7065 6e64 2873   shapes.append(s
+00026cc0: 6861 7065 290a 2020 2020 6966 2069 7369  hape).    if isi
+00026cd0: 6e73 7461 6e63 6528 7768 6572 652c 2041  nstance(where, A
+00026ce0: 7272 6179 293a 0a20 2020 2020 2020 2073  rray):.        s
+00026cf0: 6861 7065 732e 6170 7065 6e64 2877 6865  hapes.append(whe
+00026d00: 7265 2e73 6861 7065 290a 2020 2020 6966  re.shape).    if
+00026d10: 2069 7369 6e73 7461 6e63 6528 6f75 742c   isinstance(out,
+00026d20: 2041 7272 6179 293a 0a20 2020 2020 2020   Array):.       
+00026d30: 2073 6861 7065 732e 6170 7065 6e64 286f   shapes.append(o
+00026d40: 7574 2e73 6861 7065 290a 0a20 2020 2073  ut.shape)..    s
+00026d50: 6861 7065 7320 3d20 5b73 2069 6620 6973  hapes = [s if is
+00026d60: 696e 7374 616e 6365 2873 2c20 4974 6572  instance(s, Iter
+00026d70: 6162 6c65 2920 656c 7365 2028 2920 666f  able) else () fo
+00026d80: 7220 7320 696e 2073 6861 7065 735d 0a20  r s in shapes]. 
+00026d90: 2020 206f 7574 5f6e 6469 6d20 3d20 6c65     out_ndim = le
+00026da0: 6e28 0a20 2020 2020 2020 2062 726f 6164  n(.        broad
+00026db0: 6361 7374 5f73 6861 7065 7328 2a73 6861  cast_shapes(*sha
+00026dc0: 7065 7329 0a20 2020 2029 2020 2320 5261  pes).    )  # Ra
+00026dd0: 6973 6573 2056 616c 7565 4572 726f 7220  ises ValueError 
+00026de0: 6966 2064 696d 656e 7369 6f6e 7320 6d69  if dimensions mi
+00026df0: 736d 6174 6368 0a20 2020 2065 7870 725f  smatch.    expr_
+00026e00: 696e 6473 203d 2074 7570 6c65 2872 616e  inds = tuple(ran
+00026e10: 6765 286f 7574 5f6e 6469 6d29 295b 3a3a  ge(out_ndim))[::
+00026e20: 2d31 5d0a 0a20 2020 2069 6620 6474 7970  -1]..    if dtyp
+00026e30: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+00026e40: 2020 2020 2020 206e 6565 645f 656e 666f         need_enfo
+00026e50: 7263 655f 6474 7970 6520 3d20 5472 7565  rce_dtype = True
+00026e60: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00026e70: 2020 2023 2057 6520 666f 6c6c 6f77 204e     # We follow N
+00026e80: 756d 5079 2773 2072 756c 6573 2066 6f72  umPy's rules for
+00026e90: 2064 7479 7065 2070 726f 6d6f 7469 6f6e   dtype promotion
+00026ea0: 2c20 7768 6963 6820 7370 6563 6961 6c20  , which special 
+00026eb0: 6361 7365 730a 2020 2020 2020 2020 2320  cases.        # 
+00026ec0: 7363 616c 6172 7320 616e 6420 3064 206e  scalars and 0d n
+00026ed0: 6461 7272 6179 7320 2877 6869 6368 2069  darrays (which i
+00026ee0: 7420 636f 6e73 6964 6572 7320 6571 7569  t considers equi
+00026ef0: 7661 6c65 6e74 2920 6279 2075 7369 6e67  valent) by using
+00026f00: 0a20 2020 2020 2020 2023 2074 6865 6972  .        # their
+00026f10: 2076 616c 7565 7320 746f 2063 6f6d 7075   values to compu
+00026f20: 7465 2074 6865 2072 6573 756c 7420 6474  te the result dt
+00026f30: 7970 653a 0a20 2020 2020 2020 2023 2068  ype:.        # h
+00026f40: 7474 7073 3a2f 2f67 6974 6875 622e 636f  ttps://github.co
+00026f50: 6d2f 6e75 6d70 792f 6e75 6d70 792f 6973  m/numpy/numpy/is
+00026f60: 7375 6573 2f36 3234 300a 2020 2020 2020  sues/6240.      
+00026f70: 2020 2320 5765 2064 6f6e 2774 2069 6e73    # We don't ins
+00026f80: 7065 6374 2074 6865 2076 616c 7565 7320  pect the values 
+00026f90: 6f66 2030 6420 6461 736b 2061 7272 6179  of 0d dask array
+00026fa0: 732c 2062 6563 6175 7365 2074 6865 7365  s, because these
+00026fb0: 2063 6f75 6c64 0a20 2020 2020 2020 2023   could.        #
+00026fc0: 2068 6f6c 6420 706f 7465 6e74 6961 6c6c   hold potentiall
+00026fd0: 7920 7665 7279 2065 7870 656e 7369 7665  y very expensive
+00026fe0: 2063 616c 6375 6c61 7469 6f6e 732e 2049   calculations. I
+00026ff0: 6e73 7465 6164 2c20 7765 2074 7265 6174  nstead, we treat
+00027000: 0a20 2020 2020 2020 2023 2074 6865 6d20  .        # them 
+00027010: 6a75 7374 206c 696b 6520 6f74 6865 7220  just like other 
+00027020: 6172 7261 7973 2c20 616e 6420 6966 206e  arrays, and if n
+00027030: 6563 6573 7361 7279 2063 6173 7420 7468  ecessary cast th
+00027040: 6520 7265 7375 6c74 206f 6620 6f70 0a20  e result of op. 
+00027050: 2020 2020 2020 2023 2074 6f20 6d61 7463         # to matc
+00027060: 682e 0a20 2020 2020 2020 2076 616c 7320  h..        vals 
+00027070: 3d20 5b0a 2020 2020 2020 2020 2020 2020  = [.            
+00027080: 6e70 2e65 6d70 7479 2828 312c 2920 2a20  np.empty((1,) * 
+00027090: 6d61 7828 312c 2061 2e6e 6469 6d29 2c20  max(1, a.ndim), 
+000270a0: 6474 7970 653d 612e 6474 7970 6529 0a20  dtype=a.dtype). 
+000270b0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+000270c0: 7420 6973 5f73 6361 6c61 725f 666f 725f  t is_scalar_for_
+000270d0: 656c 656d 7769 7365 2861 290a 2020 2020  elemwise(a).    
+000270e0: 2020 2020 2020 2020 656c 7365 2061 0a20          else a. 
+000270f0: 2020 2020 2020 2020 2020 2066 6f72 2061             for a
+00027100: 2069 6e20 6172 6773 0a20 2020 2020 2020   in args.       
+00027110: 205d 0a20 2020 2020 2020 2074 7279 3a0a   ].        try:.
+00027120: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
+00027130: 6520 3d20 6170 706c 795f 696e 6665 725f  e = apply_infer_
+00027140: 6474 7970 6528 6f70 2c20 7661 6c73 2c20  dtype(op, vals, 
+00027150: 7b7d 2c20 2265 6c65 6d77 6973 6522 2c20  {}, "elemwise", 
+00027160: 7375 6767 6573 745f 6474 7970 653d 4661  suggest_dtype=Fa
+00027170: 6c73 6529 0a20 2020 2020 2020 2065 7863  lse).        exc
+00027180: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+00027190: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+000271a0: 6e20 4e6f 7449 6d70 6c65 6d65 6e74 6564  n NotImplemented
+000271b0: 0a20 2020 2020 2020 206e 6565 645f 656e  .        need_en
+000271c0: 666f 7263 655f 6474 7970 6520 3d20 616e  force_dtype = an
+000271d0: 7928 0a20 2020 2020 2020 2020 2020 206e  y(.            n
+000271e0: 6f74 2069 735f 7363 616c 6172 5f66 6f72  ot is_scalar_for
+000271f0: 5f65 6c65 6d77 6973 6528 6129 2061 6e64  _elemwise(a) and
+00027200: 2061 2e6e 6469 6d20 3d3d 2030 2066 6f72   a.ndim == 0 for
+00027210: 2061 2069 6e20 6172 6773 0a20 2020 2020   a in args.     
+00027220: 2020 2029 0a0a 2020 2020 6966 206e 6f74     )..    if not
+00027230: 206e 616d 653a 0a20 2020 2020 2020 206e   name:.        n
+00027240: 616d 6520 3d20 6622 7b66 756e 636e 616d  ame = f"{funcnam
+00027250: 6528 6f70 297d 2d7b 746f 6b65 6e69 7a65  e(op)}-{tokenize
+00027260: 286f 702c 2064 7479 7065 2c20 2a61 7267  (op, dtype, *arg
+00027270: 732c 2077 6865 7265 297d 220a 0a20 2020  s, where)}"..   
+00027280: 2062 6c6f 636b 7769 7365 5f6b 7761 7267   blockwise_kwarg
+00027290: 7320 3d20 6469 6374 2864 7479 7065 3d64  s = dict(dtype=d
+000272a0: 7479 7065 2c20 6e61 6d65 3d6e 616d 652c  type, name=name,
+000272b0: 2074 6f6b 656e 3d66 756e 636e 616d 6528   token=funcname(
+000272c0: 6f70 292e 7374 7269 7028 225f 2229 290a  op).strip("_")).
+000272d0: 0a20 2020 2069 6620 7768 6572 6520 6973  .    if where is
+000272e0: 206e 6f74 2054 7275 653a 0a20 2020 2020   not True:.     
+000272f0: 2020 2062 6c6f 636b 7769 7365 5f6b 7761     blockwise_kwa
+00027300: 7267 735b 2265 6c65 6d77 6973 655f 7768  rgs["elemwise_wh
+00027310: 6572 655f 6675 6e63 7469 6f6e 225d 203d  ere_function"] =
+00027320: 206f 700a 2020 2020 2020 2020 6f70 203d   op.        op =
+00027330: 205f 656c 656d 7769 7365 5f68 616e 646c   _elemwise_handl
+00027340: 655f 7768 6572 650a 2020 2020 2020 2020  e_where.        
+00027350: 6172 6773 2e65 7874 656e 6428 5b77 6865  args.extend([whe
+00027360: 7265 2c20 6f75 745d 290a 0a20 2020 2069  re, out])..    i
+00027370: 6620 6e65 6564 5f65 6e66 6f72 6365 5f64  f need_enforce_d
+00027380: 7479 7065 3a0a 2020 2020 2020 2020 626c  type:.        bl
+00027390: 6f63 6b77 6973 655f 6b77 6172 6773 5b22  ockwise_kwargs["
+000273a0: 656e 666f 7263 655f 6474 7970 6522 5d20  enforce_dtype"] 
+000273b0: 3d20 6474 7970 650a 2020 2020 2020 2020  = dtype.        
+000273c0: 626c 6f63 6b77 6973 655f 6b77 6172 6773  blockwise_kwargs
+000273d0: 5b22 656e 666f 7263 655f 6474 7970 655f  ["enforce_dtype_
+000273e0: 6675 6e63 7469 6f6e 225d 203d 206f 700a  function"] = op.
+000273f0: 2020 2020 2020 2020 6f70 203d 205f 656e          op = _en
+00027400: 666f 7263 655f 6474 7970 650a 0a20 2020  force_dtype..   
+00027410: 2072 6573 756c 7420 3d20 626c 6f63 6b77   result = blockw
+00027420: 6973 6528 0a20 2020 2020 2020 206f 702c  ise(.        op,
+00027430: 0a20 2020 2020 2020 2065 7870 725f 696e  .        expr_in
+00027440: 6473 2c0a 2020 2020 2020 2020 2a63 6f6e  ds,.        *con
+00027450: 6361 7428 0a20 2020 2020 2020 2020 2020  cat(.           
+00027460: 2028 612c 2074 7570 6c65 2872 616e 6765   (a, tuple(range
+00027470: 2861 2e6e 6469 6d29 5b3a 3a2d 315d 2920  (a.ndim)[::-1]) 
+00027480: 6966 206e 6f74 2069 735f 7363 616c 6172  if not is_scalar
+00027490: 5f66 6f72 5f65 6c65 6d77 6973 6528 6129  _for_elemwise(a)
+000274a0: 2065 6c73 6520 4e6f 6e65 290a 2020 2020   else None).    
+000274b0: 2020 2020 2020 2020 666f 7220 6120 696e          for a in
+000274c0: 2061 7267 730a 2020 2020 2020 2020 292c   args.        ),
+000274d0: 0a20 2020 2020 2020 202a 2a62 6c6f 636b  .        **block
+000274e0: 7769 7365 5f6b 7761 7267 732c 0a20 2020  wise_kwargs,.   
+000274f0: 2029 0a0a 2020 2020 7265 7475 726e 2068   )..    return h
+00027500: 616e 646c 655f 6f75 7428 6f75 742c 2072  andle_out(out, r
+00027510: 6573 756c 7429 0a0a 0a64 6566 205f 656c  esult)...def _el
+00027520: 656d 7769 7365 5f6e 6f72 6d61 6c69 7a65  emwise_normalize
+00027530: 5f77 6865 7265 2877 6865 7265 293a 0a20  _where(where):. 
+00027540: 2020 2069 6620 7768 6572 6520 6973 2054     if where is T
+00027550: 7275 653a 0a20 2020 2020 2020 2072 6574  rue:.        ret
+00027560: 7572 6e20 5472 7565 0a20 2020 2065 6c69  urn True.    eli
+00027570: 6620 7768 6572 6520 6973 2046 616c 7365  f where is False
+00027580: 206f 7220 7768 6572 6520 6973 204e 6f6e   or where is Non
+00027590: 653a 0a20 2020 2020 2020 2072 6574 7572  e:.        retur
+000275a0: 6e20 4661 6c73 650a 2020 2020 7265 7475  n False.    retu
+000275b0: 726e 2061 7361 7272 6179 2877 6865 7265  rn asarray(where
+000275c0: 290a 0a0a 6465 6620 5f65 6c65 6d77 6973  )...def _elemwis
+000275d0: 655f 6861 6e64 6c65 5f77 6865 7265 282a  e_handle_where(*
+000275e0: 6172 6773 2c20 2a2a 6b77 6172 6773 293a  args, **kwargs):
+000275f0: 0a20 2020 2066 756e 6374 696f 6e20 3d20  .    function = 
+00027600: 6b77 6172 6773 2e70 6f70 2822 656c 656d  kwargs.pop("elem
+00027610: 7769 7365 5f77 6865 7265 5f66 756e 6374  wise_where_funct
+00027620: 696f 6e22 290a 2020 2020 2a61 7267 732c  ion").    *args,
+00027630: 2077 6865 7265 2c20 6f75 7420 3d20 6172   where, out = ar
+00027640: 6773 0a20 2020 2069 6620 6861 7361 7474  gs.    if hasatt
+00027650: 7228 6f75 742c 2022 636f 7079 2229 3a0a  r(out, "copy"):.
+00027660: 2020 2020 2020 2020 6f75 7420 3d20 6f75          out = ou
+00027670: 742e 636f 7079 2829 0a20 2020 2072 6574  t.copy().    ret
+00027680: 7572 6e20 6675 6e63 7469 6f6e 282a 6172  urn function(*ar
+00027690: 6773 2c20 7768 6572 653d 7768 6572 652c  gs, where=where,
+000276a0: 206f 7574 3d6f 7574 2c20 2a2a 6b77 6172   out=out, **kwar
+000276b0: 6773 290a 0a0a 6465 6620 5f65 6c65 6d77  gs)...def _elemw
+000276c0: 6973 655f 6e6f 726d 616c 697a 655f 6f75  ise_normalize_ou
+000276d0: 7428 6f75 7429 3a0a 2020 2020 6966 2069  t(out):.    if i
+000276e0: 7369 6e73 7461 6e63 6528 6f75 742c 2074  sinstance(out, t
+000276f0: 7570 6c65 293a 0a20 2020 2020 2020 2069  uple):.        i
+00027700: 6620 6c65 6e28 6f75 7429 203d 3d20 313a  f len(out) == 1:
+00027710: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
+00027720: 203d 206f 7574 5b30 5d0a 2020 2020 2020   = out[0].      
+00027730: 2020 656c 6966 206c 656e 286f 7574 2920    elif len(out) 
+00027740: 3e20 313a 0a20 2020 2020 2020 2020 2020  > 1:.           
+00027750: 2072 6169 7365 204e 6f74 496d 706c 656d   raise NotImplem
+00027760: 656e 7465 6445 7272 6f72 2822 5468 6520  entedError("The 
+00027770: 6f75 7420 7061 7261 6d65 7465 7220 6973  out parameter is
+00027780: 206e 6f74 2066 756c 6c79 2073 7570 706f   not fully suppo
+00027790: 7274 6564 2229 0a20 2020 2020 2020 2065  rted").        e
+000277a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000277b0: 206f 7574 203d 204e 6f6e 650a 2020 2020   out = None.    
+000277c0: 6966 206e 6f74 2028 6f75 7420 6973 204e  if not (out is N
+000277d0: 6f6e 6520 6f72 2069 7369 6e73 7461 6e63  one or isinstanc
+000277e0: 6528 6f75 742c 2041 7272 6179 2929 3a0a  e(out, Array)):.
+000277f0: 2020 2020 2020 2020 7261 6973 6520 4e6f          raise No
+00027800: 7449 6d70 6c65 6d65 6e74 6564 4572 726f  tImplementedErro
+00027810: 7228 0a20 2020 2020 2020 2020 2020 2066  r(.            f
+00027820: 2254 6865 206f 7574 2070 6172 616d 6574  "The out paramet
+00027830: 6572 2069 7320 6e6f 7420 6675 6c6c 7920  er is not fully 
+00027840: 7375 7070 6f72 7465 642e 220a 2020 2020  supported.".    
+00027850: 2020 2020 2020 2020 6622 2052 6563 6569          f" Recei
+00027860: 7665 6420 7479 7065 207b 7479 7065 286f  ved type {type(o
+00027870: 7574 292e 5f5f 6e61 6d65 5f5f 7d2c 2065  ut).__name__}, e
+00027880: 7870 6563 7465 6420 4461 736b 2041 7272  xpected Dask Arr
+00027890: 6179 220a 2020 2020 2020 2020 290a 2020  ay".        ).  
+000278a0: 2020 7265 7475 726e 206f 7574 0a0a 0a64    return out...d
+000278b0: 6566 2068 616e 646c 655f 6f75 7428 6f75  ef handle_out(ou
+000278c0: 742c 2072 6573 756c 7429 3a0a 2020 2020  t, result):.    
+000278d0: 2222 2248 616e 646c 6520 6f75 7420 7061  """Handle out pa
+000278e0: 7261 6d65 7465 7273 0a0a 2020 2020 4966  rameters..    If
+000278f0: 206f 7574 2069 7320 6120 6461 736b 2e61   out is a dask.a
+00027900: 7272 6179 2074 6865 6e20 7468 6973 206f  rray then this o
+00027910: 7665 7277 7269 7465 7320 7468 6520 636f  verwrites the co
+00027920: 6e74 656e 7473 206f 6620 7468 6174 2061  ntents of that a
+00027930: 7272 6179 2077 6974 680a 2020 2020 7468  rray with.    th
+00027940: 6520 7265 7375 6c74 0a20 2020 2022 2222  e result.    """
+00027950: 0a20 2020 206f 7574 203d 205f 656c 656d  .    out = _elem
+00027960: 7769 7365 5f6e 6f72 6d61 6c69 7a65 5f6f  wise_normalize_o
+00027970: 7574 286f 7574 290a 2020 2020 6966 2069  ut(out).    if i
+00027980: 7369 6e73 7461 6e63 6528 6f75 742c 2041  sinstance(out, A
+00027990: 7272 6179 293a 0a20 2020 2020 2020 2069  rray):.        i
+000279a0: 6620 6f75 742e 7368 6170 6520 213d 2072  f out.shape != r
+000279b0: 6573 756c 742e 7368 6170 653a 0a20 2020  esult.shape:.   
+000279c0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
+000279d0: 616c 7565 4572 726f 7228 0a20 2020 2020  alueError(.     
+000279e0: 2020 2020 2020 2020 2020 2022 4d69 736d             "Mism
+000279f0: 6174 6368 6564 2073 6861 7065 7320 6265  atched shapes be
+00027a00: 7477 6565 6e20 7265 7375 6c74 2061 6e64  tween result and
+00027a10: 206f 7574 2070 6172 616d 6574 6572 2e20   out parameter. 
+00027a20: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00027a30: 2020 226f 7574 3d25 732c 2072 6573 756c    "out=%s, resul
+00027a40: 743d 2573 2220 2520 2873 7472 286f 7574  t=%s" % (str(out
+00027a50: 2e73 6861 7065 292c 2073 7472 2872 6573  .shape), str(res
+00027a60: 756c 742e 7368 6170 6529 290a 2020 2020  ult.shape)).    
+00027a70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00027a80: 2020 6f75 742e 5f63 6875 6e6b 7320 3d20    out._chunks = 
+00027a90: 7265 7375 6c74 2e63 6875 6e6b 730a 2020  result.chunks.  
+00027aa0: 2020 2020 2020 6f75 742e 6461 736b 203d        out.dask =
+00027ab0: 2072 6573 756c 742e 6461 736b 0a20 2020   result.dask.   
+00027ac0: 2020 2020 206f 7574 2e5f 6d65 7461 203d       out._meta =
+00027ad0: 2072 6573 756c 742e 5f6d 6574 610a 2020   result._meta.  
+00027ae0: 2020 2020 2020 6f75 742e 5f6e 616d 6520        out._name 
+00027af0: 3d20 7265 7375 6c74 2e6e 616d 650a 2020  = result.name.  
+00027b00: 2020 2020 2020 7265 7475 726e 206f 7574        return out
+00027b10: 0a20 2020 2065 6c73 653a 0a20 2020 2020  .    else:.     
+00027b20: 2020 2072 6574 7572 6e20 7265 7375 6c74     return result
+00027b30: 0a0a 0a64 6566 205f 656e 666f 7263 655f  ...def _enforce_
+00027b40: 6474 7970 6528 2a61 7267 732c 202a 2a6b  dtype(*args, **k
+00027b50: 7761 7267 7329 3a0a 2020 2020 2222 2243  wargs):.    """C
+00027b60: 616c 6c73 2061 2066 756e 6374 696f 6e20  alls a function 
+00027b70: 616e 6420 636f 6e76 6572 7473 2069 7473  and converts its
+00027b80: 2072 6573 756c 7420 746f 2074 6865 2067   result to the g
+00027b90: 6976 656e 2064 7479 7065 2e0a 0a20 2020  iven dtype...   
+00027ba0: 2054 6865 2070 6172 616d 6574 6572 7320   The parameters 
+00027bb0: 6861 7665 2064 656c 6962 6572 6174 656c  have deliberatel
+00027bc0: 7920 6265 656e 2067 6976 656e 2075 6e77  y been given unw
+00027bd0: 6965 6c64 7920 6e61 6d65 7320 746f 2061  ieldy names to a
+00027be0: 766f 6964 0a20 2020 2063 6c61 7368 6573  void.    clashes
+00027bf0: 2077 6974 6820 6b65 7977 6f72 6420 6172   with keyword ar
+00027c00: 6775 6d65 6e74 7320 636f 6e73 756d 6564  guments consumed
+00027c10: 2062 7920 626c 6f63 6b77 6973 650a 0a20   by blockwise.. 
+00027c20: 2020 2041 2064 7479 7065 206f 6620 606f     A dtype of `o
+00027c30: 626a 6563 7460 2069 7320 7472 6561 7465  bject` is treate
+00027c40: 6420 6173 2061 2073 7065 6369 616c 2063  d as a special c
+00027c50: 6173 6520 616e 6420 6e6f 7420 656e 666f  ase and not enfo
+00027c60: 7263 6564 2c0a 2020 2020 6265 6361 7573  rced,.    becaus
+00027c70: 6520 6974 2069 7320 7573 6564 2061 7320  e it is used as 
+00027c80: 6120 6475 6d6d 7920 7661 6c75 6520 696e  a dummy value in
+00027c90: 2073 6f6d 6520 706c 6163 6573 2077 6865   some places whe
+00027ca0: 6e20 7468 6520 7265 7375 6c74 2077 696c  n the result wil
+00027cb0: 6c0a 2020 2020 6e6f 7420 6265 2061 2062  l.    not be a b
+00027cc0: 6c6f 636b 2069 6e20 616e 2041 7272 6179  lock in an Array
+00027cd0: 2e0a 0a20 2020 2050 6172 616d 6574 6572  ...    Parameter
+00027ce0: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 2d2d  s.    ----------
+00027cf0: 0a20 2020 2065 6e66 6f72 6365 5f64 7479  .    enforce_dty
+00027d00: 7065 203a 2064 7479 7065 0a20 2020 2020  pe : dtype.     
+00027d10: 2020 2052 6573 756c 7420 6474 7970 650a     Result dtype.
+00027d20: 2020 2020 656e 666f 7263 655f 6474 7970      enforce_dtyp
+00027d30: 655f 6675 6e63 7469 6f6e 203a 2063 616c  e_function : cal
+00027d40: 6c61 626c 650a 2020 2020 2020 2020 5468  lable.        Th
+00027d50: 6520 7772 6170 7065 6420 6675 6e63 7469  e wrapped functi
+00027d60: 6f6e 2c20 7768 6963 6820 7769 6c6c 2062  on, which will b
+00027d70: 6520 7061 7373 6564 2074 6865 2072 656d  e passed the rem
+00027d80: 6169 6e69 6e67 2061 7267 756d 656e 7473  aining arguments
+00027d90: 0a20 2020 2022 2222 0a20 2020 2064 7479  .    """.    dty
+00027da0: 7065 203d 206b 7761 7267 732e 706f 7028  pe = kwargs.pop(
+00027db0: 2265 6e66 6f72 6365 5f64 7479 7065 2229  "enforce_dtype")
+00027dc0: 0a20 2020 2066 756e 6374 696f 6e20 3d20  .    function = 
+00027dd0: 6b77 6172 6773 2e70 6f70 2822 656e 666f  kwargs.pop("enfo
+00027de0: 7263 655f 6474 7970 655f 6675 6e63 7469  rce_dtype_functi
+00027df0: 6f6e 2229 0a0a 2020 2020 7265 7375 6c74  on")..    result
+00027e00: 203d 2066 756e 6374 696f 6e28 2a61 7267   = function(*arg
+00027e10: 732c 202a 2a6b 7761 7267 7329 0a20 2020  s, **kwargs).   
+00027e20: 2069 6620 6861 7361 7474 7228 7265 7375   if hasattr(resu
+00027e30: 6c74 2c20 2264 7479 7065 2229 2061 6e64  lt, "dtype") and
+00027e40: 2064 7479 7065 2021 3d20 7265 7375 6c74   dtype != result
+00027e50: 2e64 7479 7065 2061 6e64 2064 7479 7065  .dtype and dtype
+00027e60: 2021 3d20 6f62 6a65 6374 3a0a 2020 2020   != object:.    
+00027e70: 2020 2020 6966 206e 6f74 206e 702e 6361      if not np.ca
+00027e80: 6e5f 6361 7374 2872 6573 756c 742c 2064  n_cast(result, d
+00027e90: 7479 7065 2c20 6361 7374 696e 673d 2273  type, casting="s
+00027ea0: 616d 655f 6b69 6e64 2229 3a0a 2020 2020  ame_kind"):.    
+00027eb0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00027ec0: 6c75 6545 7272 6f72 280a 2020 2020 2020  lueError(.      
+00027ed0: 2020 2020 2020 2020 2020 2249 6e66 6572            "Infer
+00027ee0: 7265 6420 6474 7970 6520 6672 6f6d 2066  red dtype from f
+00027ef0: 756e 6374 696f 6e20 2572 2077 6173 2025  unction %r was %
+00027f00: 7220 220a 2020 2020 2020 2020 2020 2020  r ".            
+00027f10: 2020 2020 2262 7574 2067 6f74 2025 722c      "but got %r,
+00027f20: 2077 6869 6368 2063 616e 2774 2062 6520   which can't be 
+00027f30: 6361 7374 2075 7369 6e67 2022 0a20 2020  cast using ".   
+00027f40: 2020 2020 2020 2020 2020 2020 2022 6361               "ca
+00027f50: 7374 696e 673d 2773 616d 655f 6b69 6e64  sting='same_kind
+00027f60: 2722 0a20 2020 2020 2020 2020 2020 2020  '".             
+00027f70: 2020 2025 2028 6675 6e63 6e61 6d65 2866     % (funcname(f
+00027f80: 756e 6374 696f 6e29 2c20 7374 7228 6474  unction), str(dt
+00027f90: 7970 6529 2c20 7374 7228 7265 7375 6c74  ype), str(result
+00027fa0: 2e64 7479 7065 2929 0a20 2020 2020 2020  .dtype)).       
+00027fb0: 2020 2020 2029 0a20 2020 2020 2020 2069       ).        i
+00027fc0: 6620 6e70 2e69 7373 6361 6c61 7228 7265  f np.isscalar(re
+00027fd0: 7375 6c74 293a 0a20 2020 2020 2020 2020  sult):.         
+00027fe0: 2020 2023 2073 6361 6c61 7220 6173 7479     # scalar asty
+00027ff0: 7065 206d 6574 686f 6420 646f 6573 6e27  pe method doesn'
+00028000: 7420 7461 6b65 2074 6865 206b 6579 776f  t take the keywo
+00028010: 7264 2061 7267 756d 656e 7473 2c20 736f  rd arguments, so
+00028020: 0a20 2020 2020 2020 2020 2020 2023 2068  .            # h
+00028030: 6176 6520 746f 2063 6f6e 7665 7274 2076  ave to convert v
+00028040: 6961 2030 2d64 696d 656e 7369 6f6e 616c  ia 0-dimensional
+00028050: 2061 7272 6179 2061 6e64 2062 6163 6b2e   array and back.
+00028060: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00028070: 756c 7420 3d20 7265 7375 6c74 2e61 7374  ult = result.ast
+00028080: 7970 6528 6474 7970 6529 0a20 2020 2020  ype(dtype).     
+00028090: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000280a0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+000280b0: 2020 2020 2020 2020 2020 7265 7375 6c74            result
+000280c0: 203d 2072 6573 756c 742e 6173 7479 7065   = result.astype
+000280d0: 2864 7479 7065 2c20 636f 7079 3d46 616c  (dtype, copy=Fal
+000280e0: 7365 290a 2020 2020 2020 2020 2020 2020  se).            
+000280f0: 6578 6365 7074 2054 7970 6545 7272 6f72  except TypeError
+00028100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00028110: 2020 2320 4d69 7373 696e 6720 636f 7079    # Missing copy
+00028120: 206b 7761 7267 0a20 2020 2020 2020 2020   kwarg.         
+00028130: 2020 2020 2020 2072 6573 756c 7420 3d20         result = 
+00028140: 7265 7375 6c74 2e61 7374 7970 6528 6474  result.astype(dt
+00028150: 7970 6529 0a20 2020 2072 6574 7572 6e20  ype).    return 
+00028160: 7265 7375 6c74 0a0a 0a64 6566 2062 726f  result...def bro
+00028170: 6164 6361 7374 5f74 6f28 782c 2073 6861  adcast_to(x, sha
+00028180: 7065 2c20 6368 756e 6b73 3d4e 6f6e 652c  pe, chunks=None,
+00028190: 206d 6574 613d 4e6f 6e65 293a 0a20 2020   meta=None):.   
+000281a0: 2022 2222 4272 6f61 6463 6173 7420 616e   """Broadcast an
+000281b0: 2061 7272 6179 2074 6f20 6120 6e65 7720   array to a new 
+000281c0: 7368 6170 652e 0a0a 2020 2020 5061 7261  shape...    Para
+000281d0: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
+000281e0: 2d2d 2d2d 2d0a 2020 2020 7820 3a20 6172  -----.    x : ar
+000281f0: 7261 795f 6c69 6b65 0a20 2020 2020 2020  ray_like.       
+00028200: 2054 6865 2061 7272 6179 2074 6f20 6272   The array to br
+00028210: 6f61 6463 6173 742e 0a20 2020 2073 6861  oadcast..    sha
+00028220: 7065 203a 2074 7570 6c65 0a20 2020 2020  pe : tuple.     
+00028230: 2020 2054 6865 2073 6861 7065 206f 6620     The shape of 
+00028240: 7468 6520 6465 7369 7265 6420 6172 7261  the desired arra
+00028250: 792e 0a20 2020 2063 6875 6e6b 7320 3a20  y..    chunks : 
+00028260: 7475 706c 652c 206f 7074 696f 6e61 6c0a  tuple, optional.
+00028270: 2020 2020 2020 2020 4966 2070 726f 7669          If provi
+00028280: 6465 642c 2074 6865 6e20 7468 6520 7265  ded, then the re
+00028290: 7375 6c74 2077 696c 6c20 7573 6520 7468  sult will use th
+000282a0: 6573 6520 6368 756e 6b73 2069 6e73 7465  ese chunks inste
+000282b0: 6164 206f 6620 7468 6520 7361 6d65 0a20  ad of the same. 
+000282c0: 2020 2020 2020 2063 6875 6e6b 7320 6173         chunks as
+000282d0: 2074 6865 2073 6f75 7263 6520 6172 7261   the source arra
+000282e0: 792e 2053 6574 7469 6e67 2063 6875 6e6b  y. Setting chunk
+000282f0: 7320 6578 706c 6963 6974 6c79 2061 7320  s explicitly as 
+00028300: 7061 7274 206f 660a 2020 2020 2020 2020  part of.        
+00028310: 6272 6f61 6463 6173 745f 746f 2069 7320  broadcast_to is 
+00028320: 6d6f 7265 2065 6666 6963 6965 6e74 2074  more efficient t
+00028330: 6861 6e20 7265 6368 756e 6b69 6e67 2061  han rechunking a
+00028340: 6674 6572 7761 7264 732e 2043 6875 6e6b  fterwards. Chunk
+00028350: 7320 6172 650a 2020 2020 2020 2020 6f6e  s are.        on
+00028360: 6c79 2061 6c6c 6f77 6564 2074 6f20 6469  ly allowed to di
+00028370: 6666 6572 2066 726f 6d20 7468 6520 6f72  ffer from the or
+00028380: 6967 696e 616c 2073 6861 7065 2061 6c6f  iginal shape alo
+00028390: 6e67 2064 696d 656e 7369 6f6e 7320 7468  ng dimensions th
+000283a0: 6174 0a20 2020 2020 2020 2061 7265 206e  at.        are n
+000283b0: 6577 206f 6e20 7468 6520 7265 7375 6c74  ew on the result
+000283c0: 206f 7220 6861 7665 2073 697a 6520 3120   or have size 1 
+000283d0: 7468 6520 696e 7075 7420 6172 7261 792e  the input array.
+000283e0: 0a20 2020 206d 6574 6120 3a20 656d 7074  .    meta : empt
+000283f0: 7920 6e64 6172 7261 790a 2020 2020 2020  y ndarray.      
+00028400: 2020 656d 7074 7920 6e64 6172 7261 7920    empty ndarray 
+00028410: 6372 6561 7465 6420 7769 7468 2073 616d  created with sam
+00028420: 6520 4e75 6d50 7920 6261 636b 656e 642c  e NumPy backend,
+00028430: 206e 6469 6d20 616e 6420 6474 7970 6520   ndim and dtype 
+00028440: 6173 2074 6865 0a20 2020 2020 2020 2044  as the.        D
+00028450: 6173 6b20 4172 7261 7920 6265 696e 6720  ask Array being 
+00028460: 6372 6561 7465 6420 286f 7665 7272 6964  created (overrid
+00028470: 6573 2064 7479 7065 290a 0a20 2020 2052  es dtype)..    R
+00028480: 6574 7572 6e73 0a20 2020 202d 2d2d 2d2d  eturns.    -----
+00028490: 2d2d 0a20 2020 2062 726f 6164 6361 7374  --.    broadcast
+000284a0: 203a 2064 6173 6b20 6172 7261 790a 0a20   : dask array.. 
+000284b0: 2020 2053 6565 2041 6c73 6f0a 2020 2020     See Also.    
+000284c0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 203a 6675  --------.    :fu
+000284d0: 6e63 3a60 6e75 6d70 792e 6272 6f61 6463  nc:`numpy.broadc
+000284e0: 6173 745f 746f 600a 2020 2020 2222 220a  ast_to`.    """.
+000284f0: 2020 2020 7820 3d20 6173 6172 7261 7928      x = asarray(
+00028500: 7829 0a20 2020 2073 6861 7065 203d 2074  x).    shape = t
+00028510: 7570 6c65 2873 6861 7065 290a 0a20 2020  uple(shape)..   
+00028520: 2069 6620 6d65 7461 2069 7320 4e6f 6e65   if meta is None
+00028530: 3a0a 2020 2020 2020 2020 6d65 7461 203d  :.        meta =
+00028540: 206d 6574 615f 6672 6f6d 5f61 7272 6179   meta_from_array
+00028550: 2878 290a 0a20 2020 2069 6620 782e 7368  (x)..    if x.sh
+00028560: 6170 6520 3d3d 2073 6861 7065 2061 6e64  ape == shape and
+00028570: 2028 6368 756e 6b73 2069 7320 4e6f 6e65   (chunks is None
+00028580: 206f 7220 6368 756e 6b73 203d 3d20 782e   or chunks == x.
+00028590: 6368 756e 6b73 293a 0a20 2020 2020 2020  chunks):.       
+000285a0: 2072 6574 7572 6e20 780a 0a20 2020 206e   return x..    n
+000285b0: 6469 6d5f 6e65 7720 3d20 6c65 6e28 7368  dim_new = len(sh
+000285c0: 6170 6529 202d 2078 2e6e 6469 6d0a 2020  ape) - x.ndim.  
+000285d0: 2020 6966 206e 6469 6d5f 6e65 7720 3c20    if ndim_new < 
+000285e0: 3020 6f72 2061 6e79 280a 2020 2020 2020  0 or any(.      
+000285f0: 2020 6e65 7720 213d 206f 6c64 2066 6f72    new != old for
+00028600: 206e 6577 2c20 6f6c 6420 696e 207a 6970   new, old in zip
+00028610: 2873 6861 7065 5b6e 6469 6d5f 6e65 773a  (shape[ndim_new:
+00028620: 5d2c 2078 2e73 6861 7065 2920 6966 206f  ], x.shape) if o
+00028630: 6c64 2021 3d20 310a 2020 2020 293a 0a20  ld != 1.    ):. 
+00028640: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
+00028650: 7565 4572 726f 7228 6622 6361 6e6e 6f74  ueError(f"cannot
+00028660: 2062 726f 6164 6361 7374 2073 6861 7065   broadcast shape
+00028670: 207b 782e 7368 6170 657d 2074 6f20 7368   {x.shape} to sh
+00028680: 6170 6520 7b73 6861 7065 7d22 290a 0a20  ape {shape}").. 
+00028690: 2020 2069 6620 6368 756e 6b73 2069 7320     if chunks is 
+000286a0: 4e6f 6e65 3a0a 2020 2020 2020 2020 6368  None:.        ch
+000286b0: 756e 6b73 203d 2074 7570 6c65 2828 732c  unks = tuple((s,
+000286c0: 2920 666f 7220 7320 696e 2073 6861 7065  ) for s in shape
+000286d0: 5b3a 6e64 696d 5f6e 6577 5d29 202b 2074  [:ndim_new]) + t
+000286e0: 7570 6c65 280a 2020 2020 2020 2020 2020  uple(.          
+000286f0: 2020 6264 2069 6620 6f6c 6420 3e20 3120    bd if old > 1 
+00028700: 656c 7365 2028 6e65 772c 290a 2020 2020  else (new,).    
+00028710: 2020 2020 2020 2020 666f 7220 6264 2c20          for bd, 
+00028720: 6f6c 642c 206e 6577 2069 6e20 7a69 7028  old, new in zip(
+00028730: 782e 6368 756e 6b73 2c20 782e 7368 6170  x.chunks, x.shap
+00028740: 652c 2073 6861 7065 5b6e 6469 6d5f 6e65  e, shape[ndim_ne
+00028750: 773a 5d29 0a20 2020 2020 2020 2029 0a20  w:]).        ). 
+00028760: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00028770: 2063 6875 6e6b 7320 3d20 6e6f 726d 616c   chunks = normal
+00028780: 697a 655f 6368 756e 6b73 280a 2020 2020  ize_chunks(.    
+00028790: 2020 2020 2020 2020 6368 756e 6b73 2c20          chunks, 
+000287a0: 7368 6170 652c 2064 7479 7065 3d78 2e64  shape, dtype=x.d
+000287b0: 7479 7065 2c20 7072 6576 696f 7573 5f63  type, previous_c
+000287c0: 6875 6e6b 733d 782e 6368 756e 6b73 0a20  hunks=x.chunks. 
+000287d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000287e0: 2066 6f72 206f 6c64 5f62 642c 206e 6577   for old_bd, new
+000287f0: 5f62 6420 696e 207a 6970 2878 2e63 6875  _bd in zip(x.chu
+00028800: 6e6b 732c 2063 6875 6e6b 735b 6e64 696d  nks, chunks[ndim
+00028810: 5f6e 6577 3a5d 293a 0a20 2020 2020 2020  _new:]):.       
+00028820: 2020 2020 2069 6620 6f6c 645f 6264 2021       if old_bd !
+00028830: 3d20 6e65 775f 6264 2061 6e64 206f 6c64  = new_bd and old
+00028840: 5f62 6420 213d 2028 312c 293a 0a20 2020  _bd != (1,):.   
+00028850: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00028860: 7365 2056 616c 7565 4572 726f 7228 0a20  se ValueError(. 
+00028870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00028880: 2020 2022 6361 6e6e 6f74 2062 726f 6164     "cannot broad
+00028890: 6361 7374 2063 6875 6e6b 7320 2573 2074  cast chunks %s t
+000288a0: 6f20 6368 756e 6b73 2025 733a 2022 0a20  o chunks %s: ". 
+000288b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000288c0: 2020 2022 6e65 7720 6368 756e 6b73 206d     "new chunks m
+000288d0: 7573 7420 6569 7468 6572 2062 6520 616c  ust either be al
+000288e0: 6f6e 6720 6120 6e65 7720 220a 2020 2020  ong a new ".    
 000288f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00028900: 2020 2264 696d 656e 7369 6f6e 206f 7220    "dimension or 
-00028910: 6120 6469 6d65 6e73 696f 6e20 6f66 2073  a dimension of s
-00028920: 697a 6520 3122 2025 2028 782e 6368 756e  ize 1" % (x.chun
-00028930: 6b73 2c20 6368 756e 6b73 290a 2020 2020  ks, chunks).    
-00028940: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-00028950: 2020 206e 616d 6520 3d20 2262 726f 6164     name = "broad
-00028960: 6361 7374 5f74 6f2d 2220 2b20 746f 6b65  cast_to-" + toke
-00028970: 6e69 7a65 2878 2c20 7368 6170 652c 2063  nize(x, shape, c
-00028980: 6875 6e6b 7329 0a20 2020 2064 736b 203d  hunks).    dsk =
-00028990: 207b 7d0a 0a20 2020 2065 6e75 6d65 7261   {}..    enumera
-000289a0: 7465 645f 6368 756e 6b73 203d 2070 726f  ted_chunks = pro
-000289b0: 6475 6374 282a 2865 6e75 6d65 7261 7465  duct(*(enumerate
-000289c0: 2862 6473 2920 666f 7220 6264 7320 696e  (bds) for bds in
-000289d0: 2063 6875 6e6b 7329 290a 2020 2020 666f   chunks)).    fo
-000289e0: 7220 6e65 775f 696e 6465 782c 2063 6875  r new_index, chu
-000289f0: 6e6b 5f73 6861 7065 2069 6e20 287a 6970  nk_shape in (zip
-00028a00: 282a 6563 2920 666f 7220 6563 2069 6e20  (*ec) for ec in 
-00028a10: 656e 756d 6572 6174 6564 5f63 6875 6e6b  enumerated_chunk
-00028a20: 7329 3a0a 2020 2020 2020 2020 6f6c 645f  s):.        old_
-00028a30: 696e 6465 7820 3d20 7475 706c 6528 0a20  index = tuple(. 
-00028a40: 2020 2020 2020 2020 2020 2030 2069 6620             0 if 
-00028a50: 6264 203d 3d20 2831 2c29 2065 6c73 6520  bd == (1,) else 
-00028a60: 6920 666f 7220 6264 2c20 6920 696e 207a  i for bd, i in z
-00028a70: 6970 2878 2e63 6875 6e6b 732c 206e 6577  ip(x.chunks, new
-00028a80: 5f69 6e64 6578 5b6e 6469 6d5f 6e65 773a  _index[ndim_new:
-00028a90: 5d29 0a20 2020 2020 2020 2029 0a20 2020  ]).        ).   
-00028aa0: 2020 2020 206f 6c64 5f6b 6579 203d 2028       old_key = (
-00028ab0: 782e 6e61 6d65 2c29 202b 206f 6c64 5f69  x.name,) + old_i
-00028ac0: 6e64 6578 0a20 2020 2020 2020 206e 6577  ndex.        new
-00028ad0: 5f6b 6579 203d 2028 6e61 6d65 2c29 202b  _key = (name,) +
-00028ae0: 206e 6577 5f69 6e64 6578 0a20 2020 2020   new_index.     
-00028af0: 2020 2064 736b 5b6e 6577 5f6b 6579 5d20     dsk[new_key] 
-00028b00: 3d20 286e 702e 6272 6f61 6463 6173 745f  = (np.broadcast_
-00028b10: 746f 2c20 6f6c 645f 6b65 792c 2071 756f  to, old_key, quo
-00028b20: 7465 2863 6875 6e6b 5f73 6861 7065 2929  te(chunk_shape))
-00028b30: 0a0a 2020 2020 6772 6170 6820 3d20 4869  ..    graph = Hi
-00028b40: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
-00028b50: 6d5f 636f 6c6c 6563 7469 6f6e 7328 6e61  m_collections(na
-00028b60: 6d65 2c20 6473 6b2c 2064 6570 656e 6465  me, dsk, depende
-00028b70: 6e63 6965 733d 5b78 5d29 0a20 2020 2072  ncies=[x]).    r
-00028b80: 6574 7572 6e20 4172 7261 7928 6772 6170  eturn Array(grap
-00028b90: 682c 206e 616d 652c 2063 6875 6e6b 732c  h, name, chunks,
-00028ba0: 2064 7479 7065 3d78 2e64 7479 7065 2c20   dtype=x.dtype, 
-00028bb0: 6d65 7461 3d6d 6574 6129 0a0a 0a40 6465  meta=meta)...@de
-00028bc0: 7269 7665 645f 6672 6f6d 286e 7029 0a64  rived_from(np).d
-00028bd0: 6566 2062 726f 6164 6361 7374 5f61 7272  ef broadcast_arr
-00028be0: 6179 7328 2a61 7267 732c 2073 7562 6f6b  ays(*args, subok
-00028bf0: 3d46 616c 7365 293a 0a20 2020 2073 7562  =False):.    sub
-00028c00: 6f6b 203d 2062 6f6f 6c28 7375 626f 6b29  ok = bool(subok)
-00028c10: 0a0a 2020 2020 746f 5f61 7272 6179 203d  ..    to_array =
-00028c20: 2061 7361 6e79 6172 7261 7920 6966 2073   asanyarray if s
-00028c30: 7562 6f6b 2065 6c73 6520 6173 6172 7261  ubok else asarra
-00028c40: 790a 2020 2020 6172 6773 203d 2074 7570  y.    args = tup
-00028c50: 6c65 2874 6f5f 6172 7261 7928 6529 2066  le(to_array(e) f
-00028c60: 6f72 2065 2069 6e20 6172 6773 290a 0a20  or e in args).. 
-00028c70: 2020 2023 2055 6e69 6679 2075 6e65 7665     # Unify uneve
-00028c80: 6e20 6368 756e 6b69 6e67 0a20 2020 2069  n chunking.    i
-00028c90: 6e64 7320 3d20 5b6c 6973 7428 7265 7665  nds = [list(reve
-00028ca0: 7273 6564 2872 616e 6765 2878 2e6e 6469  rsed(range(x.ndi
-00028cb0: 6d29 2929 2066 6f72 2078 2069 6e20 6172  m))) for x in ar
-00028cc0: 6773 5d0a 2020 2020 7563 5f61 7267 7320  gs].    uc_args 
-00028cd0: 3d20 636f 6e63 6174 287a 6970 2861 7267  = concat(zip(arg
-00028ce0: 732c 2069 6e64 7329 290a 2020 2020 5f2c  s, inds)).    _,
-00028cf0: 2061 7267 7320 3d20 756e 6966 795f 6368   args = unify_ch
-00028d00: 756e 6b73 282a 7563 5f61 7267 732c 2077  unks(*uc_args, w
-00028d10: 6172 6e3d 4661 6c73 6529 0a0a 2020 2020  arn=False)..    
-00028d20: 7368 6170 6520 3d20 6272 6f61 6463 6173  shape = broadcas
-00028d30: 745f 7368 6170 6573 282a 2865 2e73 6861  t_shapes(*(e.sha
-00028d40: 7065 2066 6f72 2065 2069 6e20 6172 6773  pe for e in args
-00028d50: 2929 0a20 2020 2063 6875 6e6b 7320 3d20  )).    chunks = 
-00028d60: 6272 6f61 6463 6173 745f 6368 756e 6b73  broadcast_chunks
-00028d70: 282a 2865 2e63 6875 6e6b 7320 666f 7220  (*(e.chunks for 
-00028d80: 6520 696e 2061 7267 7329 290a 0a20 2020  e in args))..   
-00028d90: 2072 6573 756c 7420 3d20 5b62 726f 6164   result = [broad
-00028da0: 6361 7374 5f74 6f28 652c 2073 6861 7065  cast_to(e, shape
-00028db0: 3d73 6861 7065 2c20 6368 756e 6b73 3d63  =shape, chunks=c
-00028dc0: 6875 6e6b 7329 2066 6f72 2065 2069 6e20  hunks) for e in 
-00028dd0: 6172 6773 5d0a 0a20 2020 2072 6574 7572  args]..    retur
-00028de0: 6e20 7265 7375 6c74 0a0a 0a64 6566 206f  n result...def o
-00028df0: 6666 7365 745f 6675 6e63 2866 756e 632c  ffset_func(func,
-00028e00: 206f 6666 7365 742c 202a 6172 6773 293a   offset, *args):
-00028e10: 0a20 2020 2022 2222 4f66 6673 6574 7320  .    """Offsets 
-00028e20: 696e 7075 7473 2062 7920 6f66 6673 6574  inputs by offset
-00028e30: 0a0a 2020 2020 3e3e 3e20 646f 7562 6c65  ..    >>> double
-00028e40: 203d 206c 616d 6264 6120 783a 2078 202a   = lambda x: x *
-00028e50: 2032 0a20 2020 203e 3e3e 2066 203d 206f   2.    >>> f = o
-00028e60: 6666 7365 745f 6675 6e63 2864 6f75 626c  ffset_func(doubl
-00028e70: 652c 2028 3130 2c29 290a 2020 2020 3e3e  e, (10,)).    >>
-00028e80: 3e20 6628 3129 0a20 2020 2032 320a 2020  > f(1).    22.  
-00028e90: 2020 3e3e 3e20 6628 3330 3029 0a20 2020    >>> f(300).   
-00028ea0: 2036 3230 0a20 2020 2022 2222 0a0a 2020   620.    """..  
-00028eb0: 2020 6465 6620 5f6f 6666 7365 7428 2a61    def _offset(*a
-00028ec0: 7267 7329 3a0a 2020 2020 2020 2020 6172  rgs):.        ar
-00028ed0: 6773 3220 3d20 6c69 7374 286d 6170 2861  gs2 = list(map(a
-00028ee0: 6464 2c20 6172 6773 2c20 6f66 6673 6574  dd, args, offset
-00028ef0: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-00028f00: 6e20 6675 6e63 282a 6172 6773 3229 0a0a  n func(*args2)..
-00028f10: 2020 2020 7769 7468 2063 6f6e 7465 7874      with context
-00028f20: 6c69 622e 7375 7070 7265 7373 2845 7863  lib.suppress(Exc
-00028f30: 6570 7469 6f6e 293a 0a20 2020 2020 2020  eption):.       
-00028f40: 205f 6f66 6673 6574 2e5f 5f6e 616d 655f   _offset.__name_
-00028f50: 5f20 3d20 226f 6666 7365 745f 2220 2b20  _ = "offset_" + 
-00028f60: 6675 6e63 2e5f 5f6e 616d 655f 5f0a 0a20  func.__name__.. 
-00028f70: 2020 2072 6574 7572 6e20 5f6f 6666 7365     return _offse
-00028f80: 740a 0a0a 6465 6620 6368 756e 6b73 5f66  t...def chunks_f
-00028f90: 726f 6d5f 6172 7261 7973 2861 7272 6179  rom_arrays(array
-00028fa0: 7329 3a0a 2020 2020 2222 2243 6875 6e6b  s):.    """Chunk
-00028fb0: 7320 7475 706c 6520 6672 6f6d 206e 6573  s tuple from nes
-00028fc0: 7465 6420 6c69 7374 206f 6620 6172 7261  ted list of arra
-00028fd0: 7973 0a0a 2020 2020 3e3e 3e20 7820 3d20  ys..    >>> x = 
-00028fe0: 6e70 2e61 7272 6179 285b 312c 2032 5d29  np.array([1, 2])
-00028ff0: 0a20 2020 203e 3e3e 2063 6875 6e6b 735f  .    >>> chunks_
-00029000: 6672 6f6d 5f61 7272 6179 7328 5b78 2c20  from_arrays([x, 
-00029010: 785d 290a 2020 2020 2828 322c 2032 292c  x]).    ((2, 2),
-00029020: 290a 0a20 2020 203e 3e3e 2078 203d 206e  )..    >>> x = n
-00029030: 702e 6172 7261 7928 5b5b 312c 2032 5d5d  p.array([[1, 2]]
-00029040: 290a 2020 2020 3e3e 3e20 6368 756e 6b73  ).    >>> chunks
-00029050: 5f66 726f 6d5f 6172 7261 7973 285b 5b78  _from_arrays([[x
-00029060: 5d2c 205b 785d 5d29 0a20 2020 2028 2831  ], [x]]).    ((1
-00029070: 2c20 3129 2c20 2832 2c29 290a 0a20 2020  , 1), (2,))..   
-00029080: 203e 3e3e 2078 203d 206e 702e 6172 7261   >>> x = np.arra
-00029090: 7928 5b5b 312c 2032 5d5d 290a 2020 2020  y([[1, 2]]).    
-000290a0: 3e3e 3e20 6368 756e 6b73 5f66 726f 6d5f  >>> chunks_from_
-000290b0: 6172 7261 7973 285b 5b78 2c20 785d 5d29  arrays([[x, x]])
-000290c0: 0a20 2020 2028 2831 2c29 2c20 2832 2c20  .    ((1,), (2, 
-000290d0: 3229 290a 0a20 2020 203e 3e3e 2063 6875  2))..    >>> chu
-000290e0: 6e6b 735f 6672 6f6d 5f61 7272 6179 7328  nks_from_arrays(
-000290f0: 5b31 2c20 315d 290a 2020 2020 2828 312c  [1, 1]).    ((1,
-00029100: 2031 292c 290a 2020 2020 2222 220a 2020   1),).    """.  
-00029110: 2020 6966 206e 6f74 2061 7272 6179 733a    if not arrays:
-00029120: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00029130: 2829 0a20 2020 2072 6573 756c 7420 3d20  ().    result = 
-00029140: 5b5d 0a20 2020 2064 696d 203d 2030 0a0a  [].    dim = 0..
-00029150: 2020 2020 6465 6620 7368 6170 6528 7829      def shape(x)
-00029160: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
-00029170: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00029180: 6e20 782e 7368 6170 6520 6966 2078 2e73  n x.shape if x.s
-00029190: 6861 7065 2065 6c73 6520 2831 2c29 0a20  hape else (1,). 
-000291a0: 2020 2020 2020 2065 7863 6570 7420 4174         except At
-000291b0: 7472 6962 7574 6545 7272 6f72 3a0a 2020  tributeError:.  
-000291c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-000291d0: 2028 312c 290a 0a20 2020 2077 6869 6c65   (1,)..    while
-000291e0: 2069 7369 6e73 7461 6e63 6528 6172 7261   isinstance(arra
-000291f0: 7973 2c20 286c 6973 742c 2074 7570 6c65  ys, (list, tuple
-00029200: 2929 3a0a 2020 2020 2020 2020 7265 7375  )):.        resu
-00029210: 6c74 2e61 7070 656e 6428 7475 706c 6528  lt.append(tuple(
-00029220: 7368 6170 6528 6465 6570 6669 7273 7428  shape(deepfirst(
-00029230: 6129 295b 6469 6d5d 2066 6f72 2061 2069  a))[dim] for a i
-00029240: 6e20 6172 7261 7973 2929 0a20 2020 2020  n arrays)).     
-00029250: 2020 2061 7272 6179 7320 3d20 6172 7261     arrays = arra
-00029260: 7973 5b30 5d0a 2020 2020 2020 2020 6469  ys[0].        di
-00029270: 6d20 2b3d 2031 0a20 2020 2072 6574 7572  m += 1.    retur
-00029280: 6e20 7475 706c 6528 7265 7375 6c74 290a  n tuple(result).
-00029290: 0a0a 6465 6620 6465 6570 6669 7273 7428  ..def deepfirst(
-000292a0: 7365 7129 3a0a 2020 2020 2222 2246 6972  seq):.    """Fir
-000292b0: 7374 2065 6c65 6d65 6e74 2069 6e20 6120  st element in a 
-000292c0: 6e65 7374 6564 206c 6973 740a 0a20 2020  nested list..   
-000292d0: 203e 3e3e 2064 6565 7066 6972 7374 285b   >>> deepfirst([
-000292e0: 5b5b 312c 2032 5d2c 205b 332c 2034 5d5d  [[1, 2], [3, 4]]
-000292f0: 2c20 5b35 2c20 365d 2c20 5b37 2c20 385d  , [5, 6], [7, 8]
-00029300: 5d29 0a20 2020 2031 0a20 2020 2022 2222  ]).    1.    """
-00029310: 0a20 2020 2069 6620 6e6f 7420 6973 696e  .    if not isin
-00029320: 7374 616e 6365 2873 6571 2c20 286c 6973  stance(seq, (lis
-00029330: 742c 2074 7570 6c65 2929 3a0a 2020 2020  t, tuple)):.    
-00029340: 2020 2020 7265 7475 726e 2073 6571 0a20      return seq. 
-00029350: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00029360: 2072 6574 7572 6e20 6465 6570 6669 7273   return deepfirs
-00029370: 7428 7365 715b 305d 290a 0a0a 6465 6620  t(seq[0])...def 
-00029380: 7368 6170 656c 6973 7428 6129 3a0a 2020  shapelist(a):.  
-00029390: 2020 2222 2247 6574 2074 6865 2073 6861    """Get the sha
-000293a0: 7065 206f 6620 6e65 7374 6564 206c 6973  pe of nested lis
-000293b0: 7422 2222 0a20 2020 2069 6620 7479 7065  t""".    if type
-000293c0: 2861 2920 6973 206c 6973 743a 0a20 2020  (a) is list:.   
-000293d0: 2020 2020 2072 6574 7572 6e20 7475 706c       return tupl
-000293e0: 6528 5b6c 656e 2861 295d 202b 206c 6973  e([len(a)] + lis
-000293f0: 7428 7368 6170 656c 6973 7428 615b 305d  t(shapelist(a[0]
-00029400: 2929 290a 2020 2020 656c 7365 3a0a 2020  ))).    else:.  
-00029410: 2020 2020 2020 7265 7475 726e 2028 290a        return ().
-00029420: 0a0a 6465 6620 7472 616e 7370 6f73 656c  ..def transposel
-00029430: 6973 7428 6172 7261 7973 2c20 6178 6573  ist(arrays, axes
-00029440: 2c20 6578 7472 6164 696d 733d 3029 3a0a  , extradims=0):.
-00029450: 2020 2020 2222 2250 6572 6d75 7465 2061      """Permute a
-00029460: 7865 7320 6f66 206e 6573 7465 6420 6c69  xes of nested li
-00029470: 7374 0a0a 2020 2020 3e3e 3e20 7472 616e  st..    >>> tran
-00029480: 7370 6f73 656c 6973 7428 5b5b 312c 312c  sposelist([[1,1,
-00029490: 315d 2c5b 312c 312c 315d 5d2c 205b 322c  1],[1,1,1]], [2,
-000294a0: 315d 290a 2020 2020 5b5b 5b31 2c20 315d  1]).    [[[1, 1]
-000294b0: 2c20 5b31 2c20 315d 2c20 5b31 2c20 315d  , [1, 1], [1, 1]
-000294c0: 5d5d 0a0a 2020 2020 3e3e 3e20 7472 616e  ]]..    >>> tran
-000294d0: 7370 6f73 656c 6973 7428 5b5b 312c 312c  sposelist([[1,1,
-000294e0: 315d 2c5b 312c 312c 315d 5d2c 205b 322c  1],[1,1,1]], [2,
-000294f0: 315d 2c20 6578 7472 6164 696d 733d 3129  1], extradims=1)
-00029500: 0a20 2020 205b 5b5b 5b31 5d2c 205b 315d  .    [[[[1], [1]
-00029510: 5d2c 205b 5b31 5d2c 205b 315d 5d2c 205b  ], [[1], [1]], [
-00029520: 5b31 5d2c 205b 315d 5d5d 5d0a 2020 2020  [1], [1]]]].    
-00029530: 2222 220a 2020 2020 6966 206c 656e 2861  """.    if len(a
-00029540: 7865 7329 2021 3d20 6e64 696d 6c69 7374  xes) != ndimlist
-00029550: 2861 7272 6179 7329 3a0a 2020 2020 2020  (arrays):.      
-00029560: 2020 7261 6973 6520 5661 6c75 6545 7272    raise ValueErr
-00029570: 6f72 2822 4c65 6e67 7468 206f 6620 6178  or("Length of ax
-00029580: 6573 2073 686f 756c 6420 6571 7561 6c20  es should equal 
-00029590: 6465 7074 6820 6f66 206e 6573 7465 6420  depth of nested 
-000295a0: 6172 7261 7973 2229 0a20 2020 2069 6620  arrays").    if 
-000295b0: 6578 7472 6164 696d 7320 3c20 303a 0a20  extradims < 0:. 
-000295c0: 2020 2020 2020 2072 6169 7365 2056 616c         raise Val
-000295d0: 7565 4572 726f 7228 2260 6e65 7764 696d  ueError("`newdim
-000295e0: 7360 2073 686f 756c 6420 6265 2070 6f73  s` should be pos
-000295f0: 6974 6976 6522 290a 2020 2020 6966 206c  itive").    if l
-00029600: 656e 2861 7865 7329 203e 206c 656e 2873  en(axes) > len(s
-00029610: 6574 2861 7865 7329 293a 0a20 2020 2020  et(axes)):.     
-00029620: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00029630: 726f 7228 2260 6178 6573 6020 7368 6f75  ror("`axes` shou
-00029640: 6c64 2062 6520 756e 6971 7565 2229 0a0a  ld be unique")..
-00029650: 2020 2020 6e64 696d 203d 206d 6178 2861      ndim = max(a
-00029660: 7865 7329 202b 2031 0a20 2020 2073 6861  xes) + 1.    sha
-00029670: 7065 203d 2073 6861 7065 6c69 7374 2861  pe = shapelist(a
-00029680: 7272 6179 7329 0a20 2020 206e 6577 7368  rrays).    newsh
-00029690: 6170 6520 3d20 5b0a 2020 2020 2020 2020  ape = [.        
-000296a0: 7368 6170 655b 6178 6573 2e69 6e64 6578  shape[axes.index
-000296b0: 2869 295d 2069 6620 6920 696e 2061 7865  (i)] if i in axe
-000296c0: 7320 656c 7365 2031 2066 6f72 2069 2069  s else 1 for i i
-000296d0: 6e20 7261 6e67 6528 6e64 696d 202b 2065  n range(ndim + e
-000296e0: 7874 7261 6469 6d73 290a 2020 2020 5d0a  xtradims).    ].
-000296f0: 0a20 2020 2072 6573 756c 7420 3d20 6c69  .    result = li
-00029700: 7374 2863 6f72 652e 666c 6174 7465 6e28  st(core.flatten(
-00029710: 6172 7261 7973 2929 0a20 2020 2072 6574  arrays)).    ret
-00029720: 7572 6e20 7265 7368 6170 656c 6973 7428  urn reshapelist(
-00029730: 6e65 7773 6861 7065 2c20 7265 7375 6c74  newshape, result
-00029740: 290a 0a0a 6465 6620 7374 6163 6b28 7365  )...def stack(se
-00029750: 712c 2061 7869 733d 302c 2061 6c6c 6f77  q, axis=0, allow
-00029760: 5f75 6e6b 6e6f 776e 5f63 6875 6e6b 7369  _unknown_chunksi
-00029770: 7a65 733d 4661 6c73 6529 3a0a 2020 2020  zes=False):.    
-00029780: 2222 220a 2020 2020 5374 6163 6b20 6172  """.    Stack ar
-00029790: 7261 7973 2061 6c6f 6e67 2061 206e 6577  rays along a new
-000297a0: 2061 7869 730a 0a20 2020 2047 6976 656e   axis..    Given
-000297b0: 2061 2073 6571 7565 6e63 6520 6f66 2064   a sequence of d
-000297c0: 6173 6b20 6172 7261 7973 2c20 666f 726d  ask arrays, form
-000297d0: 2061 206e 6577 2064 6173 6b20 6172 7261   a new dask arra
-000297e0: 7920 6279 2073 7461 636b 696e 6720 7468  y by stacking th
-000297f0: 656d 0a20 2020 2061 6c6f 6e67 2061 206e  em.    along a n
-00029800: 6577 2064 696d 656e 7369 6f6e 2028 6178  ew dimension (ax
-00029810: 6973 3d30 2062 7920 6465 6661 756c 7429  is=0 by default)
-00029820: 0a0a 2020 2020 5061 7261 6d65 7465 7273  ..    Parameters
-00029830: 0a20 2020 202d 2d2d 2d2d 2d2d 2d2d 2d0a  .    ----------.
-00029840: 2020 2020 7365 713a 206c 6973 7420 6f66      seq: list of
-00029850: 2064 6173 6b2e 6172 7261 7973 0a20 2020   dask.arrays.   
-00029860: 2061 7869 733a 2069 6e74 0a20 2020 2020   axis: int.     
-00029870: 2020 2044 696d 656e 7369 6f6e 2061 6c6f     Dimension alo
-00029880: 6e67 2077 6869 6368 2074 6f20 616c 6967  ng which to alig
-00029890: 6e20 616c 6c20 6f66 2074 6865 2061 7272  n all of the arr
-000298a0: 6179 730a 2020 2020 616c 6c6f 775f 756e  ays.    allow_un
-000298b0: 6b6e 6f77 6e5f 6368 756e 6b73 697a 6573  known_chunksizes
-000298c0: 3a20 626f 6f6c 0a20 2020 2020 2020 2041  : bool.        A
-000298d0: 6c6c 6f77 2075 6e6b 6e6f 776e 2063 6875  llow unknown chu
-000298e0: 6e6b 7369 7a65 732c 2073 7563 6820 6173  nksizes, such as
-000298f0: 2063 6f6d 6520 6672 6f6d 2063 6f6e 7665   come from conve
-00029900: 7274 696e 6720 6672 6f6d 2064 6173 6b0a  rting from dask.
-00029910: 2020 2020 2020 2020 6461 7461 6672 616d          datafram
-00029920: 6573 2e20 2044 6173 6b2e 6172 7261 7920  es.  Dask.array 
-00029930: 6973 2075 6e61 626c 6520 746f 2076 6572  is unable to ver
-00029940: 6966 7920 7468 6174 2063 6875 6e6b 7320  ify that chunks 
-00029950: 6c69 6e65 2075 702e 2020 4966 0a20 2020  line up.  If.   
-00029960: 2020 2020 2064 6174 6120 636f 6d65 7320       data comes 
-00029970: 6672 6f6d 2064 6966 6665 7265 6e74 6c79  from differently
-00029980: 2061 6c69 676e 6564 2073 6f75 7263 6573   aligned sources
-00029990: 2074 6865 6e20 7468 6973 2063 616e 2063   then this can c
-000299a0: 6175 7365 0a20 2020 2020 2020 2075 6e65  ause.        une
-000299b0: 7870 6563 7465 6420 7265 7375 6c74 732e  xpected results.
-000299c0: 0a0a 2020 2020 4578 616d 706c 6573 0a20  ..    Examples. 
-000299d0: 2020 202d 2d2d 2d2d 2d2d 2d0a 0a20 2020     --------..   
-000299e0: 2043 7265 6174 6520 736c 6963 6573 0a0a   Create slices..
-000299f0: 2020 2020 3e3e 3e20 696d 706f 7274 2064      >>> import d
-00029a00: 6173 6b2e 6172 7261 7920 6173 2064 610a  ask.array as da.
-00029a10: 2020 2020 3e3e 3e20 696d 706f 7274 206e      >>> import n
-00029a20: 756d 7079 2061 7320 6e70 0a0a 2020 2020  umpy as np..    
-00029a30: 3e3e 3e20 6461 7461 203d 205b 6461 2e66  >>> data = [da.f
-00029a40: 726f 6d5f 6172 7261 7928 6e70 2e6f 6e65  rom_array(np.one
-00029a50: 7328 2834 2c20 3429 292c 2063 6875 6e6b  s((4, 4)), chunk
-00029a60: 733d 2832 2c20 3229 290a 2020 2020 2e2e  s=(2, 2)).    ..
-00029a70: 2e20 2020 2020 2020 2020 666f 7220 6920  .         for i 
-00029a80: 696e 2072 616e 6765 2833 295d 0a0a 2020  in range(3)]..  
-00029a90: 2020 3e3e 3e20 7820 3d20 6461 2e73 7461    >>> x = da.sta
-00029aa0: 636b 2864 6174 612c 2061 7869 733d 3029  ck(data, axis=0)
-00029ab0: 0a20 2020 203e 3e3e 2078 2e73 6861 7065  .    >>> x.shape
-00029ac0: 0a20 2020 2028 332c 2034 2c20 3429 0a0a  .    (3, 4, 4)..
-00029ad0: 2020 2020 3e3e 3e20 6461 2e73 7461 636b      >>> da.stack
-00029ae0: 2864 6174 612c 2061 7869 733d 3129 2e73  (data, axis=1).s
-00029af0: 6861 7065 0a20 2020 2028 342c 2033 2c20  hape.    (4, 3, 
-00029b00: 3429 0a0a 2020 2020 3e3e 3e20 6461 2e73  4)..    >>> da.s
-00029b10: 7461 636b 2864 6174 612c 2061 7869 733d  tack(data, axis=
-00029b20: 2d31 292e 7368 6170 650a 2020 2020 2834  -1).shape.    (4
-00029b30: 2c20 342c 2033 290a 0a20 2020 2052 6573  , 4, 3)..    Res
-00029b40: 756c 7420 6973 2061 206e 6577 2064 6173  ult is a new das
-00029b50: 6b20 4172 7261 790a 0a20 2020 2053 6565  k Array..    See
-00029b60: 2041 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d   Also.    ------
-00029b70: 2d2d 0a20 2020 2063 6f6e 6361 7465 6e61  --.    concatena
-00029b80: 7465 0a20 2020 2022 2222 0a20 2020 2066  te.    """.    f
-00029b90: 726f 6d20 6461 736b 2e61 7272 6179 2069  rom dask.array i
-00029ba0: 6d70 6f72 7420 7772 6170 0a0a 2020 2020  mport wrap..    
-00029bb0: 7365 7120 3d20 5b61 7361 7272 6179 2861  seq = [asarray(a
-00029bc0: 2c20 616c 6c6f 775f 756e 6b6e 6f77 6e5f  , allow_unknown_
-00029bd0: 6368 756e 6b73 697a 6573 3d61 6c6c 6f77  chunksizes=allow
-00029be0: 5f75 6e6b 6e6f 776e 5f63 6875 6e6b 7369  _unknown_chunksi
-00029bf0: 7a65 7329 2066 6f72 2061 2069 6e20 7365  zes) for a in se
-00029c00: 715d 0a0a 2020 2020 6966 206e 6f74 2073  q]..    if not s
-00029c10: 6571 3a0a 2020 2020 2020 2020 7261 6973  eq:.        rais
-00029c20: 6520 5661 6c75 6545 7272 6f72 2822 4e65  e ValueError("Ne
-00029c30: 6564 2061 7272 6179 2873 2920 746f 2073  ed array(s) to s
-00029c40: 7461 636b 2229 0a20 2020 2069 6620 6e6f  tack").    if no
-00029c50: 7420 616c 6c6f 775f 756e 6b6e 6f77 6e5f  t allow_unknown_
-00029c60: 6368 756e 6b73 697a 6573 2061 6e64 206e  chunksizes and n
-00029c70: 6f74 2061 6c6c 2878 2e73 6861 7065 203d  ot all(x.shape =
-00029c80: 3d20 7365 715b 305d 2e73 6861 7065 2066  = seq[0].shape f
-00029c90: 6f72 2078 2069 6e20 7365 7129 3a0a 2020  or x in seq):.  
-00029ca0: 2020 2020 2020 6964 7820 3d20 6669 7273        idx = firs
-00029cb0: 7428 6920 666f 7220 6920 696e 2065 6e75  t(i for i in enu
-00029cc0: 6d65 7261 7465 2873 6571 2920 6966 2069  merate(seq) if i
-00029cd0: 5b31 5d2e 7368 6170 6520 213d 2073 6571  [1].shape != seq
-00029ce0: 5b30 5d2e 7368 6170 6529 0a20 2020 2020  [0].shape).     
-00029cf0: 2020 2072 6169 7365 2056 616c 7565 4572     raise ValueEr
-00029d00: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
-00029d10: 2022 5374 6163 6b65 6420 6172 7261 7973   "Stacked arrays
-00029d20: 206d 7573 7420 6861 7665 2074 6865 2073   must have the s
-00029d30: 616d 6520 7368 6170 652e 2054 6865 2066  ame shape. The f
-00029d40: 6972 7374 2061 7272 6179 2068 6164 2073  irst array had s
-00029d50: 6861 7065 2022 0a20 2020 2020 2020 2020  hape ".         
-00029d60: 2020 2066 227b 7365 715b 305d 2e73 6861     f"{seq[0].sha
-00029d70: 7065 7d2c 2077 6869 6c65 2061 7272 6179  pe}, while array
-00029d80: 207b 6964 785b 305d 202b 2031 7d20 6861   {idx[0] + 1} ha
-00029d90: 7320 7368 6170 6520 7b69 6478 5b31 5d2e  s shape {idx[1].
-00029da0: 7368 6170 657d 2e22 0a20 2020 2020 2020  shape}.".       
-00029db0: 2029 0a0a 2020 2020 6d65 7461 203d 206e   )..    meta = n
-00029dc0: 702e 7374 6163 6b28 5b6d 6574 615f 6672  p.stack([meta_fr
-00029dd0: 6f6d 5f61 7272 6179 2861 2920 666f 7220  om_array(a) for 
-00029de0: 6120 696e 2073 6571 5d2c 2061 7869 733d  a in seq], axis=
-00029df0: 6178 6973 290a 2020 2020 7365 7120 3d20  axis).    seq = 
-00029e00: 5b78 2e61 7374 7970 6528 6d65 7461 2e64  [x.astype(meta.d
-00029e10: 7479 7065 2920 666f 7220 7820 696e 2073  type) for x in s
-00029e20: 6571 5d0a 0a20 2020 206e 6469 6d20 3d20  eq]..    ndim = 
-00029e30: 6d65 7461 2e6e 6469 6d20 2d20 310a 2020  meta.ndim - 1.  
-00029e40: 2020 6966 2061 7869 7320 3c20 303a 0a20    if axis < 0:. 
-00029e50: 2020 2020 2020 2061 7869 7320 3d20 6e64         axis = nd
-00029e60: 696d 202b 2061 7869 7320 2b20 310a 2020  im + axis + 1.  
-00029e70: 2020 7368 6170 6520 3d20 7475 706c 6528    shape = tuple(
-00029e80: 0a20 2020 2020 2020 206c 656e 2873 6571  .        len(seq
-00029e90: 290a 2020 2020 2020 2020 6966 2069 203d  ).        if i =
-00029ea0: 3d20 6178 6973 0a20 2020 2020 2020 2065  = axis.        e
-00029eb0: 6c73 6520 2873 6571 5b30 5d2e 7368 6170  lse (seq[0].shap
-00029ec0: 655b 695d 2069 6620 6920 3c20 6178 6973  e[i] if i < axis
-00029ed0: 2065 6c73 6520 7365 715b 305d 2e73 6861   else seq[0].sha
-00029ee0: 7065 5b69 202d 2031 5d29 0a20 2020 2020  pe[i - 1]).     
-00029ef0: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-00029f00: 6528 6d65 7461 2e6e 6469 6d29 0a20 2020  e(meta.ndim).   
-00029f10: 2029 0a0a 2020 2020 7365 7132 203d 205b   )..    seq2 = [
-00029f20: 6120 666f 7220 6120 696e 2073 6571 2069  a for a in seq i
-00029f30: 6620 612e 7369 7a65 5d0a 2020 2020 6966  f a.size].    if
-00029f40: 206e 6f74 2073 6571 323a 0a20 2020 2020   not seq2:.     
-00029f50: 2020 2073 6571 3220 3d20 7365 710a 0a20     seq2 = seq.. 
-00029f60: 2020 206e 203d 206c 656e 2873 6571 3229     n = len(seq2)
-00029f70: 0a20 2020 2069 6620 6e20 3d3d 2030 3a0a  .    if n == 0:.
-00029f80: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00029f90: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00029fa0: 7772 6170 2e65 6d70 7479 5f6c 696b 6528  wrap.empty_like(
-00029fb0: 6d65 7461 2c20 7368 6170 653d 7368 6170  meta, shape=shap
-00029fc0: 652c 2063 6875 6e6b 733d 7368 6170 652c  e, chunks=shape,
-00029fd0: 2064 7479 7065 3d6d 6574 612e 6474 7970   dtype=meta.dtyp
-00029fe0: 6529 0a20 2020 2020 2020 2065 7863 6570  e).        excep
-00029ff0: 7420 5479 7065 4572 726f 723a 0a20 2020  t TypeError:.   
-0002a000: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0002a010: 7772 6170 2e65 6d70 7479 2873 6861 7065  wrap.empty(shape
-0002a020: 2c20 6368 756e 6b73 3d73 6861 7065 2c20  , chunks=shape, 
-0002a030: 6474 7970 653d 6d65 7461 2e64 7479 7065  dtype=meta.dtype
-0002a040: 290a 0a20 2020 2069 6e64 203d 206c 6973  )..    ind = lis
-0002a050: 7428 7261 6e67 6528 6e64 696d 2929 0a20  t(range(ndim)). 
-0002a060: 2020 2075 635f 6172 6773 203d 206c 6973     uc_args = lis
-0002a070: 7428 636f 6e63 6174 2828 782c 2069 6e64  t(concat((x, ind
-0002a080: 2920 666f 7220 7820 696e 2073 6571 3229  ) for x in seq2)
-0002a090: 290a 2020 2020 5f2c 2073 6571 3220 3d20  ).    _, seq2 = 
-0002a0a0: 756e 6966 795f 6368 756e 6b73 282a 7563  unify_chunks(*uc
-0002a0b0: 5f61 7267 7329 0a0a 2020 2020 6173 7365  _args)..    asse
-0002a0c0: 7274 206c 656e 287b 612e 6368 756e 6b73  rt len({a.chunks
-0002a0d0: 2066 6f72 2061 2069 6e20 7365 7132 7d29   for a in seq2})
-0002a0e0: 203d 3d20 3120 2023 2073 616d 6520 6368   == 1  # same ch
-0002a0f0: 756e 6b73 0a20 2020 2063 6875 6e6b 7320  unks.    chunks 
-0002a100: 3d20 7365 7132 5b30 5d2e 6368 756e 6b73  = seq2[0].chunks
-0002a110: 5b3a 6178 6973 5d20 2b20 2828 312c 2920  [:axis] + ((1,) 
-0002a120: 2a20 6e2c 2920 2b20 7365 7132 5b30 5d2e  * n,) + seq2[0].
-0002a130: 6368 756e 6b73 5b61 7869 733a 5d0a 0a20  chunks[axis:].. 
-0002a140: 2020 206e 616d 6573 203d 205b 612e 6e61     names = [a.na
-0002a150: 6d65 2066 6f72 2061 2069 6e20 7365 7132  me for a in seq2
-0002a160: 5d0a 2020 2020 6e61 6d65 203d 2022 7374  ].    name = "st
-0002a170: 6163 6b2d 2220 2b20 746f 6b65 6e69 7a65  ack-" + tokenize
-0002a180: 286e 616d 6573 2c20 6178 6973 290a 2020  (names, axis).  
-0002a190: 2020 6b65 7973 203d 206c 6973 7428 7072    keys = list(pr
-0002a1a0: 6f64 7563 7428 5b6e 616d 655d 2c20 2a5b  oduct([name], *[
-0002a1b0: 7261 6e67 6528 6c65 6e28 6264 2929 2066  range(len(bd)) f
-0002a1c0: 6f72 2062 6420 696e 2063 6875 6e6b 735d  or bd in chunks]
-0002a1d0: 2929 0a0a 2020 2020 696e 7075 7473 203d  ))..    inputs =
-0002a1e0: 205b 0a20 2020 2020 2020 2028 6e61 6d65   [.        (name
-0002a1f0: 735b 6b65 795b 6178 6973 202b 2031 5d5d  s[key[axis + 1]]
-0002a200: 2c29 202b 206b 6579 5b31 203a 2061 7869  ,) + key[1 : axi
-0002a210: 7320 2b20 315d 202b 206b 6579 5b61 7869  s + 1] + key[axi
-0002a220: 7320 2b20 3220 3a5d 2066 6f72 206b 6579  s + 2 :] for key
-0002a230: 2069 6e20 6b65 7973 0a20 2020 205d 0a20   in keys.    ]. 
-0002a240: 2020 2076 616c 7565 7320 3d20 5b0a 2020     values = [.  
-0002a250: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-0002a260: 2020 2020 6765 7469 7465 6d2c 0a20 2020      getitem,.   
-0002a270: 2020 2020 2020 2020 2069 6e70 2c0a 2020           inp,.  
-0002a280: 2020 2020 2020 2020 2020 2873 6c69 6365            (slice
-0002a290: 284e 6f6e 652c 204e 6f6e 652c 204e 6f6e  (None, None, Non
-0002a2a0: 6529 2c29 202a 2061 7869 730a 2020 2020  e),) * axis.    
-0002a2b0: 2020 2020 2020 2020 2b20 284e 6f6e 652c          + (None,
-0002a2c0: 290a 2020 2020 2020 2020 2020 2020 2b20  ).            + 
-0002a2d0: 2873 6c69 6365 284e 6f6e 652c 204e 6f6e  (slice(None, Non
-0002a2e0: 652c 204e 6f6e 6529 2c29 202a 2028 6e64  e, None),) * (nd
-0002a2f0: 696d 202d 2061 7869 7329 2c0a 2020 2020  im - axis),.    
-0002a300: 2020 2020 290a 2020 2020 2020 2020 666f      ).        fo
-0002a310: 7220 696e 7020 696e 2069 6e70 7574 730a  r inp in inputs.
-0002a320: 2020 2020 5d0a 0a20 2020 206c 6179 6572      ]..    layer
-0002a330: 203d 2064 6963 7428 7a69 7028 6b65 7973   = dict(zip(keys
-0002a340: 2c20 7661 6c75 6573 2929 0a20 2020 2067  , values)).    g
-0002a350: 7261 7068 203d 2048 6967 684c 6576 656c  raph = HighLevel
-0002a360: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
-0002a370: 6374 696f 6e73 286e 616d 652c 206c 6179  ctions(name, lay
-0002a380: 6572 2c20 6465 7065 6e64 656e 6369 6573  er, dependencies
-0002a390: 3d73 6571 3229 0a0a 2020 2020 7265 7475  =seq2)..    retu
-0002a3a0: 726e 2041 7272 6179 2867 7261 7068 2c20  rn Array(graph, 
-0002a3b0: 6e61 6d65 2c20 6368 756e 6b73 2c20 6d65  name, chunks, me
-0002a3c0: 7461 3d6d 6574 6129 0a0a 0a64 6566 2063  ta=meta)...def c
-0002a3d0: 6f6e 6361 7465 6e61 7465 3328 6172 7261  oncatenate3(arra
-0002a3e0: 7973 293a 0a20 2020 2022 2222 5265 6375  ys):.    """Recu
-0002a3f0: 7273 6976 6520 6e70 2e63 6f6e 6361 7465  rsive np.concate
-0002a400: 6e61 7465 0a0a 2020 2020 496e 7075 7420  nate..    Input 
-0002a410: 7368 6f75 6c64 2062 6520 6120 6e65 7374  should be a nest
-0002a420: 6564 206c 6973 7420 6f66 206e 756d 7079  ed list of numpy
-0002a430: 2061 7272 6179 7320 6172 7261 6e67 6564   arrays arranged
-0002a440: 2069 6e20 7468 6520 6f72 6465 7220 7468   in the order th
-0002a450: 6579 0a20 2020 2073 686f 756c 6420 6170  ey.    should ap
-0002a460: 7065 6172 2069 6e20 7468 6520 6172 7261  pear in the arra
-0002a470: 7920 6974 7365 6c66 2e20 2045 6163 6820  y itself.  Each 
-0002a480: 6172 7261 7920 7368 6f75 6c64 2068 6176  array should hav
-0002a490: 6520 7468 6520 7361 6d65 206e 756d 6265  e the same numbe
-0002a4a0: 720a 2020 2020 6f66 2064 696d 656e 7369  r.    of dimensi
-0002a4b0: 6f6e 7320 6173 2074 6865 2064 6573 6972  ons as the desir
-0002a4c0: 6564 206f 7574 7075 7420 616e 6420 7468  ed output and th
-0002a4d0: 6520 6e65 7374 696e 6720 6f66 2074 6865  e nesting of the
-0002a4e0: 206c 6973 7473 2e0a 0a20 2020 203e 3e3e   lists...    >>>
-0002a4f0: 2078 203d 206e 702e 6172 7261 7928 5b5b   x = np.array([[
-0002a500: 312c 2032 5d5d 290a 2020 2020 3e3e 3e20  1, 2]]).    >>> 
-0002a510: 636f 6e63 6174 656e 6174 6533 285b 5b78  concatenate3([[x
-0002a520: 2c20 782c 2078 5d2c 205b 782c 2078 2c20  , x, x], [x, x, 
-0002a530: 785d 5d29 0a20 2020 2061 7272 6179 285b  x]]).    array([
-0002a540: 5b31 2c20 322c 2031 2c20 322c 2031 2c20  [1, 2, 1, 2, 1, 
-0002a550: 325d 2c0a 2020 2020 2020 2020 2020 205b  2],.           [
-0002a560: 312c 2032 2c20 312c 2032 2c20 312c 2032  1, 2, 1, 2, 1, 2
-0002a570: 5d5d 290a 0a20 2020 203e 3e3e 2063 6f6e  ]])..    >>> con
-0002a580: 6361 7465 6e61 7465 3328 5b5b 782c 2078  catenate3([[x, x
-0002a590: 5d2c 205b 782c 2078 5d2c 205b 782c 2078  ], [x, x], [x, x
-0002a5a0: 5d5d 290a 2020 2020 6172 7261 7928 5b5b  ]]).    array([[
-0002a5b0: 312c 2032 2c20 312c 2032 5d2c 0a20 2020  1, 2, 1, 2],.   
-0002a5c0: 2020 2020 2020 2020 5b31 2c20 322c 2031          [1, 2, 1
-0002a5d0: 2c20 325d 2c0a 2020 2020 2020 2020 2020  , 2],.          
-0002a5e0: 205b 312c 2032 2c20 312c 2032 5d5d 290a   [1, 2, 1, 2]]).
-0002a5f0: 2020 2020 2222 220a 2020 2020 2320 5765      """.    # We
-0002a600: 206e 6565 6420 7468 6973 2061 7320 5f5f   need this as __
-0002a610: 6172 7261 795f 6675 6e63 7469 6f6e 5f5f  array_function__
-0002a620: 206d 6179 206e 6f74 2065 7869 7374 206f   may not exist o
-0002a630: 6e20 6f6c 6465 7220 4e75 6d50 7920 7665  n older NumPy ve
-0002a640: 7273 696f 6e73 2e0a 2020 2020 2320 416e  rsions..    # An
-0002a650: 6420 746f 2072 6564 7563 6520 7665 7262  d to reduce verb
-0002a660: 6f73 6974 792e 0a20 2020 204e 4441 5252  osity..    NDARR
-0002a670: 4159 5f41 5252 4159 5f46 554e 4354 494f  AY_ARRAY_FUNCTIO
-0002a680: 4e20 3d20 6765 7461 7474 7228 6e70 2e6e  N = getattr(np.n
-0002a690: 6461 7272 6179 2c20 225f 5f61 7272 6179  darray, "__array
-0002a6a0: 5f66 756e 6374 696f 6e5f 5f22 2c20 4e6f  _function__", No
-0002a6b0: 6e65 290a 0a20 2020 2061 7272 6179 7320  ne)..    arrays 
-0002a6c0: 3d20 636f 6e63 7265 7465 2861 7272 6179  = concrete(array
-0002a6d0: 7329 0a20 2020 2069 6620 6e6f 7420 6172  s).    if not ar
-0002a6e0: 7261 7973 3a0a 2020 2020 2020 2020 7265  rays:.        re
-0002a6f0: 7475 726e 206e 702e 656d 7074 7928 3029  turn np.empty(0)
-0002a700: 0a0a 2020 2020 6164 7661 6e63 6564 203d  ..    advanced =
-0002a710: 206d 6178 280a 2020 2020 2020 2020 636f   max(.        co
-0002a720: 7265 2e66 6c61 7474 656e 2861 7272 6179  re.flatten(array
-0002a730: 732c 2063 6f6e 7461 696e 6572 3d28 6c69  s, container=(li
-0002a740: 7374 2c20 7475 706c 6529 292c 0a20 2020  st, tuple)),.   
-0002a750: 2020 2020 206b 6579 3d6c 616d 6264 6120       key=lambda 
-0002a760: 783a 2067 6574 6174 7472 2878 2c20 225f  x: getattr(x, "_
-0002a770: 5f61 7272 6179 5f70 7269 6f72 6974 795f  _array_priority_
-0002a780: 5f22 2c20 3029 2c0a 2020 2020 290a 0a20  _", 0),.    ).. 
-0002a790: 2020 2069 6620 6e6f 7420 616c 6c28 0a20     if not all(. 
-0002a7a0: 2020 2020 2020 204e 4441 5252 4159 5f41         NDARRAY_A
-0002a7b0: 5252 4159 5f46 554e 4354 494f 4e0a 2020  RRAY_FUNCTION.  
-0002a7c0: 2020 2020 2020 6973 2067 6574 6174 7472        is getattr
-0002a7d0: 2874 7970 6528 6172 7229 2c20 225f 5f61  (type(arr), "__a
-0002a7e0: 7272 6179 5f66 756e 6374 696f 6e5f 5f22  rray_function__"
-0002a7f0: 2c20 4e44 4152 5241 595f 4152 5241 595f  , NDARRAY_ARRAY_
-0002a800: 4655 4e43 5449 4f4e 290a 2020 2020 2020  FUNCTION).      
-0002a810: 2020 666f 7220 6172 7220 696e 2063 6f72    for arr in cor
-0002a820: 652e 666c 6174 7465 6e28 6172 7261 7973  e.flatten(arrays
-0002a830: 2c20 636f 6e74 6169 6e65 723d 286c 6973  , container=(lis
-0002a840: 742c 2074 7570 6c65 2929 0a20 2020 2029  t, tuple)).    )
-0002a850: 3a0a 2020 2020 2020 2020 7472 793a 0a20  :.        try:. 
-0002a860: 2020 2020 2020 2020 2020 2078 203d 2075             x = u
-0002a870: 6e70 6163 6b5f 7369 6e67 6c65 746f 6e28  npack_singleton(
-0002a880: 6172 7261 7973 290a 2020 2020 2020 2020  arrays).        
-0002a890: 2020 2020 7265 7475 726e 205f 636f 6e63      return _conc
-0002a8a0: 6174 656e 6174 6532 2861 7272 6179 732c  atenate2(arrays,
-0002a8b0: 2061 7865 733d 7475 706c 6528 7261 6e67   axes=tuple(rang
-0002a8c0: 6528 782e 6e64 696d 2929 290a 2020 2020  e(x.ndim))).    
-0002a8d0: 2020 2020 6578 6365 7074 2054 7970 6545      except TypeE
-0002a8e0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0002a8f0: 2020 7061 7373 0a0a 2020 2020 6966 2063    pass..    if c
-0002a900: 6f6e 6361 7465 6e61 7465 5f6c 6f6f 6b75  oncatenate_looku
-0002a910: 702e 6469 7370 6174 6368 2874 7970 6528  p.dispatch(type(
-0002a920: 6164 7661 6e63 6564 2929 2069 7320 6e6f  advanced)) is no
-0002a930: 7420 6e70 2e63 6f6e 6361 7465 6e61 7465  t np.concatenate
-0002a940: 3a0a 2020 2020 2020 2020 7820 3d20 756e  :.        x = un
-0002a950: 7061 636b 5f73 696e 676c 6574 6f6e 2861  pack_singleton(a
-0002a960: 7272 6179 7329 0a20 2020 2020 2020 2072  rrays).        r
-0002a970: 6574 7572 6e20 5f63 6f6e 6361 7465 6e61  eturn _concatena
-0002a980: 7465 3228 6172 7261 7973 2c20 6178 6573  te2(arrays, axes
-0002a990: 3d6c 6973 7428 7261 6e67 6528 782e 6e64  =list(range(x.nd
-0002a9a0: 696d 2929 290a 0a20 2020 206e 6469 6d20  im)))..    ndim 
-0002a9b0: 3d20 6e64 696d 6c69 7374 2861 7272 6179  = ndimlist(array
-0002a9c0: 7329 0a20 2020 2069 6620 6e6f 7420 6e64  s).    if not nd
-0002a9d0: 696d 3a0a 2020 2020 2020 2020 7265 7475  im:.        retu
-0002a9e0: 726e 2061 7272 6179 730a 2020 2020 6368  rn arrays.    ch
-0002a9f0: 756e 6b73 203d 2063 6875 6e6b 735f 6672  unks = chunks_fr
-0002aa00: 6f6d 5f61 7272 6179 7328 6172 7261 7973  om_arrays(arrays
-0002aa10: 290a 2020 2020 7368 6170 6520 3d20 7475  ).    shape = tu
-0002aa20: 706c 6528 6d61 7028 7375 6d2c 2063 6875  ple(map(sum, chu
-0002aa30: 6e6b 7329 290a 0a20 2020 2064 6566 2064  nks))..    def d
-0002aa40: 7479 7065 2878 293a 0a20 2020 2020 2020  type(x):.       
-0002aa50: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0002aa60: 2020 7265 7475 726e 2078 2e64 7479 7065    return x.dtype
-0002aa70: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0002aa80: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
-0002aa90: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0002aaa0: 726e 2074 7970 6528 7829 0a0a 2020 2020  rn type(x)..    
-0002aab0: 7265 7375 6c74 203d 206e 702e 656d 7074  result = np.empt
-0002aac0: 7928 7368 6170 653d 7368 6170 652c 2064  y(shape=shape, d
-0002aad0: 7479 7065 3d64 7479 7065 2864 6565 7066  type=dtype(deepf
-0002aae0: 6972 7374 2861 7272 6179 7329 2929 0a0a  irst(arrays)))..
-0002aaf0: 2020 2020 666f 7220 6964 782c 2061 7272      for idx, arr
-0002ab00: 2069 6e20 7a69 7028 0a20 2020 2020 2020   in zip(.       
-0002ab10: 2073 6c69 6365 735f 6672 6f6d 5f63 6875   slices_from_chu
-0002ab20: 6e6b 7328 6368 756e 6b73 292c 2063 6f72  nks(chunks), cor
-0002ab30: 652e 666c 6174 7465 6e28 6172 7261 7973  e.flatten(arrays
-0002ab40: 2c20 636f 6e74 6169 6e65 723d 286c 6973  , container=(lis
-0002ab50: 742c 2074 7570 6c65 2929 0a20 2020 2029  t, tuple)).    )
-0002ab60: 3a0a 2020 2020 2020 2020 6966 2068 6173  :.        if has
-0002ab70: 6174 7472 2861 7272 2c20 226e 6469 6d22  attr(arr, "ndim"
-0002ab80: 293a 0a20 2020 2020 2020 2020 2020 2077  ):.            w
-0002ab90: 6869 6c65 2061 7272 2e6e 6469 6d20 3c20  hile arr.ndim < 
-0002aba0: 6e64 696d 3a0a 2020 2020 2020 2020 2020  ndim:.          
-0002abb0: 2020 2020 2020 6172 7220 3d20 6172 725b        arr = arr[
-0002abc0: 4e6f 6e65 2c20 2e2e 2e5d 0a20 2020 2020  None, ...].     
-0002abd0: 2020 2072 6573 756c 745b 6964 785d 203d     result[idx] =
-0002abe0: 2061 7272 0a0a 2020 2020 7265 7475 726e   arr..    return
-0002abf0: 2072 6573 756c 740a 0a0a 6465 6620 636f   result...def co
-0002ac00: 6e63 6174 656e 6174 655f 6178 6573 2861  ncatenate_axes(a
-0002ac10: 7272 6179 732c 2061 7865 7329 3a0a 2020  rrays, axes):.  
-0002ac20: 2020 2222 2252 6563 7572 7369 7665 6c79    """Recursively
-0002ac30: 2063 616c 6c20 6e70 2e63 6f6e 6361 7465   call np.concate
-0002ac40: 6e61 7465 2061 6c6f 6e67 2061 7865 7322  nate along axes"
-0002ac50: 2222 0a20 2020 2069 6620 6c65 6e28 6178  "".    if len(ax
-0002ac60: 6573 2920 213d 206e 6469 6d6c 6973 7428  es) != ndimlist(
-0002ac70: 6172 7261 7973 293a 0a20 2020 2020 2020  arrays):.       
-0002ac80: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0002ac90: 7228 224c 656e 6774 6820 6f66 2061 7865  r("Length of axe
-0002aca0: 7320 7368 6f75 6c64 2065 7175 616c 2064  s should equal d
-0002acb0: 6570 7468 206f 6620 6e65 7374 6564 2061  epth of nested a
-0002acc0: 7272 6179 7322 290a 0a20 2020 2065 7874  rrays")..    ext
-0002acd0: 7261 6469 6d73 203d 206d 6178 2830 2c20  radims = max(0, 
-0002ace0: 6465 6570 6669 7273 7428 6172 7261 7973  deepfirst(arrays
-0002acf0: 292e 6e64 696d 202d 2028 6d61 7828 6178  ).ndim - (max(ax
-0002ad00: 6573 2920 2b20 3129 290a 2020 2020 7265  es) + 1)).    re
-0002ad10: 7475 726e 2063 6f6e 6361 7465 6e61 7465  turn concatenate
-0002ad20: 3328 7472 616e 7370 6f73 656c 6973 7428  3(transposelist(
-0002ad30: 6172 7261 7973 2c20 6178 6573 2c20 6578  arrays, axes, ex
-0002ad40: 7472 6164 696d 733d 6578 7472 6164 696d  tradims=extradim
-0002ad50: 7329 290a 0a0a 6465 6620 746f 5f68 6466  s))...def to_hdf
-0002ad60: 3528 6669 6c65 6e61 6d65 2c20 2a61 7267  5(filename, *arg
-0002ad70: 732c 2063 6875 6e6b 733d 5472 7565 2c20  s, chunks=True, 
-0002ad80: 2a2a 6b77 6172 6773 293a 0a20 2020 2022  **kwargs):.    "
-0002ad90: 2222 5374 6f72 6520 6172 7261 7973 2069  ""Store arrays i
-0002ada0: 6e20 4844 4635 2066 696c 650a 0a20 2020  n HDF5 file..   
-0002adb0: 2054 6869 7320 7361 7665 7320 7365 7665   This saves seve
-0002adc0: 7261 6c20 6461 736b 2061 7272 6179 7320  ral dask arrays 
-0002add0: 696e 746f 2073 6576 6572 616c 2064 6174  into several dat
-0002ade0: 6170 6174 6873 2069 6e20 616e 2048 4446  apaths in an HDF
-0002adf0: 3520 6669 6c65 2e0a 2020 2020 4974 2063  5 file..    It c
-0002ae00: 7265 6174 6573 2074 6865 206e 6563 6573  reates the neces
-0002ae10: 7361 7279 2064 6174 6173 6574 7320 616e  sary datasets an
-0002ae20: 6420 6861 6e64 6c65 7320 636c 6561 6e20  d handles clean 
-0002ae30: 6669 6c65 206f 7065 6e69 6e67 2f63 6c6f  file opening/clo
-0002ae40: 7369 6e67 2e0a 0a20 2020 2050 6172 616d  sing...    Param
-0002ae50: 6574 6572 730a 2020 2020 2d2d 2d2d 2d2d  eters.    ------
-0002ae60: 2d2d 2d2d 0a20 2020 2063 6875 6e6b 733a  ----.    chunks:
-0002ae70: 2074 7570 6c65 206f 7220 6060 5472 7565   tuple or ``True
-0002ae80: 6060 0a20 2020 2020 2020 2043 6875 6e6b  ``.        Chunk
-0002ae90: 2073 6861 7065 2c20 6f72 2060 6054 7275   shape, or ``Tru
-0002aea0: 6560 6020 746f 2070 6173 7320 7468 6520  e`` to pass the 
-0002aeb0: 6368 756e 6b73 2066 726f 6d20 7468 6520  chunks from the 
-0002aec0: 6461 736b 2061 7272 6179 2e0a 2020 2020  dask array..    
-0002aed0: 2020 2020 4465 6661 756c 7473 2074 6f20      Defaults to 
-0002aee0: 6060 5472 7565 6060 2e0a 0a20 2020 2045  ``True``...    E
-0002aef0: 7861 6d70 6c65 730a 2020 2020 2d2d 2d2d  xamples.    ----
-0002af00: 2d2d 2d2d 0a0a 2020 2020 3e3e 3e20 6461  ----..    >>> da
-0002af10: 2e74 6f5f 6864 6635 2827 6d79 6669 6c65  .to_hdf5('myfile
-0002af20: 2e68 6466 3527 2c20 272f 7827 2c20 7829  .hdf5', '/x', x)
-0002af30: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
-0002af40: 4950 0a0a 2020 2020 6f72 0a0a 2020 2020  IP..    or..    
-0002af50: 3e3e 3e20 6461 2e74 6f5f 6864 6635 2827  >>> da.to_hdf5('
-0002af60: 6d79 6669 6c65 2e68 6466 3527 2c20 7b27  myfile.hdf5', {'
-0002af70: 2f78 273a 2078 2c20 272f 7927 3a20 797d  /x': x, '/y': y}
-0002af80: 2920 2023 2064 6f63 7465 7374 3a20 2b53  )  # doctest: +S
-0002af90: 4b49 500a 0a20 2020 204f 7074 696f 6e61  KIP..    Optiona
-0002afa0: 6c6c 7920 7072 6f76 6964 6520 6172 6775  lly provide argu
-0002afb0: 6d65 6e74 7320 6173 2074 686f 7567 6820  ments as though 
-0002afc0: 746f 2060 6068 3570 792e 4669 6c65 2e63  to ``h5py.File.c
-0002afd0: 7265 6174 655f 6461 7461 7365 7460 600a  reate_dataset``.
-0002afe0: 0a20 2020 203e 3e3e 2064 612e 746f 5f68  .    >>> da.to_h
-0002aff0: 6466 3528 276d 7966 696c 652e 6864 6635  df5('myfile.hdf5
-0002b000: 272c 2027 2f78 272c 2078 2c20 636f 6d70  ', '/x', x, comp
-0002b010: 7265 7373 696f 6e3d 276c 7a66 272c 2073  ression='lzf', s
-0002b020: 6875 6666 6c65 3d54 7275 6529 2020 2320  huffle=True)  # 
-0002b030: 646f 6374 6573 743a 202b 534b 4950 0a0a  doctest: +SKIP..
-0002b040: 2020 2020 3e3e 3e20 6461 2e74 6f5f 6864      >>> da.to_hd
-0002b050: 6635 2827 6d79 6669 6c65 2e68 6466 3527  f5('myfile.hdf5'
-0002b060: 2c20 272f 7827 2c20 782c 2063 6875 6e6b  , '/x', x, chunk
-0002b070: 733d 2831 302c 3230 2c33 3029 2920 2023  s=(10,20,30))  #
-0002b080: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
-0002b090: 0a20 2020 2054 6869 7320 6361 6e20 616c  .    This can al
-0002b0a0: 736f 2062 6520 7573 6564 2061 7320 6120  so be used as a 
-0002b0b0: 6d65 7468 6f64 206f 6e20 6120 7369 6e67  method on a sing
-0002b0c0: 6c65 2041 7272 6179 0a0a 2020 2020 3e3e  le Array..    >>
-0002b0d0: 3e20 782e 746f 5f68 6466 3528 276d 7966  > x.to_hdf5('myf
-0002b0e0: 696c 652e 6864 6635 272c 2027 2f78 2729  ile.hdf5', '/x')
+00028900: 2264 696d 656e 7369 6f6e 206f 7220 6120  "dimension or a 
+00028910: 6469 6d65 6e73 696f 6e20 6f66 2073 697a  dimension of siz
+00028920: 6520 3122 2025 2028 782e 6368 756e 6b73  e 1" % (x.chunks
+00028930: 2c20 6368 756e 6b73 290a 2020 2020 2020  , chunks).      
+00028940: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
+00028950: 206e 616d 6520 3d20 2262 726f 6164 6361   name = "broadca
+00028960: 7374 5f74 6f2d 2220 2b20 746f 6b65 6e69  st_to-" + tokeni
+00028970: 7a65 2878 2c20 7368 6170 652c 2063 6875  ze(x, shape, chu
+00028980: 6e6b 7329 0a20 2020 2064 736b 203d 207b  nks).    dsk = {
+00028990: 7d0a 0a20 2020 2065 6e75 6d65 7261 7465  }..    enumerate
+000289a0: 645f 6368 756e 6b73 203d 2070 726f 6475  d_chunks = produ
+000289b0: 6374 282a 2865 6e75 6d65 7261 7465 2862  ct(*(enumerate(b
+000289c0: 6473 2920 666f 7220 6264 7320 696e 2063  ds) for bds in c
+000289d0: 6875 6e6b 7329 290a 2020 2020 666f 7220  hunks)).    for 
+000289e0: 6e65 775f 696e 6465 782c 2063 6875 6e6b  new_index, chunk
+000289f0: 5f73 6861 7065 2069 6e20 287a 6970 282a  _shape in (zip(*
+00028a00: 6563 2920 666f 7220 6563 2069 6e20 656e  ec) for ec in en
+00028a10: 756d 6572 6174 6564 5f63 6875 6e6b 7329  umerated_chunks)
+00028a20: 3a0a 2020 2020 2020 2020 6f6c 645f 696e  :.        old_in
+00028a30: 6465 7820 3d20 7475 706c 6528 0a20 2020  dex = tuple(.   
+00028a40: 2020 2020 2020 2020 2030 2069 6620 6264           0 if bd
+00028a50: 203d 3d20 2831 2c29 2065 6c73 6520 6920   == (1,) else i 
+00028a60: 666f 7220 6264 2c20 6920 696e 207a 6970  for bd, i in zip
+00028a70: 2878 2e63 6875 6e6b 732c 206e 6577 5f69  (x.chunks, new_i
+00028a80: 6e64 6578 5b6e 6469 6d5f 6e65 773a 5d29  ndex[ndim_new:])
+00028a90: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00028aa0: 2020 206f 6c64 5f6b 6579 203d 2028 782e     old_key = (x.
+00028ab0: 6e61 6d65 2c29 202b 206f 6c64 5f69 6e64  name,) + old_ind
+00028ac0: 6578 0a20 2020 2020 2020 206e 6577 5f6b  ex.        new_k
+00028ad0: 6579 203d 2028 6e61 6d65 2c29 202b 206e  ey = (name,) + n
+00028ae0: 6577 5f69 6e64 6578 0a20 2020 2020 2020  ew_index.       
+00028af0: 2064 736b 5b6e 6577 5f6b 6579 5d20 3d20   dsk[new_key] = 
+00028b00: 286e 702e 6272 6f61 6463 6173 745f 746f  (np.broadcast_to
+00028b10: 2c20 6f6c 645f 6b65 792c 2071 756f 7465  , old_key, quote
+00028b20: 2863 6875 6e6b 5f73 6861 7065 2929 0a0a  (chunk_shape))..
+00028b30: 2020 2020 6772 6170 6820 3d20 4869 6768      graph = High
+00028b40: 4c65 7665 6c47 7261 7068 2e66 726f 6d5f  LevelGraph.from_
+00028b50: 636f 6c6c 6563 7469 6f6e 7328 6e61 6d65  collections(name
+00028b60: 2c20 6473 6b2c 2064 6570 656e 6465 6e63  , dsk, dependenc
+00028b70: 6965 733d 5b78 5d29 0a20 2020 2072 6574  ies=[x]).    ret
+00028b80: 7572 6e20 4172 7261 7928 6772 6170 682c  urn Array(graph,
+00028b90: 206e 616d 652c 2063 6875 6e6b 732c 2064   name, chunks, d
+00028ba0: 7479 7065 3d78 2e64 7479 7065 2c20 6d65  type=x.dtype, me
+00028bb0: 7461 3d6d 6574 6129 0a0a 0a40 6465 7269  ta=meta)...@deri
+00028bc0: 7665 645f 6672 6f6d 286e 7029 0a64 6566  ved_from(np).def
+00028bd0: 2062 726f 6164 6361 7374 5f61 7272 6179   broadcast_array
+00028be0: 7328 2a61 7267 732c 2073 7562 6f6b 3d46  s(*args, subok=F
+00028bf0: 616c 7365 293a 0a20 2020 2073 7562 6f6b  alse):.    subok
+00028c00: 203d 2062 6f6f 6c28 7375 626f 6b29 0a0a   = bool(subok)..
+00028c10: 2020 2020 746f 5f61 7272 6179 203d 2061      to_array = a
+00028c20: 7361 6e79 6172 7261 7920 6966 2073 7562  sanyarray if sub
+00028c30: 6f6b 2065 6c73 6520 6173 6172 7261 790a  ok else asarray.
+00028c40: 2020 2020 6172 6773 203d 2074 7570 6c65      args = tuple
+00028c50: 2874 6f5f 6172 7261 7928 6529 2066 6f72  (to_array(e) for
+00028c60: 2065 2069 6e20 6172 6773 290a 0a20 2020   e in args)..   
+00028c70: 2023 2055 6e69 6679 2075 6e65 7665 6e20   # Unify uneven 
+00028c80: 6368 756e 6b69 6e67 0a20 2020 2069 6e64  chunking.    ind
+00028c90: 7320 3d20 5b6c 6973 7428 7265 7665 7273  s = [list(revers
+00028ca0: 6564 2872 616e 6765 2878 2e6e 6469 6d29  ed(range(x.ndim)
+00028cb0: 2929 2066 6f72 2078 2069 6e20 6172 6773  )) for x in args
+00028cc0: 5d0a 2020 2020 7563 5f61 7267 7320 3d20  ].    uc_args = 
+00028cd0: 636f 6e63 6174 287a 6970 2861 7267 732c  concat(zip(args,
+00028ce0: 2069 6e64 7329 290a 2020 2020 5f2c 2061   inds)).    _, a
+00028cf0: 7267 7320 3d20 756e 6966 795f 6368 756e  rgs = unify_chun
+00028d00: 6b73 282a 7563 5f61 7267 732c 2077 6172  ks(*uc_args, war
+00028d10: 6e3d 4661 6c73 6529 0a0a 2020 2020 7368  n=False)..    sh
+00028d20: 6170 6520 3d20 6272 6f61 6463 6173 745f  ape = broadcast_
+00028d30: 7368 6170 6573 282a 2865 2e73 6861 7065  shapes(*(e.shape
+00028d40: 2066 6f72 2065 2069 6e20 6172 6773 2929   for e in args))
+00028d50: 0a20 2020 2063 6875 6e6b 7320 3d20 6272  .    chunks = br
+00028d60: 6f61 6463 6173 745f 6368 756e 6b73 282a  oadcast_chunks(*
+00028d70: 2865 2e63 6875 6e6b 7320 666f 7220 6520  (e.chunks for e 
+00028d80: 696e 2061 7267 7329 290a 0a20 2020 2069  in args))..    i
+00028d90: 6620 4e55 4d50 595f 4745 5f32 3030 3a0a  f NUMPY_GE_200:.
+00028da0: 2020 2020 2020 2020 7265 7375 6c74 203d          result =
+00028db0: 2074 7570 6c65 2862 726f 6164 6361 7374   tuple(broadcast
+00028dc0: 5f74 6f28 652c 2073 6861 7065 3d73 6861  _to(e, shape=sha
+00028dd0: 7065 2c20 6368 756e 6b73 3d63 6875 6e6b  pe, chunks=chunk
+00028de0: 7329 2066 6f72 2065 2069 6e20 6172 6773  s) for e in args
+00028df0: 290a 2020 2020 656c 7365 3a0a 2020 2020  ).    else:.    
+00028e00: 2020 2020 7265 7375 6c74 203d 205b 6272      result = [br
+00028e10: 6f61 6463 6173 745f 746f 2865 2c20 7368  oadcast_to(e, sh
+00028e20: 6170 653d 7368 6170 652c 2063 6875 6e6b  ape=shape, chunk
+00028e30: 733d 6368 756e 6b73 2920 666f 7220 6520  s=chunks) for e 
+00028e40: 696e 2061 7267 735d 0a0a 2020 2020 7265  in args]..    re
+00028e50: 7475 726e 2072 6573 756c 740a 0a0a 6465  turn result...de
+00028e60: 6620 6f66 6673 6574 5f66 756e 6328 6675  f offset_func(fu
+00028e70: 6e63 2c20 6f66 6673 6574 2c20 2a61 7267  nc, offset, *arg
+00028e80: 7329 3a0a 2020 2020 2222 224f 6666 7365  s):.    """Offse
+00028e90: 7473 2069 6e70 7574 7320 6279 206f 6666  ts inputs by off
+00028ea0: 7365 740a 0a20 2020 203e 3e3e 2064 6f75  set..    >>> dou
+00028eb0: 626c 6520 3d20 6c61 6d62 6461 2078 3a20  ble = lambda x: 
+00028ec0: 7820 2a20 320a 2020 2020 3e3e 3e20 6620  x * 2.    >>> f 
+00028ed0: 3d20 6f66 6673 6574 5f66 756e 6328 646f  = offset_func(do
+00028ee0: 7562 6c65 2c20 2831 302c 2929 0a20 2020  uble, (10,)).   
+00028ef0: 203e 3e3e 2066 2831 290a 2020 2020 3232   >>> f(1).    22
+00028f00: 0a20 2020 203e 3e3e 2066 2833 3030 290a  .    >>> f(300).
+00028f10: 2020 2020 3632 300a 2020 2020 2222 220a      620.    """.
+00028f20: 0a20 2020 2064 6566 205f 6f66 6673 6574  .    def _offset
+00028f30: 282a 6172 6773 293a 0a20 2020 2020 2020  (*args):.       
+00028f40: 2061 7267 7332 203d 206c 6973 7428 6d61   args2 = list(ma
+00028f50: 7028 6164 642c 2061 7267 732c 206f 6666  p(add, args, off
+00028f60: 7365 7429 290a 2020 2020 2020 2020 7265  set)).        re
+00028f70: 7475 726e 2066 756e 6328 2a61 7267 7332  turn func(*args2
+00028f80: 290a 0a20 2020 2077 6974 6820 636f 6e74  )..    with cont
+00028f90: 6578 746c 6962 2e73 7570 7072 6573 7328  extlib.suppress(
+00028fa0: 4578 6365 7074 696f 6e29 3a0a 2020 2020  Exception):.    
+00028fb0: 2020 2020 5f6f 6666 7365 742e 5f5f 6e61      _offset.__na
+00028fc0: 6d65 5f5f 203d 2022 6f66 6673 6574 5f22  me__ = "offset_"
+00028fd0: 202b 2066 756e 632e 5f5f 6e61 6d65 5f5f   + func.__name__
+00028fe0: 0a0a 2020 2020 7265 7475 726e 205f 6f66  ..    return _of
+00028ff0: 6673 6574 0a0a 0a64 6566 2063 6875 6e6b  fset...def chunk
+00029000: 735f 6672 6f6d 5f61 7272 6179 7328 6172  s_from_arrays(ar
+00029010: 7261 7973 293a 0a20 2020 2022 2222 4368  rays):.    """Ch
+00029020: 756e 6b73 2074 7570 6c65 2066 726f 6d20  unks tuple from 
+00029030: 6e65 7374 6564 206c 6973 7420 6f66 2061  nested list of a
+00029040: 7272 6179 730a 0a20 2020 203e 3e3e 2078  rrays..    >>> x
+00029050: 203d 206e 702e 6172 7261 7928 5b31 2c20   = np.array([1, 
+00029060: 325d 290a 2020 2020 3e3e 3e20 6368 756e  2]).    >>> chun
+00029070: 6b73 5f66 726f 6d5f 6172 7261 7973 285b  ks_from_arrays([
+00029080: 782c 2078 5d29 0a20 2020 2028 2832 2c20  x, x]).    ((2, 
+00029090: 3229 2c29 0a0a 2020 2020 3e3e 3e20 7820  2),)..    >>> x 
+000290a0: 3d20 6e70 2e61 7272 6179 285b 5b31 2c20  = np.array([[1, 
+000290b0: 325d 5d29 0a20 2020 203e 3e3e 2063 6875  2]]).    >>> chu
+000290c0: 6e6b 735f 6672 6f6d 5f61 7272 6179 7328  nks_from_arrays(
+000290d0: 5b5b 785d 2c20 5b78 5d5d 290a 2020 2020  [[x], [x]]).    
+000290e0: 2828 312c 2031 292c 2028 322c 2929 0a0a  ((1, 1), (2,))..
+000290f0: 2020 2020 3e3e 3e20 7820 3d20 6e70 2e61      >>> x = np.a
+00029100: 7272 6179 285b 5b31 2c20 325d 5d29 0a20  rray([[1, 2]]). 
+00029110: 2020 203e 3e3e 2063 6875 6e6b 735f 6672     >>> chunks_fr
+00029120: 6f6d 5f61 7272 6179 7328 5b5b 782c 2078  om_arrays([[x, x
+00029130: 5d5d 290a 2020 2020 2828 312c 292c 2028  ]]).    ((1,), (
+00029140: 322c 2032 2929 0a0a 2020 2020 3e3e 3e20  2, 2))..    >>> 
+00029150: 6368 756e 6b73 5f66 726f 6d5f 6172 7261  chunks_from_arra
+00029160: 7973 285b 312c 2031 5d29 0a20 2020 2028  ys([1, 1]).    (
+00029170: 2831 2c20 3129 2c29 0a20 2020 2022 2222  (1, 1),).    """
+00029180: 0a20 2020 2069 6620 6e6f 7420 6172 7261  .    if not arra
+00029190: 7973 3a0a 2020 2020 2020 2020 7265 7475  ys:.        retu
+000291a0: 726e 2028 290a 2020 2020 7265 7375 6c74  rn ().    result
+000291b0: 203d 205b 5d0a 2020 2020 6469 6d20 3d20   = [].    dim = 
+000291c0: 300a 0a20 2020 2064 6566 2073 6861 7065  0..    def shape
+000291d0: 2878 293a 0a20 2020 2020 2020 2074 7279  (x):.        try
+000291e0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+000291f0: 7475 726e 2078 2e73 6861 7065 2069 6620  turn x.shape if 
+00029200: 782e 7368 6170 6520 656c 7365 2028 312c  x.shape else (1,
+00029210: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
+00029220: 2041 7474 7269 6275 7465 4572 726f 723a   AttributeError:
+00029230: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00029240: 7572 6e20 2831 2c29 0a0a 2020 2020 7768  urn (1,)..    wh
+00029250: 696c 6520 6973 696e 7374 616e 6365 2861  ile isinstance(a
+00029260: 7272 6179 732c 2028 6c69 7374 2c20 7475  rrays, (list, tu
+00029270: 706c 6529 293a 0a20 2020 2020 2020 2072  ple)):.        r
+00029280: 6573 756c 742e 6170 7065 6e64 2874 7570  esult.append(tup
+00029290: 6c65 2873 6861 7065 2864 6565 7066 6972  le(shape(deepfir
+000292a0: 7374 2861 2929 5b64 696d 5d20 666f 7220  st(a))[dim] for 
+000292b0: 6120 696e 2061 7272 6179 7329 290a 2020  a in arrays)).  
+000292c0: 2020 2020 2020 6172 7261 7973 203d 2061        arrays = a
+000292d0: 7272 6179 735b 305d 0a20 2020 2020 2020  rrays[0].       
+000292e0: 2064 696d 202b 3d20 310a 2020 2020 7265   dim += 1.    re
+000292f0: 7475 726e 2074 7570 6c65 2872 6573 756c  turn tuple(resul
+00029300: 7429 0a0a 0a64 6566 2064 6565 7066 6972  t)...def deepfir
+00029310: 7374 2873 6571 293a 0a20 2020 2022 2222  st(seq):.    """
+00029320: 4669 7273 7420 656c 656d 656e 7420 696e  First element in
+00029330: 2061 206e 6573 7465 6420 6c69 7374 0a0a   a nested list..
+00029340: 2020 2020 3e3e 3e20 6465 6570 6669 7273      >>> deepfirs
+00029350: 7428 5b5b 5b31 2c20 325d 2c20 5b33 2c20  t([[[1, 2], [3, 
+00029360: 345d 5d2c 205b 352c 2036 5d2c 205b 372c  4]], [5, 6], [7,
+00029370: 2038 5d5d 290a 2020 2020 310a 2020 2020   8]]).    1.    
+00029380: 2222 220a 2020 2020 6966 206e 6f74 2069  """.    if not i
+00029390: 7369 6e73 7461 6e63 6528 7365 712c 2028  sinstance(seq, (
+000293a0: 6c69 7374 2c20 7475 706c 6529 293a 0a20  list, tuple)):. 
+000293b0: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+000293c0: 710a 2020 2020 656c 7365 3a0a 2020 2020  q.    else:.    
+000293d0: 2020 2020 7265 7475 726e 2064 6565 7066      return deepf
+000293e0: 6972 7374 2873 6571 5b30 5d29 0a0a 0a64  irst(seq[0])...d
+000293f0: 6566 2073 6861 7065 6c69 7374 2861 293a  ef shapelist(a):
+00029400: 0a20 2020 2022 2222 4765 7420 7468 6520  .    """Get the 
+00029410: 7368 6170 6520 6f66 206e 6573 7465 6420  shape of nested 
+00029420: 6c69 7374 2222 220a 2020 2020 6966 2074  list""".    if t
+00029430: 7970 6528 6129 2069 7320 6c69 7374 3a0a  ype(a) is list:.
+00029440: 2020 2020 2020 2020 7265 7475 726e 2074          return t
+00029450: 7570 6c65 285b 6c65 6e28 6129 5d20 2b20  uple([len(a)] + 
+00029460: 6c69 7374 2873 6861 7065 6c69 7374 2861  list(shapelist(a
+00029470: 5b30 5d29 2929 0a20 2020 2065 6c73 653a  [0]))).    else:
+00029480: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00029490: 2829 0a0a 0a64 6566 2074 7261 6e73 706f  ()...def transpo
+000294a0: 7365 6c69 7374 2861 7272 6179 732c 2061  selist(arrays, a
+000294b0: 7865 732c 2065 7874 7261 6469 6d73 3d30  xes, extradims=0
+000294c0: 293a 0a20 2020 2022 2222 5065 726d 7574  ):.    """Permut
+000294d0: 6520 6178 6573 206f 6620 6e65 7374 6564  e axes of nested
+000294e0: 206c 6973 740a 0a20 2020 203e 3e3e 2074   list..    >>> t
+000294f0: 7261 6e73 706f 7365 6c69 7374 285b 5b31  ransposelist([[1
+00029500: 2c31 2c31 5d2c 5b31 2c31 2c31 5d5d 2c20  ,1,1],[1,1,1]], 
+00029510: 5b32 2c31 5d29 0a20 2020 205b 5b5b 312c  [2,1]).    [[[1,
+00029520: 2031 5d2c 205b 312c 2031 5d2c 205b 312c   1], [1, 1], [1,
+00029530: 2031 5d5d 5d0a 0a20 2020 203e 3e3e 2074   1]]]..    >>> t
+00029540: 7261 6e73 706f 7365 6c69 7374 285b 5b31  ransposelist([[1
+00029550: 2c31 2c31 5d2c 5b31 2c31 2c31 5d5d 2c20  ,1,1],[1,1,1]], 
+00029560: 5b32 2c31 5d2c 2065 7874 7261 6469 6d73  [2,1], extradims
+00029570: 3d31 290a 2020 2020 5b5b 5b5b 315d 2c20  =1).    [[[[1], 
+00029580: 5b31 5d5d 2c20 5b5b 315d 2c20 5b31 5d5d  [1]], [[1], [1]]
+00029590: 2c20 5b5b 315d 2c20 5b31 5d5d 5d5d 0a20  , [[1], [1]]]]. 
+000295a0: 2020 2022 2222 0a20 2020 2069 6620 6c65     """.    if le
+000295b0: 6e28 6178 6573 2920 213d 206e 6469 6d6c  n(axes) != ndiml
+000295c0: 6973 7428 6172 7261 7973 293a 0a20 2020  ist(arrays):.   
+000295d0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+000295e0: 4572 726f 7228 224c 656e 6774 6820 6f66  Error("Length of
+000295f0: 2061 7865 7320 7368 6f75 6c64 2065 7175   axes should equ
+00029600: 616c 2064 6570 7468 206f 6620 6e65 7374  al depth of nest
+00029610: 6564 2061 7272 6179 7322 290a 2020 2020  ed arrays").    
+00029620: 6966 2065 7874 7261 6469 6d73 203c 2030  if extradims < 0
+00029630: 3a0a 2020 2020 2020 2020 7261 6973 6520  :.        raise 
+00029640: 5661 6c75 6545 7272 6f72 2822 606e 6577  ValueError("`new
+00029650: 6469 6d73 6020 7368 6f75 6c64 2062 6520  dims` should be 
+00029660: 706f 7369 7469 7665 2229 0a20 2020 2069  positive").    i
+00029670: 6620 6c65 6e28 6178 6573 2920 3e20 6c65  f len(axes) > le
+00029680: 6e28 7365 7428 6178 6573 2929 3a0a 2020  n(set(axes)):.  
+00029690: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+000296a0: 6545 7272 6f72 2822 6061 7865 7360 2073  eError("`axes` s
+000296b0: 686f 756c 6420 6265 2075 6e69 7175 6522  hould be unique"
+000296c0: 290a 0a20 2020 206e 6469 6d20 3d20 6d61  )..    ndim = ma
+000296d0: 7828 6178 6573 2920 2b20 310a 2020 2020  x(axes) + 1.    
+000296e0: 7368 6170 6520 3d20 7368 6170 656c 6973  shape = shapelis
+000296f0: 7428 6172 7261 7973 290a 2020 2020 6e65  t(arrays).    ne
+00029700: 7773 6861 7065 203d 205b 0a20 2020 2020  wshape = [.     
+00029710: 2020 2073 6861 7065 5b61 7865 732e 696e     shape[axes.in
+00029720: 6465 7828 6929 5d20 6966 2069 2069 6e20  dex(i)] if i in 
+00029730: 6178 6573 2065 6c73 6520 3120 666f 7220  axes else 1 for 
+00029740: 6920 696e 2072 616e 6765 286e 6469 6d20  i in range(ndim 
+00029750: 2b20 6578 7472 6164 696d 7329 0a20 2020  + extradims).   
+00029760: 205d 0a0a 2020 2020 7265 7375 6c74 203d   ]..    result =
+00029770: 206c 6973 7428 636f 7265 2e66 6c61 7474   list(core.flatt
+00029780: 656e 2861 7272 6179 7329 290a 2020 2020  en(arrays)).    
+00029790: 7265 7475 726e 2072 6573 6861 7065 6c69  return reshapeli
+000297a0: 7374 286e 6577 7368 6170 652c 2072 6573  st(newshape, res
+000297b0: 756c 7429 0a0a 0a64 6566 2073 7461 636b  ult)...def stack
+000297c0: 2873 6571 2c20 6178 6973 3d30 2c20 616c  (seq, axis=0, al
+000297d0: 6c6f 775f 756e 6b6e 6f77 6e5f 6368 756e  low_unknown_chun
+000297e0: 6b73 697a 6573 3d46 616c 7365 293a 0a20  ksizes=False):. 
+000297f0: 2020 2022 2222 0a20 2020 2053 7461 636b     """.    Stack
+00029800: 2061 7272 6179 7320 616c 6f6e 6720 6120   arrays along a 
+00029810: 6e65 7720 6178 6973 0a0a 2020 2020 4769  new axis..    Gi
+00029820: 7665 6e20 6120 7365 7175 656e 6365 206f  ven a sequence o
+00029830: 6620 6461 736b 2061 7272 6179 732c 2066  f dask arrays, f
+00029840: 6f72 6d20 6120 6e65 7720 6461 736b 2061  orm a new dask a
+00029850: 7272 6179 2062 7920 7374 6163 6b69 6e67  rray by stacking
+00029860: 2074 6865 6d0a 2020 2020 616c 6f6e 6720   them.    along 
+00029870: 6120 6e65 7720 6469 6d65 6e73 696f 6e20  a new dimension 
+00029880: 2861 7869 733d 3020 6279 2064 6566 6175  (axis=0 by defau
+00029890: 6c74 290a 0a20 2020 2050 6172 616d 6574  lt)..    Paramet
+000298a0: 6572 730a 2020 2020 2d2d 2d2d 2d2d 2d2d  ers.    --------
+000298b0: 2d2d 0a20 2020 2073 6571 3a20 6c69 7374  --.    seq: list
+000298c0: 206f 6620 6461 736b 2e61 7272 6179 730a   of dask.arrays.
+000298d0: 2020 2020 6178 6973 3a20 696e 740a 2020      axis: int.  
+000298e0: 2020 2020 2020 4469 6d65 6e73 696f 6e20        Dimension 
+000298f0: 616c 6f6e 6720 7768 6963 6820 746f 2061  along which to a
+00029900: 6c69 676e 2061 6c6c 206f 6620 7468 6520  lign all of the 
+00029910: 6172 7261 7973 0a20 2020 2061 6c6c 6f77  arrays.    allow
+00029920: 5f75 6e6b 6e6f 776e 5f63 6875 6e6b 7369  _unknown_chunksi
+00029930: 7a65 733a 2062 6f6f 6c0a 2020 2020 2020  zes: bool.      
+00029940: 2020 416c 6c6f 7720 756e 6b6e 6f77 6e20    Allow unknown 
+00029950: 6368 756e 6b73 697a 6573 2c20 7375 6368  chunksizes, such
+00029960: 2061 7320 636f 6d65 2066 726f 6d20 636f   as come from co
+00029970: 6e76 6572 7469 6e67 2066 726f 6d20 6461  nverting from da
+00029980: 736b 0a20 2020 2020 2020 2064 6174 6166  sk.        dataf
+00029990: 7261 6d65 732e 2020 4461 736b 2e61 7272  rames.  Dask.arr
+000299a0: 6179 2069 7320 756e 6162 6c65 2074 6f20  ay is unable to 
+000299b0: 7665 7269 6679 2074 6861 7420 6368 756e  verify that chun
+000299c0: 6b73 206c 696e 6520 7570 2e20 2049 660a  ks line up.  If.
+000299d0: 2020 2020 2020 2020 6461 7461 2063 6f6d          data com
+000299e0: 6573 2066 726f 6d20 6469 6666 6572 656e  es from differen
+000299f0: 746c 7920 616c 6967 6e65 6420 736f 7572  tly aligned sour
+00029a00: 6365 7320 7468 656e 2074 6869 7320 6361  ces then this ca
+00029a10: 6e20 6361 7573 650a 2020 2020 2020 2020  n cause.        
+00029a20: 756e 6578 7065 6374 6564 2072 6573 756c  unexpected resul
+00029a30: 7473 2e0a 0a20 2020 2045 7861 6d70 6c65  ts...    Example
+00029a40: 730a 2020 2020 2d2d 2d2d 2d2d 2d2d 0a0a  s.    --------..
+00029a50: 2020 2020 4372 6561 7465 2073 6c69 6365      Create slice
+00029a60: 730a 0a20 2020 203e 3e3e 2069 6d70 6f72  s..    >>> impor
+00029a70: 7420 6461 736b 2e61 7272 6179 2061 7320  t dask.array as 
+00029a80: 6461 0a20 2020 203e 3e3e 2069 6d70 6f72  da.    >>> impor
+00029a90: 7420 6e75 6d70 7920 6173 206e 700a 0a20  t numpy as np.. 
+00029aa0: 2020 203e 3e3e 2064 6174 6120 3d20 5b64     >>> data = [d
+00029ab0: 612e 6672 6f6d 5f61 7272 6179 286e 702e  a.from_array(np.
+00029ac0: 6f6e 6573 2828 342c 2034 2929 2c20 6368  ones((4, 4)), ch
+00029ad0: 756e 6b73 3d28 322c 2032 2929 0a20 2020  unks=(2, 2)).   
+00029ae0: 202e 2e2e 2020 2020 2020 2020 2066 6f72   ...         for
+00029af0: 2069 2069 6e20 7261 6e67 6528 3329 5d0a   i in range(3)].
+00029b00: 0a20 2020 203e 3e3e 2078 203d 2064 612e  .    >>> x = da.
+00029b10: 7374 6163 6b28 6461 7461 2c20 6178 6973  stack(data, axis
+00029b20: 3d30 290a 2020 2020 3e3e 3e20 782e 7368  =0).    >>> x.sh
+00029b30: 6170 650a 2020 2020 2833 2c20 342c 2034  ape.    (3, 4, 4
+00029b40: 290a 0a20 2020 203e 3e3e 2064 612e 7374  )..    >>> da.st
+00029b50: 6163 6b28 6461 7461 2c20 6178 6973 3d31  ack(data, axis=1
+00029b60: 292e 7368 6170 650a 2020 2020 2834 2c20  ).shape.    (4, 
+00029b70: 332c 2034 290a 0a20 2020 203e 3e3e 2064  3, 4)..    >>> d
+00029b80: 612e 7374 6163 6b28 6461 7461 2c20 6178  a.stack(data, ax
+00029b90: 6973 3d2d 3129 2e73 6861 7065 0a20 2020  is=-1).shape.   
+00029ba0: 2028 342c 2034 2c20 3329 0a0a 2020 2020   (4, 4, 3)..    
+00029bb0: 5265 7375 6c74 2069 7320 6120 6e65 7720  Result is a new 
+00029bc0: 6461 736b 2041 7272 6179 0a0a 2020 2020  dask Array..    
+00029bd0: 5365 6520 416c 736f 0a20 2020 202d 2d2d  See Also.    ---
+00029be0: 2d2d 2d2d 2d0a 2020 2020 636f 6e63 6174  -----.    concat
+00029bf0: 656e 6174 650a 2020 2020 2222 220a 2020  enate.    """.  
+00029c00: 2020 6672 6f6d 2064 6173 6b2e 6172 7261    from dask.arra
+00029c10: 7920 696d 706f 7274 2077 7261 700a 0a20  y import wrap.. 
+00029c20: 2020 2073 6571 203d 205b 6173 6172 7261     seq = [asarra
+00029c30: 7928 612c 2061 6c6c 6f77 5f75 6e6b 6e6f  y(a, allow_unkno
+00029c40: 776e 5f63 6875 6e6b 7369 7a65 733d 616c  wn_chunksizes=al
+00029c50: 6c6f 775f 756e 6b6e 6f77 6e5f 6368 756e  low_unknown_chun
+00029c60: 6b73 697a 6573 2920 666f 7220 6120 696e  ksizes) for a in
+00029c70: 2073 6571 5d0a 0a20 2020 2069 6620 6e6f   seq]..    if no
+00029c80: 7420 7365 713a 0a20 2020 2020 2020 2072  t seq:.        r
+00029c90: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
+00029ca0: 224e 6565 6420 6172 7261 7928 7329 2074  "Need array(s) t
+00029cb0: 6f20 7374 6163 6b22 290a 2020 2020 6966  o stack").    if
+00029cc0: 206e 6f74 2061 6c6c 6f77 5f75 6e6b 6e6f   not allow_unkno
+00029cd0: 776e 5f63 6875 6e6b 7369 7a65 7320 616e  wn_chunksizes an
+00029ce0: 6420 6e6f 7420 616c 6c28 782e 7368 6170  d not all(x.shap
+00029cf0: 6520 3d3d 2073 6571 5b30 5d2e 7368 6170  e == seq[0].shap
+00029d00: 6520 666f 7220 7820 696e 2073 6571 293a  e for x in seq):
+00029d10: 0a20 2020 2020 2020 2069 6478 203d 2066  .        idx = f
+00029d20: 6972 7374 2869 2066 6f72 2069 2069 6e20  irst(i for i in 
+00029d30: 656e 756d 6572 6174 6528 7365 7129 2069  enumerate(seq) i
+00029d40: 6620 695b 315d 2e73 6861 7065 2021 3d20  f i[1].shape != 
+00029d50: 7365 715b 305d 2e73 6861 7065 290a 2020  seq[0].shape).  
+00029d60: 2020 2020 2020 7261 6973 6520 5661 6c75        raise Valu
+00029d70: 6545 7272 6f72 280a 2020 2020 2020 2020  eError(.        
+00029d80: 2020 2020 2253 7461 636b 6564 2061 7272      "Stacked arr
+00029d90: 6179 7320 6d75 7374 2068 6176 6520 7468  ays must have th
+00029da0: 6520 7361 6d65 2073 6861 7065 2e20 5468  e same shape. Th
+00029db0: 6520 6669 7273 7420 6172 7261 7920 6861  e first array ha
+00029dc0: 6420 7368 6170 6520 220a 2020 2020 2020  d shape ".      
+00029dd0: 2020 2020 2020 6622 7b73 6571 5b30 5d2e        f"{seq[0].
+00029de0: 7368 6170 657d 2c20 7768 696c 6520 6172  shape}, while ar
+00029df0: 7261 7920 7b69 6478 5b30 5d20 2b20 317d  ray {idx[0] + 1}
+00029e00: 2068 6173 2073 6861 7065 207b 6964 785b   has shape {idx[
+00029e10: 315d 2e73 6861 7065 7d2e 220a 2020 2020  1].shape}.".    
+00029e20: 2020 2020 290a 0a20 2020 206d 6574 6120      )..    meta 
+00029e30: 3d20 6e70 2e73 7461 636b 285b 6d65 7461  = np.stack([meta
+00029e40: 5f66 726f 6d5f 6172 7261 7928 6129 2066  _from_array(a) f
+00029e50: 6f72 2061 2069 6e20 7365 715d 2c20 6178  or a in seq], ax
+00029e60: 6973 3d61 7869 7329 0a20 2020 2073 6571  is=axis).    seq
+00029e70: 203d 205b 782e 6173 7479 7065 286d 6574   = [x.astype(met
+00029e80: 612e 6474 7970 6529 2066 6f72 2078 2069  a.dtype) for x i
+00029e90: 6e20 7365 715d 0a0a 2020 2020 6e64 696d  n seq]..    ndim
+00029ea0: 203d 206d 6574 612e 6e64 696d 202d 2031   = meta.ndim - 1
+00029eb0: 0a20 2020 2069 6620 6178 6973 203c 2030  .    if axis < 0
+00029ec0: 3a0a 2020 2020 2020 2020 6178 6973 203d  :.        axis =
+00029ed0: 206e 6469 6d20 2b20 6178 6973 202b 2031   ndim + axis + 1
+00029ee0: 0a20 2020 2073 6861 7065 203d 2074 7570  .    shape = tup
+00029ef0: 6c65 280a 2020 2020 2020 2020 6c65 6e28  le(.        len(
+00029f00: 7365 7129 0a20 2020 2020 2020 2069 6620  seq).        if 
+00029f10: 6920 3d3d 2061 7869 730a 2020 2020 2020  i == axis.      
+00029f20: 2020 656c 7365 2028 7365 715b 305d 2e73    else (seq[0].s
+00029f30: 6861 7065 5b69 5d20 6966 2069 203c 2061  hape[i] if i < a
+00029f40: 7869 7320 656c 7365 2073 6571 5b30 5d2e  xis else seq[0].
+00029f50: 7368 6170 655b 6920 2d20 315d 290a 2020  shape[i - 1]).  
+00029f60: 2020 2020 2020 666f 7220 6920 696e 2072        for i in r
+00029f70: 616e 6765 286d 6574 612e 6e64 696d 290a  ange(meta.ndim).
+00029f80: 2020 2020 290a 0a20 2020 2073 6571 3220      )..    seq2 
+00029f90: 3d20 5b61 2066 6f72 2061 2069 6e20 7365  = [a for a in se
+00029fa0: 7120 6966 2061 2e73 697a 655d 0a20 2020  q if a.size].   
+00029fb0: 2069 6620 6e6f 7420 7365 7132 3a0a 2020   if not seq2:.  
+00029fc0: 2020 2020 2020 7365 7132 203d 2073 6571        seq2 = seq
+00029fd0: 0a0a 2020 2020 6e20 3d20 6c65 6e28 7365  ..    n = len(se
+00029fe0: 7132 290a 2020 2020 6966 206e 203d 3d20  q2).    if n == 
+00029ff0: 303a 0a20 2020 2020 2020 2074 7279 3a0a  0:.        try:.
+0002a000: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002a010: 726e 2077 7261 702e 656d 7074 795f 6c69  rn wrap.empty_li
+0002a020: 6b65 286d 6574 612c 2073 6861 7065 3d73  ke(meta, shape=s
+0002a030: 6861 7065 2c20 6368 756e 6b73 3d73 6861  hape, chunks=sha
+0002a040: 7065 2c20 6474 7970 653d 6d65 7461 2e64  pe, dtype=meta.d
+0002a050: 7479 7065 290a 2020 2020 2020 2020 6578  type).        ex
+0002a060: 6365 7074 2054 7970 6545 7272 6f72 3a0a  cept TypeError:.
+0002a070: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0002a080: 726e 2077 7261 702e 656d 7074 7928 7368  rn wrap.empty(sh
+0002a090: 6170 652c 2063 6875 6e6b 733d 7368 6170  ape, chunks=shap
+0002a0a0: 652c 2064 7479 7065 3d6d 6574 612e 6474  e, dtype=meta.dt
+0002a0b0: 7970 6529 0a0a 2020 2020 696e 6420 3d20  ype)..    ind = 
+0002a0c0: 6c69 7374 2872 616e 6765 286e 6469 6d29  list(range(ndim)
+0002a0d0: 290a 2020 2020 7563 5f61 7267 7320 3d20  ).    uc_args = 
+0002a0e0: 6c69 7374 2863 6f6e 6361 7428 2878 2c20  list(concat((x, 
+0002a0f0: 696e 6429 2066 6f72 2078 2069 6e20 7365  ind) for x in se
+0002a100: 7132 2929 0a20 2020 205f 2c20 7365 7132  q2)).    _, seq2
+0002a110: 203d 2075 6e69 6679 5f63 6875 6e6b 7328   = unify_chunks(
+0002a120: 2a75 635f 6172 6773 290a 0a20 2020 2061  *uc_args)..    a
+0002a130: 7373 6572 7420 6c65 6e28 7b61 2e63 6875  ssert len({a.chu
+0002a140: 6e6b 7320 666f 7220 6120 696e 2073 6571  nks for a in seq
+0002a150: 327d 2920 3d3d 2031 2020 2320 7361 6d65  2}) == 1  # same
+0002a160: 2063 6875 6e6b 730a 2020 2020 6368 756e   chunks.    chun
+0002a170: 6b73 203d 2073 6571 325b 305d 2e63 6875  ks = seq2[0].chu
+0002a180: 6e6b 735b 3a61 7869 735d 202b 2028 2831  nks[:axis] + ((1
+0002a190: 2c29 202a 206e 2c29 202b 2073 6571 325b  ,) * n,) + seq2[
+0002a1a0: 305d 2e63 6875 6e6b 735b 6178 6973 3a5d  0].chunks[axis:]
+0002a1b0: 0a0a 2020 2020 6e61 6d65 7320 3d20 5b61  ..    names = [a
+0002a1c0: 2e6e 616d 6520 666f 7220 6120 696e 2073  .name for a in s
+0002a1d0: 6571 325d 0a20 2020 206e 616d 6520 3d20  eq2].    name = 
+0002a1e0: 2273 7461 636b 2d22 202b 2074 6f6b 656e  "stack-" + token
+0002a1f0: 697a 6528 6e61 6d65 732c 2061 7869 7329  ize(names, axis)
+0002a200: 0a20 2020 206b 6579 7320 3d20 6c69 7374  .    keys = list
+0002a210: 2870 726f 6475 6374 285b 6e61 6d65 5d2c  (product([name],
+0002a220: 202a 5b72 616e 6765 286c 656e 2862 6429   *[range(len(bd)
+0002a230: 2920 666f 7220 6264 2069 6e20 6368 756e  ) for bd in chun
+0002a240: 6b73 5d29 290a 0a20 2020 2069 6e70 7574  ks]))..    input
+0002a250: 7320 3d20 5b0a 2020 2020 2020 2020 286e  s = [.        (n
+0002a260: 616d 6573 5b6b 6579 5b61 7869 7320 2b20  ames[key[axis + 
+0002a270: 315d 5d2c 2920 2b20 6b65 795b 3120 3a20  1]],) + key[1 : 
+0002a280: 6178 6973 202b 2031 5d20 2b20 6b65 795b  axis + 1] + key[
+0002a290: 6178 6973 202b 2032 203a 5d20 666f 7220  axis + 2 :] for 
+0002a2a0: 6b65 7920 696e 206b 6579 730a 2020 2020  key in keys.    
+0002a2b0: 5d0a 2020 2020 7661 6c75 6573 203d 205b  ].    values = [
+0002a2c0: 0a20 2020 2020 2020 2028 0a20 2020 2020  .        (.     
+0002a2d0: 2020 2020 2020 2067 6574 6974 656d 2c0a         getitem,.
+0002a2e0: 2020 2020 2020 2020 2020 2020 696e 702c              inp,
+0002a2f0: 0a20 2020 2020 2020 2020 2020 2028 736c  .            (sl
+0002a300: 6963 6528 4e6f 6e65 2c20 4e6f 6e65 2c20  ice(None, None, 
+0002a310: 4e6f 6e65 292c 2920 2a20 6178 6973 0a20  None),) * axis. 
+0002a320: 2020 2020 2020 2020 2020 202b 2028 4e6f             + (No
+0002a330: 6e65 2c29 0a20 2020 2020 2020 2020 2020  ne,).           
+0002a340: 202b 2028 736c 6963 6528 4e6f 6e65 2c20   + (slice(None, 
+0002a350: 4e6f 6e65 2c20 4e6f 6e65 292c 2920 2a20  None, None),) * 
+0002a360: 286e 6469 6d20 2d20 6178 6973 292c 0a20  (ndim - axis),. 
+0002a370: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002a380: 2066 6f72 2069 6e70 2069 6e20 696e 7075   for inp in inpu
+0002a390: 7473 0a20 2020 205d 0a0a 2020 2020 6c61  ts.    ]..    la
+0002a3a0: 7965 7220 3d20 6469 6374 287a 6970 286b  yer = dict(zip(k
+0002a3b0: 6579 732c 2076 616c 7565 7329 290a 2020  eys, values)).  
+0002a3c0: 2020 6772 6170 6820 3d20 4869 6768 4c65    graph = HighLe
+0002a3d0: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
+0002a3e0: 6c6c 6563 7469 6f6e 7328 6e61 6d65 2c20  llections(name, 
+0002a3f0: 6c61 7965 722c 2064 6570 656e 6465 6e63  layer, dependenc
+0002a400: 6965 733d 7365 7132 290a 0a20 2020 2072  ies=seq2)..    r
+0002a410: 6574 7572 6e20 4172 7261 7928 6772 6170  eturn Array(grap
+0002a420: 682c 206e 616d 652c 2063 6875 6e6b 732c  h, name, chunks,
+0002a430: 206d 6574 613d 6d65 7461 290a 0a0a 6465   meta=meta)...de
+0002a440: 6620 636f 6e63 6174 656e 6174 6533 2861  f concatenate3(a
+0002a450: 7272 6179 7329 3a0a 2020 2020 2222 2252  rrays):.    """R
+0002a460: 6563 7572 7369 7665 206e 702e 636f 6e63  ecursive np.conc
+0002a470: 6174 656e 6174 650a 0a20 2020 2049 6e70  atenate..    Inp
+0002a480: 7574 2073 686f 756c 6420 6265 2061 206e  ut should be a n
+0002a490: 6573 7465 6420 6c69 7374 206f 6620 6e75  ested list of nu
+0002a4a0: 6d70 7920 6172 7261 7973 2061 7272 616e  mpy arrays arran
+0002a4b0: 6765 6420 696e 2074 6865 206f 7264 6572  ged in the order
+0002a4c0: 2074 6865 790a 2020 2020 7368 6f75 6c64   they.    should
+0002a4d0: 2061 7070 6561 7220 696e 2074 6865 2061   appear in the a
+0002a4e0: 7272 6179 2069 7473 656c 662e 2020 4561  rray itself.  Ea
+0002a4f0: 6368 2061 7272 6179 2073 686f 756c 6420  ch array should 
+0002a500: 6861 7665 2074 6865 2073 616d 6520 6e75  have the same nu
+0002a510: 6d62 6572 0a20 2020 206f 6620 6469 6d65  mber.    of dime
+0002a520: 6e73 696f 6e73 2061 7320 7468 6520 6465  nsions as the de
+0002a530: 7369 7265 6420 6f75 7470 7574 2061 6e64  sired output and
+0002a540: 2074 6865 206e 6573 7469 6e67 206f 6620   the nesting of 
+0002a550: 7468 6520 6c69 7374 732e 0a0a 2020 2020  the lists...    
+0002a560: 3e3e 3e20 7820 3d20 6e70 2e61 7272 6179  >>> x = np.array
+0002a570: 285b 5b31 2c20 325d 5d29 0a20 2020 203e  ([[1, 2]]).    >
+0002a580: 3e3e 2063 6f6e 6361 7465 6e61 7465 3328  >> concatenate3(
+0002a590: 5b5b 782c 2078 2c20 785d 2c20 5b78 2c20  [[x, x, x], [x, 
+0002a5a0: 782c 2078 5d5d 290a 2020 2020 6172 7261  x, x]]).    arra
+0002a5b0: 7928 5b5b 312c 2032 2c20 312c 2032 2c20  y([[1, 2, 1, 2, 
+0002a5c0: 312c 2032 5d2c 0a20 2020 2020 2020 2020  1, 2],.         
+0002a5d0: 2020 5b31 2c20 322c 2031 2c20 322c 2031    [1, 2, 1, 2, 1
+0002a5e0: 2c20 325d 5d29 0a0a 2020 2020 3e3e 3e20  , 2]])..    >>> 
+0002a5f0: 636f 6e63 6174 656e 6174 6533 285b 5b78  concatenate3([[x
+0002a600: 2c20 785d 2c20 5b78 2c20 785d 2c20 5b78  , x], [x, x], [x
+0002a610: 2c20 785d 5d29 0a20 2020 2061 7272 6179  , x]]).    array
+0002a620: 285b 5b31 2c20 322c 2031 2c20 325d 2c0a  ([[1, 2, 1, 2],.
+0002a630: 2020 2020 2020 2020 2020 205b 312c 2032             [1, 2
+0002a640: 2c20 312c 2032 5d2c 0a20 2020 2020 2020  , 1, 2],.       
+0002a650: 2020 2020 5b31 2c20 322c 2031 2c20 325d      [1, 2, 1, 2]
+0002a660: 5d29 0a20 2020 2022 2222 0a20 2020 2023  ]).    """.    #
+0002a670: 2057 6520 6e65 6564 2074 6869 7320 6173   We need this as
+0002a680: 205f 5f61 7272 6179 5f66 756e 6374 696f   __array_functio
+0002a690: 6e5f 5f20 6d61 7920 6e6f 7420 6578 6973  n__ may not exis
+0002a6a0: 7420 6f6e 206f 6c64 6572 204e 756d 5079  t on older NumPy
+0002a6b0: 2076 6572 7369 6f6e 732e 0a20 2020 2023   versions..    #
+0002a6c0: 2041 6e64 2074 6f20 7265 6475 6365 2076   And to reduce v
+0002a6d0: 6572 626f 7369 7479 2e0a 2020 2020 4e44  erbosity..    ND
+0002a6e0: 4152 5241 595f 4152 5241 595f 4655 4e43  ARRAY_ARRAY_FUNC
+0002a6f0: 5449 4f4e 203d 2067 6574 6174 7472 286e  TION = getattr(n
+0002a700: 702e 6e64 6172 7261 792c 2022 5f5f 6172  p.ndarray, "__ar
+0002a710: 7261 795f 6675 6e63 7469 6f6e 5f5f 222c  ray_function__",
+0002a720: 204e 6f6e 6529 0a0a 2020 2020 6172 7261   None)..    arra
+0002a730: 7973 203d 2063 6f6e 6372 6574 6528 6172  ys = concrete(ar
+0002a740: 7261 7973 290a 2020 2020 6966 206e 6f74  rays).    if not
+0002a750: 2061 7272 6179 733a 0a20 2020 2020 2020   arrays:.       
+0002a760: 2072 6574 7572 6e20 6e70 2e65 6d70 7479   return np.empty
+0002a770: 2830 290a 0a20 2020 2061 6476 616e 6365  (0)..    advance
+0002a780: 6420 3d20 6d61 7828 0a20 2020 2020 2020  d = max(.       
+0002a790: 2063 6f72 652e 666c 6174 7465 6e28 6172   core.flatten(ar
+0002a7a0: 7261 7973 2c20 636f 6e74 6169 6e65 723d  rays, container=
+0002a7b0: 286c 6973 742c 2074 7570 6c65 2929 2c0a  (list, tuple)),.
+0002a7c0: 2020 2020 2020 2020 6b65 793d 6c61 6d62          key=lamb
+0002a7d0: 6461 2078 3a20 6765 7461 7474 7228 782c  da x: getattr(x,
+0002a7e0: 2022 5f5f 6172 7261 795f 7072 696f 7269   "__array_priori
+0002a7f0: 7479 5f5f 222c 2030 292c 0a20 2020 2029  ty__", 0),.    )
+0002a800: 0a0a 2020 2020 6966 206e 6f74 2061 6c6c  ..    if not all
+0002a810: 280a 2020 2020 2020 2020 4e44 4152 5241  (.        NDARRA
+0002a820: 595f 4152 5241 595f 4655 4e43 5449 4f4e  Y_ARRAY_FUNCTION
+0002a830: 0a20 2020 2020 2020 2069 7320 6765 7461  .        is geta
+0002a840: 7474 7228 7479 7065 2861 7272 292c 2022  ttr(type(arr), "
+0002a850: 5f5f 6172 7261 795f 6675 6e63 7469 6f6e  __array_function
+0002a860: 5f5f 222c 204e 4441 5252 4159 5f41 5252  __", NDARRAY_ARR
+0002a870: 4159 5f46 554e 4354 494f 4e29 0a20 2020  AY_FUNCTION).   
+0002a880: 2020 2020 2066 6f72 2061 7272 2069 6e20       for arr in 
+0002a890: 636f 7265 2e66 6c61 7474 656e 2861 7272  core.flatten(arr
+0002a8a0: 6179 732c 2063 6f6e 7461 696e 6572 3d28  ays, container=(
+0002a8b0: 6c69 7374 2c20 7475 706c 6529 290a 2020  list, tuple)).  
+0002a8c0: 2020 293a 0a20 2020 2020 2020 2074 7279    ):.        try
+0002a8d0: 3a0a 2020 2020 2020 2020 2020 2020 7820  :.            x 
+0002a8e0: 3d20 756e 7061 636b 5f73 696e 676c 6574  = unpack_singlet
+0002a8f0: 6f6e 2861 7272 6179 7329 0a20 2020 2020  on(arrays).     
+0002a900: 2020 2020 2020 2072 6574 7572 6e20 5f63         return _c
+0002a910: 6f6e 6361 7465 6e61 7465 3228 6172 7261  oncatenate2(arra
+0002a920: 7973 2c20 6178 6573 3d74 7570 6c65 2872  ys, axes=tuple(r
+0002a930: 616e 6765 2878 2e6e 6469 6d29 2929 0a20  ange(x.ndim))). 
+0002a940: 2020 2020 2020 2065 7863 6570 7420 5479         except Ty
+0002a950: 7065 4572 726f 723a 0a20 2020 2020 2020  peError:.       
+0002a960: 2020 2020 2070 6173 730a 0a20 2020 2069       pass..    i
+0002a970: 6620 636f 6e63 6174 656e 6174 655f 6c6f  f concatenate_lo
+0002a980: 6f6b 7570 2e64 6973 7061 7463 6828 7479  okup.dispatch(ty
+0002a990: 7065 2861 6476 616e 6365 6429 2920 6973  pe(advanced)) is
+0002a9a0: 206e 6f74 206e 702e 636f 6e63 6174 656e   not np.concaten
+0002a9b0: 6174 653a 0a20 2020 2020 2020 2078 203d  ate:.        x =
+0002a9c0: 2075 6e70 6163 6b5f 7369 6e67 6c65 746f   unpack_singleto
+0002a9d0: 6e28 6172 7261 7973 290a 2020 2020 2020  n(arrays).      
+0002a9e0: 2020 7265 7475 726e 205f 636f 6e63 6174    return _concat
+0002a9f0: 656e 6174 6532 2861 7272 6179 732c 2061  enate2(arrays, a
+0002aa00: 7865 733d 6c69 7374 2872 616e 6765 2878  xes=list(range(x
+0002aa10: 2e6e 6469 6d29 2929 0a0a 2020 2020 6e64  .ndim)))..    nd
+0002aa20: 696d 203d 206e 6469 6d6c 6973 7428 6172  im = ndimlist(ar
+0002aa30: 7261 7973 290a 2020 2020 6966 206e 6f74  rays).    if not
+0002aa40: 206e 6469 6d3a 0a20 2020 2020 2020 2072   ndim:.        r
+0002aa50: 6574 7572 6e20 6172 7261 7973 0a20 2020  eturn arrays.   
+0002aa60: 2063 6875 6e6b 7320 3d20 6368 756e 6b73   chunks = chunks
+0002aa70: 5f66 726f 6d5f 6172 7261 7973 2861 7272  _from_arrays(arr
+0002aa80: 6179 7329 0a20 2020 2073 6861 7065 203d  ays).    shape =
+0002aa90: 2074 7570 6c65 286d 6170 2873 756d 2c20   tuple(map(sum, 
+0002aaa0: 6368 756e 6b73 2929 0a0a 2020 2020 6465  chunks))..    de
+0002aab0: 6620 6474 7970 6528 7829 3a0a 2020 2020  f dtype(x):.    
+0002aac0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0002aad0: 2020 2020 2072 6574 7572 6e20 782e 6474       return x.dt
+0002aae0: 7970 650a 2020 2020 2020 2020 6578 6365  ype.        exce
+0002aaf0: 7074 2041 7474 7269 6275 7465 4572 726f  pt AttributeErro
+0002ab00: 723a 0a20 2020 2020 2020 2020 2020 2072  r:.            r
+0002ab10: 6574 7572 6e20 7479 7065 2878 290a 0a20  eturn type(x).. 
+0002ab20: 2020 2072 6573 756c 7420 3d20 6e70 2e65     result = np.e
+0002ab30: 6d70 7479 2873 6861 7065 3d73 6861 7065  mpty(shape=shape
+0002ab40: 2c20 6474 7970 653d 6474 7970 6528 6465  , dtype=dtype(de
+0002ab50: 6570 6669 7273 7428 6172 7261 7973 2929  epfirst(arrays))
+0002ab60: 290a 0a20 2020 2066 6f72 2069 6478 2c20  )..    for idx, 
+0002ab70: 6172 7220 696e 207a 6970 280a 2020 2020  arr in zip(.    
+0002ab80: 2020 2020 736c 6963 6573 5f66 726f 6d5f      slices_from_
+0002ab90: 6368 756e 6b73 2863 6875 6e6b 7329 2c20  chunks(chunks), 
+0002aba0: 636f 7265 2e66 6c61 7474 656e 2861 7272  core.flatten(arr
+0002abb0: 6179 732c 2063 6f6e 7461 696e 6572 3d28  ays, container=(
+0002abc0: 6c69 7374 2c20 7475 706c 6529 290a 2020  list, tuple)).  
+0002abd0: 2020 293a 0a20 2020 2020 2020 2069 6620    ):.        if 
+0002abe0: 6861 7361 7474 7228 6172 722c 2022 6e64  hasattr(arr, "nd
+0002abf0: 696d 2229 3a0a 2020 2020 2020 2020 2020  im"):.          
+0002ac00: 2020 7768 696c 6520 6172 722e 6e64 696d    while arr.ndim
+0002ac10: 203c 206e 6469 6d3a 0a20 2020 2020 2020   < ndim:.       
+0002ac20: 2020 2020 2020 2020 2061 7272 203d 2061           arr = a
+0002ac30: 7272 5b4e 6f6e 652c 202e 2e2e 5d0a 2020  rr[None, ...].  
+0002ac40: 2020 2020 2020 7265 7375 6c74 5b69 6478        result[idx
+0002ac50: 5d20 3d20 6172 720a 0a20 2020 2072 6574  ] = arr..    ret
+0002ac60: 7572 6e20 7265 7375 6c74 0a0a 0a64 6566  urn result...def
+0002ac70: 2063 6f6e 6361 7465 6e61 7465 5f61 7865   concatenate_axe
+0002ac80: 7328 6172 7261 7973 2c20 6178 6573 293a  s(arrays, axes):
+0002ac90: 0a20 2020 2022 2222 5265 6375 7273 6976  .    """Recursiv
+0002aca0: 656c 7920 6361 6c6c 206e 702e 636f 6e63  ely call np.conc
+0002acb0: 6174 656e 6174 6520 616c 6f6e 6720 6178  atenate along ax
+0002acc0: 6573 2222 220a 2020 2020 6966 206c 656e  es""".    if len
+0002acd0: 2861 7865 7329 2021 3d20 6e64 696d 6c69  (axes) != ndimli
+0002ace0: 7374 2861 7272 6179 7329 3a0a 2020 2020  st(arrays):.    
+0002acf0: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
+0002ad00: 7272 6f72 2822 4c65 6e67 7468 206f 6620  rror("Length of 
+0002ad10: 6178 6573 2073 686f 756c 6420 6571 7561  axes should equa
+0002ad20: 6c20 6465 7074 6820 6f66 206e 6573 7465  l depth of neste
+0002ad30: 6420 6172 7261 7973 2229 0a0a 2020 2020  d arrays")..    
+0002ad40: 6578 7472 6164 696d 7320 3d20 6d61 7828  extradims = max(
+0002ad50: 302c 2064 6565 7066 6972 7374 2861 7272  0, deepfirst(arr
+0002ad60: 6179 7329 2e6e 6469 6d20 2d20 286d 6178  ays).ndim - (max
+0002ad70: 2861 7865 7329 202b 2031 2929 0a20 2020  (axes) + 1)).   
+0002ad80: 2072 6574 7572 6e20 636f 6e63 6174 656e   return concaten
+0002ad90: 6174 6533 2874 7261 6e73 706f 7365 6c69  ate3(transposeli
+0002ada0: 7374 2861 7272 6179 732c 2061 7865 732c  st(arrays, axes,
+0002adb0: 2065 7874 7261 6469 6d73 3d65 7874 7261   extradims=extra
+0002adc0: 6469 6d73 2929 0a0a 0a64 6566 2074 6f5f  dims))...def to_
+0002add0: 6864 6635 2866 696c 656e 616d 652c 202a  hdf5(filename, *
+0002ade0: 6172 6773 2c20 6368 756e 6b73 3d54 7275  args, chunks=Tru
+0002adf0: 652c 202a 2a6b 7761 7267 7329 3a0a 2020  e, **kwargs):.  
+0002ae00: 2020 2222 2253 746f 7265 2061 7272 6179    """Store array
+0002ae10: 7320 696e 2048 4446 3520 6669 6c65 0a0a  s in HDF5 file..
+0002ae20: 2020 2020 5468 6973 2073 6176 6573 2073      This saves s
+0002ae30: 6576 6572 616c 2064 6173 6b20 6172 7261  everal dask arra
+0002ae40: 7973 2069 6e74 6f20 7365 7665 7261 6c20  ys into several 
+0002ae50: 6461 7461 7061 7468 7320 696e 2061 6e20  datapaths in an 
+0002ae60: 4844 4635 2066 696c 652e 0a20 2020 2049  HDF5 file..    I
+0002ae70: 7420 6372 6561 7465 7320 7468 6520 6e65  t creates the ne
+0002ae80: 6365 7373 6172 7920 6461 7461 7365 7473  cessary datasets
+0002ae90: 2061 6e64 2068 616e 646c 6573 2063 6c65   and handles cle
+0002aea0: 616e 2066 696c 6520 6f70 656e 696e 672f  an file opening/
+0002aeb0: 636c 6f73 696e 672e 0a0a 2020 2020 5061  closing...    Pa
+0002aec0: 7261 6d65 7465 7273 0a20 2020 202d 2d2d  rameters.    ---
+0002aed0: 2d2d 2d2d 2d2d 2d0a 2020 2020 6368 756e  -------.    chun
+0002aee0: 6b73 3a20 7475 706c 6520 6f72 2060 6054  ks: tuple or ``T
+0002aef0: 7275 6560 600a 2020 2020 2020 2020 4368  rue``.        Ch
+0002af00: 756e 6b20 7368 6170 652c 206f 7220 6060  unk shape, or ``
+0002af10: 5472 7565 6060 2074 6f20 7061 7373 2074  True`` to pass t
+0002af20: 6865 2063 6875 6e6b 7320 6672 6f6d 2074  he chunks from t
+0002af30: 6865 2064 6173 6b20 6172 7261 792e 0a20  he dask array.. 
+0002af40: 2020 2020 2020 2044 6566 6175 6c74 7320         Defaults 
+0002af50: 746f 2060 6054 7275 6560 602e 0a0a 2020  to ``True``...  
+0002af60: 2020 4578 616d 706c 6573 0a20 2020 202d    Examples.    -
+0002af70: 2d2d 2d2d 2d2d 2d0a 0a20 2020 203e 3e3e  -------..    >>>
+0002af80: 2064 612e 746f 5f68 6466 3528 276d 7966   da.to_hdf5('myf
+0002af90: 696c 652e 6864 6635 272c 2027 2f78 272c  ile.hdf5', '/x',
+0002afa0: 2078 2920 2023 2064 6f63 7465 7374 3a20   x)  # doctest: 
+0002afb0: 2b53 4b49 500a 0a20 2020 206f 720a 0a20  +SKIP..    or.. 
+0002afc0: 2020 203e 3e3e 2064 612e 746f 5f68 6466     >>> da.to_hdf
+0002afd0: 3528 276d 7966 696c 652e 6864 6635 272c  5('myfile.hdf5',
+0002afe0: 207b 272f 7827 3a20 782c 2027 2f79 273a   {'/x': x, '/y':
+0002aff0: 2079 7d29 2020 2320 646f 6374 6573 743a   y})  # doctest:
+0002b000: 202b 534b 4950 0a0a 2020 2020 4f70 7469   +SKIP..    Opti
+0002b010: 6f6e 616c 6c79 2070 726f 7669 6465 2061  onally provide a
+0002b020: 7267 756d 656e 7473 2061 7320 7468 6f75  rguments as thou
+0002b030: 6768 2074 6f20 6060 6835 7079 2e46 696c  gh to ``h5py.Fil
+0002b040: 652e 6372 6561 7465 5f64 6174 6173 6574  e.create_dataset
+0002b050: 6060 0a0a 2020 2020 3e3e 3e20 6461 2e74  ``..    >>> da.t
+0002b060: 6f5f 6864 6635 2827 6d79 6669 6c65 2e68  o_hdf5('myfile.h
+0002b070: 6466 3527 2c20 272f 7827 2c20 782c 2063  df5', '/x', x, c
+0002b080: 6f6d 7072 6573 7369 6f6e 3d27 6c7a 6627  ompression='lzf'
+0002b090: 2c20 7368 7566 666c 653d 5472 7565 2920  , shuffle=True) 
+0002b0a0: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+0002b0b0: 500a 0a20 2020 203e 3e3e 2064 612e 746f  P..    >>> da.to
+0002b0c0: 5f68 6466 3528 276d 7966 696c 652e 6864  _hdf5('myfile.hd
+0002b0d0: 6635 272c 2027 2f78 272c 2078 2c20 6368  f5', '/x', x, ch
+0002b0e0: 756e 6b73 3d28 3130 2c32 302c 3330 2929  unks=(10,20,30))
 0002b0f0: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
-0002b100: 4950 0a0a 2020 2020 5365 6520 416c 736f  IP..    See Also
-0002b110: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-0002b120: 2020 6461 2e73 746f 7265 0a20 2020 2068    da.store.    h
-0002b130: 3570 792e 4669 6c65 2e63 7265 6174 655f  5py.File.create_
-0002b140: 6461 7461 7365 740a 2020 2020 2222 220a  dataset.    """.
-0002b150: 2020 2020 6966 206c 656e 2861 7267 7329      if len(args)
-0002b160: 203d 3d20 3120 616e 6420 6973 696e 7374   == 1 and isinst
-0002b170: 616e 6365 2861 7267 735b 305d 2c20 6469  ance(args[0], di
-0002b180: 6374 293a 0a20 2020 2020 2020 2064 6174  ct):.        dat
-0002b190: 6120 3d20 6172 6773 5b30 5d0a 2020 2020  a = args[0].    
-0002b1a0: 656c 6966 206c 656e 2861 7267 7329 203d  elif len(args) =
-0002b1b0: 3d20 3220 616e 6420 6973 696e 7374 616e  = 2 and isinstan
-0002b1c0: 6365 2861 7267 735b 305d 2c20 7374 7229  ce(args[0], str)
-0002b1d0: 2061 6e64 2069 7369 6e73 7461 6e63 6528   and isinstance(
-0002b1e0: 6172 6773 5b31 5d2c 2041 7272 6179 293a  args[1], Array):
-0002b1f0: 0a20 2020 2020 2020 2064 6174 6120 3d20  .        data = 
-0002b200: 7b61 7267 735b 305d 3a20 6172 6773 5b31  {args[0]: args[1
-0002b210: 5d7d 0a20 2020 2065 6c73 653a 0a20 2020  ]}.    else:.   
-0002b220: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
-0002b230: 4572 726f 7228 2250 6c65 6173 6520 7072  Error("Please pr
-0002b240: 6f76 6964 6520 7b27 2f64 6174 612f 7061  ovide {'/data/pa
-0002b250: 7468 273a 2061 7272 6179 7d20 6469 6374  th': array} dict
-0002b260: 696f 6e61 7279 2229 0a0a 2020 2020 696d  ionary")..    im
-0002b270: 706f 7274 2068 3570 790a 0a20 2020 2077  port h5py..    w
-0002b280: 6974 6820 6835 7079 2e46 696c 6528 6669  ith h5py.File(fi
-0002b290: 6c65 6e61 6d65 2c20 6d6f 6465 3d22 6122  lename, mode="a"
-0002b2a0: 2920 6173 2066 3a0a 2020 2020 2020 2020  ) as f:.        
-0002b2b0: 6473 6574 7320 3d20 5b0a 2020 2020 2020  dsets = [.      
-0002b2c0: 2020 2020 2020 662e 7265 7175 6972 655f        f.require_
-0002b2d0: 6461 7461 7365 7428 0a20 2020 2020 2020  dataset(.       
-0002b2e0: 2020 2020 2020 2020 2064 702c 0a20 2020           dp,.   
-0002b2f0: 2020 2020 2020 2020 2020 2020 2073 6861               sha
-0002b300: 7065 3d78 2e73 6861 7065 2c0a 2020 2020  pe=x.shape,.    
-0002b310: 2020 2020 2020 2020 2020 2020 6474 7970              dtyp
-0002b320: 653d 782e 6474 7970 652c 0a20 2020 2020  e=x.dtype,.     
-0002b330: 2020 2020 2020 2020 2020 2063 6875 6e6b             chunk
-0002b340: 733d 7475 706c 6528 635b 305d 2066 6f72  s=tuple(c[0] for
-0002b350: 2063 2069 6e20 782e 6368 756e 6b73 2920   c in x.chunks) 
-0002b360: 6966 2063 6875 6e6b 7320 6973 2054 7275  if chunks is Tru
-0002b370: 6520 656c 7365 2063 6875 6e6b 732c 0a20  e else chunks,. 
-0002b380: 2020 2020 2020 2020 2020 2020 2020 202a                 *
-0002b390: 2a6b 7761 7267 732c 0a20 2020 2020 2020  *kwargs,.       
-0002b3a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0002b3b0: 2020 2066 6f72 2064 702c 2078 2069 6e20     for dp, x in 
-0002b3c0: 6461 7461 2e69 7465 6d73 2829 0a20 2020  data.items().   
-0002b3d0: 2020 2020 205d 0a20 2020 2020 2020 2073       ].        s
-0002b3e0: 746f 7265 286c 6973 7428 6461 7461 2e76  tore(list(data.v
-0002b3f0: 616c 7565 7328 2929 2c20 6473 6574 7329  alues()), dsets)
-0002b400: 0a0a 0a64 6566 2069 6e74 6572 6c65 6176  ...def interleav
-0002b410: 655f 6e6f 6e65 2861 2c20 6229 3a0a 2020  e_none(a, b):.  
-0002b420: 2020 2222 220a 0a20 2020 203e 3e3e 2069    """..    >>> i
-0002b430: 6e74 6572 6c65 6176 655f 6e6f 6e65 285b  nterleave_none([
-0002b440: 302c 204e 6f6e 652c 2032 2c20 4e6f 6e65  0, None, 2, None
-0002b450: 5d2c 205b 312c 2033 5d29 0a20 2020 2028  ], [1, 3]).    (
-0002b460: 302c 2031 2c20 322c 2033 290a 2020 2020  0, 1, 2, 3).    
-0002b470: 2222 220a 2020 2020 7265 7375 6c74 203d  """.    result =
-0002b480: 205b 5d0a 2020 2020 6920 3d20 6a20 3d20   [].    i = j = 
-0002b490: 300a 2020 2020 6e20 3d20 6c65 6e28 6129  0.    n = len(a)
-0002b4a0: 202b 206c 656e 2862 290a 2020 2020 7768   + len(b).    wh
-0002b4b0: 696c 6520 6920 2b20 6a20 3c20 6e3a 0a20  ile i + j < n:. 
-0002b4c0: 2020 2020 2020 2069 6620 615b 695d 2069         if a[i] i
-0002b4d0: 7320 6e6f 7420 4e6f 6e65 3a0a 2020 2020  s not None:.    
-0002b4e0: 2020 2020 2020 2020 7265 7375 6c74 2e61          result.a
-0002b4f0: 7070 656e 6428 615b 695d 290a 2020 2020  ppend(a[i]).    
-0002b500: 2020 2020 2020 2020 6920 2b3d 2031 0a20          i += 1. 
-0002b510: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0002b520: 2020 2020 2020 2020 2072 6573 756c 742e           result.
-0002b530: 6170 7065 6e64 2862 5b6a 5d29 0a20 2020  append(b[j]).   
-0002b540: 2020 2020 2020 2020 2069 202b 3d20 310a           i += 1.
-0002b550: 2020 2020 2020 2020 2020 2020 6a20 2b3d              j +=
-0002b560: 2031 0a20 2020 2072 6574 7572 6e20 7475   1.    return tu
-0002b570: 706c 6528 7265 7375 6c74 290a 0a0a 6465  ple(result)...de
-0002b580: 6620 6b65 796e 616d 6528 6e61 6d65 2c20  f keyname(name, 
-0002b590: 692c 206f 6b65 7929 3a0a 2020 2020 2222  i, okey):.    ""
-0002b5a0: 220a 0a20 2020 203e 3e3e 206b 6579 6e61  "..    >>> keyna
-0002b5b0: 6d65 2827 7827 2c20 332c 205b 4e6f 6e65  me('x', 3, [None
-0002b5c0: 2c20 4e6f 6e65 2c20 302c 2032 5d29 0a20  , None, 0, 2]). 
-0002b5d0: 2020 2028 2778 272c 2033 2c20 302c 2032     ('x', 3, 0, 2
-0002b5e0: 290a 2020 2020 2222 220a 2020 2020 7265  ).    """.    re
-0002b5f0: 7475 726e 2028 6e61 6d65 2c20 6929 202b  turn (name, i) +
-0002b600: 2074 7570 6c65 286b 2066 6f72 206b 2069   tuple(k for k i
-0002b610: 6e20 6f6b 6579 2069 6620 6b20 6973 206e  n okey if k is n
-0002b620: 6f74 204e 6f6e 6529 0a0a 0a64 6566 205f  ot None)...def _
-0002b630: 7669 6e64 6578 2878 2c20 2a69 6e64 6578  vindex(x, *index
-0002b640: 6573 293a 0a20 2020 2022 2222 506f 696e  es):.    """Poin
-0002b650: 7420 7769 7365 2069 6e64 6578 696e 6720  t wise indexing 
-0002b660: 7769 7468 2062 726f 6164 6361 7374 696e  with broadcastin
-0002b670: 672e 0a0a 2020 2020 3e3e 3e20 7820 3d20  g...    >>> x = 
-0002b680: 6e70 2e61 7261 6e67 6528 3536 292e 7265  np.arange(56).re
-0002b690: 7368 6170 6528 2837 2c20 3829 290a 2020  shape((7, 8)).  
-0002b6a0: 2020 3e3e 3e20 780a 2020 2020 6172 7261    >>> x.    arra
-0002b6b0: 7928 5b5b 2030 2c20 2031 2c20 2032 2c20  y([[ 0,  1,  2, 
-0002b6c0: 2033 2c20 2034 2c20 2035 2c20 2036 2c20   3,  4,  5,  6, 
-0002b6d0: 2037 5d2c 0a20 2020 2020 2020 2020 2020   7],.           
-0002b6e0: 5b20 382c 2020 392c 2031 302c 2031 312c  [ 8,  9, 10, 11,
-0002b6f0: 2031 322c 2031 332c 2031 342c 2031 355d   12, 13, 14, 15]
-0002b700: 2c0a 2020 2020 2020 2020 2020 205b 3136  ,.           [16
-0002b710: 2c20 3137 2c20 3138 2c20 3139 2c20 3230  , 17, 18, 19, 20
-0002b720: 2c20 3231 2c20 3232 2c20 3233 5d2c 0a20  , 21, 22, 23],. 
-0002b730: 2020 2020 2020 2020 2020 5b32 342c 2032            [24, 2
-0002b740: 352c 2032 362c 2032 372c 2032 382c 2032  5, 26, 27, 28, 2
-0002b750: 392c 2033 302c 2033 315d 2c0a 2020 2020  9, 30, 31],.    
-0002b760: 2020 2020 2020 205b 3332 2c20 3333 2c20         [32, 33, 
-0002b770: 3334 2c20 3335 2c20 3336 2c20 3337 2c20  34, 35, 36, 37, 
-0002b780: 3338 2c20 3339 5d2c 0a20 2020 2020 2020  38, 39],.       
-0002b790: 2020 2020 5b34 302c 2034 312c 2034 322c      [40, 41, 42,
-0002b7a0: 2034 332c 2034 342c 2034 352c 2034 362c   43, 44, 45, 46,
-0002b7b0: 2034 375d 2c0a 2020 2020 2020 2020 2020   47],.          
-0002b7c0: 205b 3438 2c20 3439 2c20 3530 2c20 3531   [48, 49, 50, 51
-0002b7d0: 2c20 3532 2c20 3533 2c20 3534 2c20 3535  , 52, 53, 54, 55
-0002b7e0: 5d5d 290a 0a20 2020 203e 3e3e 2064 203d  ]])..    >>> d =
-0002b7f0: 2066 726f 6d5f 6172 7261 7928 782c 2063   from_array(x, c
-0002b800: 6875 6e6b 733d 2833 2c20 3429 290a 2020  hunks=(3, 4)).  
-0002b810: 2020 3e3e 3e20 7265 7375 6c74 203d 205f    >>> result = _
-0002b820: 7669 6e64 6578 2864 2c20 5b30 2c20 312c  vindex(d, [0, 1,
-0002b830: 2036 2c20 305d 2c20 5b30 2c20 312c 2030   6, 0], [0, 1, 0
-0002b840: 2c20 375d 290a 2020 2020 3e3e 3e20 7265  , 7]).    >>> re
-0002b850: 7375 6c74 2e63 6f6d 7075 7465 2829 0a20  sult.compute(). 
-0002b860: 2020 2061 7272 6179 285b 2030 2c20 2039     array([ 0,  9
-0002b870: 2c20 3438 2c20 2037 5d29 0a20 2020 2022  , 48,  7]).    "
-0002b880: 2222 0a20 2020 2069 6e64 6578 6573 203d  "".    indexes =
-0002b890: 2072 6570 6c61 6365 5f65 6c6c 6970 7369   replace_ellipsi
-0002b8a0: 7328 782e 6e64 696d 2c20 696e 6465 7865  s(x.ndim, indexe
-0002b8b0: 7329 0a0a 2020 2020 6e6f 6e66 616e 6379  s)..    nonfancy
-0002b8c0: 5f69 6e64 6578 6573 203d 205b 5d0a 2020  _indexes = [].  
-0002b8d0: 2020 7265 6475 6365 645f 696e 6465 7865    reduced_indexe
-0002b8e0: 7320 3d20 5b5d 0a20 2020 2066 6f72 2069  s = [].    for i
-0002b8f0: 6e64 2069 6e20 696e 6465 7865 733a 0a20  nd in indexes:. 
-0002b900: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-0002b910: 616e 6365 2869 6e64 2c20 4e75 6d62 6572  ance(ind, Number
-0002b920: 293a 0a20 2020 2020 2020 2020 2020 206e  ):.            n
-0002b930: 6f6e 6661 6e63 795f 696e 6465 7865 732e  onfancy_indexes.
-0002b940: 6170 7065 6e64 2869 6e64 290a 2020 2020  append(ind).    
-0002b950: 2020 2020 656c 6966 2069 7369 6e73 7461      elif isinsta
-0002b960: 6e63 6528 696e 642c 2073 6c69 6365 293a  nce(ind, slice):
-0002b970: 0a20 2020 2020 2020 2020 2020 206e 6f6e  .            non
-0002b980: 6661 6e63 795f 696e 6465 7865 732e 6170  fancy_indexes.ap
-0002b990: 7065 6e64 2869 6e64 290a 2020 2020 2020  pend(ind).      
-0002b9a0: 2020 2020 2020 7265 6475 6365 645f 696e        reduced_in
-0002b9b0: 6465 7865 732e 6170 7065 6e64 2873 6c69  dexes.append(sli
-0002b9c0: 6365 284e 6f6e 6529 290a 2020 2020 2020  ce(None)).      
-0002b9d0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0002b9e0: 2020 2020 6e6f 6e66 616e 6379 5f69 6e64      nonfancy_ind
-0002b9f0: 6578 6573 2e61 7070 656e 6428 736c 6963  exes.append(slic
-0002ba00: 6528 4e6f 6e65 2929 0a20 2020 2020 2020  e(None)).       
-0002ba10: 2020 2020 2072 6564 7563 6564 5f69 6e64       reduced_ind
-0002ba20: 6578 6573 2e61 7070 656e 6428 696e 6429  exes.append(ind)
-0002ba30: 0a0a 2020 2020 6e6f 6e66 616e 6379 5f69  ..    nonfancy_i
-0002ba40: 6e64 6578 6573 203d 2074 7570 6c65 286e  ndexes = tuple(n
-0002ba50: 6f6e 6661 6e63 795f 696e 6465 7865 7329  onfancy_indexes)
-0002ba60: 0a20 2020 2072 6564 7563 6564 5f69 6e64  .    reduced_ind
-0002ba70: 6578 6573 203d 2074 7570 6c65 2872 6564  exes = tuple(red
-0002ba80: 7563 6564 5f69 6e64 6578 6573 290a 0a20  uced_indexes).. 
-0002ba90: 2020 2078 203d 2078 5b6e 6f6e 6661 6e63     x = x[nonfanc
-0002baa0: 795f 696e 6465 7865 735d 0a0a 2020 2020  y_indexes]..    
-0002bab0: 6172 7261 795f 696e 6465 7865 7320 3d20  array_indexes = 
-0002bac0: 7b7d 0a20 2020 2066 6f72 2069 2c20 2869  {}.    for i, (i
-0002bad0: 6e64 2c20 7369 7a65 2920 696e 2065 6e75  nd, size) in enu
-0002bae0: 6d65 7261 7465 287a 6970 2872 6564 7563  merate(zip(reduc
-0002baf0: 6564 5f69 6e64 6578 6573 2c20 782e 7368  ed_indexes, x.sh
-0002bb00: 6170 6529 293a 0a20 2020 2020 2020 2069  ape)):.        i
-0002bb10: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0002bb20: 2869 6e64 2c20 736c 6963 6529 3a0a 2020  (ind, slice):.  
-0002bb30: 2020 2020 2020 2020 2020 696e 6420 3d20            ind = 
-0002bb40: 6e70 2e61 7272 6179 2869 6e64 2c20 636f  np.array(ind, co
-0002bb50: 7079 3d54 7275 6529 0a20 2020 2020 2020  py=True).       
-0002bb60: 2020 2020 2069 6620 696e 642e 6474 7970       if ind.dtyp
-0002bb70: 652e 6b69 6e64 203d 3d20 2262 223a 0a20  e.kind == "b":. 
-0002bb80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0002bb90: 6169 7365 2049 6e64 6578 4572 726f 7228  aise IndexError(
-0002bba0: 2276 696e 6465 7820 646f 6573 206e 6f74  "vindex does not
-0002bbb0: 2073 7570 706f 7274 2069 6e64 6578 696e   support indexin
-0002bbc0: 6720 7769 7468 2062 6f6f 6c65 616e 2061  g with boolean a
-0002bbd0: 7272 6179 7322 290a 2020 2020 2020 2020  rrays").        
-0002bbe0: 2020 2020 6966 2028 2869 6e64 203e 3d20      if ((ind >= 
-0002bbf0: 7369 7a65 2920 7c20 2869 6e64 203c 202d  size) | (ind < -
-0002bc00: 7369 7a65 2929 2e61 6e79 2829 3a0a 2020  size)).any():.  
-0002bc10: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-0002bc20: 6973 6520 496e 6465 7845 7272 6f72 280a  ise IndexError(.
-0002bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bc40: 2020 2020 2276 696e 6465 7820 6b65 7920      "vindex key 
-0002bc50: 6861 7320 656e 7472 6965 7320 6f75 7420  has entries out 
-0002bc60: 6f66 2062 6f75 6e64 7320 666f 7220 220a  of bounds for ".
-0002bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002bc80: 2020 2020 2269 6e64 6578 696e 6720 616c      "indexing al
-0002bc90: 6f6e 6720 6178 6973 2025 7320 6f66 2073  ong axis %s of s
-0002bca0: 697a 6520 2573 3a20 2572 2220 2520 2869  ize %s: %r" % (i
-0002bcb0: 2c20 7369 7a65 2c20 696e 6429 0a20 2020  , size, ind).   
-0002bcc0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-0002bcd0: 2020 2020 2020 2020 2020 2069 6e64 2025             ind %
-0002bce0: 3d20 7369 7a65 0a20 2020 2020 2020 2020  = size.         
-0002bcf0: 2020 2061 7272 6179 5f69 6e64 6578 6573     array_indexes
-0002bd00: 5b69 5d20 3d20 696e 640a 0a20 2020 2069  [i] = ind..    i
-0002bd10: 6620 6172 7261 795f 696e 6465 7865 733a  f array_indexes:
-0002bd20: 0a20 2020 2020 2020 2078 203d 205f 7669  .        x = _vi
-0002bd30: 6e64 6578 5f61 7272 6179 2878 2c20 6172  ndex_array(x, ar
-0002bd40: 7261 795f 696e 6465 7865 7329 0a0a 2020  ray_indexes)..  
-0002bd50: 2020 7265 7475 726e 2078 0a0a 0a64 6566    return x...def
-0002bd60: 205f 7669 6e64 6578 5f61 7272 6179 2878   _vindex_array(x
-0002bd70: 2c20 6469 6374 5f69 6e64 6578 6573 293a  , dict_indexes):
-0002bd80: 0a20 2020 2022 2222 506f 696e 7420 7769  .    """Point wi
-0002bd90: 7365 2069 6e64 6578 696e 6720 7769 7468  se indexing with
-0002bda0: 206f 6e6c 7920 4e75 6d50 7920 4172 7261   only NumPy Arra
-0002bdb0: 7973 2e22 2222 0a0a 2020 2020 7472 793a  ys."""..    try:
-0002bdc0: 0a20 2020 2020 2020 2062 726f 6164 6361  .        broadca
-0002bdd0: 7374 5f69 6e64 6578 6573 203d 206e 702e  st_indexes = np.
-0002bde0: 6272 6f61 6463 6173 745f 6172 7261 7973  broadcast_arrays
-0002bdf0: 282a 6469 6374 5f69 6e64 6578 6573 2e76  (*dict_indexes.v
-0002be00: 616c 7565 7328 2929 0a20 2020 2065 7863  alues()).    exc
-0002be10: 6570 7420 5661 6c75 6545 7272 6f72 2061  ept ValueError a
-0002be20: 7320 653a 0a20 2020 2020 2020 2023 206e  s e:.        # n
-0002be30: 6f74 653a 2065 7272 6f72 206d 6573 7361  ote: error messa
-0002be40: 6765 2065 7861 6374 6c79 206d 6174 6368  ge exactly match
-0002be50: 6573 206e 756d 7079 0a20 2020 2020 2020  es numpy.       
-0002be60: 2073 6861 7065 735f 7374 7220 3d20 2220   shapes_str = " 
-0002be70: 222e 6a6f 696e 2873 7472 2861 2e73 6861  ".join(str(a.sha
-0002be80: 7065 2920 666f 7220 6120 696e 2064 6963  pe) for a in dic
-0002be90: 745f 696e 6465 7865 732e 7661 6c75 6573  t_indexes.values
-0002bea0: 2829 290a 2020 2020 2020 2020 7261 6973  ()).        rais
-0002beb0: 6520 496e 6465 7845 7272 6f72 280a 2020  e IndexError(.  
-0002bec0: 2020 2020 2020 2020 2020 2273 6861 7065            "shape
-0002bed0: 206d 6973 6d61 7463 683a 2069 6e64 6578   mismatch: index
-0002bee0: 696e 6720 6172 7261 7973 2063 6f75 6c64  ing arrays could
-0002bef0: 206e 6f74 2062 6520 220a 2020 2020 2020   not be ".      
-0002bf00: 2020 2020 2020 2262 726f 6164 6361 7374        "broadcast
-0002bf10: 2074 6f67 6574 6865 7220 7769 7468 2073   together with s
-0002bf20: 6861 7065 7320 2220 2b20 7368 6170 6573  hapes " + shapes
-0002bf30: 5f73 7472 0a20 2020 2020 2020 2029 2066  _str.        ) f
-0002bf40: 726f 6d20 650a 2020 2020 6272 6f61 6463  rom e.    broadc
-0002bf50: 6173 745f 7368 6170 6520 3d20 6272 6f61  ast_shape = broa
-0002bf60: 6463 6173 745f 696e 6465 7865 735b 305d  dcast_indexes[0]
-0002bf70: 2e73 6861 7065 0a0a 2020 2020 6c6f 6f6b  .shape..    look
-0002bf80: 7570 203d 2064 6963 7428 7a69 7028 6469  up = dict(zip(di
-0002bf90: 6374 5f69 6e64 6578 6573 2c20 6272 6f61  ct_indexes, broa
-0002bfa0: 6463 6173 745f 696e 6465 7865 7329 290a  dcast_indexes)).
-0002bfb0: 2020 2020 666c 6174 5f69 6e64 6578 6573      flat_indexes
-0002bfc0: 203d 205b 0a20 2020 2020 2020 206c 6f6f   = [.        loo
-0002bfd0: 6b75 705b 695d 2e72 6176 656c 2829 2e74  kup[i].ravel().t
-0002bfe0: 6f6c 6973 7428 2920 6966 2069 2069 6e20  olist() if i in 
-0002bff0: 6c6f 6f6b 7570 2065 6c73 6520 4e6f 6e65  lookup else None
-0002c000: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
-0002c010: 782e 6e64 696d 290a 2020 2020 5d0a 2020  x.ndim).    ].  
-0002c020: 2020 666c 6174 5f69 6e64 6578 6573 2e65    flat_indexes.e
-0002c030: 7874 656e 6428 5b4e 6f6e 655d 202a 2028  xtend([None] * (
-0002c040: 782e 6e64 696d 202d 206c 656e 2866 6c61  x.ndim - len(fla
-0002c050: 745f 696e 6465 7865 7329 2929 0a0a 2020  t_indexes)))..  
-0002c060: 2020 666c 6174 5f69 6e64 6578 6573 203d    flat_indexes =
-0002c070: 205b 0a20 2020 2020 2020 206c 6973 7428   [.        list(
-0002c080: 696e 6465 7829 2069 6620 696e 6465 7820  index) if index 
-0002c090: 6973 206e 6f74 204e 6f6e 6520 656c 7365  is not None else
-0002c0a0: 2069 6e64 6578 2066 6f72 2069 6e64 6578   index for index
-0002c0b0: 2069 6e20 666c 6174 5f69 6e64 6578 6573   in flat_indexes
-0002c0c0: 0a20 2020 205d 0a20 2020 2062 6f75 6e64  .    ].    bound
-0002c0d0: 7320 3d20 5b6c 6973 7428 6163 6375 6d75  s = [list(accumu
-0002c0e0: 6c61 7465 2861 6464 2c20 2830 2c29 202b  late(add, (0,) +
-0002c0f0: 2063 2929 2066 6f72 2063 2069 6e20 782e   c)) for c in x.
-0002c100: 6368 756e 6b73 5d0a 2020 2020 626f 756e  chunks].    boun
-0002c110: 6473 3220 3d20 5b62 2066 6f72 2069 2c20  ds2 = [b for i, 
-0002c120: 6220 696e 207a 6970 2866 6c61 745f 696e  b in zip(flat_in
-0002c130: 6465 7865 732c 2062 6f75 6e64 7329 2069  dexes, bounds) i
-0002c140: 6620 6920 6973 206e 6f74 204e 6f6e 655d  f i is not None]
-0002c150: 0a20 2020 2061 7869 7320 3d20 5f67 6574  .    axis = _get
-0002c160: 5f61 7869 7328 666c 6174 5f69 6e64 6578  _axis(flat_index
-0002c170: 6573 290a 2020 2020 746f 6b65 6e20 3d20  es).    token = 
-0002c180: 746f 6b65 6e69 7a65 2878 2c20 666c 6174  tokenize(x, flat
-0002c190: 5f69 6e64 6578 6573 290a 2020 2020 6f75  _indexes).    ou
-0002c1a0: 745f 6e61 6d65 203d 2022 7669 6e64 6578  t_name = "vindex
-0002c1b0: 2d6d 6572 6765 2d22 202b 2074 6f6b 656e  -merge-" + token
-0002c1c0: 0a0a 2020 2020 706f 696e 7473 203d 206c  ..    points = l
-0002c1d0: 6973 7428 290a 2020 2020 666f 7220 692c  ist().    for i,
-0002c1e0: 2069 6478 2069 6e20 656e 756d 6572 6174   idx in enumerat
-0002c1f0: 6528 7a69 7028 2a5b 6920 666f 7220 6920  e(zip(*[i for i 
-0002c200: 696e 2066 6c61 745f 696e 6465 7865 7320  in flat_indexes 
-0002c210: 6966 2069 2069 7320 6e6f 7420 4e6f 6e65  if i is not None
-0002c220: 5d29 293a 0a20 2020 2020 2020 2062 6c6f  ])):.        blo
-0002c230: 636b 5f69 6478 203d 205b 6269 7365 6374  ck_idx = [bisect
-0002c240: 2862 2c20 696e 6429 202d 2031 2066 6f72  (b, ind) - 1 for
-0002c250: 2062 2c20 696e 6420 696e 207a 6970 2862   b, ind in zip(b
-0002c260: 6f75 6e64 7332 2c20 6964 7829 5d0a 2020  ounds2, idx)].  
-0002c270: 2020 2020 2020 696e 626c 6f63 6b5f 6964        inblock_id
-0002c280: 7820 3d20 5b0a 2020 2020 2020 2020 2020  x = [.          
-0002c290: 2020 696e 6420 2d20 626f 756e 6473 325b    ind - bounds2[
-0002c2a0: 6b5d 5b6a 5d20 666f 7220 6b2c 2028 696e  k][j] for k, (in
-0002c2b0: 642c 206a 2920 696e 2065 6e75 6d65 7261  d, j) in enumera
-0002c2c0: 7465 287a 6970 2869 6478 2c20 626c 6f63  te(zip(idx, bloc
-0002c2d0: 6b5f 6964 7829 290a 2020 2020 2020 2020  k_idx)).        
-0002c2e0: 5d0a 2020 2020 2020 2020 706f 696e 7473  ].        points
-0002c2f0: 2e61 7070 656e 6428 2869 2c20 7475 706c  .append((i, tupl
-0002c300: 6528 626c 6f63 6b5f 6964 7829 2c20 7475  e(block_idx), tu
-0002c310: 706c 6528 696e 626c 6f63 6b5f 6964 7829  ple(inblock_idx)
-0002c320: 2929 0a0a 2020 2020 6368 756e 6b73 203d  ))..    chunks =
-0002c330: 205b 6320 666f 7220 692c 2063 2069 6e20   [c for i, c in 
-0002c340: 7a69 7028 666c 6174 5f69 6e64 6578 6573  zip(flat_indexes
-0002c350: 2c20 782e 6368 756e 6b73 2920 6966 2069  , x.chunks) if i
-0002c360: 2069 7320 4e6f 6e65 5d0a 2020 2020 6368   is None].    ch
-0002c370: 756e 6b73 2e69 6e73 6572 7428 302c 2028  unks.insert(0, (
-0002c380: 6c65 6e28 706f 696e 7473 292c 2920 6966  len(points),) if
-0002c390: 2070 6f69 6e74 7320 656c 7365 2028 302c   points else (0,
-0002c3a0: 2929 0a20 2020 2063 6875 6e6b 7320 3d20  )).    chunks = 
-0002c3b0: 7475 706c 6528 6368 756e 6b73 290a 0a20  tuple(chunks).. 
-0002c3c0: 2020 2069 6620 706f 696e 7473 3a0a 2020     if points:.  
-0002c3d0: 2020 2020 2020 7065 725f 626c 6f63 6b20        per_block 
-0002c3e0: 3d20 6772 6f75 7062 7928 312c 2070 6f69  = groupby(1, poi
-0002c3f0: 6e74 7329 0a20 2020 2020 2020 2070 6572  nts).        per
-0002c400: 5f62 6c6f 636b 203d 207b 6b3a 2076 2066  _block = {k: v f
-0002c410: 6f72 206b 2c20 7620 696e 2070 6572 5f62  or k, v in per_b
-0002c420: 6c6f 636b 2e69 7465 6d73 2829 2069 6620  lock.items() if 
-0002c430: 767d 0a0a 2020 2020 2020 2020 6f74 6865  v}..        othe
-0002c440: 725f 626c 6f63 6b73 203d 206c 6973 7428  r_blocks = list(
-0002c450: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-0002c460: 6475 6374 280a 2020 2020 2020 2020 2020  duct(.          
-0002c470: 2020 2020 2020 2a5b 0a20 2020 2020 2020        *[.       
-0002c480: 2020 2020 2020 2020 2020 2020 206c 6973               lis
-0002c490: 7428 7261 6e67 6528 6c65 6e28 6329 2929  t(range(len(c)))
-0002c4a0: 2069 6620 6920 6973 204e 6f6e 6520 656c   if i is None el
-0002c4b0: 7365 205b 4e6f 6e65 5d0a 2020 2020 2020  se [None].      
-0002c4c0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-0002c4d0: 7220 692c 2063 2069 6e20 7a69 7028 666c  r i, c in zip(fl
-0002c4e0: 6174 5f69 6e64 6578 6573 2c20 782e 6368  at_indexes, x.ch
-0002c4f0: 756e 6b73 290a 2020 2020 2020 2020 2020  unks).          
-0002c500: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
-0002c510: 2020 2020 290a 2020 2020 2020 2020 290a      ).        ).
-0002c520: 0a20 2020 2020 2020 2066 756c 6c5f 736c  .        full_sl
-0002c530: 6963 6573 203d 205b 736c 6963 6528 4e6f  ices = [slice(No
-0002c540: 6e65 2c20 4e6f 6e65 2920 6966 2069 2069  ne, None) if i i
-0002c550: 7320 4e6f 6e65 2065 6c73 6520 4e6f 6e65  s None else None
-0002c560: 2066 6f72 2069 2069 6e20 666c 6174 5f69   for i in flat_i
-0002c570: 6e64 6578 6573 5d0a 0a20 2020 2020 2020  ndexes]..       
-0002c580: 206e 616d 6520 3d20 2276 696e 6465 782d   name = "vindex-
-0002c590: 736c 6963 652d 2220 2b20 746f 6b65 6e0a  slice-" + token.
-0002c5a0: 2020 2020 2020 2020 7669 6e64 6578 5f6d          vindex_m
-0002c5b0: 6572 6765 5f6e 616d 6520 3d20 2276 696e  erge_name = "vin
-0002c5c0: 6465 782d 6d65 7267 652d 2220 2b20 746f  dex-merge-" + to
-0002c5d0: 6b65 6e0a 2020 2020 2020 2020 6473 6b20  ken.        dsk 
-0002c5e0: 3d20 7b7d 0a20 2020 2020 2020 2066 6f72  = {}.        for
-0002c5f0: 206f 6b65 7920 696e 206f 7468 6572 5f62   okey in other_b
-0002c600: 6c6f 636b 733a 0a20 2020 2020 2020 2020  locks:.         
-0002c610: 2020 2066 6f72 2069 2c20 6b65 7920 696e     for i, key in
-0002c620: 2065 6e75 6d65 7261 7465 2870 6572 5f62   enumerate(per_b
-0002c630: 6c6f 636b 293a 0a20 2020 2020 2020 2020  lock):.         
-0002c640: 2020 2020 2020 2064 736b 5b6b 6579 6e61         dsk[keyna
-0002c650: 6d65 286e 616d 652c 2069 2c20 6f6b 6579  me(name, i, okey
-0002c660: 295d 203d 2028 0a20 2020 2020 2020 2020  )] = (.         
-0002c670: 2020 2020 2020 2020 2020 205f 7669 6e64             _vind
-0002c680: 6578 5f74 7261 6e73 706f 7365 2c0a 2020  ex_transpose,.  
-0002c690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c6a0: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
-0002c6b0: 2020 2020 2020 2020 2020 2020 5f76 696e              _vin
-0002c6c0: 6465 785f 736c 6963 652c 0a20 2020 2020  dex_slice,.     
-0002c6d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c6e0: 2020 2028 782e 6e61 6d65 2c29 202b 2069     (x.name,) + i
-0002c6f0: 6e74 6572 6c65 6176 655f 6e6f 6e65 286f  nterleave_none(o
-0002c700: 6b65 792c 206b 6579 292c 0a20 2020 2020  key, key),.     
-0002c710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c720: 2020 2069 6e74 6572 6c65 6176 655f 6e6f     interleave_no
-0002c730: 6e65 280a 2020 2020 2020 2020 2020 2020  ne(.            
+0002b100: 4950 0a0a 2020 2020 5468 6973 2063 616e  IP..    This can
+0002b110: 2061 6c73 6f20 6265 2075 7365 6420 6173   also be used as
+0002b120: 2061 206d 6574 686f 6420 6f6e 2061 2073   a method on a s
+0002b130: 696e 676c 6520 4172 7261 790a 0a20 2020  ingle Array..   
+0002b140: 203e 3e3e 2078 2e74 6f5f 6864 6635 2827   >>> x.to_hdf5('
+0002b150: 6d79 6669 6c65 2e68 6466 3527 2c20 272f  myfile.hdf5', '/
+0002b160: 7827 2920 2023 2064 6f63 7465 7374 3a20  x')  # doctest: 
+0002b170: 2b53 4b49 500a 0a20 2020 2053 6565 2041  +SKIP..    See A
+0002b180: 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d  lso.    --------
+0002b190: 0a20 2020 2064 612e 7374 6f72 650a 2020  .    da.store.  
+0002b1a0: 2020 6835 7079 2e46 696c 652e 6372 6561    h5py.File.crea
+0002b1b0: 7465 5f64 6174 6173 6574 0a20 2020 2022  te_dataset.    "
+0002b1c0: 2222 0a20 2020 2069 6620 6c65 6e28 6172  "".    if len(ar
+0002b1d0: 6773 2920 3d3d 2031 2061 6e64 2069 7369  gs) == 1 and isi
+0002b1e0: 6e73 7461 6e63 6528 6172 6773 5b30 5d2c  nstance(args[0],
+0002b1f0: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+0002b200: 6461 7461 203d 2061 7267 735b 305d 0a20  data = args[0]. 
+0002b210: 2020 2065 6c69 6620 6c65 6e28 6172 6773     elif len(args
+0002b220: 2920 3d3d 2032 2061 6e64 2069 7369 6e73  ) == 2 and isins
+0002b230: 7461 6e63 6528 6172 6773 5b30 5d2c 2073  tance(args[0], s
+0002b240: 7472 2920 616e 6420 6973 696e 7374 616e  tr) and isinstan
+0002b250: 6365 2861 7267 735b 315d 2c20 4172 7261  ce(args[1], Arra
+0002b260: 7929 3a0a 2020 2020 2020 2020 6461 7461  y):.        data
+0002b270: 203d 207b 6172 6773 5b30 5d3a 2061 7267   = {args[0]: arg
+0002b280: 735b 315d 7d0a 2020 2020 656c 7365 3a0a  s[1]}.    else:.
+0002b290: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+0002b2a0: 6c75 6545 7272 6f72 2822 506c 6561 7365  lueError("Please
+0002b2b0: 2070 726f 7669 6465 207b 272f 6461 7461   provide {'/data
+0002b2c0: 2f70 6174 6827 3a20 6172 7261 797d 2064  /path': array} d
+0002b2d0: 6963 7469 6f6e 6172 7922 290a 0a20 2020  ictionary")..   
+0002b2e0: 2069 6d70 6f72 7420 6835 7079 0a0a 2020   import h5py..  
+0002b2f0: 2020 7769 7468 2068 3570 792e 4669 6c65    with h5py.File
+0002b300: 2866 696c 656e 616d 652c 206d 6f64 653d  (filename, mode=
+0002b310: 2261 2229 2061 7320 663a 0a20 2020 2020  "a") as f:.     
+0002b320: 2020 2064 7365 7473 203d 205b 0a20 2020     dsets = [.   
+0002b330: 2020 2020 2020 2020 2066 2e72 6571 7569           f.requi
+0002b340: 7265 5f64 6174 6173 6574 280a 2020 2020  re_dataset(.    
+0002b350: 2020 2020 2020 2020 2020 2020 6470 2c0a              dp,.
+0002b360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002b370: 7368 6170 653d 782e 7368 6170 652c 0a20  shape=x.shape,. 
+0002b380: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+0002b390: 7479 7065 3d78 2e64 7479 7065 2c0a 2020  type=x.dtype,.  
+0002b3a0: 2020 2020 2020 2020 2020 2020 2020 6368                ch
+0002b3b0: 756e 6b73 3d74 7570 6c65 2863 5b30 5d20  unks=tuple(c[0] 
+0002b3c0: 666f 7220 6320 696e 2078 2e63 6875 6e6b  for c in x.chunk
+0002b3d0: 7329 2069 6620 6368 756e 6b73 2069 7320  s) if chunks is 
+0002b3e0: 5472 7565 2065 6c73 6520 6368 756e 6b73  True else chunks
+0002b3f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002b400: 2020 2a2a 6b77 6172 6773 2c0a 2020 2020    **kwargs,.    
+0002b410: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0002b420: 2020 2020 2020 666f 7220 6470 2c20 7820        for dp, x 
+0002b430: 696e 2064 6174 612e 6974 656d 7328 290a  in data.items().
+0002b440: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+0002b450: 2020 7374 6f72 6528 6c69 7374 2864 6174    store(list(dat
+0002b460: 612e 7661 6c75 6573 2829 292c 2064 7365  a.values()), dse
+0002b470: 7473 290a 0a0a 6465 6620 696e 7465 726c  ts)...def interl
+0002b480: 6561 7665 5f6e 6f6e 6528 612c 2062 293a  eave_none(a, b):
+0002b490: 0a20 2020 2022 2222 0a0a 2020 2020 3e3e  .    """..    >>
+0002b4a0: 3e20 696e 7465 726c 6561 7665 5f6e 6f6e  > interleave_non
+0002b4b0: 6528 5b30 2c20 4e6f 6e65 2c20 322c 204e  e([0, None, 2, N
+0002b4c0: 6f6e 655d 2c20 5b31 2c20 335d 290a 2020  one], [1, 3]).  
+0002b4d0: 2020 2830 2c20 312c 2032 2c20 3329 0a20    (0, 1, 2, 3). 
+0002b4e0: 2020 2022 2222 0a20 2020 2072 6573 756c     """.    resul
+0002b4f0: 7420 3d20 5b5d 0a20 2020 2069 203d 206a  t = [].    i = j
+0002b500: 203d 2030 0a20 2020 206e 203d 206c 656e   = 0.    n = len
+0002b510: 2861 2920 2b20 6c65 6e28 6229 0a20 2020  (a) + len(b).   
+0002b520: 2077 6869 6c65 2069 202b 206a 203c 206e   while i + j < n
+0002b530: 3a0a 2020 2020 2020 2020 6966 2061 5b69  :.        if a[i
+0002b540: 5d20 6973 206e 6f74 204e 6f6e 653a 0a20  ] is not None:. 
+0002b550: 2020 2020 2020 2020 2020 2072 6573 756c             resul
+0002b560: 742e 6170 7065 6e64 2861 5b69 5d29 0a20  t.append(a[i]). 
+0002b570: 2020 2020 2020 2020 2020 2069 202b 3d20             i += 
+0002b580: 310a 2020 2020 2020 2020 656c 7365 3a0a  1.        else:.
+0002b590: 2020 2020 2020 2020 2020 2020 7265 7375              resu
+0002b5a0: 6c74 2e61 7070 656e 6428 625b 6a5d 290a  lt.append(b[j]).
+0002b5b0: 2020 2020 2020 2020 2020 2020 6920 2b3d              i +=
+0002b5c0: 2031 0a20 2020 2020 2020 2020 2020 206a   1.            j
+0002b5d0: 202b 3d20 310a 2020 2020 7265 7475 726e   += 1.    return
+0002b5e0: 2074 7570 6c65 2872 6573 756c 7429 0a0a   tuple(result)..
+0002b5f0: 0a64 6566 206b 6579 6e61 6d65 286e 616d  .def keyname(nam
+0002b600: 652c 2069 2c20 6f6b 6579 293a 0a20 2020  e, i, okey):.   
+0002b610: 2022 2222 0a0a 2020 2020 3e3e 3e20 6b65   """..    >>> ke
+0002b620: 796e 616d 6528 2778 272c 2033 2c20 5b4e  yname('x', 3, [N
+0002b630: 6f6e 652c 204e 6f6e 652c 2030 2c20 325d  one, None, 0, 2]
+0002b640: 290a 2020 2020 2827 7827 2c20 332c 2030  ).    ('x', 3, 0
+0002b650: 2c20 3229 0a20 2020 2022 2222 0a20 2020  , 2).    """.   
+0002b660: 2072 6574 7572 6e20 286e 616d 652c 2069   return (name, i
+0002b670: 2920 2b20 7475 706c 6528 6b20 666f 7220  ) + tuple(k for 
+0002b680: 6b20 696e 206f 6b65 7920 6966 206b 2069  k in okey if k i
+0002b690: 7320 6e6f 7420 4e6f 6e65 290a 0a0a 6465  s not None)...de
+0002b6a0: 6620 5f76 696e 6465 7828 782c 202a 696e  f _vindex(x, *in
+0002b6b0: 6465 7865 7329 3a0a 2020 2020 2222 2250  dexes):.    """P
+0002b6c0: 6f69 6e74 2077 6973 6520 696e 6465 7869  oint wise indexi
+0002b6d0: 6e67 2077 6974 6820 6272 6f61 6463 6173  ng with broadcas
+0002b6e0: 7469 6e67 2e0a 0a20 2020 203e 3e3e 2078  ting...    >>> x
+0002b6f0: 203d 206e 702e 6172 616e 6765 2835 3629   = np.arange(56)
+0002b700: 2e72 6573 6861 7065 2828 372c 2038 2929  .reshape((7, 8))
+0002b710: 0a20 2020 203e 3e3e 2078 0a20 2020 2061  .    >>> x.    a
+0002b720: 7272 6179 285b 5b20 302c 2020 312c 2020  rray([[ 0,  1,  
+0002b730: 322c 2020 332c 2020 342c 2020 352c 2020  2,  3,  4,  5,  
+0002b740: 362c 2020 375d 2c0a 2020 2020 2020 2020  6,  7],.        
+0002b750: 2020 205b 2038 2c20 2039 2c20 3130 2c20     [ 8,  9, 10, 
+0002b760: 3131 2c20 3132 2c20 3133 2c20 3134 2c20  11, 12, 13, 14, 
+0002b770: 3135 5d2c 0a20 2020 2020 2020 2020 2020  15],.           
+0002b780: 5b31 362c 2031 372c 2031 382c 2031 392c  [16, 17, 18, 19,
+0002b790: 2032 302c 2032 312c 2032 322c 2032 335d   20, 21, 22, 23]
+0002b7a0: 2c0a 2020 2020 2020 2020 2020 205b 3234  ,.           [24
+0002b7b0: 2c20 3235 2c20 3236 2c20 3237 2c20 3238  , 25, 26, 27, 28
+0002b7c0: 2c20 3239 2c20 3330 2c20 3331 5d2c 0a20  , 29, 30, 31],. 
+0002b7d0: 2020 2020 2020 2020 2020 5b33 322c 2033            [32, 3
+0002b7e0: 332c 2033 342c 2033 352c 2033 362c 2033  3, 34, 35, 36, 3
+0002b7f0: 372c 2033 382c 2033 395d 2c0a 2020 2020  7, 38, 39],.    
+0002b800: 2020 2020 2020 205b 3430 2c20 3431 2c20         [40, 41, 
+0002b810: 3432 2c20 3433 2c20 3434 2c20 3435 2c20  42, 43, 44, 45, 
+0002b820: 3436 2c20 3437 5d2c 0a20 2020 2020 2020  46, 47],.       
+0002b830: 2020 2020 5b34 382c 2034 392c 2035 302c      [48, 49, 50,
+0002b840: 2035 312c 2035 322c 2035 332c 2035 342c   51, 52, 53, 54,
+0002b850: 2035 355d 5d29 0a0a 2020 2020 3e3e 3e20   55]])..    >>> 
+0002b860: 6420 3d20 6672 6f6d 5f61 7272 6179 2878  d = from_array(x
+0002b870: 2c20 6368 756e 6b73 3d28 332c 2034 2929  , chunks=(3, 4))
+0002b880: 0a20 2020 203e 3e3e 2072 6573 756c 7420  .    >>> result 
+0002b890: 3d20 5f76 696e 6465 7828 642c 205b 302c  = _vindex(d, [0,
+0002b8a0: 2031 2c20 362c 2030 5d2c 205b 302c 2031   1, 6, 0], [0, 1
+0002b8b0: 2c20 302c 2037 5d29 0a20 2020 203e 3e3e  , 0, 7]).    >>>
+0002b8c0: 2072 6573 756c 742e 636f 6d70 7574 6528   result.compute(
+0002b8d0: 290a 2020 2020 6172 7261 7928 5b20 302c  ).    array([ 0,
+0002b8e0: 2020 392c 2034 382c 2020 375d 290a 2020    9, 48,  7]).  
+0002b8f0: 2020 2222 220a 2020 2020 696e 6465 7865    """.    indexe
+0002b900: 7320 3d20 7265 706c 6163 655f 656c 6c69  s = replace_elli
+0002b910: 7073 6973 2878 2e6e 6469 6d2c 2069 6e64  psis(x.ndim, ind
+0002b920: 6578 6573 290a 0a20 2020 206e 6f6e 6661  exes)..    nonfa
+0002b930: 6e63 795f 696e 6465 7865 7320 3d20 5b5d  ncy_indexes = []
+0002b940: 0a20 2020 2072 6564 7563 6564 5f69 6e64  .    reduced_ind
+0002b950: 6578 6573 203d 205b 5d0a 2020 2020 666f  exes = [].    fo
+0002b960: 7220 696e 6420 696e 2069 6e64 6578 6573  r ind in indexes
+0002b970: 3a0a 2020 2020 2020 2020 6966 2069 7369  :.        if isi
+0002b980: 6e73 7461 6e63 6528 696e 642c 204e 756d  nstance(ind, Num
+0002b990: 6265 7229 3a0a 2020 2020 2020 2020 2020  ber):.          
+0002b9a0: 2020 6e6f 6e66 616e 6379 5f69 6e64 6578    nonfancy_index
+0002b9b0: 6573 2e61 7070 656e 6428 696e 6429 0a20  es.append(ind). 
+0002b9c0: 2020 2020 2020 2065 6c69 6620 6973 696e         elif isin
+0002b9d0: 7374 616e 6365 2869 6e64 2c20 736c 6963  stance(ind, slic
+0002b9e0: 6529 3a0a 2020 2020 2020 2020 2020 2020  e):.            
+0002b9f0: 6e6f 6e66 616e 6379 5f69 6e64 6578 6573  nonfancy_indexes
+0002ba00: 2e61 7070 656e 6428 696e 6429 0a20 2020  .append(ind).   
+0002ba10: 2020 2020 2020 2020 2072 6564 7563 6564           reduced
+0002ba20: 5f69 6e64 6578 6573 2e61 7070 656e 6428  _indexes.append(
+0002ba30: 736c 6963 6528 4e6f 6e65 2929 0a20 2020  slice(None)).   
+0002ba40: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0002ba50: 2020 2020 2020 206e 6f6e 6661 6e63 795f         nonfancy_
+0002ba60: 696e 6465 7865 732e 6170 7065 6e64 2873  indexes.append(s
+0002ba70: 6c69 6365 284e 6f6e 6529 290a 2020 2020  lice(None)).    
+0002ba80: 2020 2020 2020 2020 7265 6475 6365 645f          reduced_
+0002ba90: 696e 6465 7865 732e 6170 7065 6e64 2869  indexes.append(i
+0002baa0: 6e64 290a 0a20 2020 206e 6f6e 6661 6e63  nd)..    nonfanc
+0002bab0: 795f 696e 6465 7865 7320 3d20 7475 706c  y_indexes = tupl
+0002bac0: 6528 6e6f 6e66 616e 6379 5f69 6e64 6578  e(nonfancy_index
+0002bad0: 6573 290a 2020 2020 7265 6475 6365 645f  es).    reduced_
+0002bae0: 696e 6465 7865 7320 3d20 7475 706c 6528  indexes = tuple(
+0002baf0: 7265 6475 6365 645f 696e 6465 7865 7329  reduced_indexes)
+0002bb00: 0a0a 2020 2020 7820 3d20 785b 6e6f 6e66  ..    x = x[nonf
+0002bb10: 616e 6379 5f69 6e64 6578 6573 5d0a 0a20  ancy_indexes].. 
+0002bb20: 2020 2061 7272 6179 5f69 6e64 6578 6573     array_indexes
+0002bb30: 203d 207b 7d0a 2020 2020 666f 7220 692c   = {}.    for i,
+0002bb40: 2028 696e 642c 2073 697a 6529 2069 6e20   (ind, size) in 
+0002bb50: 656e 756d 6572 6174 6528 7a69 7028 7265  enumerate(zip(re
+0002bb60: 6475 6365 645f 696e 6465 7865 732c 2078  duced_indexes, x
+0002bb70: 2e73 6861 7065 2929 3a0a 2020 2020 2020  .shape)):.      
+0002bb80: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+0002bb90: 6e63 6528 696e 642c 2073 6c69 6365 293a  nce(ind, slice):
+0002bba0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+0002bbb0: 203d 206e 702e 6172 7261 7928 696e 642c   = np.array(ind,
+0002bbc0: 2063 6f70 793d 5472 7565 290a 2020 2020   copy=True).    
+0002bbd0: 2020 2020 2020 2020 6966 2069 6e64 2e64          if ind.d
+0002bbe0: 7479 7065 2e6b 696e 6420 3d3d 2022 6222  type.kind == "b"
+0002bbf0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0002bc00: 2020 7261 6973 6520 496e 6465 7845 7272    raise IndexErr
+0002bc10: 6f72 2822 7669 6e64 6578 2064 6f65 7320  or("vindex does 
+0002bc20: 6e6f 7420 7375 7070 6f72 7420 696e 6465  not support inde
+0002bc30: 7869 6e67 2077 6974 6820 626f 6f6c 6561  xing with boolea
+0002bc40: 6e20 6172 7261 7973 2229 0a20 2020 2020  n arrays").     
+0002bc50: 2020 2020 2020 2069 6620 2828 696e 6420         if ((ind 
+0002bc60: 3e3d 2073 697a 6529 207c 2028 696e 6420  >= size) | (ind 
+0002bc70: 3c20 2d73 697a 6529 292e 616e 7928 293a  < -size)).any():
+0002bc80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002bc90: 2072 6169 7365 2049 6e64 6578 4572 726f   raise IndexErro
+0002bca0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0002bcb0: 2020 2020 2020 2022 7669 6e64 6578 206b         "vindex k
+0002bcc0: 6579 2068 6173 2065 6e74 7269 6573 206f  ey has entries o
+0002bcd0: 7574 206f 6620 626f 756e 6473 2066 6f72  ut of bounds for
+0002bce0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0002bcf0: 2020 2020 2020 2022 696e 6465 7869 6e67         "indexing
+0002bd00: 2061 6c6f 6e67 2061 7869 7320 2573 206f   along axis %s o
+0002bd10: 6620 7369 7a65 2025 733a 2025 7222 2025  f size %s: %r" %
+0002bd20: 2028 692c 2073 697a 652c 2069 6e64 290a   (i, size, ind).
+0002bd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002bd40: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
+0002bd50: 6420 253d 2073 697a 650a 2020 2020 2020  d %= size.      
+0002bd60: 2020 2020 2020 6172 7261 795f 696e 6465        array_inde
+0002bd70: 7865 735b 695d 203d 2069 6e64 0a0a 2020  xes[i] = ind..  
+0002bd80: 2020 6966 2061 7272 6179 5f69 6e64 6578    if array_index
+0002bd90: 6573 3a0a 2020 2020 2020 2020 7820 3d20  es:.        x = 
+0002bda0: 5f76 696e 6465 785f 6172 7261 7928 782c  _vindex_array(x,
+0002bdb0: 2061 7272 6179 5f69 6e64 6578 6573 290a   array_indexes).
+0002bdc0: 0a20 2020 2072 6574 7572 6e20 780a 0a0a  .    return x...
+0002bdd0: 6465 6620 5f76 696e 6465 785f 6172 7261  def _vindex_arra
+0002bde0: 7928 782c 2064 6963 745f 696e 6465 7865  y(x, dict_indexe
+0002bdf0: 7329 3a0a 2020 2020 2222 2250 6f69 6e74  s):.    """Point
+0002be00: 2077 6973 6520 696e 6465 7869 6e67 2077   wise indexing w
+0002be10: 6974 6820 6f6e 6c79 204e 756d 5079 2041  ith only NumPy A
+0002be20: 7272 6179 732e 2222 220a 0a20 2020 2074  rrays."""..    t
+0002be30: 7279 3a0a 2020 2020 2020 2020 6272 6f61  ry:.        broa
+0002be40: 6463 6173 745f 696e 6465 7865 7320 3d20  dcast_indexes = 
+0002be50: 6e70 2e62 726f 6164 6361 7374 5f61 7272  np.broadcast_arr
+0002be60: 6179 7328 2a64 6963 745f 696e 6465 7865  ays(*dict_indexe
+0002be70: 732e 7661 6c75 6573 2829 290a 2020 2020  s.values()).    
+0002be80: 6578 6365 7074 2056 616c 7565 4572 726f  except ValueErro
+0002be90: 7220 6173 2065 3a0a 2020 2020 2020 2020  r as e:.        
+0002bea0: 2320 6e6f 7465 3a20 6572 726f 7220 6d65  # note: error me
+0002beb0: 7373 6167 6520 6578 6163 746c 7920 6d61  ssage exactly ma
+0002bec0: 7463 6865 7320 6e75 6d70 790a 2020 2020  tches numpy.    
+0002bed0: 2020 2020 7368 6170 6573 5f73 7472 203d      shapes_str =
+0002bee0: 2022 2022 2e6a 6f69 6e28 7374 7228 612e   " ".join(str(a.
+0002bef0: 7368 6170 6529 2066 6f72 2061 2069 6e20  shape) for a in 
+0002bf00: 6469 6374 5f69 6e64 6578 6573 2e76 616c  dict_indexes.val
+0002bf10: 7565 7328 2929 0a20 2020 2020 2020 2072  ues()).        r
+0002bf20: 6169 7365 2049 6e64 6578 4572 726f 7228  aise IndexError(
+0002bf30: 0a20 2020 2020 2020 2020 2020 2022 7368  .            "sh
+0002bf40: 6170 6520 6d69 736d 6174 6368 3a20 696e  ape mismatch: in
+0002bf50: 6465 7869 6e67 2061 7272 6179 7320 636f  dexing arrays co
+0002bf60: 756c 6420 6e6f 7420 6265 2022 0a20 2020  uld not be ".   
+0002bf70: 2020 2020 2020 2020 2022 6272 6f61 6463           "broadc
+0002bf80: 6173 7420 746f 6765 7468 6572 2077 6974  ast together wit
+0002bf90: 6820 7368 6170 6573 2022 202b 2073 6861  h shapes " + sha
+0002bfa0: 7065 735f 7374 720a 2020 2020 2020 2020  pes_str.        
+0002bfb0: 2920 6672 6f6d 2065 0a20 2020 2062 726f  ) from e.    bro
+0002bfc0: 6164 6361 7374 5f73 6861 7065 203d 2062  adcast_shape = b
+0002bfd0: 726f 6164 6361 7374 5f69 6e64 6578 6573  roadcast_indexes
+0002bfe0: 5b30 5d2e 7368 6170 650a 0a20 2020 206c  [0].shape..    l
+0002bff0: 6f6f 6b75 7020 3d20 6469 6374 287a 6970  ookup = dict(zip
+0002c000: 2864 6963 745f 696e 6465 7865 732c 2062  (dict_indexes, b
+0002c010: 726f 6164 6361 7374 5f69 6e64 6578 6573  roadcast_indexes
+0002c020: 2929 0a20 2020 2066 6c61 745f 696e 6465  )).    flat_inde
+0002c030: 7865 7320 3d20 5b0a 2020 2020 2020 2020  xes = [.        
+0002c040: 6c6f 6f6b 7570 5b69 5d2e 7261 7665 6c28  lookup[i].ravel(
+0002c050: 292e 746f 6c69 7374 2829 2069 6620 6920  ).tolist() if i 
+0002c060: 696e 206c 6f6f 6b75 7020 656c 7365 204e  in lookup else N
+0002c070: 6f6e 6520 666f 7220 6920 696e 2072 616e  one for i in ran
+0002c080: 6765 2878 2e6e 6469 6d29 0a20 2020 205d  ge(x.ndim).    ]
+0002c090: 0a20 2020 2066 6c61 745f 696e 6465 7865  .    flat_indexe
+0002c0a0: 732e 6578 7465 6e64 285b 4e6f 6e65 5d20  s.extend([None] 
+0002c0b0: 2a20 2878 2e6e 6469 6d20 2d20 6c65 6e28  * (x.ndim - len(
+0002c0c0: 666c 6174 5f69 6e64 6578 6573 2929 290a  flat_indexes))).
+0002c0d0: 0a20 2020 2066 6c61 745f 696e 6465 7865  .    flat_indexe
+0002c0e0: 7320 3d20 5b0a 2020 2020 2020 2020 6c69  s = [.        li
+0002c0f0: 7374 2869 6e64 6578 2920 6966 2069 6e64  st(index) if ind
+0002c100: 6578 2069 7320 6e6f 7420 4e6f 6e65 2065  ex is not None e
+0002c110: 6c73 6520 696e 6465 7820 666f 7220 696e  lse index for in
+0002c120: 6465 7820 696e 2066 6c61 745f 696e 6465  dex in flat_inde
+0002c130: 7865 730a 2020 2020 5d0a 2020 2020 626f  xes.    ].    bo
+0002c140: 756e 6473 203d 205b 6c69 7374 2861 6363  unds = [list(acc
+0002c150: 756d 756c 6174 6528 6164 642c 2028 302c  umulate(add, (0,
+0002c160: 2920 2b20 6329 2920 666f 7220 6320 696e  ) + c)) for c in
+0002c170: 2078 2e63 6875 6e6b 735d 0a20 2020 2062   x.chunks].    b
+0002c180: 6f75 6e64 7332 203d 205b 6220 666f 7220  ounds2 = [b for 
+0002c190: 692c 2062 2069 6e20 7a69 7028 666c 6174  i, b in zip(flat
+0002c1a0: 5f69 6e64 6578 6573 2c20 626f 756e 6473  _indexes, bounds
+0002c1b0: 2920 6966 2069 2069 7320 6e6f 7420 4e6f  ) if i is not No
+0002c1c0: 6e65 5d0a 2020 2020 6178 6973 203d 205f  ne].    axis = _
+0002c1d0: 6765 745f 6178 6973 2866 6c61 745f 696e  get_axis(flat_in
+0002c1e0: 6465 7865 7329 0a20 2020 2074 6f6b 656e  dexes).    token
+0002c1f0: 203d 2074 6f6b 656e 697a 6528 782c 2066   = tokenize(x, f
+0002c200: 6c61 745f 696e 6465 7865 7329 0a20 2020  lat_indexes).   
+0002c210: 206f 7574 5f6e 616d 6520 3d20 2276 696e   out_name = "vin
+0002c220: 6465 782d 6d65 7267 652d 2220 2b20 746f  dex-merge-" + to
+0002c230: 6b65 6e0a 0a20 2020 2070 6f69 6e74 7320  ken..    points 
+0002c240: 3d20 6c69 7374 2829 0a20 2020 2066 6f72  = list().    for
+0002c250: 2069 2c20 6964 7820 696e 2065 6e75 6d65   i, idx in enume
+0002c260: 7261 7465 287a 6970 282a 5b69 2066 6f72  rate(zip(*[i for
+0002c270: 2069 2069 6e20 666c 6174 5f69 6e64 6578   i in flat_index
+0002c280: 6573 2069 6620 6920 6973 206e 6f74 204e  es if i is not N
+0002c290: 6f6e 655d 2929 3a0a 2020 2020 2020 2020  one])):.        
+0002c2a0: 626c 6f63 6b5f 6964 7820 3d20 5b62 6973  block_idx = [bis
+0002c2b0: 6563 7428 622c 2069 6e64 2920 2d20 3120  ect(b, ind) - 1 
+0002c2c0: 666f 7220 622c 2069 6e64 2069 6e20 7a69  for b, ind in zi
+0002c2d0: 7028 626f 756e 6473 322c 2069 6478 295d  p(bounds2, idx)]
+0002c2e0: 0a20 2020 2020 2020 2069 6e62 6c6f 636b  .        inblock
+0002c2f0: 5f69 6478 203d 205b 0a20 2020 2020 2020  _idx = [.       
+0002c300: 2020 2020 2069 6e64 202d 2062 6f75 6e64       ind - bound
+0002c310: 7332 5b6b 5d5b 6a5d 2066 6f72 206b 2c20  s2[k][j] for k, 
+0002c320: 2869 6e64 2c20 6a29 2069 6e20 656e 756d  (ind, j) in enum
+0002c330: 6572 6174 6528 7a69 7028 6964 782c 2062  erate(zip(idx, b
+0002c340: 6c6f 636b 5f69 6478 2929 0a20 2020 2020  lock_idx)).     
+0002c350: 2020 205d 0a20 2020 2020 2020 2070 6f69     ].        poi
+0002c360: 6e74 732e 6170 7065 6e64 2828 692c 2074  nts.append((i, t
+0002c370: 7570 6c65 2862 6c6f 636b 5f69 6478 292c  uple(block_idx),
+0002c380: 2074 7570 6c65 2869 6e62 6c6f 636b 5f69   tuple(inblock_i
+0002c390: 6478 2929 290a 0a20 2020 2063 6875 6e6b  dx)))..    chunk
+0002c3a0: 7320 3d20 5b63 2066 6f72 2069 2c20 6320  s = [c for i, c 
+0002c3b0: 696e 207a 6970 2866 6c61 745f 696e 6465  in zip(flat_inde
+0002c3c0: 7865 732c 2078 2e63 6875 6e6b 7329 2069  xes, x.chunks) i
+0002c3d0: 6620 6920 6973 204e 6f6e 655d 0a20 2020  f i is None].   
+0002c3e0: 2063 6875 6e6b 732e 696e 7365 7274 2830   chunks.insert(0
+0002c3f0: 2c20 286c 656e 2870 6f69 6e74 7329 2c29  , (len(points),)
+0002c400: 2069 6620 706f 696e 7473 2065 6c73 6520   if points else 
+0002c410: 2830 2c29 290a 2020 2020 6368 756e 6b73  (0,)).    chunks
+0002c420: 203d 2074 7570 6c65 2863 6875 6e6b 7329   = tuple(chunks)
+0002c430: 0a0a 2020 2020 6966 2070 6f69 6e74 733a  ..    if points:
+0002c440: 0a20 2020 2020 2020 2070 6572 5f62 6c6f  .        per_blo
+0002c450: 636b 203d 2067 726f 7570 6279 2831 2c20  ck = groupby(1, 
+0002c460: 706f 696e 7473 290a 2020 2020 2020 2020  points).        
+0002c470: 7065 725f 626c 6f63 6b20 3d20 7b6b 3a20  per_block = {k: 
+0002c480: 7620 666f 7220 6b2c 2076 2069 6e20 7065  v for k, v in pe
+0002c490: 725f 626c 6f63 6b2e 6974 656d 7328 2920  r_block.items() 
+0002c4a0: 6966 2076 7d0a 0a20 2020 2020 2020 206f  if v}..        o
+0002c4b0: 7468 6572 5f62 6c6f 636b 7320 3d20 6c69  ther_blocks = li
+0002c4c0: 7374 280a 2020 2020 2020 2020 2020 2020  st(.            
+0002c4d0: 7072 6f64 7563 7428 0a20 2020 2020 2020  product(.       
+0002c4e0: 2020 2020 2020 2020 202a 5b0a 2020 2020           *[.    
+0002c4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c500: 6c69 7374 2872 616e 6765 286c 656e 2863  list(range(len(c
+0002c510: 2929 2920 6966 2069 2069 7320 4e6f 6e65  ))) if i is None
+0002c520: 2065 6c73 6520 5b4e 6f6e 655d 0a20 2020   else [None].   
+0002c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c540: 2066 6f72 2069 2c20 6320 696e 207a 6970   for i, c in zip
+0002c550: 2866 6c61 745f 696e 6465 7865 732c 2078  (flat_indexes, x
+0002c560: 2e63 6875 6e6b 7329 0a20 2020 2020 2020  .chunks).       
+0002c570: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+0002c580: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0002c590: 2029 0a0a 2020 2020 2020 2020 6675 6c6c   )..        full
+0002c5a0: 5f73 6c69 6365 7320 3d20 5b73 6c69 6365  _slices = [slice
+0002c5b0: 284e 6f6e 652c 204e 6f6e 6529 2069 6620  (None, None) if 
+0002c5c0: 6920 6973 204e 6f6e 6520 656c 7365 204e  i is None else N
+0002c5d0: 6f6e 6520 666f 7220 6920 696e 2066 6c61  one for i in fla
+0002c5e0: 745f 696e 6465 7865 735d 0a0a 2020 2020  t_indexes]..    
+0002c5f0: 2020 2020 6e61 6d65 203d 2022 7669 6e64      name = "vind
+0002c600: 6578 2d73 6c69 6365 2d22 202b 2074 6f6b  ex-slice-" + tok
+0002c610: 656e 0a20 2020 2020 2020 2076 696e 6465  en.        vinde
+0002c620: 785f 6d65 7267 655f 6e61 6d65 203d 2022  x_merge_name = "
+0002c630: 7669 6e64 6578 2d6d 6572 6765 2d22 202b  vindex-merge-" +
+0002c640: 2074 6f6b 656e 0a20 2020 2020 2020 2064   token.        d
+0002c650: 736b 203d 207b 7d0a 2020 2020 2020 2020  sk = {}.        
+0002c660: 666f 7220 6f6b 6579 2069 6e20 6f74 6865  for okey in othe
+0002c670: 725f 626c 6f63 6b73 3a0a 2020 2020 2020  r_blocks:.      
+0002c680: 2020 2020 2020 666f 7220 692c 206b 6579        for i, key
+0002c690: 2069 6e20 656e 756d 6572 6174 6528 7065   in enumerate(pe
+0002c6a0: 725f 626c 6f63 6b29 3a0a 2020 2020 2020  r_block):.      
+0002c6b0: 2020 2020 2020 2020 2020 6473 6b5b 6b65            dsk[ke
+0002c6c0: 796e 616d 6528 6e61 6d65 2c20 692c 206f  yname(name, i, o
+0002c6d0: 6b65 7929 5d20 3d20 280a 2020 2020 2020  key)] = (.      
+0002c6e0: 2020 2020 2020 2020 2020 2020 2020 5f76                _v
+0002c6f0: 696e 6465 785f 7472 616e 7370 6f73 652c  index_transpose,
+0002c700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c710: 2020 2020 2028 0a20 2020 2020 2020 2020       (.         
+0002c720: 2020 2020 2020 2020 2020 2020 2020 205f                 _
+0002c730: 7669 6e64 6578 5f73 6c69 6365 2c0a 2020  vindex_slice,.  
 0002c740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c750: 6675 6c6c 5f73 6c69 6365 732c 206c 6973  full_slices, lis
-0002c760: 7428 7a69 7028 2a70 6c75 636b 2832 2c20  t(zip(*pluck(2, 
-0002c770: 7065 725f 626c 6f63 6b5b 6b65 795d 2929  per_block[key]))
-0002c780: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0002c790: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
-0002c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0002c7b0: 2029 2c0a 2020 2020 2020 2020 2020 2020   ),.            
-0002c7c0: 2020 2020 2020 2020 6178 6973 2c0a 2020          axis,.  
-0002c7d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0002c7e0: 2020 2020 2020 2020 2020 2020 6473 6b5b              dsk[
-0002c7f0: 6b65 796e 616d 6528 7669 6e64 6578 5f6d  keyname(vindex_m
-0002c800: 6572 6765 5f6e 616d 652c 2030 2c20 6f6b  erge_name, 0, ok
-0002c810: 6579 295d 203d 2028 0a20 2020 2020 2020  ey)] = (.       
-0002c820: 2020 2020 2020 2020 205f 7669 6e64 6578           _vindex
-0002c830: 5f6d 6572 6765 2c0a 2020 2020 2020 2020  _merge,.        
-0002c840: 2020 2020 2020 2020 5b6c 6973 7428 706c          [list(pl
-0002c850: 7563 6b28 302c 2070 6572 5f62 6c6f 636b  uck(0, per_block
-0002c860: 5b6b 6579 5d29 2920 666f 7220 6b65 7920  [key])) for key 
-0002c870: 696e 2070 6572 5f62 6c6f 636b 5d2c 0a20  in per_block],. 
-0002c880: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-0002c890: 6b65 796e 616d 6528 6e61 6d65 2c20 692c  keyname(name, i,
-0002c8a0: 206f 6b65 7929 2066 6f72 2069 2069 6e20   okey) for i in 
-0002c8b0: 7261 6e67 6528 6c65 6e28 7065 725f 626c  range(len(per_bl
-0002c8c0: 6f63 6b29 295d 2c0a 2020 2020 2020 2020  ock))],.        
-0002c8d0: 2020 2020 290a 0a20 2020 2020 2020 2072      )..        r
-0002c8e0: 6573 756c 745f 3164 203d 2041 7272 6179  esult_1d = Array
-0002c8f0: 280a 2020 2020 2020 2020 2020 2020 4869  (.            Hi
-0002c900: 6768 4c65 7665 6c47 7261 7068 2e66 726f  ghLevelGraph.fro
-0002c910: 6d5f 636f 6c6c 6563 7469 6f6e 7328 6f75  m_collections(ou
-0002c920: 745f 6e61 6d65 2c20 6473 6b2c 2064 6570  t_name, dsk, dep
-0002c930: 656e 6465 6e63 6965 733d 5b78 5d29 2c0a  endencies=[x]),.
-0002c940: 2020 2020 2020 2020 2020 2020 6f75 745f              out_
-0002c950: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
-0002c960: 2020 6368 756e 6b73 2c0a 2020 2020 2020    chunks,.      
-0002c970: 2020 2020 2020 782e 6474 7970 652c 0a20        x.dtype,. 
-0002c980: 2020 2020 2020 2020 2020 206d 6574 613d             meta=
-0002c990: 782e 5f6d 6574 612c 0a20 2020 2020 2020  x._meta,.       
-0002c9a0: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
-0002c9b0: 6e20 7265 7375 6c74 5f31 642e 7265 7368  n result_1d.resh
-0002c9c0: 6170 6528 6272 6f61 6463 6173 745f 7368  ape(broadcast_sh
-0002c9d0: 6170 6520 2b20 7265 7375 6c74 5f31 642e  ape + result_1d.
-0002c9e0: 7368 6170 655b 313a 5d29 0a0a 2020 2020  shape[1:])..    
-0002c9f0: 2320 6f75 7470 7574 2068 6173 2061 207a  # output has a z
-0002ca00: 6572 6f20 6469 6d65 6e73 696f 6e2c 206a  ero dimension, j
-0002ca10: 7573 7420 6372 6561 7465 2061 206e 6577  ust create a new
-0002ca20: 207a 6572 6f2d 7368 6170 6520 6172 7261   zero-shape arra
-0002ca30: 7920 7769 7468 2074 6865 0a20 2020 2023  y with the.    #
-0002ca40: 2073 616d 6520 6474 7970 650a 2020 2020   same dtype.    
-0002ca50: 6672 6f6d 2064 6173 6b2e 6172 7261 792e  from dask.array.
-0002ca60: 7772 6170 2069 6d70 6f72 7420 656d 7074  wrap import empt
-0002ca70: 790a 0a20 2020 2072 6573 756c 745f 3164  y..    result_1d
-0002ca80: 203d 2065 6d70 7479 280a 2020 2020 2020   = empty(.      
-0002ca90: 2020 7475 706c 6528 6d61 7028 7375 6d2c    tuple(map(sum,
-0002caa0: 2063 6875 6e6b 7329 292c 2063 6875 6e6b   chunks)), chunk
-0002cab0: 733d 6368 756e 6b73 2c20 6474 7970 653d  s=chunks, dtype=
-0002cac0: 782e 6474 7970 652c 206e 616d 653d 6f75  x.dtype, name=ou
-0002cad0: 745f 6e61 6d65 0a20 2020 2029 0a20 2020  t_name.    ).   
-0002cae0: 2072 6574 7572 6e20 7265 7375 6c74 5f31   return result_1
-0002caf0: 642e 7265 7368 6170 6528 6272 6f61 6463  d.reshape(broadc
-0002cb00: 6173 745f 7368 6170 6520 2b20 7265 7375  ast_shape + resu
-0002cb10: 6c74 5f31 642e 7368 6170 655b 313a 5d29  lt_1d.shape[1:])
-0002cb20: 0a0a 0a64 6566 205f 6765 745f 6178 6973  ...def _get_axis
-0002cb30: 2869 6e64 6578 6573 293a 0a20 2020 2022  (indexes):.    "
-0002cb40: 2222 4765 7420 6178 6973 2061 6c6f 6e67  ""Get axis along
-0002cb50: 2077 6869 6368 2070 6f69 6e74 2d77 6973   which point-wis
-0002cb60: 6520 736c 6963 696e 6720 7265 7375 6c74  e slicing result
-0002cb70: 7320 6c69 650a 0a20 2020 2054 6869 7320  s lie..    This 
-0002cb80: 6973 206d 6f73 746c 7920 6120 6861 636b  is mostly a hack
-0002cb90: 2062 6563 6175 7365 2049 2063 616e 2774   because I can't
-0002cba0: 2066 6967 7572 6520 6f75 7420 4e75 6d50   figure out NumP
-0002cbb0: 7927 7320 7275 6c65 206f 6e20 7468 6973  y's rule on this
-0002cbc0: 2061 6e64 0a20 2020 2063 616e 2774 2062   and.    can't b
-0002cbd0: 6520 626f 7468 6572 6564 2074 6f20 676f  e bothered to go
-0002cbe0: 2072 6561 6469 6e67 2e0a 0a20 2020 203e   reading...    >
-0002cbf0: 3e3e 205f 6765 745f 6178 6973 285b 5b31  >> _get_axis([[1
-0002cc00: 2c20 325d 2c20 4e6f 6e65 2c20 5b31 2c20  , 2], None, [1, 
-0002cc10: 325d 2c20 4e6f 6e65 5d29 0a20 2020 2030  2], None]).    0
-0002cc20: 0a20 2020 203e 3e3e 205f 6765 745f 6178  .    >>> _get_ax
-0002cc30: 6973 285b 4e6f 6e65 2c20 5b31 2c20 325d  is([None, [1, 2]
-0002cc40: 2c20 5b31 2c20 325d 2c20 4e6f 6e65 5d29  , [1, 2], None])
-0002cc50: 0a20 2020 2031 0a20 2020 203e 3e3e 205f  .    1.    >>> _
-0002cc60: 6765 745f 6178 6973 285b 4e6f 6e65 2c20  get_axis([None, 
-0002cc70: 4e6f 6e65 2c20 5b31 2c20 325d 2c20 5b31  None, [1, 2], [1
-0002cc80: 2c20 325d 5d29 0a20 2020 2032 0a20 2020  , 2]]).    2.   
-0002cc90: 2022 2222 0a20 2020 206e 6469 6d20 3d20   """.    ndim = 
-0002cca0: 6c65 6e28 696e 6465 7865 7329 0a20 2020  len(indexes).   
-0002ccb0: 2069 6e64 6578 6573 203d 205b 736c 6963   indexes = [slic
-0002ccc0: 6528 4e6f 6e65 2c20 4e6f 6e65 2920 6966  e(None, None) if
-0002ccd0: 2069 2069 7320 4e6f 6e65 2065 6c73 6520   i is None else 
-0002cce0: 5b30 5d20 666f 7220 6920 696e 2069 6e64  [0] for i in ind
-0002ccf0: 6578 6573 5d0a 2020 2020 7820 3d20 6e70  exes].    x = np
-0002cd00: 2e65 6d70 7479 2828 322c 2920 2a20 6e64  .empty((2,) * nd
-0002cd10: 696d 290a 2020 2020 7832 203d 2078 5b74  im).    x2 = x[t
-0002cd20: 7570 6c65 2869 6e64 6578 6573 295d 0a20  uple(indexes)]. 
-0002cd30: 2020 2072 6574 7572 6e20 7832 2e73 6861     return x2.sha
-0002cd40: 7065 2e69 6e64 6578 2831 290a 0a0a 6465  pe.index(1)...de
-0002cd50: 6620 5f76 696e 6465 785f 736c 6963 6528  f _vindex_slice(
-0002cd60: 626c 6f63 6b2c 2070 6f69 6e74 7329 3a0a  block, points):.
-0002cd70: 2020 2020 2222 2250 756c 6c20 6f75 7420      """Pull out 
-0002cd80: 706f 696e 742d 7769 7365 2073 6c69 6365  point-wise slice
-0002cd90: 7320 6672 6f6d 2062 6c6f 636b 2222 220a  s from block""".
-0002cda0: 2020 2020 706f 696e 7473 203d 205b 7020      points = [p 
-0002cdb0: 6966 2069 7369 6e73 7461 6e63 6528 702c  if isinstance(p,
-0002cdc0: 2073 6c69 6365 2920 656c 7365 206c 6973   slice) else lis
-0002cdd0: 7428 7029 2066 6f72 2070 2069 6e20 706f  t(p) for p in po
-0002cde0: 696e 7473 5d0a 2020 2020 7265 7475 726e  ints].    return
-0002cdf0: 2062 6c6f 636b 5b74 7570 6c65 2870 6f69   block[tuple(poi
-0002ce00: 6e74 7329 5d0a 0a0a 6465 6620 5f76 696e  nts)]...def _vin
-0002ce10: 6465 785f 7472 616e 7370 6f73 6528 626c  dex_transpose(bl
-0002ce20: 6f63 6b2c 2061 7869 7329 3a0a 2020 2020  ock, axis):.    
-0002ce30: 2222 2252 6f74 6174 6520 626c 6f63 6b20  """Rotate block 
-0002ce40: 736f 2074 6861 7420 706f 696e 7473 2061  so that points a
-0002ce50: 7265 206f 6e20 7468 6520 6669 7273 7420  re on the first 
-0002ce60: 6469 6d65 6e73 696f 6e22 2222 0a20 2020  dimension""".   
-0002ce70: 2061 7865 7320 3d20 5b61 7869 735d 202b   axes = [axis] +
-0002ce80: 206c 6973 7428 7261 6e67 6528 6178 6973   list(range(axis
-0002ce90: 2929 202b 206c 6973 7428 7261 6e67 6528  )) + list(range(
-0002cea0: 6178 6973 202b 2031 2c20 626c 6f63 6b2e  axis + 1, block.
-0002ceb0: 6e64 696d 2929 0a20 2020 2072 6574 7572  ndim)).    retur
-0002cec0: 6e20 626c 6f63 6b2e 7472 616e 7370 6f73  n block.transpos
-0002ced0: 6528 6178 6573 290a 0a0a 6465 6620 5f76  e(axes)...def _v
-0002cee0: 696e 6465 785f 6d65 7267 6528 6c6f 6361  index_merge(loca
-0002cef0: 7469 6f6e 732c 2076 616c 7565 7329 3a0a  tions, values):.
-0002cf00: 2020 2020 2222 220a 0a20 2020 203e 3e3e      """..    >>>
-0002cf10: 206c 6f63 6174 696f 6e73 203d 205b 305d   locations = [0]
-0002cf20: 2c20 5b32 2c20 315d 0a20 2020 203e 3e3e  , [2, 1].    >>>
-0002cf30: 2076 616c 7565 7320 3d20 5b6e 702e 6172   values = [np.ar
-0002cf40: 7261 7928 5b5b 312c 2032 2c20 335d 5d29  ray([[1, 2, 3]])
-0002cf50: 2c0a 2020 2020 2e2e 2e20 2020 2020 2020  ,.    ...       
-0002cf60: 2020 2020 6e70 2e61 7272 6179 285b 5b31      np.array([[1
-0002cf70: 302c 2032 302c 2033 305d 2c20 5b34 302c  0, 20, 30], [40,
-0002cf80: 2035 302c 2036 305d 5d29 5d0a 0a20 2020   50, 60]])]..   
-0002cf90: 203e 3e3e 205f 7669 6e64 6578 5f6d 6572   >>> _vindex_mer
-0002cfa0: 6765 286c 6f63 6174 696f 6e73 2c20 7661  ge(locations, va
-0002cfb0: 6c75 6573 290a 2020 2020 6172 7261 7928  lues).    array(
-0002cfc0: 5b5b 2031 2c20 2032 2c20 2033 5d2c 0a20  [[ 1,  2,  3],. 
-0002cfd0: 2020 2020 2020 2020 2020 5b34 302c 2035            [40, 5
-0002cfe0: 302c 2036 305d 2c0a 2020 2020 2020 2020  0, 60],.        
-0002cff0: 2020 205b 3130 2c20 3230 2c20 3330 5d5d     [10, 20, 30]]
-0002d000: 290a 2020 2020 2222 220a 2020 2020 6c6f  ).    """.    lo
-0002d010: 6361 7469 6f6e 7320 3d20 6c69 7374 286d  cations = list(m
-0002d020: 6170 286c 6973 742c 206c 6f63 6174 696f  ap(list, locatio
-0002d030: 6e73 2929 0a20 2020 2076 616c 7565 7320  ns)).    values 
-0002d040: 3d20 6c69 7374 2876 616c 7565 7329 0a0a  = list(values)..
-0002d050: 2020 2020 6e20 3d20 7375 6d28 6d61 7028      n = sum(map(
-0002d060: 6c65 6e2c 206c 6f63 6174 696f 6e73 2929  len, locations))
-0002d070: 0a0a 2020 2020 7368 6170 6520 3d20 6c69  ..    shape = li
-0002d080: 7374 2876 616c 7565 735b 305d 2e73 6861  st(values[0].sha
-0002d090: 7065 290a 2020 2020 7368 6170 655b 305d  pe).    shape[0]
-0002d0a0: 203d 206e 0a20 2020 2073 6861 7065 203d   = n.    shape =
-0002d0b0: 2074 7570 6c65 2873 6861 7065 290a 0a20   tuple(shape).. 
-0002d0c0: 2020 2064 7479 7065 203d 2076 616c 7565     dtype = value
-0002d0d0: 735b 305d 2e64 7479 7065 0a0a 2020 2020  s[0].dtype..    
-0002d0e0: 7820 3d20 6e70 2e65 6d70 7479 5f6c 696b  x = np.empty_lik
-0002d0f0: 6528 7661 6c75 6573 5b30 5d2c 2064 7479  e(values[0], dty
-0002d100: 7065 3d64 7479 7065 2c20 7368 6170 653d  pe=dtype, shape=
-0002d110: 7368 6170 6529 0a0a 2020 2020 696e 6420  shape)..    ind 
-0002d120: 3d20 5b73 6c69 6365 284e 6f6e 652c 204e  = [slice(None, N
-0002d130: 6f6e 6529 2066 6f72 2069 2069 6e20 7261  one) for i in ra
-0002d140: 6e67 6528 782e 6e64 696d 295d 0a20 2020  nge(x.ndim)].   
-0002d150: 2066 6f72 206c 6f63 2c20 7661 6c20 696e   for loc, val in
-0002d160: 207a 6970 286c 6f63 6174 696f 6e73 2c20   zip(locations, 
-0002d170: 7661 6c75 6573 293a 0a20 2020 2020 2020  values):.       
-0002d180: 2069 6e64 5b30 5d20 3d20 6c6f 630a 2020   ind[0] = loc.  
-0002d190: 2020 2020 2020 785b 7475 706c 6528 696e        x[tuple(in
-0002d1a0: 6429 5d20 3d20 7661 6c0a 0a20 2020 2072  d)] = val..    r
-0002d1b0: 6574 7572 6e20 780a 0a0a 6465 6620 746f  eturn x...def to
-0002d1c0: 5f6e 7079 5f73 7461 636b 2864 6972 6e61  _npy_stack(dirna
-0002d1d0: 6d65 2c20 782c 2061 7869 733d 3029 3a0a  me, x, axis=0):.
-0002d1e0: 2020 2020 2222 2257 7269 7465 2064 6173      """Write das
-0002d1f0: 6b20 6172 7261 7920 746f 2061 2073 7461  k array to a sta
-0002d200: 636b 206f 6620 2e6e 7079 2066 696c 6573  ck of .npy files
-0002d210: 0a0a 2020 2020 5468 6973 2070 6172 7469  ..    This parti
-0002d220: 7469 6f6e 7320 7468 6520 6461 736b 2e61  tions the dask.a
-0002d230: 7272 6179 2061 6c6f 6e67 206f 6e65 2061  rray along one a
-0002d240: 7869 7320 616e 6420 7374 6f72 6573 2065  xis and stores e
-0002d250: 6163 6820 626c 6f63 6b20 616c 6f6e 670a  ach block along.
-0002d260: 2020 2020 7468 6174 2061 7869 7320 6173      that axis as
-0002d270: 2061 2073 696e 676c 6520 2e6e 7079 2066   a single .npy f
-0002d280: 696c 6520 696e 2074 6865 2073 7065 6369  ile in the speci
-0002d290: 6669 6564 2064 6972 6563 746f 7279 0a0a  fied directory..
-0002d2a0: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
-0002d2b0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e   --------.    >>
-0002d2c0: 3e20 7820 3d20 6461 2e6f 6e65 7328 2835  > x = da.ones((5
-0002d2d0: 2c20 3130 2c20 3130 292c 2063 6875 6e6b  , 10, 10), chunk
-0002d2e0: 733d 2832 2c20 342c 2034 2929 2020 2320  s=(2, 4, 4))  # 
-0002d2f0: 646f 6374 6573 743a 202b 534b 4950 0a20  doctest: +SKIP. 
-0002d300: 2020 203e 3e3e 2064 612e 746f 5f6e 7079     >>> da.to_npy
-0002d310: 5f73 7461 636b 2827 6461 7461 2f27 2c20  _stack('data/', 
-0002d320: 782c 2061 7869 733d 3029 2020 2320 646f  x, axis=0)  # do
-0002d330: 6374 6573 743a 202b 534b 4950 0a0a 2020  ctest: +SKIP..  
-0002d340: 2020 5468 6520 6060 2e6e 7079 6060 2066    The ``.npy`` f
-0002d350: 696c 6573 2073 746f 7265 206e 756d 7079  iles store numpy
-0002d360: 2061 7272 6179 7320 666f 7220 6060 785b   arrays for ``x[
-0002d370: 303a 325d 2c20 785b 323a 345d 2c20 616e  0:2], x[2:4], an
-0002d380: 6420 785b 343a 355d 6060 0a20 2020 2072  d x[4:5]``.    r
-0002d390: 6573 7065 6374 6976 656c 792c 2061 7320  espectively, as 
-0002d3a0: 6973 2073 7065 6369 6669 6564 2062 7920  is specified by 
-0002d3b0: 7468 6520 6368 756e 6b20 7369 7a65 2061  the chunk size a
-0002d3c0: 6c6f 6e67 2074 6865 207a 6572 6f74 6820  long the zeroth 
-0002d3d0: 6178 6973 3a3a 0a0a 2020 2020 2020 2020  axis::..        
-0002d3e0: 2420 7472 6565 2064 6174 612f 0a20 2020  $ tree data/.   
-0002d3f0: 2020 2020 2064 6174 612f 0a20 2020 2020       data/.     
-0002d400: 2020 207c 2d2d 2030 2e6e 7079 0a20 2020     |-- 0.npy.   
-0002d410: 2020 2020 207c 2d2d 2031 2e6e 7079 0a20       |-- 1.npy. 
-0002d420: 2020 2020 2020 207c 2d2d 2032 2e6e 7079         |-- 2.npy
-0002d430: 0a20 2020 2020 2020 207c 2d2d 2069 6e66  .        |-- inf
-0002d440: 6f0a 0a20 2020 2054 6865 2060 6069 6e66  o..    The ``inf
-0002d450: 6f60 6020 6669 6c65 2073 746f 7265 7320  o`` file stores 
-0002d460: 7468 6520 6474 7970 652c 2063 6875 6e6b  the dtype, chunk
-0002d470: 732c 2061 6e64 2061 7869 7320 696e 666f  s, and axis info
-0002d480: 726d 6174 696f 6e20 6f66 2074 6865 2061  rmation of the a
-0002d490: 7272 6179 2e0a 2020 2020 596f 7520 6361  rray..    You ca
-0002d4a0: 6e20 6c6f 6164 2074 6865 7365 2073 7461  n load these sta
-0002d4b0: 636b 7320 7769 7468 2074 6865 203a 6675  cks with the :fu
-0002d4c0: 6e63 3a60 6461 736b 2e61 7272 6179 2e66  nc:`dask.array.f
-0002d4d0: 726f 6d5f 6e70 795f 7374 6163 6b60 2066  rom_npy_stack` f
-0002d4e0: 756e 6374 696f 6e2e 0a0a 2020 2020 3e3e  unction...    >>
-0002d4f0: 3e20 7920 3d20 6461 2e66 726f 6d5f 6e70  > y = da.from_np
-0002d500: 795f 7374 6163 6b28 2764 6174 612f 2729  y_stack('data/')
-0002d510: 2020 2320 646f 6374 6573 743a 202b 534b    # doctest: +SK
-0002d520: 4950 0a0a 2020 2020 5365 6520 416c 736f  IP..    See Also
-0002d530: 0a20 2020 202d 2d2d 2d2d 2d2d 2d0a 2020  .    --------.  
-0002d540: 2020 6672 6f6d 5f6e 7079 5f73 7461 636b    from_npy_stack
-0002d550: 0a20 2020 2022 2222 0a0a 2020 2020 6368  .    """..    ch
-0002d560: 756e 6b73 203d 2074 7570 6c65 2828 6320  unks = tuple((c 
-0002d570: 6966 2069 203d 3d20 6178 6973 2065 6c73  if i == axis els
-0002d580: 6520 2873 756d 2863 292c 2929 2066 6f72  e (sum(c),)) for
-0002d590: 2069 2c20 6320 696e 2065 6e75 6d65 7261   i, c in enumera
-0002d5a0: 7465 2878 2e63 6875 6e6b 7329 290a 2020  te(x.chunks)).  
-0002d5b0: 2020 7878 203d 2078 2e72 6563 6875 6e6b    xx = x.rechunk
-0002d5c0: 2863 6875 6e6b 7329 0a0a 2020 2020 6966  (chunks)..    if
-0002d5d0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-0002d5e0: 7374 7328 6469 726e 616d 6529 3a0a 2020  sts(dirname):.  
-0002d5f0: 2020 2020 2020 6f73 2e6d 6b64 6972 2864        os.mkdir(d
-0002d600: 6972 6e61 6d65 290a 0a20 2020 206d 6574  irname)..    met
-0002d610: 6120 3d20 7b22 6368 756e 6b73 223a 2063  a = {"chunks": c
-0002d620: 6875 6e6b 732c 2022 6474 7970 6522 3a20  hunks, "dtype": 
-0002d630: 782e 6474 7970 652c 2022 6178 6973 223a  x.dtype, "axis":
-0002d640: 2061 7869 737d 0a0a 2020 2020 7769 7468   axis}..    with
-0002d650: 206f 7065 6e28 6f73 2e70 6174 682e 6a6f   open(os.path.jo
-0002d660: 696e 2864 6972 6e61 6d65 2c20 2269 6e66  in(dirname, "inf
-0002d670: 6f22 292c 2022 7762 2229 2061 7320 663a  o"), "wb") as f:
-0002d680: 0a20 2020 2020 2020 2070 6963 6b6c 652e  .        pickle.
-0002d690: 6475 6d70 286d 6574 612c 2066 290a 0a20  dump(meta, f).. 
-0002d6a0: 2020 206e 616d 6520 3d20 2274 6f2d 6e70     name = "to-np
-0002d6b0: 792d 7374 6163 6b2d 2220 2b20 7374 7228  y-stack-" + str(
-0002d6c0: 7575 6964 2e75 7569 6431 2829 290a 2020  uuid.uuid1()).  
-0002d6d0: 2020 6473 6b20 3d20 7b0a 2020 2020 2020    dsk = {.      
-0002d6e0: 2020 286e 616d 652c 2069 293a 2028 6e70    (name, i): (np
-0002d6f0: 2e73 6176 652c 206f 732e 7061 7468 2e6a  .save, os.path.j
-0002d700: 6f69 6e28 6469 726e 616d 652c 2022 2564  oin(dirname, "%d
-0002d710: 2e6e 7079 2220 2520 6929 2c20 6b65 7929  .npy" % i), key)
-0002d720: 0a20 2020 2020 2020 2066 6f72 2069 2c20  .        for i, 
-0002d730: 6b65 7920 696e 2065 6e75 6d65 7261 7465  key in enumerate
-0002d740: 2863 6f72 652e 666c 6174 7465 6e28 7878  (core.flatten(xx
-0002d750: 2e5f 5f64 6173 6b5f 6b65 7973 5f5f 2829  .__dask_keys__()
-0002d760: 2929 0a20 2020 207d 0a0a 2020 2020 6772  )).    }..    gr
-0002d770: 6170 6820 3d20 4869 6768 4c65 7665 6c47  aph = HighLevelG
-0002d780: 7261 7068 2e66 726f 6d5f 636f 6c6c 6563  raph.from_collec
-0002d790: 7469 6f6e 7328 6e61 6d65 2c20 6473 6b2c  tions(name, dsk,
-0002d7a0: 2064 6570 656e 6465 6e63 6965 733d 5b78   dependencies=[x
-0002d7b0: 785d 290a 2020 2020 636f 6d70 7574 655f  x]).    compute_
-0002d7c0: 6173 5f69 665f 636f 6c6c 6563 7469 6f6e  as_if_collection
-0002d7d0: 2841 7272 6179 2c20 6772 6170 682c 206c  (Array, graph, l
-0002d7e0: 6973 7428 6473 6b29 290a 0a0a 6465 6620  ist(dsk))...def 
-0002d7f0: 6672 6f6d 5f6e 7079 5f73 7461 636b 2864  from_npy_stack(d
-0002d800: 6972 6e61 6d65 2c20 6d6d 6170 5f6d 6f64  irname, mmap_mod
-0002d810: 653d 2272 2229 3a0a 2020 2020 2222 224c  e="r"):.    """L
-0002d820: 6f61 6420 6461 736b 2061 7272 6179 2066  oad dask array f
-0002d830: 726f 6d20 7374 6163 6b20 6f66 206e 7079  rom stack of npy
-0002d840: 2066 696c 6573 0a0a 2020 2020 5061 7261   files..    Para
-0002d850: 6d65 7465 7273 0a20 2020 202d 2d2d 2d2d  meters.    -----
-0002d860: 2d2d 2d2d 2d0a 2020 2020 6469 726e 616d  -----.    dirnam
-0002d870: 653a 2073 7472 696e 670a 2020 2020 2020  e: string.      
-0002d880: 2020 4469 7265 6374 6f72 7920 6f66 202e    Directory of .
-0002d890: 6e70 7920 6669 6c65 730a 2020 2020 6d6d  npy files.    mm
-0002d8a0: 6170 5f6d 6f64 653a 2028 4e6f 6e65 206f  ap_mode: (None o
-0002d8b0: 7220 2772 2729 0a20 2020 2020 2020 2052  r 'r').        R
-0002d8c0: 6561 6420 6461 7461 2069 6e20 6d65 6d6f  ead data in memo
-0002d8d0: 7279 206d 6170 206d 6f64 650a 0a20 2020  ry map mode..   
-0002d8e0: 2053 6565 2041 6c73 6f0a 2020 2020 2d2d   See Also.    --
-0002d8f0: 2d2d 2d2d 2d2d 0a20 2020 2074 6f5f 6e70  ------.    to_np
-0002d900: 795f 7374 6163 6b0a 2020 2020 2222 220a  y_stack.    """.
-0002d910: 2020 2020 7769 7468 206f 7065 6e28 6f73      with open(os
-0002d920: 2e70 6174 682e 6a6f 696e 2864 6972 6e61  .path.join(dirna
-0002d930: 6d65 2c20 2269 6e66 6f22 292c 2022 7262  me, "info"), "rb
-0002d940: 2229 2061 7320 663a 0a20 2020 2020 2020  ") as f:.       
-0002d950: 2069 6e66 6f20 3d20 7069 636b 6c65 2e6c   info = pickle.l
-0002d960: 6f61 6428 6629 0a0a 2020 2020 6474 7970  oad(f)..    dtyp
-0002d970: 6520 3d20 696e 666f 5b22 6474 7970 6522  e = info["dtype"
-0002d980: 5d0a 2020 2020 6368 756e 6b73 203d 2069  ].    chunks = i
-0002d990: 6e66 6f5b 2263 6875 6e6b 7322 5d0a 2020  nfo["chunks"].  
-0002d9a0: 2020 6178 6973 203d 2069 6e66 6f5b 2261    axis = info["a
-0002d9b0: 7869 7322 5d0a 0a20 2020 206e 616d 6520  xis"]..    name 
-0002d9c0: 3d20 2266 726f 6d2d 6e70 792d 7374 6163  = "from-npy-stac
-0002d9d0: 6b2d 2573 2220 2520 6469 726e 616d 650a  k-%s" % dirname.
-0002d9e0: 2020 2020 6b65 7973 203d 206c 6973 7428      keys = list(
-0002d9f0: 7072 6f64 7563 7428 5b6e 616d 655d 2c20  product([name], 
-0002da00: 2a5b 7261 6e67 6528 6c65 6e28 6329 2920  *[range(len(c)) 
-0002da10: 666f 7220 6320 696e 2063 6875 6e6b 735d  for c in chunks]
-0002da20: 2929 0a20 2020 2076 616c 7565 7320 3d20  )).    values = 
-0002da30: 5b0a 2020 2020 2020 2020 286e 702e 6c6f  [.        (np.lo
-0002da40: 6164 2c20 6f73 2e70 6174 682e 6a6f 696e  ad, os.path.join
-0002da50: 2864 6972 6e61 6d65 2c20 2225 642e 6e70  (dirname, "%d.np
-0002da60: 7922 2025 2069 292c 206d 6d61 705f 6d6f  y" % i), mmap_mo
-0002da70: 6465 290a 2020 2020 2020 2020 666f 7220  de).        for 
-0002da80: 6920 696e 2072 616e 6765 286c 656e 2863  i in range(len(c
-0002da90: 6875 6e6b 735b 6178 6973 5d29 290a 2020  hunks[axis])).  
-0002daa0: 2020 5d0a 2020 2020 6473 6b20 3d20 6469    ].    dsk = di
-0002dab0: 6374 287a 6970 286b 6579 732c 2076 616c  ct(zip(keys, val
-0002dac0: 7565 7329 290a 0a20 2020 2072 6574 7572  ues))..    retur
-0002dad0: 6e20 4172 7261 7928 6473 6b2c 206e 616d  n Array(dsk, nam
-0002dae0: 652c 2063 6875 6e6b 732c 2064 7479 7065  e, chunks, dtype
-0002daf0: 290a 0a0a 6465 6620 6e65 775f 6461 5f6f  )...def new_da_o
-0002db00: 626a 6563 7428 6473 6b2c 206e 616d 652c  bject(dsk, name,
-0002db10: 2063 6875 6e6b 732c 206d 6574 613d 4e6f   chunks, meta=No
-0002db20: 6e65 2c20 6474 7970 653d 4e6f 6e65 293a  ne, dtype=None):
-0002db30: 0a20 2020 2022 2222 4765 6e65 7269 6320  .    """Generic 
-0002db40: 636f 6e73 7472 7563 746f 7220 666f 7220  constructor for 
-0002db50: 6461 736b 2e61 7272 6179 206f 7220 6461  dask.array or da
-0002db60: 736b 2e64 6174 6166 7261 6d65 206f 626a  sk.dataframe obj
-0002db70: 6563 7473 2e0a 0a20 2020 2044 6563 6964  ects...    Decid
-0002db80: 6573 2074 6865 2061 7070 726f 7072 6961  es the appropria
-0002db90: 7465 206f 7574 7075 7420 636c 6173 7320  te output class 
-0002dba0: 6261 7365 6420 6f6e 2074 6865 2074 7970  based on the typ
-0002dbb0: 6520 6f66 2060 6d65 7461 6020 7072 6f76  e of `meta` prov
-0002dbc0: 6964 6564 2e0a 2020 2020 2222 220a 2020  ided..    """.  
-0002dbd0: 2020 6966 2069 735f 6461 7461 6672 616d    if is_datafram
-0002dbe0: 655f 6c69 6b65 286d 6574 6129 206f 7220  e_like(meta) or 
-0002dbf0: 6973 5f73 6572 6965 735f 6c69 6b65 286d  is_series_like(m
-0002dc00: 6574 6129 206f 7220 6973 5f69 6e64 6578  eta) or is_index
-0002dc10: 5f6c 696b 6528 6d65 7461 293a 0a20 2020  _like(meta):.   
-0002dc20: 2020 2020 2066 726f 6d20 6461 736b 2e64       from dask.d
-0002dc30: 6174 6166 7261 6d65 2e63 6f72 6520 696d  ataframe.core im
-0002dc40: 706f 7274 206e 6577 5f64 645f 6f62 6a65  port new_dd_obje
-0002dc50: 6374 0a0a 2020 2020 2020 2020 6173 7365  ct..        asse
-0002dc60: 7274 2061 6c6c 286c 656e 2863 2920 3d3d  rt all(len(c) ==
-0002dc70: 2031 2066 6f72 2063 2069 6e20 6368 756e   1 for c in chun
-0002dc80: 6b73 5b31 3a5d 290a 2020 2020 2020 2020  ks[1:]).        
-0002dc90: 6469 7669 7369 6f6e 7320 3d20 5b4e 6f6e  divisions = [Non
-0002dca0: 655d 202a 2028 6c65 6e28 6368 756e 6b73  e] * (len(chunks
-0002dcb0: 5b30 5d29 202b 2031 290a 2020 2020 2020  [0]) + 1).      
-0002dcc0: 2020 7265 7475 726e 206e 6577 5f64 645f    return new_dd_
-0002dcd0: 6f62 6a65 6374 2864 736b 2c20 6e61 6d65  object(dsk, name
-0002dce0: 2c20 6d65 7461 2c20 6469 7669 7369 6f6e  , meta, division
-0002dcf0: 7329 0a20 2020 2065 6c73 653a 0a20 2020  s).    else:.   
-0002dd00: 2020 2020 2072 6574 7572 6e20 4172 7261       return Arra
-0002dd10: 7928 6473 6b2c 206e 616d 653d 6e61 6d65  y(dsk, name=name
-0002dd20: 2c20 6368 756e 6b73 3d63 6875 6e6b 732c  , chunks=chunks,
-0002dd30: 206d 6574 613d 6d65 7461 2c20 6474 7970   meta=meta, dtyp
-0002dd40: 653d 6474 7970 6529 0a0a 0a63 6c61 7373  e=dtype)...class
-0002dd50: 2042 6c6f 636b 5669 6577 3a0a 2020 2020   BlockView:.    
-0002dd60: 2222 2241 6e20 6172 7261 792d 6c69 6b65  """An array-like
-0002dd70: 2069 6e74 6572 6661 6365 2074 6f20 7468   interface to th
-0002dd80: 6520 626c 6f63 6b73 206f 6620 616e 2061  e blocks of an a
-0002dd90: 7272 6179 2e0a 0a20 2020 2060 6042 6c6f  rray...    ``Blo
-0002dda0: 636b 5669 6577 6060 2070 726f 7669 6465  ckView`` provide
-0002ddb0: 7320 616e 2061 7272 6179 2d6c 696b 6520  s an array-like 
-0002ddc0: 696e 7465 7266 6163 650a 2020 2020 746f  interface.    to
-0002ddd0: 2074 6865 2062 6c6f 636b 7320 6f66 2061   the blocks of a
-0002dde0: 2064 6173 6b20 6172 7261 792e 2020 4e75   dask array.  Nu
-0002ddf0: 6d70 792d 7374 796c 6520 696e 6465 7869  mpy-style indexi
-0002de00: 6e67 206f 6620 610a 2020 2020 2060 6042  ng of a.     ``B
-0002de10: 6c6f 636b 5669 6577 6060 2072 6574 7572  lockView`` retur
-0002de20: 6e73 2061 2073 656c 6563 7469 6f6e 206f  ns a selection o
-0002de30: 6620 626c 6f63 6b73 2061 7320 6120 6e65  f blocks as a ne
-0002de40: 7720 6461 736b 2061 7272 6179 2e0a 0a20  w dask array... 
-0002de50: 2020 2059 6f75 2063 616e 2069 6e64 6578     You can index
-0002de60: 2060 6042 6c6f 636b 5669 6577 6060 206c   ``BlockView`` l
-0002de70: 696b 6520 6120 6e75 6d70 7920 6172 7261  ike a numpy arra
-0002de80: 7920 6f66 2073 6861 7065 0a20 2020 2065  y of shape.    e
-0002de90: 7175 616c 2074 6f20 7468 6520 6e75 6d62  qual to the numb
-0002dea0: 6572 206f 6620 626c 6f63 6b73 2069 6e20  er of blocks in 
-0002deb0: 6561 6368 2064 696d 656e 7369 6f6e 2c20  each dimension, 
-0002dec0: 2861 7661 696c 6162 6c65 2061 730a 2020  (available as.  
-0002ded0: 2020 6172 7261 792e 626c 6f63 6b73 2e73    array.blocks.s
-0002dee0: 697a 6529 2e20 2054 6865 2064 696d 656e  ize).  The dimen
-0002def0: 7369 6f6e 616c 6974 7920 6f66 2074 6865  sionality of the
-0002df00: 206f 7574 7075 7420 6172 7261 7920 6d61   output array ma
-0002df10: 7463 6865 730a 2020 2020 7468 6520 6469  tches.    the di
-0002df20: 6d65 6e73 696f 6e20 6f66 2074 6869 7320  mension of this 
-0002df30: 6172 7261 792c 2065 7665 6e20 6966 2069  array, even if i
-0002df40: 6e74 6567 6572 2069 6e64 6963 6573 2061  nteger indices a
-0002df50: 7265 2070 6173 7365 642e 0a20 2020 2053  re passed..    S
-0002df60: 6c69 6369 6e67 2077 6974 6820 6060 6e70  licing with ``np
-0002df70: 2e6e 6577 6178 6973 6060 206f 7220 6d75  .newaxis`` or mu
-0002df80: 6c74 6970 6c65 206c 6973 7473 2069 7320  ltiple lists is 
-0002df90: 6e6f 7420 7375 7070 6f72 7465 642e 0a0a  not supported...
-0002dfa0: 2020 2020 4578 616d 706c 6573 0a20 2020      Examples.   
-0002dfb0: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 3e3e   --------.    >>
-0002dfc0: 3e20 696d 706f 7274 2064 6173 6b2e 6172  > import dask.ar
-0002dfd0: 7261 7920 6173 2064 610a 2020 2020 3e3e  ray as da.    >>
-0002dfe0: 3e20 6672 6f6d 2064 6173 6b2e 6172 7261  > from dask.arra
-0002dff0: 792e 636f 7265 2069 6d70 6f72 7420 426c  y.core import Bl
-0002e000: 6f63 6b56 6965 770a 2020 2020 3e3e 3e20  ockView.    >>> 
-0002e010: 7820 3d20 6461 2e61 7261 6e67 6528 382c  x = da.arange(8,
-0002e020: 2063 6875 6e6b 733d 3229 0a20 2020 203e   chunks=2).    >
-0002e030: 3e3e 2062 7620 3d20 426c 6f63 6b56 6965  >> bv = BlockVie
-0002e040: 7728 7829 0a20 2020 203e 3e3e 2062 762e  w(x).    >>> bv.
-0002e050: 7368 6170 6520 2320 616c 6961 7365 7320  shape # aliases 
-0002e060: 782e 6e75 6d62 6c6f 636b 730a 2020 2020  x.numblocks.    
-0002e070: 2834 2c29 0a20 2020 203e 3e3e 2062 762e  (4,).    >>> bv.
-0002e080: 7369 7a65 0a20 2020 2034 0a20 2020 203e  size.    4.    >
-0002e090: 3e3e 2062 765b 305d 2e63 6f6d 7075 7465  >> bv[0].compute
-0002e0a0: 2829 0a20 2020 2061 7272 6179 285b 302c  ().    array([0,
-0002e0b0: 2031 5d29 0a20 2020 203e 3e3e 2062 765b   1]).    >>> bv[
-0002e0c0: 3a33 5d2e 636f 6d70 7574 6528 290a 2020  :3].compute().  
-0002e0d0: 2020 6172 7261 7928 5b30 2c20 312c 2032    array([0, 1, 2
-0002e0e0: 2c20 332c 2034 2c20 355d 290a 2020 2020  , 3, 4, 5]).    
-0002e0f0: 3e3e 3e20 6276 5b3a 3a32 5d2e 636f 6d70  >>> bv[::2].comp
-0002e100: 7574 6528 290a 2020 2020 6172 7261 7928  ute().    array(
-0002e110: 5b30 2c20 312c 2034 2c20 355d 290a 2020  [0, 1, 4, 5]).  
-0002e120: 2020 3e3e 3e20 6276 5b5b 2d31 2c20 305d    >>> bv[[-1, 0]
-0002e130: 5d2e 636f 6d70 7574 6528 290a 2020 2020  ].compute().    
-0002e140: 6172 7261 7928 5b36 2c20 372c 2030 2c20  array([6, 7, 0, 
-0002e150: 315d 290a 2020 2020 3e3e 3e20 6276 2e72  1]).    >>> bv.r
-0002e160: 6176 656c 2829 2020 2320 646f 6374 6573  avel()  # doctes
-0002e170: 743a 202b 4e4f 524d 414c 495a 455f 5748  t: +NORMALIZE_WH
-0002e180: 4954 4553 5041 4345 0a20 2020 205b 6461  ITESPACE.    [da
-0002e190: 736b 2e61 7272 6179 3c62 6c6f 636b 732c  sk.array<blocks,
-0002e1a0: 2073 6861 7065 3d28 322c 292c 2064 7479   shape=(2,), dty
-0002e1b0: 7065 3d69 6e74 3634 2c20 6368 756e 6b73  pe=int64, chunks
-0002e1c0: 697a 653d 2832 2c29 2c20 6368 756e 6b74  ize=(2,), chunkt
-0002e1d0: 7970 653d 6e75 6d70 792e 6e64 6172 7261  ype=numpy.ndarra
-0002e1e0: 793e 2c0a 2020 2020 2064 6173 6b2e 6172  y>,.     dask.ar
-0002e1f0: 7261 793c 626c 6f63 6b73 2c20 7368 6170  ray<blocks, shap
-0002e200: 653d 2832 2c29 2c20 6474 7970 653d 696e  e=(2,), dtype=in
-0002e210: 7436 342c 2063 6875 6e6b 7369 7a65 3d28  t64, chunksize=(
-0002e220: 322c 292c 2063 6875 6e6b 7479 7065 3d6e  2,), chunktype=n
-0002e230: 756d 7079 2e6e 6461 7272 6179 3e2c 0a20  umpy.ndarray>,. 
-0002e240: 2020 2020 6461 736b 2e61 7272 6179 3c62      dask.array<b
-0002e250: 6c6f 636b 732c 2073 6861 7065 3d28 322c  locks, shape=(2,
-0002e260: 292c 2064 7479 7065 3d69 6e74 3634 2c20  ), dtype=int64, 
-0002e270: 6368 756e 6b73 697a 653d 2832 2c29 2c20  chunksize=(2,), 
-0002e280: 6368 756e 6b74 7970 653d 6e75 6d70 792e  chunktype=numpy.
-0002e290: 6e64 6172 7261 793e 2c0a 2020 2020 2064  ndarray>,.     d
-0002e2a0: 6173 6b2e 6172 7261 793c 626c 6f63 6b73  ask.array<blocks
-0002e2b0: 2c20 7368 6170 653d 2832 2c29 2c20 6474  , shape=(2,), dt
-0002e2c0: 7970 653d 696e 7436 342c 2063 6875 6e6b  ype=int64, chunk
-0002e2d0: 7369 7a65 3d28 322c 292c 2063 6875 6e6b  size=(2,), chunk
-0002e2e0: 7479 7065 3d6e 756d 7079 2e6e 6461 7272  type=numpy.ndarr
-0002e2f0: 6179 3e5d 0a0a 2020 2020 5265 7475 726e  ay>]..    Return
-0002e300: 730a 2020 2020 2d2d 2d2d 2d2d 2d0a 2020  s.    -------.  
-0002e310: 2020 416e 2069 6e73 7461 6e63 6520 6f66    An instance of
-0002e320: 2060 6064 612e 6172 7261 792e 426c 6f63   ``da.array.Bloc
-0002e330: 6b76 6965 7760 600a 2020 2020 2222 220a  kview``.    """.
-0002e340: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-0002e350: 5f28 7365 6c66 2c20 6172 7261 793a 2041  _(self, array: A
-0002e360: 7272 6179 293a 0a20 2020 2020 2020 2073  rray):.        s
-0002e370: 656c 662e 5f61 7272 6179 203d 2061 7272  elf._array = arr
-0002e380: 6179 0a0a 2020 2020 6465 6620 5f5f 6765  ay..    def __ge
-0002e390: 7469 7465 6d5f 5f28 7365 6c66 2c20 696e  titem__(self, in
-0002e3a0: 6465 783a 2041 6e79 2920 2d3e 2041 7272  dex: Any) -> Arr
-0002e3b0: 6179 3a0a 2020 2020 2020 2020 6672 6f6d  ay:.        from
-0002e3c0: 2064 6173 6b2e 6172 7261 792e 736c 6963   dask.array.slic
-0002e3d0: 696e 6720 696d 706f 7274 206e 6f72 6d61  ing import norma
-0002e3e0: 6c69 7a65 5f69 6e64 6578 0a0a 2020 2020  lize_index..    
-0002e3f0: 2020 2020 6966 206e 6f74 2069 7369 6e73      if not isins
-0002e400: 7461 6e63 6528 696e 6465 782c 2074 7570  tance(index, tup
-0002e410: 6c65 293a 0a20 2020 2020 2020 2020 2020  le):.           
-0002e420: 2069 6e64 6578 203d 2028 696e 6465 782c   index = (index,
-0002e430: 290a 2020 2020 2020 2020 6966 2073 756d  ).        if sum
-0002e440: 2869 7369 6e73 7461 6e63 6528 696e 642c  (isinstance(ind,
-0002e450: 2028 6e70 2e6e 6461 7272 6179 2c20 6c69   (np.ndarray, li
-0002e460: 7374 2929 2066 6f72 2069 6e64 2069 6e20  st)) for ind in 
-0002e470: 696e 6465 7829 203e 2031 3a0a 2020 2020  index) > 1:.    
-0002e480: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002e490: 6c75 6545 7272 6f72 2822 4361 6e20 6f6e  lueError("Can on
-0002e4a0: 6c79 2073 6c69 6365 2077 6974 6820 6120  ly slice with a 
-0002e4b0: 7369 6e67 6c65 206c 6973 7422 290a 2020  single list").  
-0002e4c0: 2020 2020 2020 6966 2061 6e79 2869 6e64        if any(ind
-0002e4d0: 2069 7320 4e6f 6e65 2066 6f72 2069 6e64   is None for ind
-0002e4e0: 2069 6e20 696e 6465 7829 3a0a 2020 2020   in index):.    
-0002e4f0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0002e500: 6c75 6545 7272 6f72 2822 536c 6963 696e  lueError("Slicin
-0002e510: 6720 7769 7468 206e 702e 6e65 7761 7869  g with np.newaxi
-0002e520: 7320 6f72 204e 6f6e 6520 6973 206e 6f74  s or None is not
-0002e530: 2073 7570 706f 7274 6564 2229 0a20 2020   supported").   
-0002e540: 2020 2020 2069 6e64 6578 203d 206e 6f72       index = nor
-0002e550: 6d61 6c69 7a65 5f69 6e64 6578 2869 6e64  malize_index(ind
-0002e560: 6578 2c20 7365 6c66 2e5f 6172 7261 792e  ex, self._array.
-0002e570: 6e75 6d62 6c6f 636b 7329 0a20 2020 2020  numblocks).     
-0002e580: 2020 2069 6e64 6578 203d 2074 7570 6c65     index = tuple
-0002e590: 280a 2020 2020 2020 2020 2020 2020 736c  (.            sl
-0002e5a0: 6963 6528 6b2c 206b 202b 2031 2920 6966  ice(k, k + 1) if
-0002e5b0: 2069 7369 6e73 7461 6e63 6528 6b2c 204e   isinstance(k, N
-0002e5c0: 756d 6265 7229 2065 6c73 6520 6b20 2023  umber) else k  #
-0002e5d0: 2074 7970 653a 2069 676e 6f72 650a 2020   type: ignore.  
-0002e5e0: 2020 2020 2020 2020 2020 666f 7220 6b20            for k 
-0002e5f0: 696e 2069 6e64 6578 0a20 2020 2020 2020  in index.       
-0002e600: 2029 0a0a 2020 2020 2020 2020 6e61 6d65   )..        name
-0002e610: 203d 2022 626c 6f63 6b73 2d22 202b 2074   = "blocks-" + t
-0002e620: 6f6b 656e 697a 6528 7365 6c66 2e5f 6172  okenize(self._ar
-0002e630: 7261 792c 2069 6e64 6578 290a 0a20 2020  ray, index)..   
-0002e640: 2020 2020 206e 6577 5f6b 6579 7320 3d20       new_keys = 
-0002e650: 7365 6c66 2e5f 6172 7261 792e 5f6b 6579  self._array._key
-0002e660: 5f61 7272 6179 5b69 6e64 6578 5d0a 0a20  _array[index].. 
-0002e670: 2020 2020 2020 2063 6875 6e6b 7320 3d20         chunks = 
-0002e680: 7475 706c 6528 0a20 2020 2020 2020 2020  tuple(.         
-0002e690: 2020 2074 7570 6c65 286e 702e 6172 7261     tuple(np.arra
-0002e6a0: 7928 6329 5b69 5d2e 746f 6c69 7374 2829  y(c)[i].tolist()
-0002e6b0: 2920 666f 7220 632c 2069 2069 6e20 7a69  ) for c, i in zi
-0002e6c0: 7028 7365 6c66 2e5f 6172 7261 792e 6368  p(self._array.ch
-0002e6d0: 756e 6b73 2c20 696e 6465 7829 0a20 2020  unks, index).   
-0002e6e0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0002e6f0: 6b65 7973 203d 2070 726f 6475 6374 282a  keys = product(*
-0002e700: 2872 616e 6765 286c 656e 2863 2929 2066  (range(len(c)) f
-0002e710: 6f72 2063 2069 6e20 6368 756e 6b73 2929  or c in chunks))
-0002e720: 0a0a 2020 2020 2020 2020 6772 6170 683a  ..        graph:
-0002e730: 2047 7261 7068 203d 207b 286e 616d 652c   Graph = {(name,
-0002e740: 2920 2b20 6b65 793a 2074 7570 6c65 286e  ) + key: tuple(n
-0002e750: 6577 5f6b 6579 735b 6b65 795d 2e74 6f6c  ew_keys[key].tol
-0002e760: 6973 7428 2929 2066 6f72 206b 6579 2069  ist()) for key i
-0002e770: 6e20 6b65 7973 7d0a 0a20 2020 2020 2020  n keys}..       
-0002e780: 2068 6c67 203d 2048 6967 684c 6576 656c   hlg = HighLevel
-0002e790: 4772 6170 682e 6672 6f6d 5f63 6f6c 6c65  Graph.from_colle
-0002e7a0: 6374 696f 6e73 286e 616d 652c 2067 7261  ctions(name, gra
-0002e7b0: 7068 2c20 6465 7065 6e64 656e 6369 6573  ph, dependencies
-0002e7c0: 3d5b 7365 6c66 2e5f 6172 7261 795d 290a  =[self._array]).
-0002e7d0: 2020 2020 2020 2020 7265 7475 726e 2041          return A
-0002e7e0: 7272 6179 2868 6c67 2c20 6e61 6d65 2c20  rray(hlg, name, 
-0002e7f0: 6368 756e 6b73 2c20 6d65 7461 3d73 656c  chunks, meta=sel
-0002e800: 662e 5f61 7272 6179 290a 0a20 2020 2064  f._array)..    d
-0002e810: 6566 205f 5f65 715f 5f28 7365 6c66 2c20  ef __eq__(self, 
-0002e820: 6f74 6865 723a 2041 6e79 2920 2d3e 2062  other: Any) -> b
-0002e830: 6f6f 6c3a 0a20 2020 2020 2020 2069 6620  ool:.        if 
-0002e840: 6973 696e 7374 616e 6365 286f 7468 6572  isinstance(other
-0002e850: 2c20 426c 6f63 6b56 6965 7729 3a0a 2020  , BlockView):.  
-0002e860: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0002e870: 2073 656c 662e 5f61 7272 6179 2069 7320   self._array is 
-0002e880: 6f74 6865 722e 5f61 7272 6179 0a20 2020  other._array.   
-0002e890: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0002e8a0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0002e8b0: 7449 6d70 6c65 6d65 6e74 6564 0a0a 2020  tImplemented..  
-0002e8c0: 2020 4070 726f 7065 7274 790a 2020 2020    @property.    
-0002e8d0: 6465 6620 7369 7a65 2873 656c 6629 202d  def size(self) -
-0002e8e0: 3e20 696e 743a 0a20 2020 2020 2020 2022  > int:.        "
-0002e8f0: 2222 0a20 2020 2020 2020 2054 6865 2074  "".        The t
-0002e900: 6f74 616c 206e 756d 6265 7220 6f66 2062  otal number of b
-0002e910: 6c6f 636b 7320 696e 2074 6865 2061 7272  locks in the arr
-0002e920: 6179 2e0a 2020 2020 2020 2020 2222 220a  ay..        """.
-0002e930: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0002e940: 6174 682e 7072 6f64 2873 656c 662e 7368  ath.prod(self.sh
-0002e950: 6170 6529 0a0a 2020 2020 4070 726f 7065  ape)..    @prope
-0002e960: 7274 790a 2020 2020 6465 6620 7368 6170  rty.    def shap
-0002e970: 6528 7365 6c66 2920 2d3e 2074 7570 6c65  e(self) -> tuple
-0002e980: 5b69 6e74 2c20 2e2e 2e5d 3a0a 2020 2020  [int, ...]:.    
-0002e990: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0002e9a0: 5468 6520 6e75 6d62 6572 206f 6620 626c  The number of bl
-0002e9b0: 6f63 6b73 2070 6572 2061 7869 732e 2041  ocks per axis. A
-0002e9c0: 6c69 6173 206f 6620 6060 6461 736b 2e61  lias of ``dask.a
-0002e9d0: 7272 6179 2e6e 756d 626c 6f63 6b73 6060  rray.numblocks``
-0002e9e0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0002e9f0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
-0002ea00: 662e 5f61 7272 6179 2e6e 756d 626c 6f63  f._array.numbloc
-0002ea10: 6b73 0a0a 2020 2020 6465 6620 7261 7665  ks..    def rave
-0002ea20: 6c28 7365 6c66 2920 2d3e 206c 6973 745b  l(self) -> list[
-0002ea30: 4172 7261 795d 3a0a 2020 2020 2020 2020  Array]:.        
-0002ea40: 2222 220a 2020 2020 2020 2020 5265 7475  """.        Retu
-0002ea50: 726e 2061 2066 6c61 7474 656e 6564 206c  rn a flattened l
-0002ea60: 6973 7420 6f66 2061 6c6c 2074 6865 2062  ist of all the b
-0002ea70: 6c6f 636b 7320 696e 2074 6865 2061 7272  locks in the arr
-0002ea80: 6179 2069 6e20 4320 6f72 6465 722e 0a20  ay in C order.. 
-0002ea90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0002eaa0: 2020 2072 6574 7572 6e20 5b73 656c 665b     return [self[
-0002eab0: 6964 785d 2066 6f72 2069 6478 2069 6e20  idx] for idx in 
-0002eac0: 6e70 2e6e 6469 6e64 6578 2873 656c 662e  np.ndindex(self.
-0002ead0: 7368 6170 6529 5d0a 0a0a 6672 6f6d 2064  shape)]...from d
-0002eae0: 6173 6b2e 6172 7261 792e 626c 6f63 6b77  ask.array.blockw
-0002eaf0: 6973 6520 696d 706f 7274 2062 6c6f 636b  ise import block
-0002eb00: 7769 7365 0a66 726f 6d20 6461 736b 2e61  wise.from dask.a
-0002eb10: 7272 6179 2e75 7469 6c73 2069 6d70 6f72  rray.utils impor
-0002eb20: 7420 636f 6d70 7574 655f 6d65 7461 2c20  t compute_meta, 
-0002eb30: 6d65 7461 5f66 726f 6d5f 6172 7261 790a  meta_from_array.
+0002c750: 2020 2020 2020 2878 2e6e 616d 652c 2920        (x.name,) 
+0002c760: 2b20 696e 7465 726c 6561 7665 5f6e 6f6e  + interleave_non
+0002c770: 6528 6f6b 6579 2c20 6b65 7929 2c0a 2020  e(okey, key),.  
+0002c780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c790: 2020 2020 2020 696e 7465 726c 6561 7665        interleave
+0002c7a0: 5f6e 6f6e 6528 0a20 2020 2020 2020 2020  _none(.         
+0002c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c7c0: 2020 2066 756c 6c5f 736c 6963 6573 2c20     full_slices, 
+0002c7d0: 6c69 7374 287a 6970 282a 706c 7563 6b28  list(zip(*pluck(
+0002c7e0: 322c 2070 6572 5f62 6c6f 636b 5b6b 6579  2, per_block[key
+0002c7f0: 5d29 2929 0a20 2020 2020 2020 2020 2020  ]))).           
+0002c800: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
+0002c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0002c820: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+0002c830: 2020 2020 2020 2020 2020 2061 7869 732c             axis,
+0002c840: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0002c850: 2029 0a20 2020 2020 2020 2020 2020 2064   ).            d
+0002c860: 736b 5b6b 6579 6e61 6d65 2876 696e 6465  sk[keyname(vinde
+0002c870: 785f 6d65 7267 655f 6e61 6d65 2c20 302c  x_merge_name, 0,
+0002c880: 206f 6b65 7929 5d20 3d20 280a 2020 2020   okey)] = (.    
+0002c890: 2020 2020 2020 2020 2020 2020 5f76 696e              _vin
+0002c8a0: 6465 785f 6d65 7267 652c 0a20 2020 2020  dex_merge,.     
+0002c8b0: 2020 2020 2020 2020 2020 205b 6c69 7374             [list
+0002c8c0: 2870 6c75 636b 2830 2c20 7065 725f 626c  (pluck(0, per_bl
+0002c8d0: 6f63 6b5b 6b65 795d 2929 2066 6f72 206b  ock[key])) for k
+0002c8e0: 6579 2069 6e20 7065 725f 626c 6f63 6b5d  ey in per_block]
+0002c8f0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0002c900: 2020 5b6b 6579 6e61 6d65 286e 616d 652c    [keyname(name,
+0002c910: 2069 2c20 6f6b 6579 2920 666f 7220 6920   i, okey) for i 
+0002c920: 696e 2072 616e 6765 286c 656e 2870 6572  in range(len(per
+0002c930: 5f62 6c6f 636b 2929 5d2c 0a20 2020 2020  _block))],.     
+0002c940: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0002c950: 2020 7265 7375 6c74 5f31 6420 3d20 4172    result_1d = Ar
+0002c960: 7261 7928 0a20 2020 2020 2020 2020 2020  ray(.           
+0002c970: 2048 6967 684c 6576 656c 4772 6170 682e   HighLevelGraph.
+0002c980: 6672 6f6d 5f63 6f6c 6c65 6374 696f 6e73  from_collections
+0002c990: 286f 7574 5f6e 616d 652c 2064 736b 2c20  (out_name, dsk, 
+0002c9a0: 6465 7065 6e64 656e 6369 6573 3d5b 785d  dependencies=[x]
+0002c9b0: 292c 0a20 2020 2020 2020 2020 2020 206f  ),.            o
+0002c9c0: 7574 5f6e 616d 652c 0a20 2020 2020 2020  ut_name,.       
+0002c9d0: 2020 2020 2063 6875 6e6b 732c 0a20 2020       chunks,.   
+0002c9e0: 2020 2020 2020 2020 2078 2e64 7479 7065           x.dtype
+0002c9f0: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
+0002ca00: 7461 3d78 2e5f 6d65 7461 2c0a 2020 2020  ta=x._meta,.    
+0002ca10: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+0002ca20: 7475 726e 2072 6573 756c 745f 3164 2e72  turn result_1d.r
+0002ca30: 6573 6861 7065 2862 726f 6164 6361 7374  eshape(broadcast
+0002ca40: 5f73 6861 7065 202b 2072 6573 756c 745f  _shape + result_
+0002ca50: 3164 2e73 6861 7065 5b31 3a5d 290a 0a20  1d.shape[1:]).. 
+0002ca60: 2020 2023 206f 7574 7075 7420 6861 7320     # output has 
+0002ca70: 6120 7a65 726f 2064 696d 656e 7369 6f6e  a zero dimension
+0002ca80: 2c20 6a75 7374 2063 7265 6174 6520 6120  , just create a 
+0002ca90: 6e65 7720 7a65 726f 2d73 6861 7065 2061  new zero-shape a
+0002caa0: 7272 6179 2077 6974 6820 7468 650a 2020  rray with the.  
+0002cab0: 2020 2320 7361 6d65 2064 7479 7065 0a20    # same dtype. 
+0002cac0: 2020 2066 726f 6d20 6461 736b 2e61 7272     from dask.arr
+0002cad0: 6179 2e77 7261 7020 696d 706f 7274 2065  ay.wrap import e
+0002cae0: 6d70 7479 0a0a 2020 2020 7265 7375 6c74  mpty..    result
+0002caf0: 5f31 6420 3d20 656d 7074 7928 0a20 2020  _1d = empty(.   
+0002cb00: 2020 2020 2074 7570 6c65 286d 6170 2873       tuple(map(s
+0002cb10: 756d 2c20 6368 756e 6b73 2929 2c20 6368  um, chunks)), ch
+0002cb20: 756e 6b73 3d63 6875 6e6b 732c 2064 7479  unks=chunks, dty
+0002cb30: 7065 3d78 2e64 7479 7065 2c20 6e61 6d65  pe=x.dtype, name
+0002cb40: 3d6f 7574 5f6e 616d 650a 2020 2020 290a  =out_name.    ).
+0002cb50: 2020 2020 7265 7475 726e 2072 6573 756c      return resul
+0002cb60: 745f 3164 2e72 6573 6861 7065 2862 726f  t_1d.reshape(bro
+0002cb70: 6164 6361 7374 5f73 6861 7065 202b 2072  adcast_shape + r
+0002cb80: 6573 756c 745f 3164 2e73 6861 7065 5b31  esult_1d.shape[1
+0002cb90: 3a5d 290a 0a0a 6465 6620 5f67 6574 5f61  :])...def _get_a
+0002cba0: 7869 7328 696e 6465 7865 7329 3a0a 2020  xis(indexes):.  
+0002cbb0: 2020 2222 2247 6574 2061 7869 7320 616c    """Get axis al
+0002cbc0: 6f6e 6720 7768 6963 6820 706f 696e 742d  ong which point-
+0002cbd0: 7769 7365 2073 6c69 6369 6e67 2072 6573  wise slicing res
+0002cbe0: 756c 7473 206c 6965 0a0a 2020 2020 5468  ults lie..    Th
+0002cbf0: 6973 2069 7320 6d6f 7374 6c79 2061 2068  is is mostly a h
+0002cc00: 6163 6b20 6265 6361 7573 6520 4920 6361  ack because I ca
+0002cc10: 6e27 7420 6669 6775 7265 206f 7574 204e  n't figure out N
+0002cc20: 756d 5079 2773 2072 756c 6520 6f6e 2074  umPy's rule on t
+0002cc30: 6869 7320 616e 640a 2020 2020 6361 6e27  his and.    can'
+0002cc40: 7420 6265 2062 6f74 6865 7265 6420 746f  t be bothered to
+0002cc50: 2067 6f20 7265 6164 696e 672e 0a0a 2020   go reading...  
+0002cc60: 2020 3e3e 3e20 5f67 6574 5f61 7869 7328    >>> _get_axis(
+0002cc70: 5b5b 312c 2032 5d2c 204e 6f6e 652c 205b  [[1, 2], None, [
+0002cc80: 312c 2032 5d2c 204e 6f6e 655d 290a 2020  1, 2], None]).  
+0002cc90: 2020 300a 2020 2020 3e3e 3e20 5f67 6574    0.    >>> _get
+0002cca0: 5f61 7869 7328 5b4e 6f6e 652c 205b 312c  _axis([None, [1,
+0002ccb0: 2032 5d2c 205b 312c 2032 5d2c 204e 6f6e   2], [1, 2], Non
+0002ccc0: 655d 290a 2020 2020 310a 2020 2020 3e3e  e]).    1.    >>
+0002ccd0: 3e20 5f67 6574 5f61 7869 7328 5b4e 6f6e  > _get_axis([Non
+0002cce0: 652c 204e 6f6e 652c 205b 312c 2032 5d2c  e, None, [1, 2],
+0002ccf0: 205b 312c 2032 5d5d 290a 2020 2020 320a   [1, 2]]).    2.
+0002cd00: 2020 2020 2222 220a 2020 2020 6e64 696d      """.    ndim
+0002cd10: 203d 206c 656e 2869 6e64 6578 6573 290a   = len(indexes).
+0002cd20: 2020 2020 696e 6465 7865 7320 3d20 5b73      indexes = [s
+0002cd30: 6c69 6365 284e 6f6e 652c 204e 6f6e 6529  lice(None, None)
+0002cd40: 2069 6620 6920 6973 204e 6f6e 6520 656c   if i is None el
+0002cd50: 7365 205b 305d 2066 6f72 2069 2069 6e20  se [0] for i in 
+0002cd60: 696e 6465 7865 735d 0a20 2020 2078 203d  indexes].    x =
+0002cd70: 206e 702e 656d 7074 7928 2832 2c29 202a   np.empty((2,) *
+0002cd80: 206e 6469 6d29 0a20 2020 2078 3220 3d20   ndim).    x2 = 
+0002cd90: 785b 7475 706c 6528 696e 6465 7865 7329  x[tuple(indexes)
+0002cda0: 5d0a 2020 2020 7265 7475 726e 2078 322e  ].    return x2.
+0002cdb0: 7368 6170 652e 696e 6465 7828 3129 0a0a  shape.index(1)..
+0002cdc0: 0a64 6566 205f 7669 6e64 6578 5f73 6c69  .def _vindex_sli
+0002cdd0: 6365 2862 6c6f 636b 2c20 706f 696e 7473  ce(block, points
+0002cde0: 293a 0a20 2020 2022 2222 5075 6c6c 206f  ):.    """Pull o
+0002cdf0: 7574 2070 6f69 6e74 2d77 6973 6520 736c  ut point-wise sl
+0002ce00: 6963 6573 2066 726f 6d20 626c 6f63 6b22  ices from block"
+0002ce10: 2222 0a20 2020 2070 6f69 6e74 7320 3d20  "".    points = 
+0002ce20: 5b70 2069 6620 6973 696e 7374 616e 6365  [p if isinstance
+0002ce30: 2870 2c20 736c 6963 6529 2065 6c73 6520  (p, slice) else 
+0002ce40: 6c69 7374 2870 2920 666f 7220 7020 696e  list(p) for p in
+0002ce50: 2070 6f69 6e74 735d 0a20 2020 2072 6574   points].    ret
+0002ce60: 7572 6e20 626c 6f63 6b5b 7475 706c 6528  urn block[tuple(
+0002ce70: 706f 696e 7473 295d 0a0a 0a64 6566 205f  points)]...def _
+0002ce80: 7669 6e64 6578 5f74 7261 6e73 706f 7365  vindex_transpose
+0002ce90: 2862 6c6f 636b 2c20 6178 6973 293a 0a20  (block, axis):. 
+0002cea0: 2020 2022 2222 526f 7461 7465 2062 6c6f     """Rotate blo
+0002ceb0: 636b 2073 6f20 7468 6174 2070 6f69 6e74  ck so that point
+0002cec0: 7320 6172 6520 6f6e 2074 6865 2066 6972  s are on the fir
+0002ced0: 7374 2064 696d 656e 7369 6f6e 2222 220a  st dimension""".
+0002cee0: 2020 2020 6178 6573 203d 205b 6178 6973      axes = [axis
+0002cef0: 5d20 2b20 6c69 7374 2872 616e 6765 2861  ] + list(range(a
+0002cf00: 7869 7329 2920 2b20 6c69 7374 2872 616e  xis)) + list(ran
+0002cf10: 6765 2861 7869 7320 2b20 312c 2062 6c6f  ge(axis + 1, blo
+0002cf20: 636b 2e6e 6469 6d29 290a 2020 2020 7265  ck.ndim)).    re
+0002cf30: 7475 726e 2062 6c6f 636b 2e74 7261 6e73  turn block.trans
+0002cf40: 706f 7365 2861 7865 7329 0a0a 0a64 6566  pose(axes)...def
+0002cf50: 205f 7669 6e64 6578 5f6d 6572 6765 286c   _vindex_merge(l
+0002cf60: 6f63 6174 696f 6e73 2c20 7661 6c75 6573  ocations, values
+0002cf70: 293a 0a20 2020 2022 2222 0a0a 2020 2020  ):.    """..    
+0002cf80: 3e3e 3e20 6c6f 6361 7469 6f6e 7320 3d20  >>> locations = 
+0002cf90: 5b30 5d2c 205b 322c 2031 5d0a 2020 2020  [0], [2, 1].    
+0002cfa0: 3e3e 3e20 7661 6c75 6573 203d 205b 6e70  >>> values = [np
+0002cfb0: 2e61 7272 6179 285b 5b31 2c20 322c 2033  .array([[1, 2, 3
+0002cfc0: 5d5d 292c 0a20 2020 202e 2e2e 2020 2020  ]]),.    ...    
+0002cfd0: 2020 2020 2020 206e 702e 6172 7261 7928         np.array(
+0002cfe0: 5b5b 3130 2c20 3230 2c20 3330 5d2c 205b  [[10, 20, 30], [
+0002cff0: 3430 2c20 3530 2c20 3630 5d5d 295d 0a0a  40, 50, 60]])]..
+0002d000: 2020 2020 3e3e 3e20 5f76 696e 6465 785f      >>> _vindex_
+0002d010: 6d65 7267 6528 6c6f 6361 7469 6f6e 732c  merge(locations,
+0002d020: 2076 616c 7565 7329 0a20 2020 2061 7272   values).    arr
+0002d030: 6179 285b 5b20 312c 2020 322c 2020 335d  ay([[ 1,  2,  3]
+0002d040: 2c0a 2020 2020 2020 2020 2020 205b 3430  ,.           [40
+0002d050: 2c20 3530 2c20 3630 5d2c 0a20 2020 2020  , 50, 60],.     
+0002d060: 2020 2020 2020 5b31 302c 2032 302c 2033        [10, 20, 3
+0002d070: 305d 5d29 0a20 2020 2022 2222 0a20 2020  0]]).    """.   
+0002d080: 206c 6f63 6174 696f 6e73 203d 206c 6973   locations = lis
+0002d090: 7428 6d61 7028 6c69 7374 2c20 6c6f 6361  t(map(list, loca
+0002d0a0: 7469 6f6e 7329 290a 2020 2020 7661 6c75  tions)).    valu
+0002d0b0: 6573 203d 206c 6973 7428 7661 6c75 6573  es = list(values
+0002d0c0: 290a 0a20 2020 206e 203d 2073 756d 286d  )..    n = sum(m
+0002d0d0: 6170 286c 656e 2c20 6c6f 6361 7469 6f6e  ap(len, location
+0002d0e0: 7329 290a 0a20 2020 2073 6861 7065 203d  s))..    shape =
+0002d0f0: 206c 6973 7428 7661 6c75 6573 5b30 5d2e   list(values[0].
+0002d100: 7368 6170 6529 0a20 2020 2073 6861 7065  shape).    shape
+0002d110: 5b30 5d20 3d20 6e0a 2020 2020 7368 6170  [0] = n.    shap
+0002d120: 6520 3d20 7475 706c 6528 7368 6170 6529  e = tuple(shape)
+0002d130: 0a0a 2020 2020 6474 7970 6520 3d20 7661  ..    dtype = va
+0002d140: 6c75 6573 5b30 5d2e 6474 7970 650a 0a20  lues[0].dtype.. 
+0002d150: 2020 2078 203d 206e 702e 656d 7074 795f     x = np.empty_
+0002d160: 6c69 6b65 2876 616c 7565 735b 305d 2c20  like(values[0], 
+0002d170: 6474 7970 653d 6474 7970 652c 2073 6861  dtype=dtype, sha
+0002d180: 7065 3d73 6861 7065 290a 0a20 2020 2069  pe=shape)..    i
+0002d190: 6e64 203d 205b 736c 6963 6528 4e6f 6e65  nd = [slice(None
+0002d1a0: 2c20 4e6f 6e65 2920 666f 7220 6920 696e  , None) for i in
+0002d1b0: 2072 616e 6765 2878 2e6e 6469 6d29 5d0a   range(x.ndim)].
+0002d1c0: 2020 2020 666f 7220 6c6f 632c 2076 616c      for loc, val
+0002d1d0: 2069 6e20 7a69 7028 6c6f 6361 7469 6f6e   in zip(location
+0002d1e0: 732c 2076 616c 7565 7329 3a0a 2020 2020  s, values):.    
+0002d1f0: 2020 2020 696e 645b 305d 203d 206c 6f63      ind[0] = loc
+0002d200: 0a20 2020 2020 2020 2078 5b74 7570 6c65  .        x[tuple
+0002d210: 2869 6e64 295d 203d 2076 616c 0a0a 2020  (ind)] = val..  
+0002d220: 2020 7265 7475 726e 2078 0a0a 0a64 6566    return x...def
+0002d230: 2074 6f5f 6e70 795f 7374 6163 6b28 6469   to_npy_stack(di
+0002d240: 726e 616d 652c 2078 2c20 6178 6973 3d30  rname, x, axis=0
+0002d250: 293a 0a20 2020 2022 2222 5772 6974 6520  ):.    """Write 
+0002d260: 6461 736b 2061 7272 6179 2074 6f20 6120  dask array to a 
+0002d270: 7374 6163 6b20 6f66 202e 6e70 7920 6669  stack of .npy fi
+0002d280: 6c65 730a 0a20 2020 2054 6869 7320 7061  les..    This pa
+0002d290: 7274 6974 696f 6e73 2074 6865 2064 6173  rtitions the das
+0002d2a0: 6b2e 6172 7261 7920 616c 6f6e 6720 6f6e  k.array along on
+0002d2b0: 6520 6178 6973 2061 6e64 2073 746f 7265  e axis and store
+0002d2c0: 7320 6561 6368 2062 6c6f 636b 2061 6c6f  s each block alo
+0002d2d0: 6e67 0a20 2020 2074 6861 7420 6178 6973  ng.    that axis
+0002d2e0: 2061 7320 6120 7369 6e67 6c65 202e 6e70   as a single .np
+0002d2f0: 7920 6669 6c65 2069 6e20 7468 6520 7370  y file in the sp
+0002d300: 6563 6966 6965 6420 6469 7265 6374 6f72  ecified director
+0002d310: 790a 0a20 2020 2045 7861 6d70 6c65 730a  y..    Examples.
+0002d320: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0002d330: 203e 3e3e 2078 203d 2064 612e 6f6e 6573   >>> x = da.ones
+0002d340: 2828 352c 2031 302c 2031 3029 2c20 6368  ((5, 10, 10), ch
+0002d350: 756e 6b73 3d28 322c 2034 2c20 3429 2920  unks=(2, 4, 4)) 
+0002d360: 2023 2064 6f63 7465 7374 3a20 2b53 4b49   # doctest: +SKI
+0002d370: 500a 2020 2020 3e3e 3e20 6461 2e74 6f5f  P.    >>> da.to_
+0002d380: 6e70 795f 7374 6163 6b28 2764 6174 612f  npy_stack('data/
+0002d390: 272c 2078 2c20 6178 6973 3d30 2920 2023  ', x, axis=0)  #
+0002d3a0: 2064 6f63 7465 7374 3a20 2b53 4b49 500a   doctest: +SKIP.
+0002d3b0: 0a20 2020 2054 6865 2060 602e 6e70 7960  .    The ``.npy`
+0002d3c0: 6020 6669 6c65 7320 7374 6f72 6520 6e75  ` files store nu
+0002d3d0: 6d70 7920 6172 7261 7973 2066 6f72 2060  mpy arrays for `
+0002d3e0: 6078 5b30 3a32 5d2c 2078 5b32 3a34 5d2c  `x[0:2], x[2:4],
+0002d3f0: 2061 6e64 2078 5b34 3a35 5d60 600a 2020   and x[4:5]``.  
+0002d400: 2020 7265 7370 6563 7469 7665 6c79 2c20    respectively, 
+0002d410: 6173 2069 7320 7370 6563 6966 6965 6420  as is specified 
+0002d420: 6279 2074 6865 2063 6875 6e6b 2073 697a  by the chunk siz
+0002d430: 6520 616c 6f6e 6720 7468 6520 7a65 726f  e along the zero
+0002d440: 7468 2061 7869 733a 3a0a 0a20 2020 2020  th axis::..     
+0002d450: 2020 2024 2074 7265 6520 6461 7461 2f0a     $ tree data/.
+0002d460: 2020 2020 2020 2020 6461 7461 2f0a 2020          data/.  
+0002d470: 2020 2020 2020 7c2d 2d20 302e 6e70 790a        |-- 0.npy.
+0002d480: 2020 2020 2020 2020 7c2d 2d20 312e 6e70          |-- 1.np
+0002d490: 790a 2020 2020 2020 2020 7c2d 2d20 322e  y.        |-- 2.
+0002d4a0: 6e70 790a 2020 2020 2020 2020 7c2d 2d20  npy.        |-- 
+0002d4b0: 696e 666f 0a0a 2020 2020 5468 6520 6060  info..    The ``
+0002d4c0: 696e 666f 6060 2066 696c 6520 7374 6f72  info`` file stor
+0002d4d0: 6573 2074 6865 2064 7479 7065 2c20 6368  es the dtype, ch
+0002d4e0: 756e 6b73 2c20 616e 6420 6178 6973 2069  unks, and axis i
+0002d4f0: 6e66 6f72 6d61 7469 6f6e 206f 6620 7468  nformation of th
+0002d500: 6520 6172 7261 792e 0a20 2020 2059 6f75  e array..    You
+0002d510: 2063 616e 206c 6f61 6420 7468 6573 6520   can load these 
+0002d520: 7374 6163 6b73 2077 6974 6820 7468 6520  stacks with the 
+0002d530: 3a66 756e 633a 6064 6173 6b2e 6172 7261  :func:`dask.arra
+0002d540: 792e 6672 6f6d 5f6e 7079 5f73 7461 636b  y.from_npy_stack
+0002d550: 6020 6675 6e63 7469 6f6e 2e0a 0a20 2020  ` function...   
+0002d560: 203e 3e3e 2079 203d 2064 612e 6672 6f6d   >>> y = da.from
+0002d570: 5f6e 7079 5f73 7461 636b 2827 6461 7461  _npy_stack('data
+0002d580: 2f27 2920 2023 2064 6f63 7465 7374 3a20  /')  # doctest: 
+0002d590: 2b53 4b49 500a 0a20 2020 2053 6565 2041  +SKIP..    See A
+0002d5a0: 6c73 6f0a 2020 2020 2d2d 2d2d 2d2d 2d2d  lso.    --------
+0002d5b0: 0a20 2020 2066 726f 6d5f 6e70 795f 7374  .    from_npy_st
+0002d5c0: 6163 6b0a 2020 2020 2222 220a 0a20 2020  ack.    """..   
+0002d5d0: 2063 6875 6e6b 7320 3d20 7475 706c 6528   chunks = tuple(
+0002d5e0: 2863 2069 6620 6920 3d3d 2061 7869 7320  (c if i == axis 
+0002d5f0: 656c 7365 2028 7375 6d28 6329 2c29 2920  else (sum(c),)) 
+0002d600: 666f 7220 692c 2063 2069 6e20 656e 756d  for i, c in enum
+0002d610: 6572 6174 6528 782e 6368 756e 6b73 2929  erate(x.chunks))
+0002d620: 0a20 2020 2078 7820 3d20 782e 7265 6368  .    xx = x.rech
+0002d630: 756e 6b28 6368 756e 6b73 290a 0a20 2020  unk(chunks)..   
+0002d640: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+0002d650: 6578 6973 7473 2864 6972 6e61 6d65 293a  exists(dirname):
+0002d660: 0a20 2020 2020 2020 206f 732e 6d6b 6469  .        os.mkdi
+0002d670: 7228 6469 726e 616d 6529 0a0a 2020 2020  r(dirname)..    
+0002d680: 6d65 7461 203d 207b 2263 6875 6e6b 7322  meta = {"chunks"
+0002d690: 3a20 6368 756e 6b73 2c20 2264 7479 7065  : chunks, "dtype
+0002d6a0: 223a 2078 2e64 7479 7065 2c20 2261 7869  ": x.dtype, "axi
+0002d6b0: 7322 3a20 6178 6973 7d0a 0a20 2020 2077  s": axis}..    w
+0002d6c0: 6974 6820 6f70 656e 286f 732e 7061 7468  ith open(os.path
+0002d6d0: 2e6a 6f69 6e28 6469 726e 616d 652c 2022  .join(dirname, "
+0002d6e0: 696e 666f 2229 2c20 2277 6222 2920 6173  info"), "wb") as
+0002d6f0: 2066 3a0a 2020 2020 2020 2020 7069 636b   f:.        pick
+0002d700: 6c65 2e64 756d 7028 6d65 7461 2c20 6629  le.dump(meta, f)
+0002d710: 0a0a 2020 2020 6e61 6d65 203d 2022 746f  ..    name = "to
+0002d720: 2d6e 7079 2d73 7461 636b 2d22 202b 2073  -npy-stack-" + s
+0002d730: 7472 2875 7569 642e 7575 6964 3128 2929  tr(uuid.uuid1())
+0002d740: 0a20 2020 2064 736b 203d 207b 0a20 2020  .    dsk = {.   
+0002d750: 2020 2020 2028 6e61 6d65 2c20 6929 3a20       (name, i): 
+0002d760: 286e 702e 7361 7665 2c20 6f73 2e70 6174  (np.save, os.pat
+0002d770: 682e 6a6f 696e 2864 6972 6e61 6d65 2c20  h.join(dirname, 
+0002d780: 2225 642e 6e70 7922 2025 2069 292c 206b  "%d.npy" % i), k
+0002d790: 6579 290a 2020 2020 2020 2020 666f 7220  ey).        for 
+0002d7a0: 692c 206b 6579 2069 6e20 656e 756d 6572  i, key in enumer
+0002d7b0: 6174 6528 636f 7265 2e66 6c61 7474 656e  ate(core.flatten
+0002d7c0: 2878 782e 5f5f 6461 736b 5f6b 6579 735f  (xx.__dask_keys_
+0002d7d0: 5f28 2929 290a 2020 2020 7d0a 0a20 2020  _())).    }..   
+0002d7e0: 2067 7261 7068 203d 2048 6967 684c 6576   graph = HighLev
+0002d7f0: 656c 4772 6170 682e 6672 6f6d 5f63 6f6c  elGraph.from_col
+0002d800: 6c65 6374 696f 6e73 286e 616d 652c 2064  lections(name, d
+0002d810: 736b 2c20 6465 7065 6e64 656e 6369 6573  sk, dependencies
+0002d820: 3d5b 7878 5d29 0a20 2020 2063 6f6d 7075  =[xx]).    compu
+0002d830: 7465 5f61 735f 6966 5f63 6f6c 6c65 6374  te_as_if_collect
+0002d840: 696f 6e28 4172 7261 792c 2067 7261 7068  ion(Array, graph
+0002d850: 2c20 6c69 7374 2864 736b 2929 0a0a 0a64  , list(dsk))...d
+0002d860: 6566 2066 726f 6d5f 6e70 795f 7374 6163  ef from_npy_stac
+0002d870: 6b28 6469 726e 616d 652c 206d 6d61 705f  k(dirname, mmap_
+0002d880: 6d6f 6465 3d22 7222 293a 0a20 2020 2022  mode="r"):.    "
+0002d890: 2222 4c6f 6164 2064 6173 6b20 6172 7261  ""Load dask arra
+0002d8a0: 7920 6672 6f6d 2073 7461 636b 206f 6620  y from stack of 
+0002d8b0: 6e70 7920 6669 6c65 730a 0a20 2020 2050  npy files..    P
+0002d8c0: 6172 616d 6574 6572 730a 2020 2020 2d2d  arameters.    --
+0002d8d0: 2d2d 2d2d 2d2d 2d2d 0a20 2020 2064 6972  --------.    dir
+0002d8e0: 6e61 6d65 3a20 7374 7269 6e67 0a20 2020  name: string.   
+0002d8f0: 2020 2020 2044 6972 6563 746f 7279 206f       Directory o
+0002d900: 6620 2e6e 7079 2066 696c 6573 0a20 2020  f .npy files.   
+0002d910: 206d 6d61 705f 6d6f 6465 3a20 284e 6f6e   mmap_mode: (Non
+0002d920: 6520 6f72 2027 7227 290a 2020 2020 2020  e or 'r').      
+0002d930: 2020 5265 6164 2064 6174 6120 696e 206d    Read data in m
+0002d940: 656d 6f72 7920 6d61 7020 6d6f 6465 0a0a  emory map mode..
+0002d950: 2020 2020 5365 6520 416c 736f 0a20 2020      See Also.   
+0002d960: 202d 2d2d 2d2d 2d2d 2d0a 2020 2020 746f   --------.    to
+0002d970: 5f6e 7079 5f73 7461 636b 0a20 2020 2022  _npy_stack.    "
+0002d980: 2222 0a20 2020 2077 6974 6820 6f70 656e  "".    with open
+0002d990: 286f 732e 7061 7468 2e6a 6f69 6e28 6469  (os.path.join(di
+0002d9a0: 726e 616d 652c 2022 696e 666f 2229 2c20  rname, "info"), 
+0002d9b0: 2272 6222 2920 6173 2066 3a0a 2020 2020  "rb") as f:.    
+0002d9c0: 2020 2020 696e 666f 203d 2070 6963 6b6c      info = pickl
+0002d9d0: 652e 6c6f 6164 2866 290a 0a20 2020 2064  e.load(f)..    d
+0002d9e0: 7479 7065 203d 2069 6e66 6f5b 2264 7479  type = info["dty
+0002d9f0: 7065 225d 0a20 2020 2063 6875 6e6b 7320  pe"].    chunks 
+0002da00: 3d20 696e 666f 5b22 6368 756e 6b73 225d  = info["chunks"]
+0002da10: 0a20 2020 2061 7869 7320 3d20 696e 666f  .    axis = info
+0002da20: 5b22 6178 6973 225d 0a0a 2020 2020 6e61  ["axis"]..    na
+0002da30: 6d65 203d 2022 6672 6f6d 2d6e 7079 2d73  me = "from-npy-s
+0002da40: 7461 636b 2d25 7322 2025 2064 6972 6e61  tack-%s" % dirna
+0002da50: 6d65 0a20 2020 206b 6579 7320 3d20 6c69  me.    keys = li
+0002da60: 7374 2870 726f 6475 6374 285b 6e61 6d65  st(product([name
+0002da70: 5d2c 202a 5b72 616e 6765 286c 656e 2863  ], *[range(len(c
+0002da80: 2929 2066 6f72 2063 2069 6e20 6368 756e  )) for c in chun
+0002da90: 6b73 5d29 290a 2020 2020 7661 6c75 6573  ks])).    values
+0002daa0: 203d 205b 0a20 2020 2020 2020 2028 6e70   = [.        (np
+0002dab0: 2e6c 6f61 642c 206f 732e 7061 7468 2e6a  .load, os.path.j
+0002dac0: 6f69 6e28 6469 726e 616d 652c 2022 2564  oin(dirname, "%d
+0002dad0: 2e6e 7079 2220 2520 6929 2c20 6d6d 6170  .npy" % i), mmap
+0002dae0: 5f6d 6f64 6529 0a20 2020 2020 2020 2066  _mode).        f
+0002daf0: 6f72 2069 2069 6e20 7261 6e67 6528 6c65  or i in range(le
+0002db00: 6e28 6368 756e 6b73 5b61 7869 735d 2929  n(chunks[axis]))
+0002db10: 0a20 2020 205d 0a20 2020 2064 736b 203d  .    ].    dsk =
+0002db20: 2064 6963 7428 7a69 7028 6b65 7973 2c20   dict(zip(keys, 
+0002db30: 7661 6c75 6573 2929 0a0a 2020 2020 7265  values))..    re
+0002db40: 7475 726e 2041 7272 6179 2864 736b 2c20  turn Array(dsk, 
+0002db50: 6e61 6d65 2c20 6368 756e 6b73 2c20 6474  name, chunks, dt
+0002db60: 7970 6529 0a0a 0a64 6566 206e 6577 5f64  ype)...def new_d
+0002db70: 615f 6f62 6a65 6374 2864 736b 2c20 6e61  a_object(dsk, na
+0002db80: 6d65 2c20 6368 756e 6b73 2c20 6d65 7461  me, chunks, meta
+0002db90: 3d4e 6f6e 652c 2064 7479 7065 3d4e 6f6e  =None, dtype=Non
+0002dba0: 6529 3a0a 2020 2020 2222 2247 656e 6572  e):.    """Gener
+0002dbb0: 6963 2063 6f6e 7374 7275 6374 6f72 2066  ic constructor f
+0002dbc0: 6f72 2064 6173 6b2e 6172 7261 7920 6f72  or dask.array or
+0002dbd0: 2064 6173 6b2e 6461 7461 6672 616d 6520   dask.dataframe 
+0002dbe0: 6f62 6a65 6374 732e 0a0a 2020 2020 4465  objects...    De
+0002dbf0: 6369 6465 7320 7468 6520 6170 7072 6f70  cides the approp
+0002dc00: 7269 6174 6520 6f75 7470 7574 2063 6c61  riate output cla
+0002dc10: 7373 2062 6173 6564 206f 6e20 7468 6520  ss based on the 
+0002dc20: 7479 7065 206f 6620 606d 6574 6160 2070  type of `meta` p
+0002dc30: 726f 7669 6465 642e 0a20 2020 2022 2222  rovided..    """
+0002dc40: 0a20 2020 2069 6620 6973 5f64 6174 6166  .    if is_dataf
+0002dc50: 7261 6d65 5f6c 696b 6528 6d65 7461 2920  rame_like(meta) 
+0002dc60: 6f72 2069 735f 7365 7269 6573 5f6c 696b  or is_series_lik
+0002dc70: 6528 6d65 7461 2920 6f72 2069 735f 696e  e(meta) or is_in
+0002dc80: 6465 785f 6c69 6b65 286d 6574 6129 3a0a  dex_like(meta):.
+0002dc90: 2020 2020 2020 2020 6672 6f6d 2064 6173          from das
+0002dca0: 6b2e 6461 7461 6672 616d 652e 636f 7265  k.dataframe.core
+0002dcb0: 2069 6d70 6f72 7420 6e65 775f 6464 5f6f   import new_dd_o
+0002dcc0: 626a 6563 740a 0a20 2020 2020 2020 2061  bject..        a
+0002dcd0: 7373 6572 7420 616c 6c28 6c65 6e28 6329  ssert all(len(c)
+0002dce0: 203d 3d20 3120 666f 7220 6320 696e 2063   == 1 for c in c
+0002dcf0: 6875 6e6b 735b 313a 5d29 0a20 2020 2020  hunks[1:]).     
+0002dd00: 2020 2064 6976 6973 696f 6e73 203d 205b     divisions = [
+0002dd10: 4e6f 6e65 5d20 2a20 286c 656e 2863 6875  None] * (len(chu
+0002dd20: 6e6b 735b 305d 2920 2b20 3129 0a20 2020  nks[0]) + 1).   
+0002dd30: 2020 2020 2072 6574 7572 6e20 6e65 775f       return new_
+0002dd40: 6464 5f6f 626a 6563 7428 6473 6b2c 206e  dd_object(dsk, n
+0002dd50: 616d 652c 206d 6574 612c 2064 6976 6973  ame, meta, divis
+0002dd60: 696f 6e73 290a 2020 2020 656c 7365 3a0a  ions).    else:.
+0002dd70: 2020 2020 2020 2020 7265 7475 726e 2041          return A
+0002dd80: 7272 6179 2864 736b 2c20 6e61 6d65 3d6e  rray(dsk, name=n
+0002dd90: 616d 652c 2063 6875 6e6b 733d 6368 756e  ame, chunks=chun
+0002dda0: 6b73 2c20 6d65 7461 3d6d 6574 612c 2064  ks, meta=meta, d
+0002ddb0: 7479 7065 3d64 7479 7065 290a 0a0a 636c  type=dtype)...cl
+0002ddc0: 6173 7320 426c 6f63 6b56 6965 773a 0a20  ass BlockView:. 
+0002ddd0: 2020 2022 2222 416e 2061 7272 6179 2d6c     """An array-l
+0002dde0: 696b 6520 696e 7465 7266 6163 6520 746f  ike interface to
+0002ddf0: 2074 6865 2062 6c6f 636b 7320 6f66 2061   the blocks of a
+0002de00: 6e20 6172 7261 792e 0a0a 2020 2020 6060  n array...    ``
+0002de10: 426c 6f63 6b56 6965 7760 6020 7072 6f76  BlockView`` prov
+0002de20: 6964 6573 2061 6e20 6172 7261 792d 6c69  ides an array-li
+0002de30: 6b65 2069 6e74 6572 6661 6365 0a20 2020  ke interface.   
+0002de40: 2074 6f20 7468 6520 626c 6f63 6b73 206f   to the blocks o
+0002de50: 6620 6120 6461 736b 2061 7272 6179 2e20  f a dask array. 
+0002de60: 204e 756d 7079 2d73 7479 6c65 2069 6e64   Numpy-style ind
+0002de70: 6578 696e 6720 6f66 2061 0a20 2020 2020  exing of a.     
+0002de80: 6060 426c 6f63 6b56 6965 7760 6020 7265  ``BlockView`` re
+0002de90: 7475 726e 7320 6120 7365 6c65 6374 696f  turns a selectio
+0002dea0: 6e20 6f66 2062 6c6f 636b 7320 6173 2061  n of blocks as a
+0002deb0: 206e 6577 2064 6173 6b20 6172 7261 792e   new dask array.
+0002dec0: 0a0a 2020 2020 596f 7520 6361 6e20 696e  ..    You can in
+0002ded0: 6465 7820 6060 426c 6f63 6b56 6965 7760  dex ``BlockView`
+0002dee0: 6020 6c69 6b65 2061 206e 756d 7079 2061  ` like a numpy a
+0002def0: 7272 6179 206f 6620 7368 6170 650a 2020  rray of shape.  
+0002df00: 2020 6571 7561 6c20 746f 2074 6865 206e    equal to the n
+0002df10: 756d 6265 7220 6f66 2062 6c6f 636b 7320  umber of blocks 
+0002df20: 696e 2065 6163 6820 6469 6d65 6e73 696f  in each dimensio
+0002df30: 6e2c 2028 6176 6169 6c61 626c 6520 6173  n, (available as
+0002df40: 0a20 2020 2061 7272 6179 2e62 6c6f 636b  .    array.block
+0002df50: 732e 7369 7a65 292e 2020 5468 6520 6469  s.size).  The di
+0002df60: 6d65 6e73 696f 6e61 6c69 7479 206f 6620  mensionality of 
+0002df70: 7468 6520 6f75 7470 7574 2061 7272 6179  the output array
+0002df80: 206d 6174 6368 6573 0a20 2020 2074 6865   matches.    the
+0002df90: 2064 696d 656e 7369 6f6e 206f 6620 7468   dimension of th
+0002dfa0: 6973 2061 7272 6179 2c20 6576 656e 2069  is array, even i
+0002dfb0: 6620 696e 7465 6765 7220 696e 6469 6365  f integer indice
+0002dfc0: 7320 6172 6520 7061 7373 6564 2e0a 2020  s are passed..  
+0002dfd0: 2020 536c 6963 696e 6720 7769 7468 2060    Slicing with `
+0002dfe0: 606e 702e 6e65 7761 7869 7360 6020 6f72  `np.newaxis`` or
+0002dff0: 206d 756c 7469 706c 6520 6c69 7374 7320   multiple lists 
+0002e000: 6973 206e 6f74 2073 7570 706f 7274 6564  is not supported
+0002e010: 2e0a 0a20 2020 2045 7861 6d70 6c65 730a  ...    Examples.
+0002e020: 2020 2020 2d2d 2d2d 2d2d 2d2d 0a20 2020      --------.   
+0002e030: 203e 3e3e 2069 6d70 6f72 7420 6461 736b   >>> import dask
+0002e040: 2e61 7272 6179 2061 7320 6461 0a20 2020  .array as da.   
+0002e050: 203e 3e3e 2066 726f 6d20 6461 736b 2e61   >>> from dask.a
+0002e060: 7272 6179 2e63 6f72 6520 696d 706f 7274  rray.core import
+0002e070: 2042 6c6f 636b 5669 6577 0a20 2020 203e   BlockView.    >
+0002e080: 3e3e 2078 203d 2064 612e 6172 616e 6765  >> x = da.arange
+0002e090: 2838 2c20 6368 756e 6b73 3d32 290a 2020  (8, chunks=2).  
+0002e0a0: 2020 3e3e 3e20 6276 203d 2042 6c6f 636b    >>> bv = Block
+0002e0b0: 5669 6577 2878 290a 2020 2020 3e3e 3e20  View(x).    >>> 
+0002e0c0: 6276 2e73 6861 7065 2023 2061 6c69 6173  bv.shape # alias
+0002e0d0: 6573 2078 2e6e 756d 626c 6f63 6b73 0a20  es x.numblocks. 
+0002e0e0: 2020 2028 342c 290a 2020 2020 3e3e 3e20     (4,).    >>> 
+0002e0f0: 6276 2e73 697a 650a 2020 2020 340a 2020  bv.size.    4.  
+0002e100: 2020 3e3e 3e20 6276 5b30 5d2e 636f 6d70    >>> bv[0].comp
+0002e110: 7574 6528 290a 2020 2020 6172 7261 7928  ute().    array(
+0002e120: 5b30 2c20 315d 290a 2020 2020 3e3e 3e20  [0, 1]).    >>> 
+0002e130: 6276 5b3a 335d 2e63 6f6d 7075 7465 2829  bv[:3].compute()
+0002e140: 0a20 2020 2061 7272 6179 285b 302c 2031  .    array([0, 1
+0002e150: 2c20 322c 2033 2c20 342c 2035 5d29 0a20  , 2, 3, 4, 5]). 
+0002e160: 2020 203e 3e3e 2062 765b 3a3a 325d 2e63     >>> bv[::2].c
+0002e170: 6f6d 7075 7465 2829 0a20 2020 2061 7272  ompute().    arr
+0002e180: 6179 285b 302c 2031 2c20 342c 2035 5d29  ay([0, 1, 4, 5])
+0002e190: 0a20 2020 203e 3e3e 2062 765b 5b2d 312c  .    >>> bv[[-1,
+0002e1a0: 2030 5d5d 2e63 6f6d 7075 7465 2829 0a20   0]].compute(). 
+0002e1b0: 2020 2061 7272 6179 285b 362c 2037 2c20     array([6, 7, 
+0002e1c0: 302c 2031 5d29 0a20 2020 203e 3e3e 2062  0, 1]).    >>> b
+0002e1d0: 762e 7261 7665 6c28 2920 2023 2064 6f63  v.ravel()  # doc
+0002e1e0: 7465 7374 3a20 2b4e 4f52 4d41 4c49 5a45  test: +NORMALIZE
+0002e1f0: 5f57 4849 5445 5350 4143 450a 2020 2020  _WHITESPACE.    
+0002e200: 5b64 6173 6b2e 6172 7261 793c 626c 6f63  [dask.array<bloc
+0002e210: 6b73 2c20 7368 6170 653d 2832 2c29 2c20  ks, shape=(2,), 
+0002e220: 6474 7970 653d 696e 7436 342c 2063 6875  dtype=int64, chu
+0002e230: 6e6b 7369 7a65 3d28 322c 292c 2063 6875  nksize=(2,), chu
+0002e240: 6e6b 7479 7065 3d6e 756d 7079 2e6e 6461  nktype=numpy.nda
+0002e250: 7272 6179 3e2c 0a20 2020 2020 6461 736b  rray>,.     dask
+0002e260: 2e61 7272 6179 3c62 6c6f 636b 732c 2073  .array<blocks, s
+0002e270: 6861 7065 3d28 322c 292c 2064 7479 7065  hape=(2,), dtype
+0002e280: 3d69 6e74 3634 2c20 6368 756e 6b73 697a  =int64, chunksiz
+0002e290: 653d 2832 2c29 2c20 6368 756e 6b74 7970  e=(2,), chunktyp
+0002e2a0: 653d 6e75 6d70 792e 6e64 6172 7261 793e  e=numpy.ndarray>
+0002e2b0: 2c0a 2020 2020 2064 6173 6b2e 6172 7261  ,.     dask.arra
+0002e2c0: 793c 626c 6f63 6b73 2c20 7368 6170 653d  y<blocks, shape=
+0002e2d0: 2832 2c29 2c20 6474 7970 653d 696e 7436  (2,), dtype=int6
+0002e2e0: 342c 2063 6875 6e6b 7369 7a65 3d28 322c  4, chunksize=(2,
+0002e2f0: 292c 2063 6875 6e6b 7479 7065 3d6e 756d  ), chunktype=num
+0002e300: 7079 2e6e 6461 7272 6179 3e2c 0a20 2020  py.ndarray>,.   
+0002e310: 2020 6461 736b 2e61 7272 6179 3c62 6c6f    dask.array<blo
+0002e320: 636b 732c 2073 6861 7065 3d28 322c 292c  cks, shape=(2,),
+0002e330: 2064 7479 7065 3d69 6e74 3634 2c20 6368   dtype=int64, ch
+0002e340: 756e 6b73 697a 653d 2832 2c29 2c20 6368  unksize=(2,), ch
+0002e350: 756e 6b74 7970 653d 6e75 6d70 792e 6e64  unktype=numpy.nd
+0002e360: 6172 7261 793e 5d0a 0a20 2020 2052 6574  array>]..    Ret
+0002e370: 7572 6e73 0a20 2020 202d 2d2d 2d2d 2d2d  urns.    -------
+0002e380: 0a20 2020 2041 6e20 696e 7374 616e 6365  .    An instance
+0002e390: 206f 6620 6060 6461 2e61 7272 6179 2e42   of ``da.array.B
+0002e3a0: 6c6f 636b 7669 6577 6060 0a20 2020 2022  lockview``.    "
+0002e3b0: 2222 0a0a 2020 2020 6465 6620 5f5f 696e  ""..    def __in
+0002e3c0: 6974 5f5f 2873 656c 662c 2061 7272 6179  it__(self, array
+0002e3d0: 3a20 4172 7261 7929 3a0a 2020 2020 2020  : Array):.      
+0002e3e0: 2020 7365 6c66 2e5f 6172 7261 7920 3d20    self._array = 
+0002e3f0: 6172 7261 790a 0a20 2020 2064 6566 205f  array..    def _
+0002e400: 5f67 6574 6974 656d 5f5f 2873 656c 662c  _getitem__(self,
+0002e410: 2069 6e64 6578 3a20 416e 7929 202d 3e20   index: Any) -> 
+0002e420: 4172 7261 793a 0a20 2020 2020 2020 2066  Array:.        f
+0002e430: 726f 6d20 6461 736b 2e61 7272 6179 2e73  rom dask.array.s
+0002e440: 6c69 6369 6e67 2069 6d70 6f72 7420 6e6f  licing import no
+0002e450: 726d 616c 697a 655f 696e 6465 780a 0a20  rmalize_index.. 
+0002e460: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0002e470: 696e 7374 616e 6365 2869 6e64 6578 2c20  instance(index, 
+0002e480: 7475 706c 6529 3a0a 2020 2020 2020 2020  tuple):.        
+0002e490: 2020 2020 696e 6465 7820 3d20 2869 6e64      index = (ind
+0002e4a0: 6578 2c29 0a20 2020 2020 2020 2069 6620  ex,).        if 
+0002e4b0: 7375 6d28 6973 696e 7374 616e 6365 2869  sum(isinstance(i
+0002e4c0: 6e64 2c20 286e 702e 6e64 6172 7261 792c  nd, (np.ndarray,
+0002e4d0: 206c 6973 7429 2920 666f 7220 696e 6420   list)) for ind 
+0002e4e0: 696e 2069 6e64 6578 2920 3e20 313a 0a20  in index) > 1:. 
+0002e4f0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0002e500: 2056 616c 7565 4572 726f 7228 2243 616e   ValueError("Can
+0002e510: 206f 6e6c 7920 736c 6963 6520 7769 7468   only slice with
+0002e520: 2061 2073 696e 676c 6520 6c69 7374 2229   a single list")
+0002e530: 0a20 2020 2020 2020 2069 6620 616e 7928  .        if any(
+0002e540: 696e 6420 6973 204e 6f6e 6520 666f 7220  ind is None for 
+0002e550: 696e 6420 696e 2069 6e64 6578 293a 0a20  ind in index):. 
+0002e560: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0002e570: 2056 616c 7565 4572 726f 7228 2253 6c69   ValueError("Sli
+0002e580: 6369 6e67 2077 6974 6820 6e70 2e6e 6577  cing with np.new
+0002e590: 6178 6973 206f 7220 4e6f 6e65 2069 7320  axis or None is 
+0002e5a0: 6e6f 7420 7375 7070 6f72 7465 6422 290a  not supported").
+0002e5b0: 2020 2020 2020 2020 696e 6465 7820 3d20          index = 
+0002e5c0: 6e6f 726d 616c 697a 655f 696e 6465 7828  normalize_index(
+0002e5d0: 696e 6465 782c 2073 656c 662e 5f61 7272  index, self._arr
+0002e5e0: 6179 2e6e 756d 626c 6f63 6b73 290a 2020  ay.numblocks).  
+0002e5f0: 2020 2020 2020 696e 6465 7820 3d20 7475        index = tu
+0002e600: 706c 6528 0a20 2020 2020 2020 2020 2020  ple(.           
+0002e610: 2073 6c69 6365 286b 2c20 6b20 2b20 3129   slice(k, k + 1)
+0002e620: 2069 6620 6973 696e 7374 616e 6365 286b   if isinstance(k
+0002e630: 2c20 4e75 6d62 6572 2920 656c 7365 206b  , Number) else k
+0002e640: 2020 2320 7479 7065 3a20 6967 6e6f 7265    # type: ignore
+0002e650: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0002e660: 206b 2069 6e20 696e 6465 780a 2020 2020   k in index.    
+0002e670: 2020 2020 290a 0a20 2020 2020 2020 206e      )..        n
+0002e680: 616d 6520 3d20 2262 6c6f 636b 732d 2220  ame = "blocks-" 
+0002e690: 2b20 746f 6b65 6e69 7a65 2873 656c 662e  + tokenize(self.
+0002e6a0: 5f61 7272 6179 2c20 696e 6465 7829 0a0a  _array, index)..
+0002e6b0: 2020 2020 2020 2020 6e65 775f 6b65 7973          new_keys
+0002e6c0: 203d 2073 656c 662e 5f61 7272 6179 2e5f   = self._array._
+0002e6d0: 6b65 795f 6172 7261 795b 696e 6465 785d  key_array[index]
+0002e6e0: 0a0a 2020 2020 2020 2020 6368 756e 6b73  ..        chunks
+0002e6f0: 203d 2074 7570 6c65 280a 2020 2020 2020   = tuple(.      
+0002e700: 2020 2020 2020 7475 706c 6528 6e70 2e61        tuple(np.a
+0002e710: 7272 6179 2863 295b 695d 2e74 6f6c 6973  rray(c)[i].tolis
+0002e720: 7428 2929 2066 6f72 2063 2c20 6920 696e  t()) for c, i in
+0002e730: 207a 6970 2873 656c 662e 5f61 7272 6179   zip(self._array
+0002e740: 2e63 6875 6e6b 732c 2069 6e64 6578 290a  .chunks, index).
+0002e750: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0002e760: 2020 206b 6579 7320 3d20 7072 6f64 7563     keys = produc
+0002e770: 7428 2a28 7261 6e67 6528 6c65 6e28 6329  t(*(range(len(c)
+0002e780: 2920 666f 7220 6320 696e 2063 6875 6e6b  ) for c in chunk
+0002e790: 7329 290a 0a20 2020 2020 2020 2067 7261  s))..        gra
+0002e7a0: 7068 3a20 4772 6170 6820 3d20 7b28 6e61  ph: Graph = {(na
+0002e7b0: 6d65 2c29 202b 206b 6579 3a20 7475 706c  me,) + key: tupl
+0002e7c0: 6528 6e65 775f 6b65 7973 5b6b 6579 5d2e  e(new_keys[key].
+0002e7d0: 746f 6c69 7374 2829 2920 666f 7220 6b65  tolist()) for ke
+0002e7e0: 7920 696e 206b 6579 737d 0a0a 2020 2020  y in keys}..    
+0002e7f0: 2020 2020 686c 6720 3d20 4869 6768 4c65      hlg = HighLe
+0002e800: 7665 6c47 7261 7068 2e66 726f 6d5f 636f  velGraph.from_co
+0002e810: 6c6c 6563 7469 6f6e 7328 6e61 6d65 2c20  llections(name, 
+0002e820: 6772 6170 682c 2064 6570 656e 6465 6e63  graph, dependenc
+0002e830: 6965 733d 5b73 656c 662e 5f61 7272 6179  ies=[self._array
+0002e840: 5d29 0a20 2020 2020 2020 2072 6574 7572  ]).        retur
+0002e850: 6e20 4172 7261 7928 686c 672c 206e 616d  n Array(hlg, nam
+0002e860: 652c 2063 6875 6e6b 732c 206d 6574 613d  e, chunks, meta=
+0002e870: 7365 6c66 2e5f 6172 7261 7929 0a0a 2020  self._array)..  
+0002e880: 2020 6465 6620 5f5f 6571 5f5f 2873 656c    def __eq__(sel
+0002e890: 662c 206f 7468 6572 3a20 416e 7929 202d  f, other: Any) -
+0002e8a0: 3e20 626f 6f6c 3a0a 2020 2020 2020 2020  > bool:.        
+0002e8b0: 6966 2069 7369 6e73 7461 6e63 6528 6f74  if isinstance(ot
+0002e8c0: 6865 722c 2042 6c6f 636b 5669 6577 293a  her, BlockView):
+0002e8d0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0002e8e0: 7572 6e20 7365 6c66 2e5f 6172 7261 7920  urn self._array 
+0002e8f0: 6973 206f 7468 6572 2e5f 6172 7261 790a  is other._array.
+0002e900: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+0002e910: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0002e920: 204e 6f74 496d 706c 656d 656e 7465 640a   NotImplemented.
+0002e930: 0a20 2020 2040 7072 6f70 6572 7479 0a20  .    @property. 
+0002e940: 2020 2064 6566 2073 697a 6528 7365 6c66     def size(self
+0002e950: 2920 2d3e 2069 6e74 3a0a 2020 2020 2020  ) -> int:.      
+0002e960: 2020 2222 220a 2020 2020 2020 2020 5468    """.        Th
+0002e970: 6520 746f 7461 6c20 6e75 6d62 6572 206f  e total number o
+0002e980: 6620 626c 6f63 6b73 2069 6e20 7468 6520  f blocks in the 
+0002e990: 6172 7261 792e 0a20 2020 2020 2020 2022  array..        "
+0002e9a0: 2222 0a20 2020 2020 2020 2072 6574 7572  "".        retur
+0002e9b0: 6e20 6d61 7468 2e70 726f 6428 7365 6c66  n math.prod(self
+0002e9c0: 2e73 6861 7065 290a 0a20 2020 2040 7072  .shape)..    @pr
+0002e9d0: 6f70 6572 7479 0a20 2020 2064 6566 2073  operty.    def s
+0002e9e0: 6861 7065 2873 656c 6629 202d 3e20 7475  hape(self) -> tu
+0002e9f0: 706c 655b 696e 742c 202e 2e2e 5d3a 0a20  ple[int, ...]:. 
+0002ea00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0002ea10: 2020 2054 6865 206e 756d 6265 7220 6f66     The number of
+0002ea20: 2062 6c6f 636b 7320 7065 7220 6178 6973   blocks per axis
+0002ea30: 2e20 416c 6961 7320 6f66 2060 6064 6173  . Alias of ``das
+0002ea40: 6b2e 6172 7261 792e 6e75 6d62 6c6f 636b  k.array.numblock
+0002ea50: 7360 602e 0a20 2020 2020 2020 2022 2222  s``..        """
+0002ea60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0002ea70: 7365 6c66 2e5f 6172 7261 792e 6e75 6d62  self._array.numb
+0002ea80: 6c6f 636b 730a 0a20 2020 2064 6566 2072  locks..    def r
+0002ea90: 6176 656c 2873 656c 6629 202d 3e20 6c69  avel(self) -> li
+0002eaa0: 7374 5b41 7272 6179 5d3a 0a20 2020 2020  st[Array]:.     
+0002eab0: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
+0002eac0: 6574 7572 6e20 6120 666c 6174 7465 6e65  eturn a flattene
+0002ead0: 6420 6c69 7374 206f 6620 616c 6c20 7468  d list of all th
+0002eae0: 6520 626c 6f63 6b73 2069 6e20 7468 6520  e blocks in the 
+0002eaf0: 6172 7261 7920 696e 2043 206f 7264 6572  array in C order
+0002eb00: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0002eb10: 2020 2020 2020 7265 7475 726e 205b 7365        return [se
+0002eb20: 6c66 5b69 6478 5d20 666f 7220 6964 7820  lf[idx] for idx 
+0002eb30: 696e 206e 702e 6e64 696e 6465 7828 7365  in np.ndindex(se
+0002eb40: 6c66 2e73 6861 7065 295d 0a0a 0a66 726f  lf.shape)]...fro
+0002eb50: 6d20 6461 736b 2e61 7272 6179 2e62 6c6f  m dask.array.blo
+0002eb60: 636b 7769 7365 2069 6d70 6f72 7420 626c  ckwise import bl
+0002eb70: 6f63 6b77 6973 650a 6672 6f6d 2064 6173  ockwise.from das
+0002eb80: 6b2e 6172 7261 792e 7574 696c 7320 696d  k.array.utils im
+0002eb90: 706f 7274 2063 6f6d 7075 7465 5f6d 6574  port compute_met
+0002eba0: 612c 206d 6574 615f 6672 6f6d 5f61 7272  a, meta_from_arr
+0002ebb0: 6179 0a                                  ay.
```

### Comparing `dask-2024.5.0/dask/array/creation.py` & `dask-2024.5.1/dask/array/creation.py`

 * *Files 0% similar despite different names*

```diff
@@ -18,15 +18,15 @@
     blockwise,
     broadcast_arrays,
     broadcast_to,
     concatenate,
     normalize_chunks,
     stack,
 )
-from dask.array.numpy_compat import AxisError
+from dask.array.numpy_compat import NUMPY_GE_200, AxisError
 from dask.array.ufunc import greater_equal, rint
 from dask.array.utils import meta_from_array
 from dask.array.wrap import empty, full, ones, zeros
 from dask.base import tokenize
 from dask.highlevelgraph import HighLevelGraph
 from dask.utils import cached_cumsum, derived_from, is_cupy_type
 
@@ -497,17 +497,18 @@
 
         grid.append(r)
 
     if not sparse:
         grid = broadcast_arrays(*grid)
 
     if indexing == "xy" and len(xi) > 1:
-        grid[0], grid[1] = grid[1], grid[0]
+        grid = (grid[1], grid[0], *grid[2:])
 
-    return grid
+    out_type = tuple if NUMPY_GE_200 else list
+    return out_type(grid)
 
 
 def indices(dimensions, dtype=int, chunks="auto"):
     """
     Implements NumPy's ``indices`` for Dask Arrays.
 
     Generates a grid of indices covering the dimensions provided.
```

### Comparing `dask-2024.5.0/dask/array/cupy_entry_point.py` & `dask-2024.5.1/dask/array/cupy_entry_point.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/dispatch.py` & `dask-2024.5.1/dask/array/dispatch.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/einsumfuncs.py` & `dask-2024.5.1/dask/array/einsumfuncs.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/fft.py` & `dask-2024.5.1/dask/array/fft.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/gufunc.py` & `dask-2024.5.1/dask/array/gufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/image.py` & `dask-2024.5.1/dask/array/image.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/linalg.py` & `dask-2024.5.1/dask/array/linalg.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/ma.py` & `dask-2024.5.1/dask/array/ma.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/numpy_compat.py` & `dask-2024.5.1/dask/array/numpy_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/optimization.py` & `dask-2024.5.1/dask/array/optimization.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/overlap.py` & `dask-2024.5.1/dask/array/overlap.py`

 * *Files 0% similar despite different names*

```diff
@@ -350,15 +350,15 @@
             new += c
     if new >= size:
         output.append(new)
     elif len(output) >= 1:
         output[-1] += new
     else:
         raise ValueError(
-            f"The overlapping depth {size} is larger than your " f"array {sum(chunks)}."
+            f"The overlapping depth {size} is larger than your array {sum(chunks)}."
         )
 
     return tuple(output)
 
 
 def overlap(x, depth, boundary, *, allow_rechunk=True):
     """Share boundaries between neighboring blocks
```

### Comparing `dask-2024.5.0/dask/array/percentile.py` & `dask-2024.5.1/dask/array/percentile.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/random.py` & `dask-2024.5.1/dask/array/random.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/rechunk.py` & `dask-2024.5.1/dask/array/rechunk.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/reductions.py` & `dask-2024.5.1/dask/array/reductions.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/reshape.py` & `dask-2024.5.1/dask/array/reshape.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/routines.py` & `dask-2024.5.1/dask/array/routines.py`

 * *Files 0% similar despite different names*

```diff
@@ -79,14 +79,16 @@
             x = x[:, :, None]
 
         new_arys.append(x)
 
     if len(new_arys) == 1:
         return new_arys[0]
     else:
+        if NUMPY_GE_200:
+            new_arys = tuple(new_arys)
         return new_arys
 
 
 @derived_from(np)
 def atleast_2d(*arys):
     new_arys = []
     for x in arys:
@@ -97,14 +99,16 @@
             x = x[None, :]
 
         new_arys.append(x)
 
     if len(new_arys) == 1:
         return new_arys[0]
     else:
+        if NUMPY_GE_200:
+            new_arys = tuple(new_arys)
         return new_arys
 
 
 @derived_from(np)
 def atleast_1d(*arys):
     new_arys = []
     for x in arys:
@@ -113,14 +117,16 @@
             x = x[None]
 
         new_arys.append(x)
 
     if len(new_arys) == 1:
         return new_arys[0]
     else:
+        if NUMPY_GE_200:
+            new_arys = tuple(new_arys)
         return new_arys
 
 
 @derived_from(np)
 def vstack(tup, allow_unknown_chunksizes=False):
     if isinstance(tup, Array):
         raise NotImplementedError(
```

### Comparing `dask-2024.5.0/dask/array/slicing.py` & `dask-2024.5.1/dask/array/slicing.py`

 * *Files 1% similar despite different names*

```diff
@@ -11,15 +11,15 @@
 import numpy as np
 from tlz import concat, memoize, merge, pluck
 
 from dask import config, core, utils
 from dask.array.chunk import getitem
 from dask.base import is_dask_collection, tokenize
 from dask.highlevelgraph import HighLevelGraph
-from dask.utils import cached_cumsum, is_arraylike
+from dask.utils import _deprecated, cached_cumsum, is_arraylike
 
 colon = slice(None, None, None)
 
 
 def _sanitize_index_element(ind):
     """Sanitize a one-element index."""
     if isinstance(ind, Number):
@@ -1669,16 +1669,16 @@
 
             If index is dask array then a dask array is returned.
 
         """
         return np.sum(index[loc0:loc1])
 
     @functools.lru_cache
-    def n_preceeding_from_1d_bool_index(dim, loc0):
-        """Number of True index elements preceeding position loc0.
+    def n_preceding_from_1d_bool_index(dim, loc0):
+        """Number of True index elements preceding position loc0.
 
         The index is the input assignment index that is defined in the
         namespace of the caller.
 
         Parameters
         ----------
         dim : `int`
@@ -1694,14 +1694,18 @@
             returned.
 
             If index is dask array then a dask array is returned.
 
         """
         return np.sum(index[:loc0])
 
+    @_deprecated(message=("Please use `n_preceding_from_1d_bool_index` instead."))
+    def n_preceeding_from_1d_bool_index(dim, loc0):
+        return n_preceding_from_1d_bool_index(dim, loc0)
+
     @functools.lru_cache
     def value_indices_from_1d_int_index(dim, vsize, loc0, loc1):
         """Value indices for index elements between loc0 and loc1.
 
         The index is the input assignment index that is defined in the
         namespace of the caller. It is assumed that negative elements
         have already been posified.
@@ -1900,25 +1904,25 @@
         # (which will be used to define a new dask entry):
         #
         # block_indices: The indices that will be used to assign to
         #                this block.
         #
         # block_indices_shape: The shape implied by block_indices.
         #
-        # block_preceeding_sizes: How many assigned elements precede
-        #                         this block along each dimension that
-        #                         doesn't have an integer. It is
-        #                         assumed that a slice will have a
-        #                         positive step, as will be the case
-        #                         for reformatted indices. `None` is
-        #                         used for dimensions with 1-d integer
-        #                         arrays.
+        # block_preceding_sizes: How many assigned elements precede
+        #                        this block along each dimension that
+        #                        doesn't have an integer. It is
+        #                        assumed that a slice will have a
+        #                        positive step, as will be the case
+        #                        for reformatted indices. `None` is
+        #                        used for dimensions with 1-d integer
+        #                        arrays.
         block_indices = []
         block_indices_shape = []
-        block_preceeding_sizes = []
+        block_preceding_sizes = []
 
         local_offset = offset
 
         # Assume, until demonstrated otherwise, that this block
         # overlaps the assignment indices.
         overlaps = True
 
@@ -1946,17 +1950,17 @@
                 step = index.step
                 block_index = slice(start, stop, step)
                 block_index_size, rem = divmod(stop - start, step)
                 if rem:
                     block_index_size += 1
 
                 pre = index.indices(loc0)
-                n_preceeding, rem = divmod(pre[1] - pre[0], step)
+                n_preceding, rem = divmod(pre[1] - pre[0], step)
                 if rem:
-                    n_preceeding += 1
+                    n_preceding += 1
 
             elif integer_index:
                 # Index is an integer
                 local_offset += 1
                 if not loc0 <= index < loc1:
                     # This block does not overlap the integer index
                     overlaps = False
@@ -1968,18 +1972,18 @@
                 # Index is a 1-d array
                 is_bool = index.dtype == bool
                 block_index = block_index_from_1d_index(dim, loc0, loc1, is_bool)
                 if is_bool:
                     block_index_size = block_index_shape_from_1d_bool_index(
                         dim, loc0, loc1
                     )
-                    n_preceeding = n_preceeding_from_1d_bool_index(dim, loc0)
+                    n_preceding = n_preceding_from_1d_bool_index(dim, loc0)
                 else:
                     block_index_size = None
-                    n_preceeding = None
+                    n_preceding = None
                     dim_1d_int_index = dim
                     loc0_loc1 = loc0, loc1
 
                 if not is_dask_collection(index) and not block_index.size:
                     # This block does not overlap the 1-d numpy array
                     # index
                     overlaps = False
@@ -1995,15 +1999,15 @@
                 #       through unchanged.
 
             # Still here? This block overlaps the index for this
             # dimension.
             block_indices.append(block_index)
             if not integer_index:
                 block_indices_shape.append(block_index_size)
-                block_preceeding_sizes.append(n_preceeding)
+                block_preceding_sizes.append(n_preceding)
 
         # The new dask key
         out_key = out_name + in_key[1:]
 
         if not overlaps:
             # This block does not overlap the indices for all
             # dimensions, so pass the block through unchanged.
@@ -2027,15 +2031,15 @@
                 index = indices[j]
 
                 value_indices[i] = value_indices_from_1d_int_index(
                     dim_1d_int_index, value_shape[i + value_offset], *loc0_loc1
                 )
             else:
                 # Index is a slice or 1-d boolean array
-                start = block_preceeding_sizes[j]
+                start = block_preceding_sizes[j]
                 value_indices[i] = slice(start, start + block_indices_shape[j])
 
         # If required as a consequence of reformatting any slice
         # objects of the original indices to have a positive steps,
         # reverse the indices to assignment value.
         for i in reverse:
             size = value_common_shape[i]
@@ -2067,15 +2071,15 @@
         dsk = merge(dict(v.dask), dsk)
 
         # Define the assignment function for this block.
         dsk[out_key] = (setitem, in_key, v_key, block_indices)
 
     block_index_from_1d_index.cache_clear()
     block_index_shape_from_1d_bool_index.cache_clear()
-    n_preceeding_from_1d_bool_index.cache_clear()
+    n_preceding_from_1d_bool_index.cache_clear()
     value_indices_from_1d_int_index.cache_clear()
 
     return dsk
 
 
 def setitem(x, v, indices):
     """Chunk function of `setitem_array`.
@@ -2154,11 +2158,11 @@
     x = x.copy()
 
     # Do the assignment
     try:
         x[tuple(indices)] = v
     except ValueError as e:
         raise ValueError(
-            "shape mismatch: value array could " "not be broadcast to indexing result"
+            "shape mismatch: value array could not be broadcast to indexing result"
         ) from e
 
     return x
```

### Comparing `dask-2024.5.0/dask/array/stats.py` & `dask-2024.5.1/dask/array/stats.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/svg.py` & `dask-2024.5.1/dask/array/svg.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_array_core.py` & `dask-2024.5.1/dask/array/tests/test_array_core.py`

 * *Files 1% similar despite different names*

```diff
@@ -1104,15 +1104,15 @@
 
     d_a_0 = d_a[None, :]
     d_a_1 = d_a[:, None]
 
     a_r = np.broadcast_arrays(a_0, a_1)
     d_r = da.broadcast_arrays(d_a_0, d_a_1)
 
-    assert isinstance(d_r, list)
+    assert isinstance(d_r, (list, tuple))
     assert len(a_r) == len(d_r)
 
     for e_a_r, e_d_r in zip(a_r, d_r):
         assert_eq(e_a_r, e_d_r)
 
 
 def test_broadcast_arrays_uneven_chunks():
```

### Comparing `dask-2024.5.0/dask/array/tests/test_array_function.py` & `dask-2024.5.1/dask/array/tests/test_array_function.py`

 * *Files 2% similar despite different names*

```diff
@@ -1,11 +1,12 @@
 from __future__ import annotations
 
 import numpy as np
 import pytest
+from packaging.version import Version
 
 import dask.array as da
 from dask.array.tests.test_dispatch import EncapsulateNDArray, WrappedArray
 from dask.array.utils import assert_eq
 
 
 @pytest.mark.parametrize(
@@ -95,14 +96,16 @@
 
 
 @pytest.mark.parametrize(
     "func", [lambda x: np.real(x), lambda x: np.imag(x), lambda x: np.transpose(x)]
 )
 def test_array_function_sparse(func):
     sparse = pytest.importorskip("sparse")
+    if Version(sparse.__version__) >= Version("0.15.2"):
+        pytest.skip(reason="https://github.com/pydata/sparse/issues/682")
     x = da.random.default_rng().random((500, 500), chunks=(100, 100))
     x[x < 0.9] = 0
 
     y = x.map_blocks(sparse.COO)
 
     assert_eq(func(x), func(y))
```

### Comparing `dask-2024.5.0/dask/array/tests/test_array_utils.py` & `dask-2024.5.1/dask/array/tests/test_array_utils.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_atop.py` & `dask-2024.5.1/dask/array/tests/test_atop.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_chunk.py` & `dask-2024.5.1/dask/array/tests/test_chunk.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_creation.py` & `dask-2024.5.1/dask/array/tests/test_creation.py`

 * *Files 1% similar despite different names*

```diff
@@ -377,15 +377,15 @@
         do[0], do[1] = do[1], do[0]
         xi_dc[0], xi_dc[1] = xi_dc[1], xi_dc[0]
     xi_dc = tuple(xi_dc)
 
     r_a = np.meshgrid(*xi_a, indexing=indexing, sparse=sparse)
     r_d = da.meshgrid(*xi_d, indexing=indexing, sparse=sparse)
 
-    assert isinstance(r_d, list)
+    assert type(r_d) is type(r_a)
     assert len(r_a) == len(r_d)
 
     for e_r_a, e_r_d, i in zip(r_a, r_d, do):
         assert_eq(e_r_a, e_r_d)
         if sparse:
             assert e_r_d.chunks[i] == xi_dc[i]
         else:
```

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_core.py` & `dask-2024.5.1/dask/array/tests/test_cupy_core.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_creation.py` & `dask-2024.5.1/dask/array/tests/test_cupy_creation.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_gufunc.py` & `dask-2024.5.1/dask/array/tests/test_cupy_gufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_linalg.py` & `dask-2024.5.1/dask/array/tests/test_cupy_linalg.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_overlap.py` & `dask-2024.5.1/dask/array/tests/test_cupy_overlap.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_percentile.py` & `dask-2024.5.1/dask/array/tests/test_cupy_percentile.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_random.py` & `dask-2024.5.1/dask/array/tests/test_cupy_random.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_reductions.py` & `dask-2024.5.1/dask/array/tests/test_cupy_reductions.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_routines.py` & `dask-2024.5.1/dask/array/tests/test_cupy_routines.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_slicing.py` & `dask-2024.5.1/dask/array/tests/test_cupy_slicing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_cupy_sparse.py` & `dask-2024.5.1/dask/array/tests/test_cupy_sparse.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_dispatch.py` & `dask-2024.5.1/dask/array/tests/test_dispatch.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_fft.py` & `dask-2024.5.1/dask/array/tests/test_fft.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_gufunc.py` & `dask-2024.5.1/dask/array/tests/test_gufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_image.py` & `dask-2024.5.1/dask/array/tests/test_image.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_linalg.py` & `dask-2024.5.1/dask/array/tests/test_linalg.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_masked.py` & `dask-2024.5.1/dask/array/tests/test_masked.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_numpy_compat.py` & `dask-2024.5.1/dask/array/tests/test_numpy_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_optimization.py` & `dask-2024.5.1/dask/array/tests/test_optimization.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_overlap.py` & `dask-2024.5.1/dask/array/tests/test_overlap.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_percentiles.py` & `dask-2024.5.1/dask/array/tests/test_percentiles.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_random.py` & `dask-2024.5.1/dask/array/tests/test_random.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_rechunk.py` & `dask-2024.5.1/dask/array/tests/test_rechunk.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_reductions.py` & `dask-2024.5.1/dask/array/tests/test_reductions.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_reshape.py` & `dask-2024.5.1/dask/array/tests/test_reshape.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_routines.py` & `dask-2024.5.1/dask/array/tests/test_routines.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_slicing.py` & `dask-2024.5.1/dask/array/tests/test_slicing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_sparse.py` & `dask-2024.5.1/dask/array/tests/test_sparse.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_stats.py` & `dask-2024.5.1/dask/array/tests/test_stats.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_svg.py` & `dask-2024.5.1/dask/array/tests/test_svg.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_testing.py` & `dask-2024.5.1/dask/array/tests/test_testing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_ufunc.py` & `dask-2024.5.1/dask/array/tests/test_ufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_wrap.py` & `dask-2024.5.1/dask/array/tests/test_wrap.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tests/test_xarray.py` & `dask-2024.5.1/dask/array/tests/test_xarray.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/tiledb_io.py` & `dask-2024.5.1/dask/array/tiledb_io.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/ufunc.py` & `dask-2024.5.1/dask/array/ufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/utils.py` & `dask-2024.5.1/dask/array/utils.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/array/wrap.py` & `dask-2024.5.1/dask/array/wrap.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/backends.py` & `dask-2024.5.1/dask/backends.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/__init__.py` & `dask-2024.5.1/dask/bag/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/avro.py` & `dask-2024.5.1/dask/bag/avro.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/chunk.py` & `dask-2024.5.1/dask/bag/chunk.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/core.py` & `dask-2024.5.1/dask/bag/core.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/random.py` & `dask-2024.5.1/dask/bag/random.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/tests/test_avro.py` & `dask-2024.5.1/dask/bag/tests/test_avro.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/tests/test_bag.py` & `dask-2024.5.1/dask/bag/tests/test_bag.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/tests/test_random.py` & `dask-2024.5.1/dask/bag/tests/test_random.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/tests/test_text.py` & `dask-2024.5.1/dask/bag/tests/test_text.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bag/text.py` & `dask-2024.5.1/dask/bag/text.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/base.py` & `dask-2024.5.1/dask/base.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/blockwise.py` & `dask-2024.5.1/dask/blockwise.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bytes/core.py` & `dask-2024.5.1/dask/bytes/core.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bytes/tests/test_bytes_utils.py` & `dask-2024.5.1/dask/bytes/tests/test_bytes_utils.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bytes/tests/test_compression.py` & `dask-2024.5.1/dask/bytes/tests/test_compression.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bytes/tests/test_http.py` & `dask-2024.5.1/dask/bytes/tests/test_http.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/bytes/tests/test_local.py` & `dask-2024.5.1/dask/bytes/tests/test_local.py`

 * *Files 1% similar despite different names*

```diff
@@ -34,17 +34,17 @@
         b'{"amount": 700, "name": "Charlie"}\n'
         b'{"amount": 800, "name": "Dennis"}\n'
     ),
 }
 
 
 csv_files = {
-    ".test.fakedata.1.csv": (b"a,b\n" b"1,2\n"),
-    ".test.fakedata.2.csv": (b"a,b\n" b"3,4\n"),
-    "subdir/.test.fakedata.2.csv": (b"a,b\n" b"5,6\n"),
+    ".test.fakedata.1.csv": (b"a,b\n1,2\n"),
+    ".test.fakedata.2.csv": (b"a,b\n3,4\n"),
+    "subdir/.test.fakedata.2.csv": (b"a,b\n5,6\n"),
 }
 
 
 def to_uri(path):
     return pathlib.Path(os.path.abspath(path)).as_uri()
```

### Comparing `dask-2024.5.0/dask/bytes/tests/test_s3.py` & `dask-2024.5.1/dask/bytes/tests/test_s3.py`

 * *Files 3% similar despite different names*

```diff
@@ -443,16 +443,22 @@
         "pyarrow",
         pytest.param(
             "fastparquet", marks=pytest.mark.filterwarnings("ignore::FutureWarning")
         ),
     ]
 )
 def engine(request):
-    pytest.importorskip(request.param)
     import dask.dataframe as dd
+    from dask.array.numpy_compat import NUMPY_GE_200
+
+    if NUMPY_GE_200 and request.param == "fastparquet":
+        # https://github.com/dask/fastparquet/issues/923
+        pytest.skip("fastparquet doesn't work with Numpy 2")
+
+    pytest.importorskip(request.param)
 
     if dd._dask_expr_enabled() and request.param == "fastparquet":
         pytest.skip("not supported")
     return request.param
 
 
 @pytest.mark.parametrize("metadata_file", [True, False])
@@ -552,16 +558,14 @@
     dd.utils.assert_eq(data, df4)
 
 
 def test_parquet_append(s3, engine, s3so):
     dd = pytest.importorskip("dask.dataframe")
     pd = pytest.importorskip("pandas")
     np = pytest.importorskip("numpy")
-    if dd._dask_expr_enabled():
-        pytest.skip("need convert string option")
 
     url = "s3://%s/test.parquet.append" % test_bucket_name
 
     data = pd.DataFrame(
         {
             "i32": np.arange(1000, dtype=np.int32),
             "i64": np.arange(1000, dtype=np.int64),
```

### Comparing `dask-2024.5.0/dask/cache.py` & `dask-2024.5.1/dask/cache.py`

 * *Files 4% similar despite different names*

```diff
@@ -31,15 +31,15 @@
     """
 
     def __init__(self, cache, *args, **kwargs):
         try:
             import cachey
         except ImportError as ex:
             raise ImportError(
-                'Cache requires cachey, "{ex}" problem ' "importing".format(ex=str(ex))
+                f'Cache requires cachey, "{str(ex)}" problem importing'
             ) from ex
         self._nbytes = cachey.nbytes
         if isinstance(cache, Number):
             cache = cachey.Cache(cache, *args, **kwargs)
         else:
             assert not args and not kwargs
         self.cache = cache
```

### Comparing `dask-2024.5.0/dask/callbacks.py` & `dask-2024.5.1/dask/callbacks.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/cli.py` & `dask-2024.5.1/dask/cli.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/compatibility.py` & `dask-2024.5.1/dask/compatibility.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/config.py` & `dask-2024.5.1/dask/config.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/conftest.py` & `dask-2024.5.1/dask/conftest.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/context.py` & `dask-2024.5.1/dask/context.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/core.py` & `dask-2024.5.1/dask/core.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dask-schema.yaml` & `dask-2024.5.1/dask/dask-schema.yaml`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dask.yaml` & `dask-2024.5.1/dask/dask.yaml`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/__init__.py` & `dask-2024.5.1/dask/dataframe/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/_compat.py` & `dask-2024.5.1/dask/dataframe/_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/_dtypes.py` & `dask-2024.5.1/dask/dataframe/_dtypes.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/_pyarrow.py` & `dask-2024.5.1/dask/dataframe/_pyarrow.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/_pyarrow_compat.py` & `dask-2024.5.1/dask/dataframe/_pyarrow_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/accessor.py` & `dask-2024.5.1/dask/dataframe/accessor.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/backends.py` & `dask-2024.5.1/dask/dataframe/backends.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/categorical.py` & `dask-2024.5.1/dask/dataframe/categorical.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/core.py` & `dask-2024.5.1/dask/dataframe/core.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/dispatch.py` & `dask-2024.5.1/dask/dataframe/dispatch.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/extensions.py` & `dask-2024.5.1/dask/dataframe/extensions.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/groupby.py` & `dask-2024.5.1/dask/dataframe/groupby.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/hyperloglog.py` & `dask-2024.5.1/dask/dataframe/hyperloglog.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/indexing.py` & `dask-2024.5.1/dask/dataframe/indexing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/__init__.py` & `dask-2024.5.1/dask/dataframe/io/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/csv.py` & `dask-2024.5.1/dask/dataframe/io/csv.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/demo.py` & `dask-2024.5.1/dask/dataframe/io/demo.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/hdf.py` & `dask-2024.5.1/dask/dataframe/io/hdf.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/io.py` & `dask-2024.5.1/dask/dataframe/io/io.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/json.py` & `dask-2024.5.1/dask/dataframe/io/json.py`

 * *Files 2% similar despite different names*

```diff
@@ -69,17 +69,15 @@
         Function accepting an integer (partition index) and producing a
         string to replace the asterisk in the given filename globstring.
         Should preserve the lexicographic order of partitions.
     """
     if lines is None:
         lines = orient == "records"
     if orient != "records" and lines:
-        raise ValueError(
-            "Line-delimited JSON is only available with" 'orient="records".'
-        )
+        raise ValueError('Line-delimited JSON is only available with orient="records".')
     kwargs["orient"] = orient
     kwargs["lines"] = lines and orient == "records"
     outfiles = open_files(
         url_path,
         "wt",
         encoding=encoding,
         errors=errors,
@@ -196,17 +194,15 @@
     256MB size
 
     >> dd.read_json('data/file*.csv', blocksize=2**28)
     """
     if lines is None:
         lines = orient == "records"
     if orient != "records" and lines:
-        raise ValueError(
-            "Line-delimited JSON is only available with" 'orient="records".'
-        )
+        raise ValueError('Line-delimited JSON is only available with orient="records".')
     if blocksize and (orient != "records" or not lines):
         raise ValueError(
             "JSON file chunking only allowed for JSON-lines"
             "input (orient='records', lines=True)."
         )
     storage_options = storage_options or {}
     if include_path_column is True:
```

### Comparing `dask-2024.5.0/dask/dataframe/io/orc/arrow.py` & `dask-2024.5.1/dask/dataframe/io/orc/arrow.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/orc/core.py` & `dask-2024.5.1/dask/dataframe/io/orc/core.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/parquet/arrow.py` & `dask-2024.5.1/dask/dataframe/io/parquet/arrow.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/parquet/core.py` & `dask-2024.5.1/dask/dataframe/io/parquet/core.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/parquet/fastparquet.py` & `dask-2024.5.1/dask/dataframe/io/parquet/fastparquet.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/parquet/utils.py` & `dask-2024.5.1/dask/dataframe/io/parquet/utils.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/sql.py` & `dask-2024.5.1/dask/dataframe/io/sql.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/tests/test_csv.py` & `dask-2024.5.1/dask/dataframe/io/tests/test_csv.py`

 * *Files 0% similar despite different names*

```diff
@@ -98,21 +98,17 @@
 2015-08-21,201.729996,203.940002,197.520004,197.630005,328271500,197.630005
 2015-08-20,206.509995,208.289993,203.899994,204.009995,185865600,204.009995
 2015-08-19,209.089996,210.009995,207.350006,208.279999,167316300,208.279999
 2015-08-18,210.259995,210.679993,209.699997,209.929993,70043800,209.929993
 """.strip()
 
 csv_files = {
-    "2014-01-01.csv": (
-        b"name,amount,id\n" b"Alice,100,1\n" b"Bob,200,2\n" b"Charlie,300,3\n"
-    ),
+    "2014-01-01.csv": b"name,amount,id\nAlice,100,1\nBob,200,2\nCharlie,300,3\n",
     "2014-01-02.csv": b"name,amount,id\n",
-    "2014-01-03.csv": (
-        b"name,amount,id\n" b"Dennis,400,4\n" b"Edith,500,5\n" b"Frank,600,6\n"
-    ),
+    "2014-01-03.csv": b"name,amount,id\nDennis,400,4\nEdith,500,5\nFrank,600,6\n",
 }
 
 tsv_files = {k: v.replace(b",", b"\t") for (k, v) in csv_files.items()}
 
 fwf_files = {
     "2014-01-01.csv": (
         b"    name  amount  id\n"
```

### Comparing `dask-2024.5.0/dask/dataframe/io/tests/test_demo.py` & `dask-2024.5.1/dask/dataframe/io/tests/test_demo.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/tests/test_hdf.py` & `dask-2024.5.1/dask/dataframe/io/tests/test_hdf.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/tests/test_io.py` & `dask-2024.5.1/dask/dataframe/io/tests/test_io.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/tests/test_json.py` & `dask-2024.5.1/dask/dataframe/io/tests/test_json.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/tests/test_orc.py` & `dask-2024.5.1/dask/dataframe/io/tests/test_orc.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/io/tests/test_parquet.py` & `dask-2024.5.1/dask/dataframe/io/tests/test_parquet.py`

 * *Files 0% similar despite different names*

```diff
@@ -728,16 +728,14 @@
     ddf2.loc[:1000].compute()
     assert (df.x == ddf2.x.compute()).all()
 
 
 @pytest.mark.parametrize("metadata_file", [False, True])
 def test_append(tmpdir, engine, metadata_file):
     """Test that appended parquet equal to the original one."""
-    if DASK_EXPR_ENABLED and metadata_file:
-        pytest.xfail("doesn't work yet")
     tmp = str(tmpdir)
     df = pd.DataFrame(
         {
             "i32": np.arange(1000, dtype=np.int32),
             "i64": np.arange(1000, dtype=np.int64),
             "f": np.arange(1000, dtype=np.float64),
             "bhello": np.random.choice(["hello", "yo", "people"], size=1000).astype(
@@ -916,16 +914,14 @@
     df = dd.read_parquet(tmp, columns="b", engine=engine)
     assert set(df.cat.categories) == {"x", "y", "z"}
 
 
 @pytest.mark.parametrize("metadata_file", [False, True])
 def test_append_wo_index(tmpdir, engine, metadata_file):
     """Test append with write_index=False."""
-    if DASK_EXPR_ENABLED and metadata_file:
-        pytest.xfail("doesn't work yet")
     tmp = str(tmpdir.join("tmp1.parquet"))
     df = pd.DataFrame(
         {
             "i32": np.arange(1000, dtype=np.int32),
             "i64": np.arange(1000, dtype=np.int64),
             "f": np.arange(1000, dtype=np.float64),
             "bhello": np.random.choice(["hello", "yo", "people"], size=1000).astype(
@@ -986,15 +982,14 @@
 
     with pytest.raises(ValueError, match="overlap with previously written divisions"):
         ddf2.to_parquet(tmp, engine=engine, append=True)
 
     ddf2.to_parquet(tmp, engine=engine, append=True, ignore_divisions=True)
 
 
-@pytest.mark.xfail(DASK_EXPR_ENABLED, reason="will be supported after string option")
 def test_append_known_divisions_to_unknown_divisions_works(tmpdir, engine):
     tmp = str(tmpdir)
 
     df1 = pd.DataFrame(
         {"x": np.arange(100), "y": np.arange(100, 200)}, index=np.arange(100, 0, -1)
     )
     ddf1 = dd.from_pandas(df1, npartitions=3, sort=False)
@@ -4347,15 +4342,14 @@
     assert "_common_metadata" in files
     assert "_metadata" in files
     assert "hi-0.parquet" in files
     assert "hi-1.parquet" in files
     assert_eq(df, dd.read_parquet(fn, engine=engine, calculate_divisions=True))
 
 
-@pytest.mark.xfail(DASK_EXPR_ENABLED, reason="Can't hash metadata file at the moment")
 @PYARROW_MARK
 def test_custom_filename_works_with_pyarrow_when_append_is_true(tmpdir):
     fn = str(tmpdir)
     pdf = pd.DataFrame(
         {"num1": [1, 2, 3, 4], "num2": [7, 8, 9, 10]},
     )
     df = dd.from_pandas(pdf, npartitions=2)
```

### Comparing `dask-2024.5.0/dask/dataframe/io/tests/test_sql.py` & `dask-2024.5.1/dask/dataframe/io/tests/test_sql.py`

 * *Files 0% similar despite different names*

```diff
@@ -60,15 +60,15 @@
         # The dtype of the empty result might no longer be as expected
         # assert dask_df.col2.dtype == np.dtype("int64")
         pd_dataframe = dask_df.compute()
         assert pd_dataframe.empty is True
 
 
 @pytest.mark.filterwarnings(
-    "ignore:The default dtype for empty Series " "will be 'object' instead of 'float64'"
+    "ignore:The default dtype for empty Series will be 'object' instead of 'float64'"
 )
 @pytest.mark.parametrize("use_head", [True, False])
 def test_single_column(db, use_head):
     from sqlalchemy import Column, Integer, MetaData, Table, create_engine
 
     with tmpfile() as f:
         uri = "sqlite:///%s" % f
```

### Comparing `dask-2024.5.0/dask/dataframe/io/utils.py` & `dask-2024.5.1/dask/dataframe/io/utils.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/methods.py` & `dask-2024.5.1/dask/dataframe/methods.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/multi.py` & `dask-2024.5.1/dask/dataframe/multi.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/numeric.py` & `dask-2024.5.1/dask/dataframe/numeric.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/optimize.py` & `dask-2024.5.1/dask/dataframe/optimize.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/partitionquantiles.py` & `dask-2024.5.1/dask/dataframe/partitionquantiles.py`

 * *Files 2% similar despite different names*

```diff
@@ -74,16 +74,18 @@
 
 import numpy as np
 import pandas as pd
 from pandas.api.types import is_datetime64_dtype, is_integer_dtype
 from tlz import merge, merge_sorted, take
 
 from dask.base import tokenize
+from dask.dataframe._compat import PANDAS_GE_150
 from dask.dataframe.core import Series
 from dask.dataframe.dispatch import tolist_dispatch
+from dask.dataframe.utils import is_series_like
 from dask.utils import is_cupy_type, random_state_data
 
 
 def sample_percentiles(num_old, num_new, chunk_length, upsample=1.0, random_state=None):
     """Construct percentiles for a chunk for repartitioning.
 
     Adapt the number of total percentiles calculated based on the number
@@ -426,35 +428,44 @@
 
     if isinstance(data.dtype, pd.CategoricalDtype):
         data = data.cat.codes
         interpolation = "nearest"
     elif is_datetime64_dtype(data.dtype) or is_integer_dtype(data.dtype):
         interpolation = "nearest"
 
-    # FIXME: pandas quantile doesn't work with some data types (e.g. strings).
-    # We fall back to an ndarray as a workaround.
     try:
-        vals = data.quantile(q=qs / 100, interpolation=interpolation).values
+        # Plan A: Use `Series.quantile`
+        vals = data.quantile(q=qs / 100, interpolation=interpolation)
     except (TypeError, NotImplementedError):
-        try:
-            vals, _ = _percentile(array_safe(data, like=data.values), qs, interpolation)
-        except (TypeError, NotImplementedError):
-            # `data.values` doesn't work for cudf, so we need to
-            # use `quantile(..., method="table")` as a fallback
+        # Series.quantile doesn't work with some data types (e.g. strings)
+        if PANDAS_GE_150:
+            # Fall back to DataFrame.quantile with "nearest" interpolation
             interpolation = "nearest"
             vals = (
                 data.to_frame()
                 .quantile(
                     q=qs / 100,
                     interpolation=interpolation,
                     numeric_only=False,
                     method="table",
                 )
                 .iloc[:, 0]
             )
+        else:
+            # Fall back to ndarray (Not supported for cuDF)
+            vals, _ = _percentile(array_safe(data, like=data.values), qs, interpolation)
+
+    # Convert to array if necessary (and possible)
+    if is_series_like(vals):
+        try:
+            vals = vals.values
+        except (ValueError, TypeError):
+            # cudf->cupy won't work if nulls are present,
+            # or if this is a string dtype
+            pass
 
     if (
         is_cupy_type(data)
         and interpolation == "linear"
         and np.issubdtype(data.dtype, np.integer)
     ):
         vals = np.round(vals).astype(data.dtype)
```

### Comparing `dask-2024.5.0/dask/dataframe/reshape.py` & `dask-2024.5.1/dask/dataframe/reshape.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/rolling.py` & `dask-2024.5.1/dask/dataframe/rolling.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/shuffle.py` & `dask-2024.5.1/dask/dataframe/shuffle.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_accessors.py` & `dask-2024.5.1/dask/dataframe/tests/test_accessors.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_arithmetics_reduction.py` & `dask-2024.5.1/dask/dataframe/tests/test_arithmetics_reduction.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_boolean.py` & `dask-2024.5.1/dask/dataframe/tests/test_boolean.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_categorical.py` & `dask-2024.5.1/dask/dataframe/tests/test_categorical.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_dataframe.py` & `dask-2024.5.1/dask/dataframe/tests/test_dataframe.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_extensions.py` & `dask-2024.5.1/dask/dataframe/tests/test_extensions.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_format.py` & `dask-2024.5.1/dask/dataframe/tests/test_format.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_groupby.py` & `dask-2024.5.1/dask/dataframe/tests/test_groupby.py`

 * *Files 0% similar despite different names*

```diff
@@ -3031,15 +3031,17 @@
         func, meta=res_pd, **INCLUDE_GROUPS
     )
     res_dc = dcdf.groupby("a", group_keys=group_keys).apply(
         func, meta=cudf.from_pandas(res_pd), **INCLUDE_GROUPS
     )
 
     assert_eq(res_pd, res_dd)
-    assert_eq(res_dd, res_dc)
+    # Pandas and cudf return different `index.name`
+    # for empty MultiIndex (use `check_names=False`)
+    assert_eq(res_dd, res_dc, check_names=False)
 
 
 @pytest.mark.parametrize("sort", [True, False])
 def test_groupby_dropna_with_agg(sort):
     # https://github.com/dask/dask/issues/6986
     df = pd.DataFrame(
         {"id1": ["a", None, "b"], "id2": [1, 2, None], "v1": [4.5, 5.5, None]}
```

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_hashing.py` & `dask-2024.5.1/dask/dataframe/tests/test_hashing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_hyperloglog.py` & `dask-2024.5.1/dask/dataframe/tests/test_hyperloglog.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_indexing.py` & `dask-2024.5.1/dask/dataframe/tests/test_indexing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_merge_column_and_index.py` & `dask-2024.5.1/dask/dataframe/tests/test_merge_column_and_index.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_multi.py` & `dask-2024.5.1/dask/dataframe/tests/test_multi.py`

 * *Files 0% similar despite different names*

```diff
@@ -1131,15 +1131,26 @@
     with pytest.raises(
         ValueError, match="dask.dataframe.merge does not support how='cross'"
     ):
         dd.merge(left, right, how="cross")
 
 
 @pytest.mark.parametrize("parts", [(3, 3), (3, 1), (1, 3)])
-@pytest.mark.parametrize("how", ["leftsemi", "leftanti"])
+@pytest.mark.parametrize(
+    "how",
+    [
+        "leftsemi",
+        pytest.param(
+            "leftanti",
+            marks=pytest.mark.xfail(
+                DASK_EXPR_ENABLED, reason="leftanti is not supported yet"
+            ),
+        ),
+    ],
+)
 @pytest.mark.parametrize(
     "engine",
     [
         pytest.param(
             "pandas",
             marks=pytest.mark.xfail(
                 reason="Pandas does not support leftsemi or leftanti"
```

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_numeric.py` & `dask-2024.5.1/dask/dataframe/tests/test_numeric.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_optimize_dataframe.py` & `dask-2024.5.1/dask/dataframe/tests/test_optimize_dataframe.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_pyarrow.py` & `dask-2024.5.1/dask/dataframe/tests/test_pyarrow.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_pyarrow_compat.py` & `dask-2024.5.1/dask/dataframe/tests/test_pyarrow_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_reshape.py` & `dask-2024.5.1/dask/dataframe/tests/test_reshape.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_rolling.py` & `dask-2024.5.1/dask/dataframe/tests/test_rolling.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_shuffle.py` & `dask-2024.5.1/dask/dataframe/tests/test_shuffle.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_ufunc.py` & `dask-2024.5.1/dask/dataframe/tests/test_ufunc.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tests/test_utils_dataframe.py` & `dask-2024.5.1/dask/dataframe/tests/test_utils_dataframe.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tseries/resample.py` & `dask-2024.5.1/dask/dataframe/tseries/resample.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/tseries/tests/test_resample.py` & `dask-2024.5.1/dask/dataframe/tseries/tests/test_resample.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dataframe/utils.py` & `dask-2024.5.1/dask/dataframe/utils.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/datasets.py` & `dask-2024.5.1/dask/datasets.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/delayed.py` & `dask-2024.5.1/dask/delayed.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/diagnostics/profile.py` & `dask-2024.5.1/dask/diagnostics/profile.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/diagnostics/profile_visualize.py` & `dask-2024.5.1/dask/diagnostics/profile_visualize.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/diagnostics/progress.py` & `dask-2024.5.1/dask/diagnostics/progress.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/diagnostics/tests/test_profiler.py` & `dask-2024.5.1/dask/diagnostics/tests/test_profiler.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/diagnostics/tests/test_progress.py` & `dask-2024.5.1/dask/diagnostics/tests/test_progress.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/distributed.py` & `dask-2024.5.1/dask/distributed.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/dot.py` & `dask-2024.5.1/dask/dot.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/graph_manipulation.py` & `dask-2024.5.1/dask/graph_manipulation.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/hashing.py` & `dask-2024.5.1/dask/hashing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/highlevelgraph.py` & `dask-2024.5.1/dask/highlevelgraph.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/layers.py` & `dask-2024.5.1/dask/layers.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/local.py` & `dask-2024.5.1/dask/local.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/multiprocessing.py` & `dask-2024.5.1/dask/multiprocessing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/optimization.py` & `dask-2024.5.1/dask/optimization.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/order.py` & `dask-2024.5.1/dask/order.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/rewrite.py` & `dask-2024.5.1/dask/rewrite.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/sizeof.py` & `dask-2024.5.1/dask/sizeof.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/system.py` & `dask-2024.5.1/dask/system.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_backends.py` & `dask-2024.5.1/dask/tests/test_backends.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_base.py` & `dask-2024.5.1/dask/tests/test_base.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_cache.py` & `dask-2024.5.1/dask/tests/test_cache.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_callbacks.py` & `dask-2024.5.1/dask/tests/test_callbacks.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_ci.py` & `dask-2024.5.1/dask/tests/test_ci.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_cli.py` & `dask-2024.5.1/dask/tests/test_cli.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_config.py` & `dask-2024.5.1/dask/tests/test_config.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_context.py` & `dask-2024.5.1/dask/tests/test_context.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_core.py` & `dask-2024.5.1/dask/tests/test_core.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_datasets.py` & `dask-2024.5.1/dask/tests/test_datasets.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_delayed.py` & `dask-2024.5.1/dask/tests/test_delayed.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_distributed.py` & `dask-2024.5.1/dask/tests/test_distributed.py`

 * *Files 2% similar despite different names*

```diff
@@ -349,14 +349,55 @@
         a = da.zeros((3, 3), chunks=(1, 1))
         a.to_zarr(d)
         a2 = da.from_zarr(d)
         da.assert_eq(a, a2, scheduler=c)
         assert a2.chunks == a.chunks
 
 
+def test_zarr_distributed_with_explicit_directory_store(c):
+    pytest.importorskip("numpy")
+    da = pytest.importorskip("dask.array")
+    zarr = pytest.importorskip("zarr")
+
+    with tmpdir() as d:
+        chunks = (1, 1)
+        a = da.zeros((3, 3), chunks=chunks)
+        s = zarr.storage.DirectoryStore(d)
+        z = zarr.creation.open_array(
+            shape=a.shape,
+            chunks=chunks,
+            dtype=a.dtype,
+            store=s,
+            mode="a",
+        )
+        a.to_zarr(z)
+        a2 = da.from_zarr(d)
+        da.assert_eq(a, a2, scheduler=c)
+        assert a2.chunks == a.chunks
+
+
+def test_zarr_distributed_with_explicit_memory_store(c):
+    pytest.importorskip("numpy")
+    da = pytest.importorskip("dask.array")
+    zarr = pytest.importorskip("zarr")
+
+    chunks = (1, 1)
+    a = da.zeros((3, 3), chunks=chunks)
+    s = zarr.storage.MemoryStore()
+    z = zarr.creation.open_array(
+        shape=a.shape,
+        chunks=chunks,
+        dtype=a.dtype,
+        store=s,
+        mode="a",
+    )
+    with pytest.raises(RuntimeError, match="distributed scheduler"):
+        a.to_zarr(z)
+
+
 def test_zarr_in_memory_distributed_err(c):
     pytest.importorskip("numpy")
     da = pytest.importorskip("dask.array")
     zarr = pytest.importorskip("zarr")
 
     chunks = (1, 1)
     a = da.ones((3, 3), chunks=chunks)
```

### Comparing `dask-2024.5.0/dask/tests/test_docs.py` & `dask-2024.5.1/dask/tests/test_docs.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_dot.py` & `dask-2024.5.1/dask/tests/test_dot.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_graph_manipulation.py` & `dask-2024.5.1/dask/tests/test_graph_manipulation.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_hashing.py` & `dask-2024.5.1/dask/tests/test_hashing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_highgraph.py` & `dask-2024.5.1/dask/tests/test_highgraph.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_layers.py` & `dask-2024.5.1/dask/tests/test_layers.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_local.py` & `dask-2024.5.1/dask/tests/test_local.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_multiprocessing.py` & `dask-2024.5.1/dask/tests/test_multiprocessing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_optimization.py` & `dask-2024.5.1/dask/tests/test_optimization.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_order.py` & `dask-2024.5.1/dask/tests/test_order.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_rewrite.py` & `dask-2024.5.1/dask/tests/test_rewrite.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_sizeof.py` & `dask-2024.5.1/dask/tests/test_sizeof.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_spark_compat.py` & `dask-2024.5.1/dask/tests/test_spark_compat.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_system.py` & `dask-2024.5.1/dask/tests/test_system.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_threaded.py` & `dask-2024.5.1/dask/tests/test_threaded.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_tokenize.py` & `dask-2024.5.1/dask/tests/test_tokenize.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_traceback.py` & `dask-2024.5.1/dask/tests/test_traceback.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_typing.py` & `dask-2024.5.1/dask/tests/test_typing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_utils.py` & `dask-2024.5.1/dask/tests/test_utils.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/tests/test_utils_test.py` & `dask-2024.5.1/dask/tests/test_utils_test.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/threaded.py` & `dask-2024.5.1/dask/threaded.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/typing.py` & `dask-2024.5.1/dask/typing.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/utils.py` & `dask-2024.5.1/dask/utils.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/utils_test.py` & `dask-2024.5.1/dask/utils_test.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/widgets/__init__.py` & `dask-2024.5.1/dask/widgets/__init__.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/widgets/templates/array.html.j2` & `dask-2024.5.1/dask/widgets/templates/array.html.j2`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/widgets/templates/highlevelgraph.html.j2` & `dask-2024.5.1/dask/widgets/templates/highlevelgraph.html.j2`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/widgets/templates/highlevelgraph_layer.html.j2` & `dask-2024.5.1/dask/widgets/templates/highlevelgraph_layer.html.j2`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/widgets/tests/test_widgets.py` & `dask-2024.5.1/dask/widgets/tests/test_widgets.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask/widgets/widgets.py` & `dask-2024.5.1/dask/widgets/widgets.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/dask.egg-info/PKG-INFO` & `dask-2024.5.1/dask.egg-info/PKG-INFO`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: dask
-Version: 2024.5.0
+Version: 2024.5.1
 Summary: Parallel PyData with Task Scheduling
 Maintainer-email: Matthew Rocklin <mrocklin@gmail.com>
 License: BSD-3-Clause
 Project-URL: Homepage, https://github.com/dask/dask/
 Keywords: task-scheduling parallel numpy pandas pydata
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
@@ -36,15 +36,15 @@
 Requires-Dist: numpy>=1.21; extra == "array"
 Provides-Extra: bag
 Provides-Extra: dataframe
 Requires-Dist: dask[array]; extra == "dataframe"
 Requires-Dist: pandas>=1.3; extra == "dataframe"
 Requires-Dist: dask-expr<1.2,>=1.1; extra == "dataframe"
 Provides-Extra: distributed
-Requires-Dist: distributed==2024.5.0; extra == "distributed"
+Requires-Dist: distributed==2024.5.1; extra == "distributed"
 Provides-Extra: diagnostics
 Requires-Dist: bokeh>=2.4.2; extra == "diagnostics"
 Requires-Dist: jinja2>=2.10.3; extra == "diagnostics"
 Provides-Extra: delayed
 Provides-Extra: complete
 Requires-Dist: dask[array,dataframe,diagnostics,distributed]; extra == "complete"
 Requires-Dist: pyarrow>=7.0; extra == "complete"
```

### Comparing `dask-2024.5.0/dask.egg-info/SOURCES.txt` & `dask-2024.5.1/dask.egg-info/SOURCES.txt`

 * *Files 0% similar despite different names*

```diff
@@ -356,14 +356,15 @@
 docs/source/graphviz.rst
 docs/source/high-level-graphs.rst
 docs/source/index.rst
 docs/source/install.rst
 docs/source/internals.rst
 docs/source/logos.rst
 docs/source/maintainers.rst
+docs/source/ml.rst
 docs/source/optimize.rst
 docs/source/order.rst
 docs/source/phases-of-computation.rst
 docs/source/presentations.rst
 docs/source/prometheus.rst
 docs/source/scheduler-overview.rst
 docs/source/scheduling-policy.rst
```

### Comparing `dask-2024.5.0/dask.egg-info/requires.txt` & `dask-2024.5.1/dask.egg-info/requires.txt`

 * *Files 1% similar despite different names*

```diff
@@ -28,15 +28,15 @@
 [delayed]
 
 [diagnostics]
 bokeh>=2.4.2
 jinja2>=2.10.3
 
 [distributed]
-distributed==2024.5.0
+distributed==2024.5.1
 
 [test]
 pandas[test]
 pytest
 pytest-cov
 pytest-rerunfailures
 pytest-timeout
```

### Comparing `dask-2024.5.0/docs/Makefile` & `dask-2024.5.1/docs/Makefile`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/make.bat` & `dask-2024.5.1/docs/make.bat`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/10-minutes-to-dask.rst` & `dask-2024.5.1/docs/source/10-minutes-to-dask.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/_static/config_converter.js` & `dask-2024.5.1/docs/source/_static/config_converter.js`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/_static/dask-simple.png` & `dask-2024.5.1/docs/source/_static/dask-simple.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/_static/main-page.css` & `dask-2024.5.1/docs/source/_static/main-page.css`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/_static/profile.html` & `dask-2024.5.1/docs/source/_static/profile.html`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/_static/stacked_profile.html` & `dask-2024.5.1/docs/source/_static/stacked_profile.html`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/_static/style.css` & `dask-2024.5.1/docs/source/_static/style.css`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/_static/transpose_cyto.html` & `dask-2024.5.1/docs/source/_static/transpose_cyto.html`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/_static/yaml.min.js` & `dask-2024.5.1/docs/source/_static/yaml.min.js`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/adaptive.rst` & `dask-2024.5.1/docs/source/adaptive.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/api.rst` & `dask-2024.5.1/docs/source/api.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-api.rst` & `dask-2024.5.1/docs/source/array-api.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-assignment.rst` & `dask-2024.5.1/docs/source/array-assignment.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-best-practices.rst` & `dask-2024.5.1/docs/source/array-best-practices.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-chunks.rst` & `dask-2024.5.1/docs/source/array-chunks.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-creation.rst` & `dask-2024.5.1/docs/source/array-creation.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-design.rst` & `dask-2024.5.1/docs/source/array-design.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-gufunc.rst` & `dask-2024.5.1/docs/source/array-gufunc.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-numpy-compatibility.rst` & `dask-2024.5.1/docs/source/array-numpy-compatibility.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-overlap.rst` & `dask-2024.5.1/docs/source/array-overlap.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-random.rst` & `dask-2024.5.1/docs/source/array-random.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-slicing.rst` & `dask-2024.5.1/docs/source/array-slicing.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-sparse.rst` & `dask-2024.5.1/docs/source/array-sparse.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-stack.rst` & `dask-2024.5.1/docs/source/array-stack.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array-stats.rst` & `dask-2024.5.1/docs/source/array-stats.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/array.rst` & `dask-2024.5.1/docs/source/array.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/bag-api.rst` & `dask-2024.5.1/docs/source/bag-api.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/bag-creation.rst` & `dask-2024.5.1/docs/source/bag-creation.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/bag.rst` & `dask-2024.5.1/docs/source/bag.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/best-practices.rst` & `dask-2024.5.1/docs/source/best-practices.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/caching.rst` & `dask-2024.5.1/docs/source/caching.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/changelog.rst` & `dask-2024.5.1/docs/source/changelog.rst`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,52 @@
 Changelog
 =========
 
+.. _v2024.5.1:
+
+2024.5.1
+--------
+
+Highlights
+^^^^^^^^^^
+
+NumPy 2.0 support
+"""""""""""""""""
+This release contains compatibility updates for the upcoming NumPy 2.0 release.
+
+See :pr:`11096` by `Benjamin Zaitlen`_  and :pr:`11106` by `James Bourbeau`_ for more details.
+
+Increased Zarr store support
+""""""""""""""""""""""""""""
+This release contains adds support for ``MutableMapping``-backed Zarr stores like
+:py:class:`zarr.storage.DirectoryStore`, etc.
+
+See :pr:`10422` by `Greg M. Fleishman`_ for more details.
+
+.. dropdown:: Additional changes
+
+  - Minor updates to ML page (:pr:`11129`) `James Bourbeau`_
+  - Skip failing ``sparse`` test on 0.15.2 (:pr:`11131`) `James Bourbeau`_
+  - Make sure nightly ``pyarrow`` is installed in upstream CI build (:pr:`11121`) `James Bourbeau`_
+  - Add initial draft of ML overview document (:pr:`11114`) `Matthew Rocklin`_
+  - Test query-planning in gpuCI (:pr:`11060`) `Richard (Rick) Zamora`_
+  - Avoid ``pytest`` error when skipping NumPy 2.0 tests  (:pr:`11110`) `James Bourbeau`_
+  - Use nightly ``h5py`` in upstream CI build (:pr:`11108`) `James Bourbeau`_
+  - Use nightly ``scikit-image`` in upstream CI build (:pr:`11107`) `James Bourbeau`_
+  - Bump ``actions/checkout`` from 4.1.4 to 4.1.5 (:pr:`11105`)
+  - Enable parquet append tests after fix (:pr:`11104`) `Patrick Hoefler`_
+  - Skip ``fastparquet`` tests for ``numpy`` 2 (:pr:`11103`) `Patrick Hoefler`_
+  - Fix misspelling found by codespell (:pr:`11097`) `Dimitri Papadopoulos Orfanos`_
+  - Fix doc build (:pr:`11099`) `Patrick Hoefler`_
+  - Clean up ``percentiles_summary`` logic (:pr:`11094`) `Richard (Rick) Zamora`_
+  - Apply ``ruff/flake8-implicit-str-concat`` rule ISC001 (:pr:`11098`) `Dimitri Papadopoulos Orfanos`_
+
+  - Fix clocks on Windows with Python 3.13 (:pr-distributed:`8642`) `Victor Stinner`_
+  - Fix "Print host info" CI step on Mac OS (arm64) (:pr-distributed:`8638`) `Hendrik Makait`_
+
 .. _v2024.5.0:
 
 2024.5.0
 --------
 
 Highlights
 ^^^^^^^^^^
@@ -8148,7 +8190,9 @@
 .. _`wim glenn`: https://github.com/wimglenn
 .. _`Dimitri Papadopoulos Orfanos`: https://github.com/DimitriPapadopoulos
 .. _`Quentin Lhoest`: https://github.com/lhoestq
 .. _`Jonas Lhnemann`: https://github.com/jlaehne
 .. _`Abel Aoun`: https://github.com/bzah
 .. _`Simon Hxbro Hansen`: https://github.com/Hoxbro
 .. _`M Bussonnier`: https://github.com/Carreau
+.. _`Greg M. Fleishman`: https://github.com/GFleishman
+.. _`Victor Stinner`: https://github.com/vstinner
```

### Comparing `dask-2024.5.0/docs/source/cli.rst` & `dask-2024.5.1/docs/source/cli.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/conf.py` & `dask-2024.5.1/docs/source/conf.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/configuration.rst` & `dask-2024.5.1/docs/source/configuration.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/custom-collections.rst` & `dask-2024.5.1/docs/source/custom-collections.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/custom-graphs.rst` & `dask-2024.5.1/docs/source/custom-graphs.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/customize-initialization.rst` & `dask-2024.5.1/docs/source/customize-initialization.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dashboard-progress-script.py` & `dask-2024.5.1/docs/source/dashboard-progress-script.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dashboard.rst` & `dask-2024.5.1/docs/source/dashboard.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/daskcheatsheet.pdf` & `dask-2024.5.1/docs/source/daskcheatsheet.pdf`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-api.rst` & `dask-2024.5.1/docs/source/dataframe-api.rst`

 * *Files 0% similar despite different names*

```diff
@@ -551,15 +551,15 @@
    get_dummies
    pivot_table
    melt
 
 Concatenate DataFrames
 ~~~~~~~~~~~~~~~~~~~~~~
 
-.. currentmodule:: dask_expr
+.. currentmodule:: dask_expr._collection
 
 .. autosummary::
    :toctree: generated/
 
    DataFrame.merge
    concat
    merge
```

### Comparing `dask-2024.5.0/docs/source/dataframe-best-practices.rst` & `dask-2024.5.1/docs/source/dataframe-best-practices.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-categoricals.rst` & `dask-2024.5.1/docs/source/dataframe-categoricals.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-create.rst` & `dask-2024.5.1/docs/source/dataframe-create.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-design.rst` & `dask-2024.5.1/docs/source/dataframe-design.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-extend.rst` & `dask-2024.5.1/docs/source/dataframe-extend.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-groupby.rst` & `dask-2024.5.1/docs/source/dataframe-groupby.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-hive.rst` & `dask-2024.5.1/docs/source/dataframe-hive.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-indexing.rst` & `dask-2024.5.1/docs/source/dataframe-indexing.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-joins.rst` & `dask-2024.5.1/docs/source/dataframe-joins.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-legacy-api.rst` & `dask-2024.5.1/docs/source/dataframe-legacy-api.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-optimizer.rst` & `dask-2024.5.1/docs/source/dataframe-optimizer.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-parquet.rst` & `dask-2024.5.1/docs/source/dataframe-parquet.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe-sql.rst` & `dask-2024.5.1/docs/source/dataframe-sql.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/dataframe.rst` & `dask-2024.5.1/docs/source/dataframe.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/delayed-api.rst` & `dask-2024.5.1/docs/source/delayed-api.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/delayed-best-practices.rst` & `dask-2024.5.1/docs/source/delayed-best-practices.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/delayed-collections.rst` & `dask-2024.5.1/docs/source/delayed-collections.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/delayed.rst` & `dask-2024.5.1/docs/source/delayed.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying-cli.rst` & `dask-2024.5.1/docs/source/deploying-cli.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying-cloud.rst` & `dask-2024.5.1/docs/source/deploying-cloud.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying-docker.rst` & `dask-2024.5.1/docs/source/deploying-docker.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying-hpc.rst` & `dask-2024.5.1/docs/source/deploying-hpc.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying-kubernetes.rst` & `dask-2024.5.1/docs/source/deploying-kubernetes.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying-python-advanced.rst` & `dask-2024.5.1/docs/source/deploying-python-advanced.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying-python.rst` & `dask-2024.5.1/docs/source/deploying-python.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying-ssh.rst` & `dask-2024.5.1/docs/source/deploying-ssh.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deploying.rst` & `dask-2024.5.1/docs/source/deploying.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/deployment-considerations.rst` & `dask-2024.5.1/docs/source/deployment-considerations.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/develop.rst` & `dask-2024.5.1/docs/source/develop.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/diagnostics-distributed.rst` & `dask-2024.5.1/docs/source/diagnostics-distributed.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/diagnostics-local.rst` & `dask-2024.5.1/docs/source/diagnostics-local.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/ecosystem.rst` & `dask-2024.5.1/docs/source/ecosystem.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/faq.rst` & `dask-2024.5.1/docs/source/faq.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/futures.rst` & `dask-2024.5.1/docs/source/futures.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/gpu.rst` & `dask-2024.5.1/docs/source/gpu.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/graph_manipulation.rst` & `dask-2024.5.1/docs/source/graph_manipulation.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/graphs.rst` & `dask-2024.5.1/docs/source/graphs.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/graphviz.rst` & `dask-2024.5.1/docs/source/graphviz.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/high-level-graphs.rst` & `dask-2024.5.1/docs/source/high-level-graphs.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/how-to/connect-to-remote-data.rst` & `dask-2024.5.1/docs/source/how-to/connect-to-remote-data.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/how-to/debug.rst` & `dask-2024.5.1/docs/source/how-to/debug.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/how-to/extend-sizeof.rst` & `dask-2024.5.1/docs/source/how-to/extend-sizeof.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/how-to/selecting-the-collection-backend.rst` & `dask-2024.5.1/docs/source/how-to/selecting-the-collection-backend.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/10_minutes_array_graph.png` & `dask-2024.5.1/docs/source/images/10_minutes_array_graph.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/10_minutes_bag_graph.png` & `dask-2024.5.1/docs/source/images/10_minutes_bag_graph.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/10_minutes_dataframe_graph.png` & `dask-2024.5.1/docs/source/images/10_minutes_dataframe_graph.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/HHMI_Janelia_Color.png` & `dask-2024.5.1/docs/source/images/HHMI_Janelia_Color.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/array.svg` & `dask-2024.5.1/docs/source/images/array.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/async-embarrassing.gif` & `dask-2024.5.1/docs/source/images/async-embarrassing.gif`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/changelog/2023110-rechunking-disk-perf.png` & `dask-2024.5.1/docs/source/images/changelog/2023110-rechunking-disk-perf.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/cloud-provider-logos.svg` & `dask-2024.5.1/docs/source/images/cloud-provider-logos.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/concurrent-futures-threaded.webp` & `dask-2024.5.1/docs/source/images/concurrent-futures-threaded.webp`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/crosstalk.svg` & `dask-2024.5.1/docs/source/images/crosstalk.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_jupyterlab.png` & `dask-2024.5.1/docs/source/images/dashboard_jupyterlab.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_link.png` & `dask-2024.5.1/docs/source/images/dashboard_link.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_memory.png` & `dask-2024.5.1/docs/source/images/dashboard_memory.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_memory_new.gif` & `dask-2024.5.1/docs/source/images/dashboard_memory_new.gif`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_progress.png` & `dask-2024.5.1/docs/source/images/dashboard_progress.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_status.png` & `dask-2024.5.1/docs/source/images/dashboard_status.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_task_processing.png` & `dask-2024.5.1/docs/source/images/dashboard_task_processing.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_task_stream_unhealthy.png` & `dask-2024.5.1/docs/source/images/dashboard_task_stream_unhealthy.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dashboard_taskstream_healthy.png` & `dask-2024.5.1/docs/source/images/dashboard_taskstream_healthy.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask-adaptive.svg` & `dask-2024.5.1/docs/source/images/dask-adaptive.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask-array.svg` & `dask-2024.5.1/docs/source/images/dask-array.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask-cluster-manager.svg` & `dask-2024.5.1/docs/source/images/dask-cluster-manager.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask-dataframe.svg` & `dask-2024.5.1/docs/source/images/dask-dataframe.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask-overview-distributed-callout.svg` & `dask-2024.5.1/docs/source/images/dask-overview-distributed-callout.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask-overview-schedulers.svg` & `dask-2024.5.1/docs/source/images/dask-overview-schedulers.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask-overview.svg` & `dask-2024.5.1/docs/source/images/dask-overview.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_horizontal.svg` & `dask-2024.5.1/docs/source/images/dask_horizontal.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_horizontal_black.svg` & `dask-2024.5.1/docs/source/images/dask_horizontal_black.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_horizontal_on_blue.svg` & `dask-2024.5.1/docs/source/images/dask_horizontal_on_blue.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_horizontal_on_pink.svg` & `dask-2024.5.1/docs/source/images/dask_horizontal_on_pink.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_horizontal_white.svg` & `dask-2024.5.1/docs/source/images/dask_horizontal_white.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_icon.svg` & `dask-2024.5.1/docs/source/images/dask_icon.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_icon_black.svg` & `dask-2024.5.1/docs/source/images/dask_icon_black.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_icon_on_pink.svg` & `dask-2024.5.1/docs/source/images/dask_icon_on_pink.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dask_icon_white.svg` & `dask-2024.5.1/docs/source/images/dask_icon_white.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/dataframe-optimize-explain.png` & `dask-2024.5.1/docs/source/images/dataframe-optimize-explain.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/delayed-inc-double-add.svg` & `dask-2024.5.1/docs/source/images/delayed-inc-double-add.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/distributed-overview.svg` & `dask-2024.5.1/docs/source/images/distributed-overview.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/frame-shuffle.svg` & `dask-2024.5.1/docs/source/images/frame-shuffle.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/frame-sort.svg` & `dask-2024.5.1/docs/source/images/frame-sort.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/frame.svg` & `dask-2024.5.1/docs/source/images/frame.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/futures-graph.png` & `dask-2024.5.1/docs/source/images/futures-graph.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/gputester-msg.png` & `dask-2024.5.1/docs/source/images/gputester-msg.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/growth_of_languages.png` & `dask-2024.5.1/docs/source/images/growth_of_languages.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/growth_of_libraries.png` & `dask-2024.5.1/docs/source/images/growth_of_libraries.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/inc-add.svg` & `dask-2024.5.1/docs/source/images/inc-add.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/map-reduce-task-scheduling.svg` & `dask-2024.5.1/docs/source/images/map-reduce-task-scheduling.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/map_blocks_drop_axis.png` & `dask-2024.5.1/docs/source/images/map_blocks_drop_axis.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/merge_chunks.png` & `dask-2024.5.1/docs/source/images/merge_chunks.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/merge_chunks_false.png` & `dask-2024.5.1/docs/source/images/merge_chunks_false.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/optimize_dask1.svg` & `dask-2024.5.1/docs/source/images/optimize_dask1.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/optimize_dask2.svg` & `dask-2024.5.1/docs/source/images/optimize_dask2.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/optimize_dask3.svg` & `dask-2024.5.1/docs/source/images/optimize_dask3.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/optimize_dask4.svg` & `dask-2024.5.1/docs/source/images/optimize_dask4.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/optimize_dask5.svg` & `dask-2024.5.1/docs/source/images/optimize_dask5.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/optimizer/automatic-repartitioning.svg` & `dask-2024.5.1/docs/source/images/optimizer/automatic-repartitioning.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/optimizer/avoiding-shuffles.svg` & `dask-2024.5.1/docs/source/images/optimizer/avoiding-shuffles.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/order-failure.png` & `dask-2024.5.1/docs/source/images/order-failure.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/order-success.png` & `dask-2024.5.1/docs/source/images/order-success.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/overlap.svg` & `dask-2024.5.1/docs/source/images/overlap.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/overlapping-blocks.svg` & `dask-2024.5.1/docs/source/images/overlapping-blocks.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/overlapping-neighbors.svg` & `dask-2024.5.1/docs/source/images/overlapping-neighbors.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/pipeline.svg` & `dask-2024.5.1/docs/source/images/pipeline.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/reshape.png` & `dask-2024.5.1/docs/source/images/reshape.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/reshape_problem.png` & `dask-2024.5.1/docs/source/images/reshape_problem.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/reshape_rechunked.png` & `dask-2024.5.1/docs/source/images/reshape_rechunked.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/scaling-edges.png` & `dask-2024.5.1/docs/source/images/scaling-edges.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/scaling-nodes.png` & `dask-2024.5.1/docs/source/images/scaling-nodes.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/simple-dask.png` & `dask-2024.5.1/docs/source/images/simple-dask.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/transpose-hlg-hovertooltip.png` & `dask-2024.5.1/docs/source/images/transpose-hlg-hovertooltip.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/transpose-hlg-html-repr.png` & `dask-2024.5.1/docs/source/images/transpose-hlg-html-repr.png`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/transpose.svg` & `dask-2024.5.1/docs/source/images/transpose.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/transpose_opt.svg` & `dask-2024.5.1/docs/source/images/transpose_opt.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/trivial.svg` & `dask-2024.5.1/docs/source/images/trivial.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/images/unoverlapping-neighbors.svg` & `dask-2024.5.1/docs/source/images/unoverlapping-neighbors.svg`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/index.rst` & `dask-2024.5.1/docs/source/index.rst`

 * *Files 1% similar despite different names*

```diff
@@ -343,14 +343,15 @@
    :caption: How to Use
 
    array.rst
    bag.rst
    DataFrame <dataframe.rst>
    Delayed <delayed.rst>
    futures.rst
+   ml.rst
 
 .. toctree::
    :maxdepth: 1
    :hidden:
    :caption: Internals
 
    understanding-performance.rst
```

#### html2text {}

```diff
@@ -115,15 +115,15 @@
 youtube.com/@dask-dev>`_ Additionally, we encourage you to look through the
 reference documentation on this website related to the API that most closely
 matches your application. Dask was designed to be **easy to use** and
 **powerful**. We hope that it's able to help you have fun with your work. ..
 toctree:: :maxdepth: 1 :hidden: :caption: Getting Started Install Dask 10-
 minutes-to-dask.rst deploying.rst Best Practices faq.rst .. toctree:: :
 maxdepth: 1 :hidden: :caption: How to Use array.rst bag.rst DataFrame Delayed
-futures.rst .. toctree:: :maxdepth: 1 :hidden: :caption: Internals
+futures.rst ml.rst .. toctree:: :maxdepth: 1 :hidden: :caption: Internals
 understanding-performance.rst scheduling.rst graphs.rst debugging-
 performance.rst internals.rst .. toctree:: :maxdepth: 1 :hidden: :caption:
 Reference api.rst cli.rst develop.rst changelog.rst configuration.rst how-to/
 index.rst presentations.rst maintainers.rst .. _`Anaconda Inc`: https://
 www.anaconda.com .. _`3-clause BSD license`: https://github.com/dask/dask/blob/
 main/LICENSE.txt .. _`#dask tag`: https://stackoverflow.com/questions/tagged/
 dask .. _`GitHub issue tracker`: https://github.com/dask/dask/issues ..
```

### Comparing `dask-2024.5.0/docs/source/install.rst` & `dask-2024.5.1/docs/source/install.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/logos.rst` & `dask-2024.5.1/docs/source/logos.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/maintainers.rst` & `dask-2024.5.1/docs/source/maintainers.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/optimize.rst` & `dask-2024.5.1/docs/source/optimize.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/order.rst` & `dask-2024.5.1/docs/source/order.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/phases-of-computation.rst` & `dask-2024.5.1/docs/source/phases-of-computation.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/presentations.rst` & `dask-2024.5.1/docs/source/presentations.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/prometheus.rst` & `dask-2024.5.1/docs/source/prometheus.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/scheduler-overview.rst` & `dask-2024.5.1/docs/source/scheduler-overview.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/scheduling-policy.rst` & `dask-2024.5.1/docs/source/scheduling-policy.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/scheduling.rst` & `dask-2024.5.1/docs/source/scheduling.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/scripts/scheduling.py` & `dask-2024.5.1/docs/source/scripts/scheduling.py`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/shared.rst` & `dask-2024.5.1/docs/source/shared.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/software-environments.rst` & `dask-2024.5.1/docs/source/software-environments.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/spark.rst` & `dask-2024.5.1/docs/source/spark.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/spec.rst` & `dask-2024.5.1/docs/source/spec.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/support.rst` & `dask-2024.5.1/docs/source/support.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/understanding-performance.rst` & `dask-2024.5.1/docs/source/understanding-performance.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/user-interfaces.rst` & `dask-2024.5.1/docs/source/user-interfaces.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/docs/source/why.rst` & `dask-2024.5.1/docs/source/why.rst`

 * *Files identical despite different names*

### Comparing `dask-2024.5.0/pyproject.toml` & `dask-2024.5.1/pyproject.toml`

 * *Files 0% similar despite different names*

```diff
@@ -53,15 +53,15 @@
 dataframe = [
     "dask[array]",
     # NOTE: dask-expr is pinning pandas>2. To use pandas<2, please install dask
     # without using the dataframe extra
     "pandas >= 1.3",
     "dask-expr >= 1.1, <1.2",  # dask-expr pins the dask version
 ]
-distributed = ["distributed == 2024.5.0"]
+distributed = ["distributed == 2024.5.1"]
 diagnostics = [
     "bokeh >= 2.4.2",
     "jinja2 >= 2.10.3",
 ]
 # keeping for backwards compatibility
 delayed = []
 complete = [
```

