# Comparing `tmp/nucliadb_sdk-3.1.0.post510-py3-none-any.whl.zip` & `tmp/nucliadb_sdk-3.1.0.post511-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,28 +1,28 @@
-Zip file size: 39828 bytes, number of entries: 26
--rw-r--r--  2.0 unx      990 b- defN 24-May-16 16:06 nucliadb_sdk/__init__.py
--rw-r--r--  2.0 unx        0 b- defN 24-May-16 16:06 nucliadb_sdk/py.typed
--rw-r--r--  2.0 unx      833 b- defN 24-May-16 16:06 nucliadb_sdk/tests/__init__.py
--rw-r--r--  2.0 unx      891 b- defN 24-May-16 16:06 nucliadb_sdk/tests/conftest.py
--rw-r--r--  2.0 unx     4521 b- defN 24-May-16 16:06 nucliadb_sdk/tests/fixtures.py
--rw-r--r--  2.0 unx     5303 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_ask.py
--rw-r--r--  2.0 unx     2650 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_chat.py
--rw-r--r--  2.0 unx     3948 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_crud.py
--rw-r--r--  2.0 unx     3929 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_export_import.py
--rw-r--r--  2.0 unx     1006 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_feedback.py
--rw-r--r--  2.0 unx     1273 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_find.py
--rw-r--r--  2.0 unx     1271 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_kb.py
--rw-r--r--  2.0 unx     4457 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_sdk.py
--rw-r--r--  2.0 unx     4727 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_sdk_async.py
--rw-r--r--  2.0 unx    12187 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_search.py
--rw-r--r--  2.0 unx     3386 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_security.py
--rw-r--r--  2.0 unx     1486 b- defN 24-May-16 16:06 nucliadb_sdk/tests/test_summarize.py
--rw-r--r--  2.0 unx      934 b- defN 24-May-16 16:06 nucliadb_sdk/v2/__init__.py
--rw-r--r--  2.0 unx    17980 b- defN 24-May-16 16:06 nucliadb_sdk/v2/docstrings.py
--rw-r--r--  2.0 unx     1142 b- defN 24-May-16 16:06 nucliadb_sdk/v2/exceptions.py
--rw-r--r--  2.0 unx    33811 b- defN 24-May-16 16:06 nucliadb_sdk/v2/sdk.py
--rw-r--r--  2.0 unx     6770 b- defN 24-May-16 16:07 nucliadb_sdk-3.1.0.post510.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 24-May-16 16:07 nucliadb_sdk-3.1.0.post510.dist-info/WHEEL
--rw-r--r--  2.0 unx       13 b- defN 24-May-16 16:07 nucliadb_sdk-3.1.0.post510.dist-info/top_level.txt
--rw-r--r--  2.0 unx        1 b- defN 24-May-16 16:06 nucliadb_sdk-3.1.0.post510.dist-info/zip-safe
--rw-rw-r--  2.0 unx     2281 b- defN 24-May-16 16:07 nucliadb_sdk-3.1.0.post510.dist-info/RECORD
-26 files, 115882 bytes uncompressed, 36102 bytes compressed:  68.8%
+Zip file size: 40067 bytes, number of entries: 26
+-rw-r--r--  2.0 unx      990 b- defN 24-May-17 08:46 nucliadb_sdk/__init__.py
+-rw-r--r--  2.0 unx        0 b- defN 24-May-17 08:46 nucliadb_sdk/py.typed
+-rw-r--r--  2.0 unx      833 b- defN 24-May-17 08:46 nucliadb_sdk/tests/__init__.py
+-rw-r--r--  2.0 unx      891 b- defN 24-May-17 08:46 nucliadb_sdk/tests/conftest.py
+-rw-r--r--  2.0 unx     4521 b- defN 24-May-17 08:46 nucliadb_sdk/tests/fixtures.py
+-rw-r--r--  2.0 unx     5999 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_ask.py
+-rw-r--r--  2.0 unx     2650 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_chat.py
+-rw-r--r--  2.0 unx     3948 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_crud.py
+-rw-r--r--  2.0 unx     3929 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_export_import.py
+-rw-r--r--  2.0 unx     1006 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_feedback.py
+-rw-r--r--  2.0 unx     1273 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_find.py
+-rw-r--r--  2.0 unx     1271 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_kb.py
+-rw-r--r--  2.0 unx     4457 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_sdk.py
+-rw-r--r--  2.0 unx     4727 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_sdk_async.py
+-rw-r--r--  2.0 unx    12187 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_search.py
+-rw-r--r--  2.0 unx     3386 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_security.py
+-rw-r--r--  2.0 unx     1486 b- defN 24-May-17 08:46 nucliadb_sdk/tests/test_summarize.py
+-rw-r--r--  2.0 unx      934 b- defN 24-May-17 08:46 nucliadb_sdk/v2/__init__.py
+-rw-r--r--  2.0 unx    17980 b- defN 24-May-17 08:46 nucliadb_sdk/v2/docstrings.py
+-rw-r--r--  2.0 unx     1142 b- defN 24-May-17 08:46 nucliadb_sdk/v2/exceptions.py
+-rw-r--r--  2.0 unx    34199 b- defN 24-May-17 08:46 nucliadb_sdk/v2/sdk.py
+-rw-r--r--  2.0 unx     6770 b- defN 24-May-17 08:47 nucliadb_sdk-3.1.0.post511.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 24-May-17 08:47 nucliadb_sdk-3.1.0.post511.dist-info/WHEEL
+-rw-r--r--  2.0 unx       13 b- defN 24-May-17 08:47 nucliadb_sdk-3.1.0.post511.dist-info/top_level.txt
+-rw-r--r--  2.0 unx        1 b- defN 24-May-17 08:46 nucliadb_sdk-3.1.0.post511.dist-info/zip-safe
+-rw-rw-r--  2.0 unx     2281 b- defN 24-May-17 08:47 nucliadb_sdk-3.1.0.post511.dist-info/RECORD
+26 files, 116966 bytes uncompressed, 36341 bytes compressed:  68.9%
```

## zipnote {}

```diff
@@ -57,23 +57,23 @@
 
 Filename: nucliadb_sdk/v2/exceptions.py
 Comment: 
 
 Filename: nucliadb_sdk/v2/sdk.py
 Comment: 
 
-Filename: nucliadb_sdk-3.1.0.post510.dist-info/METADATA
+Filename: nucliadb_sdk-3.1.0.post511.dist-info/METADATA
 Comment: 
 
-Filename: nucliadb_sdk-3.1.0.post510.dist-info/WHEEL
+Filename: nucliadb_sdk-3.1.0.post511.dist-info/WHEEL
 Comment: 
 
-Filename: nucliadb_sdk-3.1.0.post510.dist-info/top_level.txt
+Filename: nucliadb_sdk-3.1.0.post511.dist-info/top_level.txt
 Comment: 
 
-Filename: nucliadb_sdk-3.1.0.post510.dist-info/zip-safe
+Filename: nucliadb_sdk-3.1.0.post511.dist-info/zip-safe
 Comment: 
 
-Filename: nucliadb_sdk-3.1.0.post510.dist-info/RECORD
+Filename: nucliadb_sdk-3.1.0.post511.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## nucliadb_sdk/tests/test_ask.py

```diff
@@ -89,15 +89,15 @@
         kbid=docs_dataset,
         rid=rid,
         query="Nuclia loves Semantic Search",
         rag_strategies=[{"name": "full_resource"}],
     )
 
 
-def test_ask_response_parser():
+def test_ask_response_parser_stream():
     items = [
         AnswerAskResponseItem(text="This is"),
         AnswerAskResponseItem(text=" your Nuclia answer."),
         StatusAskResponseItem(code="0", status="success"),
         RelationsAskResponseItem(
             relations=Relations(
                 entities={
@@ -120,15 +120,18 @@
             tokens=AskTokens(input=10, output=5),
             timings=AskTimings(generative_first_chunk=0.1, generative_total=0.2),
         ),
         CitationsAskResponseItem(citations={"some/paragraph/id": "This is a citation"}),
     ]
     raw_lines = [AskResponseItem(item=item).json() for item in items]
     response = unittest.mock.Mock()
-    response.headers = {"NUCLIA-LEARNING-ID": "learning_id"}
+    response.headers = {
+        "NUCLIA-LEARNING-ID": "learning_id",
+        "Content-Type": "application/x-ndjson",
+    }
     response.iter_lines = unittest.mock.Mock(return_value=raw_lines)
 
     ask_response: SyncAskResponse = ask_response_parser(response)
 
     assert ask_response.learning_id == "learning_id"
     assert ask_response.answer == "This is your Nuclia answer."
     assert ask_response.status == "success"
@@ -138,7 +141,27 @@
     )
     assert ask_response.citations["some/paragraph/id"] == "This is a citation"
     assert ask_response.retrieval_results.resources == {}
     assert ask_response.metadata.tokens.input == 10
     assert ask_response.metadata.tokens.output == 5
     assert ask_response.metadata.timings.generative_first_chunk == 0.1
     assert ask_response.metadata.timings.generative_total == 0.2
+
+
+def test_ask_synchronous(docs_dataset, sdk: nucliadb_sdk.NucliaDB):
+    sdk.session.headers["X-Synchronous"] = "true"
+    resp = sdk.ask(
+        kbid=docs_dataset,
+        query="Nuclia loves Semantic Search",
+    )
+    assert isinstance(resp, SyncAskResponse)
+    sdk.session.headers.pop("X-Synchronous", None)
+
+
+def test_ask_stream(docs_dataset, sdk: nucliadb_sdk.NucliaDB):
+    sdk.session.headers["X-Synchronous"] = "false"
+    resp = sdk.ask(
+        kbid=docs_dataset,
+        query="Nuclia loves Semantic Search",
+    )
+    assert isinstance(resp, SyncAskResponse)
+    sdk.session.headers.pop("X-Synchronous", None)
```

## nucliadb_sdk/v2/sdk.py

```diff
@@ -143,14 +143,21 @@
         relations=relations_result,
         learning_id=learning_id,
         citations=citations,
     )
 
 
 def ask_response_parser(response: httpx.Response) -> SyncAskResponse:
+    content_type = response.headers.get("Content-Type")
+    if content_type not in ("application/json", "application/x-ndjson"):
+        raise ValueError(f"Unknown content type in response: {content_type}")
+
+    if content_type == "application/json":
+        # This comes from a request with the X-Synchronous header set to true
+        return SyncAskResponse.parse_raw(response.content)
     answer = ""
     status = ""
     retrieval_results = None
     relations = None
     learning_id = response.headers.get("NUCLIA-LEARNING-ID")
     citations: dict[str, Any] = {}
     tokens = None
```

## Comparing `nucliadb_sdk-3.1.0.post510.dist-info/METADATA` & `nucliadb_sdk-3.1.0.post511.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: nucliadb-sdk
-Version: 3.1.0.post510
+Version: 3.1.0.post511
 Home-page: https://docs.nuclia.dev/docs/guides/nucliadb/python_nucliadb_sdk
 License: BSD
 Classifier: Development Status :: 4 - Beta
 Classifier: Intended Audience :: Developers
 Classifier: Intended Audience :: Information Technology
 Classifier: Topic :: Software Development :: Libraries :: Python Modules
 Classifier: License :: OSI Approved :: GNU Affero General Public License v3 or later (AGPLv3+)
@@ -15,15 +15,15 @@
 Classifier: Programming Language :: Python :: 3 :: Only
 Requires-Python: >=3.9, <4
 Description-Content-Type: text/markdown
 Requires-Dist: httpx
 Requires-Dist: requests
 Requires-Dist: orjson
 Requires-Dist: pydantic <2.0,>=1.10.9
-Requires-Dist: nucliadb-models >=3.1.0.post510
+Requires-Dist: nucliadb-models >=3.1.0.post511
 
 # NucliaDB SDK
 
 The NucliaDB SDK is a Python library designed as a thin wrapper around the [NucliaDB HTTP API](https://docs.nuclia.dev/docs/api). It is tailored for developers who wish to create low-level scripts to interact with NucliaDB.
 
 ## WARNING
```

## Comparing `nucliadb_sdk-3.1.0.post510.dist-info/RECORD` & `nucliadb_sdk-3.1.0.post511.dist-info/RECORD`

 * *Files 20% similar despite different names*

```diff
@@ -1,26 +1,26 @@
 nucliadb_sdk/__init__.py,sha256=CkjYIXKAJkX7qnZiN-sYtvIDp0h4IEazc8HhvMuZiYc,990
 nucliadb_sdk/py.typed,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 nucliadb_sdk/tests/__init__.py,sha256=itSI7dtTwFP55YMX4iK7JzdMHS5CQVUiB1XzQu4UBh8,833
 nucliadb_sdk/tests/conftest.py,sha256=L7a9YyCqVDYDGQvNtC7HyK2F24yvoN0mAcDQfSi8EmQ,891
 nucliadb_sdk/tests/fixtures.py,sha256=cCrq93Fe72-zkh93wZgCn69MybEYKh7wgiLEVKt1SQM,4521
-nucliadb_sdk/tests/test_ask.py,sha256=UsJB4VAto-bA9uL31EtSij9C1M54-HsLeodRrU16UjI,5303
+nucliadb_sdk/tests/test_ask.py,sha256=IDHs3QQJ94_j53m4Y4ulW_qjxPRplxbC3ghYpXrir0Q,5999
 nucliadb_sdk/tests/test_chat.py,sha256=pYoJHW4q5UzxbVLxXajsy6QUwEuDa17-XLZMkLvsfd0,2650
 nucliadb_sdk/tests/test_crud.py,sha256=8N5mWKwngwvIHQvSHuv_yguMnT9yuPeuAAfmQ3Urbdo,3948
 nucliadb_sdk/tests/test_export_import.py,sha256=rKKsxqc-sbMhHlNmntnBarEMWc7aoYmIvRbeliQJxEE,3929
 nucliadb_sdk/tests/test_feedback.py,sha256=dfq6rzpmRw_Wjl__gX10DaqpFzf8F66t1lYKn27ddhU,1006
 nucliadb_sdk/tests/test_find.py,sha256=Y2mQ9NNrYHqW_c1N8ri_yHZq-peT0MIdLd3AFKuwjeI,1273
 nucliadb_sdk/tests/test_kb.py,sha256=2ABBY0CMbsze2OvI3L25-AEwNQdAuNbLfi84-hml9bE,1271
 nucliadb_sdk/tests/test_sdk.py,sha256=maLvIpOT8nK18CNWDjIW3GV1-p2-ukZcGMlhiiquEV4,4457
 nucliadb_sdk/tests/test_sdk_async.py,sha256=c_OHa9CWG23LzuQZT8V5eO2bodOfM6qgHX8lFyRgfo0,4727
 nucliadb_sdk/tests/test_search.py,sha256=oqPial3QvlnWJukxoJM59s_4Bo9FBbhlgykCAr8fiwc,12187
 nucliadb_sdk/tests/test_security.py,sha256=FcMtbXp_rS17dqrJdKyha2eK8xNJ0GuV1oDMHI_5SY4,3386
 nucliadb_sdk/tests/test_summarize.py,sha256=ItV24Lo4lVi74IrFrvjS0dhsJSYAd0dpfntpr2cA2N8,1486
 nucliadb_sdk/v2/__init__.py,sha256=F9kJzOkphCL6fIGXBkQbXAAYS2ZzkOLzA4Nudwf1310,934
 nucliadb_sdk/v2/docstrings.py,sha256=XGot15pw3PxhvAAW5EXDzAt_piT6lvaaS7LQomOebTg,17980
 nucliadb_sdk/v2/exceptions.py,sha256=oB7wJl5ZkeRoDOsCNSBgejdwW6LEQrI3Q8UMz8y_eG0,1142
-nucliadb_sdk/v2/sdk.py,sha256=JLygf9ciox7Qd-Y4lRg7_KnZBzMzSa9tdM2iyGSWyl0,33811
-nucliadb_sdk-3.1.0.post510.dist-info/METADATA,sha256=KfgA115d7jkfz7ew2etcqLPmy29uh9uU7CgFWI0pd0M,6770
-nucliadb_sdk-3.1.0.post510.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
-nucliadb_sdk-3.1.0.post510.dist-info/top_level.txt,sha256=_dCwt_JnsZ3463lfvc5KcM2wUQJ9aSvKSsAAjGH8R0Y,13
-nucliadb_sdk-3.1.0.post510.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
-nucliadb_sdk-3.1.0.post510.dist-info/RECORD,,
+nucliadb_sdk/v2/sdk.py,sha256=IZ43Y1uKOZjkKVhc4QaCTq1riIKoZMbM7d5Xa3SA-os,34199
+nucliadb_sdk-3.1.0.post511.dist-info/METADATA,sha256=zSj38XRNRsvl8AX-ccFCnpkcjH3nRqtimOlOyJYI3n8,6770
+nucliadb_sdk-3.1.0.post511.dist-info/WHEEL,sha256=GJ7t_kWBFywbagK5eo9IoUwLW6oyOeTKmQ-9iHFVNxQ,92
+nucliadb_sdk-3.1.0.post511.dist-info/top_level.txt,sha256=_dCwt_JnsZ3463lfvc5KcM2wUQJ9aSvKSsAAjGH8R0Y,13
+nucliadb_sdk-3.1.0.post511.dist-info/zip-safe,sha256=AbpHGcgLb-kRsJGnwFEktk7uzpZOCcBY74-YBdrKVGs,1
+nucliadb_sdk-3.1.0.post511.dist-info/RECORD,,
```

