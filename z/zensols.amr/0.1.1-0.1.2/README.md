# Comparing `tmp/zensols.amr-0.1.1-py3-none-any.whl.zip` & `tmp/zensols.amr-0.1.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,52 +1,52 @@
-Zip file size: 97965 bytes, number of entries: 50
--rw-rw-r--  2.0 unx      124 b- defN 24-Mar-29 21:59 zensols/amr/__init__.py
--rw-rw-r--  2.0 unx     7118 b- defN 24-Mar-29 21:59 zensols/amr/align.py
--rw-rw-r--  2.0 unx     7196 b- defN 24-Mar-29 21:59 zensols/amr/alignpop.py
--rw-rw-r--  2.0 unx     7438 b- defN 24-Mar-29 21:59 zensols/amr/amrlib.py
--rw-rw-r--  2.0 unx    31264 b- defN 24-Mar-29 21:59 zensols/amr/annotate.py
--rw-rw-r--  2.0 unx    18223 b- defN 24-Mar-29 21:59 zensols/amr/app.py
--rw-rw-r--  2.0 unx     1241 b- defN 24-Mar-29 21:59 zensols/amr/cli.py
--rw-rw-r--  2.0 unx    16905 b- defN 24-Mar-29 21:59 zensols/amr/container.py
--rw-rw-r--  2.0 unx     3814 b- defN 24-Mar-29 21:59 zensols/amr/coref.py
--rw-rw-r--  2.0 unx    12291 b- defN 24-Mar-29 21:59 zensols/amr/corpprep.py
--rw-rw-r--  2.0 unx     8947 b- defN 24-Mar-29 21:59 zensols/amr/doc.py
--rw-rw-r--  2.0 unx     5178 b- defN 24-Mar-29 21:59 zensols/amr/docfac.py
--rw-rw-r--  2.0 unx    13800 b- defN 24-Mar-29 21:59 zensols/amr/docparser.py
--rw-rw-r--  2.0 unx      691 b- defN 24-Mar-29 21:59 zensols/amr/domain.py
--rw-rw-r--  2.0 unx     9479 b- defN 24-Mar-29 21:59 zensols/amr/dumper.py
--rw-rw-r--  2.0 unx     6465 b- defN 24-Mar-29 21:59 zensols/amr/model.py
--rw-rw-r--  2.0 unx     5470 b- defN 24-Mar-29 21:59 zensols/amr/score.py
--rw-rw-r--  2.0 unx    14201 b- defN 24-Mar-29 21:59 zensols/amr/sent.py
--rw-rw-r--  2.0 unx     5632 b- defN 24-Mar-29 21:59 zensols/amr/serial.py
--rw-rw-r--  2.0 unx     2965 b- defN 24-Mar-29 21:59 zensols/amr/spacyadapt.py
--rw-rw-r--  2.0 unx    24488 b- defN 24-Mar-29 21:59 zensols/amr/trainer.py
--rw-rw-r--  2.0 unx     9514 b- defN 24-Mar-29 21:59 zensols/amr/tree.py
--rw-rw-r--  2.0 unx      783 b- defN 24-Mar-29 21:59 zensols/amr/resources/align.yml
--rw-rw-r--  2.0 unx     4055 b- defN 24-Mar-29 21:59 zensols/amr/resources/annotate.conf
--rw-rw-r--  2.0 unx     3376 b- defN 24-Mar-29 21:59 zensols/amr/resources/app.conf
--rw-rw-r--  2.0 unx     1011 b- defN 24-Mar-29 21:59 zensols/amr/resources/coref.conf
--rw-rw-r--  2.0 unx     1512 b- defN 24-Mar-29 21:59 zensols/amr/resources/default.conf
--rw-rw-r--  2.0 unx     4131 b- defN 24-Mar-29 21:59 zensols/amr/resources/model.conf
--rw-rw-r--  2.0 unx      376 b- defN 24-Mar-29 21:59 zensols/amr/resources/obj.conf
--rw-rw-r--  2.0 unx     2712 b- defN 24-Mar-29 21:59 zensols/amr/resources/obj.yml
--rw-rw-r--  2.0 unx      889 b- defN 24-Mar-29 21:59 zensols/amr/resources/score.yml
--rw-rw-r--  2.0 unx      175 b- defN 24-Mar-29 21:59 zensols/amr/resources/serial.conf
--rw-rw-r--  2.0 unx     4488 b- defN 24-Mar-29 21:59 zensols/amr/resources/train.yml
--rw-rw-r--  2.0 unx     3825 b- defN 24-Mar-29 21:59 zensols/amr/resources/model/inference.conf
--rw-rw-r--  2.0 unx     1626 b- defN 24-Mar-29 21:59 zensols/amr/resources/model/model_generate_xfm_t5_base_wTT.json
--rw-rw-r--  2.0 unx     1771 b- defN 24-Mar-29 21:59 zensols/amr/resources/model/model_generate_xfm_t5_large_wTT.json
--rw-rw-r--  2.0 unx      910 b- defN 24-Mar-29 21:59 zensols/amr/resources/model/model_parse_spring.json
--rw-rw-r--  2.0 unx     1741 b- defN 24-Mar-29 21:59 zensols/amr/resources/model/model_parse_xfm_bart_base.json
--rw-rw-r--  2.0 unx     1741 b- defN 24-Mar-29 21:59 zensols/amr/resources/model/model_parse_xfm_bart_large.json
--rw-rw-r--  2.0 unx     1605 b- defN 24-Mar-29 21:59 zensols/amr/resources/model/model_parse_xfm_t5_base.json
--rw-rw-r--  2.0 unx     1661 b- defN 24-Mar-29 21:59 zensols/amr/resources/model/model_parse_xfm_t5_large.json
--rw-rw-r--  2.0 unx      362 b- defN 24-Mar-29 21:59 zensols/amr/wlk/__init__.py
--rw-rw-r--  2.0 unx    38066 b- defN 24-Mar-29 21:59 zensols/amr/wlk/amr_similarity.py
--rw-rw-r--  2.0 unx     8990 b- defN 24-Mar-29 21:59 zensols/amr/wlk/graph_helpers.py
--rw-rw-r--  2.0 unx     2418 b- defN 24-Mar-29 21:59 zensols/amr/wlk/score.py
--rw-rw-r--  2.0 unx    10216 b- defN 24-Mar-29 21:59 zensols.amr-0.1.1.dist-info/METADATA
--rw-rw-r--  2.0 unx       92 b- defN 24-Mar-29 21:59 zensols.amr-0.1.1.dist-info/WHEEL
--rw-rw-r--  2.0 unx       41 b- defN 24-Mar-29 21:59 zensols.amr-0.1.1.dist-info/entry_points.txt
--rw-rw-r--  2.0 unx       12 b- defN 24-Mar-29 21:59 zensols.amr-0.1.1.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     4357 b- defN 24-Mar-29 21:59 zensols.amr-0.1.1.dist-info/RECORD
-50 files, 315386 bytes uncompressed, 91011 bytes compressed:  71.1%
+Zip file size: 98959 bytes, number of entries: 50
+-rw-rw-r--  2.0 unx      124 b- defN 24-Apr-15 16:54 zensols/amr/__init__.py
+-rw-rw-r--  2.0 unx     7118 b- defN 24-Apr-15 16:54 zensols/amr/align.py
+-rw-rw-r--  2.0 unx     7196 b- defN 24-Apr-15 16:54 zensols/amr/alignpop.py
+-rw-rw-r--  2.0 unx     7438 b- defN 24-Apr-15 16:54 zensols/amr/amrlib.py
+-rw-rw-r--  2.0 unx    31264 b- defN 24-Apr-15 16:54 zensols/amr/annotate.py
+-rw-rw-r--  2.0 unx    18213 b- defN 24-Apr-15 16:54 zensols/amr/app.py
+-rw-rw-r--  2.0 unx     1241 b- defN 24-Apr-15 16:54 zensols/amr/cli.py
+-rw-rw-r--  2.0 unx    16905 b- defN 24-Apr-15 16:54 zensols/amr/container.py
+-rw-rw-r--  2.0 unx     4430 b- defN 24-Apr-15 16:54 zensols/amr/coref.py
+-rw-rw-r--  2.0 unx    12291 b- defN 24-Apr-15 16:54 zensols/amr/corpprep.py
+-rw-rw-r--  2.0 unx     8947 b- defN 24-Apr-15 16:54 zensols/amr/doc.py
+-rw-rw-r--  2.0 unx     5178 b- defN 24-Apr-15 16:54 zensols/amr/docfac.py
+-rw-rw-r--  2.0 unx    15427 b- defN 24-Apr-15 16:54 zensols/amr/docparser.py
+-rw-rw-r--  2.0 unx     1518 b- defN 24-Apr-15 16:54 zensols/amr/domain.py
+-rw-rw-r--  2.0 unx     9479 b- defN 24-Apr-15 16:54 zensols/amr/dumper.py
+-rw-rw-r--  2.0 unx     6527 b- defN 24-Apr-15 16:54 zensols/amr/model.py
+-rw-rw-r--  2.0 unx     5470 b- defN 24-Apr-15 16:54 zensols/amr/score.py
+-rw-rw-r--  2.0 unx    14240 b- defN 24-Apr-15 16:54 zensols/amr/sent.py
+-rw-rw-r--  2.0 unx     5632 b- defN 24-Apr-15 16:54 zensols/amr/serial.py
+-rw-rw-r--  2.0 unx     2965 b- defN 24-Apr-15 16:54 zensols/amr/spacyadapt.py
+-rw-rw-r--  2.0 unx    24488 b- defN 24-Apr-15 16:54 zensols/amr/trainer.py
+-rw-rw-r--  2.0 unx     9514 b- defN 24-Apr-15 16:54 zensols/amr/tree.py
+-rw-rw-r--  2.0 unx      783 b- defN 24-Apr-15 16:54 zensols/amr/resources/align.yml
+-rw-rw-r--  2.0 unx     4047 b- defN 24-Apr-15 16:54 zensols/amr/resources/annotate.conf
+-rw-rw-r--  2.0 unx     3376 b- defN 24-Apr-15 16:54 zensols/amr/resources/app.conf
+-rw-rw-r--  2.0 unx     1011 b- defN 24-Apr-15 16:54 zensols/amr/resources/coref.conf
+-rw-rw-r--  2.0 unx     1512 b- defN 24-Apr-15 16:54 zensols/amr/resources/default.conf
+-rw-rw-r--  2.0 unx     4131 b- defN 24-Apr-15 16:54 zensols/amr/resources/model.conf
+-rw-rw-r--  2.0 unx      376 b- defN 24-Apr-15 16:54 zensols/amr/resources/obj.conf
+-rw-rw-r--  2.0 unx     2712 b- defN 24-Apr-15 16:54 zensols/amr/resources/obj.yml
+-rw-rw-r--  2.0 unx      889 b- defN 24-Apr-15 16:54 zensols/amr/resources/score.yml
+-rw-rw-r--  2.0 unx      175 b- defN 24-Apr-15 16:54 zensols/amr/resources/serial.conf
+-rw-rw-r--  2.0 unx     4488 b- defN 24-Apr-15 16:54 zensols/amr/resources/train.yml
+-rw-rw-r--  2.0 unx     3825 b- defN 24-Apr-15 16:54 zensols/amr/resources/model/inference.conf
+-rw-rw-r--  2.0 unx     1626 b- defN 24-Apr-15 16:54 zensols/amr/resources/model/model_generate_xfm_t5_base_wTT.json
+-rw-rw-r--  2.0 unx     1771 b- defN 24-Apr-15 16:54 zensols/amr/resources/model/model_generate_xfm_t5_large_wTT.json
+-rw-rw-r--  2.0 unx      910 b- defN 24-Apr-15 16:54 zensols/amr/resources/model/model_parse_spring.json
+-rw-rw-r--  2.0 unx     1741 b- defN 24-Apr-15 16:54 zensols/amr/resources/model/model_parse_xfm_bart_base.json
+-rw-rw-r--  2.0 unx     1741 b- defN 24-Apr-15 16:54 zensols/amr/resources/model/model_parse_xfm_bart_large.json
+-rw-rw-r--  2.0 unx     1605 b- defN 24-Apr-15 16:54 zensols/amr/resources/model/model_parse_xfm_t5_base.json
+-rw-rw-r--  2.0 unx     1661 b- defN 24-Apr-15 16:54 zensols/amr/resources/model/model_parse_xfm_t5_large.json
+-rw-rw-r--  2.0 unx      362 b- defN 24-Apr-15 16:54 zensols/amr/wlk/__init__.py
+-rw-rw-r--  2.0 unx    38066 b- defN 24-Apr-15 16:54 zensols/amr/wlk/amr_similarity.py
+-rw-rw-r--  2.0 unx     8990 b- defN 24-Apr-15 16:54 zensols/amr/wlk/graph_helpers.py
+-rw-rw-r--  2.0 unx     2418 b- defN 24-Apr-15 16:54 zensols/amr/wlk/score.py
+-rw-rw-r--  2.0 unx    10216 b- defN 24-Apr-15 16:54 zensols.amr-0.1.2.dist-info/METADATA
+-rw-rw-r--  2.0 unx       92 b- defN 24-Apr-15 16:54 zensols.amr-0.1.2.dist-info/WHEEL
+-rw-rw-r--  2.0 unx       41 b- defN 24-Apr-15 16:54 zensols.amr-0.1.2.dist-info/entry_points.txt
+-rw-rw-r--  2.0 unx       12 b- defN 24-Apr-15 16:54 zensols.amr-0.1.2.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     4358 b- defN 24-Apr-15 16:54 zensols.amr-0.1.2.dist-info/RECORD
+50 files, 318540 bytes uncompressed, 92005 bytes compressed:  71.1%
```

## zipnote {}

```diff
@@ -129,23 +129,23 @@
 
 Filename: zensols/amr/wlk/graph_helpers.py
 Comment: 
 
 Filename: zensols/amr/wlk/score.py
 Comment: 
 
-Filename: zensols.amr-0.1.1.dist-info/METADATA
+Filename: zensols.amr-0.1.2.dist-info/METADATA
 Comment: 
 
-Filename: zensols.amr-0.1.1.dist-info/WHEEL
+Filename: zensols.amr-0.1.2.dist-info/WHEEL
 Comment: 
 
-Filename: zensols.amr-0.1.1.dist-info/entry_points.txt
+Filename: zensols.amr-0.1.2.dist-info/entry_points.txt
 Comment: 
 
-Filename: zensols.amr-0.1.1.dist-info/top_level.txt
+Filename: zensols.amr-0.1.2.dist-info/top_level.txt
 Comment: 
 
-Filename: zensols.amr-0.1.1.dist-info/RECORD
+Filename: zensols.amr-0.1.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## zensols/amr/app.py

```diff
@@ -1,13 +1,13 @@
 """Adapts :mod:`amrlib` in the Zensols framework.
 
 """
 from __future__ import annotations
 __author__ = 'Paul Landes'
-from typing import Tuple, Dict, Any, List, Set, Iterable, ClassVar
+from typing import Tuple, Dict, Any, List, Set, Iterable
 from dataclasses import dataclass, field
 from enum import Enum, auto
 import logging
 import sys
 import re
 from pathlib import Path
 import json
```

## zensols/amr/coref.py

```diff
@@ -1,23 +1,23 @@
 """Wrap the :mod:`amr_coref` module for AMR Co-refernce resolution.
 
 """
 __author__ = 'Paul Landes'
 
-from typing import Dict, List, Tuple
+from typing import Dict, List, Tuple, Union
 from dataclasses import dataclass, field
 import logging
 from pathlib import Path
 import platform
 import torch
 from zensols.util import time, Hasher
 from zensols.persist import persisted, Stash, DictionaryStash
 from zensols.install import Installer
 from amr_coref.coref.inference import Inference
-from . import AmrFeatureDocument
+from . import AmrFailure, AmrFeatureDocument
 
 logger = logging.getLogger(__name__)
 
 
 @dataclass
 class CoreferenceResolver(object):
     """Resolve coreferences in AMR graphs.
@@ -33,14 +33,20 @@
     """
     use_multithreading: bool = field(default=True)
     """By default, multithreading is enabled for Linux systems.  However, an
     error is raised when invoked from a child thread.  Set to ``False`` to off
     multithreading for coreference resolution.
 
     """
+    robust: bool = field(default=True)
+    """Whether to robustly deal with exceptions in the coreference model.  If
+    ``True``, instances of :class:`.AmrFailure` are stored in the stash and
+    empty coreferences used for caught errors.
+
+    """
     def _use_multithreading(self) -> bool:
         return self.use_multithreading and \
             not platform.system() != 'Linux'
 
     @property
     @persisted('_model')
     def model(self) -> Inference:
@@ -96,12 +102,21 @@
                     resolution
 
         :return: the coreferences tuples as ``(<document index>, <variable>)``
 
         """
         ref: Dict[str, List[Tuple[int, str]]]
         key: str = self._create_key(doc)
-        ref: Dict[str, List[Tuple[int, str]]] = self.stash.load(key)
+        ref: Union[AmrFailure, Dict[str, List[Tuple[int, str]]]] = \
+            self.stash.load(key)
         if ref is None:
-            ref = self._resolve(doc)
+            try:
+                ref = self._resolve(doc)
+            except Exception as e:
+                ref = AmrFailure(
+                    exception=e,
+                    message=f'could not co-reference <{doc.text}>',
+                    sent=doc.text)
+                logger.warning(str(ref))
             self.stash.dump(key, ref)
-        doc.coreference_relations = tuple(map(tuple, ref.values()))
+        if not isinstance(ref, AmrFailure):
+            doc.coreference_relations = tuple(map(tuple, ref.values()))
```

## zensols/amr/docparser.py

```diff
@@ -9,24 +9,25 @@
 import re
 import json
 import collections
 from itertools import chain
 import textwrap as tw
 from spacy.tokens import Doc, Token, Span
 from penman import constant, surface
-from penman.graph import Graph
+from penman.graph import Graph, Triple, Attribute
 from penman.surface import Alignment
 from zensols.persist import persisted
 from zensols.nlp import (
     SplitTokenMapper, TokenNormalizer, MapTokenNormalizer,
     FeatureSentence, FeatureDocument, FeatureToken,
     CachingFeatureDocumentParser, FeatureDocumentDecorator,
 )
 from . import (
-    AmrError, AmrSentence, AmrDocument, AmrFeatureSentence, AmrFeatureDocument
+    AmrError, Feature, AmrSentence, AmrDocument,
+    AmrFeatureSentence, AmrFeatureDocument
 )
 from .coref import CoreferenceResolver
 from .align import AmrAlignmentPopulator
 from .model import AmrParser
 from .spacyadapt import SpacyDocAdapter
 
 logger = logging.getLogger(__name__)
@@ -38,16 +39,18 @@
 
 @dataclass
 class TokenAnnotationFeatureDocumentDecorator(FeatureDocumentDecorator):
     """Annotate features in AMR sentence graphs from indexes annotated from
     :class:`.AmrAlignmentPopulator`.
 
     """
-    role: str = field()
-    """The triple role used to label the edge between the token and the feature.
+    name: str = field()
+    """The triple role (if :obj:`add_to_epi` is ``False``) used to label the
+    edge between the token and the feature.  Otherwise, this string is used in
+    the epidata of the graph.
 
     """
     feature_id: str = field()
     """The :class:`~zensols.nlp.FeatureToken` ID (attribute) to annotate in the
     AMR graph.
 
     """
@@ -63,14 +66,32 @@
     """Whether to map alignments to by (iterated) index position, or by using
     the per sentence index :obj:`~zensols.nlp.tok.FeatureToken` attribute
     ``i_sent``.  Set this to ``False`` if the the
     :class:`~zensols.nlp.parser.FeatureDocumentParser` was configured with a
     token normalizer configured with embedding named entities turned off.
 
     """
+    method: str = field(default='attribute')
+    """Where to add the data, which may be one of:
+
+      * ``attribute``: add as a new attribute node using ``name`` as the role
+        and the value as the attribute constant
+
+      * ``epi``: as epigraph data; however, the current Penman implementation
+        assume only alignments and the graph string will no longer be parsable
+
+    Otherwise, it uses the string to format a replacement node text using
+    ``target`` as the previous/original node text and ``value`` as the feature
+    value text.
+
+    """
+    def __post_init__(self):
+        if self.method == 'attribute':
+            self._role = ':' + self.name
+
     def decorate(self, doc: FeatureDocument):
         if not isinstance(doc, AmrFeatureDocument):
             raise AmrParseError(
                 f'Expecting AmrFeatureDocument but got: {type(doc)}')
         updates: List[AmrSentence] = []
         sent: AmrSentence
         for sent in doc.sents:
@@ -80,31 +101,46 @@
 
     def _format_feature_value(self, tok: FeatureToken) -> str:
         return getattr(tok, self.feature_id)
 
     def _is_none(self, feat_val: Any, tok: FeatureToken) -> bool:
         return feat_val is None or feat_val == FeatureToken.NONE
 
-    def _annotate_token(self, tok: FeatureToken, source: str,
-                        feature_triples: Set[Tuple[str, str, str]],
-                        graph: Graph):
+    def _annotate_token(self, tok: FeatureToken, source: Triple,
+                        feature_triples: List[Attribute], graph: Graph):
         # create the triple from token data
         feat_val: Any = self._format_feature_value(tok)
         if self.add_none or not self._is_none(feat_val, tok):
-            val: str = constant.quote(feat_val)
-            triple: List = [source, self.role, val]
-            if logger.isEnabledFor(logging.DEBUG):
-                logger.debug(f'adding: {triple}')
-            # add the feature as a triple to graph
-            feature_triples.append(triple)
+            if self.method == 'attribute':
+                val: str = constant.quote(feat_val)
+                triple = Attribute(source[0], self._role, val)
+                if logger.isEnabledFor(logging.DEBUG):
+                    logger.debug(f'adding: {triple}')
+                # add the feature as a triple to graph
+                feature_triples.append(triple)
+            elif self.method == 'epi':
+                epis: Dict[Attribute, List] = graph.epidata
+                epi_node: List[Any] = epis[source]
+                epi_node.append(Feature(self.name, feat_val))
+            else:
+                epis: Dict[Attribute, List] = graph.epidata
+                epi_node: List[Any] = epis[source]
+                val: str = self.method.format(
+                    target=source.target,
+                    value=feat_val)
+                triple = Attribute(source.source, source.role, val)
+                graph.triples.remove(source)
+                graph.triples.append(triple)
+                epis[triple] = epi_node
 
     def _align_idxs(self, graph: Graph, sent: AmrFeatureSentence,
                     tokens_by_i_sent: Dict[int, FeatureToken],
-                    feat_trips: List[Tuple[str, str, str]],
-                    graph_tokens: List[str], source: str, align: Alignment):
+                    feat_trips: List[Attribute],
+                    graph_tokens: List[str], source: Triple,
+                    align: Alignment):
         use_sent_index: bool = self.use_sent_index
         tix: int
         for tix in align.indices:
             td: FeatureToken
             if use_sent_index:
                 td = sent[tix]
             else:
@@ -119,38 +155,39 @@
                             f'<{gtok}> in {sent} vs. {graph_tokens}')
                 if logger.isEnabledFor(logging.DEBUG):
                     logger.debug(f'token: {tix} -> {td}')
                 self._annotate_token(td, source, feat_trips, graph)
 
     def _annotate_sentence(self, sent: AmrFeatureSentence,
                            doc: AmrFeatureDocument):
+        def map_attr(a: Attribute) -> Attribute:
+            role: str = f'{a.role}{srcs[a.source]}'
+            srcs[a.source] += 1
+            return Attribute(a.source, role, a.target)
+
         tokens_by_i_sent: Dict[int, FeatureToken] = sent.tokens_by_i_sent
         graph: Graph = sent.amr.graph
         graph_tokens: List[str] = json.loads(graph.metadata['tokens'])
         aligns: Dict[Tuple, Alignment] = surface.alignments(graph)
-        feat_trips: List[Tuple[str, str, str]] = []
-        trips: Tuple[str, str, Any] = tuple(chain.from_iterable(
+        feat_trips: List[Attribute] = []
+        trips: Triple = tuple(chain.from_iterable(
             (graph.instances(), graph.attributes())))
         # find triples that identify token index positions
         tix: int
         src_trip: Tuple[str, str, Any]
         for tix, src_trip in enumerate(trips):
-            source, rel, target = src_trip
             align: Alignment = aligns.get(src_trip)
             if align is not None:
                 if logger.isEnabledFor(logging.DEBUG):
                     logger.debug(f'triple: {src_trip}, align: {align}')
                 self._align_idxs(graph, sent, tokens_by_i_sent, feat_trips,
-                                 graph_tokens, source, align)
+                                 graph_tokens, src_trip, align)
         if self.indexed:
             srcs = collections.defaultdict(lambda: 1)
-            for trip in feat_trips:
-                trip[1] = trip[1] + str(srcs[trip[0]])
-                srcs[trip[0]] += 1
-            feat_trips = map(tuple, feat_trips)
+            feat_trips = map(map_attr, feat_trips)
         else:
             feat_trips = set(map(tuple, feat_trips))
         graph.triples.extend(feat_trips)
         return AmrSentence(graph)
 
 
 @dataclass
@@ -280,15 +317,16 @@
         if logger.isEnabledFor(logging.DEBUG):
             logger.debug(f'creating AMR doc from {fdoc}')
         ssent: FeatureSentence
         for fsent, ssent in zip(fdoc, sdoc.sents):
             assert isinstance(fsent, FeatureSentence)
             self._split_toks(fsent, ssent)
         if logger.isEnabledFor(logging.DEBUG):
-            logger.debug(f'generated spacy doc: {sdoc}')
+            sp = '|'.join(map(lambda t: t.orth_, sdoc))
+            logger.debug(f'generated spacy doc: {sdoc} ({sp})')
         self.amr_parser(sdoc)
         if self.alignment_populator is not None:
             self.alignment_populator.align(sdoc)
         return sdoc._.amr
 
     def annotate(self, doc: FeatureDocument) -> AmrFeatureDocument:
         """Parse, annotate and annotate a new AMR feature document using
@@ -316,14 +354,15 @@
             self.amr_doc_class, sents=tuple(fsents), amr=amr_doc)
         super().decorate(amr_fdoc)
         if self.coref_resolver is not None:
             self.coref_resolver(amr_fdoc)
         return amr_fdoc
 
     def parse(self, text: str, *args, **kwargs) -> FeatureDocument:
+        self._log_parse(text, logger)
         doc, key, loaded = self._load_or_parse(text, False, *args, **kwargs)
         if not loaded:
             doc = self.annotate(doc)
             if self.stash is not None:
                 self.stash.dump(key, doc)
         return doc
```

## zensols/amr/domain.py

```diff
@@ -1,14 +1,16 @@
 """Error and exception classes.
 
 """
+from __future__ import annotations
 __author__ = 'Paul Landes'
-
 from dataclasses import dataclass, field
 import logging
+from typing import Type
+from penman.epigraph import Epidatum
 from zensols.util import APIError, Failure
 
 logger = logging.getLogger(__name__)
 
 
 @dataclass
 class AmrFailure(Failure):
@@ -24,7 +26,37 @@
 
     """
     def __init__(self, msg: str, sent: str = None):
         if sent is not None:
             msg = f'{msg}: {sent}'
         super().__init__(msg)
         self.sent = sent
+
+
+class FeatureMarker(Epidatum):
+    __slots__ = ('feat_id', 'value')
+
+    def __init__(self, feat_id: str, value: str):
+        super().__init__()
+        self.feat_id = feat_id
+        self.value = value
+
+    @classmethod
+    def from_string(cls: Type[Feature], s: str) -> Feature:
+        s = s.lstrip('~')
+        return cls(*s.split('.'))
+
+    def __eq__(self, other):
+        if not isinstance(other, Feature):
+            return False
+        return self.feat_id == other.feat_id and self.value == other.value
+
+    def __str__(self):
+        return f'~{self.feat_id}.{self.value}'
+
+    def __repr__(self) -> str:
+        return f"{self.feat_id}='{self.value}'"
+
+
+class Feature(FeatureMarker):
+    __slots__ = ()
+    mode = 2
```

## zensols/amr/model.py

```diff
@@ -113,15 +113,16 @@
     def annotate_amr(self, doc: Doc):
         """Add an ``amr`` attribute to the spaCy document.
 
         :param doc: the document to annotate
 
         """
         if logger.isEnabledFor(logging.DEBUG):
-            logger.debug(f'parsing from {doc}')
+            sp = '|'.join(map(lambda t: t.orth_, doc))
+            logger.debug(f'parsing from {doc} ({sp})')
         # add spacy underscore data holders for the amr data structures
         if not Doc.has_extension('amr'):
             Doc.set_extension('amr', default=[])
         if not Span.has_extension('amr'):
             Span.set_extension('amr', default=[])
         sents: List[AmrSentence] = []
         sent: Span
```

## zensols/amr/sent.py

```diff
@@ -298,14 +298,15 @@
                     rms.append(i)
             rms.reverse()
             for i in rms:
                 del epi[i]
         metadata = self.metadata
         del metadata['alignments']
         self.metadata = metadata
+        self.invalidate_graph_string()
 
     @property
     def instances(self) -> Dict[str, Tuple[str, str, str]]:
         return frozendict({i.source: tuple(i) for i in self.graph.instances()})
 
     def clone(self, cls: Type[AmrSentence] = None, **kwargs) -> AmrSentence:
         """Return a deep copy of this instance."""
```

## zensols/amr/resources/annotate.conf

```diff
@@ -71,27 +71,27 @@
 doc_parser = instance: ${amr_default:doc_parser}
 
 
 ## Feature annotation: add attribute notes from feature sentences
 #
 [amr_token_ent_doc_decorator]
 class_name = zensols.amr.docparser.TokenAnnotationFeatureDocumentDecorator
-role = :ent
+name = ner
 feature_id = ent_
 
 [amr_token_pos_doc_decorator]
 class_name = zensols.amr.docparser.TokenAnnotationFeatureDocumentDecorator
-role = :pos
+name = pos
 feature_id = tag_
 # named entities can span tokens with varying POS tags
 indexed = True
 
 [amr_token_norm_doc_decorator]
 class_name = zensols.amr.docparser.TokenAnnotationFeatureDocumentDecorator
-role = :norm
+name = norm
 feature_id = norm
 
 [amr_alignment_doc_decorator]
 class_name = zensols.amr.alignpop.AlignmentPopulator
 
 [amr_anon_doc_parser_stash]
 class_name = zensols.persist.DirectoryStash
@@ -100,15 +100,15 @@
 # used to parse, populate, and annotate AMR graphs; this has the advantage of
 # avoiding a second AMR construction--if you need to add features to nodes
 [amr_anon_doc_parser]
 class_name = zensols.amr.docparser.AnnotationFeatureDocumentParser
 delegate = instance: amr_base_doc_parser
 stash = instance: amr_anon_doc_parser_stash
 amr_parser = instance: ${amr_default:amr_parser}
-#token_feature_annotators = instance: tuple: amr_token_ent_doc_decorator, amr_token_pos_doc_decorator
+#document_decorators = instance: tuple: amr_token_ent_doc_decorator, amr_token_pos_doc_decorator
 # see align.yml
 #alignment_populator = instance: amr_align_populator
 
 
 ## Corpus creation
 #
 [amr_corpus_writer]
```

## Comparing `zensols.amr-0.1.1.dist-info/METADATA` & `zensols.amr-0.1.2.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,27 +1,27 @@
 Metadata-Version: 2.1
 Name: zensols.amr
-Version: 0.1.1
+Version: 0.1.2
 Summary: Adapts amrlib in the Zensols framework.
 Home-page: https://github.com/plandes/amr
-Download-URL: https://github.com/plandes/amr/releases/download/v0.1.1/zensols.amr-0.1.1-py3-none-any.whl
+Download-URL: https://github.com/plandes/amr/releases/download/v0.1.2/zensols.amr-0.1.2-py3-none-any.whl
 Author: Paul Landes
 Author-email: landes@mailc.net
 Keywords: tooling
 Description-Content-Type: text/markdown
 Requires-Dist: amrlib ~=0.8.0
 Requires-Dist: graphviz ~=0.20.1
 Requires-Dist: sentencepiece ~=0.1.96
 Requires-Dist: word2number ==1.1
 Requires-Dist: Unidecode ~=1.3.8
 Requires-Dist: pandas
 Requires-Dist: cached-property ~=1.5.2
 Requires-Dist: networkx ~=3.2.1
 Requires-Dist: zensols.install ~=1.1.2
-Requires-Dist: zensols.nlp ~=1.10.0
+Requires-Dist: zensols.nlp ~=1.11.0
 Requires-Dist: zensols.amr-coref ~=0.0.2
 
 # AMR annotation and feature generation
 
 [![PyPI][pypi-badge]][pypi-link]
 [![Python 3.10][python310-badge]][python310-link]
 [![Python 3.11][python311-badge]][python311-link]
```

## Comparing `zensols.amr-0.1.1.dist-info/RECORD` & `zensols.amr-0.1.2.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -1,31 +1,31 @@
 zensols/amr/__init__.py,sha256=trzaZr_1bq0IuknHn4EV6U1hL_nL46xkQsbQMiX4Hi4,124
 zensols/amr/align.py,sha256=kz8nXvEBJZKjP2ECjIwLOM_NXS0dbih1jeJbR3KVGEw,7118
 zensols/amr/alignpop.py,sha256=C9Ga5NGATAw9VdDJmcoKewizKX5qlQBLOv6dzEAjJnk,7196
 zensols/amr/amrlib.py,sha256=qgilWaUexwCYGgg-47zq-FJnPCCUhRWYJPmTXELKAyU,7438
 zensols/amr/annotate.py,sha256=DekcA2nuSpmB0uuDSHUv8eIj7SJta0z8r1SMP4hHGso,31264
-zensols/amr/app.py,sha256=wnNvpOLSjTtUe78NoT5nFC1f9m_CWRbP3amm85HwfwI,18223
+zensols/amr/app.py,sha256=UkNixsjaiK36Kz3kv_zudm0MGoEzex046gyReDJJi00,18213
 zensols/amr/cli.py,sha256=zxE721skOjq1VJphqWItQnSFCxs02ImIULXOsOEwwak,1241
 zensols/amr/container.py,sha256=hwtFJxLP2_UwEecqMPX9WlDl3hBHIc_gVP6M5CgNeeE,16905
-zensols/amr/coref.py,sha256=h3iFem7aAW1G5qxFiGFarcvK8Qg5abBeuYIuDOcLWx0,3814
+zensols/amr/coref.py,sha256=9LKErBrRWnJYUeIiphfWrBOP3ZKf6FWEKr9yWL5NvMg,4430
 zensols/amr/corpprep.py,sha256=C8kWnxsUxZZrdVDg8qoDnNXiXQBRTTS2wooPaED28Fw,12291
 zensols/amr/doc.py,sha256=13dL2_qgTsBMNJEhJv_uY6qwUcQo3tcg68cymDqTDic,8947
 zensols/amr/docfac.py,sha256=1hUuLB_WF2QCYBNvLcdfYMme9aDc6ZTSUYvflKlqIh8,5178
-zensols/amr/docparser.py,sha256=CGnZ4ErKnJY6dnj2bEVPMcPDET1ky8xpb3mjyOHE1mU,13800
-zensols/amr/domain.py,sha256=OZMI4bxsgZGFsBEdrztL_FxzwvAtcOPrA8UzcGL_Ymo,691
+zensols/amr/docparser.py,sha256=Hmzvf-SzZgKfY0AKbEbm3GsXbAm8E-E8gJeAMBiPnPI,15427
+zensols/amr/domain.py,sha256=SQ4FdWMnbfLOCEcklAt7CsHFk4At0OdwGJ3MHFvEo28,1518
 zensols/amr/dumper.py,sha256=M3vDNbmoFN6ZWZPy66jxMi-kLcKau0leKqiQ-CitSnw,9479
-zensols/amr/model.py,sha256=KpVrN99K7NjQVuHI-GQ3FxTiiP-ruN4-G-MIGugJzDs,6465
+zensols/amr/model.py,sha256=4JtG4KR9fcOlsdftTIpKAKRzwofMqhqFey6DyghcXIE,6527
 zensols/amr/score.py,sha256=KVfNPMVcQLb_OX-yB6efR_RyNjAWg2xip6sSY7HKgQA,5470
-zensols/amr/sent.py,sha256=AnLIE-ik5S5nsl73mdPNghNpKcmASyrDZiu4mtZF2tw,14201
+zensols/amr/sent.py,sha256=WcF7O7p2Sc9CKT1PQs7jKt-flzVlBlh152U8p3yb920,14240
 zensols/amr/serial.py,sha256=8Dxkr99YS8maFsM2RCZIXDUxU80Akp-UlnEwshPa2QU,5632
 zensols/amr/spacyadapt.py,sha256=QC7pbwnI_6ped4-6EY8WkJ73NEGJ7hU6-vC9mjSUnGk,2965
 zensols/amr/trainer.py,sha256=N32KMUCiwc_2dS8kuayNuu8FCSGfwCIilKd63PrfAiY,24488
 zensols/amr/tree.py,sha256=qpQ_VRsekH6Zn87IPkyE6-yFa18HNIbTNzNmOLPNVBM,9514
 zensols/amr/resources/align.yml,sha256=QaFRgbs9Ij6lOJ-z53G5jmvtl5pCidew2wA5jr-tDzY,783
-zensols/amr/resources/annotate.conf,sha256=6GPo4PML3UnSA_14-oLz9AjuzI0A2iGzwdQw8jpSe0w,4055
+zensols/amr/resources/annotate.conf,sha256=DY9haOjSDnhYlbDHObNWTV47coMV1ONh9WHv6xUXUYA,4047
 zensols/amr/resources/app.conf,sha256=qkIo87gDF4wUWo5j_hK7Mk-oKqTAYLHhr39zCWEjuLI,3376
 zensols/amr/resources/coref.conf,sha256=41fy-oIndUzfBmtvI0yGXifujLuzENEL_TR699c1bm4,1011
 zensols/amr/resources/default.conf,sha256=zpsNtpdsERxVpx82lvAQF7-TxR72MiuFyuEYC8xstzg,1512
 zensols/amr/resources/model.conf,sha256=maVasBAKNFgbHhvOVjghzsqgdniDKIAj6at9LUmCZlM,4131
 zensols/amr/resources/obj.conf,sha256=jM65dQ91BxMoyFxrgK2a-J72ldRRVkO9cO_PqP-55Jo,376
 zensols/amr/resources/obj.yml,sha256=7WPoOS9wTCQp4th6lVzOiJzXWs1aC6316fe8xOV_zfE,2712
 zensols/amr/resources/score.yml,sha256=P9gRNGONBScK_X6SBoVFBKUD67bUwd9-aR7DuL-6TBw,889
@@ -39,12 +39,12 @@
 zensols/amr/resources/model/model_parse_xfm_bart_large.json,sha256=IxWVVkZIKlJf0HG8sFe06SWvZqi8f94iWHQ-Oee2N58,1741
 zensols/amr/resources/model/model_parse_xfm_t5_base.json,sha256=ncgCeUiMFx9lHga1V5ln6_tsk-7_QxKGBe1mV5uDDS0,1605
 zensols/amr/resources/model/model_parse_xfm_t5_large.json,sha256=BXveH24SKeqnVjXg_Sbh1O1x-bKdDIoCJUXN7OqNJMY,1661
 zensols/amr/wlk/__init__.py,sha256=tQF_V-RFnZjxzaA8vMnoLF6KWDohGeuKeT0OL0Huy24,362
 zensols/amr/wlk/amr_similarity.py,sha256=CS0gUrOfAVW_ivEWm07mHbIxxd9fUiXOeX388LyVsR4,38066
 zensols/amr/wlk/graph_helpers.py,sha256=Nut8a59woB0-RuxhhMYTQcYk9vfGPOV3Thwp9bjhMyY,8990
 zensols/amr/wlk/score.py,sha256=JYG5yurUHU-rL6sjC-PPxcMvZAqveEi3kX2wbkbtYsM,2418
-zensols.amr-0.1.1.dist-info/METADATA,sha256=hNKCNOnGTC2CEOOwFdeB_CYlihO-G77NEDgWn3DBfn8,10216
-zensols.amr-0.1.1.dist-info/WHEEL,sha256=oiQVh_5PnQM0E3gPdiz09WCNmwiHDMaGer_elqB3coM,92
-zensols.amr-0.1.1.dist-info/entry_points.txt,sha256=vdqZvGPr3fmkLXpesB_Fn3sNc0Cp_4YtjyUUypUZM2s,41
-zensols.amr-0.1.1.dist-info/top_level.txt,sha256=3frGkc-WZdUzu0vsSUs-dpfmTVxqP_XFM_HRQLwet5E,12
-zensols.amr-0.1.1.dist-info/RECORD,,
+zensols.amr-0.1.2.dist-info/METADATA,sha256=sLvojQvNeTIyf4bgEzoR52EGnIC2MZqjnuaCUkXaIJ4,10216
+zensols.amr-0.1.2.dist-info/WHEEL,sha256=oiQVh_5PnQM0E3gPdiz09WCNmwiHDMaGer_elqB3coM,92
+zensols.amr-0.1.2.dist-info/entry_points.txt,sha256=vdqZvGPr3fmkLXpesB_Fn3sNc0Cp_4YtjyUUypUZM2s,41
+zensols.amr-0.1.2.dist-info/top_level.txt,sha256=3frGkc-WZdUzu0vsSUs-dpfmTVxqP_XFM_HRQLwet5E,12
+zensols.amr-0.1.2.dist-info/RECORD,,
```

